/**
 * Copyright 2016 Google Inc. All Rights Reserved.
 *
 * Licensed under the W3C SOFTWARE AND DOCUMENT NOTICE AND LICENSE.
 *
 *  https://www.w3.org/Consortium/Legal/2015/copyright-software-and-document
 *
 */

(function(window, document) {
  'use strict';


// Exits early if all IntersectionObserver and IntersectionObserverEntry
// features are natively supported.
  if ('IntersectionObserver' in window &&
      'IntersectionObserverEntry' in window &&
      'intersectionRatio' in window.IntersectionObserverEntry.prototype) {

    // Minimal polyfill for Edge 15's lack of `isIntersecting`
    // See: https://github.com/w3c/IntersectionObserver/issues/211
    if (!('isIntersecting' in window.IntersectionObserverEntry.prototype)) {
      Object.defineProperty(window.IntersectionObserverEntry.prototype,
          'isIntersecting', {
            get: function () {
              return this.intersectionRatio > 0;
            }
          });
    }
    return;
  }


  /**
   * An IntersectionObserver registry. This registry exists to hold a strong
   * reference to IntersectionObserver instances currently observering a target
   * element. Without this registry, instances without another reference may be
   * garbage collected.
   */
  var registry = [];


  /**
   * Creates the global IntersectionObserverEntry constructor.
   * https://w3c.github.io/IntersectionObserver/#intersection-observer-entry
   * @param {Object} entry A dictionary of instance properties.
   * @constructor
   */
  function IntersectionObserverEntry(entry) {
    this.time = entry.time;
    this.target = entry.target;
    this.rootBounds = entry.rootBounds;
    this.boundingClientRect = entry.boundingClientRect;
    this.intersectionRect = entry.intersectionRect || getEmptyRect();
    this.isIntersecting = !!entry.intersectionRect;

    // Calculates the intersection ratio.
    var targetRect = this.boundingClientRect;
    var targetArea = targetRect.width * targetRect.height;
    var intersectionRect = this.intersectionRect;
    var intersectionArea = intersectionRect.width * intersectionRect.height;

    // Sets intersection ratio.
    if (targetArea) {
      this.intersectionRatio = intersectionArea / targetArea;
    } else {
      // If area is zero and is intersecting, sets to 1, otherwise to 0
      this.intersectionRatio = this.isIntersecting ? 1 : 0;
    }
  }


  /**
   * Creates the global IntersectionObserver constructor.
   * https://w3c.github.io/IntersectionObserver/#intersection-observer-interface
   * @param {Function} callback The function to be invoked after intersection
   *     changes have queued. The function is not invoked if the queue has
   *     been emptied by calling the `takeRecords` method.
   * @param {Object=} opt_options Optional configuration options.
   * @constructor
   */
  function IntersectionObserver(callback, opt_options) {

    var options = opt_options || {};

    if (typeof callback != 'function') {
      throw new Error('callback must be a function');
    }

    if (options.root && options.root.nodeType != 1) {
      throw new Error('root must be an Element');
    }

    // Binds and throttles `this._checkForIntersections`.
    this._checkForIntersections = throttle(
        this._checkForIntersections.bind(this), this.THROTTLE_TIMEOUT);

    // Private properties.
    this._callback = callback;
    this._observationTargets = [];
    this._queuedEntries = [];
    this._rootMarginValues = this._parseRootMargin(options.rootMargin);

    // Public properties.
    this.thresholds = this._initThresholds(options.threshold);
    this.root = options.root || null;
    this.rootMargin = this._rootMarginValues.map(function(margin) {
      return margin.value + margin.unit;
    }).join(' ');
  }


  /**
   * The minimum interval within which the document will be checked for
   * intersection changes.
   */
  IntersectionObserver.prototype.THROTTLE_TIMEOUT = 100;


  /**
   * The frequency in which the polyfill polls for intersection changes.
   * this can be updated on a per instance basis and must be set prior to
   * calling `observe` on the first target.
   */
  IntersectionObserver.prototype.POLL_INTERVAL = null;

  /**
   * Use a mutation observer on the root element
   * to detect intersection changes.
   */
  IntersectionObserver.prototype.USE_MUTATION_OBSERVER = true;


  /**
   * Starts observing a target element for intersection changes based on
   * the thresholds values.
   * @param {Element} target The DOM element to observe.
   */
  IntersectionObserver.prototype.observe = function(target) {
    var isTargetAlreadyObserved = this._observationTargets.some(function(item) {
      return item.element == target;
    });

    if (isTargetAlreadyObserved) {
      return;
    }

    if (!(target && target.nodeType == 1)) {
      throw new Error('target must be an Element');
    }

    this._registerInstance();
    this._observationTargets.push({element: target, entry: null});
    this._monitorIntersections();
    this._checkForIntersections();
  };


  /**
   * Stops observing a target element for intersection changes.
   * @param {Element} target The DOM element to observe.
   */
  IntersectionObserver.prototype.unobserve = function(target) {
    this._observationTargets =
        this._observationTargets.filter(function(item) {

          return item.element != target;
        });
    if (!this._observationTargets.length) {
      this._unmonitorIntersections();
      this._unregisterInstance();
    }
  };


  /**
   * Stops observing all target elements for intersection changes.
   */
  IntersectionObserver.prototype.disconnect = function() {
    this._observationTargets = [];
    this._unmonitorIntersections();
    this._unregisterInstance();
  };


  /**
   * Returns any queue entries that have not yet been reported to the
   * callback and clears the queue. This can be used in conjunction with the
   * callback to obtain the absolute most up-to-date intersection information.
   * @return {Array} The currently queued entries.
   */
  IntersectionObserver.prototype.takeRecords = function() {
    var records = this._queuedEntries.slice();
    this._queuedEntries = [];
    return records;
  };


  /**
   * Accepts the threshold value from the user configuration object and
   * returns a sorted array of unique threshold values. If a value is not
   * between 0 and 1 and error is thrown.
   * @private
   * @param {Array|number=} opt_threshold An optional threshold value or
   *     a list of threshold values, defaulting to [0].
   * @return {Array} A sorted list of unique and valid threshold values.
   */
  IntersectionObserver.prototype._initThresholds = function(opt_threshold) {
    var threshold = opt_threshold || [0];
    if (!Array.isArray(threshold)) threshold = [threshold];

    return threshold.sort().filter(function(t, i, a) {
      if (typeof t != 'number' || isNaN(t) || t < 0 || t > 1) {
        throw new Error('threshold must be a number between 0 and 1 inclusively');
      }
      return t !== a[i - 1];
    });
  };


  /**
   * Accepts the rootMargin value from the user configuration object
   * and returns an array of the four margin values as an object containing
   * the value and unit properties. If any of the values are not properly
   * formatted or use a unit other than px or %, and error is thrown.
   * @private
   * @param {string=} opt_rootMargin An optional rootMargin value,
   *     defaulting to '0px'.
   * @return {Array<Object>} An array of margin objects with the keys
   *     value and unit.
   */
  IntersectionObserver.prototype._parseRootMargin = function(opt_rootMargin) {
    var marginString = opt_rootMargin || '0px';
    var margins = marginString.split(/\s+/).map(function(margin) {
      var parts = /^(-?\d*\.?\d+)(px|%)$/.exec(margin);
      if (!parts) {
        throw new Error('rootMargin must be specified in pixels or percent');
      }
      return {value: parseFloat(parts[1]), unit: parts[2]};
    });

    // Handles shorthand.
    margins[1] = margins[1] || margins[0];
    margins[2] = margins[2] || margins[0];
    margins[3] = margins[3] || margins[1];

    return margins;
  };


  /**
   * Starts polling for intersection changes if the polling is not already
   * happening, and if the page's visibilty state is visible.
   * @private
   */
  IntersectionObserver.prototype._monitorIntersections = function() {
    if (!this._monitoringIntersections) {
      this._monitoringIntersections = true;

      // If a poll interval is set, use polling instead of listening to
      // resize and scroll events or DOM mutations.
      if (this.POLL_INTERVAL) {
        this._monitoringInterval = setInterval(
            this._checkForIntersections, this.POLL_INTERVAL);
      }
      else {
        addEvent(window, 'resize', this._checkForIntersections, true);
        addEvent(document, 'scroll', this._checkForIntersections, true);

        if (this.USE_MUTATION_OBSERVER && 'MutationObserver' in window) {
          this._domObserver = new MutationObserver(this._checkForIntersections);
          this._domObserver.observe(document, {
            attributes: true,
            childList: true,
            characterData: true,
            subtree: true
          });
        }
      }
    }
  };


  /**
   * Stops polling for intersection changes.
   * @private
   */
  IntersectionObserver.prototype._unmonitorIntersections = function() {
    if (this._monitoringIntersections) {
      this._monitoringIntersections = false;

      clearInterval(this._monitoringInterval);
      this._monitoringInterval = null;

      removeEvent(window, 'resize', this._checkForIntersections, true);
      removeEvent(document, 'scroll', this._checkForIntersections, true);

      if (this._domObserver) {
        this._domObserver.disconnect();
        this._domObserver = null;
      }
    }
  };


  /**
   * Scans each observation target for intersection changes and adds them
   * to the internal entries queue. If new entries are found, it
   * schedules the callback to be invoked.
   * @private
   */
  IntersectionObserver.prototype._checkForIntersections = function() {
    var rootIsInDom = this._rootIsInDom();
    var rootRect = rootIsInDom ? this._getRootRect() : getEmptyRect();

    this._observationTargets.forEach(function(item) {
      var target = item.element;
      var targetRect = getBoundingClientRect(target);
      var rootContainsTarget = this._rootContainsTarget(target);
      var oldEntry = item.entry;
      var intersectionRect = rootIsInDom && rootContainsTarget &&
          this._computeTargetAndRootIntersection(target, rootRect);

      var newEntry = item.entry = new IntersectionObserverEntry({
        time: now(),
        target: target,
        boundingClientRect: targetRect,
        rootBounds: rootRect,
        intersectionRect: intersectionRect
      });

      if (!oldEntry) {
        this._queuedEntries.push(newEntry);
      } else if (rootIsInDom && rootContainsTarget) {
        // If the new entry intersection ratio has crossed any of the
        // thresholds, add a new entry.
        if (this._hasCrossedThreshold(oldEntry, newEntry)) {
          this._queuedEntries.push(newEntry);
        }
      } else {
        // If the root is not in the DOM or target is not contained within
        // root but the previous entry for this target had an intersection,
        // add a new record indicating removal.
        if (oldEntry && oldEntry.isIntersecting) {
          this._queuedEntries.push(newEntry);
        }
      }
    }, this);

    if (this._queuedEntries.length) {
      this._callback(this.takeRecords(), this);
    }
  };


  /**
   * Accepts a target and root rect computes the intersection between then
   * following the algorithm in the spec.
   * TODO(philipwalton): at this time clip-path is not considered.
   * https://w3c.github.io/IntersectionObserver/#calculate-intersection-rect-algo
   * @param {Element} target The target DOM element
   * @param {Object} rootRect The bounding rect of the root after being
   *     expanded by the rootMargin value.
   * @return {?Object} The final intersection rect object or undefined if no
   *     intersection is found.
   * @private
   */
  IntersectionObserver.prototype._computeTargetAndRootIntersection =
      function(target, rootRect) {

        // If the element isn't displayed, an intersection can't happen.
        if (window.getComputedStyle(target).display == 'none') return;

        var targetRect = getBoundingClientRect(target);
        var intersectionRect = targetRect;
        var parent = getParentNode(target);
        var atRoot = false;

        while (!atRoot) {
          var parentRect = null;
          var parentComputedStyle = parent.nodeType == 1 ?
              window.getComputedStyle(parent) : {};

          // If the parent isn't displayed, an intersection can't happen.
          if (parentComputedStyle.display == 'none') return;

          if (parent == this.root || parent == document) {
            atRoot = true;
            parentRect = rootRect;
          } else {
            // If the element has a non-visible overflow, and it's not the <body>
            // or <html> element, update the intersection rect.
            // Note: <body> and <html> cannot be clipped to a rect that's not also
            // the document rect, so no need to compute a new intersection.
            if (parent != document.body &&
                parent != document.documentElement &&
                parentComputedStyle.overflow != 'visible') {
              parentRect = getBoundingClientRect(parent);
            }
          }

          // If either of the above conditionals set a new parentRect,
          // calculate new intersection data.
          if (parentRect) {
            intersectionRect = computeRectIntersection(parentRect, intersectionRect);

            if (!intersectionRect) break;
          }
          parent = getParentNode(parent);
        }
        return intersectionRect;
      };


  /**
   * Returns the root rect after being expanded by the rootMargin value.
   * @return {Object} The expanded root rect.
   * @private
   */
  IntersectionObserver.prototype._getRootRect = function() {
    var rootRect;
    if (this.root) {
      rootRect = getBoundingClientRect(this.root);
    } else {
      // Use <html>/<body> instead of window since scroll bars affect size.
      var html = document.documentElement;
      var body = document.body;
      rootRect = {
        top: 0,
        left: 0,
        right: html.clientWidth || body.clientWidth,
        width: html.clientWidth || body.clientWidth,
        bottom: html.clientHeight || body.clientHeight,
        height: html.clientHeight || body.clientHeight
      };
    }
    return this._expandRectByRootMargin(rootRect);
  };


  /**
   * Accepts a rect and expands it by the rootMargin value.
   * @param {Object} rect The rect object to expand.
   * @return {Object} The expanded rect.
   * @private
   */
  IntersectionObserver.prototype._expandRectByRootMargin = function(rect) {
    var margins = this._rootMarginValues.map(function(margin, i) {
      return margin.unit == 'px' ? margin.value :
          margin.value * (i % 2 ? rect.width : rect.height) / 100;
    });
    var newRect = {
      top: rect.top - margins[0],
      right: rect.right + margins[1],
      bottom: rect.bottom + margins[2],
      left: rect.left - margins[3]
    };
    newRect.width = newRect.right - newRect.left;
    newRect.height = newRect.bottom - newRect.top;

    return newRect;
  };


  /**
   * Accepts an old and new entry and returns true if at least one of the
   * threshold values has been crossed.
   * @param {?IntersectionObserverEntry} oldEntry The previous entry for a
   *    particular target element or null if no previous entry exists.
   * @param {IntersectionObserverEntry} newEntry The current entry for a
   *    particular target element.
   * @return {boolean} Returns true if a any threshold has been crossed.
   * @private
   */
  IntersectionObserver.prototype._hasCrossedThreshold =
      function(oldEntry, newEntry) {

        // To make comparing easier, an entry that has a ratio of 0
        // but does not actually intersect is given a value of -1
        var oldRatio = oldEntry && oldEntry.isIntersecting ?
            oldEntry.intersectionRatio || 0 : -1;
        var newRatio = newEntry.isIntersecting ?
            newEntry.intersectionRatio || 0 : -1;

        // Ignore unchanged ratios
        if (oldRatio === newRatio) return;

        for (var i = 0; i < this.thresholds.length; i++) {
          var threshold = this.thresholds[i];

          // Return true if an entry matches a threshold or if the new ratio
          // and the old ratio are on the opposite sides of a threshold.
          if (threshold == oldRatio || threshold == newRatio ||
              threshold < oldRatio !== threshold < newRatio) {
            return true;
          }
        }
      };


  /**
   * Returns whether or not the root element is an element and is in the DOM.
   * @return {boolean} True if the root element is an element and is in the DOM.
   * @private
   */
  IntersectionObserver.prototype._rootIsInDom = function() {
    return !this.root || containsDeep(document, this.root);
  };


  /**
   * Returns whether or not the target element is a child of root.
   * @param {Element} target The target element to check.
   * @return {boolean} True if the target element is a child of root.
   * @private
   */
  IntersectionObserver.prototype._rootContainsTarget = function(target) {
    return containsDeep(this.root || document, target);
  };


  /**
   * Adds the instance to the global IntersectionObserver registry if it isn't
   * already present.
   * @private
   */
  IntersectionObserver.prototype._registerInstance = function() {
    if (registry.indexOf(this) < 0) {
      registry.push(this);
    }
  };


  /**
   * Removes the instance from the global IntersectionObserver registry.
   * @private
   */
  IntersectionObserver.prototype._unregisterInstance = function() {
    var index = registry.indexOf(this);
    if (index != -1) registry.splice(index, 1);
  };


  /**
   * Returns the result of the performance.now() method or null in browsers
   * that don't support the API.
   * @return {number} The elapsed time since the page was requested.
   */
  function now() {
    return window.performance && performance.now && performance.now();
  }


  /**
   * Throttles a function and delays its executiong, so it's only called at most
   * once within a given time period.
   * @param {Function} fn The function to throttle.
   * @param {number} timeout The amount of time that must pass before the
   *     function can be called again.
   * @return {Function} The throttled function.
   */
  function throttle(fn, timeout) {
    var timer = null;
    return function () {
      if (!timer) {
        timer = setTimeout(function() {
          fn();
          timer = null;
        }, timeout);
      }
    };
  }


  /**
   * Adds an event handler to a DOM node ensuring cross-browser compatibility.
   * @param {Node} node The DOM node to add the event handler to.
   * @param {string} event The event name.
   * @param {Function} fn The event handler to add.
   * @param {boolean} opt_useCapture Optionally adds the even to the capture
   *     phase. Note: this only works in modern browsers.
   */
  function addEvent(node, event, fn, opt_useCapture) {
    if (typeof node.addEventListener == 'function') {
      node.addEventListener(event, fn, opt_useCapture || false);
    }
    else if (typeof node.attachEvent == 'function') {
      node.attachEvent('on' + event, fn);
    }
  }


  /**
   * Removes a previously added event handler from a DOM node.
   * @param {Node} node The DOM node to remove the event handler from.
   * @param {string} event The event name.
   * @param {Function} fn The event handler to remove.
   * @param {boolean} opt_useCapture If the event handler was added with this
   *     flag set to true, it should be set to true here in order to remove it.
   */
  function removeEvent(node, event, fn, opt_useCapture) {
    if (typeof node.removeEventListener == 'function') {
      node.removeEventListener(event, fn, opt_useCapture || false);
    }
    else if (typeof node.detatchEvent == 'function') {
      node.detatchEvent('on' + event, fn);
    }
  }


  /**
   * Returns the intersection between two rect objects.
   * @param {Object} rect1 The first rect.
   * @param {Object} rect2 The second rect.
   * @return {?Object} The intersection rect or undefined if no intersection
   *     is found.
   */
  function computeRectIntersection(rect1, rect2) {
    var top = Math.max(rect1.top, rect2.top);
    var bottom = Math.min(rect1.bottom, rect2.bottom);
    var left = Math.max(rect1.left, rect2.left);
    var right = Math.min(rect1.right, rect2.right);
    var width = right - left;
    var height = bottom - top;

    return (width >= 0 && height >= 0) && {
      top: top,
      bottom: bottom,
      left: left,
      right: right,
      width: width,
      height: height
    };
  }


  /**
   * Shims the native getBoundingClientRect for compatibility with older IE.
   * @param {Element} el The element whose bounding rect to get.
   * @return {Object} The (possibly shimmed) rect of the element.
   */
  function getBoundingClientRect(el) {
    var rect;

    try {
      rect = el.getBoundingClientRect();
    } catch (err) {
      // Ignore Windows 7 IE11 "Unspecified error"
      // https://github.com/w3c/IntersectionObserver/pull/205
    }

    if (!rect) return getEmptyRect();

    // Older IE
    if (!(rect.width && rect.height)) {
      rect = {
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        left: rect.left,
        width: rect.right - rect.left,
        height: rect.bottom - rect.top
      };
    }
    return rect;
  }


  /**
   * Returns an empty rect object. An empty rect is returned when an element
   * is not in the DOM.
   * @return {Object} The empty rect.
   */
  function getEmptyRect() {
    return {
      top: 0,
      bottom: 0,
      left: 0,
      right: 0,
      width: 0,
      height: 0
    };
  }

  /**
   * Checks to see if a parent element contains a child elemnt (including inside
   * shadow DOM).
   * @param {Node} parent The parent element.
   * @param {Node} child The child element.
   * @return {boolean} True if the parent node contains the child node.
   */
  function containsDeep(parent, child) {
    var node = child;
    while (node) {
      if (node == parent) return true;

      node = getParentNode(node);
    }
    return false;
  }


  /**
   * Gets the parent node of an element or its host element if the parent node
   * is a shadow root.
   * @param {Node} node The node whose parent to get.
   * @return {Node|null} The parent node or null if no parent exists.
   */
  function getParentNode(node) {
    var parent = node.parentNode;

    if (parent && parent.nodeType == 11 && parent.host) {
      // If the parent is a shadow root, return the host element.
      return parent.host;
    }
    return parent;
  }


// Exposes the constructors globally.
  window.IntersectionObserver = IntersectionObserver;
  window.IntersectionObserverEntry = IntersectionObserverEntry;

}(window, document));(function ($, window, document, undefined) {
    'use strict';

    $(document).ready(function () {
        window.matchMediaQuery = new MatchMediaQuery({
            queries: ['size0', 'size1', 'size2', 'size3', 'size4'],
            fallbackQuery: 'size4'
        });
    });
})(jQuery, this, this.document);

function MatchMediaQuery(options)
{
    //region Singleton handling
    //------------------------------------------------------------------------------------------------------------------
    if (MatchMediaQuery.prototype._singletonInstance)
    {
        return MatchMediaQuery.prototype._singletonInstance;
    }
    MatchMediaQuery.prototype._singletonInstance = this;
    //endregion
    //------------------------------------------------------------------------------------------------------------------

    //region Private variables
    //------------------------------------------------------------------------------------------------------------------
    var self = this,
        defaultOptions = {
            $container: $('body'),
            queries: [],
            fallbackQuery: '',
            debug: false
        },
        EVENTS = {
            'match': 'MatchMediaQuery_match',
            'unmatch': 'MatchMediaQuery_unmatch'
        },
        $mediaQueryIndicator = $('<div class="MATCH-MEDIA-QUERY" style="display:none"></div>'),
        activeQuery = '',
        activeQueryPos = -1;
    //endregion
    //------------------------------------------------------------------------------------------------------------------

    //region Public variables
    //------------------------------------------------------------------------------------------------------------------
    this.settings = {};
    // use eventNamespace for namespaced events e.g. .on('click.' + self.eventNamespace, function(){...
    this.eventNamespace = 'plugin_MatchMediaQuery';
    //endregion
    //------------------------------------------------------------------------------------------------------------------

    //region Private functions
    //------------------------------------------------------------------------------------------------------------------
    /**
     * Initialise class instance
     */
    (function init()
    {
        self.settings = $.extend(true, {}, defaultOptions, options || {});

        // create pseudo element
        _createPseudoElement();

        // set initial query value
        _setInitialQuery();

        // register events
        _setListener();

        // trigger initial match event
        $(document).trigger(EVENTS.match, {query: activeQuery, pos: activeQueryPos});
    }());

    function _setListener()
    {
        // TODO CHECK IF MQs ARE SUPPORTED
        if(window.WHandler && window.windowHandler instanceof window.WHandler)
        {
            window.windowHandler.addResizeFunction(_onResize);
        }else
        {
            $(window).on('resize.' + self.eventNamespace, _onResize);
        }

        if(self.settings.debug)
        {
            // LOG MATCH
            $(document).on(EVENTS.match + '.' + self.eventNamespace, function (evt, data)
            {
                console.info('=> Entering breakpoint: ' + data.query + '\n   Breakpoint position: ' + data.pos);

            });
            // LOG UNMATCH
            $(document).on(EVENTS.unmatch + '.' + self.eventNamespace, function (evt, data)
            {
                console.info('=> Leaving breakpoint: ' + data.query + '\n   Breakpoint position: ' + data.pos);
            });
        }
    }

    function _removeListener()
    {
        $(window).off('resize.' + self.eventNamespace);
        $(document).off(self.eventNamespace);
    }
    
    function _createPseudoElement()
    {
        self.settings.$container.append($mediaQueryIndicator);
    }

    function _removePseudoElement()
    {
        $mediaQueryIndicator.detach();
    }

    function _setInitialQuery()
    {
        activeQuery = $mediaQueryIndicator.css('font-family').replace(/["']/g, "");
        activeQueryPos = $.inArray(activeQuery, self.settings.queries);

        if (activeQueryPos === -1)
        {
            activeQuery = self.settings.fallbackQuery;
            activeQueryPos = $.inArray(activeQuery, self.settings.queries);
        }
    }

    function _onResize()
    {
        var newQuery = $mediaQueryIndicator.css('font-family').replace(/["']/g, ""),
            newQueryPos = $.inArray(newQuery, self.settings.queries);

        if (newQuery !== undefined && newQueryPos >= 0)
        {
            if (activeQuery !== newQuery)
            {
                if (activeQuery !== undefined)
                {
                    // trigger unmatch event
                    $(document).trigger(EVENTS.unmatch, {
                        query: activeQuery,
                        pos: activeQueryPos
                    });
                }
                // trigger match event
                $(document).trigger(EVENTS.match, {
                    query: newQuery,
                    pos: newQueryPos
                });
            }

            activeQuery = newQuery;
            activeQueryPos = newQueryPos;
        }

    }

    /**
     * Terminate class instance
     */
    function _terminate()
    {
        _removeListener();
        _removePseudoElement();
    }

    //endregion
    //------------------------------------------------------------------------------------------------------------------

    //region Privileged (public) functions
    // - with access to private variables and functions
    //------------------------------------------------------------------------------------------------------------------
    this.getCurrentMediaQuery = function ()
    {
        return {query: activeQuery, pos: activeQueryPos};
    };

    /**
     * Trigger private terminate function
     */
    this.destroy = function ()
    {
        _terminate();
    };
    //endregion
    //------------------------------------------------------------------------------------------------------------------
};(function ($, window, document, undefined) {
  'use strict';

  var moduleClass = 'm-72-content-navigation',
      contentNavigationController = undefined,
  // tweenmax scrollTo iOS10 bug
      scrollToAutoKill = false,
      $document = $(document),
      $window = $(window);

  //------------------------------------------------------------------------------------------------------------------
  //region EVENTS
  //------------------------------------------------------------------------------------------------------------------
  var EVENTS = {
    'moduleWaypointReached': 'm72_moduleWaypointReached',
    'updateArrowDirections': 'm72_updateArrowDirections',
    'dockResponse': 'm72_dockResponse',
    'refreshModule': 'm72_refreshModule',
    'rebuildModule': 'm72_rebuildModule',
    'openMenu': 'm72_openMenu',
    'closeMenu': 'm72_closeMenu'
  };
  //endregion

  $document.ready(function () {
    _repositionDOMElement();
    contentNavigationController = new ContentNavigationController({
      moduleClass: moduleClass
    });

    /**
     * DOM repositioning if specific condition occurs (legacy code)
     * @returns {boolean}
     * @private
     */
    function _repositionDOMElement()
    {
      var $element = $('.' + moduleClass).eq(0);

      if ($element === undefined || $element.length < 1) {
        return false;
      }

      //$element.detach();

      // Example: /models/911/911-turbo/concept/identity-911/
      if ($('.b-title-wrapper').length > 0)
      {
        $element.insertAfter('.b-title-wrapper:first');
      }
      // MSP 4.0 Example: /germany/models/cayenne/cayenne-models/
      else if ($('.m-080__modelseries-intro').length > 0) {
        $element.insertAfter('.m-080__modelseries-intro:first');
      }
      // Example: /models/911/911-turbo
      else if ($('.m-04-intro-section-model-slider-wrapper:not(.m-90-wrapper)').length > 0)
      {
        $element.insertAfter('.m-04-intro-section-model-slider-wrapper:first');
      }
      // Example: /germany/aboutporsche/christophorusmagazine/curentissue/
      else if ($('.m-04-intro-section-home-slider-wrapper').length > 0) {
        $element.insertAfter('.m-04-intro-section-home-slider-wrapper:first');
      }
      // Example: /accessoriesandservices/porscheservice/
      else if ($('.b-title-wrapper-inline').length > 0)
      {
        $element.insertAfter('.b-title-wrapper-inline:first');
      }
      else
      {
        return false;
      }

      return true;
    }
  });

  $window.load(function ()
  {
    if(contentNavigationController instanceof ContentNavigationController)
    {
      contentNavigationController.parsePageModules();
    }
  });

  //------------------------------------------------------------------------------------------------------------------
  //region CONTENT NAVIGATION CONTROLLER
  //------------------------------------------------------------------------------------------------------------------
  function ContentNavigationController(options)
  {
    var self = this,
        defaultOptions = {
          moduleClass: 'm-72-content-navigation',
          moduleAttributeName: 'm-02-cn-anchor',
          dockEventAttributeName: 'dock-event',
          maxModuleButtonCount: 0,
          ignoreModulesAfterClass: '',
          ignoreModulesAfterFirstDock: true
        },
        moduleState = {
          'NORMAL': 'm-72-cn-state-normal',
          'DOCKED': 'm-72-cn-state-docked',
          'DOCKED_ACTIVE': 'm-72-cn-state-docked-active'
        },
        activeState = moduleState['NORMAL'],
        uiClasses = {
          'sticky': 'm-72-cn-sticky',
          'stickyWrapper': 'm-72-cn-sticky-wrapper',
          'menu': 'm-72-cn-menu',
          'menuButton': 'm-72-cn-menu-button',
          'menuActive': 'm-72-cn-menu-active',
          'flyout': 'm-72-cn-menu-flyout',
          'moduleButtonList': 'm-72-cn-module-buttons',
          'moduleFlyoutList': 'm-72-cn-menu-flyout-modules',
          'positionInfo': 'm-72-cn-position-info',
          'positionInfoCopy': 'm-72-cn-position-info-copy',
          'dockButton': 'm-72-cn-dock-button',
          'dockButtonContent': 'm-72-cn-dock-button-content',
          'dockContent': 'm-72-cn-dock-content',
          'dockTitle': 'm-72-cn-dock-title',
          'dockTitleCopy': 'm-72-cn-dock-title-copy',
          'topLink': 'm-72-cn-top-link',
          'blueButtons': 'm-72-cn-blue-buttons'
        },
        $moduleLoaderTemplate = $('<div class="m-72-cn-module-loader-wrapper"><div class="m-72-cn-module-loader"></div></div>'),
        menuOpened = false,
        moduleItems = [],
        activeModuleIndex = -1,
        activeDockEventName = undefined,
        activeDockResponseId = undefined,
        moduleDocked = false;

    this.settings = {};
    this.eventNamespace = 'm72_contentNavigationController';

    this.dockTimeline = undefined;
    this.hoverTimer = undefined;

    _init();

    //region Private functions
    //------------------------
    function _init()
    {
      self.settings = {};
      self.settings = $.extend(true, {}, defaultOptions, options || {});
      self.$el = $('.' + self.settings.moduleClass).eq(0);

      if (self.$el === undefined || self.$el.length < 1) {
        return false;
      }

      _registerUiElements();
      _setListener();
      //_parsePageModules();
      _showModuleLoader();
      _initStickyWaypoint();
      _initTimelines();

      return true;
    }

    function _registerUiElements()
    {
      self.$menu = self.$el.find('.' + uiClasses['menu']).eq(0);
      self.$menuButton = self.$el.find('.' + uiClasses['menuButton']).eq(0);
      self.$flyout = self.$el.find('.' + uiClasses['flyout']).eq(0);
      self.$moduleButtonList = self.$el.find('.' + uiClasses['moduleButtonList']).eq(0);
      self.$moduleFlyoutList = self.$el.find('.' + uiClasses['moduleFlyoutList']).eq(0);
      self.$positionInfo = self.$el.find('.' + uiClasses['positionInfo']).eq(0);
      self.$positionInfoCopy = self.$el.find('.' + uiClasses['positionInfoCopy']).eq(0);
      self.$dockButton = self.$el.find('.' + uiClasses['dockButton']).eq(0);
      self.$dockButtonContent = self.$el.find('.' + uiClasses['dockButtonContent']).eq(0);
      self.$dockContent = self.$el.find('.' + uiClasses['dockContent']).eq(0);
      self.$dockTitle = self.$el.find('.' + uiClasses['dockTitle']).eq(0);
      self.$dockTitleCopy = self.$el.find('.' + uiClasses['dockTitleCopy']).eq(0);
      self.$topLink = self.$el.find('.' + uiClasses['topLink']);
      self.$blueButtons = self.$el.find('.' + uiClasses['blueButtons']).eq(0);
    }

    function _setListener()
    {
      self.$menuButton.on('click.' + self.eventNamespace, _onMenuButtonClick);
      self.$menu.on('mouseover.' + self.eventNamespace, _onMenuMouseOver);
      self.$menu.on('mouseout.' + self.eventNamespace, _onMenuMouseOut);
      self.$flyout.on('mouseover.' + self.eventNamespace, _onMenuMouseOver);
      self.$flyout.on('mouseout.' + self.eventNamespace, _onMenuMouseOut);
      self.$dockButton.on('click.' + self.eventNamespace, _onDockButtonClick);
      self.$topLink.on('click.' + self.eventNamespace, _onTopButtonClick);
      $document.on(EVENTS.moduleWaypointReached + '.' + self.eventNamespace, _onModuleWaypointReached);
      $document.on(EVENTS.updateArrowDirections + '.' + self.eventNamespace, _onUpdateArrowDirections);
      $document.on(EVENTS.dockResponse + '.' + self.eventNamespace, _onDockResponse);
      $document.on(EVENTS.refreshModule + '.' + self.eventNamespace, _onRefresh);
      $document.on(EVENTS.rebuildModule + '.' + self.eventNamespace, _onRebuild);
      $document.on(EVENTS.openMenu + '.' + self.eventNamespace, _onOpenMenu);
      $document.on(EVENTS.closeMenu + '.' + self.eventNamespace, _onCloseMenu);
    }

    function _removeListener()
    {
      self.$menuButton.off('.' + self.eventNamespace);
      self.$menu.off('.' + self.eventNamespace);
      self.$flyout.off('.' + self.eventNamespace);
      self.$dockButton.off('.' + self.eventNamespace);
      self.$topLink.off('.' + self.eventNamespace);
      $document.off('.' + self.eventNamespace);
    }

    function _initTimelines()
    {
      _initDockTimeline();
    }

    function _setModuleState(state)
    {
      if(!moduleState[state])
      {
        return;
      }

      self.$el.removeClass(activeState);
      activeState = moduleState[state];
      self.$el.addClass(activeState);
    }

    function _parsePageModules()
    {
      if(/models\/(718|911|panamera|macan|cayenne)/g.test(window.location.href))
      {
        _parsePageModulesQuickFix();
        return;
      }

      var $pageModules = $('div[data-' + self.settings.moduleAttributeName + '][data-' + self.settings.moduleAttributeName + '!=""]'),
          flyoutOnly = false,
          lastWaypointReached = false;

      _clearPageModules();
      _setPositionInfo('');

      $pageModules.each(function (index)
      {
        var $item = $(this),
            isLastWaypoint = ($item.hasClass(self.settings.ignoreModulesAfterClass) || (self.settings.ignoreModulesAfterFirstDock && $item.data(self.settings.dockEventAttributeName) !== undefined));

        if(lastWaypointReached)
        {
          isLastWaypoint = false;
        }

        if(index >= self.settings.maxModuleButtonCount || isLastWaypoint)
        {
          flyoutOnly = true;
        }

        moduleItems.push(new ModuleItem({
          $module: $item,
          $contentNavigation: self.$el,
          moduleIndex: index,
          attributeName: self.settings.moduleAttributeName,
          dockEventAttributeName: self.settings.dockEventAttributeName,
          flyoutOnly: flyoutOnly,
          handleWaypoint: !lastWaypointReached,
          waypointOffset: self.$el.outerHeight()
        }));
        moduleItems[index].activateWaypoint();

        self.$moduleButtonList.append(moduleItems[index].getModuleButton());
        self.$moduleFlyoutList.append(moduleItems[index].getModuleFlyoutItem());

        if(isLastWaypoint)
        {
          lastWaypointReached = true;
        }
      });
    }

    function _parsePageModulesQuickFix()
    {
      // TODO: QUICK FIX GO LIVE - REMOVE LATER

      var $pageModules = $('div[data-' + self.settings.moduleAttributeName + '][data-' + self.settings.moduleAttributeName + '!=""]'),
          flyoutOnly = false,
          lastWaypointReached = false;

      _clearPageModules();
      _setPositionInfo('');

      $pageModules.each(function (index)
      {
        var $item = $(this),
            isLastWaypoint = ($item.hasClass(self.settings.ignoreModulesAfterClass) || (self.settings.ignoreModulesAfterFirstDock && $item.data(self.settings.dockEventAttributeName) !== undefined));

        if(lastWaypointReached)
        {
          isLastWaypoint = false;
        }

        if(index >= self.settings.maxModuleButtonCount || isLastWaypoint)
        {
          flyoutOnly = true;
        }

        if(isLastWaypoint)
        {
          flyoutOnly = false;
        }

        if(index === 0)
        {
          flyoutOnly = true;
        }

        moduleItems.push(new ModuleItem({
          $module: $item,
          $contentNavigation: self.$el,
          moduleIndex: index,
          attributeName: self.settings.moduleAttributeName,
          dockEventAttributeName: self.settings.dockEventAttributeName,
          flyoutOnly: flyoutOnly,
          handleWaypoint: !lastWaypointReached,
          waypointOffset: self.$el.outerHeight()
        }));
        moduleItems[index].activateWaypoint();

        if(isLastWaypoint)
        {
          self.$moduleButtonList.prepend(moduleItems[index].getModuleButton());
        }else
        {
          self.$moduleButtonList.append(moduleItems[index].getModuleButton());
        }

        self.$moduleFlyoutList.append(moduleItems[index].getModuleFlyoutItem());

        if(isLastWaypoint)
        {
          lastWaypointReached = true;
        }

        if(index === 0)
        {
          flyoutOnly = false;
        }
      });
    }

    function _showModuleLoader()
    {
      _clearPageModules();

      self.$moduleFlyoutList.append($moduleLoaderTemplate);
    }

    function _clearPageModules()
    {
      for(var i = 0; i < moduleItems.length; i++)
      {
        if(moduleItems[i] instanceof ModuleItem)
        {
          moduleItems[i].destroy();
        }
      }

      moduleItems = [];
      self.$moduleButtonList.empty();
      self.$moduleFlyoutList.empty();
    }

    function _initStickyWaypoint()
    {
      _destroyStickyWaypoint();

      self.stickyWaypoint = new Waypoint.Sticky({
        element: self.$el,
        wrapper: '<div class="' + uiClasses['stickyWrapper'] + '"></div>',
        stuckClass: uiClasses['sticky']
      });
    }

    function _destroyStickyWaypoint()
    {
      if(self.stickyWaypoint instanceof Waypoint.Sticky)
      {
        self.stickyWaypoint.destroy();
        self.stickyWaypoint = undefined;
      }
    }

    function _openMenu()
    {
      self.$el.addClass(uiClasses['menuActive']);
      menuOpened = true;
    }

    function _closeMenu()
    {
      self.$el.removeClass(uiClasses['menuActive']);
      menuOpened = false;
    }

    function _setPositionInfo(text)
    {
      if(typeof text !== 'string')
      {
        return;
      }

      self.$positionInfoCopy.text(text);
    }

    function _setActiveModule(index)
    {
      _undockModule();

      if(index < 0 || !(moduleItems[index] instanceof ModuleItem))
      {
        activeModuleIndex = -1;
        _setPositionInfo('');
        activeDockEventName = undefined;
      }else
      {
        activeModuleIndex = index;
        _setPositionInfo(moduleItems[index].getModuleTitle());
        activeDockEventName = moduleItems[index].getDockEventName();
        _dockModule();
      }
    }

    function _disableModuleWaypoints()
    {
      for(var i = 0; i < moduleItems.length; i++)
      {
        if(moduleItems[i] instanceof ModuleItem)
        {
          moduleItems[i].disableWaypoint();
        }
      }
    }

    function _enableModuleWaypoints()
    {
      for(var i = 0; i < moduleItems.length; i++)
      {
        if(moduleItems[i] instanceof ModuleItem)
        {
          moduleItems[i].enableWaypoint();
        }
      }
    }

    function _initDockTimeline()
    {
      // reset and destroy existing timeline
      if(self.dockTimeline instanceof TimelineMax)
      {
        self.dockTimeline.kill();
        TweenMax.set(self.$menuButton, {clearProps: 'all'});
        TweenMax.set(self.$moduleButtonList, {clearProps: 'all'});
        TweenMax.set(self.$positionInfo, {clearProps: 'all'});
        TweenMax.set(self.$blueButtons, {clearProps: 'all'});
        TweenMax.set(self.$dockTitle, {clearProps: 'all'});
        TweenMax.set(self.$dockContent, {clearProps: 'all'});
      }

      self.dockTimeline = new TimelineMax({
        paused: true,
        onComplete: function ()
        {
          if(activeDockEventName)
          {
            $document.trigger(activeDockEventName, {
              type: 'opened'
            });
          }
        },
        onReverseComplete: function ()
        {
          if(activeDockEventName)
          {
            $document.trigger(activeDockEventName, {
              type: 'closed'
            });
          }
        }
      });

      self.dockTimeline.to(self.$menuButton, 0.2, {y: '-80px', autoAlpha: 0, ease: Power3.easeIn});
      self.dockTimeline.to(self.$moduleButtonList, 0.2, {y: '-80px', autoAlpha: 0, ease: Power3.easeIn}, "-=0.2");
      self.dockTimeline.to(self.$positionInfo, 0.2, {y: '-80px', autoAlpha: 0, ease: Power3.easeIn}, "-=0.2");
      self.dockTimeline.to(self.$blueButtons, 0.2, {y: '-80px', autoAlpha: 0, ease: Power3.easeIn}, "-=0.2");
      self.dockTimeline.add(function ()
      {
        if(activeState === moduleState['DOCKED'])
        {
          _setModuleState('DOCKED_ACTIVE');
        }
        else if(activeState === moduleState['DOCKED_ACTIVE'])
        {
          _setModuleState('DOCKED');
        }
      });
      self.dockTimeline.from(self.$dockTitle, 0.2, {y: '-80px', autoAlpha: 0, ease: Power3.ease});
      self.dockTimeline.from(self.$dockContent, 0.4, {y: '-100%', ease: Power1.easeIn}, "-=0.1");
    }

    function _dockModule()
    {
      if(!activeDockEventName)
      {
        return;
      }

      activeDockResponseId = getGuid();

      $document.trigger(activeDockEventName, {
        type: 'dock',
        responseEventName: EVENTS.dockResponse,
        responseId: activeDockResponseId
      });
    }

    function _undockModule()
    {
      if(!moduleDocked)
      {
        return;
      }

      if(self.dockWaypoint instanceof Waypoint)
      {
        self.dockWaypoint.destroy();
        self.dockWaypoint = undefined;
      }

      $document.trigger(activeDockEventName, {
        type: 'undock'
      });

      if(self.dockTimeline)
      {
        self.dockTimeline.pause(0);
      }

      self.$dockButtonContent.empty();
      self.$dockContent.empty();
      self.$dockTitleCopy.text('');

      _setModuleState('NORMAL');
      moduleDocked = false;
    }

    function _onDockResponse(evt, data)
    {
      /*{
       responseId: 1234,
       $buttonContent: $(),
       $dockContent: $(),
       dockAnchor: '',
       dockTitle: 'Car Select'
       }*/

      if(!data || data.responseId !== activeDockResponseId)
      {
        return;
      }

      if(typeof data.dockTitle !== 'string')
      {
        data.dockTitle = moduleItems[activeModuleIndex].getModuleTitle();
      }

      self.$dockButtonContent.html(data.$buttonContent);
      self.$dockContent.html(data.$dockContent);
      self.$dockTitleCopy.text(data.dockTitle);

      $document.trigger(activeDockEventName, {
        type: 'active'
      });

      if(data.dockAnchor && typeof data.dockAnchor === 'string')
      {
        data.dockAnchor = $(data.dockAnchor);
      }
      if(!(data.dockAnchor instanceof $) || data.dockAnchor.length < 1)
      {
        data.dockAnchor = undefined;
      }

      _disableModuleWaypoints();
      if(data.dockAnchor)
      {
        self.dockWaypoint = new Waypoint({
          element: data.dockAnchor.eq(0),
          offset: self.$el.outerHeight(),
          handler: _onDockWaypointReached
        });

        //if(self.rebuilding)
        if(($window.scrollTop() + self.$el.outerHeight()) >= $(data.dockAnchor).eq(0).offset().top)
        {
          // TODO WAYPOINT NOT TRIGGERING ON REFRESH INITIALY -- CHECK IF IN VIEW
          _onDockWaypointReached('down');
        }
      }else
      {
        if(self.lastState === moduleState['DOCKED_ACTIVE'])
        {
          _setModuleState('DOCKED_ACTIVE');

          if(self.dockTimeline)
          {
            self.dockTimeline.pause(self.dockTimeline.duration());
          }

          $document.trigger(activeDockEventName, {
            type: 'opened'
          });

          self.lastState = undefined;
        } else
        {
          _setModuleState('DOCKED');
        }
      }
      _enableModuleWaypoints();

      moduleDocked = true;
      activeDockResponseId = undefined;
    }

    function _onDockWaypointReached(direction)
    {
      if(direction === 'up')
      {
        if(self.dockTimeline)
        {
          self.dockTimeline.pause(0);
        }

        _setModuleState('NORMAL');

      }else
      {
        if(self.lastState === moduleState['DOCKED_ACTIVE'])
        {
          _setModuleState('DOCKED_ACTIVE');

          if(self.dockTimeline)
          {
            self.dockTimeline.pause(self.dockTimeline.duration());
          }

          $document.trigger(activeDockEventName, {
            type: 'opened'
          });

          self.lastState = undefined;
        } else
        {
          _setModuleState('DOCKED');
        }
      }
    }

    function _onUpdateArrowDirections(evt, data)
    {
      if(data.direction === 'up')
      {
        data.moduleIndex -= 1;
      }

      for(var i = 0; i < moduleItems.length; i++)
      {
        if(i < data.moduleIndex)
        {
          moduleItems[i].switchArrowDirection('up');
        }else if(i > data.moduleIndex)
        {
          moduleItems[i].switchArrowDirection('down');
        }else
        {
          moduleItems[i].switchArrowDirection();
        }
      }
    }

    function _onMenuButtonClick(evt)
    {
      evt.preventDefault();

      if(menuOpened)
      {
        _closeMenu();
      }else
      {
        _openMenu();
      }
    }

    function _onMenuMouseOver(evt)
    {
      if(Modernizr.touch)
      {
        return;
      }

      clearTimeout(self.hoverTimer);
      _openMenu();
    }

    function _onMenuMouseOut(evt)
    {
      if(Modernizr.touch)
      {
        return;
      }

      self.hoverTimer = setTimeout(_closeMenu, 10);
    }

    function _onTopButtonClick(evt)
    {
      evt.preventDefault();

      if(menuOpened)
      {
        _closeMenu();
      }else
      {
        _openMenu();
      }

      TweenMax.to($window, 1, {scrollTo: {y: 0, autoKill: scrollToAutoKill}});
    }

    function _onDockButtonClick(evt)
    {
      evt.preventDefault();

      if(!self.dockTimeline)
      {
        if(activeState === moduleState['DOCKED'])
        {
          _closeMenu();
          _setModuleState('DOCKED_ACTIVE');
          $document.trigger(activeDockEventName, {
            type: 'opened'
          });
        }
        else if(activeState === moduleState['DOCKED_ACTIVE'])
        {
          _setModuleState('DOCKED');
          $document.trigger(activeDockEventName, {
            type: 'closed'
          });
        }

        return;
      }

      self.dockTimeline.pause();

      if(activeState === moduleState['DOCKED'])
      {
        _closeMenu();
        self.dockTimeline.play();
      }
      else if(activeState === moduleState['DOCKED_ACTIVE'])
      {
        self.dockTimeline.reverse();

      }
    }

    function _onModuleWaypointReached(evt, data)
    {
      if(data.direction === 'up')
      {
        _setActiveModule(data.moduleIndex - 1);
      }else
      {
        _setActiveModule(data.moduleIndex);
      }
    }

    function _onRefresh(evt)
    {
      Waypoint.refreshAll();
    }

    function _onRebuild(evt)
    {
      self.lastState = activeState;
      self.rebuilding = true;

      _terminate();
      _init();
      _parsePageModules();
    }

    function _onOpenMenu(evt)
    {
      _openMenu();
    }

    function _onCloseMenu(evt)
    {
      _closeMenu();
    }

    function _terminate()
    {
      _undockModule();
      _clearPageModules();
      _destroyStickyWaypoint();
      _removeListener();
    }
    //endregion

    //region Privileged (public) functions
    //------------------------------------
    this.parsePageModules = function ()
    {
      if (self.$el === undefined || self.$el.length < 1) {
        return false;
      }

      _parsePageModules();
    };

    this.destroy = function ()
    {
      _terminate();
    };
    //endregion
  }
  //endregion

  //------------------------------------------------------------------------------------------------------------------
  //region MODULE ITEM
  //------------------------------------------------------------------------------------------------------------------
  function ModuleItem(options)
  {
    var self = this,
        defaultOptions = {
          $module: $(),
          $contentNavigation: $(),
          moduleIndex: -1,
          attributeName: '',
          dockEventAttributeName: '',
          flyoutOnly: false,
          handleWaypoint: true,
          waypointOffset: 0
        },
        uiClasses = {
          'buttonLink': 'm-72-cn-module-button-link',
          'buttonCopy': 'm-72-cn-module-button-copy',
          'flyoutItemLink': 'm-72-cn-menu-flyout-item-link',
          'flyoutItemCopy': 'm-72-cn-menu-flyout-item-copy',
          'showForLarge': 'm-72-cn-show-for-large',
          'iconUp': 'm-72-cn-arrow-up',
          'iconDown': 'm-72-cn-arrow-down'
        },
        moduleTemplateButton = '<li class="m-72-cn-module-button"><a href="#" class="m-72-cn-module-button-link"><span class="m-72-cn-module-button-copy"></span></a></li>',
        moduleTemplateFlyoutItem = '<li class="m-72-cn-menu-flyout-item"><a href="#" class="m-72-cn-menu-flyout-item-link m-72-cn-arrow-down"><div class="m-72-cn-menu-flyout-item-copy-wrapper"><span class="m-72-cn-menu-flyout-item-copy"></span></div></a></li>',
        $moduleButton = $(),
        $moduleFlyoutItem = $(),
        anchorId = '',
        moduleTitle = '',
        dockEventName = undefined;

    this.settings = {};
    this.eventNamespace = 'm72_moduleItem';

    _init();

    //region Private functions
    //------------------------
    function _init()
    {
      self.settings = {};
      self.settings = $.extend(true, {}, defaultOptions, options || {});

      _registerUiElements();
      _render();
      _setListener();
      //_initWaypoint();
    }

    function _registerUiElements()
    {
      $moduleButton = $(moduleTemplateButton);
      $moduleFlyoutItem = $(moduleTemplateFlyoutItem);

      self.$buttonLink = $moduleButton.find('.' + uiClasses['buttonLink']);
      self.$buttonCopy = $moduleButton.find('.' + uiClasses['buttonCopy']);
      self.$flyoutItemLink = $moduleFlyoutItem.find('.' + uiClasses['flyoutItemLink']);
      self.$flyoutItemCopy = $moduleFlyoutItem.find('.' + uiClasses['flyoutItemCopy']);
    }

    function _render()
    {
      anchorId = self.settings.$module.attr('id');
      moduleTitle = self.settings.$module.data(self.settings.attributeName);
      dockEventName = self.settings.$module.data(self.settings.dockEventAttributeName);

      // assign random ID if element doesn't have one
      if (typeof(anchorId) === 'undefined')
      {
        anchorId = 'M-' + getGuid();
        self.settings.$module.attr('id', anchorId);
      }

      self.$buttonLink.attr('href', '#' + anchorId);
      self.$flyoutItemLink.attr('href', '#' + anchorId);

      self.$buttonCopy.text(moduleTitle);
      self.$flyoutItemCopy.text(moduleTitle);

      if(self.settings.flyoutOnly)
      {
        $moduleFlyoutItem.addClass(uiClasses['showForLarge']);
      }
    }

    function _setListener()
    {
      self.$buttonLink .on('click.' + self.eventNamespace, _onModuleButtonClick);
      self.$flyoutItemLink.on('click.' + self.eventNamespace, _onModuleFlyoutItemClick);
    }

    function _removeListener()
    {
      $moduleButton.off('click.' + self.eventNamespace);
      $moduleFlyoutItem.off('click.' + self.eventNamespace);
    }

    function _initWaypoint()
    {
      _destroyWaypoint();

      self.waypoint = new Waypoint({
        element: self.settings.$module,
        offset: self.settings.$contentNavigation.height(),
        handler: _onWaypointReached
      });
    }

    function _destroyWaypoint()
    {
      if(self.waypoint instanceof Waypoint)
      {
        self.waypoint.destroy();
        self.waypoint = undefined;
      }
    }

    function _onWaypointReached(direction)
    {
      $document.trigger(EVENTS.updateArrowDirections, {
        direction: direction,
        moduleIndex: self.settings.moduleIndex
      });

      if(!self.settings.handleWaypoint)
      {
        return;
      }

      $document.trigger(EVENTS.moduleWaypointReached, {
        direction: direction,
        moduleIndex: self.settings.moduleIndex,
        moduleTitle: moduleTitle,
        moduleId: anchorId
      });
    }

    function _onModuleButtonClick(evt)
    {
      var anchor = $(evt.currentTarget).attr('href');

      evt.preventDefault();
      TweenMax.to($window, 1, {scrollTo: {y: anchor, offsetY: self.settings.$contentNavigation.height(), autoKill: scrollToAutoKill}});
    }

    function _onModuleFlyoutItemClick(evt)
    {
      var anchor = $(evt.currentTarget).attr('href');

      evt.preventDefault();
      $document.trigger(EVENTS.closeMenu);
      TweenMax.to($window, 1, {scrollTo: {y: anchor, offsetY: self.settings.$contentNavigation.height(), autoKill: scrollToAutoKill}});
    }

    function _terminate()
    {
      _destroyWaypoint();
      _removeListener();
    }
    //endregion

    //region Privileged (public) functions
    //------------------------------------
    this.getModuleButton = function ()
    {
      if(self.settings.flyoutOnly)
      {
        return $();
      }

      return $moduleButton;
    };

    this.getModuleFlyoutItem = function ()
    {
      return $moduleFlyoutItem;
    };

    this.getDockEventName = function ()
    {
      return dockEventName;
    };

    this.getModuleTitle = function ()
    {
      return moduleTitle;
    };

    this.activateWaypoint = function ()
    {
      _initWaypoint();
    };

    this.disableWaypoint = function ()
    {
      if(self.waypoint instanceof Waypoint)
      {
        self.waypoint.disable();
      }
    };

    this.enableWaypoint = function ()
    {
      if(self.waypoint instanceof Waypoint)
      {
        self.waypoint.enable();
      }
    };

    this.switchArrowDirection = function (direction)
    {
      switch(direction)
      {
        case 'up':
          self.$flyoutItemLink.removeClass(uiClasses.iconDown);
          self.$flyoutItemLink.addClass(uiClasses.iconUp);
          break;
        case 'down':
          self.$flyoutItemLink.removeClass(uiClasses.iconUp);
          self.$flyoutItemLink.addClass(uiClasses.iconDown);
          break;
        default:
          self.$flyoutItemLink.removeClass(uiClasses.iconUp);
          self.$flyoutItemLink.removeClass(uiClasses.iconDown);
      }
    };

    this.destroy = function ()
    {
      _terminate();
    };
    //endregion
  }
  //endregion

  var guidCounter = 0;
  function getGuid()
  {
    var finalGuid = Math.random().toString(36).substring(2, 15) + '-' + guidCounter;

    guidCounter++;
    return finalGuid;
  }

})(jQuery, this, this.document);/* global jQuery, Backbone, ModuleBaseView, IntersectionObserver, TweenMax, Modernizr, Power1 */
(function ($, window, document) {
  'use strict';

  var moduleClass = 'm-172-content-navigation';
  var ModuleView;
  var moduleInstances = [];

  $(document).ready(function () {
    _lazyInit(false);
  });

  $(document).on('m172_rebuildModule', function () {
    _lazyInit(true);
  });

  function _lazyInit (reInit) {
    reInit = reInit === true;

    $('.' + moduleClass).each(function (i, el) {
      var $el = $(el);

      if (reInit === false && window.pageController) {
        $el.one(window.pageController.eventNames.lazyInit, function () {
          _init(i, $el);
          window.pageController.refresh();
        });
      } else {
        _init(i, $el, reInit);
      }
    });
  }

  function _init (i, $el, reInit) {
    var modelData = $el.data('model');
    var model = new Backbone.Model(modelData || {});

    if (reInit === true) {
      moduleInstances[i].reinit();
    } else {
      moduleInstances[i] = new ModuleView({
        el: $el,
        model: model
      });

      moduleInstances[i].render();
    }

    $el.attr('data-dynmod-reloaded', 'false');
  }

  ModuleView = ModuleBaseView.extend({
    namespace: 'm-172',

    events: {
      'click .m-172__title': '_backToTop',
      'click .m-172__content-item': '_anchorClicked',
      'click .m-172__content-bar-arrow--left': '_leftArrowClicked',
      'click .m-172__content-bar-arrow--right': '_rightArrowClicked',
      'mousemove .m-172__mouse-area': '_mouseAreaTriggered',
      'mousemove': '_mouseover',
      'mouseout': '_mouseout',
      'touchmove': '_triggerTimeout'
    },

    uiClasses: {
      homeSlider: 'm-04-intro-section-home-slider',
      normalSlider: 'm-04-intro-section-model-slider',
      mainNavigation: 'm-01-main-navigation',
      header: 'm-00-header',
      title: 'm-172__title',
      hasLessThanFourAnchors: 'm-172--has-less-than-four-anchors',
      m02Anchor: 'm-02-cn-anchor',
      navigationIsTriggered: 'm-172-content-navigation--is-triggered',
      overflowWrapper: 'm-172__overflow-wrapper',
      barsWrapper: 'm-172__bars-wrapper',
      contentItems: 'm-172__content-item',
      active: 'm-172--active',
      contentBarWrapper: 'm-172__content-bar-wrapper',
      contentBar: 'm-172__content-bar',
      scrollWrapper: 'm-172__scroll-wrapper',
      showArrows: 'm-172__content-bar--show-arrows',
      leftArrow: 'm-172__content-bar-arrow--left',
      rightArrow: 'm-172__content-bar-arrow--right',
      hideArrow: 'm-172__content-bar-arrow--hide'
    },

    initialize: function (options) {
      ModuleBaseView.prototype.initialize.apply(this, [options]);
        
      this._isSmallVersion = window.matchMediaQuery.getCurrentMediaQuery().pos < 2;
      this._stickyTimeout = undefined;
      this._lastNextScrollPosition = 0;
      this._scrollToAutoKill = false; // tweenmax scrollTo iOS10 bug
      this._showContentNavi = false;
      this._navigationHeight = 110;
      this._backToTopClicked = false;
      this._anchorClicked = false;
      this._contentItemClicked = false;
      this._firstTimeVisible = false;
      this._firstTimeHidden = false;
      this._isActive = false;
      this._isTopAnimationActive = false;
      this._isMouseOut = true;

      this._setAnchors();

      // Scroll + changePageTitle
      $('<div class="m-172__mouse-area"></div>').appendTo(this.$el.find('.m-172__overflow-wrapper'));
      this._initScroll();
      $(document).off('m172_changePageTitle').on('m172_changePageTitle', this._changePageTitle.bind(this));
    },

    reinit: function () {
      $('.' + this.uiClasses.contentBarWrapper).remove();
      this._setAnchors();
      this.render();
    },

    render: function () {
      ModuleBaseView.prototype.render.apply(this, arguments);

      // Fill template
      this._barsWrapper = $('.' + this.uiClasses.barsWrapper, this.$el);
      var anchors = this.model.get('anchors');
      if (anchors.length >= 4) {
        this._barsWrapper.append(this._inlineHBSTemplate(this.model));
      } else {
        this._barsWrapper.addClass(this.uiClasses.hasLessThanFourAnchors);
      }

      this._title = $('.' + this.uiClasses.title, this.$el);
      this._overflowWrapper = $('.' + this.uiClasses.overflowWrapper, this.$el);
      this._contentItems = $('.' + this.uiClasses.contentItems, this.$el);
      this._contentBarWrapper = $('.' + this.uiClasses.contentBarWrapper, this.$el);
      this._contentBar = $('.' + this.uiClasses.contentBar, this.$el);
      this._scrollWrapper = $('.' + this.uiClasses.scrollWrapper, this.$el);
      this._leftArrow = $('.' + this.uiClasses.leftArrow, this.$el);
      this._rightArrow = $('.' + this.uiClasses.rightArrow, this.$el);

      this._observeSticky();
      this._observeAnchorModules();
      this._showArrows();
    },

    _setAnchors: function () {
      this._validModules = $('*[data-' + this.uiClasses.m02Anchor + ']');

      var self = this;
      this.model.set('anchors', this._validModules.map(function () {
        return $(this).attr('data-' + self.uiClasses.m02Anchor);
      }).get());
    },

    _changePageTitle: function (evt, data) {
      if (data !== undefined && data.pageTitle !== undefined && data.pageTitle.length > 0) {
        this._title.html(data.pageTitle);
      }
    },

    _initScrollBarWrapperMax: function () {
      TweenMax.set(this._contentBar, {
        scrollTo: {
          x: 0,
          autoKill: this._scrollToAutoKill
        }
      });
      this._showArrows();
      this._highlightAnchorIndex(0);
    },

    _backToTop: function (ev) {
      ev.preventDefault();

      this._backToTopClicked = true;
      this._anchorClicked = true;
      this._contentItemClicked = true;

      this._setVisibility(false);
      this._scollToIndex(-1);
    },

    _leftArrowClicked: function (ev) {
      ev.preventDefault();
      this._arrowClicked(false);
    },

    _rightArrowClicked: function (ev) {
      ev.preventDefault();
      this._arrowClicked(true);
    },

    _arrowClicked: function (rightDirection) {
      var nextScrollPosition = this._contentBar.scrollLeft();
      nextScrollPosition += rightDirection ? 300 : -300;
      this._scrollContentBar(nextScrollPosition);
    },

    _getMaxContentBarScrollOffset: function () {
      return this._scrollWrapper.width() - this._contentBarWrapper.width();
    },

    _checkScrollModulesList: function (index) {
      if (this._contentBarWrapper.length && index >= 0 && !this._anchorClicked && !this._isTopAnimationActive) {
        var mobileLeftOffset = 0;
        var mobileRightOffet = 0;
        for (var i = 0; i <= index; i++) {
          mobileLeftOffset = mobileRightOffet;
          mobileRightOffet += this._contentItems.eq(i).outerWidth(true);
        }

        var nextScrollPosition = undefined;
        if (!this._isSmallVersion) {
          var scrollLeft = this._contentBar.scrollLeft();
          var scrollWidth = this._contentBar.width();
          var scrollRight = scrollLeft + scrollWidth;

          // Check linke Position
          if (mobileLeftOffset < scrollLeft) {
            nextScrollPosition = mobileLeftOffset - 20;
          }

          if (mobileRightOffet > scrollRight) {
            var rightScrollXNeeded = mobileRightOffet - scrollRight;
            nextScrollPosition = scrollLeft + rightScrollXNeeded + 20;
          }
        } else {
          nextScrollPosition = mobileLeftOffset - 20;
        }

        if (nextScrollPosition !== undefined) {
          this._scrollContentBar(nextScrollPosition);
        }
      }
    },

    _scrollContentBar: function (nextScrollPosition) {
      // Bounds setzen
      nextScrollPosition = Math.max(nextScrollPosition, 0);
      if (!this._isSmallVersion) {
        nextScrollPosition = Math.min(nextScrollPosition, this._getMaxContentBarScrollOffset());
      }

      if (this._lastNextScrollPosition !== nextScrollPosition) {
        this._lastNextScrollPosition = nextScrollPosition;
        TweenMax.to(this._contentBar, !this._isTopAnimationActive && this._isActive ? 0.5 : 0, {
          scrollTo: {
            x: nextScrollPosition,
            autoKill: this._scrollToAutoKill
          }
        });

        this._showArrows(nextScrollPosition);
      }
    },

    _showArrows: function (nextScrollLeft) {
      if (!Modernizr.touch) {
        var scrollLeft = nextScrollLeft !== undefined ? nextScrollLeft : this._contentBar.scrollLeft();

        // Linken Pfeil anzeigen/verstecken
        if (scrollLeft > 0) {
          this._leftArrow.removeClass(this.uiClasses.hideArrow);
          TweenMax.to(this._leftArrow, 0.3, {
            opacity: 1
          });
        } else {
          this._leftArrow.addClass(this.uiClasses.hideArrow);
          TweenMax.to(this._leftArrow, 0.3, {
            opacity: 0
          });
        }
          
        // Rechten Pfeil anzeigen/verstecken
        if (scrollLeft < this._getMaxContentBarScrollOffset()) {
          this._rightArrow.removeClass(this.uiClasses.hideArrow);
          TweenMax.to(this._rightArrow, 0.3, {
            opacity: 1
          });
        } else {
          this._rightArrow.addClass(this.uiClasses.hideArrow);
          TweenMax.to(this._rightArrow, 0.3, {
            opacity: 0
          });
        }
      }
    },

    _anchorClicked: function (ev) {
      ev.preventDefault();

      this._anchorClicked = true;
      this._contentItemClicked = true;
      this._scollToIndex($(ev.currentTarget).index());
    },

    _scollToIndex: function (index) {
      var self = this;
      var anchor = 0;
      var offsetY = 0;

      if (index > -1) {
        anchor = this._validModules.eq(index);
        offsetY = this._navigationHeight - (this._isSmallVersion ? 10 : 20);
      }

      self._highlightAnchorIndex(index);

      TweenMax.to(window, 0.5, {
        scrollTo: {
          y: anchor,
          offsetY: offsetY,
          autoKill: self._scrollToAutoKill
        },
        onComplete: function () {
          if (Modernizr.touch && self._contentItemClicked) {
            self._triggerTimeout();
          }

          self._contentItemClicked = false;

          if (index < 0) {
            self._initScrollBarWrapperMax();
          } else  {
            self._checkScrollModulesList(index);
          }
        }
      });
    },

    _observeSticky: function () {
      var stickyTriggers = [];
      if ($('.navigation-topbar-mobile').length && $('.navigation-topbar-mobile').css('display') !== 'none') {
        stickyTriggers.push('.navigation-topbar-mobile__crest');
      }

      if ($('.m-01-sub-menu').length && $('.m-01-sub-menu').css('display') !== 'none') {
        stickyTriggers.push('#m-01-shopping-tools-link');
      }

      stickyTriggers.push('.m-01-main-navigation');
      stickyTriggers.push('.m-00-header');

      var mainStickyTrigger;
      for (var i = 0; i < stickyTriggers.length; i++) {
        var possibleStickyTrigger = $(stickyTriggers[i]);

        if (possibleStickyTrigger.length && possibleStickyTrigger.css('display') !== 'none' && possibleStickyTrigger.height() > 0) {
          mainStickyTrigger = possibleStickyTrigger;
          break;
        }
      }

      if (this._stickyObserver !== undefined) {
        this._stickyObserver.disconnect();
      }

      var self = this;
      this._stickyObserver = new IntersectionObserver(function (entries, observer) {
        $.each(entries, function () {
          var entry = this;

          var isActive = !entry.isIntersecting;
          self._showContentNavi = isActive;

          // Wieder oben an der Stage angelangt, reset
          if (isActive) {
            self._firstTimeVisible = false;
            self._firstTimeHidden = false;

            self.$el.addClass(self.uiClasses.navigationIsTriggered);
          } else {
            self.$el.removeClass(self.uiClasses.navigationIsTriggered);
          }

          self._setVisibility(isActive);
        });
      });
      this._stickyObserver.POLL_INTERVAL = 10;

      this._stickyObserver.observe(mainStickyTrigger.get(0));
    },

    _observeAnchorModules: function () {
      var options = {
        threshold: 0,
        rootMargin: this._isSmallVersion ? '-' + (this._navigationHeight + 25) + 'px' : '-' + 2 * this._navigationHeight + 'px'
      };

      var currentElementsInViewport = [];
      var self = this;

      if (this._anchorModulesObserve !== undefined) {
        this._anchorModulesObserve.disconnect();
      }

      this._anchorModulesObserve = new IntersectionObserver(function (entries, observer) {
        $.each(entries, function () {
          var entry = this;
          var intersectedIndex = self._validModules.index(entry.target);

          if (entry.isIntersecting) {
            if (currentElementsInViewport.indexOf(intersectedIndex) === -1) {
              currentElementsInViewport.push(intersectedIndex);
            }
          } else {
            if (currentElementsInViewport.indexOf(intersectedIndex) !== -1) {
              currentElementsInViewport.splice(currentElementsInViewport.indexOf(intersectedIndex), 1);
            }
          }

          currentElementsInViewport.sort(function (a, b) { return a - b; });
        });

        if (!self._contentItemClicked) {
          self._highlightAnchorIndex(currentElementsInViewport.length ? currentElementsInViewport[0] : -1);
        }
      }, options);
      this._anchorModulesObserve.POLL_INTERVAL = 10;

      $.each(this._validModules, function () {
        self._anchorModulesObserve.observe(this);
      });
    },

    _highlightAnchorIndex: function (index) {
      if (index < 0) {
        this._contentItems.removeClass(this.uiClasses.active);
      } else {
        this._contentItems.eq(index).addClass(this.uiClasses.active).siblings().removeClass(this.uiClasses.active);
      }

      this._checkScrollModulesList(index);
    },

    _initScroll: function () {
      var lastScrollTop = 0;
      var scrollTimeout;
      var throttle = 50;
      var self = this;

      $(window).off('scroll.' + this.namespace).on('scroll.' + this.namespace, function (event) {
        if (scrollTimeout === undefined) {
          var scrollSelf = this;

          scrollTimeout = setTimeout(function () {
            var scrollTop = $(scrollSelf).scrollTop();

            // Wenn nach oben gescrollt wurde, direkt anzeigen
            if (!self._backToTopClicked) {
              if (self._showContentNavi && scrollTop < lastScrollTop) {
                self._anchorClicked = false;
                self._setVisibility(true);
              } else if (!self._anchorClicked && self._firstTimeHidden && scrollTop > lastScrollTop) {
                self._setVisibility(false);
              }
            }

            lastScrollTop = scrollTop;

            scrollTimeout = undefined;
          }, throttle);
        }
      });
    },

    _setVisibility: function (isVisible) {
      if (isVisible && this._isActive) {
        this._triggerTimeout();
        return;
      }

      if (isVisible && this._showContentNavi && !this._isActive) {
        this._isTopAnimationActive = false;
        this._isActive = true;

        TweenMax.to(this._overflowWrapper, 0.5, {
          ease: Power1.easeOut,
          transform: 'translate3d(0, 0, 0)'
        });
        this._triggerTimeout();
      } else if ((this._isMouseOut || this._backToTopClicked) && !this._isTopAnimationActive && this._isActive) {
        this._isActive = false;
        this._isTopAnimationActive = true;

        var self = this;
        TweenMax.to(this._overflowWrapper, 0.5, {
          ease: Power1.easeIn,
          transform: 'translate3d(0, -' + this._navigationHeight + 'px, 0)',
          onComplete: function () {
            self._isTopAnimationActive = false;

            if (self._backToTopClicked) {
              self._clearTimeout();
              self._anchorClicked = false;
              self._backToTopClicked = false;
            }
          }
        });
      }
    },

    _mouseAreaTriggered: function () {
      this._setVisibility(true);
    },

    _mouseover: function () {
      if (!Modernizr.touch) {
        this._isMouseOut = false;

        clearTimeout(this._stickyTimeout);
      }
    },

    _mouseout: function () {
      this._isMouseOut = true;

      this._triggerTimeout();
    },

    _clearTimeout: function () {
      clearTimeout(this._stickyTimeout);
    },

    _triggerTimeout: function () {
      var timeout = this._anchorClicked ? 1000 : 5000;

      if (!this._firstTimeVisible || this._showContentNavi) {
        var self = this;

        if (!this._firstTimeHidden) {
          this._firstTimeVisible = true;

          this._clearTimeout();

          this._stickyTimeout = setTimeout(function () {
            self._setVisibility(false);

            self._anchorClicked = false;

            self._firstTimeVisible = false;
            self._firstTimeHidden = true;
          }, timeout);
        } else {
          this._clearTimeout();

          this._stickyTimeout = setTimeout(function () {
            self._setVisibility(false);

            self._anchorClicked = false;
          }, timeout);
        }
      }
    },

    _inlineHBSTemplate: function (contentNavigationModel) {
      var anchors = contentNavigationModel.get('anchors');
      var contentItems = '';
      for (var anchor in anchors) {
        contentItems += '<div class="m-172__content-item gui-link">' + anchors[anchor] + '</div>';
      }

      return '' +
        '<div class="m-172__content-bar-wrapper content-full-width">' +
            '<div class="m-172__content-bar-arrow m-172__content-bar-arrow--left gui-link"></div>' +
                '<div class="m-172__content-bar b-overflow-item b-flex--row">' +
                    '<div class="m-172__scroll-wrapper">' +
                        contentItems +
                    '</div>' +
                '</div>' +
            '<div class="m-172__content-bar-arrow m-172__content-bar-arrow--right gui-link"></div>' +
        '</div>';
    },

    destroy: function () {
      ModuleBaseView.prototype.destroy.apply(this, arguments);
    }
  });
})(jQuery, this, this.document);
// jquery.royalslider v9.4.92
(function(l){function t(b,f){var c,g,a=this,e=navigator.userAgent.toLowerCase();a.uid=l.rsModules.uid++;a.ns=".rs"+a.uid;var d=document.createElement("div").style,j=["webkit","Moz","ms","O"],h="",k=0;for(c=0;c<j.length;c++)g=j[c],!h&&g+"Transform"in d&&(h=g),g=g.toLowerCase(),window.requestAnimationFrame||(window.requestAnimationFrame=window[g+"RequestAnimationFrame"],window.cancelAnimationFrame=window[g+"CancelAnimationFrame"]||window[g+"CancelRequestAnimationFrame"]);window.requestAnimationFrame||
(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),c=Math.max(0,16-(b-k)),d=window.setTimeout(function(){a(b+c)},c);k=b+c;return d});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});a.isIPAD=e.match(/(ipad)/);j=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||0>e.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];c=j[1]||"";g=j[2]||"0";
j={};c&&(j[c]=!0,j.version=g);j.chrome&&(j.webkit=!0);a._a=j;a.isAndroid=-1<e.indexOf("android");a.slider=l(b);a.ev=l(a);a._b=l(document);a.st=l.extend({},l.fn.royalSlider.defaults,f);a._c=a.st.transitionSpeed;a._d=0;if(a.st.allowCSS3&&(!j.webkit||a.st.allowCSS3OnWebkit))e=h+(h?"T":"t"),a._e=e+"ransform"in d&&e+"ransition"in d,a._e&&(a._f=h+(h?"P":"p")+"erspective"in d);h=h.toLowerCase();a._g="-"+h+"-";a._h="vertical"===a.st.slidesOrientation?!1:!0;a._i=a._h?"left":"top";a._j=a._h?"width":"height";
a._k=-1;a._l="fade"===a.st.transitionType?!1:!0;a._l||(a.st.sliderDrag=!1,a._m=10);a._n="z-index:0; display:none; opacity:0;";a._o=0;a._p=0;a._q=0;l.each(l.rsModules,function(b,c){"uid"!==b&&c.call(a)});a.slides=[];a._r=0;(a.st.slides?l(a.st.slides):a.slider.children().detach()).each(function(){a._s(this,!0)});a.st.randomizeSlides&&a.slides.sort(function(){return 0.5-Math.random()});a.numSlides=a.slides.length;a._t();a.st.startSlideId?a.st.startSlideId>a.numSlides-1&&(a.st.startSlideId=a.numSlides-
1):a.st.startSlideId=0;a._o=a.staticSlideId=a.currSlideId=a._u=a.st.startSlideId;a.currSlide=a.slides[a.currSlideId];a._v=0;a.msTouch=!1;a.slider.addClass((a._h?"rsHor":"rsVer")+(a._l?"":" rsFade"));d='<div class="rsOverflow"><div class="rsContainer">';a.slidesSpacing=a.st.slidesSpacing;a._w=(a._h?a.slider.width():a.slider.height())+a.st.slidesSpacing;a._x=Boolean(0<a._y);1>=a.numSlides&&(a._z=!1);a._a1=a._z&&a._l?2===a.numSlides?1:2:0;a._b1=6>a.numSlides?a.numSlides:6;a._c1=0;a._d1=0;a.slidesJQ=
[];for(c=0;c<a.numSlides;c++)a.slidesJQ.push(l('<div style="'+(a._l?"":c!==a.currSlideId?a._n:"z-index:0;")+'" class="rsSlide "></div>'));a._e1=d=l(d+"</div></div>");h=a.ns;a.msEnabled=window.navigator.msPointerEnabled;a.msEnabled?(a.msTouch=Boolean(1<window.navigator.msMaxTouchPoints),a.hasTouch=!1,a._n1=0.2,a._j1="MSPointerDown"+h,a._k1="MSPointerMove"+h,a._l1="MSPointerUp"+h,a._m1="MSPointerCancel"+h):(a._j1="mousedown"+h,a._k1="mousemove"+h,a._l1="mouseup"+h,a._m1="mouseup"+h,"ontouchstart"in
window||"createTouch"in document?(a.hasTouch=!0,a._j1+=" touchstart"+h,a._k1+=" touchmove"+h,a._l1+=" touchend"+h,a._m1+=" touchcancel"+h,a._n1=0.5,a.st.sliderTouch&&(a._f1=!0)):(a.hasTouch=!1,a._n1=0.2));a.st.sliderDrag&&(a._f1=!0,j.msie||j.opera?a._g1=a._h1="move":j.mozilla?(a._g1="-moz-grab",a._h1="-moz-grabbing"):j.webkit&&-1!=navigator.platform.indexOf("Mac")&&(a._g1="-webkit-grab",a._h1="-webkit-grabbing"),a._i1());a.slider.html(d);a._o1=a.st.controlsInside?a._e1:a.slider;a._p1=a._e1.children(".rsContainer");
a.msEnabled&&a._p1.css("-ms-touch-action",a._h?"pan-y":"pan-x");a._q1=l('<div class="rsPreloader"></div>');d=a._p1.children(".rsSlide");a._r1=a.slidesJQ[a.currSlideId];a._s1=0;a._e?(a._t1="transition-property",a._u1="transition-duration",a._v1="transition-timing-function",a._w1=a._x1=a._g+"transform",a._f?(j.webkit&&!j.chrome&&a.slider.addClass("rsWebkit3d"),/iphone|ipad|ipod/gi.test(navigator.appVersion),a._y1="translate3d(",a._z1="px, ",a._a2="px, 0px)"):(a._y1="translate(",a._z1="px, ",a._a2="px)"),
a._l?a._p1[a._g+a._t1]=a._g+"transform":(h={},h[a._g+a._t1]="opacity",h[a._g+a._u1]=a.st.transitionSpeed+"ms",h[a._g+a._v1]=a.st.css3easeInOut,d.css(h))):(a._x1="left",a._w1="top");var n;l(window).on("resize"+a.ns,function(){n&&clearTimeout(n);n=setTimeout(function(){a.updateSliderSize()},50)});a.ev.trigger("rsAfterPropsSetup");a.updateSliderSize();a.st.keyboardNavEnabled&&a._b2();if(a.st.arrowsNavHideOnTouch&&(a.hasTouch||a.msTouch))a.st.arrowsNav=!1;a.st.arrowsNav&&(d=a._o1,l('<div class="rsArrow rsArrowLeft"><div class="rsArrowIcn"></div></div><div class="rsArrow rsArrowRight"><div class="rsArrowIcn"></div></div>').appendTo(d),
a._c2=d.children(".rsArrowLeft").click(function(b){b.preventDefault();a.prev()}),a._d2=d.children(".rsArrowRight").click(function(b){b.preventDefault();a.next()}),a.st.arrowsNavAutoHide&&!a.hasTouch&&(a._c2.addClass("rsHidden"),a._d2.addClass("rsHidden"),d.one("mousemove.arrowshover",function(){a._c2.removeClass("rsHidden");a._d2.removeClass("rsHidden")}),d.hover(function(){a._e2||(a._c2.removeClass("rsHidden"),a._d2.removeClass("rsHidden"))},function(){a._e2||(a._c2.addClass("rsHidden"),a._d2.addClass("rsHidden"))})),
a.ev.on("rsOnUpdateNav",function(){a._f2()}),a._f2());if(a._f1)a._p1.on(a._j1,function(b){a._g2(b)});else a.dragSuccess=!1;var m=["rsPlayBtnIcon","rsPlayBtn","rsCloseVideoBtn","rsCloseVideoIcn"];a._p1.click(function(b){if(!a.dragSuccess){var c=l(b.target).attr("class");if(-1!==l.inArray(c,m)&&a.toggleVideo())return!1;if(a.st.navigateByClick&&!a._h2){if(l(b.target).closest(".rsNoDrag",a._r1).length)return!0;a._i2(b)}a.ev.trigger("rsSlideClick")}}).on("click.rs","a",function(){if(a.dragSuccess)return!1;
a._h2=!0;setTimeout(function(){a._h2=!1},3)});a.ev.trigger("rsAfterInit")}l.rsModules||(l.rsModules={uid:0});t.prototype={constructor:t,_i2:function(b){b=b[this._h?"pageX":"pageY"]-this._j2;b>=this._q?this.next():0>b&&this.prev()},_t:function(){var b;b=this.st.numImagesToPreload;if(this._z=this.st.loop)2===this.numSlides?(this._z=!1,this.st.loopRewind=!0):2>this.numSlides&&(this.st.loopRewind=this._z=!1);this._z&&0<b&&(4>=this.numSlides?b=1:this.st.numImagesToPreload>(this.numSlides-1)/2&&(b=Math.floor((this.numSlides-
1)/2)));this._y=b},_s:function(b,f){function c(a,b){b?e.images.push(a.attr(b)):e.images.push(a.text());if(j){j=!1;e.caption="src"===b?a.attr("alt"):a.contents();e.image=e.images[0];e.videoURL=a.attr("data-rsVideo");var c=a.attr("data-rsw"),d=a.attr("data-rsh");"undefined"!==typeof c&&!1!==c&&"undefined"!==typeof d&&!1!==d?(e.iW=parseInt(c,10),e.iH=parseInt(d,10)):g.st.imgWidth&&g.st.imgHeight&&(e.iW=g.st.imgWidth,e.iH=g.st.imgHeight)}}var g=this,a,e={},d,j=!0;b=l(b);g._k2=b;g.ev.trigger("rsBeforeParseNode",
[b,e]);if(!e.stopParsing)return b=g._k2,e.id=g._r,e.contentAdded=!1,g._r++,e.images=[],e.isBig=!1,e.hasCover||(b.hasClass("rsImg")?(d=b,a=!0):(d=b.find(".rsImg"),d.length&&(a=!0)),a?(e.bigImage=d.eq(0).attr("data-rsBigImg"),d.each(function(){var a=l(this);a.is("a")?c(a,"href"):a.is("img")?c(a,"src"):c(a)})):b.is("img")&&(b.addClass("rsImg rsMainSlideImage"),c(b,"src"))),d=b.find(".rsCaption"),d.length&&(e.caption=d.remove()),e.content=b,g.ev.trigger("rsAfterParseNode",[b,e]),f&&g.slides.push(e),0===
e.images.length&&(e.isLoaded=!0,e.isRendered=!1,e.isLoading=!1,e.images=null),e},_b2:function(){var b=this,f,c,g=function(a){37===a?b.prev():39===a&&b.next()};b._b.on("keydown"+b.ns,function(a){if(!b._l2&&(c=a.keyCode,(37===c||39===c)&&!f))g(c),f=setInterval(function(){g(c)},700)}).on("keyup"+b.ns,function(){f&&(clearInterval(f),f=null)})},goTo:function(b,f){b!==this.currSlideId&&this._m2(b,this.st.transitionSpeed,!0,!f)},destroy:function(b){this.ev.trigger("rsBeforeDestroy");this._b.off("keydown"+
this.ns+" keyup"+this.ns+" "+this._k1+" "+this._l1);this._p1.off(this._j1+" click");this.slider.data("royalSlider",null);l.removeData(this.slider,"royalSlider");l(window).off("resize"+this.ns);b&&this.slider.remove();this.ev=this.slider=this.slides=null},_n2:function(b,f){function c(c,e,f){c.isAdded?(g(e,c),a(e,c)):(f||(f=d.slidesJQ[e]),c.holder?f=c.holder:(f=d.slidesJQ[e]=l(f),c.holder=f),c.appendOnLoaded=!1,a(e,c,f),g(e,c),d._p2(c,f,b),c.isAdded=!0)}function g(a,c){c.contentAdded||(d.setItemHtml(c,
b),b||(c.contentAdded=!0))}function a(a,b,c){d._l&&(c||(c=d.slidesJQ[a]),c.css(d._i,(a+d._d1+p)*d._w))}function e(a){if(k){if(a>n-1)return e(a-n);if(0>a)return e(n+a)}return a}var d=this,j,h,k=d._z,n=d.numSlides;if(!isNaN(f))return e(f);var m=d.currSlideId,p,q=b?Math.abs(d._o2-d.currSlideId)>=d.numSlides-1?0:1:d._y,r=Math.min(2,q),u=!1,t=!1,s;for(h=m;h<m+1+r;h++)if(s=e(h),(j=d.slides[s])&&(!j.isAdded||!j.positionSet)){u=!0;break}for(h=m-1;h>m-1-r;h--)if(s=e(h),(j=d.slides[s])&&(!j.isAdded||!j.positionSet)){t=
!0;break}if(u)for(h=m;h<m+q+1;h++)s=e(h),p=Math.floor((d._u-(m-h))/d.numSlides)*d.numSlides,(j=d.slides[s])&&c(j,s);if(t)for(h=m-1;h>m-1-q;h--)s=e(h),p=Math.floor((d._u-(m-h))/n)*n,(j=d.slides[s])&&c(j,s);if(!b){r=e(m-q);m=e(m+q);q=r>m?0:r;for(h=0;h<n;h++)if(!(r>m&&h>r-1)&&(h<q||h>m))if((j=d.slides[h])&&j.holder)j.holder.detach(),j.isAdded=!1}},setItemHtml:function(b,f){var c=this,g=function(){if(b.images){if(!b.isLoading){var e,f;b.content.hasClass("rsImg")?(e=b.content,f=!0):e=b.content.find(".rsImg:not(img)");
e&&!e.is("img")&&e.each(function(){var a=l(this),c='<img class="rsImg" src="'+(a.is("a")?a.attr("href"):a.text())+'" />';f?b.content=l(c):a.replaceWith(c)});e=f?b.content:b.content.find("img.rsImg");h();e.eq(0).addClass("rsMainSlideImage");b.iW&&b.iH&&(b.isLoaded||c._q2(b),d());b.isLoading=!0;if(b.isBig)l("<img />").on("load.rs error.rs",function(){l(this).off("load.rs error.rs");a([this],!0)}).attr("src",b.image);else{b.loaded=[];b.numStartedLoad=0;e=function(){l(this).off("load.rs error.rs");b.loaded.push(this);
b.loaded.length===b.numStartedLoad&&a(b.loaded,!1)};for(var g=0;g<b.images.length;g++){var j=l("<img />");b.numStartedLoad++;j.on("load.rs error.rs",e).attr("src",b.images[g])}}}}else b.isRendered=!0,b.isLoaded=!0,b.isLoading=!1,d(!0)},a=function(a,c){if(a.length){var d=a[0];if(c!==b.isBig)(d=b.holder.children())&&1<d.length&&k();else if(b.iW&&b.iH)e();else if(b.iW=d.width,b.iH=d.height,b.iW&&b.iH)e();else{var f=new Image;f.onload=function(){f.width?(b.iW=f.width,b.iH=f.height,e()):setTimeout(function(){f.width&&
(b.iW=f.width,b.iH=f.height);e()},1E3)};f.src=d.src}}else e()},e=function(){b.isLoaded=!0;b.isLoading=!1;d();k();j()},d=function(){if(!b.isAppended&&c.ev){var a=c.st.visibleNearby,d=b.id-c._o;if(!f&&!b.appendOnLoaded&&c.st.fadeinLoadedSlide&&(0===d||(a||c._r2||c._l2)&&(-1===d||1===d)))a={visibility:"visible",opacity:0},a[c._g+"transition"]="opacity 400ms ease-in-out",b.content.css(a),setTimeout(function(){b.content.css("opacity",1)},16);b.holder.find(".rsPreloader").length?b.holder.append(b.content):
b.holder.html(b.content);b.isAppended=!0;b.isLoaded&&(c._q2(b),j());b.sizeReady||(b.sizeReady=!0,setTimeout(function(){c.ev.trigger("rsMaybeSizeReady",b)},100))}},j=function(){!b.loadedTriggered&&c.ev&&(b.isLoaded=b.loadedTriggered=!0,b.holder.trigger("rsAfterContentSet"),c.ev.trigger("rsAfterContentSet",b))},h=function(){c.st.usePreloader&&b.holder.html(c._q1.clone())},k=function(){if(c.st.usePreloader){var a=b.holder.find(".rsPreloader");a.length&&a.remove()}};b.isLoaded?d():f?!c._l&&b.images&&
b.iW&&b.iH?g():(b.holder.isWaiting=!0,h(),b.holder.slideId=-99):g()},_p2:function(b){this._p1.append(b.holder);b.appendOnLoaded=!1},_g2:function(b,f){var c=this,g,a="touchstart"===b.type;c._s2=a;c.ev.trigger("rsDragStart");if(l(b.target).closest(".rsNoDrag",c._r1).length)return c.dragSuccess=!1,!0;!f&&c._r2&&(c._t2=!0,c._u2());c.dragSuccess=!1;if(c._l2)a&&(c._v2=!0);else{a&&(c._v2=!1);c._w2();if(a){var e=b.originalEvent.touches;if(e&&0<e.length)g=e[0],1<e.length&&(c._v2=!0);else return}else b.preventDefault(),
g=b,c.msEnabled&&(g=g.originalEvent);c._l2=!0;c._b.on(c._k1,function(a){c._x2(a,f)}).on(c._l1,function(a){c._y2(a,f)});c._z2="";c._a3=!1;c._b3=g.pageX;c._c3=g.pageY;c._d3=c._v=(!f?c._h:c._e3)?g.pageX:g.pageY;c._f3=0;c._g3=0;c._h3=!f?c._p:c._i3;c._j3=(new Date).getTime();if(a)c._e1.on(c._m1,function(a){c._y2(a,f)})}},_k3:function(b,f){if(this._l3){var c=this._m3,g=b.pageX-this._b3,a=b.pageY-this._c3,e=this._h3+g,d=this._h3+a,j=!f?this._h:this._e3,e=j?e:d,d=this._z2;this._a3=!0;this._b3=b.pageX;this._c3=
b.pageY;"x"===d&&0!==g?this._f3=0<g?1:-1:"y"===d&&0!==a&&(this._g3=0<a?1:-1);d=j?this._b3:this._c3;g=j?g:a;f?e>this._n3?e=this._h3+g*this._n1:e<this._o3&&(e=this._h3+g*this._n1):this._z||(0>=this.currSlideId&&0<d-this._d3&&(e=this._h3+g*this._n1),this.currSlideId>=this.numSlides-1&&0>d-this._d3&&(e=this._h3+g*this._n1));this._h3=e;200<c-this._j3&&(this._j3=c,this._v=d);f?this._q3(this._h3):this._l&&this._p3(this._h3)}},_x2:function(b,f){var c=this,g,a="touchmove"===b.type;if(!c._s2||a){if(a){if(c._r3)return;
var e=b.originalEvent.touches;if(e){if(1<e.length)return;g=e[0]}else return}else g=b,c.msEnabled&&(g=g.originalEvent);c._a3||(c._e&&(!f?c._p1:c._s3).css(c._g+c._u1,"0s"),function j(){c._l2&&(c._t3=requestAnimationFrame(j),c._u3&&c._k3(c._u3,f))}());if(c._l3)b.preventDefault(),c._m3=(new Date).getTime(),c._u3=g;else if(e=!f?c._h:c._e3,g=Math.abs(g.pageX-c._b3)-Math.abs(g.pageY-c._c3)-(e?-7:7),7<g){if(e)b.preventDefault(),c._z2="x";else if(a){c._v3();return}c._l3=!0}else if(-7>g){if(e){if(a){c._v3();
return}}else b.preventDefault(),c._z2="y";c._l3=!0}}},_v3:function(){this._r3=!0;this._a3=this._l2=!1;this._y2()},_y2:function(b,f){function c(a){return 100>a?100:500<a?500:a}function g(b,d){if(a._l||f)j=(-a._u-a._d1)*a._w,h=Math.abs(a._p-j),a._c=h/d,b&&(a._c+=250),a._c=c(a._c),a._x3(j,!1)}var a=this,e,d,j,h;d="touchend"===b.type||"touchcancel"===b.type;if(!a._s2||d)if(a._s2=!1,a.ev.trigger("rsDragRelease"),a._u3=null,a._l2=!1,a._r3=!1,a._l3=!1,a._m3=0,cancelAnimationFrame(a._t3),a._a3&&(f?a._q3(a._h3):
a._l&&a._p3(a._h3)),a._b.off(a._k1).off(a._l1),d&&a._e1.off(a._m1),a._i1(),!a._a3&&!a._v2&&f&&a._w3){var k=l(b.target).closest(".rsNavItem");k.length&&a.goTo(k.index())}else{e=!f?a._h:a._e3;if(!a._a3||"y"===a._z2&&e||"x"===a._z2&&!e)if(!f&&a._t2){a._t2=!1;if(a.st.navigateByClick){a._i2(a.msEnabled?b.originalEvent:b);a.dragSuccess=!0;return}a.dragSuccess=!0}else{a._t2=!1;a.dragSuccess=!1;return}else a.dragSuccess=!0;a._t2=!1;a._z2="";var n=a.st.minSlideOffset;d=d?b.originalEvent.changedTouches[0]:
a.msEnabled?b.originalEvent:b;var m=e?d.pageX:d.pageY,p=a._d3;d=a._v;var q=a.currSlideId,r=a.numSlides,u=e?a._f3:a._g3,t=a._z;Math.abs(m-p);e=m-d;d=(new Date).getTime()-a._j3;d=Math.abs(e)/d;if(0===u||1>=r)g(!0,d);else{if(!t&&!f)if(0>=q){if(0<u){g(!0,d);return}}else if(q>=r-1&&0>u){g(!0,d);return}if(f){j=a._i3;if(j>a._n3)j=a._n3;else if(j<a._o3)j=a._o3;else{n=d*d/0.006;k=-a._i3;m=a._y3-a._z3+a._i3;0<e&&n>k?(k+=a._z3/(15/(0.003*(n/d))),d=d*k/n,n=k):0>e&&n>m&&(m+=a._z3/(15/(0.003*(n/d))),d=d*m/n,n=
m);k=Math.max(Math.round(d/0.003),50);j+=n*(0>e?-1:1);if(j>a._n3){a._a4(j,k,!0,a._n3,200);return}if(j<a._o3){a._a4(j,k,!0,a._o3,200);return}}a._a4(j,k,!0)}else p+n<m?0>u?g(!1,d):a._m2("prev",c(Math.abs(a._p-(-a._u-a._d1+1)*a._w)/d),!1,!0,!0):p-n>m?0<u?g(!1,d):a._m2("next",c(Math.abs(a._p-(-a._u-a._d1-1)*a._w)/d),!1,!0,!0):g(!1,d)}}},_p3:function(b){b=this._p=b;this._e?this._p1.css(this._x1,this._y1+(this._h?b+this._z1+0:0+this._z1+b)+this._a2):this._p1.css(this._h?this._x1:this._w1,b)},updateSliderSize:function(b){var f,
c;if(this.st.autoScaleSlider){var g=this.st.autoScaleSliderWidth,a=this.st.autoScaleSliderHeight;this.st.autoScaleHeight?(f=this.slider.width(),f!=this.width&&(this.slider.css("height",f*(a/g)),f=this.slider.width()),c=this.slider.height()):(c=this.slider.height(),c!=this.height&&(this.slider.css("width",c*(g/a)),c=this.slider.height()),f=this.slider.width())}else f=this.slider.width(),c=this.slider.height();if(b||f!=this.width||c!=this.height){this.width=f;this.height=c;this._b4=f;this._c4=c;this.ev.trigger("rsBeforeSizeSet");
this.ev.trigger("rsAfterSizePropSet");this._e1.css({width:this._b4,height:this._c4});this._w=(this._h?this._b4:this._c4)+this.st.slidesSpacing;this._d4=this.st.imageScalePadding;for(f=0;f<this.slides.length;f++)b=this.slides[f],b.positionSet=!1,b&&(b.images&&b.isLoaded)&&(b.isRendered=!1,this._q2(b));if(this._e4)for(f=0;f<this._e4.length;f++)b=this._e4[f],b.holder.css(this._i,(b.id+this._d1)*this._w);this._n2();this._l&&(this._e&&this._p1.css(this._g+"transition-duration","0s"),this._p3((-this._u-
this._d1)*this._w));this.ev.trigger("rsOnUpdateNav")}this._j2=this._e1.offset();this._j2=this._j2[this._i]},appendSlide:function(b,f){var c=this._s(b);if(isNaN(f)||f>this.numSlides)f=this.numSlides;this.slides.splice(f,0,c);this.slidesJQ.splice(f,0,'<div style="'+(this._l?"position:absolute;":this._n)+'" class="rsSlide"></div>');f<this.currSlideId&&this.currSlideId++;this.ev.trigger("rsOnAppendSlide",[c,f]);this._f4(f);f===this.currSlideId&&this.ev.trigger("rsAfterSlideChange")},removeSlide:function(b){var f=
this.slides[b];f&&(f.holder&&f.holder.remove(),b<this.currSlideId&&this.currSlideId--,this.slides.splice(b,1),this.slidesJQ.splice(b,1),this.ev.trigger("rsOnRemoveSlide",[b]),this._f4(b),b===this.currSlideId&&this.ev.trigger("rsAfterSlideChange"))},_f4:function(){var b=this,f=b.numSlides,f=0>=b._u?0:Math.floor(b._u/f);b.numSlides=b.slides.length;0===b.numSlides?(b.currSlideId=b._d1=b._u=0,b.currSlide=b._g4=null):b._u=f*b.numSlides+b.currSlideId;for(f=0;f<b.numSlides;f++)b.slides[f].id=f;b.currSlide=
b.slides[b.currSlideId];b._r1=b.slidesJQ[b.currSlideId];b.currSlideId>=b.numSlides?b.goTo(b.numSlides-1):0>b.currSlideId&&b.goTo(0);b._t();b._l&&b._z&&b._p1.css(b._g+b._u1,"0ms");b._h4&&clearTimeout(b._h4);b._h4=setTimeout(function(){b._l&&b._p3((-b._u-b._d1)*b._w);b._n2();b._l||b._r1.css({display:"block",opacity:1})},14);b.ev.trigger("rsOnUpdateNav")},_i1:function(){this._f1&&this._l&&(this._g1?this._e1.css("cursor",this._g1):(this._e1.removeClass("grabbing-cursor"),this._e1.addClass("grab-cursor")))},
_w2:function(){this._f1&&this._l&&(this._h1?this._e1.css("cursor",this._h1):(this._e1.removeClass("grab-cursor"),this._e1.addClass("grabbing-cursor")))},next:function(b){this._m2("next",this.st.transitionSpeed,!0,!b)},prev:function(b){this._m2("prev",this.st.transitionSpeed,!0,!b)},_m2:function(b,f,c,g,a){var e=this,d,j,h;e.ev.trigger("rsBeforeMove",[b,g]);h="next"===b?e.currSlideId+1:"prev"===b?e.currSlideId-1:b=parseInt(b,10);if(!e._z){if(0>h){e._i4("left",!g);return}if(h>=e.numSlides){e._i4("right",
!g);return}}e._r2&&(e._u2(!0),c=!1);j=h-e.currSlideId;h=e._o2=e.currSlideId;var k=e.currSlideId+j;g=e._u;var l;e._z?(k=e._n2(!1,k),g+=j):g=k;e._o=k;e._g4=e.slidesJQ[e.currSlideId];e._u=g;e.currSlideId=e._o;e.currSlide=e.slides[e.currSlideId];e._r1=e.slidesJQ[e.currSlideId];var k=e.st.slidesDiff,m=Boolean(0<j);j=Math.abs(j);var p=Math.floor(h/e._y),q=Math.floor((h+(m?k:-k))/e._y),p=(m?Math.max(p,q):Math.min(p,q))*e._y+(m?e._y-1:0);p>e.numSlides-1?p=e.numSlides-1:0>p&&(p=0);h=m?p-h:h-p;h>e._y&&(h=e._y);
if(j>h+k){e._d1+=(j-(h+k))*(m?-1:1);f*=1.4;for(h=0;h<e.numSlides;h++)e.slides[h].positionSet=!1}e._c=f;e._n2(!0);a||(l=!0);d=(-g-e._d1)*e._w;l?setTimeout(function(){e._j4=!1;e._x3(d,b,!1,c);e.ev.trigger("rsOnUpdateNav")},0):(e._x3(d,b,!1,c),e.ev.trigger("rsOnUpdateNav"))},_f2:function(){this.st.arrowsNav&&(1>=this.numSlides?(this._c2.css("display","none"),this._d2.css("display","none")):(this._c2.css("display","block"),this._d2.css("display","block"),!this._z&&!this.st.loopRewind&&(0===this.currSlideId?
this._c2.addClass("rsArrowDisabled"):this._c2.removeClass("rsArrowDisabled"),this.currSlideId===this.numSlides-1?this._d2.addClass("rsArrowDisabled"):this._d2.removeClass("rsArrowDisabled"))))},_x3:function(b,f,c,g,a){function e(){var a;if(j&&(a=j.data("rsTimeout")))j!==h&&j.css({opacity:0,display:"none",zIndex:0}),clearTimeout(a),j.data("rsTimeout","");if(a=h.data("rsTimeout"))clearTimeout(a),h.data("rsTimeout","")}var d=this,j,h,k={};isNaN(d._c)&&(d._c=400);d._p=d._h3=b;d.ev.trigger("rsBeforeAnimStart");
d._e?d._l?(d._c=parseInt(d._c,10),c=d._g+d._v1,k[d._g+d._u1]=d._c+"ms",k[c]=g?l.rsCSS3Easing[d.st.easeInOut]:l.rsCSS3Easing[d.st.easeOut],d._p1.css(k),g||!d.hasTouch?setTimeout(function(){d._p3(b)},5):d._p3(b)):(d._c=d.st.transitionSpeed,j=d._g4,h=d._r1,h.data("rsTimeout")&&h.css("opacity",0),e(),j&&j.data("rsTimeout",setTimeout(function(){k[d._g+d._u1]="0ms";k.zIndex=0;k.display="none";j.data("rsTimeout","");j.css(k);setTimeout(function(){j.css("opacity",0)},16)},d._c+60)),k.display="block",k.zIndex=
d._m,k.opacity=0,k[d._g+d._u1]="0ms",k[d._g+d._v1]=l.rsCSS3Easing[d.st.easeInOut],h.css(k),h.data("rsTimeout",setTimeout(function(){h.css(d._g+d._u1,d._c+"ms");h.data("rsTimeout",setTimeout(function(){h.css("opacity",1);h.data("rsTimeout","")},20))},20))):d._l?(k[d._h?d._x1:d._w1]=b+"px",d._p1.animate(k,d._c,g?d.st.easeInOut:d.st.easeOut)):(j=d._g4,h=d._r1,h.stop(!0,!0).css({opacity:0,display:"block",zIndex:d._m}),d._c=d.st.transitionSpeed,h.animate({opacity:1},d._c,d.st.easeInOut),e(),j&&j.data("rsTimeout",
setTimeout(function(){j.stop(!0,!0).css({opacity:0,display:"none",zIndex:0})},d._c+60)));d._r2=!0;d.loadingTimeout&&clearTimeout(d.loadingTimeout);d.loadingTimeout=a?setTimeout(function(){d.loadingTimeout=null;a.call()},d._c+60):setTimeout(function(){d.loadingTimeout=null;d._k4(f)},d._c+60)},_u2:function(b){this._r2=!1;clearTimeout(this.loadingTimeout);if(this._l)if(this._e){if(!b){b=this._p;var f=this._h3=this._l4();this._p1.css(this._g+this._u1,"0ms");b!==f&&this._p3(f)}}else this._p1.stop(!0),
this._p=parseInt(this._p1.css(this._x1),10);else 20<this._m?this._m=10:this._m++},_l4:function(){var b=window.getComputedStyle(this._p1.get(0),null).getPropertyValue(this._g+"transform").replace(/^matrix\(/i,"").split(/, |\)$/g),f=0===b[0].indexOf("matrix3d");return parseInt(b[this._h?f?12:4:f?13:5],10)},_m4:function(b,f){return this._e?this._y1+(f?b+this._z1+0:0+this._z1+b)+this._a2:b},_k4:function(){this._l||(this._r1.css("z-index",0),this._m=10);this._r2=!1;this.staticSlideId=this.currSlideId;
this._n2();this._n4=!1;this.ev.trigger("rsAfterSlideChange")},_i4:function(b,f){var c=this,g=(-c._u-c._d1)*c._w;if(!(0===c.numSlides||c._r2))if(c.st.loopRewind)c.goTo("left"===b?c.numSlides-1:0,f);else if(c._l){c._c=200;var a=function(){c._r2=!1};c._x3(g+("left"===b?30:-30),"",!1,!0,function(){c._r2=!1;c._x3(g,"",!1,!0,a)})}},_q2:function(b){if(!b.isRendered){var f=b.content,c="rsMainSlideImage",g,a=this.st.imageAlignCenter,e=this.st.imageScaleMode,d;b.videoURL&&(c="rsVideoContainer","fill"!==e?g=
!0:(d=f,d.hasClass(c)||(d=d.find("."+c)),d.css({width:"100%",height:"100%"}),c="rsMainSlideImage"));f.hasClass(c)||(f=f.find("."+c));if(f){var j=b.iW,c=b.iH;b.isRendered=!0;if("none"!==e||a){b="fill"!==e?this._d4:0;d=this._b4-2*b;var h=this._c4-2*b,k,l,m={};if("fit-if-smaller"===e&&(j>d||c>h))e="fit";if("fill"===e||"fit"===e)k=d/j,l=h/c,k="fill"==e?k>l?k:l:"fit"==e?k<l?k:l:1,j=Math.ceil(j*k,10),c=Math.ceil(c*k,10);"none"!==e&&(m.width=j,m.height=c,g&&f.find(".rsImg").css({width:"100%",height:"100%"}));
a&&(m.marginLeft=Math.floor((d-j)/2)+b,m.marginTop=Math.floor((h-c)/2)+b);f.css(m)}}}}};l.rsProto=t.prototype;l.fn.royalSlider=function(b){var f=arguments;return this.each(function(){var c=l(this);if("object"===typeof b||!b)c.data("royalSlider")||c.data("royalSlider",new t(c,b));else if((c=c.data("royalSlider"))&&c[b])return c[b].apply(c,Array.prototype.slice.call(f,1))})};l.fn.royalSlider.defaults={slidesSpacing:8,startSlideId:0,loop:!1,loopRewind:!1,numImagesToPreload:4,fadeinLoadedSlide:!0,slidesOrientation:"horizontal",
transitionType:"move",transitionSpeed:600,controlNavigation:"bullets",controlsInside:!0,arrowsNav:!0,arrowsNavAutoHide:!0,navigateByClick:!0,randomizeSlides:!1,sliderDrag:!0,sliderTouch:!0,keyboardNavEnabled:!1,fadeInAfterLoaded:!0,allowCSS3:!0,allowCSS3OnWebkit:!0,addActiveClass:!1,autoHeight:!1,easeOut:"easeOutSine",easeInOut:"easeInOutSine",minSlideOffset:10,imageScaleMode:"fit-if-smaller",imageAlignCenter:!0,imageScalePadding:4,usePreloader:!0,autoScaleSlider:!1,autoScaleSliderWidth:800,autoScaleSliderHeight:400,
autoScaleHeight:!0,arrowsNavHideOnTouch:!1,globalCaption:!1,slidesDiff:2};l.rsCSS3Easing={easeOutSine:"cubic-bezier(0.390, 0.575, 0.565, 1.000)",easeInOutSine:"cubic-bezier(0.445, 0.050, 0.550, 0.950)"};l.extend(jQuery.easing,{easeInOutSine:function(b,f,c,g,a){return-g/2*(Math.cos(Math.PI*f/a)-1)+c},easeOutSine:function(b,f,c,g,a){return g*Math.sin(f/a*(Math.PI/2))+c},easeOutCubic:function(b,f,c,g,a){return g*((f=f/a-1)*f*f+1)+c}})})(jQuery,window);
// jquery.rs.active-class v1.0.1
(function(c){c.rsProto._o4=function(){var b,a=this;if(a.st.addActiveClass)a.ev.on("rsOnUpdateNav",function(){b&&clearTimeout(b);b=setTimeout(function(){a._g4&&a._g4.removeClass("rsActiveSlide");a._r1&&a._r1.addClass("rsActiveSlide");b=null},50)})};c.rsModules.activeClass=c.rsProto._o4})(jQuery);
// jquery.rs.animated-blocks v1.0.7
(function(j){j.extend(j.rsProto,{_p4:function(){function l(){var g=a.currSlide;if(a.currSlide&&a.currSlide.isLoaded&&a._t4!==g){if(0<a._s4.length){for(b=0;b<a._s4.length;b++)clearTimeout(a._s4[b]);a._s4=[]}if(0<a._r4.length){var f;for(b=0;b<a._r4.length;b++)if(f=a._r4[b])a._e?(f.block.css(a._g+a._u1,"0s"),f.block.css(f.css)):f.block.stop(!0).css(f.css),a._t4=null,g.animBlocksDisplayed=!1;a._r4=[]}g.animBlocks&&(g.animBlocksDisplayed=!0,a._t4=g,a._u4(g.animBlocks))}}var a=this,b;a._q4={fadeEffect:!0,
moveEffect:"top",moveOffset:20,speed:400,easing:"easeOutSine",delay:200};a.st.block=j.extend({},a._q4,a.st.block);a._r4=[];a._s4=[];a.ev.on("rsAfterInit",function(){l()});a.ev.on("rsBeforeParseNode",function(a,b,d){b=j(b);d.animBlocks=b.find(".rsABlock").css("display","none");d.animBlocks.length||(d.animBlocks=b.hasClass("rsABlock")?b.css("display","none"):!1)});a.ev.on("rsAfterContentSet",function(b,f){f.id===a.slides[a.currSlideId].id&&setTimeout(function(){l()},a.st.fadeinLoadedSlide?300:0)});
a.ev.on("rsAfterSlideChange",function(){l()})},_v4:function(j,a){setTimeout(function(){j.css(a)},6)},_u4:function(l){var a=this,b,g,f,d,h,e,m;a._s4=[];l.each(function(l){b=j(this);g={};f={};d=null;var c=b.attr("data-move-offset"),c=c?parseInt(c,10):a.st.block.moveOffset;if(0<c&&((e=b.data("move-effect"))?(e=e.toLowerCase(),"none"===e?e=!1:"left"!==e&&("top"!==e&&"bottom"!==e&&"right"!==e)&&(e=a.st.block.moveEffect,"none"===e&&(e=!1))):e=a.st.block.moveEffect,e&&"none"!==e)){var n;n="right"===e||"left"===
e?!0:!1;var k;m=!1;a._e?(k=0,h=a._x1):(n?isNaN(parseInt(b.css("right"),10))?h="left":(h="right",m=!0):isNaN(parseInt(b.css("bottom"),10))?h="top":(h="bottom",m=!0),h="margin-"+h,m&&(c=-c),a._e?k=parseInt(b.css(h),10):(k=b.data("rs-start-move-prop"),void 0===k&&(k=parseInt(b.css(h),10),b.data("rs-start-move-prop",k))));f[h]=a._m4("top"===e||"left"===e?k-c:k+c,n);g[h]=a._m4(k,n)}if(c=b.attr("data-fade-effect")){if("none"===c.toLowerCase()||"false"===c.toLowerCase())c=!1}else c=a.st.block.fadeEffect;
c&&(f.opacity=0,g.opacity=1);if(c||e)d={},d.hasFade=Boolean(c),Boolean(e)&&(d.moveProp=h,d.hasMove=!0),d.speed=b.data("speed"),isNaN(d.speed)&&(d.speed=a.st.block.speed),d.easing=b.data("easing"),d.easing||(d.easing=a.st.block.easing),d.css3Easing=j.rsCSS3Easing[d.easing],d.delay=b.data("delay"),isNaN(d.delay)&&(d.delay=a.st.block.delay*l);c={};a._e&&(c[a._g+a._u1]="0ms");c.moveProp=g.moveProp;c.opacity=g.opacity;c.display="none";a._r4.push({block:b,css:c});a._v4(b,f);a._s4.push(setTimeout(function(b,
d,c,e){return function(){b.css("display","block");if(c){var g={};if(a._e){var f="";c.hasMove&&(f+=c.moveProp);c.hasFade&&(c.hasMove&&(f+=", "),f+="opacity");g[a._g+a._t1]=f;g[a._g+a._u1]=c.speed+"ms";g[a._g+a._v1]=c.css3Easing;b.css(g);setTimeout(function(){b.css(d)},24)}else setTimeout(function(){b.animate(d,c.speed,c.easing)},16)}delete a._s4[e]}}(b,g,d,l),6>=d.delay?12:d.delay))})}});j.rsModules.animatedBlocks=j.rsProto._p4})(jQuery);
// jquery.rs.auto-height v1.0.2
(function(b){b.extend(b.rsProto,{_w4:function(){var a=this;if(a.st.autoHeight){var b,d,e,c=function(c){e=a.slides[a.currSlideId];if(b=e.holder)if((d=b.height())&&void 0!==d)a._c4=d,a._e||!c?a._e1.css("height",d):a._e1.stop(!0,!0).animate({height:d},a.st.transitionSpeed)};a.ev.on("rsMaybeSizeReady.rsAutoHeight",function(a,b){e===b&&c()});a.ev.on("rsAfterContentSet.rsAutoHeight",function(a,b){e===b&&c()});a.slider.addClass("rsAutoHeight");a.ev.one("rsAfterInit",function(){setTimeout(function(){c(!1);
setTimeout(function(){a.slider.append('<div style="clear:both; float: none;"></div>');a._e&&a._e1.css(a._g+"transition","height "+a.st.transitionSpeed+"ms ease-in-out")},16)},16)});a.ev.on("rsBeforeAnimStart",function(){c(!0)});a.ev.on("rsBeforeSizeSet",function(){setTimeout(function(){c(!1)},16)})}}});b.rsModules.autoHeight=b.rsProto._w4})(jQuery);
// jquery.rs.autoplay v1.0.5
(function(b){b.extend(b.rsProto,{_x4:function(){var a=this,d;a._y4={enabled:!1,stopAtAction:!0,pauseOnHover:!0,delay:2E3};!a.st.autoPlay&&a.st.autoplay&&(a.st.autoPlay=a.st.autoplay);a.st.autoPlay=b.extend({},a._y4,a.st.autoPlay);a.st.autoPlay.enabled&&(a.ev.on("rsBeforeParseNode",function(a,c,f){c=b(c);if(d=c.attr("data-rsDelay"))f.customDelay=parseInt(d,10)}),a.ev.one("rsAfterInit",function(){a._z4()}),a.ev.on("rsBeforeDestroy",function(){a.stopAutoPlay();a.slider.off("mouseenter mouseleave");b(window).off("blur"+
a.ns+" focus"+a.ns)}))},_z4:function(){var a=this;a.startAutoPlay();a.ev.on("rsAfterContentSet",function(b,e){!a._l2&&(!a._r2&&a._a5&&e===a.currSlide)&&a._b5()});a.ev.on("rsDragRelease",function(){a._a5&&a._c5&&(a._c5=!1,a._b5())});a.ev.on("rsAfterSlideChange",function(){a._a5&&a._c5&&(a._c5=!1,a.currSlide.isLoaded&&a._b5())});a.ev.on("rsDragStart",function(){a._a5&&(a.st.autoPlay.stopAtAction?a.stopAutoPlay():(a._c5=!0,a._d5()))});a.ev.on("rsBeforeMove",function(b,e,c){a._a5&&(c&&a.st.autoPlay.stopAtAction?
a.stopAutoPlay():(a._c5=!0,a._d5()))});a._e5=!1;a.ev.on("rsVideoStop",function(){a._a5&&(a._e5=!1,a._b5())});a.ev.on("rsVideoPlay",function(){a._a5&&(a._c5=!1,a._d5(),a._e5=!0)});b(window).on("blur"+a.ns,function(){a._a5&&(a._c5=!0,a._d5())}).on("focus"+a.ns,function(){a._a5&&a._c5&&(a._c5=!1,a._b5())});a.st.autoPlay.pauseOnHover&&(a._f5=!1,a.slider.hover(function(){a._a5&&(a._c5=!1,a._d5(),a._f5=!0)},function(){a._a5&&(a._f5=!1,a._b5())}))},toggleAutoPlay:function(){this._a5?this.stopAutoPlay():
this.startAutoPlay()},startAutoPlay:function(){this._a5=!0;this.currSlide.isLoaded&&this._b5()},stopAutoPlay:function(){this._e5=this._f5=this._c5=this._a5=!1;this._d5()},_b5:function(){var a=this;!a._f5&&!a._e5&&(a._g5=!0,a._h5&&clearTimeout(a._h5),a._h5=setTimeout(function(){var b;!a._z&&!a.st.loopRewind&&(b=!0,a.st.loopRewind=!0);a.next(!0);b&&(a.st.loopRewind=!1)},!a.currSlide.customDelay?a.st.autoPlay.delay:a.currSlide.customDelay))},_d5:function(){!this._f5&&!this._e5&&(this._g5=!1,this._h5&&
(clearTimeout(this._h5),this._h5=null))}});b.rsModules.autoplay=b.rsProto._x4})(jQuery);
// jquery.rs.bullets v1.0.1
(function(c){c.extend(c.rsProto,{_i5:function(){var a=this;"bullets"===a.st.controlNavigation&&(a.ev.one("rsAfterPropsSetup",function(){a._j5=!0;a.slider.addClass("rsWithBullets");for(var b='<div class="rsNav rsBullets">',e=0;e<a.numSlides;e++)b+='<div class="rsNavItem rsBullet"><span></span></div>';a._k5=b=c(b+"</div>");a._l5=b.appendTo(a.slider).children();a._k5.on("click.rs",".rsNavItem",function(){a._m5||a.goTo(c(this).index())})}),a.ev.on("rsOnAppendSlide",function(b,c,d){d>=a.numSlides?a._k5.append('<div class="rsNavItem rsBullet"><span></span></div>'):
a._l5.eq(d).before('<div class="rsNavItem rsBullet"><span></span></div>');a._l5=a._k5.children()}),a.ev.on("rsOnRemoveSlide",function(b,c){var d=a._l5.eq(c);d&&d.length&&(d.remove(),a._l5=a._k5.children())}),a.ev.on("rsOnUpdateNav",function(){var b=a.currSlideId;a._n5&&a._n5.removeClass("rsNavSelected");b=a._l5.eq(b);b.addClass("rsNavSelected");a._n5=b}))}});c.rsModules.bullets=c.rsProto._i5})(jQuery);
// jquery.rs.deeplinking v1.0.6 + jQuery hashchange plugin v1.3 Copyright (c) 2010 Ben Alman
(function(b){b.extend(b.rsProto,{_o5:function(){var a=this,g,c,e;a._p5={enabled:!1,change:!1,prefix:""};a.st.deeplinking=b.extend({},a._p5,a.st.deeplinking);if(a.st.deeplinking.enabled){var h=a.st.deeplinking.change,d="#"+a.st.deeplinking.prefix,f=function(){var a=window.location.hash;return a&&(a=parseInt(a.substring(d.length),10),0<=a)?a-1:-1},j=f();-1!==j&&(a.st.startSlideId=j);h&&(b(window).on("hashchange"+a.ns,function(){if(!g){var b=f();0>b||(b>a.numSlides-1&&(b=a.numSlides-1),a.goTo(b))}}),
a.ev.on("rsBeforeAnimStart",function(){c&&clearTimeout(c);e&&clearTimeout(e)}),a.ev.on("rsAfterSlideChange",function(){c&&clearTimeout(c);e&&clearTimeout(e);e=setTimeout(function(){g=!0;window.location.replace((""+window.location).split("#")[0]+d+(a.currSlideId+1));c=setTimeout(function(){g=!1;c=null},60)},400)}));a.ev.on("rsBeforeDestroy",function(){c=e=null;h&&b(window).off("hashchange"+a.ns)})}}});b.rsModules.deeplinking=b.rsProto._o5})(jQuery);
(function(b,a,g){function c(a){a=a||location.href;return"#"+a.replace(/^[^#]*#?(.*)$/,"$1")}"$:nomunge";var e=document,h,d=b.event.special,f=e.documentMode,j="onhashchange"in a&&(f===g||7<f);b.fn.hashchange=function(a){return a?this.bind("hashchange",a):this.trigger("hashchange")};b.fn.hashchange.delay=50;d.hashchange=b.extend(d.hashchange,{setup:function(){if(j)return!1;b(h.start)},teardown:function(){if(j)return!1;b(h.stop)}});var p=function(){var e=c(),d=r(n);e!==n?(q(n=e,d),b(a).trigger("hashchange")):
d!==n&&(location.href=location.href.replace(/#.*/,"")+d);l=setTimeout(p,b.fn.hashchange.delay)},d={},l,n=c(),q=f=function(a){return a},r=f;d.start=function(){l||p()};d.stop=function(){l&&clearTimeout(l);l=g};if(a.attachEvent&&!a.addEventListener&&!j){var k,m;d.start=function(){k||(m=(m=b.fn.hashchange.src)&&m+c(),k=b('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){m||q(c());p()}).attr("src",m||"javascript:0").insertAfter("body")[0].contentWindow,e.onpropertychange=function(){try{"title"===
event.propertyName&&(k.document.title=e.title)}catch(a){}})};d.stop=f;r=function(){return c(k.location.href)};q=function(a,d){var c=k.document,f=b.fn.hashchange.domain;a!==d&&(c.title=e.title,c.open(),f&&c.write('<script>document.domain="'+f+'"\x3c/script>'),c.close(),k.location.hash=a)}}h=d})(jQuery,this);
// jquery.rs.fullscreen v1.0.5
(function(c){c.extend(c.rsProto,{_q5:function(){var a=this;a._r5={enabled:!1,keyboardNav:!0,buttonFS:!0,nativeFS:!1,doubleTap:!0};a.st.fullscreen=c.extend({},a._r5,a.st.fullscreen);if(a.st.fullscreen.enabled)a.ev.one("rsBeforeSizeSet",function(){a._s5()})},_s5:function(){var a=this;a._t5=!a.st.keyboardNavEnabled&&a.st.fullscreen.keyboardNav;if(a.st.fullscreen.nativeFS){a._u5={supportsFullScreen:!1,isFullScreen:function(){return!1},requestFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",
prefix:""};var b=["webkit","moz","o","ms","khtml"];if(!a.isAndroid)if("undefined"!=typeof document.cancelFullScreen)a._u5.supportsFullScreen=!0;else for(var d=0;d<b.length;d++)if(a._u5.prefix=b[d],"undefined"!=typeof document[a._u5.prefix+"CancelFullScreen"]){a._u5.supportsFullScreen=!0;break}a._u5.supportsFullScreen?(a.nativeFS=!0,a._u5.fullScreenEventName=a._u5.prefix+"fullscreenchange"+a.ns,a._u5.isFullScreen=function(){switch(this.prefix){case "":return document.fullScreen;case "webkit":return document.webkitIsFullScreen;
default:return document[this.prefix+"FullScreen"]}},a._u5.requestFullScreen=function(a){return""===this.prefix?a.requestFullScreen():a[this.prefix+"RequestFullScreen"]()},a._u5.cancelFullScreen=function(){return""===this.prefix?document.cancelFullScreen():document[this.prefix+"CancelFullScreen"]()}):a._u5=!1}a.st.fullscreen.buttonFS&&(a._v5=c('<div class="rsFullscreenBtn"><div class="rsFullscreenIcn"></div></div>').appendTo(a._o1).on("click.rs",function(){a.isFullscreen?a.exitFullscreen():a.enterFullscreen()}))},
enterFullscreen:function(a){var b=this;if(b._u5)if(a)b._u5.requestFullScreen(c("html")[0]);else{b._b.on(b._u5.fullScreenEventName,function(){b._u5.isFullScreen()?b.enterFullscreen(!0):b.exitFullscreen(!0)});b._u5.requestFullScreen(c("html")[0]);return}if(!b._w5){b._w5=!0;b._b.on("keyup"+b.ns+"fullscreen",function(a){27===a.keyCode&&b.exitFullscreen()});b._t5&&b._b2();a=c(window);b._x5=a.scrollTop();b._y5=a.scrollLeft();b._z5=c("html").attr("style");b._a6=c("body").attr("style");b._b6=b.slider.attr("style");
c("body, html").css({overflow:"hidden",height:"100%",width:"100%",margin:"0",padding:"0"});b.slider.addClass("rsFullscreen");var d;for(d=0;d<b.numSlides;d++)a=b.slides[d],a.isRendered=!1,a.bigImage&&(a.isBig=!0,a.isMedLoaded=a.isLoaded,a.isMedLoading=a.isLoading,a.medImage=a.image,a.medIW=a.iW,a.medIH=a.iH,a.slideId=-99,a.bigImage!==a.medImage&&(a.sizeType="big"),a.isLoaded=a.isBigLoaded,a.isLoading=!1,a.image=a.bigImage,a.images[0]=a.bigImage,a.iW=a.bigIW,a.iH=a.bigIH,a.isAppended=a.contentAdded=
!1,b._c6(a));b.isFullscreen=!0;b._w5=!1;b.updateSliderSize();b.ev.trigger("rsEnterFullscreen")}},exitFullscreen:function(a){var b=this;if(b._u5){if(!a){b._u5.cancelFullScreen(c("html")[0]);return}b._b.off(b._u5.fullScreenEventName)}if(!b._w5){b._w5=!0;b._b.off("keyup"+b.ns+"fullscreen");b._t5&&b._b.off("keydown"+b.ns);c("html").attr("style",b._z5||"");c("body").attr("style",b._a6||"");var d;for(d=0;d<b.numSlides;d++)a=b.slides[d],a.isRendered=!1,a.bigImage&&(a.isBig=!1,a.slideId=-99,a.isBigLoaded=
a.isLoaded,a.isBigLoading=a.isLoading,a.bigImage=a.image,a.bigIW=a.iW,a.bigIH=a.iH,a.isLoaded=a.isMedLoaded,a.isLoading=!1,a.image=a.medImage,a.images[0]=a.medImage,a.iW=a.medIW,a.iH=a.medIH,a.isAppended=a.contentAdded=!1,b._c6(a,!0),a.bigImage!==a.medImage&&(a.sizeType="med"));b.isFullscreen=!1;a=c(window);a.scrollTop(b._x5);a.scrollLeft(b._y5);b._w5=!1;b.slider.removeClass("rsFullscreen");b.updateSliderSize();setTimeout(function(){b.updateSliderSize()},1);b.ev.trigger("rsExitFullscreen")}},_c6:function(a){var b=
!a.isLoaded&&!a.isLoading?'<a class="rsImg rsMainSlideImage" href="'+a.image+'"></a>':'<img class="rsImg rsMainSlideImage" src="'+a.image+'"/>';a.content.hasClass("rsImg")?a.content=c(b):a.content.find(".rsImg").eq(0).replaceWith(b);!a.isLoaded&&(!a.isLoading&&a.holder)&&a.holder.html(a.content)}});c.rsModules.fullscreen=c.rsProto._q5})(jQuery);
// jquery.rs.global-caption v1.0
(function(b){b.extend(b.rsProto,{_d6:function(){var a=this;a.st.globalCaption&&(a.ev.on("rsAfterInit",function(){a.globalCaption=b('<div class="rsGCaption"></div>').appendTo(!a.st.globalCaptionInside?a.slider:a._e1);a.globalCaption.html(a.currSlide.caption)}),a.ev.on("rsBeforeAnimStart",function(){a.globalCaption.html(a.currSlide.caption)}))}});b.rsModules.globalCaption=b.rsProto._d6})(jQuery);
// jquery.rs.nav-auto-hide v1.0
(function(b){b.extend(b.rsProto,{_e6:function(){var a=this;if(a.st.navAutoHide&&!a.hasTouch)a.ev.one("rsAfterInit",function(){if(a._k5){a._k5.addClass("rsHidden");var b=a.slider;b.one("mousemove.controlnav",function(){a._k5.removeClass("rsHidden")});b.hover(function(){a._k5.removeClass("rsHidden")},function(){a._k5.addClass("rsHidden")})}})}});b.rsModules.autoHideNav=b.rsProto._e6})(jQuery);
// jquery.rs.tabs v1.0.2
(function(e){e.extend(e.rsProto,{_f6:function(){var a=this;"tabs"===a.st.controlNavigation&&(a.ev.on("rsBeforeParseNode",function(a,d,b){d=e(d);b.thumbnail=d.find(".rsTmb").remove();b.thumbnail.length?b.thumbnail=e(document.createElement("div")).append(b.thumbnail).html():(b.thumbnail=d.attr("data-rsTmb"),b.thumbnail||(b.thumbnail=d.find(".rsImg").attr("data-rsTmb")),b.thumbnail=b.thumbnail?'<img src="'+b.thumbnail+'"/>':"")}),a.ev.one("rsAfterPropsSetup",function(){a._g6()}),a.ev.on("rsOnAppendSlide",
function(c,d,b){b>=a.numSlides?a._k5.append('<div class="rsNavItem rsTab">'+d.thumbnail+"</div>"):a._l5.eq(b).before('<div class="rsNavItem rsTab">'+item.thumbnail+"</div>");a._l5=a._k5.children()}),a.ev.on("rsOnRemoveSlide",function(c,d){var b=a._l5.eq(d);b&&(b.remove(),a._l5=a._k5.children())}),a.ev.on("rsOnUpdateNav",function(){var c=a.currSlideId;a._n5&&a._n5.removeClass("rsNavSelected");c=a._l5.eq(c);c.addClass("rsNavSelected");a._n5=c}))},_g6:function(){var a=this,c;a._j5=!0;c='<div class="rsNav rsTabs">';
for(var d=0;d<a.numSlides;d++)c+='<div class="rsNavItem rsTab">'+a.slides[d].thumbnail+"</div>";c=e(c+"</div>");a._k5=c;a._l5=c.children(".rsNavItem");a.slider.append(c);a._k5.click(function(b){b=e(b.target).closest(".rsNavItem");b.length&&a.goTo(b.index())})}});e.rsModules.tabs=e.rsProto._f6})(jQuery);
// jquery.rs.thumbnails v1.0.5
(function(f){f.extend(f.rsProto,{_h6:function(){var a=this;"thumbnails"===a.st.controlNavigation&&(a._i6={drag:!0,touch:!0,orientation:"horizontal",navigation:!0,arrows:!0,arrowLeft:null,arrowRight:null,spacing:4,arrowsAutoHide:!1,appendSpan:!1,transitionSpeed:600,autoCenter:!0,fitInViewport:!0,firstMargin:!0,paddingTop:0,paddingBottom:0},a.st.thumbs=f.extend({},a._i6,a.st.thumbs),a._j6=!0,!1===a.st.thumbs.firstMargin?a.st.thumbs.firstMargin=0:!0===a.st.thumbs.firstMargin&&(a.st.thumbs.firstMargin=
a.st.thumbs.spacing),a.ev.on("rsBeforeParseNode",function(a,c,b){c=f(c);b.thumbnail=c.find(".rsTmb").remove();b.thumbnail.length?b.thumbnail=f(document.createElement("div")).append(b.thumbnail).html():(b.thumbnail=c.attr("data-rsTmb"),b.thumbnail||(b.thumbnail=c.find(".rsImg").attr("data-rsTmb")),b.thumbnail=b.thumbnail?'<img src="'+b.thumbnail+'"/>':"")}),a.ev.one("rsAfterPropsSetup",function(){a._k6()}),a._n5=null,a.ev.on("rsOnUpdateNav",function(){var e=f(a._l5[a.currSlideId]);e!==a._n5&&(a._n5&&
(a._n5.removeClass("rsNavSelected"),a._n5=null),a._l6&&a._m6(a.currSlideId),a._n5=e.addClass("rsNavSelected"))}),a.ev.on("rsOnAppendSlide",function(e,c,b){e="<div"+a._n6+' class="rsNavItem rsThumb">'+a._o6+c.thumbnail+"</div>";b>=a.numSlides?a._s3.append(e):a._l5.eq(b).before(e);a._l5=a._s3.children();a.updateThumbsSize()}),a.ev.on("rsOnRemoveSlide",function(e,c){var b=a._l5.eq(c);b&&(b.remove(),a._l5=a._s3.children(),a.updateThumbsSize())}))},_k6:function(){var a=this,e="rsThumbs",c=a.st.thumbs,
b="",g,d,h=c.spacing;a._j5=!0;a._e3="vertical"===c.orientation?!1:!0;a._n6=g=h?' style="margin-'+(a._e3?"right":"bottom")+":"+h+'px;"':"";a._i3=0;a._p6=!1;a._m5=!1;a._l6=!1;a._q6=c.arrows&&c.navigation;d=a._e3?"Hor":"Ver";a.slider.addClass("rsWithThumbs rsWithThumbs"+d);b+='<div class="rsNav rsThumbs rsThumbs'+d+'"><div class="'+e+'Container">';a._o6=c.appendSpan?'<span class="thumbIco"></span>':"";for(var j=0;j<a.numSlides;j++)d=a.slides[j],b+="<div"+g+' class="rsNavItem rsThumb">'+d.thumbnail+a._o6+
"</div>";b=f(b+"</div></div>");g={};c.paddingTop&&(g[a._e3?"paddingTop":"paddingLeft"]=c.paddingTop);c.paddingBottom&&(g[a._e3?"paddingBottom":"paddingRight"]=c.paddingBottom);b.css(g);a._s3=f(b).find("."+e+"Container");a._q6&&(e+="Arrow",c.arrowLeft?a._r6=c.arrowLeft:(a._r6=f('<div class="'+e+" "+e+'Left"><div class="'+e+'Icn"></div></div>'),b.append(a._r6)),c.arrowRight?a._s6=c.arrowRight:(a._s6=f('<div class="'+e+" "+e+'Right"><div class="'+e+'Icn"></div></div>'),b.append(a._s6)),a._r6.click(function(){var b=
(Math.floor(a._i3/a._t6)+a._u6)*a._t6;a._a4(b>a._n3?a._n3:b)}),a._s6.click(function(){var b=(Math.floor(a._i3/a._t6)-a._u6)*a._t6;a._a4(b<a._o3?a._o3:b)}),c.arrowsAutoHide&&!a.hasTouch&&(a._r6.css("opacity",0),a._s6.css("opacity",0),b.one("mousemove.rsarrowshover",function(){a._l6&&(a._r6.css("opacity",1),a._s6.css("opacity",1))}),b.hover(function(){a._l6&&(a._r6.css("opacity",1),a._s6.css("opacity",1))},function(){a._l6&&(a._r6.css("opacity",0),a._s6.css("opacity",0))})));a._k5=b;a._l5=a._s3.children();
a.msEnabled&&a.st.thumbs.navigation&&a._s3.css("-ms-touch-action",a._e3?"pan-y":"pan-x");a.slider.append(b);a._w3=!0;a._v6=h;c.navigation&&a._e&&a._s3.css(a._g+"transition-property",a._g+"transform");a._k5.on("click.rs",".rsNavItem",function(){a._m5||a.goTo(f(this).index())});a.ev.off("rsBeforeSizeSet.thumbs").on("rsBeforeSizeSet.thumbs",function(){a._w6=a._e3?a._c4:a._b4;a.updateThumbsSize(!0)})},updateThumbsSize:function(){var a=this,e=a._l5.first(),c={},b=a._l5.length;a._t6=(a._e3?e.outerWidth():
e.outerHeight())+a._v6;a._y3=b*a._t6-a._v6;c[a._e3?"width":"height"]=a._y3+a._v6;a._z3=a._e3?a._k5.width():a._k5.height();a._o3=-(a._y3-a._z3)-a.st.thumbs.firstMargin;a._n3=a.st.thumbs.firstMargin;a._u6=Math.floor(a._z3/a._t6);if(a._y3<a._z3)a.st.thumbs.autoCenter&&a._q3((a._z3-a._y3)/2),a.st.thumbs.arrows&&a._r6&&(a._r6.addClass("rsThumbsArrowDisabled"),a._s6.addClass("rsThumbsArrowDisabled")),a._l6=!1,a._m5=!1,a._k5.off(a._j1);else if(a.st.thumbs.navigation&&!a._l6&&(a._l6=!0,!a.hasTouch&&a.st.thumbs.drag||
a.hasTouch&&a.st.thumbs.touch))a._m5=!0,a._k5.on(a._j1,function(b){a._g2(b,!0)});a._e&&(c[a._g+"transition-duration"]="0ms");a._s3.css(c);if(a._w3&&(a.isFullscreen||a.st.thumbs.fitInViewport))a._e3?a._c4=a._w6-a._k5.outerHeight():a._b4=a._w6-a._k5.outerWidth()},setThumbsOrientation:function(a,e){this._w3&&(this.st.thumbs.orientation=a,this._k5.remove(),this.slider.removeClass("rsWithThumbsHor rsWithThumbsVer"),this._k6(),this._k5.off(this._j1),e||this.updateSliderSize(!0))},_q3:function(a){this._i3=
a;this._e?this._s3.css(this._x1,this._y1+(this._e3?a+this._z1+0:0+this._z1+a)+this._a2):this._s3.css(this._e3?this._x1:this._w1,a)},_a4:function(a,e,c,b,g){var d=this;if(d._l6){e||(e=d.st.thumbs.transitionSpeed);d._i3=a;d._x6&&clearTimeout(d._x6);d._p6&&(d._e||d._s3.stop(),c=!0);var h={};d._p6=!0;d._e?(h[d._g+"transition-duration"]=e+"ms",h[d._g+"transition-timing-function"]=c?f.rsCSS3Easing[d.st.easeOut]:f.rsCSS3Easing[d.st.easeInOut],d._s3.css(h),d._q3(a)):(h[d._e3?d._x1:d._w1]=a+"px",d._s3.animate(h,
e,c?"easeOutCubic":d.st.easeInOut));b&&(d._i3=b);d._y6();d._x6=setTimeout(function(){d._p6=!1;g&&(d._a4(b,g,!0),g=null)},e)}},_y6:function(){this._q6&&(this._i3===this._n3?this._r6.addClass("rsThumbsArrowDisabled"):this._r6.removeClass("rsThumbsArrowDisabled"),this._i3===this._o3?this._s6.addClass("rsThumbsArrowDisabled"):this._s6.removeClass("rsThumbsArrowDisabled"))},_m6:function(a,e){var c=0,b,f=a*this._t6+2*this._t6-this._v6+this._n3,d=Math.floor(this._i3/this._t6);this._l6&&(this._j6&&(e=!0,
this._j6=!1),f+this._i3>this._z3?(a===this.numSlides-1&&(c=1),d=-a+this._u6-2+c,b=d*this._t6+this._z3%this._t6+this._v6-this._n3):0!==a?(a-1)*this._t6<=-this._i3+this._n3&&a-1<=this.numSlides-this._u6&&(b=(-a+1)*this._t6+this._n3):b=this._n3,b!==this._i3&&(c=void 0===b?this._i3:b,c>this._n3?this._q3(this._n3):c<this._o3?this._q3(this._o3):void 0!==b&&(e?this._q3(b):this._a4(b))),this._y6())}});f.rsModules.thumbnails=f.rsProto._h6})(jQuery);
// jquery.rs.video v1.1.1
(function(f){f.extend(f.rsProto,{_z6:function(){var a=this;a._a7={autoHideArrows:!0,autoHideControlNav:!1,autoHideBlocks:!1,autoHideCaption:!1,disableCSS3inFF:!0,youTubeCode:'<iframe src="http://www.youtube.com/embed/%id%?rel=1&autoplay=1&showinfo=0&autoplay=1&wmode=transparent" frameborder="no"></iframe>',vimeoCode:'<iframe src="http://player.vimeo.com/video/%id%?byline=0&amp;portrait=0&amp;autoplay=1" frameborder="no" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'};a.st.video=
f.extend({},a._a7,a.st.video);a.ev.on("rsBeforeSizeSet",function(){a._b7&&setTimeout(function(){var b=a._r1,b=b.hasClass("rsVideoContainer")?b:b.find(".rsVideoContainer");a._c7&&a._c7.css({width:b.width(),height:b.height()})},32)});var c=a._a.mozilla;a.ev.on("rsAfterParseNode",function(b,e,d){b=f(e);if(d.videoURL){a.st.video.disableCSS3inFF&&c&&(a._e=a._f=!1);e=f('<div class="rsVideoContainer"></div>');var g=f('<div class="rsBtnCenterer"><div class="rsPlayBtn"><div class="rsPlayBtnIcon"></div></div></div>');
b.hasClass("rsImg")?d.content=e.append(b).append(g):d.content.find(".rsImg").wrap(e).after(g)}});a.ev.on("rsAfterSlideChange",function(){a.stopVideo()})},toggleVideo:function(){return this._b7?this.stopVideo():this.playVideo()},playVideo:function(){var a=this;if(!a._b7){var c=a.currSlide;if(!c.videoURL)return!1;var b=a._d7=c.content,c=c.videoURL,e,d;c.match(/youtu\.be/i)||c.match(/youtube\.com/i)?(d=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,(d=c.match(d))&&11==
d[7].length&&(e=d[7]),void 0!==e&&(a._c7=a.st.video.youTubeCode.replace("%id%",e))):c.match(/vimeo\.com/i)&&(d=/(www\.)?vimeo.com\/(\d+)($|\/)/,(d=c.match(d))&&(e=d[2]),void 0!==e&&(a._c7=a.st.video.vimeoCode.replace("%id%",e)));a.videoObj=f(a._c7);a.ev.trigger("rsOnCreateVideoElement",[c]);a.videoObj.length&&(a._c7=f('<div class="rsVideoFrameHolder"><div class="rsPreloader"></div><div class="rsCloseVideoBtn"><div class="rsCloseVideoIcn"></div></div></div>'),a._c7.find(".rsPreloader").after(a.videoObj),
b=b.hasClass("rsVideoContainer")?b:b.find(".rsVideoContainer"),a._c7.css({width:b.width(),height:b.height()}).find(".rsCloseVideoBtn").off("click.rsv").on("click.rsv",function(b){a.stopVideo();b.preventDefault();b.stopPropagation();return!1}),b.append(a._c7),a.isIPAD&&b.addClass("rsIOSVideo"),a._e7(!1),setTimeout(function(){a._c7.addClass("rsVideoActive")},10),a.ev.trigger("rsVideoPlay"),a._b7=!0);return!0}return!1},stopVideo:function(){var a=this;return a._b7?(a.isIPAD&&a.slider.find(".rsCloseVideoBtn").remove(),
a._e7(!0),setTimeout(function(){a.ev.trigger("rsOnDestroyVideoElement",[a.videoObj]);var c=a._c7.find("iframe");if(c.length)try{c.attr("src","")}catch(b){}a._c7.remove();a._c7=null},16),a.ev.trigger("rsVideoStop"),a._b7=!1,!0):!1},_e7:function(a){var c=[],b=this.st.video;b.autoHideArrows&&(this._c2&&(c.push(this._c2,this._d2),this._e2=!a),this._v5&&c.push(this._v5));b.autoHideControlNav&&this._k5&&c.push(this._k5);b.autoHideBlocks&&this.currSlide.animBlocks&&c.push(this.currSlide.animBlocks);b.autoHideCaption&&
this.globalCaption&&c.push(this.globalCaption);if(c.length)for(b=0;b<c.length;b++)a?c[b].removeClass("rsHidden"):c[b].addClass("rsHidden")}});f.rsModules.video=f.rsProto._z6})(jQuery);
// jquery.rs.visible-nearby v1.0.2
(function(d){d.rsProto._f7=function(){var a=this;a.st.visibleNearby&&a.st.visibleNearby.enabled&&(a._g7={enabled:!0,centerArea:0.6,center:!0,breakpoint:0,breakpointCenterArea:0.8,hiddenOverflow:!0,navigateByCenterClick:!1},a.st.visibleNearby=d.extend({},a._g7,a.st.visibleNearby),a.ev.one("rsAfterPropsSetup",function(){a._h7=a._e1.css("overflow","visible").wrap('<div class="rsVisibleNearbyWrap"></div>').parent();a.st.visibleNearby.hiddenOverflow||a._h7.css("overflow","visible");a._o1=a.st.controlsInside?
a._h7:a.slider}),a.ev.on("rsAfterSizePropSet",function(){var b,c=a.st.visibleNearby;b=c.breakpoint&&a.width<c.breakpoint?c.breakpointCenterArea:c.centerArea;a._h?(a._b4*=b,a._h7.css({height:a._c4,width:a._b4/b}),a._d=a._b4*(1-b)/2/b):(a._c4*=b,a._h7.css({height:a._c4/b,width:a._b4}),a._d=a._c4*(1-b)/2/b);c.navigateByCenterClick||(a._q=a._h?a._b4:a._c4);c.center&&a._e1.css("margin-"+(a._h?"left":"top"),a._d)}))};d.rsModules.visibleNearby=d.rsProto._f7})(jQuery);
;(function ($){
    /**
     *
     * RoyalSlider trigger global ready module
     * @author johannes.weil@bb-k.com
     * @date 2014-04-09
     * @version 1.0:
     *
     *
     *
     * What it does?
     *
     * Registers all sliders to the global slider handler.
     * Listen to ready event on all sliders with option triggerGlobalReady = true.
     *
     *
     * What it not does?
     *
     * Automatically listen to all slider ready events.
     *
     *
     * Very important notice:
     *
     * All sliders with triggerGlobalReady = true also have to register over markup selector
     * via the configuration object GLOBAL_CONFIG.royalSliderHandler.sliderWrapperClassNames.
     * Otherwise the module will fail.
     * Use this only for sliders that are initialized on document ready.
     *
     */
    if (typeof $ != 'undefined' && typeof GLOBAL_CONFIG == 'object')
    {
        /*
         * Init global royalSliderHandler
         */
        GLOBAL_CONFIG.royalSliderHandler = {
            sliderWrapperClassNames: [
                '.m-04-intro-section-home-slider',
                //'.m-06-social-hub',
                '.m-08-features-slider'
            ],
            readyEvent: "royalSliderHandler-ReadyEvent",
            ready: false,
            sliders: [],
            sliderReadyCount: 0,
            sliderCount: 0
        };

        /*
         * On DOM ready check
         */
        $(document).ready(function ()
        {
            GLOBAL_CONFIG.royalSliderHandler.sliderCount = $(GLOBAL_CONFIG.royalSliderHandler.sliderWrapperClassNames.join(',')).length;

            // Check for hash and sliders to adjust position
            if(location.hash != '' && GLOBAL_CONFIG.royalSliderHandler.sliderCount > 0)
            {
                $(document).on(GLOBAL_CONFIG.royalSliderHandler.readyEvent, updateAnchorOnSliderReady);
            }
        });

        /*
         * Extend RoyalSlider prototype to trigger on ready
         */
        $.extend($.rsProto, {
            _triggerGlobalReady: function ()
            {
                var self = this;

                // Register the slider to the global slider handler
                registerSlider(self);

                // Check if this slider should trigger to the global ready event
                if (self.st.triggerGlobalReady)
                {
                    // Listen to the sliders own ready event
                    self.ev.on('rsAfterInit', onAfterInit);
                }

                function onAfterInit(evt, data)
                {
                    // Increase global slider handlers ready count
                    GLOBAL_CONFIG.royalSliderHandler.sliderReadyCount++;
                    // Trigger global slider ready event if all global sliders are ready
                    if (GLOBAL_CONFIG.royalSliderHandler.sliderCount == 0 || GLOBAL_CONFIG.royalSliderHandler.sliderReadyCount >= GLOBAL_CONFIG.royalSliderHandler.sliderCount)
                    {
                        triggerTheRSGlobalReadyEvent();
                    }
                }

                // Trigger the global slider ready event
                function triggerTheRSGlobalReadyEvent()
                {
                    // On timeout to have some time for calculation
                    window.setTimeout(function ()
                    {
                        GLOBAL_CONFIG.royalSliderHandler.ready = true;
                        $(document).trigger(GLOBAL_CONFIG.royalSliderHandler.readyEvent);
                    }, 1000);
                }

                // Register the slider to the global slider handler
                function registerSlider(rs)
                {
                    GLOBAL_CONFIG.royalSliderHandler.sliders.push(rs);
                }
            }
        });

        // Register the triggerGlobalReady Module
        $.rsModules.triggerGlobalReady = $.rsProto._triggerGlobalReady;


        /*
         * Functions
         */

        // Update anchor position on slider ready
        function updateAnchorOnSliderReady()
        {
            $(document).off(GLOBAL_CONFIG.royalSliderHandler.readyEvent, updateAnchorOnSliderReady);

            if (location.hash.indexOf('#from') >= 0) {
              return;
            }

            var h = location.hash.replace(/#/, ''),
                to = $('#' + h);

            if (to.length > 0)
            {
                var top = to.position().top;
                $('html, body').stop(true, true).scrollTop(top);
            }
        }
    }
})(jQuery);// 
//  Copyright (c) 2009-2013 Petr Vostrel (http://petr.vostrel.cz/)
// Licensed under the MIT License (LICENSE.txt).
// 
// jQuery Reel
// http://reel360.org
// Version: 1.3.0
// Updated: 2013-11-04
//
//Requires jQuery 1.6.2 or higher
(function(k) { var U = typeof define == "function" && define.amd && (define(["jquery"], k) || true),
        X = !U && typeof module == "object" && typeof module.exports == "object" && (module.exports = k);!U && !X && k() })(function() {
    return jQuery.reel || function(k, U, X, s) {
        function Bc(f) { return n.instances.push(f[0]) && f }

        function Cc(f) { return (n.instances = n.instances.not(Ca(f.attr(ka)))) && f }

        function Y(f) { return n.instances.first().data(f) }

        function Dc(f) { return "data:image/gif;base64,R0lGODlh" + f }

        function V(f) { return "<" + f + "/>" }

        function x(f) {
            return "." +
                (f || "")
        }

        function Va(f) { return f.replace(Da, n.cdn) }

        function Ea(f) { return "url('" + $b(f) + "')" }

        function ac(f, j) { return typeof j == tb ? j[f] : j }

        function Fa(f, j, o) { return ub(f, Ga(j, o)) }

        function Ha(f, j) { return H(f) * (j ? -1 : 1) }

        function Wa(f) { return f.touch || f.originalEvent.touches && f.originalEvent.touches[0] || f }

        function vb(f) { return f.originalEvent }

        function y(f) { return f === s ? 0 : typeof f == wb ? f : f + "px" }

        function Ca(f) { return "#" + f }

        function bc(f, j, o) { for (; f.length < j;) f = o + f; return f }

        function xb(f) { return bc(f, 2, "0") }

        function $b(f) { return encodeURI(decodeURI(f)) }

        function yb(f) { return n.re.array.exec(f) ? f.split(n.re.array) : f }

        function Ec(f) { return !f.parents(zb).length }

        function cc(f) { return typeof f == wb ? f : k.each(f, function(j, o) { f[j] = o ? +o : s }) }

        function Ab(f) { try { console.error("[ Reel ] " + f) } catch (j) {} }
        if (k) {
            var Z = k && k().jquery.split(/\./);
            if (!Z || +(xb(Z[0]) + xb(Z[1]) + xb(Z[2] || "")) < 10602) return Ab("Too old jQuery library. Please upgrade your jQuery to version 1.6.2 or higher");
            var n = k.reel = {
                    version: "1.3.0",
                    def: {
                        frame: 1,
                        frames: 36,
                        loops: true,
                        clickfree: false,
                        draggable: true,
                        scrollable: true,
                        steppable: true,
                        throwable: true,
                        wheelable: true,
                        orientable: false,
                        cw: false,
                        revolution: s,
                        stitched: 0,
                        directional: false,
                        row: 1,
                        rows: 0,
                        rowlock: false,
                        framelock: false,
                        orbital: 0,
                        vertical: false,
                        inversed: false,
                        footage: 6,
                        spacing: 0,
                        horizontal: true,
                        suffix: "-reel",
                        image: s,
                        images: "",
                        path: "",
                        preload: "fidelity",
                        shy: false,
                        speed: 0,
                        delay: 0,
                        timeout: 2,
                        duration: s,
                        rebound: 0.5,
                        entry: s,
                        opening: 0,
                        brake: 0.23,
                        velocity: 0,
                        tempo: 36,
                        laziness: 6,
                        cursor: s,
                        hint: "",
                        indicator: 0,
                        klass: "",
                        preloader: 2,
                        area: s,
                        attr: {},
                        annotations: s,
                        responsive: false,
                        graph: s,
                        monitor: s
                    },
                    scan: function() { return k(x(z) + ":not(" + x(Bb) + " > " + x(z) + ")").each(function(f, j) { f = k(j);
                            j = f.data();
                            j.images = yb(j.images); var o = {};
                            k(x(dc) + "[data-for=" + f.attr(ka) + "]").each(function(t, r) { t = k(r);
                                r = t.data();
                                r.x = cc(yb(r.x));
                                r.y = cc(yb(r.y)); var g = t.attr(ka);
                                r.node = t.removeData();
                                o[g] = r });
                            j.annotations = o;
                            f.removeData().reel(j) }) },
                    fn: {
                        reel: function() {
                            var f = arguments,
                                j = k(this),
                                o = j.data(),
                                t = f[0] || {},
                                r = f[1];
                            if (typeof t != "object")
                                if (t.slice(0, 1) == ":") return j.trigger(t.slice(1),
                                    r);
                                else if (f.length == 1) return o[t];
                            else { if (r !== s) { n.normal[t] && (r = n.normal[t](r, o)); if (o[t] === s) o[t] = r;
                                    else if (o[t] !== r) j.trigger(t + "Change", [s, o[t] = r]) } return j } else {
                                var g = k.extend({}, n.def, t),
                                    K = [];
                                j.filter(Xa).unreel().filter(function() { var h = k(this),
                                        e = g.attr,
                                        a = e.src || h.attr(ra),
                                        I = e.width || h.attr(L) || h.width();
                                    h = e.height || h.attr(D) || h.height(); if (!a) return Ab("`src` attribute missing on target image"); if (!I || !h) return Ab("Dimension(s) of the target image unknown"); return true }).each(function() {
                                    var h =
                                        k(this),
                                        e = function(c, d) { return h.reel(c, d) && a(c) },
                                        a = function(c) { return h.data(c) },
                                        I = {
                                            setup: function() {
                                                if (!(h.hasClass(z) && h.parent().hasClass(Bb))) {
                                                    e(Ia, g);
                                                    var c = { src: h.attr(ra), width: h.attr(D) || null, height: h.attr(L) || null, style: h.attr($) || null, "class": h.attr(ec) || null },
                                                        d = h.attr(g.attr).attr(ra),
                                                        b = e(ka, h.attr(ka) || h.attr(ka, z + "-" + +new Date).attr(ka)),
                                                        i = k.extend({}, h.data()),
                                                        p = e(aa, g.images || []),
                                                        m = e(W, g.stitched),
                                                        l = !p.length || m;
                                                    l = e(Ya, g.responsive && (Fc ? true : !l));
                                                    var q = e(fc, {}),
                                                        u = g.loops,
                                                        v = g.orbital,
                                                        E = g.revolution,
                                                        ba = g.rows,
                                                        ca = e(sa, Ga(g.footage, g.frames));
                                                    e(Za, g.spacing);
                                                    var Cb = e(D, +h.attr(D) || h.width()),
                                                        Db = e(L, +h.attr(L) || h.height()),
                                                        Gc = e(Ja, g.shy),
                                                        gc = e(O, v && ca || ba <= 1 && p.length || g.frames),
                                                        Hc = ba > 1 || v;
                                                    e(Ka, ac("x", E) || m / 2 || Cb * 2);
                                                    e(Eb, !Hc ? 0 : ac("y", E) || (ba > 3 ? Db : Db / (5 - ba)));
                                                    ba = m ? 1 : la(gc / ca);
                                                    e(Fb, m - (u ? 0 : Cb));
                                                    e($a, 0);
                                                    b = Ca(b + g.suffix);
                                                    u = h.attr(ec);
                                                    u = !u ? P : u + A;
                                                    u = k(V(ta), { id: b.substr(1), "class": u + A + Bb + A + hc + "0" });
                                                    u = h.wrap(u.addClass(g.klass)).addClass(z);
                                                    K.push(Bc(u)[0]);
                                                    u = u.parent().bind(I.instance);
                                                    e(Gb,
                                                        p.length ? P : g.image || d.replace(n.re.image, "$1" + g.suffix + ".$2"));
                                                    e(ab, k(V(ta), { "class": Hb }).appendTo("body"));
                                                    e(La, k());
                                                    e(ic, []);
                                                    e(J, null);
                                                    e(B, null);
                                                    e(Q, g.row);
                                                    e(ua, 0);
                                                    e(Ib, ba);
                                                    e(jc, g.rowlock);
                                                    e(kc, g.framelock);
                                                    e(bb, e(Ma, e(cb, 0)));
                                                    e(db, 1 / gc);
                                                    e(lc, b);
                                                    e(M, e(va, g.speed) < 0);
                                                    e(Na, false);
                                                    e(ma, 0);
                                                    e(wa, g.vertical);
                                                    e(da, 0);
                                                    e(xa, Ha(1, !g.cw && !m));
                                                    e(eb, {});
                                                    e(ea, false);
                                                    e(fb, e(Jb, 0));
                                                    e(gb, e(hb, 0));
                                                    e(Oa, false);
                                                    e(Kb, false);
                                                    e(fa, false);
                                                    e(mc, g.brake);
                                                    e(Lb, !!v);
                                                    e(ga, g.tempo / (n.lazy ? g.laziness : 1));
                                                    e(ya, -1);
                                                    e(ib, -1);
                                                    e(Pa,
                                                        g.annotations || u.unbind(x(Pa)) && {});
                                                    e(Mb, 1);
                                                    e(nc, { attr: c, data: i });
                                                    g.steppable || u.unbind("up.steppable");
                                                    g.indicator || u.unbind(".indicator");
                                                    C(P, { overflow: Nb, position: "relative" });
                                                    l || C(P, { width: Cb, height: Db });
                                                    l && k.each(Ic, function(cd, oc) { q[oc] = a(oc) });
                                                    C(na + A + x(z), { display: Ob });
                                                    C(x(Hb), { position: "fixed", left: y(-100), top: y(-100) }, true);
                                                    C(x(Hb) + A + Xa, { position: Qa, width: 10, height: 10 }, true);
                                                    ha.bind(I.pool);
                                                    h.trigger(Gc ? "prepare" : "setup")
                                                }
                                            },
                                            instance: {
                                                teardown: function() {
                                                    var c = h.data(nc);
                                                    h.parent().unbind(I.instance);
                                                    if (a(Ja)) h.parent().unbind(jb, ia);
                                                    else a($).remove() && a(La).unbind(F);
                                                    a(ab).empty();
                                                    clearTimeout(Pb);
                                                    clearTimeout(Qb);
                                                    k(U).unbind(pc, qc);
                                                    k(U).unbind(F);
                                                    ha.unbind(I.pool);
                                                    oa.unbind(ja);
                                                    h.siblings().unbind(F).remove();
                                                    kb();
                                                    h.removeAttr("onloaded");
                                                    Cc(h.unbind(F).removeData().unwrap().attr(c.attr).data(c.data));
                                                    h.attr($) == P && h.removeAttr($)
                                                },
                                                setup: function() {
                                                    function c(q) { return h.trigger("down", [Wa(q).clientX, Wa(q).clientY, q]) && q.give }

                                                    function d(q, u) { return !u || h.trigger("wheel", [u, q]) && q.give }
                                                    var b =
                                                        h.parent().append(za()),
                                                        i = e(La, k(g.area || b)),
                                                        p = g.rows > 1,
                                                        m = g.cursor,
                                                        l = m == rc ? Jc : m || Kc;
                                                    m = m == rc ? Lc + A + "!important" : s;
                                                    C(A + x(z), { MozUserSelect: lb, WebkitUserSelect: lb, MozTransform: "translateZ(0)" });
                                                    h.unbind(jb, ia);
                                                    i.bind(Mc, c).bind(g.clickfree ? Nc : Oc, c).bind(g.wheelable ? Pc : null, d).bind(Qc, function() { return false });
                                                    C(P, { cursor: Va(l) });
                                                    C(x(Rb), { cursor: "wait" });
                                                    C(x(mb) + na + x(mb) + " *", { cursor: Va(m || l) }, true);
                                                    if (a(Ya)) { C(A + x(z), { width: "100%", height: Sb });
                                                        k(U).bind(pc, qc) }
                                                    g.hint && i.attr("title", g.hint);
                                                    g.indicator &&
                                                        b.append(Ra("x"));
                                                    p && g.indicator && b.append(Ra("y"));
                                                    g.monitor && b.append(sc = k(V(ta), { "class": tc })) && C(A + x(tc), { position: Qa, left: 0, top: 0 })
                                                },
                                                preload: function() {
                                                    function c() { var q = l.children(":not([src]):first"); return q.attr(ra, q.data(ra)) }
                                                    var d = h.parent(),
                                                        b = a(aa),
                                                        i = !b.length,
                                                        p = n.preload[g.preload] || n.preload[n.def.preload];
                                                    b = i ? [a(Gb)] : p(b.slice(0), g, a);
                                                    e(da, i ? 0.5 : 0);
                                                    var m = 0,
                                                        l = a(ab).empty();
                                                    i = [];
                                                    d.addClass(Rb);
                                                    e($, a($) || k("<" + $ + ' type="text/css">' + C.rules.join("\n") + "</" + $ + ">").prependTo(Tb));
                                                    e(Na, true);
                                                    h.trigger("stop");
                                                    g.responsive && Ub();
                                                    for (h.trigger("resize", true); b.length;) { p = n.substitute(g.path + b.shift(), a);
                                                        k(V(Xa)).data(ra, p).appendTo(l).bind("load error abort", function(q) { q.type != "load" && h.trigger(q.type); return !Ec(d) && h.trigger("preloaded") && c() && false });
                                                        i.push(p) }
                                                    setTimeout(function() { for (; ++m < n.concurrent_requests;) c() }, 0);
                                                    e(ic, i);
                                                    e(Ja, false)
                                                },
                                                preloaded: function() {
                                                    var c = a(aa).length || 1,
                                                        d = e(da, Ga(a(da) + 1, c));
                                                    d === 1 && h.trigger("frameChange", [s, a(J)]);
                                                    if (d === c) {
                                                        h.parent().removeClass(Rb);
                                                        h.trigger("loaded")
                                                    }
                                                },
                                                loaded: function() { a(aa).length > 1 || h.css({ backgroundImage: Ea(n.substitute(g.path + a(Gb), a)) }).attr({ src: Va(uc) });
                                                    a(W) && h.attr({ src: Va(uc) });
                                                    a(Kb) || e(ma, g.velocity || 0);
                                                    e(Na, false);
                                                    pa = true },
                                                prepare: function() { h.css("display", Ob).parent().one(jb, ia) },
                                                opening: function() { if (!g.opening) return h.trigger("openingDone");
                                                    e(fa, true);
                                                    e(Vb, !a(va)); var c = g.entry || g.speed,
                                                        d = a(B),
                                                        b = g.opening;
                                                    e(B, d - c * b);
                                                    e(ya, la(b * Y(ga))) },
                                                openingDone: function() {
                                                    function c(b) {
                                                        return h.trigger("orient", [vb(b).alpha,
                                                            vb(b).beta, vb(b).gamma, b
                                                        ]) && b.give
                                                    }
                                                    e(Sa, false);
                                                    e(fa, false);
                                                    var d = nb + x(fa);
                                                    ha.unbind(d, I.pool[d]);
                                                    g.orientable && k(U).bind(Rc, c);
                                                    if (g.delay > 0) Pb = setTimeout(function() { h.trigger("play") }, g.delay * 1E3);
                                                    else h.trigger("play")
                                                },
                                                play: function(c, d) { d = d ? e(va, d) : a(va) * Ha(1, a(M));
                                                    (c = g.duration) && e(ib, la(c * Y(ga)));
                                                    e(M, d < 0);
                                                    d = e(Sa, !!d);
                                                    e(Vb, !d);
                                                    Aa() },
                                                reach: function(c, d, b) { if (d != a(J)) { c = a(O);
                                                        e(Q, la(d / c)); var i = e(bb, a(J));
                                                        d = e(Ma, d);
                                                        d = e(cb, n.math.distance(i, d, c));
                                                        b = H(b || a(va)) * Ha(1, d < 0);
                                                        h.trigger("play", b) } },
                                                pause: function() { w() },
                                                stop: function() { var c = e(Vb, true);
                                                    e(Sa, !c) },
                                                down: function(c, d, b, i) {
                                                    function p(l) { return h.trigger("pan", [Wa(l).clientX, Wa(l).clientY, l]) && l.give }

                                                    function m(l) { return h.trigger("up", [l]) && l.give } if (!(!g.clickfree && i && i.button !== s && i.button != Sc))
                                                        if (g.draggable) { e(ea, a(J));
                                                            c = g.clickfree;
                                                            e(ma, 0);
                                                            i = c ? a(La) : oa;
                                                            ob = pb(a(Ka), d, b);
                                                            w();
                                                            kb();
                                                            G = 0;
                                                            k(zb, oa).addClass(mb);
                                                            i.bind(Tc + A + Uc, p).bind(Vc + A + Wc, m).bind(c ? Xc : Yc, m) } },
                                                up: function() {
                                                    e(ea, false);
                                                    e(Oa, false);
                                                    var c = g.throwable,
                                                        d = H(Ta[0] + Ta[1]) / 60;
                                                    N = e(ma, !c ? 0 : c ===
                                                        true ? d : Ga(c, d)) ? 1 : 0;
                                                    w();
                                                    kb();
                                                    k(zb, oa).removeClass(mb);
                                                    (g.clickfree ? a(La) : oa).unbind(ja)
                                                },
                                                pan: function(c, d, b, i) {
                                                    if (g.draggable && Ua) {
                                                        Ua = false;
                                                        w();
                                                        c = g.rows;
                                                        var p = g.orbital,
                                                            m = !a(Oa) && c <= 1 && !p && g.scrollable,
                                                            l = { x: d - ob.x, y: b - ob.y },
                                                            q = { x: H(l.x), y: H(l.y) };
                                                        if (i && m && q.x < q.y) return i.give = true;
                                                        if (q.x > 0 || q.y > 0) {
                                                            i && (i.give = false);
                                                            G = ub(q.x, q.y);
                                                            ob = { x: d, y: b };
                                                            i = a(Ka);
                                                            m = a(eb);
                                                            q = a(wa);
                                                            if (!a(kc)) {
                                                                var u = e(B, vc(q ? b - m.y : d - m.x, a(fb), i, a(gb), a(hb), a(xa), q ? b - m.y : d - m.x));
                                                                e(Oa, a(Oa) || a(J) != a(ea));
                                                                (l = wc(q ? l.y : l.x || 0)) && e(M, l <
                                                                    0)
                                                            }
                                                            if (p && a(Lb)) { e(wa, H(b - m.y) > H(d - m.x));
                                                                m = pb(i, d, b) }
                                                            if (c > 1 && !a(jc)) { c = a(Eb);
                                                                p = a(Jb);
                                                                l = -p * c;
                                                                e(ua, n.math.envelope(b - m.y, p, c, l, l + c, -1)) }!(u % 1) && !g.loops && pb(i, d, b)
                                                        }
                                                    }
                                                },
                                                wheel: function(c, d, b) { if (d) { qb = true;
                                                        c = la(qa.sqrt(H(d)) / 2);
                                                        c = Ha(c, d > 0);
                                                        d = 0.0833 * a(Ka);
                                                        pb(d);
                                                        c && e(M, c < 0);
                                                        e(ma, 0);
                                                        e(B, vc(c, a(fb), d, a(gb), a(hb), a(xa)));
                                                        b && b.preventDefault();
                                                        b && (b.give = false);
                                                        w();
                                                        h.trigger("up", [b]) } },
                                                orient: function(c, d) { if (!(!Ua || R)) { xc = true;
                                                        c = d / 360;
                                                        fraction = e(B, +(g.stitched || g.cw ? 1 - c : c).toFixed(2));
                                                        Ua = false } },
                                                fractionChange: function(c,
                                                    d, b) { if (d === s) { c = 1 + rb(b / a(db));
                                                        d = g.rows > 1;
                                                        b = g.orbital;
                                                        e(Lb, !!b && (c <= b || c >= a(sa) - b + 2)); if (d) c += (a(Q) - 1) * a(O);
                                                        e(J, c) } },
                                                tierChange: function(c, d, b) { if (d === s) { c = e(Q, S(Wb(b, 1, g.rows)));
                                                        d = a(O);
                                                        b = a(J) % d || d;
                                                        e(J, b + c * d - d) } },
                                                rowChange: function(c, d, b) { d === s && Xb(ua, s, b, g.rows) },
                                                frameChange: function(c, d, b) {
                                                    if (d === s) {
                                                        this.className = this.className.replace(n.re.frame_klass, hc + b);
                                                        c = a(O);
                                                        d = g.rows;
                                                        var i = g.path,
                                                            p = b % c || c,
                                                            m = ((b - p) / c + 1 - 1) / (d - 1),
                                                            l = a(Q);
                                                        !d ? a(ua) : Xb(ua, m, l, d);
                                                        var q = Xb(B, s, p, c),
                                                            u = a(sa);
                                                        if (g.orbital && a(wa)) {
                                                            b =
                                                                g.inversed ? u + 1 - b : b;
                                                            b += u
                                                        }
                                                        var v = a(W);
                                                        c = a(aa);
                                                        if (!c.length || v) { p = a(Za); var E = a(D);
                                                            m = a(L); if (v) { b = e($a, S(Wb(q, 0, a(Fb))) % v);
                                                                d = d <= 1 ? 0 : (m + p) * (d - l);
                                                                b = [y(-b), y(-d)];
                                                                c = c.length > 1 && c[l - 1];
                                                                d = n.substitute(i + c, a);
                                                                c && h.css("backgroundImage").search(d) < 0 && h.css({ backgroundImage: Ea(d) }) } else { i = g.horizontal;
                                                                l = b % u - 1;
                                                                l = l < 0 ? u - 1 : l;
                                                                b = rb((b - 0.1) / u);
                                                                b += d > 1 ? 0 : a(M) ? 0 : !g.directional ? 0 : a(Ib);
                                                                b = b * ((i ? m : E) + p);
                                                                d = l * ((i ? E : m) + p);
                                                                b = c.length ? [0, 0] : i ? [y(-d), y(-b)] : [y(-b), y(-d)] }
                                                            h.css({ backgroundPosition: b.join(A) }) } else {
                                                            a(Ya) && Ub();
                                                            a(da) &&
                                                                h.attr({ src: $b(n.substitute(i + c[b - 1], a)) })
                                                        }
                                                    }
                                                },
                                                "frameChange.reach": function(c, d, b) { if (!(!a(Ma) || d !== s)) { c = n.math.distance(a(bb), b, a(O)); if (H(c) >= H(a(cb))) { e(J, e(Ma));
                                                            e(Ma, e(cb, e(bb, 0)));
                                                            h.trigger("stop") } } },
                                                "imageChange imagesChange": function() { h.trigger("preload") },
                                                "fractionChange.indicator": function(c, d, b) {
                                                    if (g.indicator && d === s) {
                                                        c = g.indicator;
                                                        var i = g.orbital;
                                                        d = i && a(wa) ? a(L) : a(D);
                                                        i = i ? a(sa) : g.images.length || a(O);
                                                        i = la(d / i);
                                                        d -= i;
                                                        b = S(Wb(b, 0, d));
                                                        b = !g.cw || a(W) ? b : d - b;
                                                        Ra.$x.css(a(wa) ? {
                                                            left: 0,
                                                            top: y(b),
                                                            bottom: Sb,
                                                            width: c,
                                                            height: i
                                                        } : { bottom: 0, left: y(b), top: Sb, width: i, height: c })
                                                    }
                                                },
                                                "tierChange.indicator": function(c, d, b) { if (g.rows > 1 && g.indicator && d === s) { var i = a(L);
                                                        c = g.indicator;
                                                        d = la(i / g.rows);
                                                        i -= d;
                                                        b = S(b * i);
                                                        Ra.$y.css({ left: 0, top: b, width: c, height: d }) } },
                                                "setup.annotations": function() {
                                                    var c = h.parent();
                                                    k.each(a(Pa), function(d, b) {
                                                        var i = typeof b.node == wb ? k(b.node) : b.node || {};
                                                        i = i.jquery ? i : k(V(ta), i);
                                                        i = i.attr({ id: d }).addClass(dc);
                                                        var p = b.image ? k(V(Xa), b.image) : k(),
                                                            m = b.link ? k(V("a"), b.link).click(function() {
                                                                h.trigger("up.annotations", { target: m })
                                                            }) : k();
                                                        C(Ca(d), { display: lb, position: Qa }, true);
                                                        b.image || b.link && i.append(m);
                                                        b.link || b.image && i.append(p);
                                                        b.link && b.image && i.append(m.append(p));
                                                        i.appendTo(c)
                                                    })
                                                },
                                                "prepare.annotations": function() { k.each(a(Pa), function(c) { k(Ca(c)).hide() }) },
                                                "frameChange.annotations": function(c, d) {
                                                    if (!(!a(da) || d !== s)) {
                                                        var b = a(D),
                                                            i = a(W),
                                                            p = a($a);
                                                        k.each(a(Pa), function(m, l) {
                                                            m = k(Ca(m));
                                                            var q = l.start || 1,
                                                                u = l.end,
                                                                v = v || a(J),
                                                                E = v - 1,
                                                                ba = l.at ? l.at[E] == "+" : false;
                                                            E = l.at ? E : E - q + 1;
                                                            v = typeof l.x != tb ? l.x : l.x[E];
                                                            var ca = typeof l.y !=
                                                                tb ? l.y : l.y[E];
                                                            l = v !== s && ca !== s && (l.at ? ba : E >= 0 && (!u || E <= u - q));
                                                            if (i) { q = v > i - b && p >= 0 && p < b;
                                                                v = !(v < b && p > i - b) ? v : v + i;
                                                                v = !q ? v : v - i;
                                                                v -= p }
                                                            if (a(Ya)) { q = a(Mb);
                                                                v = v && v * q;
                                                                ca = ca && ca * q }
                                                            v = { display: l ? Ob : lb, left: y(v), top: y(ca) };
                                                            m.css(v)
                                                        })
                                                    }
                                                },
                                                "up.annotations": function(c, d) { if (!(G > 10 || qb)) { c = k(d.target);
                                                        (c.is("a") ? c : c.parents("a")).attr("href") && (G = 10) } },
                                                "up.steppable": function() { G || qb || h.trigger(a(eb).x - h.offset().left > 0.5 * a(D) ? "stepRight" : "stepLeft") },
                                                "stepLeft stepRight": function() { w() },
                                                stepLeft: function() {
                                                    e(M, false);
                                                    e(B,
                                                        a(B) - a(db) * a(xa))
                                                },
                                                stepRight: function() { e(M, true);
                                                    e(B, a(B) + a(db) * a(xa)) },
                                                stepUp: function() { e(Q, a(Q) - 1) },
                                                stepDown: function() { e(Q, a(Q) + 1) },
                                                resize: function(c, d) { if (!(a(Na) && !d)) { var b = a(W),
                                                            i = a(Za);
                                                        c = a(L); var p = !a(aa).length || b,
                                                            m = g.rows || 1;
                                                        b = a(aa).length ? !b ? s : y(b) + A + y(c) : b && y(b) + A + y((c + i) * m - i) || y((a(D) + i) * a(sa) - i) + A + y((c + i) * a(Ib) * m * (g.directional ? 2 : 1) - i);
                                                        h.css({ height: p ? y(c) : null, backgroundSize: b || null });
                                                        d || h.trigger("imagesChange") } },
                                                "setup.fu": function() { e(J, g.frame + (a(Q) - 1) * a(O));
                                                    h.trigger("preload") },
                                                "wheel.fu": function() { qb = false },
                                                "clean.fu": function() { h.trigger("teardown") },
                                                "loaded.fu": function() { h.trigger("opening") }
                                            },
                                            pool: {
                                                "tick.reel.preload": function() { if (!(!(pa || a(Na)) || a(Ja))) { var c = a(D),
                                                            d = Zc(za.$.css(D)),
                                                            b = a(aa).length || 1,
                                                            i = S(1 / b * a(da) * c);
                                                        za.$.css({ width: d + (i - d) / 3 + 1 }); if (a(da) === b && d > c - 1) { pa = false;
                                                            za.$.fadeOut(300, function() { za.$.css({ opacity: 1, width: 0 }) }) } } },
                                                "tick.reel": function(c) {
                                                    if (!a(Ja)) {
                                                        var d = a(ma),
                                                            b = Y(ga),
                                                            i = g.monitor;
                                                        if (!(!n.intense && $c())) {
                                                            if (N) {
                                                                d = d - a(mc) / b * N;
                                                                d = e(ma, d > 0.1 ? d : (N =
                                                                    R = 0))
                                                            }
                                                            i && sc.text(a(i));
                                                            d && N++;
                                                            R && R++;
                                                            wc(0);
                                                            Ua = true;
                                                            if (R && !d) return T(c);
                                                            if (a(ea)) return T(c, w());
                                                            if (!(a(ya) > 0)) { if (!g.loops && g.rebound) {!R && !(a(B) % 1) ? Yb++ : (Yb = 0);
                                                                    Yb >= g.rebound * 1E3 / b && e(M, !a(M)) }
                                                                c = a(xa) * Ha(1, a(M));
                                                                b = a(ib);
                                                                d = (!a(Sa) || xc || !b ? d : H(a(va)) + d) / Y(ga);
                                                                e(B, a(B) - d * c);
                                                                b = !g.duration ? b : b > 0 && e(ib, b - 1);!b && a(Sa) && h.trigger("stop") }
                                                        }
                                                    }
                                                },
                                                "tick.reel.opening": function() { if (a(fa)) { var c = (g.entry || g.speed) / Y(ga) * (g.cw ? -1 : 1),
                                                            d = e(ya, a(ya) - 1);
                                                        e(B, a(B) + c);
                                                        d || h.trigger("openingDone") } }
                                            }
                                        },
                                        pa = false,
                                        T = function(c,
                                            d) { return c.stopImmediatePropagation() || d },
                                        ia = function() { h.trigger("setup") },
                                        R, N = 0,
                                        Aa = function() { return R = 0 },
                                        w = function() { clearTimeout(Pb);
                                            ha.unbind(nb + x(fa), I.pool[nb + x(fa)]);
                                            e(ya, 0);
                                            e(Kb, true); return R = -g.timeout * Y(ga) },
                                        G = 0,
                                        qb = false,
                                        xc = false,
                                        sc = k(),
                                        za = function() { C(A + x(yc), { position: Qa, left: 0, bottom: 0, height: g.preloader, overflow: Nb, backgroundColor: "#000" }); return za.$ = k(V(ta), { "class": yc }) },
                                        Ra = function(c) {
                                            C(A + x(zc) + x(c), { position: Qa, width: 0, height: 0, overflow: Nb, backgroundColor: "#000" });
                                            return Ra["$" +
                                                c] = k(V(ta), { "class": zc + A + c })
                                        },
                                        C = function(c, d, b) {
                                            function i(p) { var m = [];
                                                k.each(p, function(l, q) { m.push(l.replace(/([A-Z])/g, "-$1").toLowerCase() + ":" + y(q) + ";") }); return "{" + m.join(P) + "}" }
                                            b = b ? P : a(lc);
                                            c = c.replace(/^/, b).replace(na, na + b); return C.rules.push(c + i(d)) && d },
                                        $c = function() { var c = a(L),
                                                d = a(D),
                                                b = h[0].getBoundingClientRect(); return b.top < -c || b.left < -d || b.right > d + k(U).width() || b.bottom > c + k(U).height() },
                                        Yb = 0,
                                        ob = { x: 0, y: 0 },
                                        wc = function(c) { return Ta.push(c) && Ta.shift() && c },
                                        kb = function() { return Ta = [0, 0] },
                                        Ta = kb(),
                                        vc = g.graph || n.math[g.loops ? "hatch" : "envelope"],
                                        qc = function() { clearTimeout(Qb);
                                            Qb = setTimeout(Ub, n.resize_gauge) },
                                        Ub = function() { if (h.width() != a(D)) { var c = a(fc),
                                                    d = e(Mb, h.width() / c.width);
                                                k.each(c, function(b, i) { e(b, S(i * d)) });
                                                h.trigger("resize") } },
                                        Pb, Qb, pb = function(c, d, b) { var i = e(fb, a(B));
                                            e(Jb, a(ua)); var p = g.loops;
                                            e(gb, p ? 0 : -i * c);
                                            e(hb, p ? c : c - i * c); return d !== s && e(eb, { x: d, y: b }) || s },
                                        Ua = true,
                                        Xb = function(c, d, b, i) {
                                            if (i) {
                                                var p = a(c) || 0;
                                                b = d !== s ? d : (b - 1) / (i - 1);
                                                b = c != B ? b : Ga(b, 0.9999);
                                                return d = +H(p - b).toFixed(8) >=
                                                    +(1 / (i - 1)).toFixed(8) ? e(c, b) : d || p
                                            }
                                        },
                                        oa = ha;
                                    try { if (ha[0] != top.document) oa = ha.add(top.document) } catch (dd) {}
                                    top === self ? k() : function(c) { k("iframe", oa.last()).each(function() { try { if (k(this).contents().find(Tb).html() == k(Tb).html()) return (c = k(this)) && false } catch (d) {} }); return c }();
                                    C.rules = [];
                                    I.setup()
                                });
                                sb = sb || function h() { var e = +new Date,
                                        a = Y(ga); if (!a) return sb = null;
                                    ha.trigger(nb);
                                    n.cost = (+new Date + n.cost - e) / 2; return sb = setTimeout(h, ub(4, 1E3 / a - n.cost)) }();
                                return k(K)
                            }
                        },
                        unreel: function() { return this.trigger("teardown") }
                    },
                    re: { image: /^(.*)\.(jpg|jpeg|png|gif)\??.*$/i, ua: [/(msie|opera|firefox|chrome|safari)[ \/:]([\d.]+)/i, /(webkit)\/([\d.]+)/i, /(mozilla)\/([\d.]+)/i], array: / *, */, lazy_agent: /\(iphone|ipod|android|fennec|blackberry/i, frame_klass: /frame-\d+/, substitution: /(@([A-Z]))/g, no_match: /^(undefined|)$/, sequence: /(^[^#|]*([#]+)[^#|]*)($|[|]([0-9]+)\.\.([0-9]+))($|[|]([0-9]+)$)/ },
                    /*
                     * PAG CUSTOM START
                     */
                    cdn: "https://files.porsche.com/",
                    /*
                     * PAG CUSTOM END
                     */
                    math: {
                        envelope: function(f, j, o, t, r, g) { return j + Fa(t, r, -f * g) / o },
                        hatch: function(f, j, o, t, r, g) {
                            f = (f < t ? r : 0) +
                                f % r;
                            f = j + -f * g / o;
                            return f - rb(f)
                        },
                        interpolate: function(f, j, o) { return j + f * (o - j) },
                        distance: function(f, j, o) { var t = o / 2;
                            f = j - f; return f < -t ? f + o : f > t ? f - o : f }
                    },
                    preload: {
                        fidelity: function(f, j, o) {
                            function t(e, a, I) {
                                function pa(G) { for (; !(G >= 1 && G <= N);) G += G < 1 ? +N : -N; return h[I + G] || (h[I + G] = !!T.push(G)) }
                                if (!e.length) return [];
                                var T = [],
                                    ia = 4 * a,
                                    R = j.frame,
                                    N = e.length;
                                a = true;
                                for (var Aa = N / ia, w = 0; w < ia; w++) pa(R + S(w * Aa));
                                for (; Aa > 1;) { w = 0;
                                    ia = T.length;
                                    Aa /= 2; for (a = !a; w < ia; w++) pa(T[w] + (a ? 1 : -1) * S(Aa)) }
                                for (w = 0; w <= N; w++) pa(w);
                                for (w = 0; w < T.length; w++) T[w] =
                                    e[T[w] - 1];
                                return T
                            }
                            var r = j.orbital,
                                g = r ? 2 : j.rows || 1,
                                K = r ? o(sa) : o(O);
                            o = (j.row - 1) * K;
                            r = [].concat(f);
                            var h = new Array(f.length + 1);
                            f = g < 2 ? [] : r.slice(o, o + K);
                            return t(f, 1, o).concat(t(r, g, 0))
                        },
                        linear: function(f) { return f }
                    },
                    substitute: function(f, j) { return f.replace(n.re.substitution, function(o, t, r) { return typeof n.substitutes[r] == "function" ? n.substitutes[r](j) : Ac[r] ? j(Ac[r]) : t }) },
                    substitutes: { T: function() { return +new Date } },
                    normal: {
                        fraction: function(f, j) { if (f === null) return f; return j[Ia].loops ? f - rb(f) : Fa(0, 1, f) },
                        tier: function(f) { if (f === null) return f; return Fa(0, 1, f) },
                        row: function(f, j) { if (f === null) return f; return S(Fa(1, j[Ia].rows, f)) },
                        frame: function(f, j) { if (f === null) return f; var o = j[Ia];
                            j = j[O] * (o.orbital ? 2 : o.rows || 1);
                            f = S(o.loops ? f % j || j : Fa(1, j, f)); return f < 0 ? f + j : f },
                        images: function(f, j) { var o = n.re.sequence.exec(f); return !o ? f : n.sequence(o, j[Ia]) }
                    },
                    sequence: function(f, j) {
                        if (f.length <= 1) return j.images;
                        var o = [],
                            t = j.orbital,
                            r = f[1],
                            g = f[2],
                            K = f[4];
                        K = n.re.no_match.test(K + P) ? 1 : +K;
                        var h = t ? 2 : j.rows || 1;
                        j = t ? j.footage : j.stitched ?
                            1 : j.frames;
                        h = +(f[5] || h * j) - K;
                        f = +f[7] || 1;
                        for (j = 0; j <= h;) { o.push(r.replace(g, bc(K + j + P, g.length, "0")));
                            j += f }
                        return o
                    },
                    instances: k(),
                    leader: Y,
                    resize_gauge: 300,
                    concurrent_requests: 4,
                    cost: 0
                },
                ha = k(X);
            X = navigator.userAgent;
            var Ba = n.re.ua[0].exec(X) || n.re.ua[1].exec(X) || n.re.ua[2].exec(X);
            Z = +Ba[2].split(".").slice(0, 2).join(".");
            Ba = Ba[1] == "MSIE";
            var ad = !(Ba && Z < 8),
                Fc = !(Ba && Z < 9),
                sb, z = "reel",
                Bb = z + "-overlay",
                Hb = z + "-cache",
                zc = z + "-indicator",
                yc = z + "-preloader",
                tc = z + "-monitor",
                dc = z + "-annotation",
                mb = z + "-panning",
                Rb =
                z + "-loading",
                hc = "frame-",
                qa = Math,
                S = qa.round,
                rb = qa.floor,
                la = qa.ceil,
                Ga = qa.min,
                ub = qa.max,
                H = qa.abs,
                Zc = parseInt,
                Wb = n.math.interpolate,
                Pa = "annotations",
                La = "area",
                Sb = "auto",
                nc = "backup",
                M = "backwards",
                db = "bit",
                mc = "brake",
                ab = "cache",
                ic = ab + "d",
                Lb = "center",
                ec = "class",
                jb = "click",
                ea = jb + "ed",
                eb = ea + "_location",
                fb = ea + "_on",
                Jb = ea + "_tier",
                xa = "cwish",
                bb = "departure",
                Ma = "destination",
                cb = "distance",
                sa = "footage",
                B = "fraction",
                J = "frame",
                kc = "framelock",
                O = "frames",
                L = "height",
                hb = "hi",
                Nb = "hidden",
                Gb = "image",
                aa = "images",
                gb = "lo",
                Na = "loading",
                fa = "opening",
                ya = fa + "_ticks",
                Ia = "options",
                Sa = "playing",
                da = "preloaded",
                Mb = "ratio",
                Oa = "reeling",
                Kb = "reeled",
                Ya = "responsive",
                Ka = "revolution",
                Eb = "revolution_y",
                Q = "row",
                jc = "rowlock",
                Ib = "rows",
                Ja = "shy",
                Za = "spacing",
                va = "speed",
                ra = "src",
                lc = "stage",
                W = "stitched",
                $a = W + "_shift",
                Fb = W + "_travel",
                Vb = "stopped",
                $ = "style",
                ga = "tempo",
                ib = "ticks",
                ua = "tier",
                fc = "truescale",
                ma = "velocity",
                wa = "vertical",
                D = "width",
                F = x(z),
                ja = x("pan") + F,
                Rc = "deviceorientation" + F,
                Qc = "dragstart" + F,
                Oc = "mousedown" + F,
                Nc = "mouseenter" + F,
                Xc =
                "mouseleave" + ja,
                Uc = "mousemove" + ja,
                Yc = "mouseup" + ja,
                Pc = "mousewheel" + F,
                nb = "tick" + F,
                Wc = "touchcancel" + ja,
                Vc = "touchend" + ja,
                Mc = "touchstart" + F,
                Tc = "touchmove" + ja,
                pc = "resize" + F,
                P = "",
                A = " ",
                na = ",",
                Qa = "absolute",
                Ob = "block",
                Da = "@CDN@",
                ta = "div",
                rc = "hand",
                Tb = "head",
                zb = "html",
                ka = "id",
                Xa = "img",
                Zb = "jquery." + z,
                lb = "none",
                tb = "object",
                wb = "string",
                Ic = [D, L, Za, Ka, Eb, W, $a, Fb],
                Ac = { W: D, H: L },
                /*
                 * PAG CUSTOM START
                 */
                uc = ad ? Dc("CAAIAIAAAAAAAAAAACH5BAEAAAAALAAAAAAIAAgAAAIHhI+py+1dAAA7") : Da + "images/transparent/trans.gif",
                Kc = Ea(Da + "images/cursor/grab.png") + na + "move",
                Jc = Ea(Da + "images/cursor/grab.png") + na + "move",
                Lc = Ea(Da + "images/cursor/grabbing.png") + na + "move";
                /*
                 * PAG CUSTOM END
                 */
            n.lazy = n.re.lazy_agent.test(X);
            var Sc = Ba && Z < 9 ? 1 : 0,
                bd = k.cleanData;
            k.cleanData = function(f) { k(f).each(function() { k(this).triggerHandler("clean") }); return bd.apply(this, arguments) };
            k.extend(k.fn, n.fn) && k(n.scan);
            return n
        }
    }(jQuery, window, document)
});//
// VERSION: 1.18.2
// DATE: 2015-12-22
// UPDATES AND DOCS AT: http://greensock.com
// 
// Includes all of the following: TweenLite, TweenMax, TimelineLite, TimelineMax, EasePack, CSSPlugin, RoundPropsPlugin, BezierPlugin, AttrPlugin, DirectionalRotationPlugin
//
// @license Copyright (c) 2008-2016, GreenSock. All rights reserved.
// This work is subject to the terms at http://greensock.com/standard-license or for
// Club GreenSock members, the software agreement that was issued with your membership.
// 
// @author: Jack Doyle, jack@greensock.com
// 
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("TweenMax",["core.Animation","core.SimpleTimeline","TweenLite"],function(a,b,c){var d=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},e=function(a,b,c){var d,e,f=a.cycle;for(d in f)e=f[d],a[d]="function"==typeof e?e.call(b[c],c):e[c%e.length];delete a.cycle},f=function(a,b,d){c.call(this,a,b,d),this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._dirty=!0,this.render=f.prototype.render},g=1e-10,h=c._internals,i=h.isSelector,j=h.isArray,k=f.prototype=c.to({},.1,{}),l=[];f.version="1.18.2",k.constructor=f,k.kill()._gc=!1,f.killTweensOf=f.killDelayedCallsTo=c.killTweensOf,f.getTweensOf=c.getTweensOf,f.lagSmoothing=c.lagSmoothing,f.ticker=c.ticker,f.render=c.render,k.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),c.prototype.invalidate.call(this)},k.updateTo=function(a,b){var d,e=this.ratio,f=this.vars.immediateRender||a.immediateRender;b&&this._startTime<this._timeline._time&&(this._startTime=this._timeline._time,this._uncache(!1),this._gc?this._enabled(!0,!1):this._timeline.insert(this,this._startTime-this._delay));for(d in a)this.vars[d]=a[d];if(this._initted||f)if(b)this._initted=!1,f&&this.render(0,!0,!0);else if(this._gc&&this._enabled(!0,!1),this._notifyPluginsOfEnabled&&this._firstPT&&c._onPluginEvent("_onDisable",this),this._time/this._duration>.998){var g=this._totalTime;this.render(0,!0,!1),this._initted=!1,this.render(g,!0,!1)}else if(this._initted=!1,this._init(),this._time>0||f)for(var h,i=1/(1-e),j=this._firstPT;j;)h=j.s+j.c,j.c*=i,j.s=h-j.c,j=j._next;return this},k.render=function(a,b,c){this._initted||0===this._duration&&this.vars.repeat&&this.invalidate();var d,e,f,i,j,k,l,m,n=this._dirty?this.totalDuration():this._totalDuration,o=this._time,p=this._totalTime,q=this._cycle,r=this._duration,s=this._rawPrevTime;if(a>=n-1e-7?(this._totalTime=n,this._cycle=this._repeat,this._yoyo&&0!==(1&this._cycle)?(this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0):(this._time=r,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1),this._reversed||(d=!0,e="onComplete",c=c||this._timeline.autoRemoveChildren),0===r&&(this._initted||!this.vars.lazy||c)&&(this._startTime===this._timeline._duration&&(a=0),(0>s||0>=a&&a>=-1e-7||s===g&&"isPause"!==this.data)&&s!==a&&(c=!0,s>g&&(e="onReverseComplete")),this._rawPrevTime=m=!b||a||s===a?a:g)):1e-7>a?(this._totalTime=this._time=this._cycle=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==p||0===r&&s>0)&&(e="onReverseComplete",d=this._reversed),0>a&&(this._active=!1,0===r&&(this._initted||!this.vars.lazy||c)&&(s>=0&&(c=!0),this._rawPrevTime=m=!b||a||s===a?a:g)),this._initted||(c=!0)):(this._totalTime=this._time=a,0!==this._repeat&&(i=r+this._repeatDelay,this._cycle=this._totalTime/i>>0,0!==this._cycle&&this._cycle===this._totalTime/i&&this._cycle--,this._time=this._totalTime-this._cycle*i,this._yoyo&&0!==(1&this._cycle)&&(this._time=r-this._time),this._time>r?this._time=r:this._time<0&&(this._time=0)),this._easeType?(j=this._time/r,k=this._easeType,l=this._easePower,(1===k||3===k&&j>=.5)&&(j=1-j),3===k&&(j*=2),1===l?j*=j:2===l?j*=j*j:3===l?j*=j*j*j:4===l&&(j*=j*j*j*j),1===k?this.ratio=1-j:2===k?this.ratio=j:this._time/r<.5?this.ratio=j/2:this.ratio=1-j/2):this.ratio=this._ease.getRatio(this._time/r)),o===this._time&&!c&&q===this._cycle)return void(p!==this._totalTime&&this._onUpdate&&(b||this._callback("onUpdate")));if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!c&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=o,this._totalTime=p,this._rawPrevTime=s,this._cycle=q,h.lazyTweens.push(this),void(this._lazy=[a,b]);this._time&&!d?this.ratio=this._ease.getRatio(this._time/r):d&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==o&&a>=0&&(this._active=!0),0===p&&(2===this._initted&&a>0&&this._init(),this._startAt&&(a>=0?this._startAt.render(a,b,c):e||(e="_dummyGS")),this.vars.onStart&&(0!==this._totalTime||0===r)&&(b||this._callback("onStart"))),f=this._firstPT;f;)f.f?f.t[f.p](f.c*this.ratio+f.s):f.t[f.p]=f.c*this.ratio+f.s,f=f._next;this._onUpdate&&(0>a&&this._startAt&&this._startTime&&this._startAt.render(a,b,c),b||(this._totalTime!==p||d)&&this._callback("onUpdate")),this._cycle!==q&&(b||this._gc||this.vars.onRepeat&&this._callback("onRepeat")),e&&(!this._gc||c)&&(0>a&&this._startAt&&!this._onUpdate&&this._startTime&&this._startAt.render(a,b,c),d&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[e]&&this._callback(e),0===r&&this._rawPrevTime===g&&m!==g&&(this._rawPrevTime=0))},f.to=function(a,b,c){return new f(a,b,c)},f.from=function(a,b,c){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,new f(a,b,c)},f.fromTo=function(a,b,c,d){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,new f(a,b,d)},f.staggerTo=f.allTo=function(a,b,g,h,k,m,n){h=h||0;var o,p,q,r,s=0,t=[],u=function(){g.onComplete&&g.onComplete.apply(g.onCompleteScope||this,arguments),k.apply(n||g.callbackScope||this,m||l)},v=g.cycle,w=g.startAt&&g.startAt.cycle;for(j(a)||("string"==typeof a&&(a=c.selector(a)||a),i(a)&&(a=d(a))),a=a||[],0>h&&(a=d(a),a.reverse(),h*=-1),o=a.length-1,q=0;o>=q;q++){p={};for(r in g)p[r]=g[r];if(v&&e(p,a,q),w){w=p.startAt={};for(r in g.startAt)w[r]=g.startAt[r];e(p.startAt,a,q)}p.delay=s+(p.delay||0),q===o&&k&&(p.onComplete=u),t[q]=new f(a[q],b,p),s+=h}return t},f.staggerFrom=f.allFrom=function(a,b,c,d,e,g,h){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,f.staggerTo(a,b,c,d,e,g,h)},f.staggerFromTo=f.allFromTo=function(a,b,c,d,e,g,h,i){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,f.staggerTo(a,b,d,e,g,h,i)},f.delayedCall=function(a,b,c,d,e){return new f(b,0,{delay:a,onComplete:b,onCompleteParams:c,callbackScope:d,onReverseComplete:b,onReverseCompleteParams:c,immediateRender:!1,useFrames:e,overwrite:0})},f.set=function(a,b){return new f(a,0,b)},f.isTweening=function(a){return c.getTweensOf(a,!0).length>0};var m=function(a,b){for(var d=[],e=0,f=a._first;f;)f instanceof c?d[e++]=f:(b&&(d[e++]=f),d=d.concat(m(f,b)),e=d.length),f=f._next;return d},n=f.getAllTweens=function(b){return m(a._rootTimeline,b).concat(m(a._rootFramesTimeline,b))};f.killAll=function(a,c,d,e){null==c&&(c=!0),null==d&&(d=!0);var f,g,h,i=n(0!=e),j=i.length,k=c&&d&&e;for(h=0;j>h;h++)g=i[h],(k||g instanceof b||(f=g.target===g.vars.onComplete)&&d||c&&!f)&&(a?g.totalTime(g._reversed?0:g.totalDuration()):g._enabled(!1,!1))},f.killChildTweensOf=function(a,b){if(null!=a){var e,g,k,l,m,n=h.tweenLookup;if("string"==typeof a&&(a=c.selector(a)||a),i(a)&&(a=d(a)),j(a))for(l=a.length;--l>-1;)f.killChildTweensOf(a[l],b);else{e=[];for(k in n)for(g=n[k].target.parentNode;g;)g===a&&(e=e.concat(n[k].tweens)),g=g.parentNode;for(m=e.length,l=0;m>l;l++)b&&e[l].totalTime(e[l].totalDuration()),e[l]._enabled(!1,!1)}}};var o=function(a,c,d,e){c=c!==!1,d=d!==!1,e=e!==!1;for(var f,g,h=n(e),i=c&&d&&e,j=h.length;--j>-1;)g=h[j],(i||g instanceof b||(f=g.target===g.vars.onComplete)&&d||c&&!f)&&g.paused(a)};return f.pauseAll=function(a,b,c){o(!0,a,b,c)},f.resumeAll=function(a,b,c){o(!1,a,b,c)},f.globalTimeScale=function(b){var d=a._rootTimeline,e=c.ticker.time;return arguments.length?(b=b||g,d._startTime=e-(e-d._startTime)*d._timeScale/b,d=a._rootFramesTimeline,e=c.ticker.frame,d._startTime=e-(e-d._startTime)*d._timeScale/b,d._timeScale=a._rootTimeline._timeScale=b,b):d._timeScale},k.progress=function(a){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-a:a)+this._cycle*(this._duration+this._repeatDelay),!1):this._time/this.duration()},k.totalProgress=function(a){return arguments.length?this.totalTime(this.totalDuration()*a,!1):this._totalTime/this.totalDuration()},k.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),a>this._duration&&(a=this._duration),this._yoyo&&0!==(1&this._cycle)?a=this._duration-a+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(a+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(a,b)):this._time},k.duration=function(b){return arguments.length?a.prototype.duration.call(this,b):this._duration},k.totalDuration=function(a){return arguments.length?-1===this._repeat?this:this.duration((a-this._repeat*this._repeatDelay)/(this._repeat+1)):(this._dirty&&(this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat,this._dirty=!1),this._totalDuration)},k.repeat=function(a){return arguments.length?(this._repeat=a,this._uncache(!0)):this._repeat},k.repeatDelay=function(a){return arguments.length?(this._repeatDelay=a,this._uncache(!0)):this._repeatDelay},k.yoyo=function(a){return arguments.length?(this._yoyo=a,this):this._yoyo},f},!0),_gsScope._gsDefine("TimelineLite",["core.Animation","core.SimpleTimeline","TweenLite"],function(a,b,c){var d=function(a){b.call(this,a),this._labels={},this.autoRemoveChildren=this.vars.autoRemoveChildren===!0,this.smoothChildTiming=this.vars.smoothChildTiming===!0,this._sortChildren=!0,this._onUpdate=this.vars.onUpdate;var c,d,e=this.vars;for(d in e)c=e[d],i(c)&&-1!==c.join("").indexOf("{self}")&&(e[d]=this._swapSelfInParams(c));i(e.tweens)&&this.add(e.tweens,0,e.align,e.stagger)},e=1e-10,f=c._internals,g=d._internals={},h=f.isSelector,i=f.isArray,j=f.lazyTweens,k=f.lazyRender,l=_gsScope._gsDefine.globals,m=function(a){var b,c={};for(b in a)c[b]=a[b];return c},n=function(a,b,c){var d,e,f=a.cycle;for(d in f)e=f[d],a[d]="function"==typeof e?e.call(b[c],c):e[c%e.length];delete a.cycle},o=g.pauseCallback=function(){},p=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},q=d.prototype=new b;return d.version="1.18.2",q.constructor=d,q.kill()._gc=q._forcingPlayhead=q._hasPause=!1,q.to=function(a,b,d,e){var f=d.repeat&&l.TweenMax||c;return b?this.add(new f(a,b,d),e):this.set(a,d,e)},q.from=function(a,b,d,e){return this.add((d.repeat&&l.TweenMax||c).from(a,b,d),e)},q.fromTo=function(a,b,d,e,f){var g=e.repeat&&l.TweenMax||c;return b?this.add(g.fromTo(a,b,d,e),f):this.set(a,e,f)},q.staggerTo=function(a,b,e,f,g,i,j,k){var l,o,q=new d({onComplete:i,onCompleteParams:j,callbackScope:k,smoothChildTiming:this.smoothChildTiming}),r=e.cycle;for("string"==typeof a&&(a=c.selector(a)||a),a=a||[],h(a)&&(a=p(a)),f=f||0,0>f&&(a=p(a),a.reverse(),f*=-1),o=0;o<a.length;o++)l=m(e),l.startAt&&(l.startAt=m(l.startAt),l.startAt.cycle&&n(l.startAt,a,o)),r&&n(l,a,o),q.to(a[o],b,l,o*f);return this.add(q,g)},q.staggerFrom=function(a,b,c,d,e,f,g,h){return c.immediateRender=0!=c.immediateRender,c.runBackwards=!0,this.staggerTo(a,b,c,d,e,f,g,h)},q.staggerFromTo=function(a,b,c,d,e,f,g,h,i){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,this.staggerTo(a,b,d,e,f,g,h,i)},q.call=function(a,b,d,e){return this.add(c.delayedCall(0,a,b,d),e)},q.set=function(a,b,d){return d=this._parseTimeOrLabel(d,0,!0),null==b.immediateRender&&(b.immediateRender=d===this._time&&!this._paused),this.add(new c(a,0,b),d)},d.exportRoot=function(a,b){a=a||{},null==a.smoothChildTiming&&(a.smoothChildTiming=!0);var e,f,g=new d(a),h=g._timeline;for(null==b&&(b=!0),h._remove(g,!0),g._startTime=0,g._rawPrevTime=g._time=g._totalTime=h._time,e=h._first;e;)f=e._next,b&&e instanceof c&&e.target===e.vars.onComplete||g.add(e,e._startTime-e._delay),e=f;return h.add(g,0),g},q.add=function(e,f,g,h){var j,k,l,m,n,o;if("number"!=typeof f&&(f=this._parseTimeOrLabel(f,0,!0,e)),!(e instanceof a)){if(e instanceof Array||e&&e.push&&i(e)){for(g=g||"normal",h=h||0,j=f,k=e.length,l=0;k>l;l++)i(m=e[l])&&(m=new d({tweens:m})),this.add(m,j),"string"!=typeof m&&"function"!=typeof m&&("sequence"===g?j=m._startTime+m.totalDuration()/m._timeScale:"start"===g&&(m._startTime-=m.delay())),j+=h;return this._uncache(!0)}if("string"==typeof e)return this.addLabel(e,f);if("function"!=typeof e)throw"Cannot add "+e+" into the timeline; it is not a tween, timeline, function, or string.";e=c.delayedCall(0,e)}if(b.prototype.add.call(this,e,f),(this._gc||this._time===this._duration)&&!this._paused&&this._duration<this.duration())for(n=this,o=n.rawTime()>e._startTime;n._timeline;)o&&n._timeline.smoothChildTiming?n.totalTime(n._totalTime,!0):n._gc&&n._enabled(!0,!1),n=n._timeline;return this},q.remove=function(b){if(b instanceof a){this._remove(b,!1);var c=b._timeline=b.vars.useFrames?a._rootFramesTimeline:a._rootTimeline;return b._startTime=(b._paused?b._pauseTime:c._time)-(b._reversed?b.totalDuration()-b._totalTime:b._totalTime)/b._timeScale,this}if(b instanceof Array||b&&b.push&&i(b)){for(var d=b.length;--d>-1;)this.remove(b[d]);return this}return"string"==typeof b?this.removeLabel(b):this.kill(null,b)},q._remove=function(a,c){b.prototype._remove.call(this,a,c);var d=this._last;return d?this._time>d._startTime+d._totalDuration/d._timeScale&&(this._time=this.duration(),this._totalTime=this._totalDuration):this._time=this._totalTime=this._duration=this._totalDuration=0,this},q.append=function(a,b){return this.add(a,this._parseTimeOrLabel(null,b,!0,a))},q.insert=q.insertMultiple=function(a,b,c,d){return this.add(a,b||0,c,d)},q.appendMultiple=function(a,b,c,d){return this.add(a,this._parseTimeOrLabel(null,b,!0,a),c,d)},q.addLabel=function(a,b){return this._labels[a]=this._parseTimeOrLabel(b),this},q.addPause=function(a,b,d,e){var f=c.delayedCall(0,o,d,e||this);return f.vars.onComplete=f.vars.onReverseComplete=b,f.data="isPause",this._hasPause=!0,this.add(f,a)},q.removeLabel=function(a){return delete this._labels[a],this},q.getLabelTime=function(a){return null!=this._labels[a]?this._labels[a]:-1},q._parseTimeOrLabel=function(b,c,d,e){var f;if(e instanceof a&&e.timeline===this)this.remove(e);else if(e&&(e instanceof Array||e.push&&i(e)))for(f=e.length;--f>-1;)e[f]instanceof a&&e[f].timeline===this&&this.remove(e[f]);if("string"==typeof c)return this._parseTimeOrLabel(c,d&&"number"==typeof b&&null==this._labels[c]?b-this.duration():0,d);if(c=c||0,"string"!=typeof b||!isNaN(b)&&null==this._labels[b])null==b&&(b=this.duration());else{if(f=b.indexOf("="),-1===f)return null==this._labels[b]?d?this._labels[b]=this.duration()+c:c:this._labels[b]+c;c=parseInt(b.charAt(f-1)+"1",10)*Number(b.substr(f+1)),b=f>1?this._parseTimeOrLabel(b.substr(0,f-1),0,d):this.duration()}return Number(b)+c},q.seek=function(a,b){return this.totalTime("number"==typeof a?a:this._parseTimeOrLabel(a),b!==!1)},q.stop=function(){return this.paused(!0)},q.gotoAndPlay=function(a,b){return this.play(a,b)},q.gotoAndStop=function(a,b){return this.pause(a,b)},q.render=function(a,b,c){this._gc&&this._enabled(!0,!1);var d,f,g,h,i,l,m,n=this._dirty?this.totalDuration():this._totalDuration,o=this._time,p=this._startTime,q=this._timeScale,r=this._paused;if(a>=n-1e-7)this._totalTime=this._time=n,this._reversed||this._hasPausedChild()||(f=!0,h="onComplete",i=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=a&&a>=-1e-7||this._rawPrevTime<0||this._rawPrevTime===e)&&this._rawPrevTime!==a&&this._first&&(i=!0,this._rawPrevTime>e&&(h="onReverseComplete"))),this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:e,a=n+1e-4;else if(1e-7>a)if(this._totalTime=this._time=0,(0!==o||0===this._duration&&this._rawPrevTime!==e&&(this._rawPrevTime>0||0>a&&this._rawPrevTime>=0))&&(h="onReverseComplete",f=this._reversed),0>a)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(i=f=!0,h="onReverseComplete"):this._rawPrevTime>=0&&this._first&&(i=!0),this._rawPrevTime=a;else{if(this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:e,0===a&&f)for(d=this._first;d&&0===d._startTime;)d._duration||(f=!1),d=d._next;a=0,this._initted||(i=!0)}else{if(this._hasPause&&!this._forcingPlayhead&&!b){if(a>=o)for(d=this._first;d&&d._startTime<=a&&!l;)d._duration||"isPause"!==d.data||d.ratio||0===d._startTime&&0===this._rawPrevTime||(l=d),d=d._next;else for(d=this._last;d&&d._startTime>=a&&!l;)d._duration||"isPause"===d.data&&d._rawPrevTime>0&&(l=d),d=d._prev;l&&(this._time=a=l._startTime,this._totalTime=a+this._cycle*(this._totalDuration+this._repeatDelay))}this._totalTime=this._time=this._rawPrevTime=a}if(this._time!==o&&this._first||c||i||l){if(this._initted||(this._initted=!0),this._active||!this._paused&&this._time!==o&&a>0&&(this._active=!0),0===o&&this.vars.onStart&&0!==this._time&&(b||this._callback("onStart")),m=this._time,m>=o)for(d=this._first;d&&(g=d._next,m===this._time&&(!this._paused||r));)(d._active||d._startTime<=m&&!d._paused&&!d._gc)&&(l===d&&this.pause(),d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=g;else for(d=this._last;d&&(g=d._prev,m===this._time&&(!this._paused||r));){if(d._active||d._startTime<=o&&!d._paused&&!d._gc){if(l===d){for(l=d._prev;l&&l.endTime()>this._time;)l.render(l._reversed?l.totalDuration()-(a-l._startTime)*l._timeScale:(a-l._startTime)*l._timeScale,b,c),l=l._prev;l=null,this.pause()}d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)}d=g}this._onUpdate&&(b||(j.length&&k(),this._callback("onUpdate"))),h&&(this._gc||(p===this._startTime||q!==this._timeScale)&&(0===this._time||n>=this.totalDuration())&&(f&&(j.length&&k(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[h]&&this._callback(h)))}},q._hasPausedChild=function(){for(var a=this._first;a;){if(a._paused||a instanceof d&&a._hasPausedChild())return!0;a=a._next}return!1},q.getChildren=function(a,b,d,e){e=e||-9999999999;for(var f=[],g=this._first,h=0;g;)g._startTime<e||(g instanceof c?b!==!1&&(f[h++]=g):(d!==!1&&(f[h++]=g),a!==!1&&(f=f.concat(g.getChildren(!0,b,d)),h=f.length))),g=g._next;return f},q.getTweensOf=function(a,b){var d,e,f=this._gc,g=[],h=0;for(f&&this._enabled(!0,!0),d=c.getTweensOf(a),e=d.length;--e>-1;)(d[e].timeline===this||b&&this._contains(d[e]))&&(g[h++]=d[e]);return f&&this._enabled(!1,!0),g},q.recent=function(){return this._recent},q._contains=function(a){for(var b=a.timeline;b;){if(b===this)return!0;b=b.timeline}return!1},q.shiftChildren=function(a,b,c){c=c||0;for(var d,e=this._first,f=this._labels;e;)e._startTime>=c&&(e._startTime+=a),e=e._next;if(b)for(d in f)f[d]>=c&&(f[d]+=a);return this._uncache(!0)},q._kill=function(a,b){if(!a&&!b)return this._enabled(!1,!1);for(var c=b?this.getTweensOf(b):this.getChildren(!0,!0,!1),d=c.length,e=!1;--d>-1;)c[d]._kill(a,b)&&(e=!0);return e},q.clear=function(a){var b=this.getChildren(!1,!0,!0),c=b.length;for(this._time=this._totalTime=0;--c>-1;)b[c]._enabled(!1,!1);return a!==!1&&(this._labels={}),this._uncache(!0)},q.invalidate=function(){for(var b=this._first;b;)b.invalidate(),b=b._next;return a.prototype.invalidate.call(this)},q._enabled=function(a,c){if(a===this._gc)for(var d=this._first;d;)d._enabled(a,!0),d=d._next;return b.prototype._enabled.call(this,a,c)},q.totalTime=function(b,c,d){this._forcingPlayhead=!0;var e=a.prototype.totalTime.apply(this,arguments);return this._forcingPlayhead=!1,e},q.duration=function(a){return arguments.length?(0!==this.duration()&&0!==a&&this.timeScale(this._duration/a),this):(this._dirty&&this.totalDuration(),this._duration)},q.totalDuration=function(a){if(!arguments.length){if(this._dirty){for(var b,c,d=0,e=this._last,f=999999999999;e;)b=e._prev,e._dirty&&e.totalDuration(),e._startTime>f&&this._sortChildren&&!e._paused?this.add(e,e._startTime-e._delay):f=e._startTime,e._startTime<0&&!e._paused&&(d-=e._startTime,this._timeline.smoothChildTiming&&(this._startTime+=e._startTime/this._timeScale),this.shiftChildren(-e._startTime,!1,-9999999999),f=0),c=e._startTime+e._totalDuration/e._timeScale,c>d&&(d=c),e=b;this._duration=this._totalDuration=d,this._dirty=!1}return this._totalDuration}return a&&this.totalDuration()?this.timeScale(this._totalDuration/a):this},q.paused=function(b){if(!b)for(var c=this._first,d=this._time;c;)c._startTime===d&&"isPause"===c.data&&(c._rawPrevTime=0),c=c._next;return a.prototype.paused.apply(this,arguments)},q.usesFrames=function(){for(var b=this._timeline;b._timeline;)b=b._timeline;return b===a._rootFramesTimeline},q.rawTime=function(){return this._paused?this._totalTime:(this._timeline.rawTime()-this._startTime)*this._timeScale},d},!0),_gsScope._gsDefine("TimelineMax",["TimelineLite","TweenLite","easing.Ease"],function(a,b,c){var d=function(b){a.call(this,b),this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._cycle=0,this._yoyo=this.vars.yoyo===!0,this._dirty=!0},e=1e-10,f=b._internals,g=f.lazyTweens,h=f.lazyRender,i=new c(null,null,1,0),j=d.prototype=new a;return j.constructor=d,j.kill()._gc=!1,d.version="1.18.2",j.invalidate=function(){return this._yoyo=this.vars.yoyo===!0,this._repeat=this.vars.repeat||0,this._repeatDelay=this.vars.repeatDelay||0,this._uncache(!0),a.prototype.invalidate.call(this)},j.addCallback=function(a,c,d,e){return this.add(b.delayedCall(0,a,d,e),c)},j.removeCallback=function(a,b){if(a)if(null==b)this._kill(null,a);else for(var c=this.getTweensOf(a,!1),d=c.length,e=this._parseTimeOrLabel(b);--d>-1;)c[d]._startTime===e&&c[d]._enabled(!1,!1);return this},j.removePause=function(b){return this.removeCallback(a._internals.pauseCallback,b)},j.tweenTo=function(a,c){c=c||{};var d,e,f,g={ease:i,useFrames:this.usesFrames(),immediateRender:!1};for(e in c)g[e]=c[e];return g.time=this._parseTimeOrLabel(a),d=Math.abs(Number(g.time)-this._time)/this._timeScale||.001,f=new b(this,d,g),g.onStart=function(){f.target.paused(!0),f.vars.time!==f.target.time()&&d===f.duration()&&f.duration(Math.abs(f.vars.time-f.target.time())/f.target._timeScale),c.onStart&&f._callback("onStart")},f},j.tweenFromTo=function(a,b,c){c=c||{},a=this._parseTimeOrLabel(a),c.startAt={onComplete:this.seek,onCompleteParams:[a],callbackScope:this},c.immediateRender=c.immediateRender!==!1;var d=this.tweenTo(b,c);return d.duration(Math.abs(d.vars.time-a)/this._timeScale||.001)},j.render=function(a,b,c){this._gc&&this._enabled(!0,!1);var d,f,i,j,k,l,m,n,o=this._dirty?this.totalDuration():this._totalDuration,p=this._duration,q=this._time,r=this._totalTime,s=this._startTime,t=this._timeScale,u=this._rawPrevTime,v=this._paused,w=this._cycle;if(a>=o-1e-7)this._locked||(this._totalTime=o,this._cycle=this._repeat),this._reversed||this._hasPausedChild()||(f=!0,j="onComplete",k=!!this._timeline.autoRemoveChildren,0===this._duration&&(0>=a&&a>=-1e-7||0>u||u===e)&&u!==a&&this._first&&(k=!0,u>e&&(j="onReverseComplete"))),this._rawPrevTime=this._duration||!b||a||this._rawPrevTime===a?a:e,this._yoyo&&0!==(1&this._cycle)?this._time=a=0:(this._time=p,a=p+1e-4);else if(1e-7>a)if(this._locked||(this._totalTime=this._cycle=0),this._time=0,(0!==q||0===p&&u!==e&&(u>0||0>a&&u>=0)&&!this._locked)&&(j="onReverseComplete",f=this._reversed),0>a)this._active=!1,this._timeline.autoRemoveChildren&&this._reversed?(k=f=!0,j="onReverseComplete"):u>=0&&this._first&&(k=!0),this._rawPrevTime=a;else{if(this._rawPrevTime=p||!b||a||this._rawPrevTime===a?a:e,0===a&&f)for(d=this._first;d&&0===d._startTime;)d._duration||(f=!1),d=d._next;a=0,this._initted||(k=!0)}else if(0===p&&0>u&&(k=!0),this._time=this._rawPrevTime=a,this._locked||(this._totalTime=a,0!==this._repeat&&(l=p+this._repeatDelay,this._cycle=this._totalTime/l>>0,0!==this._cycle&&this._cycle===this._totalTime/l&&this._cycle--,this._time=this._totalTime-this._cycle*l,this._yoyo&&0!==(1&this._cycle)&&(this._time=p-this._time),this._time>p?(this._time=p,a=p+1e-4):this._time<0?this._time=a=0:a=this._time)),this._hasPause&&!this._forcingPlayhead&&!b){if(a=this._time,a>=q)for(d=this._first;d&&d._startTime<=a&&!m;)d._duration||"isPause"!==d.data||d.ratio||0===d._startTime&&0===this._rawPrevTime||(m=d),d=d._next;else for(d=this._last;d&&d._startTime>=a&&!m;)d._duration||"isPause"===d.data&&d._rawPrevTime>0&&(m=d),d=d._prev;m&&(this._time=a=m._startTime,this._totalTime=a+this._cycle*(this._totalDuration+this._repeatDelay))}if(this._cycle!==w&&!this._locked){var x=this._yoyo&&0!==(1&w),y=x===(this._yoyo&&0!==(1&this._cycle)),z=this._totalTime,A=this._cycle,B=this._rawPrevTime,C=this._time;if(this._totalTime=w*p,this._cycle<w?x=!x:this._totalTime+=p,this._time=q,this._rawPrevTime=0===p?u-1e-4:u,this._cycle=w,this._locked=!0,q=x?0:p,this.render(q,b,0===p),b||this._gc||this.vars.onRepeat&&this._callback("onRepeat"),q!==this._time)return;if(y&&(q=x?p+1e-4:-1e-4,this.render(q,!0,!1)),this._locked=!1,this._paused&&!v)return;this._time=C,this._totalTime=z,this._cycle=A,this._rawPrevTime=B}if(!(this._time!==q&&this._first||c||k||m))return void(r!==this._totalTime&&this._onUpdate&&(b||this._callback("onUpdate")));if(this._initted||(this._initted=!0),this._active||!this._paused&&this._totalTime!==r&&a>0&&(this._active=!0),0===r&&this.vars.onStart&&0!==this._totalTime&&(b||this._callback("onStart")),n=this._time,n>=q)for(d=this._first;d&&(i=d._next,n===this._time&&(!this._paused||v));)(d._active||d._startTime<=this._time&&!d._paused&&!d._gc)&&(m===d&&this.pause(),d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)),d=i;else for(d=this._last;d&&(i=d._prev,n===this._time&&(!this._paused||v));){if(d._active||d._startTime<=q&&!d._paused&&!d._gc){if(m===d){for(m=d._prev;m&&m.endTime()>this._time;)m.render(m._reversed?m.totalDuration()-(a-m._startTime)*m._timeScale:(a-m._startTime)*m._timeScale,b,c),m=m._prev;m=null,this.pause()}d._reversed?d.render((d._dirty?d.totalDuration():d._totalDuration)-(a-d._startTime)*d._timeScale,b,c):d.render((a-d._startTime)*d._timeScale,b,c)}d=i}this._onUpdate&&(b||(g.length&&h(),this._callback("onUpdate"))),j&&(this._locked||this._gc||(s===this._startTime||t!==this._timeScale)&&(0===this._time||o>=this.totalDuration())&&(f&&(g.length&&h(),this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[j]&&this._callback(j)))},j.getActive=function(a,b,c){null==a&&(a=!0),null==b&&(b=!0),null==c&&(c=!1);var d,e,f=[],g=this.getChildren(a,b,c),h=0,i=g.length;for(d=0;i>d;d++)e=g[d],e.isActive()&&(f[h++]=e);return f},j.getLabelAfter=function(a){a||0!==a&&(a=this._time);var b,c=this.getLabelsArray(),d=c.length;for(b=0;d>b;b++)if(c[b].time>a)return c[b].name;return null},j.getLabelBefore=function(a){null==a&&(a=this._time);for(var b=this.getLabelsArray(),c=b.length;--c>-1;)if(b[c].time<a)return b[c].name;return null},j.getLabelsArray=function(){var a,b=[],c=0;for(a in this._labels)b[c++]={time:this._labels[a],name:a};return b.sort(function(a,b){return a.time-b.time}),b},j.progress=function(a,b){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&0!==(1&this._cycle)?1-a:a)+this._cycle*(this._duration+this._repeatDelay),b):this._time/this.duration()},j.totalProgress=function(a,b){return arguments.length?this.totalTime(this.totalDuration()*a,b):this._totalTime/this.totalDuration()},j.totalDuration=function(b){return arguments.length?-1!==this._repeat&&b?this.timeScale(this.totalDuration()/b):this:(this._dirty&&(a.prototype.totalDuration.call(this),this._totalDuration=-1===this._repeat?999999999999:this._duration*(this._repeat+1)+this._repeatDelay*this._repeat),this._totalDuration)},j.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),a>this._duration&&(a=this._duration),this._yoyo&&0!==(1&this._cycle)?a=this._duration-a+this._cycle*(this._duration+this._repeatDelay):0!==this._repeat&&(a+=this._cycle*(this._duration+this._repeatDelay)),this.totalTime(a,b)):this._time},j.repeat=function(a){return arguments.length?(this._repeat=a,this._uncache(!0)):this._repeat},j.repeatDelay=function(a){return arguments.length?(this._repeatDelay=a,this._uncache(!0)):this._repeatDelay},j.yoyo=function(a){return arguments.length?(this._yoyo=a,this):this._yoyo},j.currentLabel=function(a){return arguments.length?this.seek(a,!0):this.getLabelBefore(this._time+1e-8)},d},!0),function(){var a=180/Math.PI,b=[],c=[],d=[],e={},f=_gsScope._gsDefine.globals,g=function(a,b,c,d){this.a=a,this.b=b,this.c=c,this.d=d,this.da=d-a,this.ca=c-a,this.ba=b-a},h=",x,y,z,left,top,right,bottom,marginTop,marginLeft,marginRight,marginBottom,paddingLeft,paddingTop,paddingRight,paddingBottom,backgroundPosition,backgroundPosition_y,",i=function(a,b,c,d){var e={a:a},f={},g={},h={c:d},i=(a+b)/2,j=(b+c)/2,k=(c+d)/2,l=(i+j)/2,m=(j+k)/2,n=(m-l)/8;return e.b=i+(a-i)/4,f.b=l+n,e.c=f.a=(e.b+f.b)/2,f.c=g.a=(l+m)/2,g.b=m-n,h.b=k+(d-k)/4,g.c=h.a=(g.b+h.b)/2,[e,f,g,h]},j=function(a,e,f,g,h){var j,k,l,m,n,o,p,q,r,s,t,u,v,w=a.length-1,x=0,y=a[0].a;for(j=0;w>j;j++)n=a[x],k=n.a,l=n.d,m=a[x+1].d,h?(t=b[j],u=c[j],v=(u+t)*e*.25/(g?.5:d[j]||.5),o=l-(l-k)*(g?.5*e:0!==t?v/t:0),p=l+(m-l)*(g?.5*e:0!==u?v/u:0),q=l-(o+((p-o)*(3*t/(t+u)+.5)/4||0))):(o=l-(l-k)*e*.5,p=l+(m-l)*e*.5,q=l-(o+p)/2),o+=q,p+=q,n.c=r=o,0!==j?n.b=y:n.b=y=n.a+.6*(n.c-n.a),n.da=l-k,n.ca=r-k,n.ba=y-k,f?(s=i(k,y,r,l),a.splice(x,1,s[0],s[1],s[2],s[3]),x+=4):x++,y=p;n=a[x],n.b=y,n.c=y+.4*(n.d-y),n.da=n.d-n.a,n.ca=n.c-n.a,n.ba=y-n.a,f&&(s=i(n.a,y,n.c,n.d),a.splice(x,1,s[0],s[1],s[2],s[3]))},k=function(a,d,e,f){var h,i,j,k,l,m,n=[];if(f)for(a=[f].concat(a),i=a.length;--i>-1;)"string"==typeof(m=a[i][d])&&"="===m.charAt(1)&&(a[i][d]=f[d]+Number(m.charAt(0)+m.substr(2)));if(h=a.length-2,0>h)return n[0]=new g(a[0][d],0,0,a[-1>h?0:1][d]),n;for(i=0;h>i;i++)j=a[i][d],k=a[i+1][d],n[i]=new g(j,0,0,k),e&&(l=a[i+2][d],b[i]=(b[i]||0)+(k-j)*(k-j),c[i]=(c[i]||0)+(l-k)*(l-k));return n[i]=new g(a[i][d],0,0,a[i+1][d]),n},l=function(a,f,g,i,l,m){var n,o,p,q,r,s,t,u,v={},w=[],x=m||a[0];l="string"==typeof l?","+l+",":h,null==f&&(f=1);for(o in a[0])w.push(o);if(a.length>1){for(u=a[a.length-1],t=!0,n=w.length;--n>-1;)if(o=w[n],Math.abs(x[o]-u[o])>.05){t=!1;break}t&&(a=a.concat(),m&&a.unshift(m),a.push(a[1]),m=a[a.length-3])}for(b.length=c.length=d.length=0,n=w.length;--n>-1;)o=w[n],e[o]=-1!==l.indexOf(","+o+","),v[o]=k(a,o,e[o],m);for(n=b.length;--n>-1;)b[n]=Math.sqrt(b[n]),c[n]=Math.sqrt(c[n]);if(!i){for(n=w.length;--n>-1;)if(e[o])for(p=v[w[n]],s=p.length-1,q=0;s>q;q++)r=p[q+1].da/c[q]+p[q].da/b[q],d[q]=(d[q]||0)+r*r;for(n=d.length;--n>-1;)d[n]=Math.sqrt(d[n])}for(n=w.length,q=g?4:1;--n>-1;)o=w[n],p=v[o],j(p,f,g,i,e[o]),t&&(p.splice(0,q),p.splice(p.length-q,q));return v},m=function(a,b,c){b=b||"soft";var d,e,f,h,i,j,k,l,m,n,o,p={},q="cubic"===b?3:2,r="soft"===b,s=[];if(r&&c&&(a=[c].concat(a)),null==a||a.length<q+1)throw"invalid Bezier data";for(m in a[0])s.push(m);for(j=s.length;--j>-1;){for(m=s[j],p[m]=i=[],n=0,l=a.length,k=0;l>k;k++)d=null==c?a[k][m]:"string"==typeof(o=a[k][m])&&"="===o.charAt(1)?c[m]+Number(o.charAt(0)+o.substr(2)):Number(o),r&&k>1&&l-1>k&&(i[n++]=(d+i[n-2])/2),i[n++]=d;for(l=n-q+1,n=0,k=0;l>k;k+=q)d=i[k],e=i[k+1],f=i[k+2],h=2===q?0:i[k+3],i[n++]=o=3===q?new g(d,e,f,h):new g(d,(2*e+d)/3,(2*e+f)/3,f);i.length=n}return p},n=function(a,b,c){for(var d,e,f,g,h,i,j,k,l,m,n,o=1/c,p=a.length;--p>-1;)for(m=a[p],f=m.a,g=m.d-f,h=m.c-f,i=m.b-f,d=e=0,k=1;c>=k;k++)j=o*k,l=1-j,d=e-(e=(j*j*g+3*l*(j*h+l*i))*j),n=p*c+k-1,b[n]=(b[n]||0)+d*d},o=function(a,b){b=b>>0||6;var c,d,e,f,g=[],h=[],i=0,j=0,k=b-1,l=[],m=[];for(c in a)n(a[c],g,b);for(e=g.length,d=0;e>d;d++)i+=Math.sqrt(g[d]),f=d%b,m[f]=i,f===k&&(j+=i,f=d/b>>0,l[f]=m,h[f]=j,i=0,m=[]);return{length:j,lengths:h,segments:l}},p=_gsScope._gsDefine.plugin({propName:"bezier",priority:-1,version:"1.3.4",API:2,global:!0,init:function(a,b,c){this._target=a,b instanceof Array&&(b={values:b}),this._func={},this._round={},this._props=[],this._timeRes=null==b.timeResolution?6:parseInt(b.timeResolution,10);
var d,e,f,g,h,i=b.values||[],j={},k=i[0],n=b.autoRotate||c.vars.orientToBezier;this._autoRotate=n?n instanceof Array?n:[["x","y","rotation",n===!0?0:Number(n)||0]]:null;for(d in k)this._props.push(d);for(f=this._props.length;--f>-1;)d=this._props[f],this._overwriteProps.push(d),e=this._func[d]="function"==typeof a[d],j[d]=e?a[d.indexOf("set")||"function"!=typeof a["get"+d.substr(3)]?d:"get"+d.substr(3)]():parseFloat(a[d]),h||j[d]!==i[0][d]&&(h=j);if(this._beziers="cubic"!==b.type&&"quadratic"!==b.type&&"soft"!==b.type?l(i,isNaN(b.curviness)?1:b.curviness,!1,"thruBasic"===b.type,b.correlate,h):m(i,b.type,j),this._segCount=this._beziers[d].length,this._timeRes){var p=o(this._beziers,this._timeRes);this._length=p.length,this._lengths=p.lengths,this._segments=p.segments,this._l1=this._li=this._s1=this._si=0,this._l2=this._lengths[0],this._curSeg=this._segments[0],this._s2=this._curSeg[0],this._prec=1/this._curSeg.length}if(n=this._autoRotate)for(this._initialRotations=[],n[0]instanceof Array||(this._autoRotate=n=[n]),f=n.length;--f>-1;){for(g=0;3>g;g++)d=n[f][g],this._func[d]="function"==typeof a[d]?a[d.indexOf("set")||"function"!=typeof a["get"+d.substr(3)]?d:"get"+d.substr(3)]:!1;d=n[f][2],this._initialRotations[f]=this._func[d]?this._func[d].call(this._target):this._target[d]}return this._startRatio=c.vars.runBackwards?1:0,!0},set:function(b){var c,d,e,f,g,h,i,j,k,l,m=this._segCount,n=this._func,o=this._target,p=b!==this._startRatio;if(this._timeRes){if(k=this._lengths,l=this._curSeg,b*=this._length,e=this._li,b>this._l2&&m-1>e){for(j=m-1;j>e&&(this._l2=k[++e])<=b;);this._l1=k[e-1],this._li=e,this._curSeg=l=this._segments[e],this._s2=l[this._s1=this._si=0]}else if(b<this._l1&&e>0){for(;e>0&&(this._l1=k[--e])>=b;);0===e&&b<this._l1?this._l1=0:e++,this._l2=k[e],this._li=e,this._curSeg=l=this._segments[e],this._s1=l[(this._si=l.length-1)-1]||0,this._s2=l[this._si]}if(c=e,b-=this._l1,e=this._si,b>this._s2&&e<l.length-1){for(j=l.length-1;j>e&&(this._s2=l[++e])<=b;);this._s1=l[e-1],this._si=e}else if(b<this._s1&&e>0){for(;e>0&&(this._s1=l[--e])>=b;);0===e&&b<this._s1?this._s1=0:e++,this._s2=l[e],this._si=e}h=(e+(b-this._s1)/(this._s2-this._s1))*this._prec}else c=0>b?0:b>=1?m-1:m*b>>0,h=(b-c*(1/m))*m;for(d=1-h,e=this._props.length;--e>-1;)f=this._props[e],g=this._beziers[f][c],i=(h*h*g.da+3*d*(h*g.ca+d*g.ba))*h+g.a,this._round[f]&&(i=Math.round(i)),n[f]?o[f](i):o[f]=i;if(this._autoRotate){var q,r,s,t,u,v,w,x=this._autoRotate;for(e=x.length;--e>-1;)f=x[e][2],v=x[e][3]||0,w=x[e][4]===!0?1:a,g=this._beziers[x[e][0]],q=this._beziers[x[e][1]],g&&q&&(g=g[c],q=q[c],r=g.a+(g.b-g.a)*h,t=g.b+(g.c-g.b)*h,r+=(t-r)*h,t+=(g.c+(g.d-g.c)*h-t)*h,s=q.a+(q.b-q.a)*h,u=q.b+(q.c-q.b)*h,s+=(u-s)*h,u+=(q.c+(q.d-q.c)*h-u)*h,i=p?Math.atan2(u-s,t-r)*w+v:this._initialRotations[e],n[f]?o[f](i):o[f]=i)}}}),q=p.prototype;p.bezierThrough=l,p.cubicToQuadratic=i,p._autoCSS=!0,p.quadraticToCubic=function(a,b,c){return new g(a,(2*b+a)/3,(2*b+c)/3,c)},p._cssRegister=function(){var a=f.CSSPlugin;if(a){var b=a._internals,c=b._parseToProxy,d=b._setPluginRatio,e=b.CSSPropTween;b._registerComplexSpecialProp("bezier",{parser:function(a,b,f,g,h,i){b instanceof Array&&(b={values:b}),i=new p;var j,k,l,m=b.values,n=m.length-1,o=[],q={};if(0>n)return h;for(j=0;n>=j;j++)l=c(a,m[j],g,h,i,n!==j),o[j]=l.end;for(k in b)q[k]=b[k];return q.values=o,h=new e(a,"bezier",0,0,l.pt,2),h.data=l,h.plugin=i,h.setRatio=d,0===q.autoRotate&&(q.autoRotate=!0),!q.autoRotate||q.autoRotate instanceof Array||(j=q.autoRotate===!0?0:Number(q.autoRotate),q.autoRotate=null!=l.end.left?[["left","top","rotation",j,!1]]:null!=l.end.x?[["x","y","rotation",j,!1]]:!1),q.autoRotate&&(g._transform||g._enableTransforms(!1),l.autoRotate=g._target._gsTransform),i._onInitTween(l.proxy,q,g._tween),h}})}},q._roundProps=function(a,b){for(var c=this._overwriteProps,d=c.length;--d>-1;)(a[c[d]]||a.bezier||a.bezierThrough)&&(this._round[c[d]]=b)},q._kill=function(a){var b,c,d=this._props;for(b in this._beziers)if(b in a)for(delete this._beziers[b],delete this._func[b],c=d.length;--c>-1;)d[c]===b&&d.splice(c,1);return this._super._kill.call(this,a)}}(),_gsScope._gsDefine("plugins.CSSPlugin",["plugins.TweenPlugin","TweenLite"],function(a,b){var c,d,e,f,g=function(){a.call(this,"css"),this._overwriteProps.length=0,this.setRatio=g.prototype.setRatio},h=_gsScope._gsDefine.globals,i={},j=g.prototype=new a("css");j.constructor=g,g.version="1.18.2",g.API=2,g.defaultTransformPerspective=0,g.defaultSkewType="compensated",g.defaultSmoothOrigin=!0,j="px",g.suffixMap={top:j,right:j,bottom:j,left:j,width:j,height:j,fontSize:j,padding:j,margin:j,perspective:j,lineHeight:""};var k,l,m,n,o,p,q=/(?:\d|\-\d|\.\d|\-\.\d)+/g,r=/(?:\d|\-\d|\.\d|\-\.\d|\+=\d|\-=\d|\+=.\d|\-=\.\d)+/g,s=/(?:\+=|\-=|\-|\b)[\d\-\.]+[a-zA-Z0-9]*(?:%|\b)/gi,t=/(?![+-]?\d*\.?\d+|[+-]|e[+-]\d+)[^0-9]/g,u=/(?:\d|\-|\+|=|#|\.)*/g,v=/opacity *= *([^)]*)/i,w=/opacity:([^;]*)/i,x=/alpha\(opacity *=.+?\)/i,y=/^(rgb|hsl)/,z=/([A-Z])/g,A=/-([a-z])/gi,B=/(^(?:url\(\"|url\())|(?:(\"\))$|\)$)/gi,C=function(a,b){return b.toUpperCase()},D=/(?:Left|Right|Width)/i,E=/(M11|M12|M21|M22)=[\d\-\.e]+/gi,F=/progid\:DXImageTransform\.Microsoft\.Matrix\(.+?\)/i,G=/,(?=[^\)]*(?:\(|$))/gi,H=Math.PI/180,I=180/Math.PI,J={},K=document,L=function(a){return K.createElementNS?K.createElementNS("http://www.w3.org/1999/xhtml",a):K.createElement(a)},M=L("div"),N=L("img"),O=g._internals={_specialProps:i},P=navigator.userAgent,Q=function(){var a=P.indexOf("Android"),b=L("a");return m=-1!==P.indexOf("Safari")&&-1===P.indexOf("Chrome")&&(-1===a||Number(P.substr(a+8,1))>3),o=m&&Number(P.substr(P.indexOf("Version/")+8,1))<6,n=-1!==P.indexOf("Firefox"),(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(P)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(P))&&(p=parseFloat(RegExp.$1)),b?(b.style.cssText="top:1px;opacity:.55;",/^0.55/.test(b.style.opacity)):!1}(),R=function(a){return v.test("string"==typeof a?a:(a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?parseFloat(RegExp.$1)/100:1},S=function(a){window.console&&console.log(a)},T="",U="",V=function(a,b){b=b||M;var c,d,e=b.style;if(void 0!==e[a])return a;for(a=a.charAt(0).toUpperCase()+a.substr(1),c=["O","Moz","ms","Ms","Webkit"],d=5;--d>-1&&void 0===e[c[d]+a];);return d>=0?(U=3===d?"ms":c[d],T="-"+U.toLowerCase()+"-",U+a):null},W=K.defaultView?K.defaultView.getComputedStyle:function(){},X=g.getStyle=function(a,b,c,d,e){var f;return Q||"opacity"!==b?(!d&&a.style[b]?f=a.style[b]:(c=c||W(a))?f=c[b]||c.getPropertyValue(b)||c.getPropertyValue(b.replace(z,"-$1").toLowerCase()):a.currentStyle&&(f=a.currentStyle[b]),null==e||f&&"none"!==f&&"auto"!==f&&"auto auto"!==f?f:e):R(a)},Y=O.convertToPixels=function(a,c,d,e,f){if("px"===e||!e)return d;if("auto"===e||!d)return 0;var h,i,j,k=D.test(c),l=a,m=M.style,n=0>d;if(n&&(d=-d),"%"===e&&-1!==c.indexOf("border"))h=d/100*(k?a.clientWidth:a.clientHeight);else{if(m.cssText="border:0 solid red;position:"+X(a,"position")+";line-height:0;","%"!==e&&l.appendChild&&"v"!==e.charAt(0)&&"rem"!==e)m[k?"borderLeftWidth":"borderTopWidth"]=d+e;else{if(l=a.parentNode||K.body,i=l._gsCache,j=b.ticker.frame,i&&k&&i.time===j)return i.width*d/100;m[k?"width":"height"]=d+e}l.appendChild(M),h=parseFloat(M[k?"offsetWidth":"offsetHeight"]),l.removeChild(M),k&&"%"===e&&g.cacheWidths!==!1&&(i=l._gsCache=l._gsCache||{},i.time=j,i.width=h/d*100),0!==h||f||(h=Y(a,c,d,e,!0))}return n?-h:h},Z=O.calculateOffset=function(a,b,c){if("absolute"!==X(a,"position",c))return 0;var d="left"===b?"Left":"Top",e=X(a,"margin"+d,c);return a["offset"+d]-(Y(a,b,parseFloat(e),e.replace(u,""))||0)},$=function(a,b){var c,d,e,f={};if(b=b||W(a,null))if(c=b.length)for(;--c>-1;)e=b[c],(-1===e.indexOf("-transform")||za===e)&&(f[e.replace(A,C)]=b.getPropertyValue(e));else for(c in b)(-1===c.indexOf("Transform")||ya===c)&&(f[c]=b[c]);else if(b=a.currentStyle||a.style)for(c in b)"string"==typeof c&&void 0===f[c]&&(f[c.replace(A,C)]=b[c]);return Q||(f.opacity=R(a)),d=La(a,b,!1),f.rotation=d.rotation,f.skewX=d.skewX,f.scaleX=d.scaleX,f.scaleY=d.scaleY,f.x=d.x,f.y=d.y,Ba&&(f.z=d.z,f.rotationX=d.rotationX,f.rotationY=d.rotationY,f.scaleZ=d.scaleZ),f.filters&&delete f.filters,f},_=function(a,b,c,d,e){var f,g,h,i={},j=a.style;for(g in c)"cssText"!==g&&"length"!==g&&isNaN(g)&&(b[g]!==(f=c[g])||e&&e[g])&&-1===g.indexOf("Origin")&&("number"==typeof f||"string"==typeof f)&&(i[g]="auto"!==f||"left"!==g&&"top"!==g?""!==f&&"auto"!==f&&"none"!==f||"string"!=typeof b[g]||""===b[g].replace(t,"")?f:0:Z(a,g),void 0!==j[g]&&(h=new oa(j,g,j[g],h)));if(d)for(g in d)"className"!==g&&(i[g]=d[g]);return{difs:i,firstMPT:h}},aa={width:["Left","Right"],height:["Top","Bottom"]},ba=["marginLeft","marginRight","marginTop","marginBottom"],ca=function(a,b,c){var d=parseFloat("width"===b?a.offsetWidth:a.offsetHeight),e=aa[b],f=e.length;for(c=c||W(a,null);--f>-1;)d-=parseFloat(X(a,"padding"+e[f],c,!0))||0,d-=parseFloat(X(a,"border"+e[f]+"Width",c,!0))||0;return d},da=function(a,b){if("contain"===a||"auto"===a||"auto auto"===a)return a+" ";(null==a||""===a)&&(a="0 0");var c=a.split(" "),d=-1!==a.indexOf("left")?"0%":-1!==a.indexOf("right")?"100%":c[0],e=-1!==a.indexOf("top")?"0%":-1!==a.indexOf("bottom")?"100%":c[1];return null==e?e="center"===d?"50%":"0":"center"===e&&(e="50%"),("center"===d||isNaN(parseFloat(d))&&-1===(d+"").indexOf("="))&&(d="50%"),a=d+" "+e+(c.length>2?" "+c[2]:""),b&&(b.oxp=-1!==d.indexOf("%"),b.oyp=-1!==e.indexOf("%"),b.oxr="="===d.charAt(1),b.oyr="="===e.charAt(1),b.ox=parseFloat(d.replace(t,"")),b.oy=parseFloat(e.replace(t,"")),b.v=a),b||a},ea=function(a,b){return"string"==typeof a&&"="===a.charAt(1)?parseInt(a.charAt(0)+"1",10)*parseFloat(a.substr(2)):parseFloat(a)-parseFloat(b)},fa=function(a,b){return null==a?b:"string"==typeof a&&"="===a.charAt(1)?parseInt(a.charAt(0)+"1",10)*parseFloat(a.substr(2))+b:parseFloat(a)},ga=function(a,b,c,d){var e,f,g,h,i,j=1e-6;return null==a?h=b:"number"==typeof a?h=a:(e=360,f=a.split("_"),i="="===a.charAt(1),g=(i?parseInt(a.charAt(0)+"1",10)*parseFloat(f[0].substr(2)):parseFloat(f[0]))*(-1===a.indexOf("rad")?1:I)-(i?0:b),f.length&&(d&&(d[c]=b+g),-1!==a.indexOf("short")&&(g%=e,g!==g%(e/2)&&(g=0>g?g+e:g-e)),-1!==a.indexOf("_cw")&&0>g?g=(g+9999999999*e)%e-(g/e|0)*e:-1!==a.indexOf("ccw")&&g>0&&(g=(g-9999999999*e)%e-(g/e|0)*e)),h=b+g),j>h&&h>-j&&(h=0),h},ha={aqua:[0,255,255],lime:[0,255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,255],navy:[0,0,128],white:[255,255,255],fuchsia:[255,0,255],olive:[128,128,0],yellow:[255,255,0],orange:[255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[255,0,0],pink:[255,192,203],cyan:[0,255,255],transparent:[255,255,255,0]},ia=function(a,b,c){return a=0>a?a+1:a>1?a-1:a,255*(1>6*a?b+(c-b)*a*6:.5>a?c:2>3*a?b+(c-b)*(2/3-a)*6:b)+.5|0},ja=g.parseColor=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;if(a)if("number"==typeof a)c=[a>>16,a>>8&255,255&a];else{if(","===a.charAt(a.length-1)&&(a=a.substr(0,a.length-1)),ha[a])c=ha[a];else if("#"===a.charAt(0))4===a.length&&(d=a.charAt(1),e=a.charAt(2),f=a.charAt(3),a="#"+d+d+e+e+f+f),a=parseInt(a.substr(1),16),c=[a>>16,a>>8&255,255&a];else if("hsl"===a.substr(0,3))if(c=m=a.match(q),b){if(-1!==a.indexOf("="))return a.match(r)}else g=Number(c[0])%360/360,h=Number(c[1])/100,i=Number(c[2])/100,e=.5>=i?i*(h+1):i+h-i*h,d=2*i-e,c.length>3&&(c[3]=Number(a[3])),c[0]=ia(g+1/3,d,e),c[1]=ia(g,d,e),c[2]=ia(g-1/3,d,e);else c=a.match(q)||ha.transparent;c[0]=Number(c[0]),c[1]=Number(c[1]),c[2]=Number(c[2]),c.length>3&&(c[3]=Number(c[3]))}else c=ha.black;return b&&!m&&(d=c[0]/255,e=c[1]/255,f=c[2]/255,j=Math.max(d,e,f),k=Math.min(d,e,f),i=(j+k)/2,j===k?g=h=0:(l=j-k,h=i>.5?l/(2-j-k):l/(j+k),g=j===d?(e-f)/l+(f>e?6:0):j===e?(f-d)/l+2:(d-e)/l+4,g*=60),c[0]=g+.5|0,c[1]=100*h+.5|0,c[2]=100*i+.5|0),c},ka=function(a,b){var c,d,e,f=a.match(la)||[],g=0,h=f.length?"":a;for(c=0;c<f.length;c++)d=f[c],e=a.substr(g,a.indexOf(d,g)-g),g+=e.length+d.length,d=ja(d,b),3===d.length&&d.push(1),h+=e+(b?"hsla("+d[0]+","+d[1]+"%,"+d[2]+"%,"+d[3]:"rgba("+d.join(","))+")";return h},la="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3}){1,2}\\b";for(j in ha)la+="|"+j+"\\b";la=new RegExp(la+")","gi"),g.colorStringFilter=function(a){var b,c=a[0]+a[1];la.lastIndex=0,la.test(c)&&(b=-1!==c.indexOf("hsl(")||-1!==c.indexOf("hsla("),a[0]=ka(a[0],b),a[1]=ka(a[1],b))},b.defaultStringFilter||(b.defaultStringFilter=g.colorStringFilter);var ma=function(a,b,c,d){if(null==a)return function(a){return a};var e,f=b?(a.match(la)||[""])[0]:"",g=a.split(f).join("").match(s)||[],h=a.substr(0,a.indexOf(g[0])),i=")"===a.charAt(a.length-1)?")":"",j=-1!==a.indexOf(" ")?" ":",",k=g.length,l=k>0?g[0].replace(q,""):"";return k?e=b?function(a){var b,m,n,o;if("number"==typeof a)a+=l;else if(d&&G.test(a)){for(o=a.replace(G,"|").split("|"),n=0;n<o.length;n++)o[n]=e(o[n]);return o.join(",")}if(b=(a.match(la)||[f])[0],m=a.split(b).join("").match(s)||[],n=m.length,k>n--)for(;++n<k;)m[n]=c?m[(n-1)/2|0]:g[n];return h+m.join(j)+j+b+i+(-1!==a.indexOf("inset")?" inset":"")}:function(a){var b,f,m;if("number"==typeof a)a+=l;else if(d&&G.test(a)){for(f=a.replace(G,"|").split("|"),m=0;m<f.length;m++)f[m]=e(f[m]);return f.join(",")}if(b=a.match(s)||[],m=b.length,k>m--)for(;++m<k;)b[m]=c?b[(m-1)/2|0]:g[m];return h+b.join(j)+i}:function(a){return a}},na=function(a){return a=a.split(","),function(b,c,d,e,f,g,h){var i,j=(c+"").split(" ");for(h={},i=0;4>i;i++)h[a[i]]=j[i]=j[i]||j[(i-1)/2>>0];return e.parse(b,h,f,g)}},oa=(O._setPluginRatio=function(a){this.plugin.setRatio(a);for(var b,c,d,e,f,g=this.data,h=g.proxy,i=g.firstMPT,j=1e-6;i;)b=h[i.v],i.r?b=Math.round(b):j>b&&b>-j&&(b=0),i.t[i.p]=b,i=i._next;if(g.autoRotate&&(g.autoRotate.rotation=h.rotation),1===a||0===a)for(i=g.firstMPT,f=1===a?"e":"b";i;){if(c=i.t,c.type){if(1===c.type){for(e=c.xs0+c.s+c.xs1,d=1;d<c.l;d++)e+=c["xn"+d]+c["xs"+(d+1)];c[f]=e}}else c[f]=c.s+c.xs0;i=i._next}},function(a,b,c,d,e){this.t=a,this.p=b,this.v=c,this.r=e,d&&(d._prev=this,this._next=d)}),pa=(O._parseToProxy=function(a,b,c,d,e,f){var g,h,i,j,k,l=d,m={},n={},o=c._transform,p=J;for(c._transform=null,J=b,d=k=c.parse(a,b,d,e),J=p,f&&(c._transform=o,l&&(l._prev=null,l._prev&&(l._prev._next=null)));d&&d!==l;){if(d.type<=1&&(h=d.p,n[h]=d.s+d.c,m[h]=d.s,f||(j=new oa(d,"s",h,j,d.r),d.c=0),1===d.type))for(g=d.l;--g>0;)i="xn"+g,h=d.p+"_"+i,n[h]=d.data[i],m[h]=d[i],f||(j=new oa(d,i,h,j,d.rxp[i]));d=d._next}return{proxy:m,end:n,firstMPT:j,pt:k}},O.CSSPropTween=function(a,b,d,e,g,h,i,j,k,l,m){this.t=a,this.p=b,this.s=d,this.c=e,this.n=i||b,a instanceof pa||f.push(this.n),this.r=j,this.type=h||0,k&&(this.pr=k,c=!0),this.b=void 0===l?d:l,this.e=void 0===m?d+e:m,g&&(this._next=g,g._prev=this)}),qa=function(a,b,c,d,e,f){var g=new pa(a,b,c,d-c,e,-1,f);return g.b=c,g.e=g.xs0=d,g},ra=g.parseComplex=function(a,b,c,d,e,f,g,h,i,j){c=c||f||"",g=new pa(a,b,0,0,g,j?2:1,null,!1,h,c,d),d+="";var l,m,n,o,p,s,t,u,v,w,x,y,z,A=c.split(", ").join(",").split(" "),B=d.split(", ").join(",").split(" "),C=A.length,D=k!==!1;for((-1!==d.indexOf(",")||-1!==c.indexOf(","))&&(A=A.join(" ").replace(G,", ").split(" "),B=B.join(" ").replace(G,", ").split(" "),C=A.length),C!==B.length&&(A=(f||"").split(" "),C=A.length),g.plugin=i,g.setRatio=j,la.lastIndex=0,l=0;C>l;l++)if(o=A[l],p=B[l],u=parseFloat(o),u||0===u)g.appendXtra("",u,ea(p,u),p.replace(r,""),D&&-1!==p.indexOf("px"),!0);else if(e&&la.test(o))y=","===p.charAt(p.length-1)?"),":")",z=-1!==p.indexOf("hsl")&&Q,o=ja(o,z),p=ja(p,z),v=o.length+p.length>6,v&&!Q&&0===p[3]?(g["xs"+g.l]+=g.l?" transparent":"transparent",g.e=g.e.split(B[l]).join("transparent")):(Q||(v=!1),z?g.appendXtra(v?"hsla(":"hsl(",o[0],ea(p[0],o[0]),",",!1,!0).appendXtra("",o[1],ea(p[1],o[1]),"%,",!1).appendXtra("",o[2],ea(p[2],o[2]),v?"%,":"%"+y,!1):g.appendXtra(v?"rgba(":"rgb(",o[0],p[0]-o[0],",",!0,!0).appendXtra("",o[1],p[1]-o[1],",",!0).appendXtra("",o[2],p[2]-o[2],v?",":y,!0),v&&(o=o.length<4?1:o[3],g.appendXtra("",o,(p.length<4?1:p[3])-o,y,!1))),la.lastIndex=0;else if(s=o.match(q)){if(t=p.match(r),!t||t.length!==s.length)return g;for(n=0,m=0;m<s.length;m++)x=s[m],w=o.indexOf(x,n),g.appendXtra(o.substr(n,w-n),Number(x),ea(t[m],x),"",D&&"px"===o.substr(w+x.length,2),0===m),n=w+x.length;g["xs"+g.l]+=o.substr(n)}else g["xs"+g.l]+=g.l?" "+p:p;if(-1!==d.indexOf("=")&&g.data){for(y=g.xs0+g.data.s,l=1;l<g.l;l++)y+=g["xs"+l]+g.data["xn"+l];g.e=y+g["xs"+l]}return g.l||(g.type=-1,g.xs0=g.e),g.xfirst||g},sa=9;for(j=pa.prototype,j.l=j.pr=0;--sa>0;)j["xn"+sa]=0,j["xs"+sa]="";j.xs0="",j._next=j._prev=j.xfirst=j.data=j.plugin=j.setRatio=j.rxp=null,j.appendXtra=function(a,b,c,d,e,f){var g=this,h=g.l;return g["xs"+h]+=f&&h?" "+a:a||"",c||0===h||g.plugin?(g.l++,g.type=g.setRatio?2:1,g["xs"+g.l]=d||"",h>0?(g.data["xn"+h]=b+c,g.rxp["xn"+h]=e,g["xn"+h]=b,g.plugin||(g.xfirst=new pa(g,"xn"+h,b,c,g.xfirst||g,0,g.n,e,g.pr),g.xfirst.xs0=0),g):(g.data={s:b+c},g.rxp={},g.s=b,g.c=c,g.r=e,g)):(g["xs"+h]+=b+(d||""),g)};var ta=function(a,b){b=b||{},this.p=b.prefix?V(a)||a:a,i[a]=i[this.p]=this,this.format=b.formatter||ma(b.defaultValue,b.color,b.collapsible,b.multi),b.parser&&(this.parse=b.parser),this.clrs=b.color,this.multi=b.multi,this.keyword=b.keyword,this.dflt=b.defaultValue,this.pr=b.priority||0},ua=O._registerComplexSpecialProp=function(a,b,c){"object"!=typeof b&&(b={parser:c});var d,e,f=a.split(","),g=b.defaultValue;for(c=c||[g],d=0;d<f.length;d++)b.prefix=0===d&&b.prefix,b.defaultValue=c[d]||g,e=new ta(f[d],b)},va=function(a){if(!i[a]){var b=a.charAt(0).toUpperCase()+a.substr(1)+"Plugin";ua(a,{parser:function(a,c,d,e,f,g,j){var k=h.com.greensock.plugins[b];return k?(k._cssRegister(),i[d].parse(a,c,d,e,f,g,j)):(S("Error: "+b+" js file not loaded."),f)}})}};j=ta.prototype,j.parseComplex=function(a,b,c,d,e,f){var g,h,i,j,k,l,m=this.keyword;if(this.multi&&(G.test(c)||G.test(b)?(h=b.replace(G,"|").split("|"),i=c.replace(G,"|").split("|")):m&&(h=[b],i=[c])),i){for(j=i.length>h.length?i.length:h.length,g=0;j>g;g++)b=h[g]=h[g]||this.dflt,c=i[g]=i[g]||this.dflt,m&&(k=b.indexOf(m),l=c.indexOf(m),k!==l&&(-1===l?h[g]=h[g].split(m).join(""):-1===k&&(h[g]+=" "+m)));b=h.join(", "),c=i.join(", ")}return ra(a,this.p,b,c,this.clrs,this.dflt,d,this.pr,e,f)},j.parse=function(a,b,c,d,f,g,h){return this.parseComplex(a.style,this.format(X(a,this.p,e,!1,this.dflt)),this.format(b),f,g)},g.registerSpecialProp=function(a,b,c){ua(a,{parser:function(a,d,e,f,g,h,i){var j=new pa(a,e,0,0,g,2,e,!1,c);return j.plugin=h,j.setRatio=b(a,d,f._tween,e),j},priority:c})},g.useSVGTransformAttr=m||n;var wa,xa="scaleX,scaleY,scaleZ,x,y,z,skewX,skewY,rotation,rotationX,rotationY,perspective,xPercent,yPercent".split(","),ya=V("transform"),za=T+"transform",Aa=V("transformOrigin"),Ba=null!==V("perspective"),Ca=O.Transform=function(){this.perspective=parseFloat(g.defaultTransformPerspective)||0,this.force3D=g.defaultForce3D!==!1&&Ba?g.defaultForce3D||"auto":!1},Da=window.SVGElement,Ea=function(a,b,c){var d,e=K.createElementNS("http://www.w3.org/2000/svg",a),f=/([a-z])([A-Z])/g;for(d in c)e.setAttributeNS(null,d.replace(f,"$1-$2").toLowerCase(),c[d]);return b.appendChild(e),e},Fa=K.documentElement,Ga=function(){var a,b,c,d=p||/Android/i.test(P)&&!window.chrome;return K.createElementNS&&!d&&(a=Ea("svg",Fa),b=Ea("rect",a,{width:100,height:50,x:100}),c=b.getBoundingClientRect().width,b.style[Aa]="50% 50%",b.style[ya]="scaleX(0.5)",d=c===b.getBoundingClientRect().width&&!(n&&Ba),Fa.removeChild(a)),d}(),Ha=function(a,b,c,d,e){var f,h,i,j,k,l,m,n,o,p,q,r,s,t,u=a._gsTransform,v=Ka(a,!0);u&&(s=u.xOrigin,t=u.yOrigin),(!d||(f=d.split(" ")).length<2)&&(m=a.getBBox(),b=da(b).split(" "),f=[(-1!==b[0].indexOf("%")?parseFloat(b[0])/100*m.width:parseFloat(b[0]))+m.x,(-1!==b[1].indexOf("%")?parseFloat(b[1])/100*m.height:parseFloat(b[1]))+m.y]),c.xOrigin=j=parseFloat(f[0]),c.yOrigin=k=parseFloat(f[1]),d&&v!==Ja&&(l=v[0],m=v[1],n=v[2],o=v[3],p=v[4],q=v[5],r=l*o-m*n,h=j*(o/r)+k*(-n/r)+(n*q-o*p)/r,i=j*(-m/r)+k*(l/r)-(l*q-m*p)/r,j=c.xOrigin=f[0]=h,k=c.yOrigin=f[1]=i),u&&(e||e!==!1&&g.defaultSmoothOrigin!==!1?(h=j-s,i=k-t,u.xOffset+=h*v[0]+i*v[2]-h,u.yOffset+=h*v[1]+i*v[3]-i):u.xOffset=u.yOffset=0),a.setAttribute("data-svg-origin",f.join(" "))},Ia=function(a){return!!(Da&&"function"==typeof a.getBBox&&a.getCTM&&(!a.parentNode||a.parentNode.getBBox&&a.parentNode.getCTM))},Ja=[1,0,0,1,0,0],Ka=function(a,b){var c,d,e,f,g,h=a._gsTransform||new Ca,i=1e5;if(ya?d=X(a,za,null,!0):a.currentStyle&&(d=a.currentStyle.filter.match(E),d=d&&4===d.length?[d[0].substr(4),Number(d[2].substr(4)),Number(d[1].substr(4)),d[3].substr(4),h.x||0,h.y||0].join(","):""),c=!d||"none"===d||"matrix(1, 0, 0, 1, 0, 0)"===d,(h.svg||a.getBBox&&Ia(a))&&(c&&-1!==(a.style[ya]+"").indexOf("matrix")&&(d=a.style[ya],c=0),e=a.getAttribute("transform"),c&&e&&(-1!==e.indexOf("matrix")?(d=e,c=0):-1!==e.indexOf("translate")&&(d="matrix(1,0,0,1,"+e.match(/(?:\-|\b)[\d\-\.e]+\b/gi).join(",")+")",c=0))),c)return Ja;for(e=(d||"").match(/(?:\-|\b)[\d\-\.e]+\b/gi)||[],sa=e.length;--sa>-1;)f=Number(e[sa]),e[sa]=(g=f-(f|=0))?(g*i+(0>g?-.5:.5)|0)/i+f:f;return b&&e.length>6?[e[0],e[1],e[4],e[5],e[12],e[13]]:e},La=O.getTransform=function(a,c,d,f){if(a._gsTransform&&d&&!f)return a._gsTransform;var h,i,j,k,l,m,n=d?a._gsTransform||new Ca:new Ca,o=n.scaleX<0,p=2e-5,q=1e5,r=Ba?parseFloat(X(a,Aa,c,!1,"0 0 0").split(" ")[2])||n.zOrigin||0:0,s=parseFloat(g.defaultTransformPerspective)||0;if(n.svg=!(!a.getBBox||!Ia(a)),n.svg&&(Ha(a,X(a,Aa,e,!1,"50% 50%")+"",n,a.getAttribute("data-svg-origin")),wa=g.useSVGTransformAttr||Ga),h=Ka(a),h!==Ja){if(16===h.length){var t,u,v,w,x,y=h[0],z=h[1],A=h[2],B=h[3],C=h[4],D=h[5],E=h[6],F=h[7],G=h[8],H=h[9],J=h[10],K=h[12],L=h[13],M=h[14],N=h[11],O=Math.atan2(E,J);n.zOrigin&&(M=-n.zOrigin,K=G*M-h[12],L=H*M-h[13],M=J*M+n.zOrigin-h[14]),n.rotationX=O*I,O&&(w=Math.cos(-O),x=Math.sin(-O),t=C*w+G*x,u=D*w+H*x,v=E*w+J*x,G=C*-x+G*w,H=D*-x+H*w,J=E*-x+J*w,N=F*-x+N*w,C=t,D=u,E=v),O=Math.atan2(-A,J),n.rotationY=O*I,O&&(w=Math.cos(-O),x=Math.sin(-O),t=y*w-G*x,u=z*w-H*x,v=A*w-J*x,H=z*x+H*w,J=A*x+J*w,N=B*x+N*w,y=t,z=u,A=v),O=Math.atan2(z,y),n.rotation=O*I,O&&(w=Math.cos(-O),x=Math.sin(-O),y=y*w+C*x,u=z*w+D*x,D=z*-x+D*w,E=A*-x+E*w,z=u),n.rotationX&&Math.abs(n.rotationX)+Math.abs(n.rotation)>359.9&&(n.rotationX=n.rotation=0,n.rotationY=180-n.rotationY),n.scaleX=(Math.sqrt(y*y+z*z)*q+.5|0)/q,n.scaleY=(Math.sqrt(D*D+H*H)*q+.5|0)/q,n.scaleZ=(Math.sqrt(E*E+J*J)*q+.5|0)/q,n.skewX=0,n.perspective=N?1/(0>N?-N:N):0,n.x=K,n.y=L,n.z=M,n.svg&&(n.x-=n.xOrigin-(n.xOrigin*y-n.yOrigin*C),n.y-=n.yOrigin-(n.yOrigin*z-n.xOrigin*D))}else if((!Ba||f||!h.length||n.x!==h[4]||n.y!==h[5]||!n.rotationX&&!n.rotationY)&&(void 0===n.x||"none"!==X(a,"display",c))){var P=h.length>=6,Q=P?h[0]:1,R=h[1]||0,S=h[2]||0,T=P?h[3]:1;n.x=h[4]||0,n.y=h[5]||0,j=Math.sqrt(Q*Q+R*R),k=Math.sqrt(T*T+S*S),l=Q||R?Math.atan2(R,Q)*I:n.rotation||0,m=S||T?Math.atan2(S,T)*I+l:n.skewX||0,Math.abs(m)>90&&Math.abs(m)<270&&(o?(j*=-1,m+=0>=l?180:-180,l+=0>=l?180:-180):(k*=-1,m+=0>=m?180:-180)),n.scaleX=j,n.scaleY=k,n.rotation=l,n.skewX=m,Ba&&(n.rotationX=n.rotationY=n.z=0,n.perspective=s,n.scaleZ=1),n.svg&&(n.x-=n.xOrigin-(n.xOrigin*Q+n.yOrigin*S),n.y-=n.yOrigin-(n.xOrigin*R+n.yOrigin*T))}n.zOrigin=r;for(i in n)n[i]<p&&n[i]>-p&&(n[i]=0)}return d&&(a._gsTransform=n,n.svg&&(wa&&a.style[ya]?b.delayedCall(.001,function(){Pa(a.style,ya)}):!wa&&a.getAttribute("transform")&&b.delayedCall(.001,function(){a.removeAttribute("transform")}))),n},Ma=function(a){var b,c,d=this.data,e=-d.rotation*H,f=e+d.skewX*H,g=1e5,h=(Math.cos(e)*d.scaleX*g|0)/g,i=(Math.sin(e)*d.scaleX*g|0)/g,j=(Math.sin(f)*-d.scaleY*g|0)/g,k=(Math.cos(f)*d.scaleY*g|0)/g,l=this.t.style,m=this.t.currentStyle;if(m){c=i,i=-j,j=-c,b=m.filter,l.filter="";var n,o,q=this.t.offsetWidth,r=this.t.offsetHeight,s="absolute"!==m.position,t="progid:DXImageTransform.Microsoft.Matrix(M11="+h+", M12="+i+", M21="+j+", M22="+k,w=d.x+q*d.xPercent/100,x=d.y+r*d.yPercent/100;if(null!=d.ox&&(n=(d.oxp?q*d.ox*.01:d.ox)-q/2,o=(d.oyp?r*d.oy*.01:d.oy)-r/2,w+=n-(n*h+o*i),x+=o-(n*j+o*k)),s?(n=q/2,o=r/2,t+=", Dx="+(n-(n*h+o*i)+w)+", Dy="+(o-(n*j+o*k)+x)+")"):t+=", sizingMethod='auto expand')",-1!==b.indexOf("DXImageTransform.Microsoft.Matrix(")?l.filter=b.replace(F,t):l.filter=t+" "+b,(0===a||1===a)&&1===h&&0===i&&0===j&&1===k&&(s&&-1===t.indexOf("Dx=0, Dy=0")||v.test(b)&&100!==parseFloat(RegExp.$1)||-1===b.indexOf(b.indexOf("Alpha"))&&l.removeAttribute("filter")),!s){var y,z,A,B=8>p?1:-1;for(n=d.ieOffsetX||0,o=d.ieOffsetY||0,d.ieOffsetX=Math.round((q-((0>h?-h:h)*q+(0>i?-i:i)*r))/2+w),d.ieOffsetY=Math.round((r-((0>k?-k:k)*r+(0>j?-j:j)*q))/2+x),sa=0;4>sa;sa++)z=ba[sa],y=m[z],c=-1!==y.indexOf("px")?parseFloat(y):Y(this.t,z,parseFloat(y),y.replace(u,""))||0,A=c!==d[z]?2>sa?-d.ieOffsetX:-d.ieOffsetY:2>sa?n-d.ieOffsetX:o-d.ieOffsetY,l[z]=(d[z]=Math.round(c-A*(0===sa||2===sa?1:B)))+"px"}}},Na=O.set3DTransformRatio=O.setTransformRatio=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,o,p,q,r,s,t,u,v,w,x,y,z=this.data,A=this.t.style,B=z.rotation,C=z.rotationX,D=z.rotationY,E=z.scaleX,F=z.scaleY,G=z.scaleZ,I=z.x,J=z.y,K=z.z,L=z.svg,M=z.perspective,N=z.force3D;if(((1===a||0===a)&&"auto"===N&&(this.tween._totalTime===this.tween._totalDuration||!this.tween._totalTime)||!N)&&!K&&!M&&!D&&!C&&1===G||wa&&L||!Ba)return void(B||z.skewX||L?(B*=H,x=z.skewX*H,y=1e5,b=Math.cos(B)*E,e=Math.sin(B)*E,c=Math.sin(B-x)*-F,f=Math.cos(B-x)*F,x&&"simple"===z.skewType&&(s=Math.tan(x),s=Math.sqrt(1+s*s),c*=s,f*=s,z.skewY&&(b*=s,e*=s)),L&&(I+=z.xOrigin-(z.xOrigin*b+z.yOrigin*c)+z.xOffset,J+=z.yOrigin-(z.xOrigin*e+z.yOrigin*f)+z.yOffset,wa&&(z.xPercent||z.yPercent)&&(p=this.t.getBBox(),I+=.01*z.xPercent*p.width,J+=.01*z.yPercent*p.height),p=1e-6,p>I&&I>-p&&(I=0),p>J&&J>-p&&(J=0)),u=(b*y|0)/y+","+(e*y|0)/y+","+(c*y|0)/y+","+(f*y|0)/y+","+I+","+J+")",L&&wa?this.t.setAttribute("transform","matrix("+u):A[ya]=(z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) matrix(":"matrix(")+u):A[ya]=(z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) matrix(":"matrix(")+E+",0,0,"+F+","+I+","+J+")");if(n&&(p=1e-4,p>E&&E>-p&&(E=G=2e-5),p>F&&F>-p&&(F=G=2e-5),!M||z.z||z.rotationX||z.rotationY||(M=0)),B||z.skewX)B*=H,q=b=Math.cos(B),r=e=Math.sin(B),z.skewX&&(B-=z.skewX*H,q=Math.cos(B),r=Math.sin(B),"simple"===z.skewType&&(s=Math.tan(z.skewX*H),s=Math.sqrt(1+s*s),q*=s,r*=s,z.skewY&&(b*=s,e*=s))),c=-r,f=q;else{if(!(D||C||1!==G||M||L))return void(A[ya]=(z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) translate3d(":"translate3d(")+I+"px,"+J+"px,"+K+"px)"+(1!==E||1!==F?" scale("+E+","+F+")":""));b=f=1,c=e=0}j=1,d=g=h=i=k=l=0,m=M?-1/M:0,o=z.zOrigin,p=1e-6,v=",",w="0",B=D*H,B&&(q=Math.cos(B),r=Math.sin(B),h=-r,k=m*-r,d=b*r,g=e*r,j=q,m*=q,b*=q,e*=q),B=C*H,B&&(q=Math.cos(B),r=Math.sin(B),s=c*q+d*r,t=f*q+g*r,i=j*r,l=m*r,d=c*-r+d*q,g=f*-r+g*q,j*=q,m*=q,c=s,f=t),1!==G&&(d*=G,g*=G,j*=G,m*=G),1!==F&&(c*=F,f*=F,i*=F,l*=F),1!==E&&(b*=E,e*=E,h*=E,k*=E),(o||L)&&(o&&(I+=d*-o,J+=g*-o,K+=j*-o+o),L&&(I+=z.xOrigin-(z.xOrigin*b+z.yOrigin*c)+z.xOffset,J+=z.yOrigin-(z.xOrigin*e+z.yOrigin*f)+z.yOffset),p>I&&I>-p&&(I=w),p>J&&J>-p&&(J=w),p>K&&K>-p&&(K=0)),u=z.xPercent||z.yPercent?"translate("+z.xPercent+"%,"+z.yPercent+"%) matrix3d(":"matrix3d(",u+=(p>b&&b>-p?w:b)+v+(p>e&&e>-p?w:e)+v+(p>h&&h>-p?w:h),u+=v+(p>k&&k>-p?w:k)+v+(p>c&&c>-p?w:c)+v+(p>f&&f>-p?w:f),C||D||1!==G?(u+=v+(p>i&&i>-p?w:i)+v+(p>l&&l>-p?w:l)+v+(p>d&&d>-p?w:d),u+=v+(p>g&&g>-p?w:g)+v+(p>j&&j>-p?w:j)+v+(p>m&&m>-p?w:m)+v):u+=",0,0,0,0,1,0,",u+=I+v+J+v+K+v+(M?1+-K/M:1)+")",A[ya]=u};j=Ca.prototype,j.x=j.y=j.z=j.skewX=j.skewY=j.rotation=j.rotationX=j.rotationY=j.zOrigin=j.xPercent=j.yPercent=j.xOffset=j.yOffset=0,j.scaleX=j.scaleY=j.scaleZ=1,ua("transform,scale,scaleX,scaleY,scaleZ,x,y,z,rotation,rotationX,rotationY,rotationZ,skewX,skewY,shortRotation,shortRotationX,shortRotationY,shortRotationZ,transformOrigin,svgOrigin,transformPerspective,directionalRotation,parseTransform,force3D,skewType,xPercent,yPercent,smoothOrigin",{parser:function(a,b,c,d,f,h,i){if(d._lastParsedTransform===i)return f;d._lastParsedTransform=i;var j,k,l,m,n,o,p,q,r,s,t=a._gsTransform,u=a.style,v=1e-6,w=xa.length,x=i,y={},z="transformOrigin";if(i.display?(m=X(a,"display"),u.display="block",j=La(a,e,!0,i.parseTransform),u.display=m):j=La(a,e,!0,i.parseTransform),d._transform=j,"string"==typeof x.transform&&ya)m=M.style,m[ya]=x.transform,m.display="block",m.position="absolute",K.body.appendChild(M),k=La(M,null,!1),K.body.removeChild(M),k.perspective||(k.perspective=j.perspective),null!=x.xPercent&&(k.xPercent=fa(x.xPercent,j.xPercent)),null!=x.yPercent&&(k.yPercent=fa(x.yPercent,j.yPercent));else if("object"==typeof x){if(k={scaleX:fa(null!=x.scaleX?x.scaleX:x.scale,j.scaleX),scaleY:fa(null!=x.scaleY?x.scaleY:x.scale,j.scaleY),scaleZ:fa(x.scaleZ,j.scaleZ),x:fa(x.x,j.x),y:fa(x.y,j.y),z:fa(x.z,j.z),xPercent:fa(x.xPercent,j.xPercent),yPercent:fa(x.yPercent,j.yPercent),perspective:fa(x.transformPerspective,j.perspective)},q=x.directionalRotation,null!=q)if("object"==typeof q)for(m in q)x[m]=q[m];else x.rotation=q;"string"==typeof x.x&&-1!==x.x.indexOf("%")&&(k.x=0,k.xPercent=fa(x.x,j.xPercent)),"string"==typeof x.y&&-1!==x.y.indexOf("%")&&(k.y=0,k.yPercent=fa(x.y,j.yPercent)),k.rotation=ga("rotation"in x?x.rotation:"shortRotation"in x?x.shortRotation+"_short":"rotationZ"in x?x.rotationZ:j.rotation,j.rotation,"rotation",y),Ba&&(k.rotationX=ga("rotationX"in x?x.rotationX:"shortRotationX"in x?x.shortRotationX+"_short":j.rotationX||0,j.rotationX,"rotationX",y),k.rotationY=ga("rotationY"in x?x.rotationY:"shortRotationY"in x?x.shortRotationY+"_short":j.rotationY||0,j.rotationY,"rotationY",y)),k.skewX=null==x.skewX?j.skewX:ga(x.skewX,j.skewX),k.skewY=null==x.skewY?j.skewY:ga(x.skewY,j.skewY),(l=k.skewY-j.skewY)&&(k.skewX+=l,k.rotation+=l)}for(Ba&&null!=x.force3D&&(j.force3D=x.force3D,p=!0),j.skewType=x.skewType||j.skewType||g.defaultSkewType,o=j.force3D||j.z||j.rotationX||j.rotationY||k.z||k.rotationX||k.rotationY||k.perspective,o||null==x.scale||(k.scaleZ=1);--w>-1;)c=xa[w],n=k[c]-j[c],(n>v||-v>n||null!=x[c]||null!=J[c])&&(p=!0,f=new pa(j,c,j[c],n,f),c in y&&(f.e=y[c]),f.xs0=0,f.plugin=h,d._overwriteProps.push(f.n));return n=x.transformOrigin,j.svg&&(n||x.svgOrigin)&&(r=j.xOffset,s=j.yOffset,Ha(a,da(n),k,x.svgOrigin,x.smoothOrigin),f=qa(j,"xOrigin",(t?j:k).xOrigin,k.xOrigin,f,z),f=qa(j,"yOrigin",(t?j:k).yOrigin,k.yOrigin,f,z),(r!==j.xOffset||s!==j.yOffset)&&(f=qa(j,"xOffset",t?r:j.xOffset,j.xOffset,f,z),f=qa(j,"yOffset",t?s:j.yOffset,j.yOffset,f,z)),n=wa?null:"0px 0px"),(n||Ba&&o&&j.zOrigin)&&(ya?(p=!0,c=Aa,n=(n||X(a,c,e,!1,"50% 50%"))+"",f=new pa(u,c,0,0,f,-1,z),f.b=u[c],f.plugin=h,Ba?(m=j.zOrigin,n=n.split(" "),j.zOrigin=(n.length>2&&(0===m||"0px"!==n[2])?parseFloat(n[2]):m)||0,f.xs0=f.e=n[0]+" "+(n[1]||"50%")+" 0px",f=new pa(j,"zOrigin",0,0,f,-1,f.n),f.b=m,f.xs0=f.e=j.zOrigin):f.xs0=f.e=n):da(n+"",j)),p&&(d._transformType=j.svg&&wa||!o&&3!==this._transformType?2:3),f},prefix:!0}),ua("boxShadow",{defaultValue:"0px 0px 0px 0px #999",prefix:!0,color:!0,multi:!0,keyword:"inset"}),ua("borderRadius",{defaultValue:"0px",parser:function(a,b,c,f,g,h){b=this.format(b);var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"],z=a.style;for(q=parseFloat(a.offsetWidth),r=parseFloat(a.offsetHeight),i=b.split(" "),j=0;j<y.length;j++)this.p.indexOf("border")&&(y[j]=V(y[j])),m=l=X(a,y[j],e,!1,"0px"),-1!==m.indexOf(" ")&&(l=m.split(" "),m=l[0],l=l[1]),n=k=i[j],o=parseFloat(m),t=m.substr((o+"").length),u="="===n.charAt(1),u?(p=parseInt(n.charAt(0)+"1",10),n=n.substr(2),p*=parseFloat(n),s=n.substr((p+"").length-(0>p?1:0))||""):(p=parseFloat(n),s=n.substr((p+"").length)),""===s&&(s=d[c]||t),s!==t&&(v=Y(a,"borderLeft",o,t),w=Y(a,"borderTop",o,t),"%"===s?(m=v/q*100+"%",l=w/r*100+"%"):"em"===s?(x=Y(a,"borderLeft",1,"em"),m=v/x+"em",l=w/x+"em"):(m=v+"px",l=w+"px"),u&&(n=parseFloat(m)+p+s,k=parseFloat(l)+p+s)),g=ra(z,y[j],m+" "+l,n+" "+k,!1,"0px",g);return g},prefix:!0,formatter:ma("0px 0px 0px 0px",!1,!0)}),ua("backgroundPosition",{
defaultValue:"0 0",parser:function(a,b,c,d,f,g){var h,i,j,k,l,m,n="background-position",o=e||W(a,null),q=this.format((o?p?o.getPropertyValue(n+"-x")+" "+o.getPropertyValue(n+"-y"):o.getPropertyValue(n):a.currentStyle.backgroundPositionX+" "+a.currentStyle.backgroundPositionY)||"0 0"),r=this.format(b);if(-1!==q.indexOf("%")!=(-1!==r.indexOf("%"))&&(m=X(a,"backgroundImage").replace(B,""),m&&"none"!==m)){for(h=q.split(" "),i=r.split(" "),N.setAttribute("src",m),j=2;--j>-1;)q=h[j],k=-1!==q.indexOf("%"),k!==(-1!==i[j].indexOf("%"))&&(l=0===j?a.offsetWidth-N.width:a.offsetHeight-N.height,h[j]=k?parseFloat(q)/100*l+"px":parseFloat(q)/l*100+"%");q=h.join(" ")}return this.parseComplex(a.style,q,r,f,g)},formatter:da}),ua("backgroundSize",{defaultValue:"0 0",formatter:da}),ua("perspective",{defaultValue:"0px",prefix:!0}),ua("perspectiveOrigin",{defaultValue:"50% 50%",prefix:!0}),ua("transformStyle",{prefix:!0}),ua("backfaceVisibility",{prefix:!0}),ua("userSelect",{prefix:!0}),ua("margin",{parser:na("marginTop,marginRight,marginBottom,marginLeft")}),ua("padding",{parser:na("paddingTop,paddingRight,paddingBottom,paddingLeft")}),ua("clip",{defaultValue:"rect(0px,0px,0px,0px)",parser:function(a,b,c,d,f,g){var h,i,j;return 9>p?(i=a.currentStyle,j=8>p?" ":",",h="rect("+i.clipTop+j+i.clipRight+j+i.clipBottom+j+i.clipLeft+")",b=this.format(b).split(",").join(j)):(h=this.format(X(a,this.p,e,!1,this.dflt)),b=this.format(b)),this.parseComplex(a.style,h,b,f,g)}}),ua("textShadow",{defaultValue:"0px 0px 0px #999",color:!0,multi:!0}),ua("autoRound,strictUnits",{parser:function(a,b,c,d,e){return e}}),ua("border",{defaultValue:"0px solid #000",parser:function(a,b,c,d,f,g){return this.parseComplex(a.style,this.format(X(a,"borderTopWidth",e,!1,"0px")+" "+X(a,"borderTopStyle",e,!1,"solid")+" "+X(a,"borderTopColor",e,!1,"#000")),this.format(b),f,g)},color:!0,formatter:function(a){var b=a.split(" ");return b[0]+" "+(b[1]||"solid")+" "+(a.match(la)||["#000"])[0]}}),ua("borderWidth",{parser:na("borderTopWidth,borderRightWidth,borderBottomWidth,borderLeftWidth")}),ua("float,cssFloat,styleFloat",{parser:function(a,b,c,d,e,f){var g=a.style,h="cssFloat"in g?"cssFloat":"styleFloat";return new pa(g,h,0,0,e,-1,c,!1,0,g[h],b)}});var Oa=function(a){var b,c=this.t,d=c.filter||X(this.data,"filter")||"",e=this.s+this.c*a|0;100===e&&(-1===d.indexOf("atrix(")&&-1===d.indexOf("radient(")&&-1===d.indexOf("oader(")?(c.removeAttribute("filter"),b=!X(this.data,"filter")):(c.filter=d.replace(x,""),b=!0)),b||(this.xn1&&(c.filter=d=d||"alpha(opacity="+e+")"),-1===d.indexOf("pacity")?0===e&&this.xn1||(c.filter=d+" alpha(opacity="+e+")"):c.filter=d.replace(v,"opacity="+e))};ua("opacity,alpha,autoAlpha",{defaultValue:"1",parser:function(a,b,c,d,f,g){var h=parseFloat(X(a,"opacity",e,!1,"1")),i=a.style,j="autoAlpha"===c;return"string"==typeof b&&"="===b.charAt(1)&&(b=("-"===b.charAt(0)?-1:1)*parseFloat(b.substr(2))+h),j&&1===h&&"hidden"===X(a,"visibility",e)&&0!==b&&(h=0),Q?f=new pa(i,"opacity",h,b-h,f):(f=new pa(i,"opacity",100*h,100*(b-h),f),f.xn1=j?1:0,i.zoom=1,f.type=2,f.b="alpha(opacity="+f.s+")",f.e="alpha(opacity="+(f.s+f.c)+")",f.data=a,f.plugin=g,f.setRatio=Oa),j&&(f=new pa(i,"visibility",0,0,f,-1,null,!1,0,0!==h?"inherit":"hidden",0===b?"hidden":"inherit"),f.xs0="inherit",d._overwriteProps.push(f.n),d._overwriteProps.push(c)),f}});var Pa=function(a,b){b&&(a.removeProperty?(("ms"===b.substr(0,2)||"webkit"===b.substr(0,6))&&(b="-"+b),a.removeProperty(b.replace(z,"-$1").toLowerCase())):a.removeAttribute(b))},Qa=function(a){if(this.t._gsClassPT=this,1===a||0===a){this.t.setAttribute("class",0===a?this.b:this.e);for(var b=this.data,c=this.t.style;b;)b.v?c[b.p]=b.v:Pa(c,b.p),b=b._next;1===a&&this.t._gsClassPT===this&&(this.t._gsClassPT=null)}else this.t.getAttribute("class")!==this.e&&this.t.setAttribute("class",this.e)};ua("className",{parser:function(a,b,d,f,g,h,i){var j,k,l,m,n,o=a.getAttribute("class")||"",p=a.style.cssText;if(g=f._classNamePT=new pa(a,d,0,0,g,2),g.setRatio=Qa,g.pr=-11,c=!0,g.b=o,k=$(a,e),l=a._gsClassPT){for(m={},n=l.data;n;)m[n.p]=1,n=n._next;l.setRatio(1)}return a._gsClassPT=g,g.e="="!==b.charAt(1)?b:o.replace(new RegExp("\\s*\\b"+b.substr(2)+"\\b"),"")+("+"===b.charAt(0)?" "+b.substr(2):""),a.setAttribute("class",g.e),j=_(a,k,$(a),i,m),a.setAttribute("class",o),g.data=j.firstMPT,a.style.cssText=p,g=g.xfirst=f.parse(a,j.difs,g,h)}});var Ra=function(a){if((1===a||0===a)&&this.data._totalTime===this.data._totalDuration&&"isFromStart"!==this.data.data){var b,c,d,e,f,g=this.t.style,h=i.transform.parse;if("all"===this.e)g.cssText="",e=!0;else for(b=this.e.split(" ").join("").split(","),d=b.length;--d>-1;)c=b[d],i[c]&&(i[c].parse===h?e=!0:c="transformOrigin"===c?Aa:i[c].p),Pa(g,c);e&&(Pa(g,ya),f=this.t._gsTransform,f&&(f.svg&&(this.t.removeAttribute("data-svg-origin"),this.t.removeAttribute("transform")),delete this.t._gsTransform))}};for(ua("clearProps",{parser:function(a,b,d,e,f){return f=new pa(a,d,0,0,f,2),f.setRatio=Ra,f.e=b,f.pr=-10,f.data=e._tween,c=!0,f}}),j="bezier,throwProps,physicsProps,physics2D".split(","),sa=j.length;sa--;)va(j[sa]);j=g.prototype,j._firstPT=j._lastParsedTransform=j._transform=null,j._onInitTween=function(a,b,h){if(!a.nodeType)return!1;this._target=a,this._tween=h,this._vars=b,k=b.autoRound,c=!1,d=b.suffixMap||g.suffixMap,e=W(a,""),f=this._overwriteProps;var j,n,p,q,r,s,t,u,v,x=a.style;if(l&&""===x.zIndex&&(j=X(a,"zIndex",e),("auto"===j||""===j)&&this._addLazySet(x,"zIndex",0)),"string"==typeof b&&(q=x.cssText,j=$(a,e),x.cssText=q+";"+b,j=_(a,j,$(a)).difs,!Q&&w.test(b)&&(j.opacity=parseFloat(RegExp.$1)),b=j,x.cssText=q),b.className?this._firstPT=n=i.className.parse(a,b.className,"className",this,null,null,b):this._firstPT=n=this.parse(a,b,null),this._transformType){for(v=3===this._transformType,ya?m&&(l=!0,""===x.zIndex&&(t=X(a,"zIndex",e),("auto"===t||""===t)&&this._addLazySet(x,"zIndex",0)),o&&this._addLazySet(x,"WebkitBackfaceVisibility",this._vars.WebkitBackfaceVisibility||(v?"visible":"hidden"))):x.zoom=1,p=n;p&&p._next;)p=p._next;u=new pa(a,"transform",0,0,null,2),this._linkCSSP(u,null,p),u.setRatio=ya?Na:Ma,u.data=this._transform||La(a,e,!0),u.tween=h,u.pr=-1,f.pop()}if(c){for(;n;){for(s=n._next,p=q;p&&p.pr>n.pr;)p=p._next;(n._prev=p?p._prev:r)?n._prev._next=n:q=n,(n._next=p)?p._prev=n:r=n,n=s}this._firstPT=q}return!0},j.parse=function(a,b,c,f){var g,h,j,l,m,n,o,p,q,r,s=a.style;for(g in b)n=b[g],h=i[g],h?c=h.parse(a,n,g,this,c,f,b):(m=X(a,g,e)+"",q="string"==typeof n,"color"===g||"fill"===g||"stroke"===g||-1!==g.indexOf("Color")||q&&y.test(n)?(q||(n=ja(n),n=(n.length>3?"rgba(":"rgb(")+n.join(",")+")"),c=ra(s,g,m,n,!0,"transparent",c,0,f)):!q||-1===n.indexOf(" ")&&-1===n.indexOf(",")?(j=parseFloat(m),o=j||0===j?m.substr((j+"").length):"",(""===m||"auto"===m)&&("width"===g||"height"===g?(j=ca(a,g,e),o="px"):"left"===g||"top"===g?(j=Z(a,g,e),o="px"):(j="opacity"!==g?0:1,o="")),r=q&&"="===n.charAt(1),r?(l=parseInt(n.charAt(0)+"1",10),n=n.substr(2),l*=parseFloat(n),p=n.replace(u,"")):(l=parseFloat(n),p=q?n.replace(u,""):""),""===p&&(p=g in d?d[g]:o),n=l||0===l?(r?l+j:l)+p:b[g],o!==p&&""!==p&&(l||0===l)&&j&&(j=Y(a,g,j,o),"%"===p?(j/=Y(a,g,100,"%")/100,b.strictUnits!==!0&&(m=j+"%")):"em"===p||"rem"===p||"vw"===p||"vh"===p?j/=Y(a,g,1,p):"px"!==p&&(l=Y(a,g,l,p),p="px"),r&&(l||0===l)&&(n=l+j+p)),r&&(l+=j),!j&&0!==j||!l&&0!==l?void 0!==s[g]&&(n||n+""!="NaN"&&null!=n)?(c=new pa(s,g,l||j||0,0,c,-1,g,!1,0,m,n),c.xs0="none"!==n||"display"!==g&&-1===g.indexOf("Style")?n:m):S("invalid "+g+" tween value: "+b[g]):(c=new pa(s,g,j,l-j,c,0,g,k!==!1&&("px"===p||"zIndex"===g),0,m,n),c.xs0=p)):c=ra(s,g,m,n,!0,null,c,0,f)),f&&c&&!c.plugin&&(c.plugin=f);return c},j.setRatio=function(a){var b,c,d,e=this._firstPT,f=1e-6;if(1!==a||this._tween._time!==this._tween._duration&&0!==this._tween._time)if(a||this._tween._time!==this._tween._duration&&0!==this._tween._time||this._tween._rawPrevTime===-1e-6)for(;e;){if(b=e.c*a+e.s,e.r?b=Math.round(b):f>b&&b>-f&&(b=0),e.type)if(1===e.type)if(d=e.l,2===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2;else if(3===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3;else if(4===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3+e.xn3+e.xs4;else if(5===d)e.t[e.p]=e.xs0+b+e.xs1+e.xn1+e.xs2+e.xn2+e.xs3+e.xn3+e.xs4+e.xn4+e.xs5;else{for(c=e.xs0+b+e.xs1,d=1;d<e.l;d++)c+=e["xn"+d]+e["xs"+(d+1)];e.t[e.p]=c}else-1===e.type?e.t[e.p]=e.xs0:e.setRatio&&e.setRatio(a);else e.t[e.p]=b+e.xs0;e=e._next}else for(;e;)2!==e.type?e.t[e.p]=e.b:e.setRatio(a),e=e._next;else for(;e;){if(2!==e.type)if(e.r&&-1!==e.type)if(b=Math.round(e.s+e.c),e.type){if(1===e.type){for(d=e.l,c=e.xs0+b+e.xs1,d=1;d<e.l;d++)c+=e["xn"+d]+e["xs"+(d+1)];e.t[e.p]=c}}else e.t[e.p]=b+e.xs0;else e.t[e.p]=e.e;else e.setRatio(a);e=e._next}},j._enableTransforms=function(a){this._transform=this._transform||La(this._target,e,!0),this._transformType=this._transform.svg&&wa||!a&&3!==this._transformType?2:3};var Sa=function(a){this.t[this.p]=this.e,this.data._linkCSSP(this,this._next,null,!0)};j._addLazySet=function(a,b,c){var d=this._firstPT=new pa(a,b,0,0,this._firstPT,2);d.e=c,d.setRatio=Sa,d.data=this},j._linkCSSP=function(a,b,c,d){return a&&(b&&(b._prev=a),a._next&&(a._next._prev=a._prev),a._prev?a._prev._next=a._next:this._firstPT===a&&(this._firstPT=a._next,d=!0),c?c._next=a:d||null!==this._firstPT||(this._firstPT=a),a._next=b,a._prev=c),a},j._kill=function(b){var c,d,e,f=b;if(b.autoAlpha||b.alpha){f={};for(d in b)f[d]=b[d];f.opacity=1,f.autoAlpha&&(f.visibility=1)}return b.className&&(c=this._classNamePT)&&(e=c.xfirst,e&&e._prev?this._linkCSSP(e._prev,c._next,e._prev._prev):e===this._firstPT&&(this._firstPT=c._next),c._next&&this._linkCSSP(c._next,c._next._next,e._prev),this._classNamePT=null),a.prototype._kill.call(this,f)};var Ta=function(a,b,c){var d,e,f,g;if(a.slice)for(e=a.length;--e>-1;)Ta(a[e],b,c);else for(d=a.childNodes,e=d.length;--e>-1;)f=d[e],g=f.type,f.style&&(b.push($(f)),c&&c.push(f)),1!==g&&9!==g&&11!==g||!f.childNodes.length||Ta(f,b,c)};return g.cascadeTo=function(a,c,d){var e,f,g,h,i=b.to(a,c,d),j=[i],k=[],l=[],m=[],n=b._internals.reservedProps;for(a=i._targets||i.target,Ta(a,k,m),i.render(c,!0,!0),Ta(a,l),i.render(0,!0,!0),i._enabled(!0),e=m.length;--e>-1;)if(f=_(m[e],k[e],l[e]),f.firstMPT){f=f.difs;for(g in d)n[g]&&(f[g]=d[g]);h={};for(g in f)h[g]=k[e][g];j.push(b.fromTo(m[e],c,h,f))}return j},a.activate([g]),g},!0),function(){var a=_gsScope._gsDefine.plugin({propName:"roundProps",version:"1.5",priority:-1,API:2,init:function(a,b,c){return this._tween=c,!0}}),b=function(a){for(;a;)a.f||a.blob||(a.r=1),a=a._next},c=a.prototype;c._onInitAllProps=function(){for(var a,c,d,e=this._tween,f=e.vars.roundProps.join?e.vars.roundProps:e.vars.roundProps.split(","),g=f.length,h={},i=e._propLookup.roundProps;--g>-1;)h[f[g]]=1;for(g=f.length;--g>-1;)for(a=f[g],c=e._firstPT;c;)d=c._next,c.pg?c.t._roundProps(h,!0):c.n===a&&(2===c.f&&c.t?b(c.t._firstPT):(this._add(c.t,a,c.s,c.c),d&&(d._prev=c._prev),c._prev?c._prev._next=d:e._firstPT===c&&(e._firstPT=d),c._next=c._prev=null,e._propLookup[a]=i)),c=d;return!1},c._add=function(a,b,c,d){this._addTween(a,b,c,c+d,b,!0),this._overwriteProps.push(b)}}(),function(){_gsScope._gsDefine.plugin({propName:"attr",API:2,version:"0.5.0",init:function(a,b,c){var d;if("function"!=typeof a.setAttribute)return!1;for(d in b)this._addTween(a,"setAttribute",a.getAttribute(d)+"",b[d]+"",d,!1,d),this._overwriteProps.push(d);return!0}})}(),_gsScope._gsDefine.plugin({propName:"directionalRotation",version:"0.2.1",API:2,init:function(a,b,c){"object"!=typeof b&&(b={rotation:b}),this.finals={};var d,e,f,g,h,i,j=b.useRadians===!0?2*Math.PI:360,k=1e-6;for(d in b)"useRadians"!==d&&(i=(b[d]+"").split("_"),e=i[0],f=parseFloat("function"!=typeof a[d]?a[d]:a[d.indexOf("set")||"function"!=typeof a["get"+d.substr(3)]?d:"get"+d.substr(3)]()),g=this.finals[d]="string"==typeof e&&"="===e.charAt(1)?f+parseInt(e.charAt(0)+"1",10)*Number(e.substr(2)):Number(e)||0,h=g-f,i.length&&(e=i.join("_"),-1!==e.indexOf("short")&&(h%=j,h!==h%(j/2)&&(h=0>h?h+j:h-j)),-1!==e.indexOf("_cw")&&0>h?h=(h+9999999999*j)%j-(h/j|0)*j:-1!==e.indexOf("ccw")&&h>0&&(h=(h-9999999999*j)%j-(h/j|0)*j)),(h>k||-k>h)&&(this._addTween(a,d,f,f+h,d),this._overwriteProps.push(d)));return!0},set:function(a){var b;if(1!==a)this._super.setRatio.call(this,a);else for(b=this._firstPT;b;)b.f?b.t[b.p](this.finals[b.p]):b.t[b.p]=this.finals[b.p],b=b._next}})._autoCSS=!0,_gsScope._gsDefine("easing.Back",["easing.Ease"],function(a){var b,c,d,e=_gsScope.GreenSockGlobals||_gsScope,f=e.com.greensock,g=2*Math.PI,h=Math.PI/2,i=f._class,j=function(b,c){var d=i("easing."+b,function(){},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,d},k=a.register||function(){},l=function(a,b,c,d,e){var f=i("easing."+a,{easeOut:new b,easeIn:new c,easeInOut:new d},!0);return k(f,a),f},m=function(a,b,c){this.t=a,this.v=b,c&&(this.next=c,c.prev=this,this.c=c.v-b,this.gap=c.t-a)},n=function(b,c){var d=i("easing."+b,function(a){this._p1=a||0===a?a:1.70158,this._p2=1.525*this._p1},!0),e=d.prototype=new a;return e.constructor=d,e.getRatio=c,e.config=function(a){return new d(a)},d},o=l("Back",n("BackOut",function(a){return(a-=1)*a*((this._p1+1)*a+this._p1)+1}),n("BackIn",function(a){return a*a*((this._p1+1)*a-this._p1)}),n("BackInOut",function(a){return(a*=2)<1?.5*a*a*((this._p2+1)*a-this._p2):.5*((a-=2)*a*((this._p2+1)*a+this._p2)+2)})),p=i("easing.SlowMo",function(a,b,c){b=b||0===b?b:.7,null==a?a=.7:a>1&&(a=1),this._p=1!==a?b:0,this._p1=(1-a)/2,this._p2=a,this._p3=this._p1+this._p2,this._calcEnd=c===!0},!0),q=p.prototype=new a;return q.constructor=p,q.getRatio=function(a){var b=a+(.5-a)*this._p;return a<this._p1?this._calcEnd?1-(a=1-a/this._p1)*a:b-(a=1-a/this._p1)*a*a*a*b:a>this._p3?this._calcEnd?1-(a=(a-this._p3)/this._p1)*a:b+(a-b)*(a=(a-this._p3)/this._p1)*a*a*a:this._calcEnd?1:b},p.ease=new p(.7,.7),q.config=p.config=function(a,b,c){return new p(a,b,c)},b=i("easing.SteppedEase",function(a){a=a||1,this._p1=1/a,this._p2=a+1},!0),q=b.prototype=new a,q.constructor=b,q.getRatio=function(a){return 0>a?a=0:a>=1&&(a=.999999999),(this._p2*a>>0)*this._p1},q.config=b.config=function(a){return new b(a)},c=i("easing.RoughEase",function(b){b=b||{};for(var c,d,e,f,g,h,i=b.taper||"none",j=[],k=0,l=0|(b.points||20),n=l,o=b.randomize!==!1,p=b.clamp===!0,q=b.template instanceof a?b.template:null,r="number"==typeof b.strength?.4*b.strength:.4;--n>-1;)c=o?Math.random():1/l*n,d=q?q.getRatio(c):c,"none"===i?e=r:"out"===i?(f=1-c,e=f*f*r):"in"===i?e=c*c*r:.5>c?(f=2*c,e=f*f*.5*r):(f=2*(1-c),e=f*f*.5*r),o?d+=Math.random()*e-.5*e:n%2?d+=.5*e:d-=.5*e,p&&(d>1?d=1:0>d&&(d=0)),j[k++]={x:c,y:d};for(j.sort(function(a,b){return a.x-b.x}),h=new m(1,1,null),n=l;--n>-1;)g=j[n],h=new m(g.x,g.y,h);this._prev=new m(0,0,0!==h.t?h:h.next)},!0),q=c.prototype=new a,q.constructor=c,q.getRatio=function(a){var b=this._prev;if(a>b.t){for(;b.next&&a>=b.t;)b=b.next;b=b.prev}else for(;b.prev&&a<=b.t;)b=b.prev;return this._prev=b,b.v+(a-b.t)/b.gap*b.c},q.config=function(a){return new c(a)},c.ease=new c,l("Bounce",j("BounceOut",function(a){return 1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}),j("BounceIn",function(a){return(a=1-a)<1/2.75?1-7.5625*a*a:2/2.75>a?1-(7.5625*(a-=1.5/2.75)*a+.75):2.5/2.75>a?1-(7.5625*(a-=2.25/2.75)*a+.9375):1-(7.5625*(a-=2.625/2.75)*a+.984375)}),j("BounceInOut",function(a){var b=.5>a;return a=b?1-2*a:2*a-1,a=1/2.75>a?7.5625*a*a:2/2.75>a?7.5625*(a-=1.5/2.75)*a+.75:2.5/2.75>a?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375,b?.5*(1-a):.5*a+.5})),l("Circ",j("CircOut",function(a){return Math.sqrt(1-(a-=1)*a)}),j("CircIn",function(a){return-(Math.sqrt(1-a*a)-1)}),j("CircInOut",function(a){return(a*=2)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)})),d=function(b,c,d){var e=i("easing."+b,function(a,b){this._p1=a>=1?a:1,this._p2=(b||d)/(1>a?a:1),this._p3=this._p2/g*(Math.asin(1/this._p1)||0),this._p2=g/this._p2},!0),f=e.prototype=new a;return f.constructor=e,f.getRatio=c,f.config=function(a,b){return new e(a,b)},e},l("Elastic",d("ElasticOut",function(a){return this._p1*Math.pow(2,-10*a)*Math.sin((a-this._p3)*this._p2)+1},.3),d("ElasticIn",function(a){return-(this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*this._p2))},.3),d("ElasticInOut",function(a){return(a*=2)<1?-.5*(this._p1*Math.pow(2,10*(a-=1))*Math.sin((a-this._p3)*this._p2)):this._p1*Math.pow(2,-10*(a-=1))*Math.sin((a-this._p3)*this._p2)*.5+1},.45)),l("Expo",j("ExpoOut",function(a){return 1-Math.pow(2,-10*a)}),j("ExpoIn",function(a){return Math.pow(2,10*(a-1))-.001}),j("ExpoInOut",function(a){return(a*=2)<1?.5*Math.pow(2,10*(a-1)):.5*(2-Math.pow(2,-10*(a-1)))})),l("Sine",j("SineOut",function(a){return Math.sin(a*h)}),j("SineIn",function(a){return-Math.cos(a*h)+1}),j("SineInOut",function(a){return-.5*(Math.cos(Math.PI*a)-1)})),i("easing.EaseLookup",{find:function(b){return a.map[b]}},!0),k(e.SlowMo,"SlowMo","ease,"),k(c,"RoughEase","ease,"),k(b,"SteppedEase","ease,"),o},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(a,b){"use strict";var c=a.GreenSockGlobals=a.GreenSockGlobals||a;if(!c.TweenLite){var d,e,f,g,h,i=function(a){var b,d=a.split("."),e=c;for(b=0;b<d.length;b++)e[d[b]]=e=e[d[b]]||{};return e},j=i("com.greensock"),k=1e-10,l=function(a){var b,c=[],d=a.length;for(b=0;b!==d;c.push(a[b++]));return c},m=function(){},n=function(){var a=Object.prototype.toString,b=a.call([]);return function(c){return null!=c&&(c instanceof Array||"object"==typeof c&&!!c.push&&a.call(c)===b)}}(),o={},p=function(d,e,f,g){this.sc=o[d]?o[d].sc:[],o[d]=this,this.gsClass=null,this.func=f;var h=[];this.check=function(j){for(var k,l,m,n,q,r=e.length,s=r;--r>-1;)(k=o[e[r]]||new p(e[r],[])).gsClass?(h[r]=k.gsClass,s--):j&&k.sc.push(this);if(0===s&&f)for(l=("com.greensock."+d).split("."),m=l.pop(),n=i(l.join("."))[m]=this.gsClass=f.apply(f,h),g&&(c[m]=n,q="undefined"!=typeof module&&module.exports,!q&&"function"==typeof define&&define.amd?define((a.GreenSockAMDPath?a.GreenSockAMDPath+"/":"")+d.split(".").pop(),[],function(){return n}):d===b&&q&&(module.exports=n)),r=0;r<this.sc.length;r++)this.sc[r].check()},this.check(!0)},q=a._gsDefine=function(a,b,c,d){return new p(a,b,c,d)},r=j._class=function(a,b,c){return b=b||function(){},q(a,[],function(){return b},c),b};q.globals=c;var s=[0,0,1,1],t=[],u=r("easing.Ease",function(a,b,c,d){this._func=a,this._type=c||0,this._power=d||0,this._params=b?s.concat(b):s},!0),v=u.map={},w=u.register=function(a,b,c,d){for(var e,f,g,h,i=b.split(","),k=i.length,l=(c||"easeIn,easeOut,easeInOut").split(",");--k>-1;)for(f=i[k],e=d?r("easing."+f,null,!0):j.easing[f]||{},g=l.length;--g>-1;)h=l[g],v[f+"."+h]=v[h+f]=e[h]=a.getRatio?a:a[h]||new a};for(f=u.prototype,f._calcEnd=!1,f.getRatio=function(a){if(this._func)return this._params[0]=a,this._func.apply(null,this._params);var b=this._type,c=this._power,d=1===b?1-a:2===b?a:.5>a?2*a:2*(1-a);return 1===c?d*=d:2===c?d*=d*d:3===c?d*=d*d*d:4===c&&(d*=d*d*d*d),1===b?1-d:2===b?d:.5>a?d/2:1-d/2},d=["Linear","Quad","Cubic","Quart","Quint,Strong"],e=d.length;--e>-1;)f=d[e]+",Power"+e,w(new u(null,null,1,e),f,"easeOut",!0),w(new u(null,null,2,e),f,"easeIn"+(0===e?",easeNone":"")),w(new u(null,null,3,e),f,"easeInOut");v.linear=j.easing.Linear.easeIn,v.swing=j.easing.Quad.easeInOut;var x=r("events.EventDispatcher",function(a){this._listeners={},this._eventTarget=a||this});f=x.prototype,f.addEventListener=function(a,b,c,d,e){e=e||0;var f,i,j=this._listeners[a],k=0;for(null==j&&(this._listeners[a]=j=[]),i=j.length;--i>-1;)f=j[i],f.c===b&&f.s===c?j.splice(i,1):0===k&&f.pr<e&&(k=i+1);j.splice(k,0,{c:b,s:c,up:d,pr:e}),this!==g||h||g.wake()},f.removeEventListener=function(a,b){var c,d=this._listeners[a];if(d)for(c=d.length;--c>-1;)if(d[c].c===b)return void d.splice(c,1)},f.dispatchEvent=function(a){var b,c,d,e=this._listeners[a];if(e)for(b=e.length,c=this._eventTarget;--b>-1;)d=e[b],d&&(d.up?d.c.call(d.s||c,{type:a,target:c}):d.c.call(d.s||c))};var y=a.requestAnimationFrame,z=a.cancelAnimationFrame,A=Date.now||function(){return(new Date).getTime()},B=A();for(d=["ms","moz","webkit","o"],e=d.length;--e>-1&&!y;)y=a[d[e]+"RequestAnimationFrame"],z=a[d[e]+"CancelAnimationFrame"]||a[d[e]+"CancelRequestAnimationFrame"];r("Ticker",function(a,b){var c,d,e,f,i,j=this,l=A(),n=b!==!1&&y?"auto":!1,o=500,p=33,q="tick",r=function(a){var b,g,h=A()-B;h>o&&(l+=h-p),B+=h,j.time=(B-l)/1e3,b=j.time-i,(!c||b>0||a===!0)&&(j.frame++,i+=b+(b>=f?.004:f-b),g=!0),a!==!0&&(e=d(r)),g&&j.dispatchEvent(q)};x.call(j),j.time=j.frame=0,j.tick=function(){r(!0)},j.lagSmoothing=function(a,b){o=a||1/k,p=Math.min(b,o,0)},j.sleep=function(){null!=e&&(n&&z?z(e):clearTimeout(e),d=m,e=null,j===g&&(h=!1))},j.wake=function(a){null!==e?j.sleep():a?l+=-B+(B=A()):j.frame>10&&(B=A()-o+5),d=0===c?m:n&&y?y:function(a){return setTimeout(a,1e3*(i-j.time)+1|0)},j===g&&(h=!0),r(2)},j.fps=function(a){return arguments.length?(c=a,f=1/(c||60),i=this.time+f,void j.wake()):c},j.useRAF=function(a){return arguments.length?(j.sleep(),n=a,void j.fps(c)):n},j.fps(a),setTimeout(function(){"auto"===n&&j.frame<5&&"hidden"!==document.visibilityState&&j.useRAF(!1)},1500)}),f=j.Ticker.prototype=new j.events.EventDispatcher,f.constructor=j.Ticker;var C=r("core.Animation",function(a,b){if(this.vars=b=b||{},this._duration=this._totalDuration=a||0,this._delay=Number(b.delay)||0,this._timeScale=1,this._active=b.immediateRender===!0,this.data=b.data,this._reversed=b.reversed===!0,V){h||g.wake();var c=this.vars.useFrames?U:V;c.add(this,c._time),this.vars.paused&&this.paused(!0)}});g=C.ticker=new j.Ticker,f=C.prototype,f._dirty=f._gc=f._initted=f._paused=!1,f._totalTime=f._time=0,f._rawPrevTime=-1,f._next=f._last=f._onUpdate=f._timeline=f.timeline=null,f._paused=!1;var D=function(){h&&A()-B>2e3&&g.wake(),setTimeout(D,2e3)};D(),f.play=function(a,b){return null!=a&&this.seek(a,b),this.reversed(!1).paused(!1)},f.pause=function(a,b){return null!=a&&this.seek(a,b),this.paused(!0)},f.resume=function(a,b){return null!=a&&this.seek(a,b),this.paused(!1)},f.seek=function(a,b){return this.totalTime(Number(a),b!==!1)},f.restart=function(a,b){return this.reversed(!1).paused(!1).totalTime(a?-this._delay:0,b!==!1,!0)},f.reverse=function(a,b){return null!=a&&this.seek(a||this.totalDuration(),b),this.reversed(!0).paused(!1)},f.render=function(a,b,c){},f.invalidate=function(){return this._time=this._totalTime=0,this._initted=this._gc=!1,this._rawPrevTime=-1,(this._gc||!this.timeline)&&this._enabled(!0),this},f.isActive=function(){var a,b=this._timeline,c=this._startTime;return!b||!this._gc&&!this._paused&&b.isActive()&&(a=b.rawTime())>=c&&a<c+this.totalDuration()/this._timeScale},f._enabled=function(a,b){return h||g.wake(),this._gc=!a,this._active=this.isActive(),b!==!0&&(a&&!this.timeline?this._timeline.add(this,this._startTime-this._delay):!a&&this.timeline&&this._timeline._remove(this,!0)),!1},f._kill=function(a,b){return this._enabled(!1,!1)},f.kill=function(a,b){return this._kill(a,b),this},f._uncache=function(a){for(var b=a?this:this.timeline;b;)b._dirty=!0,b=b.timeline;return this},f._swapSelfInParams=function(a){for(var b=a.length,c=a.concat();--b>-1;)"{self}"===a[b]&&(c[b]=this);return c},f._callback=function(a){var b=this.vars;b[a].apply(b[a+"Scope"]||b.callbackScope||this,b[a+"Params"]||t)},f.eventCallback=function(a,b,c,d){if("on"===(a||"").substr(0,2)){var e=this.vars;if(1===arguments.length)return e[a];null==b?delete e[a]:(e[a]=b,e[a+"Params"]=n(c)&&-1!==c.join("").indexOf("{self}")?this._swapSelfInParams(c):c,e[a+"Scope"]=d),"onUpdate"===a&&(this._onUpdate=b)}return this},f.delay=function(a){return arguments.length?(this._timeline.smoothChildTiming&&this.startTime(this._startTime+a-this._delay),this._delay=a,this):this._delay},f.duration=function(a){return arguments.length?(this._duration=this._totalDuration=a,this._uncache(!0),this._timeline.smoothChildTiming&&this._time>0&&this._time<this._duration&&0!==a&&this.totalTime(this._totalTime*(a/this._duration),!0),this):(this._dirty=!1,this._duration)},f.totalDuration=function(a){return this._dirty=!1,arguments.length?this.duration(a):this._totalDuration},f.time=function(a,b){return arguments.length?(this._dirty&&this.totalDuration(),this.totalTime(a>this._duration?this._duration:a,b)):this._time},f.totalTime=function(a,b,c){if(h||g.wake(),!arguments.length)return this._totalTime;if(this._timeline){if(0>a&&!c&&(a+=this.totalDuration()),this._timeline.smoothChildTiming){this._dirty&&this.totalDuration();var d=this._totalDuration,e=this._timeline;if(a>d&&!c&&(a=d),this._startTime=(this._paused?this._pauseTime:e._time)-(this._reversed?d-a:a)/this._timeScale,e._dirty||this._uncache(!1),e._timeline)for(;e._timeline;)e._timeline._time!==(e._startTime+e._totalTime)/e._timeScale&&e.totalTime(e._totalTime,!0),e=e._timeline}this._gc&&this._enabled(!0,!1),(this._totalTime!==a||0===this._duration)&&(I.length&&X(),this.render(a,b,!1),I.length&&X())}return this},f.progress=f.totalProgress=function(a,b){var c=this.duration();return arguments.length?this.totalTime(c*a,b):c?this._time/c:this.ratio},f.startTime=function(a){return arguments.length?(a!==this._startTime&&(this._startTime=a,this.timeline&&this.timeline._sortChildren&&this.timeline.add(this,a-this._delay)),this):this._startTime},f.endTime=function(a){return this._startTime+(0!=a?this.totalDuration():this.duration())/this._timeScale},f.timeScale=function(a){if(!arguments.length)return this._timeScale;if(a=a||k,this._timeline&&this._timeline.smoothChildTiming){var b=this._pauseTime,c=b||0===b?b:this._timeline.totalTime();this._startTime=c-(c-this._startTime)*this._timeScale/a}return this._timeScale=a,this._uncache(!1)},f.reversed=function(a){return arguments.length?(a!=this._reversed&&(this._reversed=a,this.totalTime(this._timeline&&!this._timeline.smoothChildTiming?this.totalDuration()-this._totalTime:this._totalTime,!0)),this):this._reversed},f.paused=function(a){if(!arguments.length)return this._paused;var b,c,d=this._timeline;return a!=this._paused&&d&&(h||a||g.wake(),b=d.rawTime(),c=b-this._pauseTime,!a&&d.smoothChildTiming&&(this._startTime+=c,this._uncache(!1)),this._pauseTime=a?b:null,this._paused=a,this._active=this.isActive(),!a&&0!==c&&this._initted&&this.duration()&&(b=d.smoothChildTiming?this._totalTime:(b-this._startTime)/this._timeScale,this.render(b,b===this._totalTime,!0))),this._gc&&!a&&this._enabled(!0,!1),this};var E=r("core.SimpleTimeline",function(a){C.call(this,0,a),this.autoRemoveChildren=this.smoothChildTiming=!0});f=E.prototype=new C,f.constructor=E,f.kill()._gc=!1,f._first=f._last=f._recent=null,f._sortChildren=!1,f.add=f.insert=function(a,b,c,d){var e,f;if(a._startTime=Number(b||0)+a._delay,a._paused&&this!==a._timeline&&(a._pauseTime=a._startTime+(this.rawTime()-a._startTime)/a._timeScale),a.timeline&&a.timeline._remove(a,!0),a.timeline=a._timeline=this,a._gc&&a._enabled(!0,!0),e=this._last,this._sortChildren)for(f=a._startTime;e&&e._startTime>f;)e=e._prev;return e?(a._next=e._next,e._next=a):(a._next=this._first,this._first=a),a._next?a._next._prev=a:this._last=a,a._prev=e,this._recent=a,this._timeline&&this._uncache(!0),this},f._remove=function(a,b){return a.timeline===this&&(b||a._enabled(!1,!0),a._prev?a._prev._next=a._next:this._first===a&&(this._first=a._next),a._next?a._next._prev=a._prev:this._last===a&&(this._last=a._prev),a._next=a._prev=a.timeline=null,a===this._recent&&(this._recent=this._last),this._timeline&&this._uncache(!0)),this},f.render=function(a,b,c){var d,e=this._first;for(this._totalTime=this._time=this._rawPrevTime=a;e;)d=e._next,(e._active||a>=e._startTime&&!e._paused)&&(e._reversed?e.render((e._dirty?e.totalDuration():e._totalDuration)-(a-e._startTime)*e._timeScale,b,c):e.render((a-e._startTime)*e._timeScale,b,c)),e=d},f.rawTime=function(){return h||g.wake(),this._totalTime};var F=r("TweenLite",function(b,c,d){if(C.call(this,c,d),this.render=F.prototype.render,null==b)throw"Cannot tween a null target.";this.target=b="string"!=typeof b?b:F.selector(b)||b;var e,f,g,h=b.jquery||b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType),i=this.vars.overwrite;if(this._overwrite=i=null==i?T[F.defaultOverwrite]:"number"==typeof i?i>>0:T[i],(h||b instanceof Array||b.push&&n(b))&&"number"!=typeof b[0])for(this._targets=g=l(b),this._propLookup=[],this._siblings=[],e=0;e<g.length;e++)f=g[e],f?"string"!=typeof f?f.length&&f!==a&&f[0]&&(f[0]===a||f[0].nodeType&&f[0].style&&!f.nodeType)?(g.splice(e--,1),this._targets=g=g.concat(l(f))):(this._siblings[e]=Y(f,this,!1),1===i&&this._siblings[e].length>1&&$(f,this,null,1,this._siblings[e])):(f=g[e--]=F.selector(f),"string"==typeof f&&g.splice(e+1,1)):g.splice(e--,1);else this._propLookup={},this._siblings=Y(b,this,!1),1===i&&this._siblings.length>1&&$(b,this,null,1,this._siblings);(this.vars.immediateRender||0===c&&0===this._delay&&this.vars.immediateRender!==!1)&&(this._time=-k,this.render(-this._delay))},!0),G=function(b){return b&&b.length&&b!==a&&b[0]&&(b[0]===a||b[0].nodeType&&b[0].style&&!b.nodeType)},H=function(a,b){var c,d={};for(c in a)S[c]||c in b&&"transform"!==c&&"x"!==c&&"y"!==c&&"width"!==c&&"height"!==c&&"className"!==c&&"border"!==c||!(!P[c]||P[c]&&P[c]._autoCSS)||(d[c]=a[c],delete a[c]);a.css=d};f=F.prototype=new C,f.constructor=F,f.kill()._gc=!1,f.ratio=0,f._firstPT=f._targets=f._overwrittenProps=f._startAt=null,f._notifyPluginsOfEnabled=f._lazy=!1,F.version="1.18.2",F.defaultEase=f._ease=new u(null,null,1,1),F.defaultOverwrite="auto",F.ticker=g,F.autoSleep=120,F.lagSmoothing=function(a,b){g.lagSmoothing(a,b)},F.selector=a.$||a.jQuery||function(b){var c=a.$||a.jQuery;return c?(F.selector=c,c(b)):"undefined"==typeof document?b:document.querySelectorAll?document.querySelectorAll(b):document.getElementById("#"===b.charAt(0)?b.substr(1):b)};var I=[],J={},K=/(?:(-|-=|\+=)?\d*\.?\d*(?:e[\-+]?\d+)?)[0-9]/gi,L=function(a){for(var b,c=this._firstPT,d=1e-6;c;)b=c.blob?a?this.join(""):this.start:c.c*a+c.s,c.r?b=Math.round(b):d>b&&b>-d&&(b=0),c.f?c.fp?c.t[c.p](c.fp,b):c.t[c.p](b):c.t[c.p]=b,c=c._next},M=function(a,b,c,d){var e,f,g,h,i,j,k,l=[a,b],m=0,n="",o=0;for(l.start=a,c&&(c(l),a=l[0],b=l[1]),l.length=0,e=a.match(K)||[],f=b.match(K)||[],d&&(d._next=null,d.blob=1,l._firstPT=d),i=f.length,h=0;i>h;h++)k=f[h],j=b.substr(m,b.indexOf(k,m)-m),n+=j||!h?j:",",m+=j.length,o?o=(o+1)%5:"rgba("===j.substr(-5)&&(o=1),k===e[h]||e.length<=h?n+=k:(n&&(l.push(n),n=""),g=parseFloat(e[h]),l.push(g),l._firstPT={_next:l._firstPT,t:l,p:l.length-1,s:g,c:("="===k.charAt(1)?parseInt(k.charAt(0)+"1",10)*parseFloat(k.substr(2)):parseFloat(k)-g)||0,f:0,r:o&&4>o}),m+=k.length;return n+=b.substr(m),n&&l.push(n),l.setRatio=L,l},N=function(a,b,c,d,e,f,g,h){var i,j,k="get"===c?a[b]:c,l=typeof a[b],m="string"==typeof d&&"="===d.charAt(1),n={t:a,p:b,s:k,f:"function"===l,pg:0,n:e||b,r:f,pr:0,c:m?parseInt(d.charAt(0)+"1",10)*parseFloat(d.substr(2)):parseFloat(d)-k||0};return"number"!==l&&("function"===l&&"get"===c&&(j=b.indexOf("set")||"function"!=typeof a["get"+b.substr(3)]?b:"get"+b.substr(3),n.s=k=g?a[j](g):a[j]()),"string"==typeof k&&(g||isNaN(k))?(n.fp=g,i=M(k,d,h||F.defaultStringFilter,n),n={t:i,p:"setRatio",s:0,c:1,f:2,pg:0,n:e||b,pr:0}):m||(n.s=parseFloat(k),n.c=parseFloat(d)-n.s||0)),n.c?((n._next=this._firstPT)&&(n._next._prev=n),this._firstPT=n,n):void 0},O=F._internals={isArray:n,isSelector:G,lazyTweens:I,blobDif:M},P=F._plugins={},Q=O.tweenLookup={},R=0,S=O.reservedProps={ease:1,delay:1,overwrite:1,onComplete:1,onCompleteParams:1,onCompleteScope:1,useFrames:1,runBackwards:1,startAt:1,onUpdate:1,onUpdateParams:1,onUpdateScope:1,onStart:1,onStartParams:1,onStartScope:1,onReverseComplete:1,onReverseCompleteParams:1,onReverseCompleteScope:1,onRepeat:1,onRepeatParams:1,onRepeatScope:1,easeParams:1,yoyo:1,immediateRender:1,repeat:1,repeatDelay:1,data:1,paused:1,reversed:1,autoCSS:1,lazy:1,onOverwrite:1,callbackScope:1,stringFilter:1},T={none:0,all:1,auto:2,concurrent:3,allOnStart:4,preexisting:5,"true":1,"false":0},U=C._rootFramesTimeline=new E,V=C._rootTimeline=new E,W=30,X=O.lazyRender=function(){
var a,b=I.length;for(J={};--b>-1;)a=I[b],a&&a._lazy!==!1&&(a.render(a._lazy[0],a._lazy[1],!0),a._lazy=!1);I.length=0};V._startTime=g.time,U._startTime=g.frame,V._active=U._active=!0,setTimeout(X,1),C._updateRoot=F.render=function(){var a,b,c;if(I.length&&X(),V.render((g.time-V._startTime)*V._timeScale,!1,!1),U.render((g.frame-U._startTime)*U._timeScale,!1,!1),I.length&&X(),g.frame>=W){W=g.frame+(parseInt(F.autoSleep,10)||120);for(c in Q){for(b=Q[c].tweens,a=b.length;--a>-1;)b[a]._gc&&b.splice(a,1);0===b.length&&delete Q[c]}if(c=V._first,(!c||c._paused)&&F.autoSleep&&!U._first&&1===g._listeners.tick.length){for(;c&&c._paused;)c=c._next;c||g.sleep()}}},g.addEventListener("tick",C._updateRoot);var Y=function(a,b,c){var d,e,f=a._gsTweenID;if(Q[f||(a._gsTweenID=f="t"+R++)]||(Q[f]={target:a,tweens:[]}),b&&(d=Q[f].tweens,d[e=d.length]=b,c))for(;--e>-1;)d[e]===b&&d.splice(e,1);return Q[f].tweens},Z=function(a,b,c,d){var e,f,g=a.vars.onOverwrite;return g&&(e=g(a,b,c,d)),g=F.onOverwrite,g&&(f=g(a,b,c,d)),e!==!1&&f!==!1},$=function(a,b,c,d,e){var f,g,h,i;if(1===d||d>=4){for(i=e.length,f=0;i>f;f++)if((h=e[f])!==b)h._gc||h._kill(null,a,b)&&(g=!0);else if(5===d)break;return g}var j,l=b._startTime+k,m=[],n=0,o=0===b._duration;for(f=e.length;--f>-1;)(h=e[f])===b||h._gc||h._paused||(h._timeline!==b._timeline?(j=j||_(b,0,o),0===_(h,j,o)&&(m[n++]=h)):h._startTime<=l&&h._startTime+h.totalDuration()/h._timeScale>l&&((o||!h._initted)&&l-h._startTime<=2e-10||(m[n++]=h)));for(f=n;--f>-1;)if(h=m[f],2===d&&h._kill(c,a,b)&&(g=!0),2!==d||!h._firstPT&&h._initted){if(2!==d&&!Z(h,b))continue;h._enabled(!1,!1)&&(g=!0)}return g},_=function(a,b,c){for(var d=a._timeline,e=d._timeScale,f=a._startTime;d._timeline;){if(f+=d._startTime,e*=d._timeScale,d._paused)return-100;d=d._timeline}return f/=e,f>b?f-b:c&&f===b||!a._initted&&2*k>f-b?k:(f+=a.totalDuration()/a._timeScale/e)>b+k?0:f-b-k};f._init=function(){var a,b,c,d,e,f=this.vars,g=this._overwrittenProps,h=this._duration,i=!!f.immediateRender,j=f.ease;if(f.startAt){this._startAt&&(this._startAt.render(-1,!0),this._startAt.kill()),e={};for(d in f.startAt)e[d]=f.startAt[d];if(e.overwrite=!1,e.immediateRender=!0,e.lazy=i&&f.lazy!==!1,e.startAt=e.delay=null,this._startAt=F.to(this.target,0,e),i)if(this._time>0)this._startAt=null;else if(0!==h)return}else if(f.runBackwards&&0!==h)if(this._startAt)this._startAt.render(-1,!0),this._startAt.kill(),this._startAt=null;else{0!==this._time&&(i=!1),c={};for(d in f)S[d]&&"autoCSS"!==d||(c[d]=f[d]);if(c.overwrite=0,c.data="isFromStart",c.lazy=i&&f.lazy!==!1,c.immediateRender=i,this._startAt=F.to(this.target,0,c),i){if(0===this._time)return}else this._startAt._init(),this._startAt._enabled(!1),this.vars.immediateRender&&(this._startAt=null)}if(this._ease=j=j?j instanceof u?j:"function"==typeof j?new u(j,f.easeParams):v[j]||F.defaultEase:F.defaultEase,f.easeParams instanceof Array&&j.config&&(this._ease=j.config.apply(j,f.easeParams)),this._easeType=this._ease._type,this._easePower=this._ease._power,this._firstPT=null,this._targets)for(a=this._targets.length;--a>-1;)this._initProps(this._targets[a],this._propLookup[a]={},this._siblings[a],g?g[a]:null)&&(b=!0);else b=this._initProps(this.target,this._propLookup,this._siblings,g);if(b&&F._onPluginEvent("_onInitAllProps",this),g&&(this._firstPT||"function"!=typeof this.target&&this._enabled(!1,!1)),f.runBackwards)for(c=this._firstPT;c;)c.s+=c.c,c.c=-c.c,c=c._next;this._onUpdate=f.onUpdate,this._initted=!0},f._initProps=function(b,c,d,e){var f,g,h,i,j,k;if(null==b)return!1;J[b._gsTweenID]&&X(),this.vars.css||b.style&&b!==a&&b.nodeType&&P.css&&this.vars.autoCSS!==!1&&H(this.vars,b);for(f in this.vars)if(k=this.vars[f],S[f])k&&(k instanceof Array||k.push&&n(k))&&-1!==k.join("").indexOf("{self}")&&(this.vars[f]=k=this._swapSelfInParams(k,this));else if(P[f]&&(i=new P[f])._onInitTween(b,this.vars[f],this)){for(this._firstPT=j={_next:this._firstPT,t:i,p:"setRatio",s:0,c:1,f:1,n:f,pg:1,pr:i._priority},g=i._overwriteProps.length;--g>-1;)c[i._overwriteProps[g]]=this._firstPT;(i._priority||i._onInitAllProps)&&(h=!0),(i._onDisable||i._onEnable)&&(this._notifyPluginsOfEnabled=!0),j._next&&(j._next._prev=j)}else c[f]=N.call(this,b,f,"get",k,f,0,null,this.vars.stringFilter);return e&&this._kill(e,b)?this._initProps(b,c,d,e):this._overwrite>1&&this._firstPT&&d.length>1&&$(b,this,c,this._overwrite,d)?(this._kill(c,b),this._initProps(b,c,d,e)):(this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration)&&(J[b._gsTweenID]=!0),h)},f.render=function(a,b,c){var d,e,f,g,h=this._time,i=this._duration,j=this._rawPrevTime;if(a>=i-1e-7)this._totalTime=this._time=i,this.ratio=this._ease._calcEnd?this._ease.getRatio(1):1,this._reversed||(d=!0,e="onComplete",c=c||this._timeline.autoRemoveChildren),0===i&&(this._initted||!this.vars.lazy||c)&&(this._startTime===this._timeline._duration&&(a=0),(0>j||0>=a&&a>=-1e-7||j===k&&"isPause"!==this.data)&&j!==a&&(c=!0,j>k&&(e="onReverseComplete")),this._rawPrevTime=g=!b||a||j===a?a:k);else if(1e-7>a)this._totalTime=this._time=0,this.ratio=this._ease._calcEnd?this._ease.getRatio(0):0,(0!==h||0===i&&j>0)&&(e="onReverseComplete",d=this._reversed),0>a&&(this._active=!1,0===i&&(this._initted||!this.vars.lazy||c)&&(j>=0&&(j!==k||"isPause"!==this.data)&&(c=!0),this._rawPrevTime=g=!b||a||j===a?a:k)),this._initted||(c=!0);else if(this._totalTime=this._time=a,this._easeType){var l=a/i,m=this._easeType,n=this._easePower;(1===m||3===m&&l>=.5)&&(l=1-l),3===m&&(l*=2),1===n?l*=l:2===n?l*=l*l:3===n?l*=l*l*l:4===n&&(l*=l*l*l*l),1===m?this.ratio=1-l:2===m?this.ratio=l:.5>a/i?this.ratio=l/2:this.ratio=1-l/2}else this.ratio=this._ease.getRatio(a/i);if(this._time!==h||c){if(!this._initted){if(this._init(),!this._initted||this._gc)return;if(!c&&this._firstPT&&(this.vars.lazy!==!1&&this._duration||this.vars.lazy&&!this._duration))return this._time=this._totalTime=h,this._rawPrevTime=j,I.push(this),void(this._lazy=[a,b]);this._time&&!d?this.ratio=this._ease.getRatio(this._time/i):d&&this._ease._calcEnd&&(this.ratio=this._ease.getRatio(0===this._time?0:1))}for(this._lazy!==!1&&(this._lazy=!1),this._active||!this._paused&&this._time!==h&&a>=0&&(this._active=!0),0===h&&(this._startAt&&(a>=0?this._startAt.render(a,b,c):e||(e="_dummyGS")),this.vars.onStart&&(0!==this._time||0===i)&&(b||this._callback("onStart"))),f=this._firstPT;f;)f.f?f.t[f.p](f.c*this.ratio+f.s):f.t[f.p]=f.c*this.ratio+f.s,f=f._next;this._onUpdate&&(0>a&&this._startAt&&a!==-1e-4&&this._startAt.render(a,b,c),b||(this._time!==h||d)&&this._callback("onUpdate")),e&&(!this._gc||c)&&(0>a&&this._startAt&&!this._onUpdate&&a!==-1e-4&&this._startAt.render(a,b,c),d&&(this._timeline.autoRemoveChildren&&this._enabled(!1,!1),this._active=!1),!b&&this.vars[e]&&this._callback(e),0===i&&this._rawPrevTime===k&&g!==k&&(this._rawPrevTime=0))}},f._kill=function(a,b,c){if("all"===a&&(a=null),null==a&&(null==b||b===this.target))return this._lazy=!1,this._enabled(!1,!1);b="string"!=typeof b?b||this._targets||this.target:F.selector(b)||b;var d,e,f,g,h,i,j,k,l,m=c&&this._time&&c._startTime===this._startTime&&this._timeline===c._timeline;if((n(b)||G(b))&&"number"!=typeof b[0])for(d=b.length;--d>-1;)this._kill(a,b[d],c)&&(i=!0);else{if(this._targets){for(d=this._targets.length;--d>-1;)if(b===this._targets[d]){h=this._propLookup[d]||{},this._overwrittenProps=this._overwrittenProps||[],e=this._overwrittenProps[d]=a?this._overwrittenProps[d]||{}:"all";break}}else{if(b!==this.target)return!1;h=this._propLookup,e=this._overwrittenProps=a?this._overwrittenProps||{}:"all"}if(h){if(j=a||h,k=a!==e&&"all"!==e&&a!==h&&("object"!=typeof a||!a._tempKill),c&&(F.onOverwrite||this.vars.onOverwrite)){for(f in j)h[f]&&(l||(l=[]),l.push(f));if((l||!a)&&!Z(this,c,b,l))return!1}for(f in j)(g=h[f])&&(m&&(g.f?g.t[g.p](g.s):g.t[g.p]=g.s,i=!0),g.pg&&g.t._kill(j)&&(i=!0),g.pg&&0!==g.t._overwriteProps.length||(g._prev?g._prev._next=g._next:g===this._firstPT&&(this._firstPT=g._next),g._next&&(g._next._prev=g._prev),g._next=g._prev=null),delete h[f]),k&&(e[f]=1);!this._firstPT&&this._initted&&this._enabled(!1,!1)}}return i},f.invalidate=function(){return this._notifyPluginsOfEnabled&&F._onPluginEvent("_onDisable",this),this._firstPT=this._overwrittenProps=this._startAt=this._onUpdate=null,this._notifyPluginsOfEnabled=this._active=this._lazy=!1,this._propLookup=this._targets?{}:[],C.prototype.invalidate.call(this),this.vars.immediateRender&&(this._time=-k,this.render(-this._delay)),this},f._enabled=function(a,b){if(h||g.wake(),a&&this._gc){var c,d=this._targets;if(d)for(c=d.length;--c>-1;)this._siblings[c]=Y(d[c],this,!0);else this._siblings=Y(this.target,this,!0)}return C.prototype._enabled.call(this,a,b),this._notifyPluginsOfEnabled&&this._firstPT?F._onPluginEvent(a?"_onEnable":"_onDisable",this):!1},F.to=function(a,b,c){return new F(a,b,c)},F.from=function(a,b,c){return c.runBackwards=!0,c.immediateRender=0!=c.immediateRender,new F(a,b,c)},F.fromTo=function(a,b,c,d){return d.startAt=c,d.immediateRender=0!=d.immediateRender&&0!=c.immediateRender,new F(a,b,d)},F.delayedCall=function(a,b,c,d,e){return new F(b,0,{delay:a,onComplete:b,onCompleteParams:c,callbackScope:d,onReverseComplete:b,onReverseCompleteParams:c,immediateRender:!1,lazy:!1,useFrames:e,overwrite:0})},F.set=function(a,b){return new F(a,0,b)},F.getTweensOf=function(a,b){if(null==a)return[];a="string"!=typeof a?a:F.selector(a)||a;var c,d,e,f;if((n(a)||G(a))&&"number"!=typeof a[0]){for(c=a.length,d=[];--c>-1;)d=d.concat(F.getTweensOf(a[c],b));for(c=d.length;--c>-1;)for(f=d[c],e=c;--e>-1;)f===d[e]&&d.splice(c,1)}else for(d=Y(a).concat(),c=d.length;--c>-1;)(d[c]._gc||b&&!d[c].isActive())&&d.splice(c,1);return d},F.killTweensOf=F.killDelayedCallsTo=function(a,b,c){"object"==typeof b&&(c=b,b=!1);for(var d=F.getTweensOf(a,b),e=d.length;--e>-1;)d[e]._kill(c,a)};var aa=r("plugins.TweenPlugin",function(a,b){this._overwriteProps=(a||"").split(","),this._propName=this._overwriteProps[0],this._priority=b||0,this._super=aa.prototype},!0);if(f=aa.prototype,aa.version="1.18.0",aa.API=2,f._firstPT=null,f._addTween=N,f.setRatio=L,f._kill=function(a){var b,c=this._overwriteProps,d=this._firstPT;if(null!=a[this._propName])this._overwriteProps=[];else for(b=c.length;--b>-1;)null!=a[c[b]]&&c.splice(b,1);for(;d;)null!=a[d.n]&&(d._next&&(d._next._prev=d._prev),d._prev?(d._prev._next=d._next,d._prev=null):this._firstPT===d&&(this._firstPT=d._next)),d=d._next;return!1},f._roundProps=function(a,b){for(var c=this._firstPT;c;)(a[this._propName]||null!=c.n&&a[c.n.split(this._propName+"_").join("")])&&(c.r=b),c=c._next},F._onPluginEvent=function(a,b){var c,d,e,f,g,h=b._firstPT;if("_onInitAllProps"===a){for(;h;){for(g=h._next,d=e;d&&d.pr>h.pr;)d=d._next;(h._prev=d?d._prev:f)?h._prev._next=h:e=h,(h._next=d)?d._prev=h:f=h,h=g}h=b._firstPT=e}for(;h;)h.pg&&"function"==typeof h.t[a]&&h.t[a]()&&(c=!0),h=h._next;return c},aa.activate=function(a){for(var b=a.length;--b>-1;)a[b].API===aa.API&&(P[(new a[b])._propName]=a[b]);return!0},q.plugin=function(a){if(!(a&&a.propName&&a.init&&a.API))throw"illegal plugin definition.";var b,c=a.propName,d=a.priority||0,e=a.overwriteProps,f={init:"_onInitTween",set:"setRatio",kill:"_kill",round:"_roundProps",initAll:"_onInitAllProps"},g=r("plugins."+c.charAt(0).toUpperCase()+c.substr(1)+"Plugin",function(){aa.call(this,c,d),this._overwriteProps=e||[]},a.global===!0),h=g.prototype=new aa(c);h.constructor=g,g.API=a.API;for(b in f)"function"==typeof a[b]&&(h[f[b]]=a[b]);return g.version=a.version,aa.activate([g]),g},d=a._gsQueue){for(e=0;e<d.length;e++)d[e]();for(f in o)o[f].func||a.console.log("GSAP encountered missing dependency: com.greensock."+f)}h=!1}}("undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window,"TweenMax");/*!
 * VERSION: 1.8.0
 * DATE: 2016-07-09
 * UPDATES AND DOCS AT: http://greensock.com
 *
 * @license Copyright (c) 2008-2016, GreenSock. All rights reserved.
 * This work is subject to the terms at http://greensock.com/standard-license or for
 * Club GreenSock members, the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 **/
var _gsScope = (typeof(module) !== "undefined" && module.exports && typeof(global) !== "undefined") ? global : this || window; //helps ensure compatibility with AMD/RequireJS and CommonJS/Node
(_gsScope._gsQueue || (_gsScope._gsQueue = [])).push( function() {

	"use strict";

	var _doc = document.documentElement,
		_window = window,
		_max = function(element, axis) {
			var dim = (axis === "x") ? "Width" : "Height",
				scroll = "scroll" + dim,
				client = "client" + dim,
				body = document.body;
			return (element === _window || element === _doc || element === body) ? Math.max(_doc[scroll], body[scroll]) - (_window["inner" + dim] || _doc[client] || body[client]) : element[scroll] - element["offset" + dim];
		},
		_unwrapElement = function(value) {
			if (typeof(value) === "string") {
				value = TweenLite.selector(value);
			}
			if (value.length && value !== _window && value[0] && value[0].style && !value.nodeType) {
				value = value[0];
			}
			return (value === _window || (value.nodeType && value.style)) ? value : null;
		},
		_buildGetter = function(e, axis) { //pass in an element and an axis ("x" or "y") and it'll return a getter function for the scroll position of that element (like scrollTop or scrollLeft, although if the element is the window, it'll use the pageXOffset/pageYOffset or the documentElement's scrollTop/scrollLeft or document.body's. Basically this streamlines things and makes a very fast getter across browsers.
			var p = "scroll" + ((axis === "x") ? "Left" : "Top");
			if (e === _window) {
				if (e.pageXOffset != null) {
					p = "page" + axis.toUpperCase() + "Offset";
				} else if (_doc[p] != null) {
					e = _doc;
				} else {
					e = document.body;
				}
			}
			return function() {
				return e[p];
			};
		},
		_getOffset = function(element, container) {
			var rect = _unwrapElement(element).getBoundingClientRect(),
				isRoot = (!container || container === _window || container === document.body),
				cRect = (isRoot ? _doc : container).getBoundingClientRect(),
				offsets = {x: rect.left - cRect.left, y: rect.top - cRect.top};
			if (!isRoot && container) { //only add the current scroll position if it's not the window/body.
				offsets.x += _buildGetter(container, "x")();
				offsets.y += _buildGetter(container, "y")();
			}
			return offsets;
		},
		_parseVal = function(value, target, axis) {
			var type = typeof(value);
			if (type === "number" || (type === "string" && value.charAt(1) === "=")) {
				return value;
			} else if (value === "max") {
				return _max(target, axis);
			}
			return Math.min(_max(target, axis), _getOffset(value, target)[axis]);
		},

		ScrollToPlugin = _gsScope._gsDefine.plugin({
			propName: "scrollTo",
			API: 2,
			version:"1.8.0",

			//called when the tween renders for the first time. This is where initial values should be recorded and any setup routines should run.
			init: function(target, value, tween) {
				this._wdw = (target === _window);
				this._target = target;
				this._tween = tween;
				if (typeof(value) !== "object") {
					value = {y:value}; //if we don't receive an object as the parameter, assume the user intends "y".
					if (typeof(value.y) === "string" && value.y !== "max" && value.y.charAt(1) !== "=") {
						value.x = value.y;
					}
				} else if (value.nodeType) {
					value = {y:value, x:value};
				}
				this.vars = value;
				this._autoKill = (value.autoKill !== false);
				this.getX = _buildGetter(target, "x");
				this.getY = _buildGetter(target, "y");
				this.x = this.xPrev = this.getX();
				this.y = this.yPrev = this.getY();
				if (value.x != null) {
					this._addTween(this, "x", this.x, _parseVal(value.x, target, "x") - (value.offsetX || 0), "scrollTo_x", true);
					this._overwriteProps.push("scrollTo_x");
				} else {
					this.skipX = true;
				}
				if (value.y != null) {
					this._addTween(this, "y", this.y, _parseVal(value.y, target, "y") - (value.offsetY || 0), "scrollTo_y", true);
					this._overwriteProps.push("scrollTo_y");
				} else {
					this.skipY = true;
				}
				return true;
			},

			//called each time the values should be updated, and the ratio gets passed as the only parameter (typically it's a value between 0 and 1, but it can exceed those when using an ease like Elastic.easeOut or Back.easeOut, etc.)
			set: function(v) {
				this._super.setRatio.call(this, v);

				var x = (this._wdw || !this.skipX) ? this.getX() : this.xPrev,
					y = (this._wdw || !this.skipY) ? this.getY() : this.yPrev,
					yDif = y - this.yPrev,
					xDif = x - this.xPrev,
					threshold = ScrollToPlugin.autoKillThreshold;

				if (this.x < 0) { //can't scroll to a position less than 0! Might happen if someone uses a Back.easeOut or Elastic.easeOut when scrolling back to the top of the page (for example)
					this.x = 0;
				}
				if (this.y < 0) {
					this.y = 0;
				}
				if (this._autoKill) {
					//note: iOS has a bug that throws off the scroll by several pixels, so we need to check if it's within 7 pixels of the previous one that we set instead of just looking for an exact match.
					if (!this.skipX && (xDif > threshold || xDif < -threshold) && x < _max(this._target, "x")) {
						this.skipX = true; //if the user scrolls separately, we should stop tweening!
					}
					if (!this.skipY && (yDif > threshold || yDif < -threshold) && y < _max(this._target, "y")) {
						this.skipY = true; //if the user scrolls separately, we should stop tweening!
					}
					if (this.skipX && this.skipY) {
						this._tween.kill();
						if (this.vars.onAutoKill) {
							this.vars.onAutoKill.apply(this.vars.onAutoKillScope || this._tween, this.vars.onAutoKillParams || []);
						}
					}
				}
				if (this._wdw) {
					_window.scrollTo((!this.skipX) ? this.x : x, (!this.skipY) ? this.y : y);
				} else {
					if (!this.skipY) {
						this._target.scrollTop = this.y;
					}
					if (!this.skipX) {
						this._target.scrollLeft = this.x;
					}
				}
				this.xPrev = this.x;
				this.yPrev = this.y;
			}

		}),
		p = ScrollToPlugin.prototype;

	ScrollToPlugin.max = _max;
	ScrollToPlugin.getOffset = _getOffset;
	ScrollToPlugin.autoKillThreshold = 7;

	p._kill = function(lookup) {
		if (lookup.scrollTo_x) {
			this.skipX = true;
		}
		if (lookup.scrollTo_y) {
			this.skipY = true;
		}
		return this._super._kill.call(this, lookup);
	};

}); if (_gsScope._gsDefine) { _gsScope._gsQueue.pop()(); }

//export to AMD/RequireJS and CommonJS/Node (precursor to full modular build system coming at a later date)
(function(name) {
	"use strict";
	var getGlobal = function() {
		return (_gsScope.GreenSockGlobals || _gsScope)[name];
	};
	if (typeof(define) === "function" && define.amd) { //AMD
		define(["TweenLite"], getGlobal);
	} else if (typeof(module) !== "undefined" && module.exports) { //node
		require("../TweenLite.js");
		module.exports = getGlobal();
	}
}("ScrollToPlugin"));/*!
 * VERSION: 0.14.8
 * DATE: 2016-07-18
 * UPDATES AND DOCS AT: http://greensock.com
 *
 * Requires TweenLite and CSSPlugin version 1.17.0 or later (TweenMax contains both TweenLite and CSSPlugin). ThrowPropsPlugin is required for momentum-based continuation of movement after the mouse/touch is released (ThrowPropsPlugin is a membership benefit of Club GreenSock - http://greensock.com/club/).
 *
 * @license Copyright (c) 2008-2016, GreenSock. All rights reserved.
 * This work is subject to the terms at http://greensock.com/standard-license or for
 * Club GreenSock members, the software agreement that was issued with your membership.
 *
 * @author: Jack Doyle, jack@greensock.com
 */
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("utils.Draggable",["events.EventDispatcher","TweenLite","plugins.CSSPlugin"],function(a,b,c){var d,e,f,g,h,i,j,k,l,m={css:{}},n={css:{}},o={css:{}},p={css:{}},q=_gsScope._gsDefine.globals,r={},s=document,t=s.documentElement||{},u=function(a){return s.createElementNS?s.createElementNS("http://www.w3.org/1999/xhtml",a):s.createElement(a)},v=u("div"),w=[],x=function(){return!1},y=180/Math.PI,z=999999999999999,A=Date.now||function(){return(new Date).getTime()},B=!(s.addEventListener||!s.all),C=s.createElement("div"),D=[],E={},F=0,G=/^(?:a|input|textarea|button|select)$/i,H=0,I=-1!==navigator.userAgent.toLowerCase().indexOf("android"),J=0,K={},L={},M=function(a){if("string"==typeof a&&(a=b.selector(a)),!a||a.nodeType)return[a];var c,d=[],e=a.length;for(c=0;c!==e;d.push(a[c++]));return d},N=function(a){var b,c={};for(b in a)c[b]=a[b];return c},O=function(){for(var a=D.length;--a>-1;)D[a]()},P=function(a){D.push(a),1===D.length&&b.ticker.addEventListener("tick",O,this,!1,1)},Q=function(a){for(var c=D.length;--c>-1;)D[c]===a&&D.splice(c,1);b.to(R,0,{overwrite:"all",delay:15,onComplete:R})},R=function(){D.length||b.ticker.removeEventListener("tick",O)},S=function(a,b){var c;for(c in b)void 0===a[c]&&(a[c]=b[c]);return a},T=function(){return null!=window.pageYOffset?window.pageYOffset:null!=s.scrollTop?s.scrollTop:t.scrollTop||s.body.scrollTop||0},U=function(){return null!=window.pageXOffset?window.pageXOffset:null!=s.scrollLeft?s.scrollLeft:t.scrollLeft||s.body.scrollLeft||0},V=function(a,b){Ia(a,"scroll",b),X(a.parentNode)||V(a.parentNode,b)},W=function(a,b){Ja(a,"scroll",b),X(a.parentNode)||W(a.parentNode,b)},X=function(a){return!(a&&a!==t&&a!==s&&a!==s.body&&a!==window&&a.nodeType&&a.parentNode)},Y=function(a,b){var c="x"===b?"Width":"Height",d="scroll"+c,e="client"+c,f=s.body;return Math.max(0,X(a)?Math.max(t[d],f[d])-(window["inner"+c]||t[e]||f[e]):a[d]-a[e])},Z=function(a){var b=X(a),c=Y(a,"x"),d=Y(a,"y");b?a=L:Z(a.parentNode),a._gsMaxScrollX=c,a._gsMaxScrollY=d,a._gsScrollX=a.scrollLeft||0,a._gsScrollY=a.scrollTop||0},$=function(a,b){return a=a||window.event,r.pageX=a.clientX+s.body.scrollLeft+t.scrollLeft,r.pageY=a.clientY+s.body.scrollTop+t.scrollTop,b&&(a.returnValue=!1),r},_=function(a){return a?("string"==typeof a&&(a=b.selector(a)),a.length&&a!==window&&a[0]&&a[0].style&&!a.nodeType&&(a=a[0]),a===window||a.nodeType&&a.style?a:null):a},aa=function(a,b){var c,e,f,g=a.style;if(void 0===g[b]){for(f=["O","Moz","ms","Ms","Webkit"],e=5,c=b.charAt(0).toUpperCase()+b.substr(1);--e>-1&&void 0===g[f[e]+c];);if(0>e)return"";d=3===e?"ms":f[e],b=d+c}return b},ba=function(a,b,c){var d=a.style;d&&(void 0===d[b]&&(b=aa(a,b)),null==c?d.removeProperty?d.removeProperty(b.replace(/([A-Z])/g,"-$1").toLowerCase()):d.removeAttribute(b):void 0!==d[b]&&(d[b]=c))},ca=s.defaultView?s.defaultView.getComputedStyle:x,da=/(?:Left|Right|Width)/i,ea=/(?:\d|\-|\+|=|#|\.)*/g,fa=function(a,b,c,d,e){if("px"===d||!d)return c;if("auto"===d||!c)return 0;var f,g=da.test(b),h=a,i=v.style,j=0>c;return j&&(c=-c),"%"===d&&-1!==b.indexOf("border")?f=c/100*(g?a.clientWidth:a.clientHeight):(i.cssText="border:0 solid red;position:"+ha(a,"position",!0)+";line-height:0;","%"!==d&&h.appendChild?i[g?"borderLeftWidth":"borderTopWidth"]=c+d:(h=a.parentNode||s.body,i[g?"width":"height"]=c+d),h.appendChild(v),f=parseFloat(v[g?"offsetWidth":"offsetHeight"]),h.removeChild(v),0!==f||e||(f=fa(a,b,c,d,!0))),j?-f:f},ga=function(a,b){if("absolute"!==ha(a,"position",!0))return 0;var c="left"===b?"Left":"Top",d=ha(a,"margin"+c,!0);return a["offset"+c]-(fa(a,b,parseFloat(d),(d+"").replace(ea,""))||0)},ha=function(a,b,c){var d,e=(a._gsTransform||{})[b];return e||0===e?e:(a.style[b]?e=a.style[b]:(d=ca(a))?(e=d.getPropertyValue(b.replace(/([A-Z])/g,"-$1").toLowerCase()),e=e||d.length?e:d[b]):a.currentStyle&&(e=a.currentStyle[b]),"auto"!==e||"top"!==b&&"left"!==b||(e=ga(a,b)),c?e:parseFloat(e)||0)},ia=function(a,b,c){var d=a.vars,e=d[c],f=a._listeners[b];"function"==typeof e&&e.apply(d[c+"Scope"]||d.callbackScope||a,d[c+"Params"]||[a.pointerEvent]),f&&a.dispatchEvent(b)},ja=function(a,b){var c,d,e,f=_(a);return f?Da(f,b):void 0!==a.left?(e=xa(b),{left:a.left-e.x,top:a.top-e.y,width:a.width,height:a.height}):(d=a.min||a.minX||a.minRotation||0,c=a.min||a.minY||0,{left:d,top:c,width:(a.max||a.maxX||a.maxRotation||0)-d,height:(a.max||a.maxY||0)-c})},ka=function(){if(!s.createElementNS)return g=0,void(h=!1);var a,b,c,d,e=u("div"),f=s.createElementNS("http://www.w3.org/2000/svg","svg"),l=u("div"),m=e.style,n=s.body||t;s.body&&na&&(m.position="absolute",n.appendChild(l),l.appendChild(e),d=e.offsetParent,l.style[na]="rotate(1deg)",k=e.offsetParent===d,l.style.position="absolute",m.height="10px",d=e.offsetTop,l.style.border="5px solid red",j=d!==e.offsetTop,n.removeChild(l)),m=f.style,f.setAttributeNS(null,"width","400px"),f.setAttributeNS(null,"height","400px"),f.setAttributeNS(null,"viewBox","0 0 400 400"),m.display="block",m.boxSizing="border-box",m.border="0px solid red",m.transform="none",e.style.cssText="width:100px;height:100px;overflow:scroll;-ms-overflow-style:none;",n.appendChild(e),e.appendChild(f),c=f.createSVGPoint().matrixTransform(f.getScreenCTM()),b=c.y,e.scrollTop=100,c.x=c.y=0,c=c.matrixTransform(f.getScreenCTM()),i=b-c.y<100.1?0:b-c.y-150,e.removeChild(f),n.removeChild(e),n.appendChild(f),a=f.getScreenCTM(),b=a.e,m.border="50px solid red",a=f.getScreenCTM(),0===b&&0===a.e&&0===a.f&&1===a.a?(g=1,h=!0):(g=b!==a.e?1:0,h=1!==a.a),n.removeChild(f)},la=""!==aa(v,"perspective"),ma=aa(v,"transformOrigin").replace(/^ms/g,"Ms").replace(/([A-Z])/g,"-$1").toLowerCase(),na=aa(v,"transform"),oa=na.replace(/^ms/g,"Ms").replace(/([A-Z])/g,"-$1").toLowerCase(),pa={},qa={},ra=window.SVGElement,sa=function(a){return!!(ra&&"function"==typeof a.getBBox&&a.getCTM&&(!a.parentNode||a.parentNode.getBBox&&a.parentNode.getCTM))},ta=(/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(navigator.userAgent)||/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(navigator.userAgent))&&parseFloat(RegExp.$1)<11,ua=[],va=[],wa=function(a){if(!a.getBoundingClientRect||!a.parentNode||!na)return{offsetTop:0,offsetLeft:0,scaleX:1,scaleY:1,offsetParent:t};if(Sa.cacheSVGData!==!1&&a._gsCache&&a._gsCache.lastUpdate===b.ticker.frame)return a._gsCache;var c,d,e,f,j,k,l,m,n,o,p,q,r=a,u=ya(a);if(u.lastUpdate=b.ticker.frame,a.getBBox&&!u.isSVGRoot){for(r=a.parentNode,c=a.getBBox();r&&"svg"!==(r.nodeName+"").toLowerCase();)r=r.parentNode;return f=wa(r),u.offsetTop=c.y*f.scaleY,u.offsetLeft=c.x*f.scaleX,u.scaleX=f.scaleX,u.scaleY=f.scaleY,u.offsetParent=r||t,u}for(e=u.offsetParent,e===s.body&&(e=t),va.length=ua.length=0;r&&(j=ha(r,na,!0),"matrix(1, 0, 0, 1, 0, 0)"!==j&&"none"!==j&&"translate3d(0px, 0px, 0px)"!==j&&(va.push(r),ua.push(r.style[na]),r.style[na]="none"),r!==e);)r=r.parentNode;for(d=e.getBoundingClientRect(),j=a.getScreenCTM(),m=a.createSVGPoint(),l=m.matrixTransform(j),m.x=m.y=10,m=m.matrixTransform(j),u.scaleX=(m.x-l.x)/10,u.scaleY=(m.y-l.y)/10,void 0===g&&ka(),u.borderBox&&!h&&a.getAttribute("width")&&(f=ca(a)||{},n=parseFloat(f.borderLeftWidth)+parseFloat(f.borderRightWidth)||0,o=parseFloat(f.borderTopWidth)+parseFloat(f.borderBottomWidth)||0,p=parseFloat(f.width)||0,q=parseFloat(f.height)||0,u.scaleX*=(p-n)/p,u.scaleY*=(q-o)/q),i?(c=a.getBoundingClientRect(),u.offsetLeft=c.left-d.left,u.offsetTop=c.top-d.top):(u.offsetLeft=l.x-d.left,u.offsetTop=l.y-d.top),u.offsetParent=e,k=va.length;--k>-1;)va[k].style[na]=ua[k];return u},xa=function(a,c){if(c=c||{},!a||a===t||!a.parentNode||a===window)return{x:0,y:0};var d=ca(a),e=ma&&d?d.getPropertyValue(ma):"50% 50%",f=e.split(" "),g=-1!==e.indexOf("left")?"0%":-1!==e.indexOf("right")?"100%":f[0],h=-1!==e.indexOf("top")?"0%":-1!==e.indexOf("bottom")?"100%":f[1];return("center"===h||null==h)&&(h="50%"),("center"===g||isNaN(parseFloat(g)))&&(g="50%"),a.getBBox&&sa(a)?(a._gsTransform||(b.set(a,{x:"+=0",overwrite:!1}),void 0===a._gsTransform.xOrigin&&console.log("Draggable requires at least GSAP 1.17.0")),e=a.getBBox(),c.x=a._gsTransform.xOrigin-e.x,c.y=a._gsTransform.yOrigin-e.y):(a.getBBox&&-1!==(g+h).indexOf("%")&&(a=a.getBBox(),a={offsetWidth:a.width,offsetHeight:a.height}),c.x=-1!==g.indexOf("%")?a.offsetWidth*parseFloat(g)/100:parseFloat(g),c.y=-1!==h.indexOf("%")?a.offsetHeight*parseFloat(h)/100:parseFloat(h)),c},ya=function(a){if(Sa.cacheSVGData!==!1&&a._gsCache&&a._gsCache.lastUpdate===b.ticker.frame)return a._gsCache;var c,d=a._gsCache=a._gsCache||{},e=ca(a),f=a.getBBox&&sa(a),g="svg"===(a.nodeName+"").toLowerCase();if(d.isSVG=f,d.isSVGRoot=g,d.borderBox="border-box"===e.boxSizing,d.computedStyle=e,g)c=a.parentNode||t,c.insertBefore(v,a),d.offsetParent=v.offsetParent||t,c.removeChild(v);else if(f){for(c=a.parentNode;c&&"svg"!==(c.nodeName+"").toLowerCase();)c=c.parentNode;d.offsetParent=c}else d.offsetParent=a.offsetParent;return d},za=function(a,b,c,d){if(a===window||!a||!a.style||!a.parentNode)return[1,0,0,1,0,0];var e,f,h,i,l,m,n,o,p,q,r,u,v,w,x=a._gsCache||ya(a),y=a.parentNode,z=y._gsCache||ya(y),A=x.computedStyle,B=x.isSVG?z.offsetParent:y.offsetParent;return e=x.isSVG&&-1!==(a.style[na]+"").indexOf("matrix")?a.style[na]:A?A.getPropertyValue(oa):a.currentStyle?a.currentStyle[na]:"1,0,0,1,0,0",a.getBBox&&-1!==(a.getAttribute("transform")+"").indexOf("matrix")&&(e=a.getAttribute("transform")),e=(e+"").match(/(?:\-|\.|\b)(\d|\.|e\-)+/g)||[1,0,0,1,0,0],e.length>6&&(e=[e[0],e[1],e[4],e[5],e[12],e[13]]),d?e[4]=e[5]=0:x.isSVG&&(l=a._gsTransform)&&(l.xOrigin||l.yOrigin)&&(e[0]=parseFloat(e[0]),e[1]=parseFloat(e[1]),e[2]=parseFloat(e[2]),e[3]=parseFloat(e[3]),e[4]=parseFloat(e[4])-(l.xOrigin-(l.xOrigin*e[0]+l.yOrigin*e[2])),e[5]=parseFloat(e[5])-(l.yOrigin-(l.xOrigin*e[1]+l.yOrigin*e[3]))),b&&(void 0===g&&ka(),h=x.isSVG||x.isSVGRoot?wa(a):a,x.isSVG?(i=a.getBBox(),q=z.isSVGRoot?{x:0,y:0}:y.getBBox(),h={offsetLeft:i.x-q.x,offsetTop:i.y-q.y,offsetParent:x.offsetParent}):x.isSVGRoot?(r=parseInt(A.borderTopWidth,10)||0,u=parseInt(A.borderLeftWidth,10)||0,v=(e[0]-g)*u+e[2]*r,w=e[1]*u+(e[3]-g)*r,m=b.x,n=b.y,o=m-(m*e[0]+n*e[2]),p=n-(m*e[1]+n*e[3]),e[4]=parseFloat(e[4])+o,e[5]=parseFloat(e[5])+p,b.x-=o,b.y-=p,m=h.scaleX,n=h.scaleY,b.x*=m,b.y*=n,e[0]*=m,e[1]*=n,e[2]*=m,e[3]*=n,ta||(b.x+=v,b.y+=w)):!j&&a.offsetParent&&(b.x+=parseInt(ha(a.offsetParent,"borderLeftWidth"),10)||0,b.y+=parseInt(ha(a.offsetParent,"borderTopWidth"),10)||0),f=y===t||y===s.body,e[4]=Number(e[4])+b.x+(h.offsetLeft||0)-c.x-(f?0:y.scrollLeft||0),e[5]=Number(e[5])+b.y+(h.offsetTop||0)-c.y-(f?0:y.scrollTop||0),y&&"fixed"===ha(a,"position",A)&&(e[4]+=U(),e[5]+=T()),!y||y===t||B!==h.offsetParent||z.isSVG||k&&"100100"!==za(y).join("")||(h=z.isSVGRoot?wa(y):y,e[4]-=h.offsetLeft||0,e[5]-=h.offsetTop||0,j||!z.offsetParent||x.isSVG||x.isSVGRoot||(e[4]-=parseInt(ha(z.offsetParent,"borderLeftWidth"),10)||0,e[5]-=parseInt(ha(z.offsetParent,"borderTopWidth"),10)||0))),e},Aa=function(a,b){if(!a||a===window||!a.parentNode)return[1,0,0,1,0,0];for(var c,d,e,f,g,h,i,j,k=xa(a,pa),l=xa(a.parentNode,qa),m=za(a,k,l);(a=a.parentNode)&&a.parentNode&&a!==t;)k=l,l=xa(a.parentNode,k===pa?qa:pa),i=za(a,k,l),c=m[0],d=m[1],e=m[2],f=m[3],g=m[4],h=m[5],m[0]=c*i[0]+d*i[2],m[1]=c*i[1]+d*i[3],m[2]=e*i[0]+f*i[2],m[3]=e*i[1]+f*i[3],m[4]=g*i[0]+h*i[2]+i[4],m[5]=g*i[1]+h*i[3]+i[5];return b&&(c=m[0],d=m[1],e=m[2],f=m[3],g=m[4],h=m[5],j=c*f-d*e,m[0]=f/j,m[1]=-d/j,m[2]=-e/j,m[3]=c/j,m[4]=(e*h-f*g)/j,m[5]=-(c*h-d*g)/j),m},Ba=function(a,b,c,d,e){a=_(a);var f=Aa(a,!1,e),g=b.x,h=b.y;return c&&(xa(a,b),g-=b.x,h-=b.y),d=d===!0?b:d||{},d.x=g*f[0]+h*f[2]+f[4],d.y=g*f[1]+h*f[3]+f[5],d},Ca=function(a,b,c){var d=a.x*b[0]+a.y*b[2]+b[4],e=a.x*b[1]+a.y*b[3]+b[5];return a.x=d*c[0]+e*c[2]+c[4],a.y=d*c[1]+e*c[3]+c[5],a},Da=function(a,b,c){if(!(a=_(a)))return null;b=_(b);var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,u,v,w,x,y,z,A,C=a.getBBox&&sa(a);if(a===window)g=T(),e=U(),f=e+(t.clientWidth||a.innerWidth||s.body.clientWidth||0),h=g+((a.innerHeight||0)-20<t.clientHeight?t.clientHeight:a.innerHeight||s.body.clientHeight||0);else{if(void 0===b||b===window)return a.getBoundingClientRect();d=xa(a),e=-d.x,g=-d.y,C?(o=a.getBBox(),p=o.width,q=o.height):"svg"!==(a.nodeName+"").toLowerCase()&&a.offsetWidth?(p=a.offsetWidth,q=a.offsetHeight):(z=ca(a),p=parseFloat(z.width),q=parseFloat(z.height)),f=e+p,h=g+q,"svg"!==a.nodeName.toLowerCase()||B||(r=wa(a),A=r.computedStyle||{},w=(a.getAttribute("viewBox")||"0 0").split(" "),x=parseFloat(w[0]),y=parseFloat(w[1]),u=parseFloat(A.borderLeftWidth)||0,v=parseFloat(A.borderTopWidth)||0,f-=p-(p-u)/r.scaleX-x,h-=q-(q-v)/r.scaleY-y,e-=u/r.scaleX-x,g-=v/r.scaleY-y,z&&(f+=(parseFloat(A.borderRightWidth)+u)/r.scaleX,h+=(v+parseFloat(A.borderBottomWidth))/r.scaleY))}return a===b?{left:e,top:g,width:f-e,height:h-g}:(i=Aa(a),j=Aa(b,!0),k=Ca({x:e,y:g},i,j),l=Ca({x:f,y:g},i,j),m=Ca({x:f,y:h},i,j),n=Ca({x:e,y:h},i,j),e=Math.min(k.x,l.x,m.x,n.x),g=Math.min(k.y,l.y,m.y,n.y),K.x=K.y=0,c&&xa(b,K),{left:e+K.x,top:g+K.y,width:Math.max(k.x,l.x,m.x,n.x)-e,height:Math.max(k.y,l.y,m.y,n.y)-g})},Ea=function(a){return a&&a.length&&a[0]&&(a[0].nodeType&&a[0].style&&!a.nodeType||a[0].length&&a[0][0])?!0:!1},Fa=function(a){var b,c,d,e=[],f=a.length;for(b=0;f>b;b++)if(c=a[b],Ea(c))for(d=c.length,d=0;d<c.length;d++)e.push(c[d]);else c&&0!==c.length&&e.push(c);return e},Ga="ontouchstart"in t&&"orientation"in window,Ha=function(a){for(var b=a.split(","),c=(void 0!==v.onpointerdown?"pointerdown,pointermove,pointerup,pointercancel":void 0!==v.onmspointerdown?"MSPointerDown,MSPointerMove,MSPointerUp,MSPointerCancel":a).split(","),d={},e=8;--e>-1;)d[b[e]]=c[e],d[c[e]]=b[e];return d}("touchstart,touchmove,touchend,touchcancel"),Ia=function(a,b,c,d){a.addEventListener?a.addEventListener(Ha[b]||b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)},Ja=function(a,b,c){a.removeEventListener?a.removeEventListener(Ha[b]||b,c):a.detachEvent&&a.detachEvent("on"+b,c)},Ka=function(a,b){for(var c=a.length;--c>-1;)if(a[c].identifier===b)return!0;return!1},La=function(a){e=a.touches&&H<a.touches.length,Ja(a.target,"touchend",La)},Ma=function(a){e=a.touches&&H<a.touches.length,Ia(a.target,"touchend",La)},Na=function(a,b,c,d,e,f){var g,h,i,j={};if(b)if(1!==e&&b instanceof Array){for(j.end=g=[],i=b.length,h=0;i>h;h++)g[h]=b[h]*e;c+=1.1,d-=1.1}else"function"==typeof b?j.end=function(c){return b.call(a,c)*e}:j.end=b;return(c||0===c)&&(j.max=c),(d||0===d)&&(j.min=d),f&&(j.velocity=0),j},Oa=function(a){var b;return a&&a.getAttribute&&"BODY"!==a.nodeName?"true"===(b=a.getAttribute("data-clickable"))||"false"!==b&&(a.onclick||G.test(a.nodeName+"")||"true"===a.getAttribute("contentEditable"))?!0:Oa(a.parentNode):!1},Pa=function(a,b){for(var c,d=a.length;--d>-1;)c=a[d],c.ondragstart=c.onselectstart=b?null:x,ba(c,"userSelect",b?"text":"none")},Qa=function(){var a,b=s.createElement("div"),c=s.createElement("div"),d=c.style,e=s.body||v;return d.display="inline-block",d.position="relative",b.style.cssText=c.innerHTML="width:90px; height:40px; padding:10px; overflow:auto; visibility: hidden",b.appendChild(c),e.appendChild(b),l=c.offsetHeight+18>b.scrollHeight,d.width="100%",na||(d.paddingRight="500px",a=b.scrollLeft=b.scrollWidth-b.clientWidth,d.left="-90px",a=a!==b.scrollLeft),e.removeChild(b),a}(),Ra=function(a,c){a=_(a),c=c||{};var d,e,f,g,h,i,j=s.createElement("div"),k=j.style,m=a.firstChild,n=0,o=0,p=a.scrollTop,q=a.scrollLeft,r=a.scrollWidth,t=a.scrollHeight,u=0,v=0,w=0;la&&c.force3D!==!1?(h="translate3d(",i="px,0px)"):na&&(h="translate(",i="px)"),this.scrollTop=function(a,b){return arguments.length?void this.top(-a,b):-this.top()},this.scrollLeft=function(a,b){return arguments.length?void this.left(-a,b):-this.left()},this.left=function(d,e){if(!arguments.length)return-(a.scrollLeft+o);var f=a.scrollLeft-q,g=o;return(f>2||-2>f)&&!e?(q=a.scrollLeft,b.killTweensOf(this,!0,{left:1,scrollLeft:1}),this.left(-q),void(c.onKill&&c.onKill())):(d=-d,0>d?(o=d-.5|0,d=0):d>v?(o=d-v|0,d=v):o=0,(o||g)&&(h?this._suspendTransforms||(k[na]=h+-o+"px,"+-n+i):k.left=-o+"px",Qa&&o+u>=0&&(k.paddingRight=o+u+"px")),a.scrollLeft=0|d,void(q=a.scrollLeft))},this.top=function(d,e){if(!arguments.length)return-(a.scrollTop+n);var f=a.scrollTop-p,g=n;return(f>2||-2>f)&&!e?(p=a.scrollTop,b.killTweensOf(this,!0,{top:1,scrollTop:1}),this.top(-p),void(c.onKill&&c.onKill())):(d=-d,0>d?(n=d-.5|0,d=0):d>w?(n=d-w|0,d=w):n=0,(n||g)&&(h?this._suspendTransforms||(k[na]=h+-o+"px,"+-n+i):k.top=-n+"px"),a.scrollTop=0|d,void(p=a.scrollTop))},this.maxScrollTop=function(){return w},this.maxScrollLeft=function(){return v},this.disable=function(){for(m=j.firstChild;m;)g=m.nextSibling,a.appendChild(m),m=g;a===j.parentNode&&a.removeChild(j)},this.enable=function(){if(m=a.firstChild,m!==j){for(;m;)g=m.nextSibling,j.appendChild(m),m=g;a.appendChild(j),this.calibrate()}},this.calibrate=function(b){var c,g,h=a.clientWidth===d;p=a.scrollTop,q=a.scrollLeft,(!h||a.clientHeight!==e||j.offsetHeight!==f||r!==a.scrollWidth||t!==a.scrollHeight||b)&&((n||o)&&(c=this.left(),g=this.top(),this.left(-a.scrollLeft),this.top(-a.scrollTop)),(!h||b)&&(k.display="block",k.width="auto",k.paddingRight="0px",u=Math.max(0,a.scrollWidth-a.clientWidth),u&&(u+=ha(a,"paddingLeft")+(l?ha(a,"paddingRight"):0))),k.display="inline-block",k.position="relative",k.overflow="visible",k.verticalAlign="top",k.width="100%",k.paddingRight=u+"px",l&&(k.paddingBottom=ha(a,"paddingBottom",!0)),B&&(k.zoom="1"),d=a.clientWidth,e=a.clientHeight,r=a.scrollWidth,t=a.scrollHeight,v=a.scrollWidth-d,w=a.scrollHeight-e,f=j.offsetHeight,k.display="block",(c||g)&&(this.left(c),this.top(g)))},this.content=j,this.element=a,this._suspendTransforms=!1,this.enable()},Sa=function(d,g){a.call(this,d),d=_(d),f||(f=q.com.greensock.plugins.ThrowPropsPlugin),this.vars=g=N(g||{}),this.target=d,this.x=this.y=this.rotation=0,this.dragResistance=parseFloat(g.dragResistance)||0,this.edgeResistance=isNaN(g.edgeResistance)?1:parseFloat(g.edgeResistance)||0,this.lockAxis=g.lockAxis,this.autoScroll=g.autoScroll||0,this.lockedAxis=null,this.allowEventDefault=!!g.allowEventDefault;var h,i,j,k,l,r,u,v,x,D,G,K,O,R,T,U,Y,aa,ca,da,ea,fa,ga,ka,la,ma,na,oa,pa,qa,ra,sa,ta,ua=(g.type||(B?"top,left":"x,y")).toLowerCase(),va=-1!==ua.indexOf("x")||-1!==ua.indexOf("y"),wa=-1!==ua.indexOf("rotation"),xa=wa?"rotation":va?"x":"left",ya=va?"y":"top",za=-1!==ua.indexOf("x")||-1!==ua.indexOf("left")||"scroll"===ua,Ca=-1!==ua.indexOf("y")||-1!==ua.indexOf("top")||"scroll"===ua,Da=g.minimumMovement||2,Ea=this,Fa=M(g.trigger||g.handle||d),La={},Qa=0,Ta=!1,Ua=g.clickableTest||Oa,Va=0,Xa=function(a){if(Ea.autoScroll&&Ea.isDragging&&(Ta||aa)){var b,c,e,f,g,h,j,k,l=d,m=15*Ea.autoScroll;for(Ta=!1,L.scrollTop=null!=window.pageYOffset?window.pageYOffset:null!=t.scrollTop?t.scrollTop:s.body.scrollTop,L.scrollLeft=null!=window.pageXOffset?window.pageXOffset:null!=t.scrollLeft?t.scrollLeft:s.body.scrollLeft,f=Ea.pointerX-L.scrollLeft,g=Ea.pointerY-L.scrollTop;l&&!c;)c=X(l.parentNode),b=c?L:l.parentNode,e=c?{bottom:Math.max(t.clientHeight,window.innerHeight||0),right:Math.max(t.clientWidth,window.innerWidth||0),left:0,top:0}:b.getBoundingClientRect(),h=j=0,Ca&&(k=b._gsMaxScrollY-b.scrollTop,0>k?j=k:g>e.bottom-40&&k?(Ta=!0,j=Math.min(k,m*(1-Math.max(0,e.bottom-g)/40)|0)):g<e.top+40&&b.scrollTop&&(Ta=!0,j=-Math.min(b.scrollTop,m*(1-Math.max(0,g-e.top)/40)|0)),j&&(b.scrollTop+=j)),za&&(k=b._gsMaxScrollX-b.scrollLeft,0>k?h=k:f>e.right-40&&k?(Ta=!0,h=Math.min(k,m*(1-Math.max(0,e.right-f)/40)|0)):f<e.left+40&&b.scrollLeft&&(Ta=!0,h=-Math.min(b.scrollLeft,m*(1-Math.max(0,f-e.left)/40)|0)),h&&(b.scrollLeft+=h)),c&&(h||j)&&(window.scrollTo(b.scrollLeft,b.scrollTop),ib(Ea.pointerX+h,Ea.pointerY+j)),l=b}if(aa){var n=Ea.x,o=Ea.y,p=1e-6;p>n&&n>-p&&(n=0),p>o&&o>-p&&(o=0),wa?(oa.data.rotation=Ea.rotation=n,oa.setRatio(1)):i?(Ca&&i.top(o),za&&i.left(n)):va?(Ca&&(oa.data.y=o),za&&(oa.data.x=n),oa.setRatio(1)):(Ca&&(d.style.top=o+"px"),za&&(d.style.left=n+"px")),!v||a||ra||(ra=!0,ia(Ea,"drag","onDrag"),ra=!1)}aa=!1},Ya=function(a,c){var e;Ea.x,Ea.y;d._gsTransform||!va&&!wa||b.set(d,{x:"+=0",overwrite:!1}),va?(Ea.y=d._gsTransform.y,Ea.x=d._gsTransform.x):wa?Ea.x=Ea.rotation=d._gsTransform.rotation:i?(Ea.y=i.top(),Ea.x=i.left()):(Ea.y=parseInt(d.style.top,10)||0,Ea.x=parseInt(d.style.left,10)||0),!da&&!ea||c||(da&&(e=da(Ea.x),e!==Ea.x&&(Ea.x=e,wa&&(Ea.rotation=e),aa=!0)),ea&&(e=ea(Ea.y),e!==Ea.y&&(Ea.y=e),aa=!0)),aa&&Xa(!0),a||ia(Ea,"throwupdate","onThrowUpdate")},Za=function(){var a,b,c,e;u=!1,i?(i.calibrate(),Ea.minX=D=-i.maxScrollLeft(),Ea.minY=K=-i.maxScrollTop(),Ea.maxX=x=Ea.maxY=G=0,u=!0):g.bounds&&(a=ja(g.bounds,d.parentNode),wa?(Ea.minX=D=a.left,Ea.maxX=x=a.left+a.width,Ea.minY=K=Ea.maxY=G=0):void 0!==g.bounds.maxX||void 0!==g.bounds.maxY?(a=g.bounds,Ea.minX=D=a.minX,Ea.minY=K=a.minY,Ea.maxX=x=a.maxX,Ea.maxY=G=a.maxY):(b=ja(d,d.parentNode),Ea.minX=D=ha(d,xa)+a.left-b.left,Ea.minY=K=ha(d,ya)+a.top-b.top,Ea.maxX=x=D+(a.width-b.width),Ea.maxY=G=K+(a.height-b.height)),D>x&&(Ea.minX=x,Ea.maxX=x=D,D=Ea.minX),K>G&&(Ea.minY=G,Ea.maxY=G=K,K=Ea.minY),wa&&(Ea.minRotation=D,Ea.maxRotation=x),u=!0),g.liveSnap&&(c=g.liveSnap===!0?g.snap||{}:g.liveSnap,e=c instanceof Array||"function"==typeof c,wa?(da=fb(e?c:c.rotation,D,x,1),ea=null):(za&&(da=fb(e?c:c.x||c.left||c.scrollLeft,D,x,i?-1:1)),Ca&&(ea=fb(e?c:c.y||c.top||c.scrollTop,K,G,i?-1:1))))},$a=function(){Ea.isThrowing=!1,ia(Ea,"throwcomplete","onThrowComplete")},_a=function(){Ea.isThrowing=!1},ab=function(a,b){var c,e,h,j;a&&f?(a===!0&&(c=g.snap||{},e=c instanceof Array||"function"==typeof c,a={resistance:(g.throwResistance||g.resistance||1e3)/(wa?10:1)},wa?a.rotation=Na(Ea,e?c:c.rotation,x,D,1,b):(za&&(a[xa]=Na(Ea,e?c:c.x||c.left||c.scrollLeft,x,D,i?-1:1,b||"x"===Ea.lockedAxis)),Ca&&(a[ya]=Na(Ea,e?c:c.y||c.top||c.scrollTop,G,K,i?-1:1,b||"y"===Ea.lockedAxis)))),Ea.isThrowing=!0,j=isNaN(g.overshootTolerance)?1===g.edgeResistance?0:1-Ea.edgeResistance+.2:g.overshootTolerance,Ea.tween=h=f.to(i||d,{throwProps:a,ease:g.ease||q.Power3.easeOut,onComplete:$a,onOverwrite:_a,onUpdate:g.fastMode?ia:Ya,onUpdateParams:g.fastMode?[Ea,"onthrowupdate","onThrowUpdate"]:w},isNaN(g.maxDuration)?2:g.maxDuration,isNaN(g.minDuration)?0===j?0:.5:g.minDuration,j),g.fastMode||(i&&(i._suspendTransforms=!0),h.render(h.duration(),!0,!0),Ya(!0,!0),Ea.endX=Ea.x,Ea.endY=Ea.y,wa&&(Ea.endRotation=Ea.x),h.play(0),Ya(!0,!0),i&&(i._suspendTransforms=!1))):u&&Ea.applyBounds()},bb=function(a){var b,c,e,f,g,h,i,l,m,n=ka||[1,0,0,1,0,0];ka=Aa(d.parentNode,!0),a&&Ea.isPressed&&n.join(",")!==ka.join(",")&&(b=n[0],c=n[1],e=n[2],f=n[3],g=n[4],h=n[5],i=b*f-c*e,l=j*(f/i)+k*(-e/i)+(e*h-f*g)/i,m=j*(-c/i)+k*(b/i)+-(b*h-c*g)/i,k=l*ka[1]+m*ka[3]+ka[5],j=l*ka[0]+m*ka[2]+ka[4]),ka[1]||ka[2]||1!=ka[0]||1!=ka[3]||0!=ka[4]||0!=ka[5]||(ka=null)},cb=function(){var a=1-Ea.edgeResistance;bb(!1),ka&&(j=Ea.pointerX*ka[0]+Ea.pointerY*ka[2]+ka[4],k=Ea.pointerX*ka[1]+Ea.pointerY*ka[3]+ka[5]),aa&&(ib(Ea.pointerX,Ea.pointerY),Xa(!0)),i?(Za(),r=i.top(),l=i.left()):(db()?(Ya(!0,!0),Za()):Ea.applyBounds(),wa?(Y=Ba(d,{x:0,y:0}),Ya(!0,!0),l=Ea.x,r=Ea.y=Math.atan2(Y.y-Ea.pointerY,Ea.pointerX-Y.x)*y):(ma=d.parentNode?d.parentNode.scrollTop||0:0,na=d.parentNode?d.parentNode.scrollLeft||0:0,r=ha(d,ya),l=ha(d,xa))),u&&a&&(l>x?l=x+(l-x)/a:D>l&&(l=D-(D-l)/a),wa||(r>G?r=G+(r-G)/a:K>r&&(r=K-(K-r)/a)))},db=function(){return Ea.tween&&Ea.tween.isActive()},eb=function(){!C.parentNode||db()||Ea.isDragging||C.parentNode.removeChild(C)},fb=function(a,b,c,d){return"function"==typeof a?function(e){var f=Ea.isPressed?1-Ea.edgeResistance:1;return a.call(Ea,e>c?c+(e-c)*f:b>e?b+(e-b)*f:e)*d}:a instanceof Array?function(d){for(var e,f,g=a.length,h=0,i=z;--g>-1;)e=a[g],f=e-d,0>f&&(f=-f),i>f&&e>=b&&c>=e&&(h=g,i=f);return a[h]}:isNaN(a)?function(a){return a}:function(){return a*d}},gb=function(a){var c;if(!(!h||Ea.isPressed||!a||("mousedown"===a.type||"pointerdown"===a.type)&&A()-Va<30&&Ha[Ea.pointerEvent.type])){if(la=db(),Ea.pointerEvent=a,Ha[a.type]?(ga=-1!==a.type.indexOf("touch")?a.currentTarget||a.target:s,Ia(ga,"touchend",jb),Ia(ga,"touchmove",hb),Ia(ga,"touchcancel",jb),Ia(s,"touchstart",Ma)):(ga=null,Ia(s,"mousemove",hb)),qa=null,Ia(s,"mouseup",jb),a&&a.target&&Ia(a.target,"mouseup",jb),fa=Ua.call(Ea,a.target)&&!g.dragClickables)return Ia(a.target,"change",jb),ia(Ea,"press","onPress"),void Pa(Fa,!0);if(pa=!ga||za===Ca||i||Ea.vars.allowNativeTouchScrolling===!1?!1:za?"y":"x",B?a=$(a,!0):pa||Ea.allowEventDefault||(a.preventDefault(),a.preventManipulation&&a.preventManipulation()),a.changedTouches?(a=T=a.changedTouches[0],U=a.identifier):a.pointerId?U=a.pointerId:T=U=null,H++,P(Xa),k=Ea.pointerY=a.pageY,j=Ea.pointerX=a.pageX,(pa||Ea.autoScroll)&&Z(d.parentNode),d.parentNode&&(i||Ea.autoScroll&&!wa&&d.parentNode._gsMaxScrollX&&!C.parentNode)&&!d.getBBox&&(C.style.width=d.parentNode.scrollWidth+"px",d.parentNode.appendChild(C)),cb(),Ea.tween&&Ea.tween.kill(),Ea.isThrowing=!1,b.killTweensOf(i||d,!0,La),i&&b.killTweensOf(d,!0,{scrollTo:1}),Ea.tween=Ea.lockedAxis=null,(g.zIndexBoost||!wa&&!i&&g.zIndexBoost!==!1)&&(d.style.zIndex=Sa.zIndex++),Ea.isPressed=!0,v=!(!g.onDrag&&!Ea._listeners.drag),!wa)for(c=Fa.length;--c>-1;)ba(Fa[c],"cursor",g.cursor||"move");ia(Ea,"press","onPress")}},hb=function(a){var b,c,d,f,g=a;if(h&&!e&&Ea.isPressed&&a){if(Ea.pointerEvent=a,b=a.changedTouches){if(a=b[0],a!==T&&a.identifier!==U){for(f=b.length;--f>-1&&(a=b[f]).identifier!==U;);if(0>f)return}}else if(a.pointerId&&U&&a.pointerId!==U)return;if(B)a=$(a,!0);else{if(ga&&pa&&!qa&&(c=a.pageX,d=a.pageY,ka&&(f=c*ka[0]+d*ka[2]+ka[4],d=c*ka[1]+d*ka[3]+ka[5],c=f),qa=Math.abs(c-j)>Math.abs(d-k)&&za?"x":"y",Ea.vars.lockAxisOnTouchScroll!==!1&&(Ea.lockedAxis="x"===qa?"y":"x","function"==typeof Ea.vars.onLockAxis&&Ea.vars.onLockAxis.call(Ea,g)),I&&pa===qa))return void jb(g);Ea.allowEventDefault||pa&&(!qa||pa===qa)||g.cancelable===!1||(g.preventDefault(),g.preventManipulation&&g.preventManipulation())}Ea.autoScroll&&(Ta=!0),ib(a.pageX,a.pageY)}},ib=function(a,b){var c,d,e,f,g,h,i=1-Ea.dragResistance,m=1-Ea.edgeResistance;Ea.pointerX=a,Ea.pointerY=b,wa?(f=Math.atan2(Y.y-b,a-Y.x)*y,g=Ea.y-f,Ea.y=f,g>180?r-=360:-180>g&&(r+=360),e=l+(r-f)*i):(ka&&(h=a*ka[0]+b*ka[2]+ka[4],b=a*ka[1]+b*ka[3]+ka[5],a=h),d=b-k,c=a-j,Da>d&&d>-Da&&(d=0),Da>c&&c>-Da&&(c=0),(Ea.lockAxis||Ea.lockedAxis)&&(c||d)&&(h=Ea.lockedAxis,h||(Ea.lockedAxis=h=za&&Math.abs(c)>Math.abs(d)?"y":Ca?"x":null,h&&"function"==typeof Ea.vars.onLockAxis&&Ea.vars.onLockAxis.call(Ea,Ea.pointerEvent)),"y"===h?d=0:"x"===h&&(c=0)),e=l+c*i,f=r+d*i),da||ea?(da&&(e=da(e)),ea&&(f=ea(f))):u&&(e>x?e=x+(e-x)*m:D>e&&(e=D+(e-D)*m),wa||(f>G?f=G+(f-G)*m:K>f&&(f=K+(f-K)*m))),wa||(e=Math.round(e),f=Math.round(f)),(Ea.x!==e||Ea.y!==f&&!wa)&&(wa?Ea.endRotation=Ea.x=Ea.endX=e:(Ca&&(Ea.y=Ea.endY=f),za&&(Ea.x=Ea.endX=e)),aa=!0,!Ea.isDragging&&Ea.isPressed&&(Ea.isDragging=!0,ia(Ea,"dragstart","onDragStart")))},jb=function(a,c){if(h&&Ea.isPressed&&(!a||null==U||c||!(a.pointerId&&a.pointerId!==U||a.changedTouches&&!Ka(a.changedTouches,U)))){Ea.isPressed=!1;var e,f,i,j,k,l=a,m=Ea.isDragging,n=b.delayedCall(.001,eb);if(ga?(Ja(ga,"touchend",jb),Ja(ga,"touchmove",hb),Ja(ga,"touchcancel",jb),Ja(s,"touchstart",Ma)):Ja(s,"mousemove",hb),Ja(s,"mouseup",jb),a&&a.target&&Ja(a.target,"mouseup",jb),aa=!1,fa)return a&&Ja(a.target,"change",jb),Pa(Fa,!1),ia(Ea,"release","onRelease"),ia(Ea,"click","onClick"),void(fa=!1);if(Q(Xa),!wa)for(f=Fa.length;--f>-1;)ba(Fa[f],"cursor",g.cursor||"move");if(m&&(Qa=J=A(),Ea.isDragging=!1),H--,a){if(B&&(a=$(a,!1)),e=a.changedTouches,e&&(a=e[0],a!==T&&a.identifier!==U)){for(f=e.length;--f>-1&&(a=e[f]).identifier!==U;);if(0>f)return}Ea.pointerEvent=l,Ea.pointerX=a.pageX,Ea.pointerY=a.pageY}return l&&!m?(la&&(g.snap||g.bounds)&&ab(g.throwProps),ia(Ea,"release","onRelease"),I&&"touchmove"===l.type||(ia(Ea,"click","onClick"),j=l.target||l.srcElement||d,Va=A(),k=function(){Va!==sa&&Ea.enabled()&&!Ea.isPressed&&(j.click?j.click():s.createEvent&&(i=s.createEvent("MouseEvents"),i.initMouseEvent("click",!0,!0,window,1,Ea.pointerEvent.screenX,Ea.pointerEvent.screenY,Ea.pointerX,Ea.pointerY,!1,!1,!1,!1,0,null),j.dispatchEvent(i)))},I||b.delayedCall(1e-5,k))):(ab(g.throwProps),B||Ea.allowEventDefault||!l||!g.dragClickables&&Ua.call(Ea,l.target)||!m||pa&&(!qa||pa!==qa)||l.cancelable===!1||(l.preventDefault(),l.preventManipulation&&l.preventManipulation()),ia(Ea,"release","onRelease")),db()&&n.duration(Ea.tween.duration()),m&&ia(Ea,"dragend","onDragEnd"),!0}},kb=function(a){if(a&&Ea.isDragging){var b=a.target||a.srcElement||d.parentNode,c=b.scrollLeft-b._gsScrollX,e=b.scrollTop-b._gsScrollY;(c||e)&&(ka?(j-=c*ka[0]+e*ka[2],k-=e*ka[3]+c*ka[1]):(j-=c,k-=e),b._gsScrollX+=c,b._gsScrollY+=e,ib(Ea.pointerX,Ea.pointerY))}},lb=function(a){var b=A(),c=40>b-Va,d=40>b-Qa,e=c&&sa===Va,f=!!a.preventDefault,g=c&&ta===Va,h=a.isTrusted||null==a.isTrusted&&c&&e;return f&&(e||d&&Ea.vars.suppressClickOnDrag!==!1)&&a.stopImmediatePropagation(),!c||e&&h===g?void((Ea.isPressed||d||c)&&(f?h&&a.detail&&c||(a.preventDefault(),a.preventManipulation&&a.preventManipulation()):a.returnValue=!1)):(h&&e&&(ta=Va),void(sa=Va))};ca=Sa.get(this.target),ca&&ca.kill(),this.startDrag=function(a){gb(a),Ea.isDragging||(Ea.isDragging=!0,ia(Ea,"dragstart","onDragStart"))},this.drag=hb,this.endDrag=function(a){jb(a,!0)},this.timeSinceDrag=function(){return Ea.isDragging?0:(A()-Qa)/1e3},this.hitTest=function(a,b){return Sa.hitTest(Ea.target,a,b)},this.getDirection=function(a,b){var c,d,e,g,h,i,j="velocity"===a&&f?a:"object"!=typeof a||wa?"start":"element";return"element"===j&&(h=Wa(Ea.target),i=Wa(a)),c="start"===j?Ea.x-l:"velocity"===j?f.getVelocity(this.target,xa):h.left+h.width/2-(i.left+i.width/2),wa?0>c?"counter-clockwise":"clockwise":(b=b||2,d="start"===j?Ea.y-r:"velocity"===j?f.getVelocity(this.target,ya):h.top+h.height/2-(i.top+i.height/2),e=Math.abs(c/d),g=1/b>e?"":0>c?"left":"right",b>e&&(""!==g&&(g+="-"),g+=0>d?"up":"down"),g)},this.applyBounds=function(a){var b,c,e,f,h,i;if(a&&g.bounds!==a)return g.bounds=a,Ea.update(!0);if(Ya(!0),Za(),u){if(b=Ea.x,c=Ea.y,b>x?b=x:D>b&&(b=D),c>G?c=G:K>c&&(c=K),(Ea.x!==b||Ea.y!==c)&&(e=!0,Ea.x=Ea.endX=b,wa?Ea.endRotation=b:Ea.y=Ea.endY=c,aa=!0,Xa(!0),Ea.autoScroll&&!Ea.isDragging))for(Z(d.parentNode),f=d,L.scrollTop=null!=window.pageYOffset?window.pageYOffset:null!=t.scrollTop?t.scrollTop:s.body.scrollTop,L.scrollLeft=null!=window.pageXOffset?window.pageXOffset:null!=t.scrollLeft?t.scrollLeft:s.body.scrollLeft;f&&!i;)i=X(f.parentNode),h=i?L:f.parentNode,Ca&&h.scrollTop>h._gsMaxScrollY&&(h.scrollTop=h._gsMaxScrollY),za&&h.scrollLeft>h._gsMaxScrollX&&(h.scrollLeft=h._gsMaxScrollX),f=h;Ea.isThrowing&&(e||Ea.endX>x||Ea.endX<D||Ea.endY>G||Ea.endY<K)&&ab(g.throwProps,e)}return Ea},this.update=function(a,b,c){var e=Ea.x,f=Ea.y;return bb(!b),a?Ea.applyBounds():(aa&&c&&Xa(!0),Ya(!0)),b&&(ib(Ea.pointerX,Ea.pointerY),aa&&Xa(!0)),Ea.isPressed&&!b&&(za&&Math.abs(e-Ea.x)>.01||Ca&&Math.abs(f-Ea.y)>.01&&!wa)&&cb(),Ea.autoScroll&&(Z(d.parentNode),Ta=Ea.isDragging,Xa(!0)),Ea.autoScroll&&(W(d,kb),V(d,kb)),Ea},this.enable=function(a){var e,j,k;if("soft"!==a){for(j=Fa.length;--j>-1;)k=Fa[j],Ia(k,"mousedown",gb),Ia(k,"touchstart",gb),Ia(k,"click",lb,!0),wa||ba(k,"cursor",g.cursor||"move"),ba(k,"touchCallout","none"),ba(k,"touchAction",za===Ca||i?"none":za?"pan-y":"pan-x");Pa(Fa,!1)}return V(d,kb),h=!0,f&&"soft"!==a&&f.track(i||d,va?"x,y":wa?"rotation":"top,left"),i&&i.enable(),d._gsDragID=e="d"+F++,E[e]=this,i&&(i.element._gsDragID=e),b.set(d,{x:"+=0",overwrite:!1}),oa={t:d,data:B?R:d._gsTransform,tween:{},setRatio:B?function(){b.set(d,O)}:c._internals.setTransformRatio||c._internals.set3DTransformRatio},cb(),Ea.update(!0),Ea},this.disable=function(a){var b,c,e=Ea.isDragging;if(!wa)for(b=Fa.length;--b>-1;)ba(Fa[b],"cursor",null);if("soft"!==a){for(b=Fa.length;--b>-1;)c=Fa[b],ba(c,"touchCallout",null),ba(c,"touchAction",null),Ja(c,"mousedown",gb),Ja(c,"touchstart",gb),
Ja(c,"click",lb);Pa(Fa,!0),ga&&(Ja(ga,"touchcancel",jb),Ja(ga,"touchend",jb),Ja(ga,"touchmove",hb)),Ja(s,"mouseup",jb),Ja(s,"mousemove",hb)}return W(d,kb),h=!1,f&&"soft"!==a&&f.untrack(i||d,va?"x,y":wa?"rotation":"top,left"),i&&i.disable(),Q(Xa),Ea.isDragging=Ea.isPressed=fa=!1,e&&ia(Ea,"dragend","onDragEnd"),Ea},this.enabled=function(a,b){return arguments.length?a?Ea.enable(b):Ea.disable(b):h},this.kill=function(){return Ea.isThrowing=!1,b.killTweensOf(i||d,!0,La),Ea.disable(),delete E[d._gsDragID],Ea},-1!==ua.indexOf("scroll")&&(i=this.scrollProxy=new Ra(d,S({onKill:function(){Ea.isPressed&&jb(null)}},g)),d.style.overflowY=Ca&&!Ga?"auto":"hidden",d.style.overflowX=za&&!Ga?"auto":"hidden",d=i.content),g.force3D!==!1&&b.set(d,{force3D:!0}),wa?La.rotation=1:(za&&(La[xa]=1),Ca&&(La[ya]=1)),wa?(O=p,R=O.css,O.overwrite=!1):va&&(O=za&&Ca?m:za?n:o,R=O.css,O.overwrite=!1),this.enable()},Ta=Sa.prototype=new a;Ta.constructor=Sa,Ta.pointerX=Ta.pointerY=0,Ta.isDragging=Ta.isPressed=!1,Sa.version="0.14.8",Sa.zIndex=1e3,Ia(s,"touchcancel",function(){}),Ia(s,"contextmenu",function(a){var b;for(b in E)E[b].isPressed&&E[b].endDrag()}),Sa.create=function(a,c){"string"==typeof a&&(a=b.selector(a));for(var d=a&&0!==a.length?Ea(a)?Fa(a):[a]:[],e=d.length;--e>-1;)d[e]=new Sa(d[e],c);return d},Sa.get=function(a){return E[(_(a)||{})._gsDragID]},Sa.timeSinceDrag=function(){return(A()-J)/1e3};var Ua={},Va=function(a){var b,c,d=0,e=0;for(a=_(a),b=a.offsetWidth,c=a.offsetHeight;a;)d+=a.offsetTop,e+=a.offsetLeft,a=a.offsetParent;return{top:d,left:e,width:b,height:c}},Wa=function(a,b){if(a===window)return Ua.left=Ua.top=0,Ua.width=Ua.right=t.clientWidth||a.innerWidth||s.body.clientWidth||0,Ua.height=Ua.bottom=(a.innerHeight||0)-20<t.clientHeight?t.clientHeight:a.innerHeight||s.body.clientHeight||0,Ua;var c=a.pageX!==b?{left:a.pageX-U(),top:a.pageY-T(),right:a.pageX-U()+1,bottom:a.pageY-T()+1}:a.nodeType||a.left===b||a.top===b?B?Va(a):_(a).getBoundingClientRect():a;return c.right===b&&c.width!==b?(c.right=c.left+c.width,c.bottom=c.top+c.height):c.width===b&&(c={width:c.right-c.left,height:c.bottom-c.top,right:c.right,left:c.left,bottom:c.bottom,top:c.top}),c};return Sa.hitTest=function(a,b,c){if(a===b)return!1;var d,e,f,g=Wa(a),h=Wa(b),i=h.left>g.right||h.right<g.left||h.top>g.bottom||h.bottom<g.top;return i||!c?!i:(f=-1!==(c+"").indexOf("%"),c=parseFloat(c)||0,d={left:Math.max(g.left,h.left),top:Math.max(g.top,h.top)},d.width=Math.min(g.right,h.right)-d.left,d.height=Math.min(g.bottom,h.bottom)-d.top,d.width<0||d.height<0?!1:f?(c*=.01,e=d.width*d.height,e>=g.width*g.height*c||e>=h.width*h.height*c):d.width>c&&d.height>c)},C.style.cssText="visibility:hidden;height:1px;top:-1px;pointer-events:none;position:relative;clear:both;",Sa},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(a){"use strict";var b=function(){return(_gsScope.GreenSockGlobals||_gsScope)[a]};"function"==typeof define&&define.amd?define(["TweenLite","CSSPlugin"],b):"undefined"!=typeof module&&module.exports&&(require("../TweenLite.js"),require("../plugins/CSSPlugin.js"),module.exports=b())}("Draggable");/*!
 * VERSION: 0.9.9
 * DATE: 2015-04-28
 * UPDATES AND DOCS AT: http://greensock.com
 *
 * @license Copyright (c) 2008-2015, GreenSock. All rights reserved.
 * ThrowPropsPlugin is a Club GreenSock membership benefit; You must have a valid membership to use
 * this code without violating the terms of use. Visit http://greensock.com/club/ to sign up or get more details.
 * This work is subject to the software agreement that was issued with your membership.
 * 
 * @author: Jack Doyle, jack@greensock.com
 */
var _gsScope="undefined"!=typeof module&&module.exports&&"undefined"!=typeof global?global:this||window;(_gsScope._gsQueue||(_gsScope._gsQueue=[])).push(function(){"use strict";_gsScope._gsDefine("plugins.ThrowPropsPlugin",["plugins.TweenPlugin","TweenLite","easing.Ease","utils.VelocityTracker"],function(t,e,i,r){var s,n,o,a,l=function(){t.call(this,"throwProps"),this._overwriteProps.length=0},h=999999999999999,u=1e-10,f=_gsScope._gsDefine.globals,c=!1,p={x:1,y:1,z:2,scale:1,scaleX:1,scaleY:1,rotation:1,rotationZ:1,rotationX:2,rotationY:2,skewX:1,skewY:1,xPercent:1,yPercent:1},_=function(t,e,i,r){for(var s,n,o=e.length,a=0,l=h;--o>-1;)s=e[o],n=s-t,0>n&&(n=-n),l>n&&s>=r&&i>=s&&(a=o,l=n);return e[a]},d=function(t,e,i,r){if("auto"===t.end)return t;i=isNaN(i)?h:i,r=isNaN(r)?-h:r;var s="function"==typeof t.end?t.end(e):t.end instanceof Array?_(e,t.end,i,r):Number(t.end);return s>i?s=i:r>s&&(s=r),{max:s,min:s,unitFactor:t.unitFactor}},g=function(t,e,i){for(var r in e)void 0===t[r]&&r!==i&&(t[r]=e[r]);return t},m=l.calculateChange=function(t,r,s,n){null==n&&(n=.05);var o=r instanceof i?r:r?new i(r):e.defaultEase;return s*n*t/o.getRatio(n)},v=l.calculateDuration=function(t,r,s,n,o){o=o||.05;var a=n instanceof i?n:n?new i(n):e.defaultEase;return Math.abs((r-t)*a.getRatio(o)/s/o)},y=l.calculateTweenDuration=function(t,s,n,o,a,h){if("string"==typeof t&&(t=e.selector(t)),!t)return 0;null==n&&(n=10),null==o&&(o=.2),null==a&&(a=1),t.length&&(t=t[0]||t);var f,p,_,y,x,T,w,b,P,S,k=0,O=9999999999,C=s.throwProps||s,R=s.ease instanceof i?s.ease:s.ease?new i(s.ease):e.defaultEase,A=isNaN(C.checkpoint)?.05:Number(C.checkpoint),M=isNaN(C.resistance)?l.defaultResistance:Number(C.resistance);for(f in C)"resistance"!==f&&"checkpoint"!==f&&"preventOvershoot"!==f&&(p=C[f],"object"!=typeof p&&(P=P||r.getByTarget(t),P&&P.isTrackingProp(f)?p="number"==typeof p?{velocity:p}:{velocity:P.getVelocity(f)}:(y=Number(p)||0,_=y*M>0?y/M:y/-M)),"object"==typeof p&&(void 0!==p.velocity&&"number"==typeof p.velocity?y=Number(p.velocity)||0:(P=P||r.getByTarget(t),y=P&&P.isTrackingProp(f)?P.getVelocity(f):0),x=isNaN(p.resistance)?M:Number(p.resistance),_=y*x>0?y/x:y/-x,T="function"==typeof t[f]?t[f.indexOf("set")||"function"!=typeof t["get"+f.substr(3)]?f:"get"+f.substr(3)]():t[f]||0,w=T+m(y,R,_,A),void 0!==p.end&&(p=d(p,w,p.max,p.min),(h||c)&&(C[f]=g(p,C[f],"end"))),void 0!==p.max&&w>Number(p.max)+u?(S=p.unitFactor||l.defaultUnitFactors[f]||1,b=T>p.max&&p.min!==p.max||y*S>-15&&45>y*S?o+.1*(n-o):v(T,p.max,y,R,A),O>b+a&&(O=b+a)):void 0!==p.min&&Number(p.min)-u>w&&(S=p.unitFactor||l.defaultUnitFactors[f]||1,b=p.min>T&&p.min!==p.max||y*S>-45&&15>y*S?o+.1*(n-o):v(T,p.min,y,R,A),O>b+a&&(O=b+a)),b>k&&(k=b)),_>k&&(k=_));return k>O&&(k=O),k>n?n:o>k?o:k},x=l.prototype=new t("throwProps");return x.constructor=l,l.version="0.9.9",l.API=2,l._autoCSS=!0,l.defaultResistance=100,l.defaultUnitFactors={time:1e3,totalTime:1e3},l.track=function(t,e,i){return r.track(t,e,i)},l.untrack=function(t,e){r.untrack(t,e)},l.isTracking=function(t,e){return r.isTracking(t,e)},l.getVelocity=function(t,e){var i=r.getByTarget(t);return i?i.getVelocity(e):0/0},l._cssRegister=function(){var t=f.com.greensock.plugins.CSSPlugin;if(t){var e=t._internals,i=e._parseToProxy,o=e._setPluginRatio,a=e.CSSPropTween;e._registerComplexSpecialProp("throwProps",{parser:function(t,e,h,u,f,c){c=new l;var _,d,g,m,v,y={},x={},T={},w={},b={},P={};n={};for(g in e)"resistance"!==g&&"preventOvershoot"!==g&&(d=e[g],"object"==typeof d?(void 0!==d.velocity&&"number"==typeof d.velocity?y[g]=Number(d.velocity)||0:(v=v||r.getByTarget(t),y[g]=v&&v.isTrackingProp(g)?v.getVelocity(g):0),void 0!==d.end&&(w[g]=d.end),void 0!==d.min&&(x[g]=d.min),void 0!==d.max&&(T[g]=d.max),d.preventOvershoot&&(P[g]=!0),void 0!==d.resistance&&(_=!0,b[g]=d.resistance)):"number"==typeof d?y[g]=d:(v=v||r.getByTarget(t),y[g]=v&&v.isTrackingProp(g)?v.getVelocity(g):d||0),p[g]&&u._enableTransforms(2===p[g]));m=i(t,y,u,f,c),s=m.proxy,y=m.end;for(g in s)n[g]={velocity:y[g],min:x[g],max:T[g],end:w[g],resistance:b[g],preventOvershoot:P[g]};return null!=e.resistance&&(n.resistance=e.resistance),e.preventOvershoot&&(n.preventOvershoot=!0),f=new a(t,"throwProps",0,0,m.pt,2),u._overwriteProps.pop(),f.plugin=c,f.setRatio=o,f.data=m,c._onInitTween(s,n,u._tween),f}})}},l.to=function(t,i,r,l,h){i.throwProps||(i={throwProps:i}),0===h&&(i.throwProps.preventOvershoot=!0),c=!0;var u=new e(t,l||1,i);return u.render(0,!0,!0),u.vars.css?(u.duration(y(s,{throwProps:n,ease:i.ease},r,l,h)),u._delay&&!u.vars.immediateRender?u.invalidate():o._onInitTween(s,a,u),c=!1,u):(u.kill(),u=new e(t,y(t,i,r,l,h),i),c=!1,u)},x._onInitTween=function(t,e,i){this.target=t,this._props=[],o=this,a=e;var s,n,l,h,u,f,p,_,v,y=i._ease,x=isNaN(e.checkpoint)?.05:Number(e.checkpoint),T=i._duration,w=e.preventOvershoot,b=0;for(s in e)if("resistance"!==s&&"checkpoint"!==s&&"preventOvershoot"!==s){if(n=e[s],"number"==typeof n)u=Number(n)||0;else if("object"!=typeof n||isNaN(n.velocity)){if(v=v||r.getByTarget(t),!v||!v.isTrackingProp(s))throw"ERROR: No velocity was defined in the throwProps tween of "+t+" property: "+s;u=v.getVelocity(s)}else u=Number(n.velocity);f=m(u,y,T,x),_=0,h="function"==typeof t[s],l=h?t[s.indexOf("set")||"function"!=typeof t["get"+s.substr(3)]?s:"get"+s.substr(3)]():t[s],"object"==typeof n&&(p=l+f,void 0!==n.end&&(n=d(n,p,n.max,n.min),c&&(e[s]=g(n,e[s],"end"))),void 0!==n.max&&p>Number(n.max)?w||n.preventOvershoot?f=n.max-l:_=n.max-l-f:void 0!==n.min&&Number(n.min)>p&&(w||n.preventOvershoot?f=n.min-l:_=n.min-l-f)),this._overwriteProps[b]=s,this._props[b++]={p:s,s:l,c1:f,c2:_,f:h,r:!1}}return!0},x._kill=function(e){for(var i=this._props.length;--i>-1;)null!=e[this._props[i].p]&&this._props.splice(i,1);return t.prototype._kill.call(this,e)},x._roundProps=function(t,e){for(var i=this._props,r=i.length;--r>-1;)(t[i[r].p]||t.throwProps)&&(i[r].r=e)},x.setRatio=function(t){for(var e,i,r=this._props.length;--r>-1;)e=this._props[r],i=e.s+e.c1*t+e.c2*t*t,e.r&&(i=Math.round(i)),e.f?this.target[e.p](i):this.target[e.p]=i},t.activate([l]),l},!0),_gsScope._gsDefine("utils.VelocityTracker",["TweenLite"],function(t){var e,i,r,s,n=/([A-Z])/g,o={},a={x:1,y:1,z:2,scale:1,scaleX:1,scaleY:1,rotation:1,rotationZ:1,rotationX:2,rotationY:2,skewX:1,skewY:1,xPercent:1,yPercent:1},l=document.defaultView?document.defaultView.getComputedStyle:function(){},h=function(t,e,i){var r=(t._gsTransform||o)[e];return r||0===r?r:(t.style[e]?r=t.style[e]:(i=i||l(t,null))?r=i[e]||i.getPropertyValue(e)||i.getPropertyValue(e.replace(n,"-$1").toLowerCase()):t.currentStyle&&(r=t.currentStyle[e]),parseFloat(r)||0)},u=t.ticker,f=function(t,e,i){this.p=t,this.f=e,this.v1=this.v2=0,this.t1=this.t2=u.time,this.css=!1,this.type="",this._prev=null,i&&(this._next=i,i._prev=this)},c=function(){var t,i,n=e,o=u.time;if(o-r>=.03)for(s=r,r=o;n;){for(i=n._firstVP;i;)t=i.css?h(n.target,i.p):i.f?n.target[i.p]():n.target[i.p],(t!==i.v1||o-i.t1>.15)&&(i.v2=i.v1,i.v1=t,i.t2=i.t1,i.t1=o),i=i._next;n=n._next}},p=function(t){this._lookup={},this.target=t,this.elem=t.style&&t.nodeType?!0:!1,i||(u.addEventListener("tick",c,null,!1,-100),r=s=u.time,i=!0),e&&(this._next=e,e._prev=this),e=this},_=p.getByTarget=function(t){for(var i=e;i;){if(i.target===t)return i;i=i._next}},d=p.prototype;return d.addProp=function(e,i){if(!this._lookup[e]){var r=this.target,s="function"==typeof r[e],n=s?this._altProp(e):e,o=this._firstVP;this._firstVP=this._lookup[e]=this._lookup[n]=o=new f(n!==e&&0===e.indexOf("set")?n:e,s,o),o.css=this.elem&&(void 0!==this.target.style[o.p]||a[o.p]),o.css&&a[o.p]&&!r._gsTransform&&t.set(r,{x:"+=0",overwrite:!1}),o.type=i||o.css&&0===e.indexOf("rotation")?"deg":"",o.v1=o.v2=o.css?h(r,o.p):s?r[o.p]():r[o.p]}},d.removeProp=function(t){var e=this._lookup[t];e&&(e._prev?e._prev._next=e._next:e===this._firstVP&&(this._firstVP=e._next),e._next&&(e._next._prev=e._prev),this._lookup[t]=0,e.f&&(this._lookup[this._altProp(t)]=0))},d.isTrackingProp=function(t){return this._lookup[t]instanceof f},d.getVelocity=function(t){var e,i,r,s=this._lookup[t],n=this.target;if(!s)throw"The velocity of "+t+" is not being tracked.";return e=s.css?h(n,s.p):s.f?n[s.p]():n[s.p],i=e-s.v2,("rad"===s.type||"deg"===s.type)&&(r="rad"===s.type?2*Math.PI:360,i%=r,i!==i%(r/2)&&(i=0>i?i+r:i-r)),i/(u.time-s.t2)},d._altProp=function(t){var e=t.substr(0,3),i=("get"===e?"set":"set"===e?"get":e)+t.substr(3);return"function"==typeof this.target[i]?i:t},p.getByTarget=function(i){var r=e;for("string"==typeof i&&(i=t.selector(i)),i.length&&i!==window&&i[0]&&i[0].style&&!i.nodeType&&(i=i[0]);r;){if(r.target===i)return r;r=r._next}},p.track=function(t,e,i){var r=_(t),s=e.split(","),n=s.length;for(i=(i||"").split(","),r||(r=new p(t));--n>-1;)r.addProp(s[n],i[n]||i[0]);return r},p.untrack=function(t,i){var r=_(t),s=(i||"").split(","),n=s.length;if(r){for(;--n>-1;)r.removeProp(s[n]);r._firstVP&&i||(r._prev?r._prev._next=r._next:r===e&&(e=r._next),r._next&&(r._next._prev=r._prev))}},p.isTracking=function(t,e){var i=_(t);return i?!e&&i._firstVP?!0:i.isTrackingProp(e):!1},p},!0)}),_gsScope._gsDefine&&_gsScope._gsQueue.pop()(),function(t){"use strict";var e=function(){return(_gsScope.GreenSockGlobals||_gsScope)[t]};"function"==typeof define&&define.amd?define(["TweenLite"],e):"undefined"!=typeof module&&module.exports&&(require("../TweenLite.js"),module.exports=e())}("ThrowPropsPlugin");/**
 * @fileoverview Main function src.
 */

// HTML5 Shiv. Must be in <head> to support older browsers.
document.createElement('video');
document.createElement('audio');
document.createElement('track');

/**
 * Doubles as the main function for users to create a player instance and also
 * the main library object.
 *
 * @param  {String|Element} id      Video element or video element ID
 * @param  {Object=} options        Optional options object for config/settings
 * @param  {Function=} ready        Optional ready callback
 * @return {vjs.Player}             A player instance
 */
var vjs = function(id, options, ready){
  var tag; // Element of ID

  // Allow for element or ID to be passed in
  // String ID
  if (typeof id === 'string') {

    // Adjust for jQuery ID syntax
    if (id.indexOf('#') === 0) {
      id = id.slice(1);
    }

    // If a player instance has already been created for this ID return it.
    if (vjs.players[id]) {
      return vjs.players[id];

    // Otherwise get element for ID
    } else {
      tag = vjs.el(id);
    }

  // ID is a media element
  } else {
    tag = id;
  }

  // Check for a useable element
  if (!tag || !tag.nodeName) { // re: nodeName, could be a box div also
    throw new TypeError('The element or ID supplied is not valid. (videojs)'); // Returns
  }

  // Element may have a player attr referring to an already created player instance.
  // If not, set up a new player and return the instance.
  return tag['player'] || new vjs.Player(tag, options, ready);
};

// Extended name, also available externally, window.videojs
var videojs = vjs;
window.videojs = window.vjs = vjs;

// CDN Version. Used to target right flash swf.
vjs.CDN_VERSION = '4.2';
vjs.ACCESS_PROTOCOL = ('https:' == document.location.protocol ? 'https://' : 'http://');

/**
 * Global Player instance options, surfaced from vjs.Player.prototype.options_
 * vjs.options = vjs.Player.prototype.options_
 * All options should use string keys so they avoid
 * renaming by closure compiler
 * @type {Object}
 */
vjs.options = {
  // Default order of fallback technology
  'techOrder': ['html5','flash'],
  // techOrder: ['flash','html5'],

  'html5': {},
  'flash': {},

  // Default of web browser is 300x150. Should rely on source width/height.
  'width': 300,
  'height': 150,
  // defaultVolume: 0.85,
  'defaultVolume': 0.00, // The freakin seaguls are driving me crazy!

  // Included control sets
  'children': {
    'mediaLoader': {},
    'posterImage': {},
    'textTrackDisplay': {},
    'loadingSpinner': {},
    'bigPlayButton': {},
    'controlBar': {}
  },

  // Default message to show when a video cannot be played.
  'notSupportedMessage': 'Sorry, no compatible source and playback ' +
      'technology were found for this video. Try using another browser ' +
      'like <a href="http://bit.ly/ccMUEC">Chrome</a> or download the ' +
      'latest <a href="http://adobe.ly/mwfN1">Adobe Flash Player</a>.'
};

// Set CDN Version of swf
// The added (+) blocks the replace from changing this 4.2 string
if (vjs.CDN_VERSION !== 'GENERATED'+'_CDN_VSN') {
  videojs.options['flash']['swf'] = vjs.ACCESS_PROTOCOL + 'vjs.zencdn.net/'+vjs.CDN_VERSION+'/video-js.swf';
}

/**
 * Global player list
 * @type {Object}
 */
vjs.players = {};
/**
 * Core Object/Class for objects that use inheritance + contstructors
 * @constructor
 */
vjs.CoreObject = vjs['CoreObject'] = function(){};
// Manually exporting vjs['CoreObject'] here for Closure Compiler
// because of the use of the extend/create class methods
// If we didn't do this, those functions would get flattend to something like
// `a = ...` and `this.prototype` would refer to the global object instead of
// CoreObject

/**
 * Create a new object that inherits from this Object
 * @param {Object} props Functions and properties to be applied to the
 *                       new object's prototype
 * @return {vjs.CoreObject} Returns an object that inherits from CoreObject
 * @this {*}
 */
vjs.CoreObject.extend = function(props){
  var init, subObj;

  props = props || {};
  // Set up the constructor using the supplied init method
  // or using the init of the parent object
  // Make sure to check the unobfuscated version for external libs
  init = props['init'] || props.init || this.prototype['init'] || this.prototype.init || function(){};
  // In Resig's simple class inheritance (previously used) the constructor
  //  is a function that calls `this.init.apply(arguments)`
  // However that would prevent us from using `ParentObject.call(this);`
  //  in a Child constuctor because the `this` in `this.init`
  //  would still refer to the Child and cause an inifinite loop.
  // We would instead have to do
  //    `ParentObject.prototype.init.apply(this, argumnents);`
  //  Bleh. We're not creating a _super() function, so it's good to keep
  //  the parent constructor reference simple.
  subObj = function(){
    init.apply(this, arguments);
  };

  // Inherit from this object's prototype
  subObj.prototype = vjs.obj.create(this.prototype);
  // Reset the constructor property for subObj otherwise
  // instances of subObj would have the constructor of the parent Object
  subObj.prototype.constructor = subObj;

  // Make the class extendable
  subObj.extend = vjs.CoreObject.extend;
  // Make a function for creating instances
  subObj.create = vjs.CoreObject.create;

  // Extend subObj's prototype with functions and other properties from props
  for (var name in props) {
    if (props.hasOwnProperty(name)) {
      subObj.prototype[name] = props[name];
    }
  }

  return subObj;
};

/**
 * Create a new instace of this Object class
 * @return {vjs.CoreObject} Returns an instance of a CoreObject subclass
 * @this {*}
 */
vjs.CoreObject.create = function(){
  // Create a new object that inherits from this object's prototype
  var inst = vjs.obj.create(this.prototype);

  // Apply this constructor function to the new object
  this.apply(inst, arguments);

  // Return the new object
  return inst;
};
/**
 * @fileoverview Event System (John Resig - Secrets of a JS Ninja http://jsninja.com/)
 * (Original book version wasn't completely usable, so fixed some things and made Closure Compiler compatible)
 * This should work very similarly to jQuery's events, however it's based off the book version which isn't as
 * robust as jquery's, so there's probably some differences.
 */

/**
 * Add an event listener to element
 * It stores the handler function in a separate cache object
 * and adds a generic handler to the element's event,
 * along with a unique id (guid) to the element.
 * @param  {Element|Object}   elem Element or object to bind listeners to
 * @param  {String}   type Type of event to bind to.
 * @param  {Function} fn   Event listener.
 */
vjs.on = function(elem, type, fn){
  var data = vjs.getData(elem);

  // We need a place to store all our handler data
  if (!data.handlers) data.handlers = {};

  if (!data.handlers[type]) data.handlers[type] = [];

  if (!fn.guid) fn.guid = vjs.guid++;

  data.handlers[type].push(fn);

  if (!data.dispatcher) {
    data.disabled = false;

    data.dispatcher = function (event){

      if (data.disabled) return;
      event = vjs.fixEvent(event);

      var handlers = data.handlers[event.type];

      if (handlers) {
        // Copy handlers so if handlers are added/removed during the process it doesn't throw everything off.
        var handlersCopy = handlers.slice(0);

        for (var m = 0, n = handlersCopy.length; m < n; m++) {
          if (event.isImmediatePropagationStopped()) {
            break;
          } else {
            handlersCopy[m].call(elem, event);
          }
        }
      }
    };
  }

  if (data.handlers[type].length == 1) {
    if (document.addEventListener) {
      elem.addEventListener(type, data.dispatcher, false);
    } else if (document.attachEvent) {
      elem.attachEvent('on' + type, data.dispatcher);
    }
  }
};

/**
 * Removes event listeners from an element
 * @param  {Element|Object}   elem Object to remove listeners from
 * @param  {String=}   type Type of listener to remove. Don't include to remove all events from element.
 * @param  {Function} fn   Specific listener to remove. Don't incldue to remove listeners for an event type.
 */
vjs.off = function(elem, type, fn) {
  // Don't want to add a cache object through getData if not needed
  if (!vjs.hasData(elem)) return;

  var data = vjs.getData(elem);

  // If no events exist, nothing to unbind
  if (!data.handlers) { return; }

  // Utility function
  var removeType = function(t){
     data.handlers[t] = [];
     vjs.cleanUpEvents(elem,t);
  };

  // Are we removing all bound events?
  if (!type) {
    for (var t in data.handlers) removeType(t);
    return;
  }

  var handlers = data.handlers[type];

  // If no handlers exist, nothing to unbind
  if (!handlers) return;

  // If no listener was provided, remove all listeners for type
  if (!fn) {
    removeType(type);
    return;
  }

  // We're only removing a single handler
  if (fn.guid) {
    for (var n = 0; n < handlers.length; n++) {
      if (handlers[n].guid === fn.guid) {
        handlers.splice(n--, 1);
      }
    }
  }

  vjs.cleanUpEvents(elem, type);
};

/**
 * Clean up the listener cache and dispatchers
 * @param  {Element|Object} elem Element to clean up
 * @param  {String} type Type of event to clean up
 */
vjs.cleanUpEvents = function(elem, type) {
  var data = vjs.getData(elem);

  // Remove the events of a particular type if there are none left
  if (data.handlers[type].length === 0) {
    delete data.handlers[type];
    // data.handlers[type] = null;
    // Setting to null was causing an error with data.handlers

    // Remove the meta-handler from the element
    if (document.removeEventListener) {
      elem.removeEventListener(type, data.dispatcher, false);
    } else if (document.detachEvent) {
      elem.detachEvent('on' + type, data.dispatcher);
    }
  }

  // Remove the events object if there are no types left
  if (vjs.isEmpty(data.handlers)) {
    delete data.handlers;
    delete data.dispatcher;
    delete data.disabled;

    // data.handlers = null;
    // data.dispatcher = null;
    // data.disabled = null;
  }

  // Finally remove the expando if there is no data left
  if (vjs.isEmpty(data)) {
    vjs.removeData(elem);
  }
};

/**
 * Fix a native event to have standard property values
 * @param  {Object} event Event object to fix
 * @return {Object}
 */
vjs.fixEvent = function(event) {

  function returnTrue() { return true; }
  function returnFalse() { return false; }

  // Test if fixing up is needed
  // Used to check if !event.stopPropagation instead of isPropagationStopped
  // But native events return true for stopPropagation, but don't have
  // other expected methods like isPropagationStopped. Seems to be a problem
  // with the Javascript Ninja code. So we're just overriding all events now.
  if (!event || !event.isPropagationStopped) {
    var old = event || window.event;

    event = {};
    // Clone the old object so that we can modify the values event = {};
    // IE8 Doesn't like when you mess with native event properties
    // Firefox returns false for event.hasOwnProperty('type') and other props
    //  which makes copying more difficult.
    // TODO: Probably best to create a whitelist of event props
    for (var key in old) {
      // Safari 6.0.3 warns you if you try to copy deprecated layerX/Y
      if (key !== 'layerX' && key !== 'layerY') {
        event[key] = old[key];
      }
    }

    // The event occurred on this element
    if (!event.target) {
      event.target = event.srcElement || document;
    }

    // Handle which other element the event is related to
    event.relatedTarget = event.fromElement === event.target ?
      event.toElement :
      event.fromElement;

    // Stop the default browser action
    event.preventDefault = function () {
      if (old.preventDefault) {
        old.preventDefault();
      }
      event.returnValue = false;
      event.isDefaultPrevented = returnTrue;
    };

    event.isDefaultPrevented = returnFalse;

    // Stop the event from bubbling
    event.stopPropagation = function () {
      if (old.stopPropagation) {
        old.stopPropagation();
      }
      event.cancelBubble = true;
      event.isPropagationStopped = returnTrue;
    };

    event.isPropagationStopped = returnFalse;

    // Stop the event from bubbling and executing other handlers
    event.stopImmediatePropagation = function () {
      if (old.stopImmediatePropagation) {
        old.stopImmediatePropagation();
      }
      event.isImmediatePropagationStopped = returnTrue;
      event.stopPropagation();
    };

    event.isImmediatePropagationStopped = returnFalse;

    // Handle mouse position
    if (event.clientX != null) {
      var doc = document.documentElement, body = document.body;

      event.pageX = event.clientX +
        (doc && doc.scrollLeft || body && body.scrollLeft || 0) -
        (doc && doc.clientLeft || body && body.clientLeft || 0);
      event.pageY = event.clientY +
        (doc && doc.scrollTop || body && body.scrollTop || 0) -
        (doc && doc.clientTop || body && body.clientTop || 0);
    }

    // Handle key presses
    event.which = event.charCode || event.keyCode;

    // Fix button for mouse clicks:
    // 0 == left; 1 == middle; 2 == right
    if (event.button != null) {
      event.button = (event.button & 1 ? 0 :
        (event.button & 4 ? 1 :
          (event.button & 2 ? 2 : 0)));
    }
  }

  // Returns fixed-up instance
  return event;
};

/**
 * Trigger an event for an element
 * @param  {Element|Object} elem  Element to trigger an event on
 * @param  {String} event Type of event to trigger
 */
vjs.trigger = function(elem, event) {
  // Fetches element data and a reference to the parent (for bubbling).
  // Don't want to add a data object to cache for every parent,
  // so checking hasData first.
  var elemData = (vjs.hasData(elem)) ? vjs.getData(elem) : {};
  var parent = elem.parentNode || elem.ownerDocument;
      // type = event.type || event,
      // handler;

  // If an event name was passed as a string, creates an event out of it
  if (typeof event === 'string') {
    event = { type:event, target:elem };
  }
  // Normalizes the event properties.
  event = vjs.fixEvent(event);

  // If the passed element has a dispatcher, executes the established handlers.
  if (elemData.dispatcher) {
    elemData.dispatcher.call(elem, event);
  }

  // Unless explicitly stopped or the event does not bubble (e.g. media events)
    // recursively calls this function to bubble the event up the DOM.
    if (parent && !event.isPropagationStopped() && event.bubbles !== false) {
    vjs.trigger(parent, event);

  // If at the top of the DOM, triggers the default action unless disabled.
  } else if (!parent && !event.isDefaultPrevented()) {
    var targetData = vjs.getData(event.target);

    // Checks if the target has a default action for this event.
    if (event.target[event.type]) {
      // Temporarily disables event dispatching on the target as we have already executed the handler.
      targetData.disabled = true;
      // Executes the default action.
      if (typeof event.target[event.type] === 'function') {
        event.target[event.type]();
      }
      // Re-enables event dispatching.
      targetData.disabled = false;
    }
  }

  // Inform the triggerer if the default was prevented by returning false
  return !event.isDefaultPrevented();
  /* Original version of js ninja events wasn't complete.
   * We've since updated to the latest version, but keeping this around
   * for now just in case.
   */
  // // Added in attion to book. Book code was broke.
  // event = typeof event === 'object' ?
  //   event[vjs.expando] ?
  //     event :
  //     new vjs.Event(type, event) :
  //   new vjs.Event(type);

  // event.type = type;
  // if (handler) {
  //   handler.call(elem, event);
  // }

  // // Clean up the event in case it is being reused
  // event.result = undefined;
  // event.target = elem;
};

/**
 * Trigger a listener only once for an event
 * @param  {Element|Object}   elem Element or object to
 * @param  {[type]}   type [description]
 * @param  {Function} fn   [description]
 * @return {[type]}
 */
vjs.one = function(elem, type, fn) {
  var func = function(){
    vjs.off(elem, type, func);
    fn.apply(this, arguments);
  };
  func.guid = fn.guid = fn.guid || vjs.guid++;
  vjs.on(elem, type, func);
};
var hasOwnProp = Object.prototype.hasOwnProperty;

/**
 * Creates an element and applies properties.
 * @param  {String=} tagName    Name of tag to be created.
 * @param  {Object=} properties Element properties to be applied.
 * @return {Element}
 */
vjs.createEl = function(tagName, properties){
  var el, propName;

  el = document.createElement(tagName || 'div');

  for (propName in properties){
    if (hasOwnProp.call(properties, propName)) {
      //el[propName] = properties[propName];
      // Not remembering why we were checking for dash
      // but using setAttribute means you have to use getAttribute

      // The check for dash checks for the aria-* attributes, like aria-label, aria-valuemin.
      // The additional check for "role" is because the default method for adding attributes does not
      // add the attribute "role". My guess is because it's not a valid attribute in some namespaces, although
      // browsers handle the attribute just fine. The W3C allows for aria-* attributes to be used in pre-HTML5 docs.
      // http://www.w3.org/TR/wai-aria-primer/#ariahtml. Using setAttribute gets around this problem.

       if (propName.indexOf('aria-') !== -1 || propName=='role') {
         el.setAttribute(propName, properties[propName]);
       } else {
         el[propName] = properties[propName];
       }
    }
  }
  return el;
};

/**
 * Uppercase the first letter of a string
 * @param  {String} string String to be uppercased
 * @return {String}
 */
vjs.capitalize = function(string){
  return string.charAt(0).toUpperCase() + string.slice(1);
};

/**
 * Object functions container
 * @type {Object}
 */
vjs.obj = {};

/**
 * Object.create shim for prototypal inheritance.
 * https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/create
 * @param  {Object}   obj Object to use as prototype
 */
 vjs.obj.create = Object.create || function(obj){
  //Create a new function called 'F' which is just an empty object.
  function F() {}

  //the prototype of the 'F' function should point to the
  //parameter of the anonymous function.
  F.prototype = obj;

  //create a new constructor function based off of the 'F' function.
  return new F();
};

/**
 * Loop through each property in an object and call a function
 * whose arguments are (key,value)
 * @param  {Object}   obj Object of properties
 * @param  {Function} fn  Function to be called on each property.
 * @this {*}
 */
vjs.obj.each = function(obj, fn, context){
  for (var key in obj) {
    if (hasOwnProp.call(obj, key)) {
      fn.call(context || this, key, obj[key]);
    }
  }
};

/**
 * Merge two objects together and return the original.
 * @param  {Object} obj1
 * @param  {Object} obj2
 * @return {Object}
 */
vjs.obj.merge = function(obj1, obj2){
  if (!obj2) { return obj1; }
  for (var key in obj2){
    if (hasOwnProp.call(obj2, key)) {
      obj1[key] = obj2[key];
    }
  }
  return obj1;
};

/**
 * Merge two objects, and merge any properties that are objects
 * instead of just overwriting one. Uses to merge options hashes
 * where deeper default settings are important.
 * @param  {Object} obj1 Object to override
 * @param  {Object} obj2 Overriding object
 * @return {Object}      New object. Obj1 and Obj2 will be untouched.
 */
vjs.obj.deepMerge = function(obj1, obj2){
  var key, val1, val2;

  // make a copy of obj1 so we're not ovewriting original values.
  // like prototype.options_ and all sub options objects
  obj1 = vjs.obj.copy(obj1);

  for (key in obj2){
    if (hasOwnProp.call(obj2, key)) {
      val1 = obj1[key];
      val2 = obj2[key];

      // Check if both properties are pure objects and do a deep merge if so
      if (vjs.obj.isPlain(val1) && vjs.obj.isPlain(val2)) {
        obj1[key] = vjs.obj.deepMerge(val1, val2);
      } else {
        obj1[key] = obj2[key];
      }
    }
  }
  return obj1;
};

/**
 * Make a copy of the supplied object
 * @param  {Object} obj Object to copy
 * @return {Object}     Copy of object
 */
vjs.obj.copy = function(obj){
  return vjs.obj.merge({}, obj);
};

/**
 * Check if an object is plain, and not a dom node or any object sub-instance
 * @param  {Object} obj Object to check
 * @return {Boolean}     True if plain, false otherwise
 */
vjs.obj.isPlain = function(obj){
  return !!obj
    && typeof obj === 'object'
    && obj.toString() === '[object Object]'
    && obj.constructor === Object;
};

/**
 * Bind (a.k.a proxy or Context). A simple method for changing the context of a function
   It also stores a unique id on the function so it can be easily removed from events
 * @param  {*}   context The object to bind as scope
 * @param  {Function} fn      The function to be bound to a scope
 * @param  {Number=}   uid     An optional unique ID for the function to be set
 * @return {Function}
 */
vjs.bind = function(context, fn, uid) {
  // Make sure the function has a unique ID
  if (!fn.guid) { fn.guid = vjs.guid++; }

  // Create the new function that changes the context
  var ret = function() {
    return fn.apply(context, arguments);
  };

  // Allow for the ability to individualize this function
  // Needed in the case where multiple objects might share the same prototype
  // IF both items add an event listener with the same function, then you try to remove just one
  // it will remove both because they both have the same guid.
  // when using this, you need to use the bind method when you remove the listener as well.
  // currently used in text tracks
  ret.guid = (uid) ? uid + '_' + fn.guid : fn.guid;

  return ret;
};

/**
 * Element Data Store. Allows for binding data to an element without putting it directly on the element.
 * Ex. Event listneres are stored here.
 * (also from jsninja.com, slightly modified and updated for closure compiler)
 * @type {Object}
 */
vjs.cache = {};

/**
 * Unique ID for an element or function
 * @type {Number}
 */
vjs.guid = 1;

/**
 * Unique attribute name to store an element's guid in
 * @type {String}
 * @constant
 */
vjs.expando = 'vdata' + (new Date()).getTime();

/**
 * Returns the cache object where data for an element is stored
 * @param  {Element} el Element to store data for.
 * @return {Object}
 */
vjs.getData = function(el){
  var id = el[vjs.expando];
  if (!id) {
    id = el[vjs.expando] = vjs.guid++;
    vjs.cache[id] = {};
  }
  return vjs.cache[id];
};

/**
 * Returns the cache object where data for an element is stored
 * @param  {Element} el Element to store data for.
 * @return {Object}
 */
vjs.hasData = function(el){
  var id = el[vjs.expando];
  return !(!id || vjs.isEmpty(vjs.cache[id]));
};

/**
 * Delete data for the element from the cache and the guid attr from getElementById
 * @param  {Element} el Remove data for an element
 */
vjs.removeData = function(el){
  var id = el[vjs.expando];
  if (!id) { return; }
  // Remove all stored data
  // Changed to = null
  // http://coding.smashingmagazine.com/2012/11/05/writing-fast-memory-efficient-javascript/
  // vjs.cache[id] = null;
  delete vjs.cache[id];

  // Remove the expando property from the DOM node
  try {
    delete el[vjs.expando];
  } catch(e) {
    if (el.removeAttribute) {
      el.removeAttribute(vjs.expando);
    } else {
      // IE doesn't appear to support removeAttribute on the document element
      el[vjs.expando] = null;
    }
  }
};

vjs.isEmpty = function(obj) {
  for (var prop in obj) {
    // Inlude null properties as empty.
    if (obj[prop] !== null) {
      return false;
    }
  }
  return true;
};

/**
 * Add a CSS class name to an element
 * @param {Element} element    Element to add class name to
 * @param {String} classToAdd Classname to add
 */
vjs.addClass = function(element, classToAdd){
  if ((' '+element.className+' ').indexOf(' '+classToAdd+' ') == -1) {
    element.className = element.className === '' ? classToAdd : element.className + ' ' + classToAdd;
  }
};

/**
 * Remove a CSS class name from an element
 * @param {Element} element    Element to remove from class name
 * @param {String} classToAdd Classname to remove
 */
vjs.removeClass = function(element, classToRemove){
  var classNames, i;

  if (element.className.indexOf(classToRemove) == -1) { return; }

  classNames = element.className.split(' ');

  // no arr.indexOf in ie8, and we don't want to add a big shim
  for (i = classNames.length - 1; i >= 0; i--) {
    if (classNames[i] === classToRemove) {
      classNames.splice(i,1);
    }
  }

  element.className = classNames.join(' ');
};

/**
 * Element for testing browser HTML5 video capabilities
 * @type {Element}
 * @constant
 */
vjs.TEST_VID = vjs.createEl('video');

/**
 * Useragent for browser testing.
 * @type {String}
 * @constant
 */
vjs.USER_AGENT = navigator.userAgent;

/**
 * Device is an iPhone
 * @type {Boolean}
 * @constant
 */
vjs.IS_IPHONE = (/iPhone/i).test(vjs.USER_AGENT);
vjs.IS_IPAD = (/iPad/i).test(vjs.USER_AGENT);
vjs.IS_IPOD = (/iPod/i).test(vjs.USER_AGENT);
vjs.IS_IOS = vjs.IS_IPHONE || vjs.IS_IPAD || vjs.IS_IPOD;

vjs.IOS_VERSION = (function(){
  var match = vjs.USER_AGENT.match(/OS (\d+)_/i);
  if (match && match[1]) { return match[1]; }
})();

vjs.IS_ANDROID = (/Android/i).test(vjs.USER_AGENT);
vjs.ANDROID_VERSION = (function() {
  // This matches Android Major.Minor.Patch versions
  // ANDROID_VERSION is Major.Minor as a Number, if Minor isn't available, then only Major is returned
  var match = vjs.USER_AGENT.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i),
    major,
    minor;

  if (!match) {
    return null;
  }

  major = match[1] && parseFloat(match[1]);
  minor = match[2] && parseFloat(match[2]);

  if (major && minor) {
    return parseFloat(match[1] + '.' + match[2]);
  } else if (major) {
    return major;
  } else {
    return null;
  }
})();
// Old Android is defined as Version older than 2.3, and requiring a webkit version of the android browser
vjs.IS_OLD_ANDROID = vjs.IS_ANDROID && (/webkit/i).test(vjs.USER_AGENT) && vjs.ANDROID_VERSION < 2.3;

vjs.IS_FIREFOX = (/Firefox/i).test(vjs.USER_AGENT);
vjs.IS_CHROME = (/Chrome/i).test(vjs.USER_AGENT);

vjs.TOUCH_ENABLED = ('ontouchstart' in window);

/**
 * Get an element's attribute values, as defined on the HTML tag
 * Attributs are not the same as properties. They're defined on the tag
 * or with setAttribute (which shouldn't be used with HTML)
 * This will return true or false for boolean attributes.
 * @param  {Element} tag Element from which to get tag attributes
 * @return {Object}
 */
vjs.getAttributeValues = function(tag){
  var obj, knownBooleans, attrs, attrName, attrVal;

  obj = {};

  // known boolean attributes
  // we can check for matching boolean properties, but older browsers
  // won't know about HTML5 boolean attributes that we still read from
  knownBooleans = ','+'autoplay,controls,loop,muted,default'+',';

  if (tag && tag.attributes && tag.attributes.length > 0) {
    attrs = tag.attributes;

    for (var i = attrs.length - 1; i >= 0; i--) {
      attrName = attrs[i].name;
      attrVal = attrs[i].value;

      // check for known booleans
      // the matching element property will return a value for typeof
      if (typeof tag[attrName] === 'boolean' || knownBooleans.indexOf(','+attrName+',') !== -1) {
        // the value of an included boolean attribute is typically an empty
        // string ('') which would equal false if we just check for a false value.
        // we also don't want support bad code like autoplay='false'
        attrVal = (attrVal !== null) ? true : false;
      }

      obj[attrName] = attrVal;
    }
  }

  return obj;
};

/**
 * Get the computed style value for an element
 * From http://robertnyman.com/2006/04/24/get-the-rendered-style-of-an-element/
 * @param  {Element} el        Element to get style value for
 * @param  {String} strCssRule Style name
 * @return {String}            Style value
 */
vjs.getComputedDimension = function(el, strCssRule){
  var strValue = '';
  if(document.defaultView && document.defaultView.getComputedStyle){
    strValue = document.defaultView.getComputedStyle(el, '').getPropertyValue(strCssRule);

  } else if(el.currentStyle){
    // IE8 Width/Height support
    strValue = el['client'+strCssRule.substr(0,1).toUpperCase() + strCssRule.substr(1)] + 'px';
  }
  return strValue;
};

/**
 * Insert an element as the first child node of another
 * @param  {Element} child   Element to insert
 * @param  {[type]} parent Element to insert child into
 */
vjs.insertFirst = function(child, parent){
  if (parent.firstChild) {
    parent.insertBefore(child, parent.firstChild);
  } else {
    parent.appendChild(child);
  }
};

/**
 * Object to hold browser support information
 * @type {Object}
 */
vjs.support = {};

/**
 * Shorthand for document.getElementById()
 * Also allows for CSS (jQuery) ID syntax. But nothing other than IDs.
 * @param  {String} id  Element ID
 * @return {Element}    Element with supplied ID
 */
vjs.el = function(id){
  if (id.indexOf('#') === 0) {
    id = id.slice(1);
  }

  return document.getElementById(id);
};

/**
 * Format seconds as a time string, H:MM:SS or M:SS
 * Supplying a guide (in seconds) will force a number of leading zeros
 * to cover the length of the guide
 * @param  {Number} seconds Number of seconds to be turned into a string
 * @param  {Number} guide   Number (in seconds) to model the string after
 * @return {String}         Time formatted as H:MM:SS or M:SS
 */
vjs.formatTime = function(seconds, guide) {
  // Default to using seconds as guide
  guide = guide || seconds;
  var s = Math.floor(seconds % 60),
      m = Math.floor(seconds / 60 % 60),
      h = Math.floor(seconds / 3600),
      gm = Math.floor(guide / 60 % 60),
      gh = Math.floor(guide / 3600);

  // handle invalid times
  if (isNaN(seconds) || seconds === Infinity) {
    // '-' is false for all relational operators (e.g. <, >=) so this setting
    // will add the minimum number of fields specified by the guide
    h = m = s = '-';
  }

  // Check if we need to show hours
  h = (h > 0 || gh > 0) ? h + ':' : '';

  // If hours are showing, we may need to add a leading zero.
  // Always show at least one digit of minutes.
  m = (((h || gm >= 10) && m < 10) ? '0' + m : m) + ':';

  // Check if leading zero is need for seconds
  s = (s < 10) ? '0' + s : s;

  return h + m + s;
};

// Attempt to block the ability to select text while dragging controls
vjs.blockTextSelection = function(){
  document.body.focus();
  document.onselectstart = function () { return false; };
};
// Turn off text selection blocking
vjs.unblockTextSelection = function(){ document.onselectstart = function () { return true; }; };

/**
 * Trim whitespace from the ends of a string.
 * @param  {String} string String to trim
 * @return {String}        Trimmed string
 */
vjs.trim = function(str){
  return (str+'').replace(/^\s+|\s+$/g, '');
};

/**
 * Should round off a number to a decimal place
 * @param  {Number} num Number to round
 * @param  {Number} dec Number of decimal places to round to
 * @return {Number}     Rounded number
 */
vjs.round = function(num, dec) {
  if (!dec) { dec = 0; }
  return Math.round(num*Math.pow(10,dec))/Math.pow(10,dec);
};

/**
 * Should create a fake TimeRange object
 * Mimics an HTML5 time range instance, which has functions that
 * return the start and end times for a range
 * TimeRanges are returned by the buffered() method
 * @param  {Number} start Start time in seconds
 * @param  {Number} end   End time in seconds
 * @return {Object}       Fake TimeRange object
 */
vjs.createTimeRange = function(start, end){
  return {
    length: 1,
    start: function() { return start; },
    end: function() { return end; }
  };
};

/**
 * Simple http request for retrieving external files (e.g. text tracks)
 * @param  {String} url           URL of resource
 * @param  {Function=} onSuccess  Success callback
 * @param  {Function=} onError    Error callback
 */
vjs.get = function(url, onSuccess, onError){
  var local, request;

  if (typeof XMLHttpRequest === 'undefined') {
    window.XMLHttpRequest = function () {
      try { return new window.ActiveXObject('Msxml2.XMLHTTP.6.0'); } catch (e) {}
      try { return new window.ActiveXObject('Msxml2.XMLHTTP.3.0'); } catch (f) {}
      try { return new window.ActiveXObject('Msxml2.XMLHTTP'); } catch (g) {}
      throw new Error('This browser does not support XMLHttpRequest.');
    };
  }

  request = new XMLHttpRequest();
  try {
    request.open('GET', url);
  } catch(e) {
    onError(e);
  }

  local = (url.indexOf('file:') === 0 || (window.location.href.indexOf('file:') === 0 && url.indexOf('http') === -1));

  request.onreadystatechange = function() {
    if (request.readyState === 4) {
      if (request.status === 200 || local && request.status === 0) {
        onSuccess(request.responseText);
      } else {
        if (onError) {
          onError();
        }
      }
    }
  };

  try {
    request.send();
  } catch(e) {
    if (onError) {
      onError(e);
    }
  }
};

/* Local Storage
================================================================================ */
vjs.setLocalStorage = function(key, value){
  try {
    // IE was throwing errors referencing the var anywhere without this
    var localStorage = window.localStorage || false;
    if (!localStorage) { return; }
    localStorage[key] = value;
  } catch(e) {
    if (e.code == 22 || e.code == 1014) { // Webkit == 22 / Firefox == 1014
      vjs.log('LocalStorage Full (VideoJS)', e);
    } else {
      if (e.code == 18) {
        vjs.log('LocalStorage not allowed (VideoJS)', e);
      } else {
        vjs.log('LocalStorage Error (VideoJS)', e);
      }
    }
  }
};

/**
 * Get abosolute version of relative URL. Used to tell flash correct URL.
 * http://stackoverflow.com/questions/470832/getting-an-absolute-url-from-a-relative-one-ie6-issue
 * @param  {String} url URL to make absolute
 * @return {String}     Absolute URL
 */
vjs.getAbsoluteURL = function(url){

  // Check if absolute URL
  if (!url.match(/^https?:\/\//)) {
    // Convert to absolute URL. Flash hosted off-site needs an absolute URL.
    url = vjs.createEl('div', {
      innerHTML: '<a href="'+url+'">x</a>'
    }).firstChild.href;
  }

  return url;
};

// usage: log('inside coolFunc',this,arguments);
// http://paulirish.com/2009/log-a-lightweight-wrapper-for-consolelog/
vjs.log = function(){
  vjs.log.history = vjs.log.history || [];   // store logs to an array for reference
  vjs.log.history.push(arguments);
  if(window.console){
    window.console.log(Array.prototype.slice.call(arguments));
  }
};

// Offset Left
// getBoundingClientRect technique from John Resig http://ejohn.org/blog/getboundingclientrect-is-awesome/
vjs.findPosition = function(el) {
    var box, docEl, body, clientLeft, scrollLeft, left, clientTop, scrollTop, top;

    if (el.getBoundingClientRect && el.parentNode) {
      box = el.getBoundingClientRect();
    }

    if (!box) {
      return {
        left: 0,
        top: 0
      };
    }

    docEl = document.documentElement;
    body = document.body;

    clientLeft = docEl.clientLeft || body.clientLeft || 0;
    scrollLeft = window.pageXOffset || body.scrollLeft;
    left = box.left + scrollLeft - clientLeft;

    clientTop = docEl.clientTop || body.clientTop || 0;
    scrollTop = window.pageYOffset || body.scrollTop;
    top = box.top + scrollTop - clientTop;

    return {
      left: left,
      top: top
    };
};
/**
 * @fileoverview Player Component - Base class for all UI objects
 *
 */

/**
 * Base UI Component class
 * @param {Object} player  Main Player
 * @param {Object=} options
 * @constructor
 */
vjs.Component = vjs.CoreObject.extend({
  /** @constructor */
  init: function(player, options, ready){
    this.player_ = player;

    // Make a copy of prototype.options_ to protect against overriding global defaults
    this.options_ = vjs.obj.copy(this.options_);

    // Updated options with supplied options
    options = this.options(options);

    // Get ID from options, element, or create using player ID and unique ID
    this.id_ = options['id'] || ((options['el'] && options['el']['id']) ? options['el']['id'] : player.id() + '_component_' + vjs.guid++ );

    this.name_ = options['name'] || null;

    // Create element if one wasn't provided in options
    this.el_ = options['el'] || this.createEl();

    this.children_ = [];
    this.childIndex_ = {};
    this.childNameIndex_ = {};

    // Add any child components in options
    this.initChildren();

    this.ready(ready);
    // Don't want to trigger ready here or it will before init is actually
    // finished for all children that run this constructor
  }
});

/**
 * Dispose of the component and all child components.
 */
vjs.Component.prototype.dispose = function(){
  this.trigger('dispose');

  // Dispose all children.
  if (this.children_) {
    for (var i = this.children_.length - 1; i >= 0; i--) {
      if (this.children_[i].dispose) {
        this.children_[i].dispose();
      }
    }
  }

  // Delete child references
  this.children_ = null;
  this.childIndex_ = null;
  this.childNameIndex_ = null;

  // Remove all event listeners.
  this.off();

  // Remove element from DOM
  if (this.el_.parentNode) {
    this.el_.parentNode.removeChild(this.el_);
  }

  vjs.removeData(this.el_);
  this.el_ = null;
};

/**
 * Reference to main player instance.
 * @type {vjs.Player}
 * @private
 */
vjs.Component.prototype.player_;

/**
 * Return the component's player.
 * @return {vjs.Player}
 */
vjs.Component.prototype.player = function(){
  return this.player_;
};

/**
 * Component options object.
 * @type {Object}
 * @private
 */
vjs.Component.prototype.options_;

/**
 * Deep merge of options objects
 * Whenever a property is an object on both options objects
 * the two properties will be merged using vjs.obj.deepMerge.
 *
 * This is used for merging options for child components. We
 * want it to be easy to override individual options on a child
 * component without having to rewrite all the other default options.
 *
 * Parent.prototype.options_ = {
 *   children: {
 *     'childOne': { 'foo': 'bar', 'asdf': 'fdsa' },
 *     'childTwo': {},
 *     'childThree': {}
 *   }
 * }
 * newOptions = {
 *   children: {
 *     'childOne': { 'foo': 'baz', 'abc': '123' }
 *     'childTwo': null,
 *     'childFour': {}
 *   }
 * }
 *
 * this.options(newOptions);
 *
 * RESULT
 *
 * {
 *   children: {
 *     'childOne': { 'foo': 'baz', 'asdf': 'fdsa', 'abc': '123' },
 *     'childTwo': null, // Disabled. Won't be initialized.
 *     'childThree': {},
 *     'childFour': {}
 *   }
 * }
 *
 * @param  {Object} obj Object whose values will be overwritten
 * @return {Object}      NEW merged object. Does not return obj1.
 */
vjs.Component.prototype.options = function(obj){
  if (obj === undefined) return this.options_;

  return this.options_ = vjs.obj.deepMerge(this.options_, obj);
};

/**
 * The DOM element for the component.
 * @type {Element}
 * @private
 */
vjs.Component.prototype.el_;

/**
 * Create the component's DOM element.
 * @param  {String=} tagName  Element's node type. e.g. 'div'
 * @param  {Object=} attributes An object of element attributes that should be set on the element.
 * @return {Element}
 */
vjs.Component.prototype.createEl = function(tagName, attributes){
  return vjs.createEl(tagName, attributes);
};

/**
 * Return the component's DOM element.
 * @return {Element}
 */
vjs.Component.prototype.el = function(){
  return this.el_;
};

/**
 * An optional element where, if defined, children will be inserted
 *   instead of directly in el_
 * @type {Element}
 * @private
 */
vjs.Component.prototype.contentEl_;

/**
 * Return the component's DOM element for embedding content.
 *   will either be el_ or a new element defined in createEl
 * @return {Element}
 */
vjs.Component.prototype.contentEl = function(){
  return this.contentEl_ || this.el_;
};

/**
 * The ID for the component.
 * @type {String}
 * @private
 */
vjs.Component.prototype.id_;

/**
 * Return the component's ID.
 * @return {String}
 */
vjs.Component.prototype.id = function(){
  return this.id_;
};

/**
 * The name for the component. Often used to reference the component.
 * @type {String}
 * @private
 */
vjs.Component.prototype.name_;

/**
 * Return the component's ID.
 * @return {String}
 */
vjs.Component.prototype.name = function(){
  return this.name_;
};

/**
 * Array of child components
 * @type {Array}
 * @private
 */
vjs.Component.prototype.children_;

/**
 * Returns array of all child components.
 * @return {Array}
 */
vjs.Component.prototype.children = function(){
  return this.children_;
};

/**
 * Object of child components by ID
 * @type {Object}
 * @private
 */
vjs.Component.prototype.childIndex_;

/**
 * Returns a child component with the provided ID.
 * @return {Array}
 */
vjs.Component.prototype.getChildById = function(id){
  return this.childIndex_[id];
};

/**
 * Object of child components by Name
 * @type {Object}
 * @private
 */
vjs.Component.prototype.childNameIndex_;

/**
 * Returns a child component with the provided ID.
 * @return {Array}
 */
vjs.Component.prototype.getChild = function(name){
  return this.childNameIndex_[name];
};

/**
 * Adds a child component inside this component.
 * @param {String|vjs.Component} child The class name or instance of a child to add.
 * @param {Object=} options Optional options, including options to be passed to
 *  children of the child.
 * @return {vjs.Component} The child component, because it might be created in this process.
 * @suppress {accessControls|checkRegExp|checkTypes|checkVars|const|constantProperty|deprecated|duplicate|es5Strict|fileoverviewTags|globalThis|invalidCasts|missingProperties|nonStandardJsDocs|strictModuleDepCheck|undefinedNames|undefinedVars|unknownDefines|uselessCode|visibility}
 */
vjs.Component.prototype.addChild = function(child, options){
  var component, componentClass, componentName, componentId;

  // If string, create new component with options
  if (typeof child === 'string') {

    componentName = child;

    // Make sure options is at least an empty object to protect against errors
    options = options || {};

    // Assume name of set is a lowercased name of the UI Class (PlayButton, etc.)
    componentClass = options['componentClass'] || vjs.capitalize(componentName);

    // Set name through options
    options['name'] = componentName;

    // Create a new object & element for this controls set
    // If there's no .player_, this is a player
    // Closure Compiler throws an 'incomplete alias' warning if we use the vjs variable directly.
    // Every class should be exported, so this should never be a problem here.
    component = new window['videojs'][componentClass](this.player_ || this, options);

  // child is a component instance
  } else {
    component = child;
  }

  this.children_.push(component);

  if (typeof component.id === 'function') {
    this.childIndex_[component.id()] = component;
  }

  // If a name wasn't used to create the component, check if we can use the
  // name function of the component
  componentName = componentName || (component.name && component.name());

  if (componentName) {
    this.childNameIndex_[componentName] = component;
  }

  // Add the UI object's element to the container div (box)
  // Having an element is not required
  if (typeof component['el'] === 'function' && component['el']()) {
    this.contentEl().appendChild(component['el']());
  }

  // Return so it can stored on parent object if desired.
  return component;
};

vjs.Component.prototype.removeChild = function(component){
  if (typeof component === 'string') {
    component = this.getChild(component);
  }

  if (!component || !this.children_) return;

  var childFound = false;
  for (var i = this.children_.length - 1; i >= 0; i--) {
    if (this.children_[i] === component) {
      childFound = true;
      this.children_.splice(i,1);
      break;
    }
  }

  if (!childFound) return;

  this.childIndex_[component.id] = null;
  this.childNameIndex_[component.name] = null;

  var compEl = component.el();
  if (compEl && compEl.parentNode === this.contentEl()) {
    this.contentEl().removeChild(component.el());
  }
};

/**
 * Initialize default child components from options
 */
vjs.Component.prototype.initChildren = function(){
  var options = this.options_;

  if (options && options['children']) {
    var self = this;

    // Loop through components and add them to the player
    vjs.obj.each(options['children'], function(name, opts){
      // Allow for disabling default components
      // e.g. vjs.options['children']['posterImage'] = false
      if (opts === false) return;

      // Allow waiting to add components until a specific event is called
      var tempAdd = function(){
        // Set property name on player. Could cause conflicts with other prop names, but it's worth making refs easy.
        self[name] = self.addChild(name, opts);
      };

      if (opts['loadEvent']) {
        // this.one(opts.loadEvent, tempAdd)
      } else {
        tempAdd();
      }
    });
  }
};

vjs.Component.prototype.buildCSSClass = function(){
    // Child classes can include a function that does:
    // return 'CLASS NAME' + this._super();
    return '';
};

/* Events
============================================================================= */

/**
 * Add an event listener to this component's element. Context will be the component.
 * @param  {String}   type Event type e.g. 'click'
 * @param  {Function} fn   Event listener
 * @return {vjs.Component}
 */
vjs.Component.prototype.on = function(type, fn){
  vjs.on(this.el_, type, vjs.bind(this, fn));
  return this;
};

/**
 * Remove an event listener from the component's element
 * @param  {String=}   type Optional event type. Without type it will remove all listeners.
 * @param  {Function=} fn   Optional event listener. Without fn it will remove all listeners for a type.
 * @return {vjs.Component}
 */
vjs.Component.prototype.off = function(type, fn){
  vjs.off(this.el_, type, fn);
  return this;
};

/**
 * Add an event listener to be triggered only once and then removed
 * @param  {String}   type Event type
 * @param  {Function} fn   Event listener
 * @return {vjs.Component}
 */
vjs.Component.prototype.one = function(type, fn) {
  vjs.one(this.el_, type, vjs.bind(this, fn));
  return this;
};

/**
 * Trigger an event on an element
 * @param  {String} type  Event type to trigger
 * @param  {Event|Object} event Event object to be passed to the listener
 * @return {vjs.Component}
 */
vjs.Component.prototype.trigger = function(type, event){
  vjs.trigger(this.el_, type, event);
  return this;
};

/* Ready
================================================================================ */
/**
 * Is the component loaded.
 * @type {Boolean}
 * @private
 */
vjs.Component.prototype.isReady_;

/**
 * Trigger ready as soon as initialization is finished.
 *   Allows for delaying ready. Override on a sub class prototype.
 *   If you set this.isReadyOnInitFinish_ it will affect all components.
 *   Specially used when waiting for the Flash player to asynchrnously load.
 *   @type {Boolean}
 *   @private
 */
vjs.Component.prototype.isReadyOnInitFinish_ = true;

/**
 * List of ready listeners
 * @type {Array}
 * @private
 */
vjs.Component.prototype.readyQueue_;

/**
 * Bind a listener to the component's ready state.
 *   Different from event listeners in that if the ready event has already happend
 *   it will trigger the function immediately.
 * @param  {Function} fn Ready listener
 * @return {vjs.Component}
 */
vjs.Component.prototype.ready = function(fn){
  if (fn) {
    if (this.isReady_) {
      fn.call(this);
    } else {
      if (this.readyQueue_ === undefined) {
        this.readyQueue_ = [];
      }
      this.readyQueue_.push(fn);
    }
  }
  return this;
};

/**
 * Trigger the ready listeners
 * @return {vjs.Component}
 */
vjs.Component.prototype.triggerReady = function(){
  this.isReady_ = true;

  var readyQueue = this.readyQueue_;

  if (readyQueue && readyQueue.length > 0) {

    for (var i = 0, j = readyQueue.length; i < j; i++) {
      readyQueue[i].call(this);
    }

    // Reset Ready Queue
    this.readyQueue_ = [];

    // Allow for using event listeners also, in case you want to do something everytime a source is ready.
    this.trigger('ready');
  }
};

/* Display
============================================================================= */

/**
 * Add a CSS class name to the component's element
 * @param {String} classToAdd Classname to add
 * @return {vjs.Component}
 */
vjs.Component.prototype.addClass = function(classToAdd){
  vjs.addClass(this.el_, classToAdd);
  return this;
};

/**
 * Remove a CSS class name from the component's element
 * @param {String} classToRemove Classname to remove
 * @return {vjs.Component}
 */
vjs.Component.prototype.removeClass = function(classToRemove){
  vjs.removeClass(this.el_, classToRemove);
  return this;
};

/**
 * Show the component element if hidden
 * @return {vjs.Component}
 */
vjs.Component.prototype.show = function(){
  this.el_.style.display = 'block';
  return this;
};

/**
 * Hide the component element if hidden
 * @return {vjs.Component}
 */
vjs.Component.prototype.hide = function(){
  this.el_.style.display = 'none';
  return this;
};

/**
 * Lock an item in its visible state. To be used with fadeIn/fadeOut.
 * @return {vjs.Component}
 */
vjs.Component.prototype.lockShowing = function(){
  this.addClass('vjs-lock-showing');
  return this;
};

/**
 * Unlock an item to be hidden. To be used with fadeIn/fadeOut.
 * @return {vjs.Component}
 */
vjs.Component.prototype.unlockShowing = function(){
  this.removeClass('vjs-lock-showing');
  return this;
};

/**
 * Disable component by making it unshowable
 */
vjs.Component.prototype.disable = function(){
  this.hide();
  this.show = function(){};
};

/**
 * If a value is provided it will change the width of the player to that value
 * otherwise the width is returned
 * http://dev.w3.org/html5/spec/dimension-attributes.html#attr-dim-height
 * Video tag width/height only work in pixels. No percents.
 * But allowing limited percents use. e.g. width() will return number+%, not computed width
 * @param  {Number|String=} num   Optional width number
 * @param  {[type]} skipListeners Skip the 'resize' event trigger
 * @return {vjs.Component|Number|String} Returns 'this' if dimension was set.
 *   Otherwise it returns the dimension.
 */
vjs.Component.prototype.width = function(num, skipListeners){
  return this.dimension('width', num, skipListeners);
};

/**
 * Get or set the height of the player
 * @param  {Number|String=} num     Optional new player height
 * @param  {Boolean=} skipListeners Optional skip resize event trigger
 * @return {vjs.Component|Number|String} The player, or the dimension
 */
vjs.Component.prototype.height = function(num, skipListeners){
  return this.dimension('height', num, skipListeners);
};

/**
 * Set both width and height at the same time.
 * @param  {Number|String} width
 * @param  {Number|String} height
 * @return {vjs.Component}   The player.
 */
vjs.Component.prototype.dimensions = function(width, height){
  // Skip resize listeners on width for optimization
  return this.width(width, true).height(height);
};

/**
 * Get or set width or height.
 * All for an integer, integer + 'px' or integer + '%';
 * Known issue: hidden elements. Hidden elements officially have a width of 0.
 * So we're defaulting to the style.width value and falling back to computedStyle
 * which has the hidden element issue.
 * Info, but probably not an efficient fix:
 * http://www.foliotek.com/devblog/getting-the-width-of-a-hidden-element-with-jquery-using-width/
 * @param  {String=} widthOrHeight 'width' or 'height'
 * @param  {Number|String=} num           New dimension
 * @param  {Boolean=} skipListeners Skip resize event trigger
 * @return {vjs.Component|Number|String} Return the player if setting a dimension.
 *                                         Otherwise it returns the dimension.
 */
vjs.Component.prototype.dimension = function(widthOrHeight, num, skipListeners){
  if (num !== undefined) {

    // Check if using css width/height (% or px) and adjust
    if ((''+num).indexOf('%') !== -1 || (''+num).indexOf('px') !== -1) {
      this.el_.style[widthOrHeight] = num;
    } else if (num === 'auto') {
      this.el_.style[widthOrHeight] = '';
    } else {
      this.el_.style[widthOrHeight] = num+'px';
    }

    // skipListeners allows us to avoid triggering the resize event when setting both width and height
    if (!skipListeners) { this.trigger('resize'); }

    // Return component
    return this;
  }

  // Not setting a value, so getting it
  // Make sure element exists
  if (!this.el_) return 0;

  // Get dimension value from style
  var val = this.el_.style[widthOrHeight];
  var pxIndex = val.indexOf('px');
  if (pxIndex !== -1) {
    // Return the pixel value with no 'px'
    return parseInt(val.slice(0,pxIndex), 10);

  // No px so using % or no style was set, so falling back to offsetWidth/height
  // If component has display:none, offset will return 0
  // TODO: handle display:none and no dimension style using px
  } else {

    return parseInt(this.el_['offset'+vjs.capitalize(widthOrHeight)], 10);

    // ComputedStyle version.
    // Only difference is if the element is hidden it will return
    // the percent value (e.g. '100%'')
    // instead of zero like offsetWidth returns.
    // var val = vjs.getComputedStyleValue(this.el_, widthOrHeight);
    // var pxIndex = val.indexOf('px');

    // if (pxIndex !== -1) {
    //   return val.slice(0, pxIndex);
    // } else {
    //   return val;
    // }
  }
};

/**
 * Emit 'tap' events when touch events are supported. We're requireing them to
 * be enabled because otherwise every component would have this extra overhead
 * unnecessarily, on mobile devices where extra overhead is especially bad.
 *
 * This is being implemented so we can support taps on the video element
 * toggling the controls.
 */
vjs.Component.prototype.emitTapEvents = function(){
  var touchStart, touchTime, couldBeTap, noTap;

  // Track the start time so we can determine how long the touch lasted
  touchStart = 0;

  this.on('touchstart', function(event) {
    // Record start time so we can detect a tap vs. "touch and hold"
    touchStart = new Date().getTime();
    // Reset couldBeTap tracking
    couldBeTap = true;
  });

  noTap = function(){
    couldBeTap = false;
  };
  // TODO: Listen to the original target. http://youtu.be/DujfpXOKUp8?t=13m8s
  this.on('touchmove', noTap);
  this.on('touchleave', noTap);
  this.on('touchcancel', noTap);

  // When the touch ends, measure how long it took and trigger the appropriate
  // event
  this.on('touchend', function() {
    // Proceed only if the touchmove/leave/cancel event didn't happen
    if (couldBeTap === true) {
      // Measure how long the touch lasted
      touchTime = new Date().getTime() - touchStart;
      // The touch needs to be quick in order to consider it a tap
      if (touchTime < 250) {
        this.trigger('tap');
        // It may be good to copy the touchend event object and change the
        // type to tap, if the other event properties aren't exact after
        // vjs.fixEvent runs (e.g. event.target)
      }
    }
  });
};
/* Button - Base class for all buttons
================================================================================ */
/**
 * Base class for all buttons
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.Button = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);

    var touchstart = false;
    this.on('touchstart', function(event) {
      // Stop click and other mouse events from triggering also
      event.preventDefault();
      touchstart = true;
    });
    this.on('touchmove', function() {
      touchstart = false;
    });
    var self = this;
    this.on('touchend', function(event) {
      if (touchstart) {
        self.onClick(event);
      }
      event.preventDefault();
    });

    this.on('click', this.onClick);
    this.on('focus', this.onFocus);
    this.on('blur', this.onBlur);
  }
});

vjs.Button.prototype.createEl = function(type, props){
  // Add standard Aria and Tabindex info
  props = vjs.obj.merge({
    className: this.buildCSSClass(),
    innerHTML: '<div class="vjs-control-content"><span class="vjs-control-text">' + (this.buttonText || 'Need Text') + '</span></div>',
    role: 'button',
    'aria-live': 'polite', // let the screen reader user know that the text of the button may change
    tabIndex: 0
  }, props);

  return vjs.Component.prototype.createEl.call(this, type, props);
};

vjs.Button.prototype.buildCSSClass = function(){
  // TODO: Change vjs-control to vjs-button?
  return 'vjs-control ' + vjs.Component.prototype.buildCSSClass.call(this);
};

  // Click - Override with specific functionality for button
vjs.Button.prototype.onClick = function(){};

  // Focus - Add keyboard functionality to element
vjs.Button.prototype.onFocus = function(){
  vjs.on(document, 'keyup', vjs.bind(this, this.onKeyPress));
};

  // KeyPress (document level) - Trigger click when keys are pressed
vjs.Button.prototype.onKeyPress = function(event){
  // Check for space bar (32) or enter (13) keys
  if (event.which == 32 || event.which == 13) {
    event.preventDefault();
    this.onClick();
  }
};

// Blur - Remove keyboard triggers
vjs.Button.prototype.onBlur = function(){
  vjs.off(document, 'keyup', vjs.bind(this, this.onKeyPress));
};
/* Slider
================================================================================ */
/**
 * Parent for seek bar and volume slider
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.Slider = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);

    // Set property names to bar and handle to match with the child Slider class is looking for
    this.bar = this.getChild(this.options_['barName']);
    this.handle = this.getChild(this.options_['handleName']);

    player.on(this.playerEvent, vjs.bind(this, this.update));

    this.on('mousedown', this.onMouseDown);
    this.on('touchstart', this.onMouseDown);
    this.on('focus', this.onFocus);
    this.on('blur', this.onBlur);
    this.on('click', this.onClick);

    this.player_.on('controlsvisible', vjs.bind(this, this.update));

    // This is actually to fix the volume handle position. http://twitter.com/#!/gerritvanaaken/status/159046254519787520
    // this.player_.one('timeupdate', vjs.bind(this, this.update));

    player.ready(vjs.bind(this, this.update));

    this.boundEvents = {};
  }
});

vjs.Slider.prototype.createEl = function(type, props) {
  props = props || {};
  // Add the slider element class to all sub classes
  props.className = props.className + ' vjs-slider';
  props = vjs.obj.merge({
    role: 'slider',
    'aria-valuenow': 0,
    'aria-valuemin': 0,
    'aria-valuemax': 100,
    tabIndex: 0
  }, props);

  return vjs.Component.prototype.createEl.call(this, type, props);
};

vjs.Slider.prototype.onMouseDown = function(event){
  event.preventDefault();
  vjs.blockTextSelection();

  this.boundEvents.move = vjs.bind(this, this.onMouseMove);
  this.boundEvents.end = vjs.bind(this, this.onMouseUp);

  vjs.on(document, 'mousemove', this.boundEvents.move);
  vjs.on(document, 'mouseup', this.boundEvents.end);
  vjs.on(document, 'touchmove', this.boundEvents.move);
  vjs.on(document, 'touchend', this.boundEvents.end);

  this.onMouseMove(event);
};

vjs.Slider.prototype.onMouseUp = function() {
  vjs.unblockTextSelection();
  vjs.off(document, 'mousemove', this.boundEvents.move, false);
  vjs.off(document, 'mouseup', this.boundEvents.end, false);
  vjs.off(document, 'touchmove', this.boundEvents.move, false);
  vjs.off(document, 'touchend', this.boundEvents.end, false);

  this.update();
};

vjs.Slider.prototype.update = function(){
  // In VolumeBar init we have a setTimeout for update that pops and update to the end of the
  // execution stack. The player is destroyed before then update will cause an error
  if (!this.el_) return;

  // If scrubbing, we could use a cached value to make the handle keep up with the user's mouse.
  // On HTML5 browsers scrubbing is really smooth, but some flash players are slow, so we might want to utilize this later.
  // var progress =  (this.player_.scrubbing) ? this.player_.getCache().currentTime / this.player_.duration() : this.player_.currentTime() / this.player_.duration();

  var barProgress,
      progress = this.getPercent(),
      handle = this.handle,
      bar = this.bar;

  // Protect against no duration and other division issues
  if (isNaN(progress)) { progress = 0; }

  barProgress = progress;

  // If there is a handle, we need to account for the handle in our calculation for progress bar
  // so that it doesn't fall short of or extend past the handle.
  if (handle) {

    var box = this.el_,
        boxWidth = box.offsetWidth,

        handleWidth = handle.el().offsetWidth,

        // The width of the handle in percent of the containing box
        // In IE, widths may not be ready yet causing NaN
        handlePercent = (handleWidth) ? handleWidth / boxWidth : 0,

        // Get the adjusted size of the box, considering that the handle's center never touches the left or right side.
        // There is a margin of half the handle's width on both sides.
        boxAdjustedPercent = 1 - handlePercent,

        // Adjust the progress that we'll use to set widths to the new adjusted box width
        adjustedProgress = progress * boxAdjustedPercent;

    // The bar does reach the left side, so we need to account for this in the bar's width
    barProgress = adjustedProgress + (handlePercent / 2);

    // Move the handle from the left based on the adjected progress
    handle.el().style.left = vjs.round(adjustedProgress * 100, 2) + '%';
  }

  // Set the new bar width
  bar.el().style.width = vjs.round(barProgress * 100, 2) + '%';
};

vjs.Slider.prototype.calculateDistance = function(event){

  var el, box, boxX, boxY, boxW, boxH, handle, pageX, pageY;

  el = this.el_;
  box = vjs.findPosition(el);
  boxW = boxH = el.offsetWidth;
  handle = this.handle;

  if (this.options_.vertical) {
    boxY = box.top;

    if (event.changedTouches) {
      pageY = event.changedTouches[0].pageY;
    } else {
      pageY = event.pageY;
    }

    if (handle) {
      var handleH = handle.el().offsetHeight;
      // Adjusted X and Width, so handle doesn't go outside the bar
      boxY = boxY + (handleH / 2);
      boxH = boxH - handleH;
    }

    // Percent that the click is through the adjusted area
    return Math.max(0, Math.min(1, ((boxY - pageY) + boxH) / boxH));

  } else {
    boxX = box.left;

    if (event.changedTouches) {
      pageX = event.changedTouches[0].pageX;
    } else {
      pageX = event.pageX;
    }

    if (handle) {
      var handleW = handle.el().offsetWidth;

      // Adjusted X and Width, so handle doesn't go outside the bar
      boxX = boxX + (handleW / 2);
      boxW = boxW - handleW;
    }

    // Percent that the click is through the adjusted area
    return Math.max(0, Math.min(1, (pageX - boxX) / boxW));
  }
};

vjs.Slider.prototype.onFocus = function(){
  vjs.on(document, 'keyup', vjs.bind(this, this.onKeyPress));
};

vjs.Slider.prototype.onKeyPress = function(event){
  if (event.which == 37) { // Left Arrow
    event.preventDefault();
    this.stepBack();
  } else if (event.which == 39) { // Right Arrow
    event.preventDefault();
    this.stepForward();
  }
};

vjs.Slider.prototype.onBlur = function(){
  vjs.off(document, 'keyup', vjs.bind(this, this.onKeyPress));
};

/**
 * Listener for click events on slider, used to prevent clicks
 *   from bubbling up to parent elements like button menus.
 * @param  {Object} event Event object
 */
vjs.Slider.prototype.onClick = function(event){
  event.stopImmediatePropagation();
  event.preventDefault();
};

/**
 * SeekBar Behavior includes play progress bar, and seek handle
 * Needed so it can determine seek position based on handle position/size
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.SliderHandle = vjs.Component.extend();

/**
 * Default value of the slider
 * @type {Number}
 */
vjs.SliderHandle.prototype.defaultValue = 0;

/** @inheritDoc */
vjs.SliderHandle.prototype.createEl = function(type, props) {
  props = props || {};
  // Add the slider element class to all sub classes
  props.className = props.className + ' vjs-slider-handle';
  props = vjs.obj.merge({
    innerHTML: '<span class="vjs-control-text">'+this.defaultValue+'</span>'
  }, props);

  return vjs.Component.prototype.createEl.call(this, 'div', props);
};
/* Menu
================================================================================ */
/**
 * The base for text track and settings menu buttons.
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.Menu = vjs.Component.extend();

/**
 * Add a menu item to the menu
 * @param {Object|String} component Component or component type to add
 */
vjs.Menu.prototype.addItem = function(component){
  this.addChild(component);
  component.on('click', vjs.bind(this, function(){
    this.unlockShowing();
  }));
};

/** @inheritDoc */
vjs.Menu.prototype.createEl = function(){
  var contentElType = this.options().contentElType || 'ul';
  this.contentEl_ = vjs.createEl(contentElType, {
    className: 'vjs-menu-content'
  });
  var el = vjs.Component.prototype.createEl.call(this, 'div', {
    append: this.contentEl_,
    className: 'vjs-menu'
  });
  el.appendChild(this.contentEl_);

  // Prevent clicks from bubbling up. Needed for Menu Buttons,
  // where a click on the parent is significant
  vjs.on(el, 'click', function(event){
    event.preventDefault();
    event.stopImmediatePropagation();
  });

  return el;
};

/**
 * Menu item
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.MenuItem = vjs.Button.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Button.call(this, player, options);
    this.selected(options['selected']);
  }
});

/** @inheritDoc */
vjs.MenuItem.prototype.createEl = function(type, props){
  return vjs.Button.prototype.createEl.call(this, 'li', vjs.obj.merge({
    className: 'vjs-menu-item',
    innerHTML: this.options_['label']
  }, props));
};

/** @inheritDoc */
vjs.MenuItem.prototype.onClick = function(){
  this.selected(true);
};

/**
 * Set this menu item as selected or not
 * @param  {Boolean} selected
 */
vjs.MenuItem.prototype.selected = function(selected){
  if (selected) {
    this.addClass('vjs-selected');
    this.el_.setAttribute('aria-selected',true);
  } else {
    this.removeClass('vjs-selected');
    this.el_.setAttribute('aria-selected',false);
  }
};


/**
 * A button class with a popup menu
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.MenuButton = vjs.Button.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Button.call(this, player, options);

    this.menu = this.createMenu();

    // Add list to element
    this.addChild(this.menu);

    // Automatically hide empty menu buttons
    if (this.items && this.items.length === 0) {
      this.hide();
    }

    this.on('keyup', this.onKeyPress);
    this.el_.setAttribute('aria-haspopup', true);
    this.el_.setAttribute('role', 'button');
  }
});

/**
 * Track the state of the menu button
 * @type {Boolean}
 */
vjs.MenuButton.prototype.buttonPressed_ = false;

vjs.MenuButton.prototype.createMenu = function(){
  var menu = new vjs.Menu(this.player_);

  // Add a title list item to the top
  if (this.options().title) {
    menu.el().appendChild(vjs.createEl('li', {
      className: 'vjs-menu-title',
      innerHTML: vjs.capitalize(this.kind_),
      tabindex: -1
    }));
  }

  this.items = this['createItems']();

  if (this.items) {
    // Add menu items to the menu
    for (var i = 0; i < this.items.length; i++) {
      menu.addItem(this.items[i]);
    }
  }

  return menu;
};

/**
 * Create the list of menu items. Specific to each subclass.
 */
vjs.MenuButton.prototype.createItems = function(){};

/** @inheritDoc */
vjs.MenuButton.prototype.buildCSSClass = function(){
  return this.className + ' vjs-menu-button ' + vjs.Button.prototype.buildCSSClass.call(this);
};

// Focus - Add keyboard functionality to element
// This function is not needed anymore. Instead, the keyboard functionality is handled by
// treating the button as triggering a submenu. When the button is pressed, the submenu
// appears. Pressing the button again makes the submenu disappear.
vjs.MenuButton.prototype.onFocus = function(){};
// Can't turn off list display that we turned on with focus, because list would go away.
vjs.MenuButton.prototype.onBlur = function(){};

vjs.MenuButton.prototype.onClick = function(){
  // When you click the button it adds focus, which will show the menu indefinitely.
  // So we'll remove focus when the mouse leaves the button.
  // Focus is needed for tab navigation.
  this.one('mouseout', vjs.bind(this, function(){
    this.menu.unlockShowing();
    this.el_.blur();
  }));
  if (this.buttonPressed_){
    this.unpressButton();
  } else {
    this.pressButton();
  }
};

vjs.MenuButton.prototype.onKeyPress = function(event){
  event.preventDefault();

  // Check for space bar (32) or enter (13) keys
  if (event.which == 32 || event.which == 13) {
    if (this.buttonPressed_){
      this.unpressButton();
    } else {
      this.pressButton();
    }
  // Check for escape (27) key
  } else if (event.which == 27){
    if (this.buttonPressed_){
      this.unpressButton();
    }
  }
};

vjs.MenuButton.prototype.pressButton = function(){
  this.buttonPressed_ = true;
  this.menu.lockShowing();
  this.el_.setAttribute('aria-pressed', true);
  if (this.items && this.items.length > 0) {
    this.items[0].el().focus(); // set the focus to the title of the submenu
  }
};

vjs.MenuButton.prototype.unpressButton = function(){
  this.buttonPressed_ = false;
  this.menu.unlockShowing();
  this.el_.setAttribute('aria-pressed', false);
};

/**
 * Main player class. A player instance is returned by _V_(id);
 * @param {Element} tag        The original video tag used for configuring options
 * @param {Object=} options    Player options
 * @param {Function=} ready    Ready callback function
 * @constructor
 */
vjs.Player = vjs.Component.extend({
  /** @constructor */
  init: function(tag, options, ready){
    this.tag = tag; // Store the original tag used to set options

    // Set Options
    // The options argument overrides options set in the video tag
    // which overrides globally set options.
    // This latter part coincides with the load order
    // (tag must exist before Player)
    options = vjs.obj.merge(this.getTagSettings(tag), options);

    // Cache for video property values.
    this.cache_ = {};

    // Set poster
    this.poster_ = options['poster'];
    // Set controls
    this.controls_ = options['controls'];
    // Original tag settings stored in options
    // now remove immediately so native controls don't flash.
    // May be turned back on by HTML5 tech if nativeControlsForTouch is true
    tag.controls = false;

    // Run base component initializing with new options.
    // Builds the element through createEl()
    // Inits and embeds any child components in opts
    vjs.Component.call(this, this, options, ready);

    // Update controls className. Can't do this when the controls are initially
    // set because the element doesn't exist yet.
    if (this.controls()) {
      this.addClass('vjs-controls-enabled');
    } else {
      this.addClass('vjs-controls-disabled');
    }

    // TODO: Make this smarter. Toggle user state between touching/mousing
    // using events, since devices can have both touch and mouse events.
    // if (vjs.TOUCH_ENABLED) {
    //   this.addClass('vjs-touch-enabled');
    // }

    // Firstplay event implimentation. Not sold on the event yet.
    // Could probably just check currentTime==0?
    this.one('play', function(e){
      var fpEvent = { type: 'firstplay', target: this.el_ };
      // Using vjs.trigger so we can check if default was prevented
      var keepGoing = vjs.trigger(this.el_, fpEvent);

      if (!keepGoing) {
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
      }
    });

    this.on('ended', this.onEnded);
    this.on('play', this.onPlay);
    this.on('firstplay', this.onFirstPlay);
    this.on('pause', this.onPause);
    this.on('progress', this.onProgress);
    this.on('durationchange', this.onDurationChange);
    this.on('error', this.onError);
    this.on('fullscreenchange', this.onFullscreenChange);

    // Make player easily findable by ID
    vjs.players[this.id_] = this;

    if (options['plugins']) {
      vjs.obj.each(options['plugins'], function(key, val){
        this[key](val);
      }, this);
    }

    this.listenForUserActivity();
  }
});

/**
 * Player instance options, surfaced using vjs.options
 * vjs.options = vjs.Player.prototype.options_
 * Make changes in vjs.options, not here.
 * All options should use string keys so they avoid
 * renaming by closure compiler
 * @type {Object}
 * @private
 */
vjs.Player.prototype.options_ = vjs.options;

vjs.Player.prototype.dispose = function(){
  this.trigger('dispose');
  // prevent dispose from being called twice
  this.off('dispose');

  // Kill reference to this player
  vjs.players[this.id_] = null;
  if (this.tag && this.tag['player']) { this.tag['player'] = null; }
  if (this.el_ && this.el_['player']) { this.el_['player'] = null; }

  // Ensure that tracking progress and time progress will stop and plater deleted
  this.stopTrackingProgress();
  this.stopTrackingCurrentTime();

  if (this.tech) { this.tech.dispose(); }

  // Component dispose
  vjs.Component.prototype.dispose.call(this);
};

vjs.Player.prototype.getTagSettings = function(tag){
  var options = {
    'sources': [],
    'tracks': []
  };

  vjs.obj.merge(options, vjs.getAttributeValues(tag));

  // Get tag children settings
  if (tag.hasChildNodes()) {
    var children, child, childName, i, j;

    children = tag.childNodes;

    for (i=0,j=children.length; i<j; i++) {
      child = children[i];
      // Change case needed: http://ejohn.org/blog/nodename-case-sensitivity/
      childName = child.nodeName.toLowerCase();
      if (childName === 'source') {
        options['sources'].push(vjs.getAttributeValues(child));
      } else if (childName === 'track') {
        options['tracks'].push(vjs.getAttributeValues(child));
      }
    }
  }

  return options;
};

vjs.Player.prototype.createEl = function(){
  var el = this.el_ = vjs.Component.prototype.createEl.call(this, 'div');
  var tag = this.tag;

  // Remove width/height attrs from tag so CSS can make it 100% width/height
  tag.removeAttribute('width');
  tag.removeAttribute('height');
  // Empty video tag sources and tracks so the built-in player doesn't use them also.
  // This may not be fast enough to stop HTML5 browsers from reading the tags
  // so we'll need to turn off any default tracks if we're manually doing
  // captions and subtitles. videoElement.textTracks
  if (tag.hasChildNodes()) {
    var nodes, nodesLength, i, node, nodeName, removeNodes;

    nodes = tag.childNodes;
    nodesLength = nodes.length;
    removeNodes = [];

    while (nodesLength--) {
      node = nodes[nodesLength];
      nodeName = node.nodeName.toLowerCase();
      if (nodeName === 'source' || nodeName === 'track') {
        removeNodes.push(node);
      }
    }

    for (i=0; i<removeNodes.length; i++) {
      tag.removeChild(removeNodes[i]);
    }
  }

  // Make sure tag ID exists
  tag.id = tag.id || 'vjs_video_' + vjs.guid++;

  // Give video tag ID and class to player div
  // ID will now reference player box, not the video tag
  el.id = tag.id;
  el.className = tag.className;

  // Update tag id/class for use as HTML5 playback tech
  // Might think we should do this after embedding in container so .vjs-tech class
  // doesn't flash 100% width/height, but class only applies with .video-js parent
  tag.id += '_html5_api';
  tag.className = 'vjs-tech';

  // Make player findable on elements
  tag['player'] = el['player'] = this;
  // Default state of video is paused
  this.addClass('vjs-paused');

  // Make box use width/height of tag, or rely on default implementation
  // Enforce with CSS since width/height attrs don't work on divs
  this.width(this.options_['width'], true); // (true) Skip resize listener on load
  this.height(this.options_['height'], true);

  // Wrap video tag in div (el/box) container
  if (tag.parentNode) {
    tag.parentNode.insertBefore(el, tag);
  }
  vjs.insertFirst(tag, el); // Breaks iPhone, fixed in HTML5 setup.

  return el;
};

// /* Media Technology (tech)
// ================================================================================ */
// Load/Create an instance of playback technlogy including element and API methods
// And append playback element in player div.
vjs.Player.prototype.loadTech = function(techName, source){

  // Pause and remove current playback technology
  if (this.tech) {
    this.unloadTech();

  // If the first time loading, HTML5 tag will exist but won't be initialized
  // So we need to remove it if we're not loading HTML5
  } else if (techName !== 'Html5' && this.tag) {
    this.el_.removeChild(this.tag);
    this.tag['player'] = null;
    this.tag = null;
  }

  this.techName = techName;

  // Turn off API access because we're loading a new tech that might load asynchronously
  this.isReady_ = false;

  var techReady = function(){
    this.player_.triggerReady();

    // Manually track progress in cases where the browser/flash player doesn't report it.
    if (!this.features['progressEvents']) {
      this.player_.manualProgressOn();
    }

    // Manually track timeudpates in cases where the browser/flash player doesn't report it.
    if (!this.features['timeupdateEvents']) {
      this.player_.manualTimeUpdatesOn();
    }
  };

  // Grab tech-specific options from player options and add source and parent element to use.
  var techOptions = vjs.obj.merge({ 'source': source, 'parentEl': this.el_ }, this.options_[techName.toLowerCase()]);

  if (source) {
    if (source.src == this.cache_.src && this.cache_.currentTime > 0) {
      techOptions['startTime'] = this.cache_.currentTime;
    }

    this.cache_.src = source.src;
  }

  // Initialize tech instance
  this.tech = new window['videojs'][techName](this, techOptions);

  this.tech.ready(techReady);
};

vjs.Player.prototype.unloadTech = function(){
  this.isReady_ = false;
  this.tech.dispose();

  // Turn off any manual progress or timeupdate tracking
  if (this.manualProgress) { this.manualProgressOff(); }

  if (this.manualTimeUpdates) { this.manualTimeUpdatesOff(); }

  this.tech = false;
};

// There's many issues around changing the size of a Flash (or other plugin) object.
// First is a plugin reload issue in Firefox that has been around for 11 years: https://bugzilla.mozilla.org/show_bug.cgi?id=90268
// Then with the new fullscreen API, Mozilla and webkit browsers will reload the flash object after going to fullscreen.
// To get around this, we're unloading the tech, caching source and currentTime values, and reloading the tech once the plugin is resized.
// reloadTech: function(betweenFn){
//   vjs.log('unloadingTech')
//   this.unloadTech();
//   vjs.log('unloadedTech')
//   if (betweenFn) { betweenFn.call(); }
//   vjs.log('LoadingTech')
//   this.loadTech(this.techName, { src: this.cache_.src })
//   vjs.log('loadedTech')
// },

/* Fallbacks for unsupported event types
================================================================================ */
// Manually trigger progress events based on changes to the buffered amount
// Many flash players and older HTML5 browsers don't send progress or progress-like events
vjs.Player.prototype.manualProgressOn = function(){
  this.manualProgress = true;

  // Trigger progress watching when a source begins loading
  this.trackProgress();

  // Watch for a native progress event call on the tech element
  // In HTML5, some older versions don't support the progress event
  // So we're assuming they don't, and turning off manual progress if they do.
  // As opposed to doing user agent detection
  this.tech.one('progress', function(){

    // Update known progress support for this playback technology
    this.features['progressEvents'] = true;

    // Turn off manual progress tracking
    this.player_.manualProgressOff();
  });
};

vjs.Player.prototype.manualProgressOff = function(){
  this.manualProgress = false;
  this.stopTrackingProgress();
};

vjs.Player.prototype.trackProgress = function(){

  this.progressInterval = setInterval(vjs.bind(this, function(){
    // Don't trigger unless buffered amount is greater than last time
    // log(this.cache_.bufferEnd, this.buffered().end(0), this.duration())
    /* TODO: update for multiple buffered regions */
    if (this.cache_.bufferEnd < this.buffered().end(0)) {
      this.trigger('progress');
    } else if (this.bufferedPercent() == 1) {
      this.stopTrackingProgress();
      this.trigger('progress'); // Last update
    }
  }), 500);
};
vjs.Player.prototype.stopTrackingProgress = function(){ clearInterval(this.progressInterval); };

/* Time Tracking -------------------------------------------------------------- */
vjs.Player.prototype.manualTimeUpdatesOn = function(){
  this.manualTimeUpdates = true;

  this.on('play', this.trackCurrentTime);
  this.on('pause', this.stopTrackingCurrentTime);
  // timeupdate is also called by .currentTime whenever current time is set

  // Watch for native timeupdate event
  this.tech.one('timeupdate', function(){
    // Update known progress support for this playback technology
    this.features['timeupdateEvents'] = true;
    // Turn off manual progress tracking
    this.player_.manualTimeUpdatesOff();
  });
};

vjs.Player.prototype.manualTimeUpdatesOff = function(){
  this.manualTimeUpdates = false;
  this.stopTrackingCurrentTime();
  this.off('play', this.trackCurrentTime);
  this.off('pause', this.stopTrackingCurrentTime);
};

vjs.Player.prototype.trackCurrentTime = function(){
  if (this.currentTimeInterval) { this.stopTrackingCurrentTime(); }
  this.currentTimeInterval = setInterval(vjs.bind(this, function(){
    this.trigger('timeupdate');
  }), 250); // 42 = 24 fps // 250 is what Webkit uses // FF uses 15
};

// Turn off play progress tracking (when paused or dragging)
vjs.Player.prototype.stopTrackingCurrentTime = function(){ clearInterval(this.currentTimeInterval); };

// /* Player event handlers (how the player reacts to certain events)
// ================================================================================ */
vjs.Player.prototype.onEnded = function(){
  if (this.options_['loop']) {
    this.currentTime(0);
    this.play();
  }
};

vjs.Player.prototype.onPlay = function(){
  vjs.removeClass(this.el_, 'vjs-paused');
  vjs.addClass(this.el_, 'vjs-playing');
};

vjs.Player.prototype.onFirstPlay = function(){
    //If the first starttime attribute is specified
    //then we will start at the given offset in seconds
    if(this.options_['starttime']){
      this.currentTime(this.options_['starttime']);
    }

    this.addClass('vjs-has-started');
};

vjs.Player.prototype.onPause = function(){
  vjs.removeClass(this.el_, 'vjs-playing');
  vjs.addClass(this.el_, 'vjs-paused');
};

vjs.Player.prototype.onProgress = function(){
  // Add custom event for when source is finished downloading.
  if (this.bufferedPercent() == 1) {
    this.trigger('loadedalldata');
  }
};

// Update duration with durationchange event
// Allows for cacheing value instead of asking player each time.
vjs.Player.prototype.onDurationChange = function(){
  this.duration(this.techGet('duration'));
};

vjs.Player.prototype.onError = function(e) {
  vjs.log('Video Error', e);
};

vjs.Player.prototype.onFullscreenChange = function() {
  if (this.isFullScreen) {
    this.addClass('vjs-fullscreen');
  } else {
    this.removeClass('vjs-fullscreen');
  }
};

// /* Player API
// ================================================================================ */

/**
 * Object for cached values.
 * @private
 */
vjs.Player.prototype.cache_;

vjs.Player.prototype.getCache = function(){
  return this.cache_;
};

// Pass values to the playback tech
vjs.Player.prototype.techCall = function(method, arg){
  // If it's not ready yet, call method when it is
  if (this.tech && !this.tech.isReady_) {
    this.tech.ready(function(){
      this[method](arg);
    });

  // Otherwise call method now
  } else {
    try {
      this.tech[method](arg);
    } catch(e) {
      vjs.log(e);
      throw e;
    }
  }
};

// Get calls can't wait for the tech, and sometimes don't need to.
vjs.Player.prototype.techGet = function(method){

  if (this.tech && this.tech.isReady_) {

    // Flash likes to die and reload when you hide or reposition it.
    // In these cases the object methods go away and we get errors.
    // When that happens we'll catch the errors and inform tech that it's not ready any more.
    try {
      return this.tech[method]();
    } catch(e) {
      // When building additional tech libs, an expected method may not be defined yet
      if (this.tech[method] === undefined) {
        vjs.log('Video.js: ' + method + ' method not defined for '+this.techName+' playback technology.', e);
      } else {
        // When a method isn't available on the object it throws a TypeError
        if (e.name == 'TypeError') {
          vjs.log('Video.js: ' + method + ' unavailable on '+this.techName+' playback technology element.', e);
          this.tech.isReady_ = false;
        } else {
          vjs.log(e);
        }
      }
      throw e;
    }
  }

  return;
};

/**
 * Start media playback
 * http://dev.w3.org/html5/spec/video.html#dom-media-play
 * We're triggering the 'play' event here instead of relying on the
 * media element to allow using event.preventDefault() to stop
 * play from happening if desired. Usecase: preroll ads.
 */
vjs.Player.prototype.play = function(){
  this.techCall('play');
  return this;
};

// http://dev.w3.org/html5/spec/video.html#dom-media-pause
vjs.Player.prototype.pause = function(){
  this.techCall('pause');
  return this;
};

// http://dev.w3.org/html5/spec/video.html#dom-media-paused
// The initial state of paused should be true (in Safari it's actually false)
vjs.Player.prototype.paused = function(){
  return (this.techGet('paused') === false) ? false : true;
};

// http://dev.w3.org/html5/spec/video.html#dom-media-currenttime
vjs.Player.prototype.currentTime = function(seconds){
  if (seconds !== undefined) {

    // Cache the last set value for smoother scrubbing.
    this.cache_.lastSetCurrentTime = seconds;

    this.techCall('setCurrentTime', seconds);

    // Improve the accuracy of manual timeupdates
    if (this.manualTimeUpdates) { this.trigger('timeupdate'); }

    return this;
  }

  // Cache last currentTime and return
  // Default to 0 seconds
  return this.cache_.currentTime = (this.techGet('currentTime') || 0);
};

// http://dev.w3.org/html5/spec/video.html#dom-media-duration
// Duration should return NaN if not available. ParseFloat will turn false-ish values to NaN.
vjs.Player.prototype.duration = function(seconds){
  if (seconds !== undefined) {

    // Cache the last set value for optimiized scrubbing (esp. Flash)
    this.cache_.duration = parseFloat(seconds);

    return this;
  }

  return this.cache_.duration;
};

// Calculates how much time is left. Not in spec, but useful.
vjs.Player.prototype.remainingTime = function(){
  return this.duration() - this.currentTime();
};

// http://dev.w3.org/html5/spec/video.html#dom-media-buffered
// Buffered returns a timerange object.
// Kind of like an array of portions of the video that have been downloaded.
// So far no browsers return more than one range (portion)
vjs.Player.prototype.buffered = function(){
  var buffered = this.techGet('buffered'),
      start = 0,
      buflast = buffered.length - 1,
      // Default end to 0 and store in values
      end = this.cache_.bufferEnd = this.cache_.bufferEnd || 0;

  if (buffered && buflast >= 0 && buffered.end(buflast) !== end) {
    end = buffered.end(buflast);
    // Storing values allows them be overridden by setBufferedFromProgress
    this.cache_.bufferEnd = end;
  }

  return vjs.createTimeRange(start, end);
};

// Calculates amount of buffer is full. Not in spec but useful.
vjs.Player.prototype.bufferedPercent = function(){
  return (this.duration()) ? this.buffered().end(0) / this.duration() : 0;
};

// http://dev.w3.org/html5/spec/video.html#dom-media-volume
vjs.Player.prototype.volume = function(percentAsDecimal){
  var vol;

  if (percentAsDecimal !== undefined) {
    vol = Math.max(0, Math.min(1, parseFloat(percentAsDecimal))); // Force value to between 0 and 1
    this.cache_.volume = vol;
    this.techCall('setVolume', vol);
    vjs.setLocalStorage('volume', vol);
    return this;
  }

  // Default to 1 when returning current volume.
  vol = parseFloat(this.techGet('volume'));
  return (isNaN(vol)) ? 1 : vol;
};

// http://dev.w3.org/html5/spec/video.html#attr-media-muted
vjs.Player.prototype.muted = function(muted){
  if (muted !== undefined) {
    this.techCall('setMuted', muted);
    return this;
  }
  return this.techGet('muted') || false; // Default to false
};

// Check if current tech can support native fullscreen (e.g. with built in controls lik iOS, so not our flash swf)
vjs.Player.prototype.supportsFullScreen = function(){ return this.techGet('supportsFullScreen') || false; };

// Turn on fullscreen (or window) mode
vjs.Player.prototype.requestFullScreen = function(){
  var requestFullScreen = vjs.support.requestFullScreen;
  this.isFullScreen = true;

  if (requestFullScreen) {
    // the browser supports going fullscreen at the element level so we can
    // take the controls fullscreen as well as the video

    // Trigger fullscreenchange event after change
    // We have to specifically add this each time, and remove
    // when cancelling fullscreen. Otherwise if there's multiple
    // players on a page, they would all be reacting to the same fullscreen
    // events
    vjs.on(document, requestFullScreen.eventName, vjs.bind(this, function(e){
      this.isFullScreen = document[requestFullScreen.isFullScreen];

      // If cancelling fullscreen, remove event listener.
      if (this.isFullScreen === false) {
        vjs.off(document, requestFullScreen.eventName, arguments.callee);
      }

      this.trigger('fullscreenchange');
    }));

    this.el_[requestFullScreen.requestFn]();

  } else if (this.tech.supportsFullScreen()) {
    // we can't take the video.js controls fullscreen but we can go fullscreen
    // with native controls
    this.techCall('enterFullScreen');
  } else {
    // fullscreen isn't supported so we'll just stretch the video element to
    // fill the viewport
    this.enterFullWindow();
    this.trigger('fullscreenchange');
  }

  return this;
};

vjs.Player.prototype.cancelFullScreen = function(){
  var requestFullScreen = vjs.support.requestFullScreen;
  this.isFullScreen = false;

  // Check for browser element fullscreen support
  if (requestFullScreen) {
    document[requestFullScreen.cancelFn]();
  } else if (this.tech.supportsFullScreen()) {
   this.techCall('exitFullScreen');
  } else {
   this.exitFullWindow();
   this.trigger('fullscreenchange');
  }

  return this;
};

// When fullscreen isn't supported we can stretch the video container to as wide as the browser will let us.
vjs.Player.prototype.enterFullWindow = function(){
  this.isFullWindow = true;

  // Storing original doc overflow value to return to when fullscreen is off
  this.docOrigOverflow = document.documentElement.style.overflow;

  // Add listener for esc key to exit fullscreen
  vjs.on(document, 'keydown', vjs.bind(this, this.fullWindowOnEscKey));

  // Hide any scroll bars
  document.documentElement.style.overflow = 'hidden';

  // Apply fullscreen styles
  vjs.addClass(document.body, 'vjs-full-window');

  this.trigger('enterFullWindow');
};
vjs.Player.prototype.fullWindowOnEscKey = function(event){
  if (event.keyCode === 27) {
    if (this.isFullScreen === true) {
      this.cancelFullScreen();
    } else {
      this.exitFullWindow();
    }
  }
};

vjs.Player.prototype.exitFullWindow = function(){
  this.isFullWindow = false;
  vjs.off(document, 'keydown', this.fullWindowOnEscKey);

  // Unhide scroll bars.
  document.documentElement.style.overflow = this.docOrigOverflow;

  // Remove fullscreen styles
  vjs.removeClass(document.body, 'vjs-full-window');

  // Resize the box, controller, and poster to original sizes
  // this.positionAll();
  this.trigger('exitFullWindow');
};

vjs.Player.prototype.selectSource = function(sources){

  // Loop through each playback technology in the options order
  for (var i=0,j=this.options_['techOrder'];i<j.length;i++) {
    var techName = vjs.capitalize(j[i]),
        tech = window['videojs'][techName];

    // Check if the browser supports this technology
    if (tech.isSupported()) {
      // Loop through each source object
      for (var a=0,b=sources;a<b.length;a++) {
        var source = b[a];

        // Check if source can be played with this technology
        if (tech['canPlaySource'](source)) {
          return { source: source, tech: techName };
        }
      }
    }
  }

  return false;
};

// src is a pretty powerful function
// If you pass it an array of source objects, it will find the best source to play and use that object.src
//   If the new source requires a new playback technology, it will switch to that.
// If you pass it an object, it will set the source to object.src
// If you pass it anything else (url string) it will set the video source to that
vjs.Player.prototype.src = function(source){
  // Case: Array of source objects to choose from and pick the best to play
  if (source instanceof Array) {

    var sourceTech = this.selectSource(source),
        techName;

    if (sourceTech) {
        source = sourceTech.source;
        techName = sourceTech.tech;

      // If this technology is already loaded, set source
      if (techName == this.techName) {
        this.src(source); // Passing the source object
      // Otherwise load this technology with chosen source
      } else {
        this.loadTech(techName, source);
      }
    } else {
      this.el_.appendChild(vjs.createEl('p', {
        innerHTML: this.options()['notSupportedMessage']
      }));
    }

  // Case: Source object { src: '', type: '' ... }
  } else if (source instanceof Object) {

    if (window['videojs'][this.techName]['canPlaySource'](source)) {
      this.src(source.src);
    } else {
      // Send through tech loop to check for a compatible technology.
      this.src([source]);
    }

  // Case: URL String (http://myvideo...)
  } else {
    // Cache for getting last set source
    this.cache_.src = source;

    if (!this.isReady_) {
      this.ready(function(){
        this.src(source);
      });
    } else {
      this.techCall('src', source);
      if (this.options_['preload'] == 'auto') {
        this.load();
      }
      if (this.options_['autoplay']) {
        this.play();
      }
    }
  }
  return this;
};

// Begin loading the src data
// http://dev.w3.org/html5/spec/video.html#dom-media-load
vjs.Player.prototype.load = function(){
  this.techCall('load');
  return this;
};

// http://dev.w3.org/html5/spec/video.html#dom-media-currentsrc
vjs.Player.prototype.currentSrc = function(){
  return this.techGet('currentSrc') || this.cache_.src || '';
};

// Attributes/Options
vjs.Player.prototype.preload = function(value){
  if (value !== undefined) {
    this.techCall('setPreload', value);
    this.options_['preload'] = value;
    return this;
  }
  return this.techGet('preload');
};
vjs.Player.prototype.autoplay = function(value){
  if (value !== undefined) {
    this.techCall('setAutoplay', value);
    this.options_['autoplay'] = value;
    return this;
  }
  return this.techGet('autoplay', value);
};
vjs.Player.prototype.loop = function(value){
  if (value !== undefined) {
    this.techCall('setLoop', value);
    this.options_['loop'] = value;
    return this;
  }
  return this.techGet('loop');
};

/**
 * The url of the poster image source.
 * @type {String}
 * @private
 */
vjs.Player.prototype.poster_;

/**
 * Get or set the poster image source url.
 * @param  {String} src Poster image source URL
 * @return {String}    Poster image source URL or null
 */
vjs.Player.prototype.poster = function(src){
  if (src !== undefined) {
    this.poster_ = src;
  }
  return this.poster_;
};

/**
 * Whether or not the controls are showing
 * @type {Boolean}
 * @private
 */
vjs.Player.prototype.controls_;

/**
 * Get or set whether or not the controls are showing.
 * @param  {Boolean} controls Set controls to showing or not
 * @return {Boolean}    Controls are showing
 */
vjs.Player.prototype.controls = function(bool){
  if (bool !== undefined) {
    bool = !!bool; // force boolean
    // Don't trigger a change event unless it actually changed
    if (this.controls_ !== bool) {
      this.controls_ = bool;
      if (bool) {
        this.removeClass('vjs-controls-disabled');
        this.addClass('vjs-controls-enabled');
        this.trigger('controlsenabled');
      } else {
        this.removeClass('vjs-controls-enabled');
        this.addClass('vjs-controls-disabled');
        this.trigger('controlsdisabled');
      }
    }
    return this;
  }
  return this.controls_;
};

vjs.Player.prototype.usingNativeControls_;

/**
 * Toggle native controls on/off. Native controls are the controls built into
 * devices (e.g. default iPhone controls), Flash, or other techs
 * (e.g. Vimeo Controls)
 *
 * **This should only be set by the current tech, because only the tech knows
 * if it can support native controls**
 *
 * @param  {Boolean} bool    True signals that native controls are on
 * @return {vjs.Player}      Returns the player
 */
vjs.Player.prototype.usingNativeControls = function(bool){
  if (bool !== undefined) {
    bool = !!bool; // force boolean
    // Don't trigger a change event unless it actually changed
    if (this.usingNativeControls_ !== bool) {
      this.usingNativeControls_ = bool;
      if (bool) {
        this.addClass('vjs-using-native-controls');
        this.trigger('usingnativecontrols');
      } else {
        this.removeClass('vjs-using-native-controls');
        this.trigger('usingcustomcontrols');
      }
    }
    return this;
  }
  return this.usingNativeControls_;
};

vjs.Player.prototype.error = function(){ return this.techGet('error'); };
vjs.Player.prototype.ended = function(){ return this.techGet('ended'); };
vjs.Player.prototype.seeking = function(){ return this.techGet('seeking'); };

// When the player is first initialized, trigger activity so components
// like the control bar show themselves if needed
vjs.Player.prototype.userActivity_ = true;
vjs.Player.prototype.reportUserActivity = function(event){
  this.userActivity_ = true;
};

vjs.Player.prototype.userActive_ = true;
vjs.Player.prototype.userActive = function(bool){
  if (bool !== undefined) {
    bool = !!bool;
    if (bool !== this.userActive_) {
      this.userActive_ = bool;
      if (bool) {
        // If the user was inactive and is now active we want to reset the
        // inactivity timer
        this.userActivity_ = true;
        this.removeClass('vjs-user-inactive');
        this.addClass('vjs-user-active');
        this.trigger('useractive');
      } else {
        // We're switching the state to inactive manually, so erase any other
        // activity
        this.userActivity_ = false;

        // Chrome/Safari/IE have bugs where when you change the cursor it can
        // trigger a mousemove event. This causes an issue when you're hiding
        // the cursor when the user is inactive, and a mousemove signals user
        // activity. Making it impossible to go into inactive mode. Specifically
        // this happens in fullscreen when we really need to hide the cursor.
        //
        // When this gets resolved in ALL browsers it can be removed
        // https://code.google.com/p/chromium/issues/detail?id=103041
        this.tech.one('mousemove', function(e){
          e.stopPropagation();
          e.preventDefault();
        });
        this.removeClass('vjs-user-active');
        this.addClass('vjs-user-inactive');
        this.trigger('userinactive');
      }
    }
    return this;
  }
  return this.userActive_;
};

vjs.Player.prototype.listenForUserActivity = function(){
  var onMouseActivity, onMouseDown, mouseInProgress, onMouseUp,
      activityCheck, inactivityTimeout;

  onMouseActivity = this.reportUserActivity;

  onMouseDown = function() {
    onMouseActivity();
    // For as long as the they are touching the device or have their mouse down,
    // we consider them active even if they're not moving their finger or mouse.
    // So we want to continue to update that they are active
    clearInterval(mouseInProgress);
    // Setting userActivity=true now and setting the interval to the same time
    // as the activityCheck interval (250) should ensure we never miss the
    // next activityCheck
    mouseInProgress = setInterval(vjs.bind(this, onMouseActivity), 250);
  };

  onMouseUp = function(event) {
    onMouseActivity();
    // Stop the interval that maintains activity if the mouse/touch is down
    clearInterval(mouseInProgress);
  };

  // Any mouse movement will be considered user activity
  this.on('mousedown', onMouseDown);
  this.on('mousemove', onMouseActivity);
  this.on('mouseup', onMouseUp);

  // Listen for keyboard navigation
  // Shouldn't need to use inProgress interval because of key repeat
  this.on('keydown', onMouseActivity);
  this.on('keyup', onMouseActivity);

  // Consider any touch events that bubble up to be activity
  // Certain touches on the tech will be blocked from bubbling because they
  // toggle controls
  this.on('touchstart', onMouseDown);
  this.on('touchmove', onMouseActivity);
  this.on('touchend', onMouseUp);
  this.on('touchcancel', onMouseUp);

  // Run an interval every 250 milliseconds instead of stuffing everything into
  // the mousemove/touchmove function itself, to prevent performance degradation.
  // `this.reportUserActivity` simply sets this.userActivity_ to true, which
  // then gets picked up by this loop
  // http://ejohn.org/blog/learning-from-twitter/
  activityCheck = setInterval(vjs.bind(this, function() {
    // Check to see if mouse/touch activity has happened
    if (this.userActivity_) {
      // Reset the activity tracker
      this.userActivity_ = false;

      // If the user state was inactive, set the state to active
      this.userActive(true);

      // Clear any existing inactivity timeout to start the timer over
      clearTimeout(inactivityTimeout);

      // In X seconds, if no more activity has occurred the user will be
      // considered inactive
      inactivityTimeout = setTimeout(vjs.bind(this, function() {
        // Protect against the case where the inactivityTimeout can trigger just
        // before the next user activity is picked up by the activityCheck loop
        // causing a flicker
        if (!this.userActivity_) {
          this.userActive(false);
        }
      }), 2000);
    }
  }), 250);

  // Clean up the intervals when we kill the player
  this.on('dispose', function(){
    clearInterval(activityCheck);
    clearTimeout(inactivityTimeout);
  });
};

// Methods to add support for
// networkState: function(){ return this.techCall('networkState'); },
// readyState: function(){ return this.techCall('readyState'); },
// seeking: function(){ return this.techCall('seeking'); },
// initialTime: function(){ return this.techCall('initialTime'); },
// startOffsetTime: function(){ return this.techCall('startOffsetTime'); },
// played: function(){ return this.techCall('played'); },
// seekable: function(){ return this.techCall('seekable'); },
// videoTracks: function(){ return this.techCall('videoTracks'); },
// audioTracks: function(){ return this.techCall('audioTracks'); },
// videoWidth: function(){ return this.techCall('videoWidth'); },
// videoHeight: function(){ return this.techCall('videoHeight'); },
// defaultPlaybackRate: function(){ return this.techCall('defaultPlaybackRate'); },
// playbackRate: function(){ return this.techCall('playbackRate'); },
// mediaGroup: function(){ return this.techCall('mediaGroup'); },
// controller: function(){ return this.techCall('controller'); },
// defaultMuted: function(){ return this.techCall('defaultMuted'); }

// TODO
// currentSrcList: the array of sources including other formats and bitrates
// playList: array of source lists in order of playback

// RequestFullscreen API
(function(){
  var prefix, requestFS, div;

  div = document.createElement('div');

  requestFS = {};

  // Current W3C Spec
  // http://dvcs.w3.org/hg/fullscreen/raw-file/tip/Overview.html#api
  // Mozilla Draft: https://wiki.mozilla.org/Gecko:FullScreenAPI#fullscreenchange_event
  // New: https://dvcs.w3.org/hg/fullscreen/raw-file/529a67b8d9f3/Overview.html
  if (div.cancelFullscreen !== undefined) {
    requestFS.requestFn = 'requestFullscreen';
    requestFS.cancelFn = 'exitFullscreen';
    requestFS.eventName = 'fullscreenchange';
    requestFS.isFullScreen = 'fullScreen';

  // Webkit (Chrome/Safari) and Mozilla (Firefox) have working implementations
  // that use prefixes and vary slightly from the new W3C spec. Specifically,
  // using 'exit' instead of 'cancel', and lowercasing the 'S' in Fullscreen.
  // Other browsers don't have any hints of which version they might follow yet,
  // so not going to try to predict by looping through all prefixes.
  } else {

    if (document.mozCancelFullScreen) {
      prefix = 'moz';
      requestFS.isFullScreen = prefix + 'FullScreen';
    } else {
      prefix = 'webkit';
      requestFS.isFullScreen = prefix + 'IsFullScreen';
    }

    if (div[prefix + 'RequestFullScreen']) {
      requestFS.requestFn = prefix + 'RequestFullScreen';
      requestFS.cancelFn = prefix + 'CancelFullScreen';
    }
    requestFS.eventName = prefix + 'fullscreenchange';
  }

  if (document[requestFS.cancelFn]) {
    vjs.support.requestFullScreen = requestFS;
  }

})();


/**
 * Container of main controls
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.ControlBar = vjs.Component.extend();

vjs.ControlBar.prototype.options_ = {
  loadEvent: 'play',
  children: {
    'playToggle': {},
    'currentTimeDisplay': {},
    'timeDivider': {},
    'durationDisplay': {},
    'remainingTimeDisplay': {},
    'progressControl': {},
    'fullscreenToggle': {},
    'volumeControl': {},
    'muteToggle': {}
    // 'volumeMenuButton': {}
  }
};

vjs.ControlBar.prototype.createEl = function(){
  return vjs.createEl('div', {
    className: 'vjs-control-bar'
  });
};
/**
 * Button to toggle between play and pause
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.PlayToggle = vjs.Button.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Button.call(this, player, options);

    player.on('play', vjs.bind(this, this.onPlay));
    player.on('pause', vjs.bind(this, this.onPause));
  }
});

vjs.PlayToggle.prototype.buttonText = 'Play';

vjs.PlayToggle.prototype.buildCSSClass = function(){
  return 'vjs-play-control ' + vjs.Button.prototype.buildCSSClass.call(this);
};

  // OnClick - Toggle between play and pause
vjs.PlayToggle.prototype.onClick = function(){
  if (this.player_.paused()) {
    this.player_.play();
  } else {
    this.player_.pause();
  }
};

  // OnPlay - Add the vjs-playing class to the element so it can change appearance
vjs.PlayToggle.prototype.onPlay = function(){
  vjs.removeClass(this.el_, 'vjs-paused');
  vjs.addClass(this.el_, 'vjs-playing');
  this.el_.children[0].children[0].innerHTML = 'Pause'; // change the button text to "Pause"
};

  // OnPause - Add the vjs-paused class to the element so it can change appearance
vjs.PlayToggle.prototype.onPause = function(){
  vjs.removeClass(this.el_, 'vjs-playing');
  vjs.addClass(this.el_, 'vjs-paused');
  this.el_.children[0].children[0].innerHTML = 'Play'; // change the button text to "Play"
};/**
 * Displays the current time
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.CurrentTimeDisplay = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);

    player.on('timeupdate', vjs.bind(this, this.updateContent));
  }
});

vjs.CurrentTimeDisplay.prototype.createEl = function(){
  var el = vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-current-time vjs-time-controls vjs-control'
  });

  this.content = vjs.createEl('div', {
    className: 'vjs-current-time-display',
    innerHTML: '<span class="vjs-control-text">Current Time </span>' + '0:00', // label the current time for screen reader users
    'aria-live': 'off' // tell screen readers not to automatically read the time as it changes
  });

  el.appendChild(vjs.createEl('div').appendChild(this.content));
  return el;
};

vjs.CurrentTimeDisplay.prototype.updateContent = function(){
  // Allows for smooth scrubbing, when player can't keep up.
  var time = (this.player_.scrubbing) ? this.player_.getCache().currentTime : this.player_.currentTime();
  this.content.innerHTML = '<span class="vjs-control-text">Current Time </span>' + vjs.formatTime(time, this.player_.duration());
};

/**
 * Displays the duration
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.DurationDisplay = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);

    player.on('timeupdate', vjs.bind(this, this.updateContent)); // this might need to be changes to 'durationchange' instead of 'timeupdate' eventually, however the durationchange event fires before this.player_.duration() is set, so the value cannot be written out using this method. Once the order of durationchange and this.player_.duration() being set is figured out, this can be updated.
  }
});

vjs.DurationDisplay.prototype.createEl = function(){
  var el = vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-duration vjs-time-controls vjs-control'
  });

  this.content = vjs.createEl('div', {
    className: 'vjs-duration-display',
    innerHTML: '<span class="vjs-control-text">Duration Time </span>' + '0:00', // label the duration time for screen reader users
    'aria-live': 'off' // tell screen readers not to automatically read the time as it changes
  });

  el.appendChild(vjs.createEl('div').appendChild(this.content));
  return el;
};

vjs.DurationDisplay.prototype.updateContent = function(){
  var duration = this.player_.duration();
  if (duration) {
      this.content.innerHTML = '<span class="vjs-control-text">Duration Time </span>' + vjs.formatTime(duration); // label the duration time for screen reader users
  }
};

/**
 * Time Separator (Not used in main skin, but still available, and could be used as a 'spare element')
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.TimeDivider = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);
  }
});

vjs.TimeDivider.prototype.createEl = function(){
  return vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-time-divider',
    innerHTML: '<div><span>/</span></div>'
  });
};

/**
 * Displays the time left in the video
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.RemainingTimeDisplay = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);

    player.on('timeupdate', vjs.bind(this, this.updateContent));
  }
});

vjs.RemainingTimeDisplay.prototype.createEl = function(){
  var el = vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-remaining-time vjs-time-controls vjs-control'
  });

  this.content = vjs.createEl('div', {
    className: 'vjs-remaining-time-display',
    innerHTML: '<span class="vjs-control-text">Remaining Time </span>' + '-0:00', // label the remaining time for screen reader users
    'aria-live': 'off' // tell screen readers not to automatically read the time as it changes
  });

  el.appendChild(vjs.createEl('div').appendChild(this.content));
  return el;
};

vjs.RemainingTimeDisplay.prototype.updateContent = function(){
  if (this.player_.duration()) {
    this.content.innerHTML = '<span class="vjs-control-text">Remaining Time </span>' + '-'+ vjs.formatTime(this.player_.remainingTime());
  }

  // Allows for smooth scrubbing, when player can't keep up.
  // var time = (this.player_.scrubbing) ? this.player_.getCache().currentTime : this.player_.currentTime();
  // this.content.innerHTML = vjs.formatTime(time, this.player_.duration());
};
/**
 * Toggle fullscreen video
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.FullscreenToggle = vjs.Button.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Button.call(this, player, options);
  }
});

vjs.FullscreenToggle.prototype.buttonText = 'Fullscreen';

vjs.FullscreenToggle.prototype.buildCSSClass = function(){
  return 'vjs-fullscreen-control ' + vjs.Button.prototype.buildCSSClass.call(this);
};

vjs.FullscreenToggle.prototype.onClick = function(){
  if (!this.player_.isFullScreen) {
    this.player_.requestFullScreen();
    this.el_.children[0].children[0].innerHTML = 'Non-Fullscreen'; // change the button text to "Non-Fullscreen"
  } else {
    this.player_.cancelFullScreen();
    this.el_.children[0].children[0].innerHTML = 'Fullscreen'; // change the button to "Fullscreen"
  }
};/**
 * Seek, Load Progress, and Play Progress
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.ProgressControl = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);
  }
});

vjs.ProgressControl.prototype.options_ = {
  children: {
    'seekBar': {}
  }
};

vjs.ProgressControl.prototype.createEl = function(){
  return vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-progress-control vjs-control'
  });
};

/**
 * Seek Bar and holder for the progress bars
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.SeekBar = vjs.Slider.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Slider.call(this, player, options);
    player.on('timeupdate', vjs.bind(this, this.updateARIAAttributes));
    player.ready(vjs.bind(this, this.updateARIAAttributes));
  }
});

vjs.SeekBar.prototype.options_ = {
  children: {
    'loadProgressBar': {},
    'playProgressBar': {},
    'seekHandle': {}
  },
  'barName': 'playProgressBar',
  'handleName': 'seekHandle'
};

vjs.SeekBar.prototype.playerEvent = 'timeupdate';

vjs.SeekBar.prototype.createEl = function(){
  return vjs.Slider.prototype.createEl.call(this, 'div', {
    className: 'vjs-progress-holder',
    'aria-label': 'video progress bar'
  });
};

vjs.SeekBar.prototype.updateARIAAttributes = function(){
    // Allows for smooth scrubbing, when player can't keep up.
    var time = (this.player_.scrubbing) ? this.player_.getCache().currentTime : this.player_.currentTime();
    this.el_.setAttribute('aria-valuenow',vjs.round(this.getPercent()*100, 2)); // machine readable value of progress bar (percentage complete)
    this.el_.setAttribute('aria-valuetext',vjs.formatTime(time, this.player_.duration())); // human readable value of progress bar (time complete)
};

vjs.SeekBar.prototype.getPercent = function(){
  var currentTime;
  // Flash RTMP provider will not report the correct time
  // immediately after a seek. This isn't noticeable if you're
  // seeking while the video is playing, but it is if you seek
  // while the video is paused.
  if (this.player_.techName === 'Flash' && this.player_.seeking()) {
    var cache = this.player_.getCache();
    if (cache.lastSetCurrentTime) {
      currentTime = cache.lastSetCurrentTime;
    }
    else {
      currentTime = this.player_.currentTime();
    }
  }
  else {
    currentTime = this.player_.currentTime();
  }

  return currentTime / this.player_.duration();
};

vjs.SeekBar.prototype.onMouseDown = function(event){
  vjs.Slider.prototype.onMouseDown.call(this, event);

  this.player_.scrubbing = true;

  this.videoWasPlaying = !this.player_.paused();
  this.player_.pause();
};

vjs.SeekBar.prototype.onMouseMove = function(event){
  var newTime = this.calculateDistance(event) * this.player_.duration();

  // Don't let video end while scrubbing.
  if (newTime == this.player_.duration()) { newTime = newTime - 0.1; }

  // Set new time (tell player to seek to new time)
  this.player_.currentTime(newTime);
};

vjs.SeekBar.prototype.onMouseUp = function(event){
  vjs.Slider.prototype.onMouseUp.call(this, event);

  this.player_.scrubbing = false;
  if (this.videoWasPlaying) {
    this.player_.play();
  }
};

vjs.SeekBar.prototype.stepForward = function(){
  this.player_.currentTime(this.player_.currentTime() + 5); // more quickly fast forward for keyboard-only users
};

vjs.SeekBar.prototype.stepBack = function(){
  this.player_.currentTime(this.player_.currentTime() - 5); // more quickly rewind for keyboard-only users
};


/**
 * Shows load progres
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.LoadProgressBar = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);
    player.on('progress', vjs.bind(this, this.update));
  }
});

vjs.LoadProgressBar.prototype.createEl = function(){
  return vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-load-progress',
    innerHTML: '<span class="vjs-control-text">Loaded: 0%</span>'
  });
};

vjs.LoadProgressBar.prototype.update = function(){
  if (this.el_.style) { this.el_.style.width = vjs.round(this.player_.bufferedPercent() * 100, 2) + '%'; }
};


/**
 * Shows play progress
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.PlayProgressBar = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);
  }
});

vjs.PlayProgressBar.prototype.createEl = function(){
  return vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-play-progress',
    innerHTML: '<span class="vjs-control-text">Progress: 0%</span>'
  });
};

/**
 * SeekBar component includes play progress bar, and seek handle
 * Needed so it can determine seek position based on handle position/size
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.SeekHandle = vjs.SliderHandle.extend();

/** @inheritDoc */
vjs.SeekHandle.prototype.defaultValue = '00:00';

/** @inheritDoc */
vjs.SeekHandle.prototype.createEl = function(){
  return vjs.SliderHandle.prototype.createEl.call(this, 'div', {
    className: 'vjs-seek-handle'
  });
};/**
 * Control the volume
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.VolumeControl = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);

    // hide volume controls when they're not supported by the current tech
    if (player.tech && player.tech.features && player.tech.features['volumeControl'] === false) {
      this.addClass('vjs-hidden');
    }
    player.on('loadstart', vjs.bind(this, function(){
      if (player.tech.features && player.tech.features['volumeControl'] === false) {
        this.addClass('vjs-hidden');
      } else {
        this.removeClass('vjs-hidden');
      }
    }));
  }
});

vjs.VolumeControl.prototype.options_ = {
  children: {
    'volumeBar': {}
  }
};

vjs.VolumeControl.prototype.createEl = function(){
  return vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-volume-control vjs-control'
  });
};

/**
 * Contains volume level
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.VolumeBar = vjs.Slider.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Slider.call(this, player, options);
    player.on('volumechange', vjs.bind(this, this.updateARIAAttributes));
    player.ready(vjs.bind(this, this.updateARIAAttributes));
    setTimeout(vjs.bind(this, this.update), 0); // update when elements is in DOM
  }
});

vjs.VolumeBar.prototype.updateARIAAttributes = function(){
  // Current value of volume bar as a percentage
  this.el_.setAttribute('aria-valuenow',vjs.round(this.player_.volume()*100, 2));
  this.el_.setAttribute('aria-valuetext',vjs.round(this.player_.volume()*100, 2)+'%');
};

vjs.VolumeBar.prototype.options_ = {
  children: {
    'volumeLevel': {},
    'volumeHandle': {}
  },
  'barName': 'volumeLevel',
  'handleName': 'volumeHandle'
};

vjs.VolumeBar.prototype.playerEvent = 'volumechange';

vjs.VolumeBar.prototype.createEl = function(){
  return vjs.Slider.prototype.createEl.call(this, 'div', {
    className: 'vjs-volume-bar',
    'aria-label': 'volume level'
  });
};

vjs.VolumeBar.prototype.onMouseMove = function(event) {
  this.player_.volume(this.calculateDistance(event));
};

vjs.VolumeBar.prototype.getPercent = function(){
  if (this.player_.muted()) {
    return 0;
  } else {
    return this.player_.volume();
  }
};

vjs.VolumeBar.prototype.stepForward = function(){
  this.player_.volume(this.player_.volume() + 0.1);
};

vjs.VolumeBar.prototype.stepBack = function(){
  this.player_.volume(this.player_.volume() - 0.1);
};

/**
 * Shows volume level
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.VolumeLevel = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);
  }
});

vjs.VolumeLevel.prototype.createEl = function(){
  return vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-volume-level',
    innerHTML: '<span class="vjs-control-text"></span>'
  });
};

/**
 * Change volume level
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
 vjs.VolumeHandle = vjs.SliderHandle.extend();

 /** @inheritDoc */
 vjs.VolumeHandle.prototype.defaultValue = '00:00';

 /** @inheritDoc */
 vjs.VolumeHandle.prototype.createEl = function(){
   return vjs.SliderHandle.prototype.createEl.call(this, 'div', {
     className: 'vjs-volume-handle'
   });
 };
/**
 * Mute the audio
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.MuteToggle = vjs.Button.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Button.call(this, player, options);

    player.on('volumechange', vjs.bind(this, this.update));

    // hide mute toggle if the current tech doesn't support volume control
    if (player.tech && player.tech.features && player.tech.features['volumeControl'] === false) {
      this.addClass('vjs-hidden');
    }
    player.on('loadstart', vjs.bind(this, function(){
      if (player.tech.features && player.tech.features['volumeControl'] === false) {
        this.addClass('vjs-hidden');
      } else {
        this.removeClass('vjs-hidden');
      }
    }));
  }
});

vjs.MuteToggle.prototype.createEl = function(){
  return vjs.Button.prototype.createEl.call(this, 'div', {
    className: 'vjs-mute-control vjs-control',
    innerHTML: '<div><span class="vjs-control-text">Mute</span></div>'
  });
};

vjs.MuteToggle.prototype.onClick = function(){
  this.player_.muted( this.player_.muted() ? false : true );
};

vjs.MuteToggle.prototype.update = function(){
  var vol = this.player_.volume(),
      level = 3;

  if (vol === 0 || this.player_.muted()) {
    level = 0;
  } else if (vol < 0.33) {
    level = 1;
  } else if (vol < 0.67) {
    level = 2;
  }

  // Don't rewrite the button text if the actual text doesn't change.
  // This causes unnecessary and confusing information for screen reader users.
  // This check is needed because this function gets called every time the volume level is changed.
  if(this.player_.muted()){
      if(this.el_.children[0].children[0].innerHTML!='Unmute'){
          this.el_.children[0].children[0].innerHTML = 'Unmute'; // change the button text to "Unmute"
      }
  } else {
      if(this.el_.children[0].children[0].innerHTML!='Mute'){
          this.el_.children[0].children[0].innerHTML = 'Mute'; // change the button text to "Mute"
      }
  }

  /* TODO improve muted icon classes */
  for (var i = 0; i < 4; i++) {
    vjs.removeClass(this.el_, 'vjs-vol-'+i);
  }
  vjs.addClass(this.el_, 'vjs-vol-'+level);
};
/**
 * Menu button with a popup for showing the volume slider.
 * @constructor
 */
vjs.VolumeMenuButton = vjs.MenuButton.extend({
  /** @constructor */
  init: function(player, options){
    vjs.MenuButton.call(this, player, options);

    // Same listeners as MuteToggle
    player.on('volumechange', vjs.bind(this, this.update));

    // hide mute toggle if the current tech doesn't support volume control
    if (player.tech && player.tech.features && player.tech.features.volumeControl === false) {
      this.addClass('vjs-hidden');
    }
    player.on('loadstart', vjs.bind(this, function(){
      if (player.tech.features && player.tech.features.volumeControl === false) {
        this.addClass('vjs-hidden');
      } else {
        this.removeClass('vjs-hidden');
      }
    }));
    this.addClass('vjs-menu-button');
  }
});

vjs.VolumeMenuButton.prototype.createMenu = function(){
  var menu = new vjs.Menu(this.player_, {
    contentElType: 'div'
  });
  var vc = new vjs.VolumeBar(this.player_, vjs.obj.merge({vertical: true}, this.options_.volumeBar));
  menu.addChild(vc);
  return menu;
};

vjs.VolumeMenuButton.prototype.onClick = function(){
  vjs.MuteToggle.prototype.onClick.call(this);
  vjs.MenuButton.prototype.onClick.call(this);
};

vjs.VolumeMenuButton.prototype.createEl = function(){
  return vjs.Button.prototype.createEl.call(this, 'div', {
    className: 'vjs-volume-menu-button vjs-menu-button vjs-control',
    innerHTML: '<div><span class="vjs-control-text">Mute</span></div>'
  });
};
vjs.VolumeMenuButton.prototype.update = vjs.MuteToggle.prototype.update;
/* Poster Image
================================================================================ */
/**
 * Poster image. Shows before the video plays.
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.PosterImage = vjs.Button.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Button.call(this, player, options);

    if (!player.poster() || !player.controls()) {
      this.hide();
    }

    player.on('play', vjs.bind(this, this.hide));
  }
});

vjs.PosterImage.prototype.createEl = function(){
  var el = vjs.createEl('div', {
        className: 'vjs-poster',

        // Don't want poster to be tabbable.
        tabIndex: -1
      }),
      poster = this.player_.poster();

  if (poster) {
    if ('backgroundSize' in el.style) {
      el.style.backgroundImage = 'url("' + poster + '")';
    } else {
      el.appendChild(vjs.createEl('img', { src: poster }));
    }
  }

  return el;
};

vjs.PosterImage.prototype.onClick = function(){
  // Only accept clicks when controls are enabled
  if (this.player().controls()) {
    this.player_.play();
  }
};
/* Loading Spinner
================================================================================ */
/**
 * Loading spinner for waiting events
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.LoadingSpinner = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);

    player.on('canplay', vjs.bind(this, this.hide));
    player.on('canplaythrough', vjs.bind(this, this.hide));
    player.on('playing', vjs.bind(this, this.hide));
    player.on('seeked', vjs.bind(this, this.hide));

    player.on('seeking', vjs.bind(this, this.show));

    // in some browsers seeking does not trigger the 'playing' event,
    // so we also need to trap 'seeked' if we are going to set a
    // 'seeking' event
    player.on('seeked', vjs.bind(this, this.hide));

    player.on('error', vjs.bind(this, this.show));

    // Not showing spinner on stalled any more. Browsers may stall and then not trigger any events that would remove the spinner.
    // Checked in Chrome 16 and Safari 5.1.2. http://help.videojs.com/discussions/problems/883-why-is-the-download-progress-showing
    // player.on('stalled', vjs.bind(this, this.show));

    player.on('waiting', vjs.bind(this, this.show));
  }
});

vjs.LoadingSpinner.prototype.createEl = function(){
  return vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-loading-spinner'
  });
};
/* Big Play Button
================================================================================ */
/**
 * Initial play button. Shows before the video has played. The hiding of the
 * big play button is done via CSS and player states.
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.BigPlayButton = vjs.Button.extend();

vjs.BigPlayButton.prototype.createEl = function(){
  return vjs.Button.prototype.createEl.call(this, 'div', {
    className: 'vjs-big-play-button',
    innerHTML: '<span></span>',
    'aria-label': 'play video'
  });
};

vjs.BigPlayButton.prototype.onClick = function(){
  this.player_.play();
};
/**
 * @fileoverview Media Technology Controller - Base class for media playback
 * technology controllers like Flash and HTML5
 */

/**
 * Base class for media (HTML5 Video, Flash) controllers
 * @param {vjs.Player|Object} player  Central player instance
 * @param {Object=} options Options object
 * @constructor
 */
vjs.MediaTechController = vjs.Component.extend({
  /** @constructor */
  init: function(player, options, ready){
    vjs.Component.call(this, player, options, ready);

    this.initControlsListeners();
  }
});

/**
 * Set up click and touch listeners for the playback element
 * On desktops, a click on the video itself will toggle playback,
 * on a mobile device a click on the video toggles controls.
 * (toggling controls is done by toggling the user state between active and
 * inactive)
 *
 * A tap can signal that a user has become active, or has become inactive
 * e.g. a quick tap on an iPhone movie should reveal the controls. Another
 * quick tap should hide them again (signaling the user is in an inactive
 * viewing state)
 *
 * In addition to this, we still want the user to be considered inactive after
 * a few seconds of inactivity.
 *
 * Note: the only part of iOS interaction we can't mimic with this setup
 * is a touch and hold on the video element counting as activity in order to
 * keep the controls showing, but that shouldn't be an issue. A touch and hold on
 * any controls will still keep the user active
 */
vjs.MediaTechController.prototype.initControlsListeners = function(){
  var player, tech, activateControls, deactivateControls;

  tech = this;
  player = this.player();

  var activateControls = function(){
    if (player.controls() && !player.usingNativeControls()) {
      tech.addControlsListeners();
    }
  };

  deactivateControls = vjs.bind(tech, tech.removeControlsListeners);

  // Set up event listeners once the tech is ready and has an element to apply
  // listeners to
  this.ready(activateControls);
  player.on('controlsenabled', activateControls);
  player.on('controlsdisabled', deactivateControls);
};

vjs.MediaTechController.prototype.addControlsListeners = function(){
  var preventBubble, userWasActive;

  // Some browsers (Chrome & IE) don't trigger a click on a flash swf, but do
  // trigger mousedown/up.
  // http://stackoverflow.com/questions/1444562/javascript-onclick-event-over-flash-object
  // Any touch events are set to block the mousedown event from happening
  this.on('mousedown', this.onClick);

  // We need to block touch events on the video element from bubbling up,
  // otherwise they'll signal activity prematurely. The specific use case is
  // when the video is playing and the controls have faded out. In this case
  // only a tap (fast touch) should toggle the user active state and turn the
  // controls back on. A touch and move or touch and hold should not trigger
  // the controls (per iOS as an example at least)
  //
  // We always want to stop propagation on touchstart because touchstart
  // at the player level starts the touchInProgress interval. We can still
  // report activity on the other events, but won't let them bubble for
  // consistency. We don't want to bubble a touchend without a touchstart.
  this.on('touchstart', function(event) {
    // Stop the mouse events from also happening
    event.preventDefault();
    event.stopPropagation();
    // Record if the user was active now so we don't have to keep polling it
    userWasActive = this.player_.userActive();
  });

  preventBubble = function(event){
    event.stopPropagation();
    if (userWasActive) {
      this.player_.reportUserActivity();
    }
  };

  // Treat all touch events the same for consistency
  this.on('touchmove', preventBubble);
  this.on('touchleave', preventBubble);
  this.on('touchcancel', preventBubble);
  this.on('touchend', preventBubble);

  // Turn on component tap events
  this.emitTapEvents();

  // The tap listener needs to come after the touchend listener because the tap
  // listener cancels out any reportedUserActivity when setting userActive(false)
  this.on('tap', this.onTap);
};

/**
 * Remove the listeners used for click and tap controls. This is needed for
 * toggling to controls disabled, where a tap/touch should do nothing.
 */
vjs.MediaTechController.prototype.removeControlsListeners = function(){
  // We don't want to just use `this.off()` because there might be other needed
  // listeners added by techs that extend this.
  this.off('tap');
  this.off('touchstart');
  this.off('touchmove');
  this.off('touchleave');
  this.off('touchcancel');
  this.off('touchend');
  this.off('click');
  this.off('mousedown');
};

/**
 * Handle a click on the media element. By default will play/pause the media.
 */
vjs.MediaTechController.prototype.onClick = function(event){
  // We're using mousedown to detect clicks thanks to Flash, but mousedown
  // will also be triggered with right-clicks, so we need to prevent that
  if (event.button !== 0) return;

  // When controls are disabled a click should not toggle playback because
  // the click is considered a control
  if (this.player().controls()) {
    if (this.player().paused()) {
      this.player().play();
    } else {
      this.player().pause();
    }
  }
};

/**
 * Handle a tap on the media element. By default it will toggle the user
 * activity state, which hides and shows the controls.
 */

vjs.MediaTechController.prototype.onTap = function(){
  this.player().userActive(!this.player().userActive());
};

vjs.MediaTechController.prototype.features = {
  'volumeControl': true,

  // Resizing plugins using request fullscreen reloads the plugin
  'fullscreenResize': false,

  // Optional events that we can manually mimic with timers
  // currently not triggered by video-js-swf
  'progressEvents': false,
  'timeupdateEvents': false
};

vjs.media = {};

/**
 * List of default API methods for any MediaTechController
 * @type {String}
 */
vjs.media.ApiMethods = 'play,pause,paused,currentTime,setCurrentTime,duration,buffered,volume,setVolume,muted,setMuted,width,height,supportsFullScreen,enterFullScreen,src,load,currentSrc,preload,setPreload,autoplay,setAutoplay,loop,setLoop,error,networkState,readyState,seeking,initialTime,startOffsetTime,played,seekable,ended,videoTracks,audioTracks,videoWidth,videoHeight,textTracks,defaultPlaybackRate,playbackRate,mediaGroup,controller,controls,defaultMuted'.split(',');
// Create placeholder methods for each that warn when a method isn't supported by the current playback technology

function createMethod(methodName){
  return function(){
    throw new Error('The "'+methodName+'" method is not available on the playback technology\'s API');
  };
}

for (var i = vjs.media.ApiMethods.length - 1; i >= 0; i--) {
  var methodName = vjs.media.ApiMethods[i];
  vjs.MediaTechController.prototype[vjs.media.ApiMethods[i]] = createMethod(methodName);
}
/**
 * @fileoverview HTML5 Media Controller - Wrapper for HTML5 Media API
 */

/**
 * HTML5 Media Controller - Wrapper for HTML5 Media API
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @param {Function=} ready
 * @constructor
 */
vjs.Html5 = vjs.MediaTechController.extend({
  /** @constructor */
  init: function(player, options, ready){
    // volume cannot be changed from 1 on iOS
    this.features['volumeControl'] = vjs.Html5.canControlVolume();

    // In iOS, if you move a video element in the DOM, it breaks video playback.
    this.features['movingMediaElementInDOM'] = !vjs.IS_IOS;

    // HTML video is able to automatically resize when going to fullscreen
    this.features['fullscreenResize'] = true;

    vjs.MediaTechController.call(this, player, options, ready);

    var source = options['source'];

    // If the element source is already set, we may have missed the loadstart event, and want to trigger it.
    // We don't want to set the source again and interrupt playback.
    if (source && this.el_.currentSrc == source.src) {
      player.trigger('loadstart');

    // Otherwise set the source if one was provided.
    } else if (source) {
      this.el_.src = source.src;
    }

    // Determine if native controls should be used
    // Our goal should be to get the custom controls on mobile solid everywhere
    // so we can remove this all together. Right now this will block custom
    // controls on touch enabled laptops like the Chrome Pixel
    if (vjs.TOUCH_ENABLED && player.options()['nativeControlsForTouch'] !== false) {
      this.useNativeControls();
    }

    // Chrome and Safari both have issues with autoplay.
    // In Safari (5.1.1), when we move the video element into the container div, autoplay doesn't work.
    // In Chrome (15), if you have autoplay + a poster + no controls, the video gets hidden (but audio plays)
    // This fixes both issues. Need to wait for API, so it updates displays correctly
    player.ready(function(){
      if (this.tag && this.options_['autoplay'] && this.paused()) {
        delete this.tag['poster']; // Chrome Fix. Fixed in Chrome v16.
        this.play();
      }
    });

    this.setupTriggers();
    this.triggerReady();
  }
});

vjs.Html5.prototype.dispose = function(){
  vjs.MediaTechController.prototype.dispose.call(this);
};

vjs.Html5.prototype.createEl = function(){
  var player = this.player_,
      // If possible, reuse original tag for HTML5 playback technology element
      el = player.tag,
      newEl;

  // Check if this browser supports moving the element into the box.
  // On the iPhone video will break if you move the element,
  // So we have to create a brand new element.
  if (!el || this.features['movingMediaElementInDOM'] === false) {

    // If the original tag is still there, remove it.
    if (el) {
      el['player'] = null;
      player.tag = null;
      player.el().removeChild(el);
      el = el.cloneNode(false);
    } else {
      el = vjs.createEl('video', {
        id:player.id() + '_html5_api',
        className:'vjs-tech'
      });
    }
    // associate the player with the new tag
    el['player'] = player;

    vjs.insertFirst(el, player.el());
  }

  // Update specific tag settings, in case they were overridden
  var attrs = ['autoplay','preload','loop','muted'];
  for (var i = attrs.length - 1; i >= 0; i--) {
    var attr = attrs[i];
    if (player.options_[attr] !== null) {
      el[attr] = player.options_[attr];
    }
  }

  return el;
  // jenniisawesome = true;
};

// Make video events trigger player events
// May seem verbose here, but makes other APIs possible.
vjs.Html5.prototype.setupTriggers = function(){
  for (var i = vjs.Html5.Events.length - 1; i >= 0; i--) {
    vjs.on(this.el_, vjs.Html5.Events[i], vjs.bind(this.player_, this.eventHandler));
  }
};
// Triggers removed using this.off when disposed

vjs.Html5.prototype.eventHandler = function(e){
  this.trigger(e);

  // No need for media events to bubble up.
  e.stopPropagation();
};

vjs.Html5.prototype.useNativeControls = function(){
  var tech, player, controlsOn, controlsOff, cleanUp;

  tech = this;
  player = this.player();

  // If the player controls are enabled turn on the native controls
  tech.setControls(player.controls());

  // Update the native controls when player controls state is updated
  controlsOn = function(){
    tech.setControls(true);
  };
  controlsOff = function(){
    tech.setControls(false);
  };
  player.on('controlsenabled', controlsOn);
  player.on('controlsdisabled', controlsOff);

  // Clean up when not using native controls anymore
  cleanUp = function(){
    player.off('controlsenabled', controlsOn);
    player.off('controlsdisabled', controlsOff);
  };
  tech.on('dispose', cleanUp);
  player.on('usingcustomcontrols', cleanUp);

  // Update the state of the player to using native controls
  player.usingNativeControls(true);
};


vjs.Html5.prototype.play = function(){ this.el_.play(); };
vjs.Html5.prototype.pause = function(){ this.el_.pause(); };
vjs.Html5.prototype.paused = function(){ return this.el_.paused; };

vjs.Html5.prototype.currentTime = function(){ return this.el_.currentTime; };
vjs.Html5.prototype.setCurrentTime = function(seconds){
  try {
    this.el_.currentTime = seconds;
  } catch(e) {
    vjs.log(e, 'Video is not ready. (Video.js)');
    // this.warning(VideoJS.warnings.videoNotReady);
  }
};

vjs.Html5.prototype.duration = function(){ return this.el_.duration || 0; };
vjs.Html5.prototype.buffered = function(){ return this.el_.buffered; };

vjs.Html5.prototype.volume = function(){ return this.el_.volume; };
vjs.Html5.prototype.setVolume = function(percentAsDecimal){ this.el_.volume = percentAsDecimal; };
vjs.Html5.prototype.muted = function(){ return this.el_.muted; };
vjs.Html5.prototype.setMuted = function(muted){ this.el_.muted = muted; };

vjs.Html5.prototype.width = function(){ return this.el_.offsetWidth; };
vjs.Html5.prototype.height = function(){ return this.el_.offsetHeight; };

vjs.Html5.prototype.supportsFullScreen = function(){
  if (typeof this.el_.webkitEnterFullScreen == 'function') {

    // Seems to be broken in Chromium/Chrome && Safari in Leopard
    if (/Android/.test(vjs.USER_AGENT) || !/Chrome|Mac OS X 10.5/.test(vjs.USER_AGENT)) {
      return true;
    }
  }
  return false;
};

vjs.Html5.prototype.enterFullScreen = function(){
  var video = this.el_;
  if (video.paused && video.networkState <= video.HAVE_METADATA) {
    // attempt to prime the video element for programmatic access
    // this isn't necessary on the desktop but shouldn't hurt
    this.el_.play();

    // playing and pausing synchronously during the transition to fullscreen
    // can get iOS ~6.1 devices into a play/pause loop
    setTimeout(function(){
      video.pause();
      video.webkitEnterFullScreen();
    }, 0);
  } else {
    video.webkitEnterFullScreen();
  }
};
vjs.Html5.prototype.exitFullScreen = function(){
  this.el_.webkitExitFullScreen();
};
vjs.Html5.prototype.src = function(src){ this.el_.src = src; };
vjs.Html5.prototype.load = function(){ this.el_.load(); };
vjs.Html5.prototype.currentSrc = function(){ return this.el_.currentSrc; };

vjs.Html5.prototype.preload = function(){ return this.el_.preload; };
vjs.Html5.prototype.setPreload = function(val){ this.el_.preload = val; };

vjs.Html5.prototype.autoplay = function(){ return this.el_.autoplay; };
vjs.Html5.prototype.setAutoplay = function(val){ this.el_.autoplay = val; };

vjs.Html5.prototype.controls = function(){ return this.el_.controls; }
vjs.Html5.prototype.setControls = function(val){ this.el_.controls = !!val; }

vjs.Html5.prototype.loop = function(){ return this.el_.loop; };
vjs.Html5.prototype.setLoop = function(val){ this.el_.loop = val; };

vjs.Html5.prototype.error = function(){ return this.el_.error; };
vjs.Html5.prototype.seeking = function(){ return this.el_.seeking; };
vjs.Html5.prototype.ended = function(){ return this.el_.ended; };
vjs.Html5.prototype.defaultMuted = function(){ return this.el_.defaultMuted; };

/* HTML5 Support Testing ---------------------------------------------------- */

vjs.Html5.isSupported = function(){
  return !!vjs.TEST_VID.canPlayType;
};

vjs.Html5.canPlaySource = function(srcObj){
  // IE9 on Windows 7 without MediaPlayer throws an error here
  // https://github.com/videojs/video.js/issues/519
  try {
    return !!vjs.TEST_VID.canPlayType(srcObj.type);
  } catch(e) {
    return '';
  }
  // TODO: Check Type
  // If no Type, check ext
  // Check Media Type
};

vjs.Html5.canControlVolume = function(){
  var volume =  vjs.TEST_VID.volume;
  vjs.TEST_VID.volume = (volume / 2) + 0.1;
  return volume !== vjs.TEST_VID.volume;
};

// List of all HTML5 events (various uses).
vjs.Html5.Events = 'loadstart,suspend,abort,error,emptied,stalled,loadedmetadata,loadeddata,canplay,canplaythrough,playing,waiting,seeking,seeked,ended,durationchange,timeupdate,progress,play,pause,ratechange,volumechange'.split(',');


// HTML5 Feature detection and Device Fixes --------------------------------- //

  // Override Android 2.2 and less canPlayType method which is broken
if (vjs.IS_OLD_ANDROID) {
  document.createElement('video').constructor.prototype.canPlayType = function(type){
    return (type && type.toLowerCase().indexOf('video/mp4') != -1) ? 'maybe' : '';
  };
}
/**
 * @fileoverview VideoJS-SWF - Custom Flash Player with HTML5-ish API
 * https://github.com/zencoder/video-js-swf
 * Not using setupTriggers. Using global onEvent func to distribute events
 */

/**
 * HTML5 Media Controller - Wrapper for HTML5 Media API
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @param {Function=} ready
 * @constructor
 */
vjs.Flash = vjs.MediaTechController.extend({
  /** @constructor */
  init: function(player, options, ready){
    vjs.MediaTechController.call(this, player, options, ready);

    var source = options['source'],

        // Which element to embed in
        parentEl = options['parentEl'],

        // Create a temporary element to be replaced by swf object
        placeHolder = this.el_ = vjs.createEl('div', { id: player.id() + '_temp_flash' }),

        // Generate ID for swf object
        objId = player.id()+'_flash_api',

        // Store player options in local var for optimization
        // TODO: switch to using player methods instead of options
        // e.g. player.autoplay();
        playerOptions = player.options_,

        // Merge default flashvars with ones passed in to init
        flashVars = vjs.obj.merge({

          // SWF Callback Functions
          'readyFunction': 'videojs.Flash.onReady',
          'eventProxyFunction': 'videojs.Flash.onEvent',
          'errorEventProxyFunction': 'videojs.Flash.onError',

          // Player Settings
          'autoplay': playerOptions.autoplay,
          'preload': playerOptions.preload,
          'loop': playerOptions.loop,
          'muted': playerOptions.muted

        }, options['flashVars']),

        // Merge default parames with ones passed in
        params = vjs.obj.merge({
          'wmode': 'opaque', // Opaque is needed to overlay controls, but can affect playback performance
          'bgcolor': '#000000' // Using bgcolor prevents a white flash when the object is loading
        }, options['params']),

        // Merge default attributes with ones passed in
        attributes = vjs.obj.merge({
          'id': objId,
          'name': objId, // Both ID and Name needed or swf to identifty itself
          'class': 'vjs-tech'
        }, options['attributes'])
    ;

    // If source was supplied pass as a flash var.
    if (source) {
      if (source.type && vjs.Flash.isStreamingType(source.type)) {
        var parts = vjs.Flash.streamToParts(source.src);
        flashVars['rtmpConnection'] = encodeURIComponent(parts.connection);
        flashVars['rtmpStream'] = encodeURIComponent(parts.stream);
      }
      else {
        flashVars['src'] = encodeURIComponent(vjs.getAbsoluteURL(source.src));
      }
    }

    // Add placeholder to player div
    vjs.insertFirst(placeHolder, parentEl);

    // Having issues with Flash reloading on certain page actions (hide/resize/fullscreen) in certain browsers
    // This allows resetting the playhead when we catch the reload
    if (options['startTime']) {
      this.ready(function(){
        this.load();
        this.play();
        this.currentTime(options['startTime']);
      });
    }

    // Flash iFrame Mode
    // In web browsers there are multiple instances where changing the parent element or visibility of a plugin causes the plugin to reload.
    // - Firefox just about always. https://bugzilla.mozilla.org/show_bug.cgi?id=90268 (might be fixed by version 13)
    // - Webkit when hiding the plugin
    // - Webkit and Firefox when using requestFullScreen on a parent element
    // Loading the flash plugin into a dynamically generated iFrame gets around most of these issues.
    // Issues that remain include hiding the element and requestFullScreen in Firefox specifically

    // There's on particularly annoying issue with this method which is that Firefox throws a security error on an offsite Flash object loaded into a dynamically created iFrame.
    // Even though the iframe was inserted into a page on the web, Firefox + Flash considers it a local app trying to access an internet file.
    // I tried mulitple ways of setting the iframe src attribute but couldn't find a src that worked well. Tried a real/fake source, in/out of domain.
    // Also tried a method from stackoverflow that caused a security error in all browsers. http://stackoverflow.com/questions/2486901/how-to-set-document-domain-for-a-dynamically-generated-iframe
    // In the end the solution I found to work was setting the iframe window.location.href right before doing a document.write of the Flash object.
    // The only downside of this it seems to trigger another http request to the original page (no matter what's put in the href). Not sure why that is.

    // NOTE (2012-01-29): Cannot get Firefox to load the remote hosted SWF into a dynamically created iFrame
    // Firefox 9 throws a security error, unleess you call location.href right before doc.write.
    //    Not sure why that even works, but it causes the browser to look like it's continuously trying to load the page.
    // Firefox 3.6 keeps calling the iframe onload function anytime I write to it, causing an endless loop.

    if (options['iFrameMode'] === true && !vjs.IS_FIREFOX) {

      // Create iFrame with vjs-tech class so it's 100% width/height
      var iFrm = vjs.createEl('iframe', {
        'id': objId + '_iframe',
        'name': objId + '_iframe',
        'className': 'vjs-tech',
        'scrolling': 'no',
        'marginWidth': 0,
        'marginHeight': 0,
        'frameBorder': 0
      });

      // Update ready function names in flash vars for iframe window
      flashVars['readyFunction'] = 'ready';
      flashVars['eventProxyFunction'] = 'events';
      flashVars['errorEventProxyFunction'] = 'errors';

      // Tried multiple methods to get this to work in all browsers

      // Tried embedding the flash object in the page first, and then adding a place holder to the iframe, then replacing the placeholder with the page object.
      // The goal here was to try to load the swf URL in the parent page first and hope that got around the firefox security error
      // var newObj = vjs.Flash.embed(options['swf'], placeHolder, flashVars, params, attributes);
      // (in onload)
      //  var temp = vjs.createEl('a', { id:'asdf', innerHTML: 'asdf' } );
      //  iDoc.body.appendChild(temp);

      // Tried embedding the flash object through javascript in the iframe source.
      // This works in webkit but still triggers the firefox security error
      // iFrm.src = 'javascript: document.write('"+vjs.Flash.getEmbedCode(options['swf'], flashVars, params, attributes)+"');";

      // Tried an actual local iframe just to make sure that works, but it kills the easiness of the CDN version if you require the user to host an iframe
      // We should add an option to host the iframe locally though, because it could help a lot of issues.
      // iFrm.src = "iframe.html";

      // Wait until iFrame has loaded to write into it.
      vjs.on(iFrm, 'load', vjs.bind(this, function(){

        var iDoc,
            iWin = iFrm.contentWindow;

        // The one working method I found was to use the iframe's document.write() to create the swf object
        // This got around the security issue in all browsers except firefox.
        // I did find a hack where if I call the iframe's window.location.href='', it would get around the security error
        // However, the main page would look like it was loading indefinitely (URL bar loading spinner would never stop)
        // Plus Firefox 3.6 didn't work no matter what I tried.
        // if (vjs.USER_AGENT.match('Firefox')) {
        //   iWin.location.href = '';
        // }

        // Get the iFrame's document depending on what the browser supports
        iDoc = iFrm.contentDocument ? iFrm.contentDocument : iFrm.contentWindow.document;

        // Tried ensuring both document domains were the same, but they already were, so that wasn't the issue.
        // Even tried adding /. that was mentioned in a browser security writeup
        // document.domain = document.domain+'/.';
        // iDoc.domain = document.domain+'/.';

        // Tried adding the object to the iframe doc's innerHTML. Security error in all browsers.
        // iDoc.body.innerHTML = swfObjectHTML;

        // Tried appending the object to the iframe doc's body. Security error in all browsers.
        // iDoc.body.appendChild(swfObject);

        // Using document.write actually got around the security error that browsers were throwing.
        // Again, it's a dynamically generated (same domain) iframe, loading an external Flash swf.
        // Not sure why that's a security issue, but apparently it is.
        iDoc.write(vjs.Flash.getEmbedCode(options['swf'], flashVars, params, attributes));

        // Setting variables on the window needs to come after the doc write because otherwise they can get reset in some browsers
        // So far no issues with swf ready event being called before it's set on the window.
        iWin['player'] = this.player_;

        // Create swf ready function for iFrame window
        iWin['ready'] = vjs.bind(this.player_, function(currSwf){
          var el = iDoc.getElementById(currSwf),
              player = this,
              tech = player.tech;

          // Update reference to playback technology element
          tech.el_ = el;

          // Make sure swf is actually ready. Sometimes the API isn't actually yet.
          vjs.Flash.checkReady(tech);
        });

        // Create event listener for all swf events
        iWin['events'] = vjs.bind(this.player_, function(swfID, eventName){
          var player = this;
          if (player && player.techName === 'flash') {
            player.trigger(eventName);
          }
        });

        // Create error listener for all swf errors
        iWin['errors'] = vjs.bind(this.player_, function(swfID, eventName){
          vjs.log('Flash Error', eventName);
        });

      }));

      // Replace placeholder with iFrame (it will load now)
      placeHolder.parentNode.replaceChild(iFrm, placeHolder);

    // If not using iFrame mode, embed as normal object
    } else {
      vjs.Flash.embed(options['swf'], placeHolder, flashVars, params, attributes);
    }
  }
});

vjs.Flash.prototype.dispose = function(){
  vjs.MediaTechController.prototype.dispose.call(this);
};

vjs.Flash.prototype.play = function(){
  this.el_.vjs_play();
};

vjs.Flash.prototype.pause = function(){
  this.el_.vjs_pause();
};

vjs.Flash.prototype.src = function(src){
  if (vjs.Flash.isStreamingSrc(src)) {
    src = vjs.Flash.streamToParts(src);
    this.setRtmpConnection(src.connection);
    this.setRtmpStream(src.stream);
  }
  else {
    // Make sure source URL is abosolute.
    src = vjs.getAbsoluteURL(src);
    this.el_.vjs_src(src);
  }

  // Currently the SWF doesn't autoplay if you load a source later.
  // e.g. Load player w/ no source, wait 2s, set src.
  if (this.player_.autoplay()) {
    var tech = this;
    setTimeout(function(){ tech.play(); }, 0);
  }
};

vjs.Flash.prototype.currentSrc = function(){
  var src = this.el_.vjs_getProperty('currentSrc');
  // no src, check and see if RTMP
  if (src == null) {
    var connection = this.rtmpConnection(),
        stream = this.rtmpStream();

    if (connection && stream) {
      src = vjs.Flash.streamFromParts(connection, stream);
    }
  }
  return src;
};

vjs.Flash.prototype.load = function(){
  this.el_.vjs_load();
};

vjs.Flash.prototype.poster = function(){
  this.el_.vjs_getProperty('poster');
};

vjs.Flash.prototype.buffered = function(){
  return vjs.createTimeRange(0, this.el_.vjs_getProperty('buffered'));
};

vjs.Flash.prototype.supportsFullScreen = function(){
  return false; // Flash does not allow fullscreen through javascript
};

vjs.Flash.prototype.enterFullScreen = function(){
  return false;
};


// Create setters and getters for attributes
var api = vjs.Flash.prototype,
    readWrite = 'rtmpConnection,rtmpStream,preload,currentTime,defaultPlaybackRate,playbackRate,autoplay,loop,mediaGroup,controller,controls,volume,muted,defaultMuted'.split(','),
    readOnly = 'error,currentSrc,networkState,readyState,seeking,initialTime,duration,startOffsetTime,paused,played,seekable,ended,videoTracks,audioTracks,videoWidth,videoHeight,textTracks'.split(',');
    // Overridden: buffered

/**
 * @this {*}
 */
var createSetter = function(attr){
  var attrUpper = attr.charAt(0).toUpperCase() + attr.slice(1);
  api['set'+attrUpper] = function(val){ return this.el_.vjs_setProperty(attr, val); };
};

/**
 * @this {*}
 */
var createGetter = function(attr){
  api[attr] = function(){ return this.el_.vjs_getProperty(attr); };
};

(function(){
  var i;
  // Create getter and setters for all read/write attributes
  for (i = 0; i < readWrite.length; i++) {
    createGetter(readWrite[i]);
    createSetter(readWrite[i]);
  }

  // Create getters for read-only attributes
  for (i = 0; i < readOnly.length; i++) {
    createGetter(readOnly[i]);
  }
})();

/* Flash Support Testing -------------------------------------------------------- */

vjs.Flash.isSupported = function(){
  return vjs.Flash.version()[0] >= 10;
  // return swfobject.hasFlashPlayerVersion('10');
};

vjs.Flash.canPlaySource = function(srcObj){
  if (srcObj.type in vjs.Flash.formats || srcObj.type in vjs.Flash.streamingFormats) { return 'maybe'; }
};

vjs.Flash.formats = {
  'video/flv': 'FLV',
  'video/x-flv': 'FLV',
  'video/mp4': 'MP4',
  'video/m4v': 'MP4'
};

vjs.Flash.streamingFormats = {
  'rtmp/mp4': 'MP4',
  'rtmp/flv': 'FLV'
};

vjs.Flash['onReady'] = function(currSwf){
  var el = vjs.el(currSwf);

  // Get player from box
  // On firefox reloads, el might already have a player
  var player = el['player'] || el.parentNode['player'],
      tech = player.tech;

  // Reference player on tech element
  el['player'] = player;

  // Update reference to playback technology element
  tech.el_ = el;

  vjs.Flash.checkReady(tech);
};

// The SWF isn't alwasy ready when it says it is. Sometimes the API functions still need to be added to the object.
// If it's not ready, we set a timeout to check again shortly.
vjs.Flash.checkReady = function(tech){

  // Check if API property exists
  if (tech.el().vjs_getProperty) {

    // If so, tell tech it's ready
    tech.triggerReady();

  // Otherwise wait longer.
  } else {

    setTimeout(function(){
      vjs.Flash.checkReady(tech);
    }, 50);

  }
};

// Trigger events from the swf on the player
vjs.Flash['onEvent'] = function(swfID, eventName){
  var player = vjs.el(swfID)['player'];
  player.trigger(eventName);
};

// Log errors from the swf
vjs.Flash['onError'] = function(swfID, err){
  var player = vjs.el(swfID)['player'];
  player.trigger('error');
  vjs.log('Flash Error', err, swfID);
};

// Flash Version Check
vjs.Flash.version = function(){
  var version = '0,0,0';

  // IE
  try {
    version = new window.ActiveXObject('ShockwaveFlash.ShockwaveFlash').GetVariable('$version').replace(/\D+/g, ',').match(/^,?(.+),?$/)[1];

  // other browsers
  } catch(e) {
    try {
      if (navigator.mimeTypes['application/x-shockwave-flash'].enabledPlugin){
        version = (navigator.plugins['Shockwave Flash 2.0'] || navigator.plugins['Shockwave Flash']).description.replace(/\D+/g, ',').match(/^,?(.+),?$/)[1];
      }
    } catch(err) {}
  }
  return version.split(',');
};

// Flash embedding method. Only used in non-iframe mode
vjs.Flash.embed = function(swf, placeHolder, flashVars, params, attributes){
  var code = vjs.Flash.getEmbedCode(swf, flashVars, params, attributes),

      // Get element by embedding code and retrieving created element
      obj = vjs.createEl('div', { innerHTML: code }).childNodes[0],

      par = placeHolder.parentNode
  ;

  placeHolder.parentNode.replaceChild(obj, placeHolder);

  // IE6 seems to have an issue where it won't initialize the swf object after injecting it.
  // This is a dumb fix
  var newObj = par.childNodes[0];
  setTimeout(function(){
    newObj.style.display = 'block';
  }, 1000);

  return obj;

};

vjs.Flash.getEmbedCode = function(swf, flashVars, params, attributes){

  var objTag = '<object type="application/x-shockwave-flash"',
      flashVarsString = '',
      paramsString = '',
      attrsString = '';

  // Convert flash vars to string
  if (flashVars) {
    vjs.obj.each(flashVars, function(key, val){
      flashVarsString += (key + '=' + val + '&amp;');
    });
  }

  // Add swf, flashVars, and other default params
  params = vjs.obj.merge({
    'movie': swf,
    'flashvars': flashVarsString,
    'allowScriptAccess': 'always', // Required to talk to swf
    'allowNetworking': 'all' // All should be default, but having security issues.
  }, params);

  // Create param tags string
  vjs.obj.each(params, function(key, val){
    paramsString += '<param name="'+key+'" value="'+val+'" />';
  });

  attributes = vjs.obj.merge({
    // Add swf to attributes (need both for IE and Others to work)
    'data': swf,

    // Default to 100% width/height
    'width': '100%',
    'height': '100%'

  }, attributes);

  // Create Attributes string
  vjs.obj.each(attributes, function(key, val){
    attrsString += (key + '="' + val + '" ');
  });

  return objTag + attrsString + '>' + paramsString + '</object>';
};

vjs.Flash.streamFromParts = function(connection, stream) {
  return connection + '&' + stream;
};

vjs.Flash.streamToParts = function(src) {
  var parts = {
    connection: '',
    stream: ''
  };

  if (! src) {
    return parts;
  }

  // Look for the normal URL separator we expect, '&'.
  // If found, we split the URL into two pieces around the
  // first '&'.
  var connEnd = src.indexOf('&');
  var streamBegin;
  if (connEnd !== -1) {
    streamBegin = connEnd + 1;
  }
  else {
    // If there's not a '&', we use the last '/' as the delimiter.
    connEnd = streamBegin = src.lastIndexOf('/') + 1;
    if (connEnd === 0) {
      // really, there's not a '/'?
      connEnd = streamBegin = src.length;
    }
  }
  parts.connection = src.substring(0, connEnd);
  parts.stream = src.substring(streamBegin, src.length);

  return parts;
};

vjs.Flash.isStreamingType = function(srcType) {
  return srcType in vjs.Flash.streamingFormats;
};

// RTMP has four variations, any string starting
// with one of these protocols should be valid
vjs.Flash.RTMP_RE = /^rtmp[set]?:\/\//i;

vjs.Flash.isStreamingSrc = function(src) {
  return vjs.Flash.RTMP_RE.test(src);
};
/**
 * @constructor
 */
vjs.MediaLoader = vjs.Component.extend({
  /** @constructor */
  init: function(player, options, ready){
    vjs.Component.call(this, player, options, ready);

    // If there are no sources when the player is initialized,
    // load the first supported playback technology.
    if (!player.options_['sources'] || player.options_['sources'].length === 0) {
      for (var i=0,j=player.options_['techOrder']; i<j.length; i++) {
        var techName = vjs.capitalize(j[i]),
            tech = window['videojs'][techName];

        // Check if the browser supports this technology
        if (tech && tech.isSupported()) {
          player.loadTech(techName);
          break;
        }
      }
    } else {
      // // Loop through playback technologies (HTML5, Flash) and check for support.
      // // Then load the best source.
      // // A few assumptions here:
      // //   All playback technologies respect preload false.
      player.src(player.options_['sources']);
    }
  }
});/**
 * @fileoverview Text Tracks
 * Text tracks are tracks of timed text events.
 * Captions - text displayed over the video for the hearing impared
 * Subtitles - text displayed over the video for those who don't understand langauge in the video
 * Chapters - text displayed in a menu allowing the user to jump to particular points (chapters) in the video
 * Descriptions (not supported yet) - audio descriptions that are read back to the user by a screen reading device
 */

// Player Additions - Functions add to the player object for easier access to tracks

/**
 * List of associated text tracks
 * @type {Array}
 * @private
 */
vjs.Player.prototype.textTracks_;

/**
 * Get an array of associated text tracks. captions, subtitles, chapters, descriptions
 * http://www.w3.org/html/wg/drafts/html/master/embedded-content-0.html#dom-media-texttracks
 * @return {Array}           Array of track objects
 */
vjs.Player.prototype.textTracks = function(){
  this.textTracks_ = this.textTracks_ || [];
  return this.textTracks_;
};

/**
 * Add a text track
 * In addition to the W3C settings we allow adding additional info through options.
 * http://www.w3.org/html/wg/drafts/html/master/embedded-content-0.html#dom-media-addtexttrack
 * @param {String}  kind        Captions, subtitles, chapters, descriptions, or metadata
 * @param {String=} label       Optional label
 * @param {String=} language    Optional language
 * @param {Object=} options     Additional track options, like src
 */
vjs.Player.prototype.addTextTrack = function(kind, label, language, options){
  var tracks = this.textTracks_ = this.textTracks_ || [];
  options = options || {};

  options['kind'] = kind;
  options['label'] = label;
  options['language'] = language;

  // HTML5 Spec says default to subtitles.
  // Uppercase first letter to match class names
  var Kind = vjs.capitalize(kind || 'subtitles');

  // Create correct texttrack class. CaptionsTrack, etc.
  var track = new window['videojs'][Kind + 'Track'](this, options);

  tracks.push(track);

  // If track.dflt() is set, start showing immediately
  // TODO: Add a process to deterime the best track to show for the specific kind
  // Incase there are mulitple defaulted tracks of the same kind
  // Or the user has a set preference of a specific language that should override the default
  // if (track.dflt()) {
  //   this.ready(vjs.bind(track, track.show));
  // }

  return track;
};

/**
 * Add an array of text tracks. captions, subtitles, chapters, descriptions
 * Track objects will be stored in the player.textTracks() array
 * @param {Array} trackList Array of track elements or objects (fake track elements)
 */
vjs.Player.prototype.addTextTracks = function(trackList){
  var trackObj;

  for (var i = 0; i < trackList.length; i++) {
    trackObj = trackList[i];
    this.addTextTrack(trackObj['kind'], trackObj['label'], trackObj['language'], trackObj);
  }

  return this;
};

// Show a text track
// disableSameKind: disable all other tracks of the same kind. Value should be a track kind (captions, etc.)
vjs.Player.prototype.showTextTrack = function(id, disableSameKind){
  var tracks = this.textTracks_,
      i = 0,
      j = tracks.length,
      track, showTrack, kind;

  // Find Track with same ID
  for (;i<j;i++) {
    track = tracks[i];
    if (track.id() === id) {
      track.show();
      showTrack = track;

    // Disable tracks of the same kind
    } else if (disableSameKind && track.kind() == disableSameKind && track.mode() > 0) {
      track.disable();
    }
  }

  // Get track kind from shown track or disableSameKind
  kind = (showTrack) ? showTrack.kind() : ((disableSameKind) ? disableSameKind : false);

  // Trigger trackchange event, captionstrackchange, subtitlestrackchange, etc.
  if (kind) {
    this.trigger(kind+'trackchange');
  }

  return this;
};

/**
 * Track Class
 * Contains track methods for loading, showing, parsing cues of tracks
 * @param {vjs.Player|Object} player
 * @param {Object=} options
 * @constructor
 */
vjs.TextTrack = vjs.Component.extend({
  /** @constructor */
  init: function(player, options){
    vjs.Component.call(this, player, options);

    // Apply track info to track object
    // Options will often be a track element

    // Build ID if one doesn't exist
    this.id_ = options['id'] || ('vjs_' + options['kind'] + '_' + options['language'] + '_' + vjs.guid++);
    this.src_ = options['src'];
    // 'default' is a reserved keyword in js so we use an abbreviated version
    this.dflt_ = options['default'] || options['dflt'];
    this.title_ = options['title'];
    this.language_ = options['srclang'];
    this.label_ = options['label'];
    this.cues_ = [];
    this.activeCues_ = [];
    this.readyState_ = 0;
    this.mode_ = 0;

    this.player_.on('fullscreenchange', vjs.bind(this, this.adjustFontSize));
  }
});

/**
 * Track kind value. Captions, subtitles, etc.
 * @private
 */
vjs.TextTrack.prototype.kind_;

/**
 * Get the track kind value
 * @return {String}
 */
vjs.TextTrack.prototype.kind = function(){
  return this.kind_;
};

/**
 * Track src value
 * @private
 */
vjs.TextTrack.prototype.src_;

/**
 * Get the track src value
 * @return {String}
 */
vjs.TextTrack.prototype.src = function(){
  return this.src_;
};

/**
 * Track default value
 * If default is used, subtitles/captions to start showing
 * @private
 */
vjs.TextTrack.prototype.dflt_;

/**
 * Get the track default value
 * 'default' is a reserved keyword
 * @return {Boolean}
 */
vjs.TextTrack.prototype.dflt = function(){
  return this.dflt_;
};

/**
 * Track title value
 * @private
 */
vjs.TextTrack.prototype.title_;

/**
 * Get the track title value
 * @return {String}
 */
vjs.TextTrack.prototype.title = function(){
  return this.title_;
};

/**
 * Language - two letter string to represent track language, e.g. 'en' for English
 * Spec def: readonly attribute DOMString language;
 * @private
 */
vjs.TextTrack.prototype.language_;

/**
 * Get the track language value
 * @return {String}
 */
vjs.TextTrack.prototype.language = function(){
  return this.language_;
};

/**
 * Track label e.g. 'English'
 * Spec def: readonly attribute DOMString label;
 * @private
 */
vjs.TextTrack.prototype.label_;

/**
 * Get the track label value
 * @return {String}
 */
vjs.TextTrack.prototype.label = function(){
  return this.label_;
};

/**
 * All cues of the track. Cues have a startTime, endTime, text, and other properties.
 * Spec def: readonly attribute TextTrackCueList cues;
 * @private
 */
vjs.TextTrack.prototype.cues_;

/**
 * Get the track cues
 * @return {Array}
 */
vjs.TextTrack.prototype.cues = function(){
  return this.cues_;
};

/**
 * ActiveCues is all cues that are currently showing
 * Spec def: readonly attribute TextTrackCueList activeCues;
 * @private
 */
vjs.TextTrack.prototype.activeCues_;

/**
 * Get the track active cues
 * @return {Array}
 */
vjs.TextTrack.prototype.activeCues = function(){
  return this.activeCues_;
};

/**
 * ReadyState describes if the text file has been loaded
 * const unsigned short NONE = 0;
 * const unsigned short LOADING = 1;
 * const unsigned short LOADED = 2;
 * const unsigned short ERROR = 3;
 * readonly attribute unsigned short readyState;
 * @private
 */
vjs.TextTrack.prototype.readyState_;

/**
 * Get the track readyState
 * @return {Number}
 */
vjs.TextTrack.prototype.readyState = function(){
  return this.readyState_;
};

/**
 * Mode describes if the track is showing, hidden, or disabled
 * const unsigned short OFF = 0;
 * const unsigned short HIDDEN = 1; (still triggering cuechange events, but not visible)
 * const unsigned short SHOWING = 2;
 * attribute unsigned short mode;
 * @private
 */
vjs.TextTrack.prototype.mode_;

/**
 * Get the track mode
 * @return {Number}
 */
vjs.TextTrack.prototype.mode = function(){
  return this.mode_;
};

/**
 * Change the font size of the text track to make it larger when playing in fullscreen mode
 * and restore it to its normal size when not in fullscreen mode.
 */
vjs.TextTrack.prototype.adjustFontSize = function(){
    if (this.player_.isFullScreen) {
        // Scale the font by the same factor as increasing the video width to the full screen window width.
        // Additionally, multiply that factor by 1.4, which is the default font size for
        // the caption track (from the CSS)
        this.el_.style.fontSize = screen.width / this.player_.width() * 1.4 * 100 + '%';
    } else {
        // Change the font size of the text track back to its original non-fullscreen size
        this.el_.style.fontSize = '';
    }
};

/**
 * Create basic div to hold cue text
 * @return {Element}
 */
vjs.TextTrack.prototype.createEl = function(){
  return vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-' + this.kind_ + ' vjs-text-track'
  });
};

/**
 * Show: Mode Showing (2)
 * Indicates that the text track is active. If no attempt has yet been made to obtain the track's cues, the user agent will perform such an attempt momentarily.
 * The user agent is maintaining a list of which cues are active, and events are being fired accordingly.
 * In addition, for text tracks whose kind is subtitles or captions, the cues are being displayed over the video as appropriate;
 * for text tracks whose kind is descriptions, the user agent is making the cues available to the user in a non-visual fashion;
 * and for text tracks whose kind is chapters, the user agent is making available to the user a mechanism by which the user can navigate to any point in the media resource by selecting a cue.
 * The showing by default state is used in conjunction with the default attribute on track elements to indicate that the text track was enabled due to that attribute.
 * This allows the user agent to override the state if a later track is discovered that is more appropriate per the user's preferences.
 */
vjs.TextTrack.prototype.show = function(){
  this.activate();

  this.mode_ = 2;

  // Show element.
  vjs.Component.prototype.show.call(this);
};

/**
 * Hide: Mode Hidden (1)
 * Indicates that the text track is active, but that the user agent is not actively displaying the cues.
 * If no attempt has yet been made to obtain the track's cues, the user agent will perform such an attempt momentarily.
 * The user agent is maintaining a list of which cues are active, and events are being fired accordingly.
 */
vjs.TextTrack.prototype.hide = function(){
  // When hidden, cues are still triggered. Disable to stop triggering.
  this.activate();

  this.mode_ = 1;

  // Hide element.
  vjs.Component.prototype.hide.call(this);
};

/**
 * Disable: Mode Off/Disable (0)
 * Indicates that the text track is not active. Other than for the purposes of exposing the track in the DOM, the user agent is ignoring the text track.
 * No cues are active, no events are fired, and the user agent will not attempt to obtain the track's cues.
 */
vjs.TextTrack.prototype.disable = function(){
  // If showing, hide.
  if (this.mode_ == 2) { this.hide(); }

  // Stop triggering cues
  this.deactivate();

  // Switch Mode to Off
  this.mode_ = 0;
};

/**
 * Turn on cue tracking. Tracks that are showing OR hidden are active.
 */
vjs.TextTrack.prototype.activate = function(){
  // Load text file if it hasn't been yet.
  if (this.readyState_ === 0) { this.load(); }

  // Only activate if not already active.
  if (this.mode_ === 0) {
    // Update current cue on timeupdate
    // Using unique ID for bind function so other tracks don't remove listener
    this.player_.on('timeupdate', vjs.bind(this, this.update, this.id_));

    // Reset cue time on media end
    this.player_.on('ended', vjs.bind(this, this.reset, this.id_));

    // Add to display
    if (this.kind_ === 'captions' || this.kind_ === 'subtitles') {
      this.player_.getChild('textTrackDisplay').addChild(this);
    }
  }
};

/**
 * Turn off cue tracking.
 */
vjs.TextTrack.prototype.deactivate = function(){
  // Using unique ID for bind function so other tracks don't remove listener
  this.player_.off('timeupdate', vjs.bind(this, this.update, this.id_));
  this.player_.off('ended', vjs.bind(this, this.reset, this.id_));
  this.reset(); // Reset

  // Remove from display
  this.player_.getChild('textTrackDisplay').removeChild(this);
};

// A readiness state
// One of the following:
//
// Not loaded
// Indicates that the text track is known to exist (e.g. it has been declared with a track element), but its cues have not been obtained.
//
// Loading
// Indicates that the text track is loading and there have been no fatal errors encountered so far. Further cues might still be added to the track.
//
// Loaded
// Indicates that the text track has been loaded with no fatal errors. No new cues will be added to the track except if the text track corresponds to a MutableTextTrack object.
//
// Failed to load
// Indicates that the text track was enabled, but when the user agent attempted to obtain it, this failed in some way (e.g. URL could not be resolved, network error, unknown text track format). Some or all of the cues are likely missing and will not be obtained.
vjs.TextTrack.prototype.load = function(){

  // Only load if not loaded yet.
  if (this.readyState_ === 0) {
    this.readyState_ = 1;
    vjs.get(this.src_, vjs.bind(this, this.parseCues), vjs.bind(this, this.onError));
  }

};

vjs.TextTrack.prototype.onError = function(err){
  this.error = err;
  this.readyState_ = 3;
  this.trigger('error');
};

// Parse the WebVTT text format for cue times.
// TODO: Separate parser into own class so alternative timed text formats can be used. (TTML, DFXP)
vjs.TextTrack.prototype.parseCues = function(srcContent) {
  var cue, time, text,
      lines = srcContent.split('\n'),
      line = '', id;

  for (var i=1, j=lines.length; i<j; i++) {
    // Line 0 should be 'WEBVTT', so skipping i=0

    line = vjs.trim(lines[i]); // Trim whitespace and linebreaks

    if (line) { // Loop until a line with content

      // First line could be an optional cue ID
      // Check if line has the time separator
      if (line.indexOf('-->') == -1) {
        id = line;
        // Advance to next line for timing.
        line = vjs.trim(lines[++i]);
      } else {
        id = this.cues_.length;
      }

      // First line - Number
      cue = {
        id: id, // Cue Number
        index: this.cues_.length // Position in Array
      };

      // Timing line
      time = line.split(' --> ');
      cue.startTime = this.parseCueTime(time[0]);
      cue.endTime = this.parseCueTime(time[1]);

      // Additional lines - Cue Text
      text = [];

      // Loop until a blank line or end of lines
      // Assumeing trim('') returns false for blank lines
      while (lines[++i] && (line = vjs.trim(lines[i]))) {
        text.push(line);
      }

      cue.text = text.join('<br/>');

      // Add this cue
      this.cues_.push(cue);
    }
  }

  this.readyState_ = 2;
  this.trigger('loaded');
};


vjs.TextTrack.prototype.parseCueTime = function(timeText) {
  var parts = timeText.split(':'),
      time = 0,
      hours, minutes, other, seconds, ms;

  // Check if optional hours place is included
  // 00:00:00.000 vs. 00:00.000
  if (parts.length == 3) {
    hours = parts[0];
    minutes = parts[1];
    other = parts[2];
  } else {
    hours = 0;
    minutes = parts[0];
    other = parts[1];
  }

  // Break other (seconds, milliseconds, and flags) by spaces
  // TODO: Make additional cue layout settings work with flags
  other = other.split(/\s+/);
  // Remove seconds. Seconds is the first part before any spaces.
  seconds = other.splice(0,1)[0];
  // Could use either . or , for decimal
  seconds = seconds.split(/\.|,/);
  // Get milliseconds
  ms = parseFloat(seconds[1]);
  seconds = seconds[0];

  // hours => seconds
  time += parseFloat(hours) * 3600;
  // minutes => seconds
  time += parseFloat(minutes) * 60;
  // Add seconds
  time += parseFloat(seconds);
  // Add milliseconds
  if (ms) { time += ms/1000; }

  return time;
};

// Update active cues whenever timeupdate events are triggered on the player.
vjs.TextTrack.prototype.update = function(){
  if (this.cues_.length > 0) {

    // Get curent player time
    var time = this.player_.currentTime();

    // Check if the new time is outside the time box created by the the last update.
    if (this.prevChange === undefined || time < this.prevChange || this.nextChange <= time) {
      var cues = this.cues_,

          // Create a new time box for this state.
          newNextChange = this.player_.duration(), // Start at beginning of the timeline
          newPrevChange = 0, // Start at end

          reverse = false, // Set the direction of the loop through the cues. Optimized the cue check.
          newCues = [], // Store new active cues.

          // Store where in the loop the current active cues are, to provide a smart starting point for the next loop.
          firstActiveIndex, lastActiveIndex,
          cue, i; // Loop vars

      // Check if time is going forwards or backwards (scrubbing/rewinding)
      // If we know the direction we can optimize the starting position and direction of the loop through the cues array.
      if (time >= this.nextChange || this.nextChange === undefined) { // NextChange should happen
        // Forwards, so start at the index of the first active cue and loop forward
        i = (this.firstActiveIndex !== undefined) ? this.firstActiveIndex : 0;
      } else {
        // Backwards, so start at the index of the last active cue and loop backward
        reverse = true;
        i = (this.lastActiveIndex !== undefined) ? this.lastActiveIndex : cues.length - 1;
      }

      while (true) { // Loop until broken
        cue = cues[i];

        // Cue ended at this point
        if (cue.endTime <= time) {
          newPrevChange = Math.max(newPrevChange, cue.endTime);

          if (cue.active) {
            cue.active = false;
          }

          // No earlier cues should have an active start time.
          // Nevermind. Assume first cue could have a duration the same as the video.
          // In that case we need to loop all the way back to the beginning.
          // if (reverse && cue.startTime) { break; }

        // Cue hasn't started
        } else if (time < cue.startTime) {
          newNextChange = Math.min(newNextChange, cue.startTime);

          if (cue.active) {
            cue.active = false;
          }

          // No later cues should have an active start time.
          if (!reverse) { break; }

        // Cue is current
        } else {

          if (reverse) {
            // Add cue to front of array to keep in time order
            newCues.splice(0,0,cue);

            // If in reverse, the first current cue is our lastActiveCue
            if (lastActiveIndex === undefined) { lastActiveIndex = i; }
            firstActiveIndex = i;
          } else {
            // Add cue to end of array
            newCues.push(cue);

            // If forward, the first current cue is our firstActiveIndex
            if (firstActiveIndex === undefined) { firstActiveIndex = i; }
            lastActiveIndex = i;
          }

          newNextChange = Math.min(newNextChange, cue.endTime);
          newPrevChange = Math.max(newPrevChange, cue.startTime);

          cue.active = true;
        }

        if (reverse) {
          // Reverse down the array of cues, break if at first
          if (i === 0) { break; } else { i--; }
        } else {
          // Walk up the array fo cues, break if at last
          if (i === cues.length - 1) { break; } else { i++; }
        }

      }

      this.activeCues_ = newCues;
      this.nextChange = newNextChange;
      this.prevChange = newPrevChange;
      this.firstActiveIndex = firstActiveIndex;
      this.lastActiveIndex = lastActiveIndex;

      this.updateDisplay();

      this.trigger('cuechange');
    }
  }
};

// Add cue HTML to display
vjs.TextTrack.prototype.updateDisplay = function(){
  var cues = this.activeCues_,
      html = '',
      i=0,j=cues.length;

  for (;i<j;i++) {
    html += '<span class="vjs-tt-cue">'+cues[i].text+'</span>';
  }

  this.el_.innerHTML = html;
};

// Set all loop helper values back
vjs.TextTrack.prototype.reset = function(){
  this.nextChange = 0;
  this.prevChange = this.player_.duration();
  this.firstActiveIndex = 0;
  this.lastActiveIndex = 0;
};

// Create specific track types
/**
 * @constructor
 */
vjs.CaptionsTrack = vjs.TextTrack.extend();
vjs.CaptionsTrack.prototype.kind_ = 'captions';
// Exporting here because Track creation requires the track kind
// to be available on global object. e.g. new window['videojs'][Kind + 'Track']

/**
 * @constructor
 */
vjs.SubtitlesTrack = vjs.TextTrack.extend();
vjs.SubtitlesTrack.prototype.kind_ = 'subtitles';

/**
 * @constructor
 */
vjs.ChaptersTrack = vjs.TextTrack.extend();
vjs.ChaptersTrack.prototype.kind_ = 'chapters';


/* Text Track Display
============================================================================= */
// Global container for both subtitle and captions text. Simple div container.

/**
 * @constructor
 */
vjs.TextTrackDisplay = vjs.Component.extend({
  /** @constructor */
  init: function(player, options, ready){
    vjs.Component.call(this, player, options, ready);

    // This used to be called during player init, but was causing an error
    // if a track should show by default and the display hadn't loaded yet.
    // Should probably be moved to an external track loader when we support
    // tracks that don't need a display.
    if (player.options_['tracks'] && player.options_['tracks'].length > 0) {
      this.player_.addTextTracks(player.options_['tracks']);
    }
  }
});

vjs.TextTrackDisplay.prototype.createEl = function(){
  return vjs.Component.prototype.createEl.call(this, 'div', {
    className: 'vjs-text-track-display'
  });
};


/* Text Track Menu Items
============================================================================= */
/**
 * @constructor
 */
vjs.TextTrackMenuItem = vjs.MenuItem.extend({
  /** @constructor */
  init: function(player, options){
    var track = this.track = options['track'];

    // Modify options for parent MenuItem class's init.
    options['label'] = track.label();
    options['selected'] = track.dflt();
    vjs.MenuItem.call(this, player, options);

    this.player_.on(track.kind() + 'trackchange', vjs.bind(this, this.update));
  }
});

vjs.TextTrackMenuItem.prototype.onClick = function(){
  vjs.MenuItem.prototype.onClick.call(this);
  this.player_.showTextTrack(this.track.id_, this.track.kind());
};

vjs.TextTrackMenuItem.prototype.update = function(){
  this.selected(this.track.mode() == 2);
};

/**
 * @constructor
 */
vjs.OffTextTrackMenuItem = vjs.TextTrackMenuItem.extend({
  /** @constructor */
  init: function(player, options){
    // Create pseudo track info
    // Requires options['kind']
    options['track'] = {
      kind: function() { return options['kind']; },
      player: player,
      label: function(){ return options['kind'] + ' off'; },
      dflt: function(){ return false; },
      mode: function(){ return false; }
    };
    vjs.TextTrackMenuItem.call(this, player, options);
    this.selected(true);
  }
});

vjs.OffTextTrackMenuItem.prototype.onClick = function(){
  vjs.TextTrackMenuItem.prototype.onClick.call(this);
  this.player_.showTextTrack(this.track.id_, this.track.kind());
};

vjs.OffTextTrackMenuItem.prototype.update = function(){
  var tracks = this.player_.textTracks(),
      i=0, j=tracks.length, track,
      off = true;

  for (;i<j;i++) {
    track = tracks[i];
    if (track.kind() == this.track.kind() && track.mode() == 2) {
      off = false;
    }
  }

  this.selected(off);
};

/* Captions Button
================================================================================ */
/**
 * @constructor
 */
vjs.TextTrackButton = vjs.MenuButton.extend({
  /** @constructor */
  init: function(player, options){
    vjs.MenuButton.call(this, player, options);

    if (this.items.length <= 1) {
      this.hide();
    }
  }
});

// vjs.TextTrackButton.prototype.buttonPressed = false;

// vjs.TextTrackButton.prototype.createMenu = function(){
//   var menu = new vjs.Menu(this.player_);

//   // Add a title list item to the top
//   // menu.el().appendChild(vjs.createEl('li', {
//   //   className: 'vjs-menu-title',
//   //   innerHTML: vjs.capitalize(this.kind_),
//   //   tabindex: -1
//   // }));

//   this.items = this.createItems();

//   // Add menu items to the menu
//   for (var i = 0; i < this.items.length; i++) {
//     menu.addItem(this.items[i]);
//   }

//   // Add list to element
//   this.addChild(menu);

//   return menu;
// };

// Create a menu item for each text track
vjs.TextTrackButton.prototype.createItems = function(){
  var items = [], track;

  // Add an OFF menu item to turn all tracks off
  items.push(new vjs.OffTextTrackMenuItem(this.player_, { 'kind': this.kind_ }));

  for (var i = 0; i < this.player_.textTracks().length; i++) {
    track = this.player_.textTracks()[i];
    if (track.kind() === this.kind_) {
      items.push(new vjs.TextTrackMenuItem(this.player_, {
        'track': track
      }));
    }
  }

  return items;
};

/**
 * @constructor
 */
vjs.CaptionsButton = vjs.TextTrackButton.extend({
  /** @constructor */
  init: function(player, options, ready){
    vjs.TextTrackButton.call(this, player, options, ready);
    this.el_.setAttribute('aria-label','Captions Menu');
  }
});
vjs.CaptionsButton.prototype.kind_ = 'captions';
vjs.CaptionsButton.prototype.buttonText = 'Captions';
vjs.CaptionsButton.prototype.className = 'vjs-captions-button';

/**
 * @constructor
 */
vjs.SubtitlesButton = vjs.TextTrackButton.extend({
  /** @constructor */
  init: function(player, options, ready){
    vjs.TextTrackButton.call(this, player, options, ready);
    this.el_.setAttribute('aria-label','Subtitles Menu');
  }
});
vjs.SubtitlesButton.prototype.kind_ = 'subtitles';
vjs.SubtitlesButton.prototype.buttonText = 'Subtitles';
vjs.SubtitlesButton.prototype.className = 'vjs-subtitles-button';

// Chapters act much differently than other text tracks
// Cues are navigation vs. other tracks of alternative languages
/**
 * @constructor
 */
vjs.ChaptersButton = vjs.TextTrackButton.extend({
  /** @constructor */
  init: function(player, options, ready){
    vjs.TextTrackButton.call(this, player, options, ready);
    this.el_.setAttribute('aria-label','Chapters Menu');
  }
});
vjs.ChaptersButton.prototype.kind_ = 'chapters';
vjs.ChaptersButton.prototype.buttonText = 'Chapters';
vjs.ChaptersButton.prototype.className = 'vjs-chapters-button';

// Create a menu item for each text track
vjs.ChaptersButton.prototype.createItems = function(){
  var items = [], track;

  for (var i = 0; i < this.player_.textTracks().length; i++) {
    track = this.player_.textTracks()[i];
    if (track.kind() === this.kind_) {
      items.push(new vjs.TextTrackMenuItem(this.player_, {
        'track': track
      }));
    }
  }

  return items;
};

vjs.ChaptersButton.prototype.createMenu = function(){
  var tracks = this.player_.textTracks(),
      i = 0,
      j = tracks.length,
      track, chaptersTrack,
      items = this.items = [];

  for (;i<j;i++) {
    track = tracks[i];
    if (track.kind() == this.kind_ && track.dflt()) {
      if (track.readyState() < 2) {
        this.chaptersTrack = track;
        track.on('loaded', vjs.bind(this, this.createMenu));
        return;
      } else {
        chaptersTrack = track;
        break;
      }
    }
  }

  var menu = this.menu = new vjs.Menu(this.player_);

  menu.el_.appendChild(vjs.createEl('li', {
    className: 'vjs-menu-title',
    innerHTML: vjs.capitalize(this.kind_),
    tabindex: -1
  }));

  if (chaptersTrack) {
    var cues = chaptersTrack.cues_, cue, mi;
    i = 0;
    j = cues.length;

    for (;i<j;i++) {
      cue = cues[i];

      mi = new vjs.ChaptersTrackMenuItem(this.player_, {
        'track': chaptersTrack,
        'cue': cue
      });

      items.push(mi);

      menu.addChild(mi);
    }
  }

  if (this.items.length > 0) {
    this.show();
  }

  return menu;
};


/**
 * @constructor
 */
vjs.ChaptersTrackMenuItem = vjs.MenuItem.extend({
  /** @constructor */
  init: function(player, options){
    var track = this.track = options['track'],
        cue = this.cue = options['cue'],
        currentTime = player.currentTime();

    // Modify options for parent MenuItem class's init.
    options['label'] = cue.text;
    options['selected'] = (cue.startTime <= currentTime && currentTime < cue.endTime);
    vjs.MenuItem.call(this, player, options);

    track.on('cuechange', vjs.bind(this, this.update));
  }
});

vjs.ChaptersTrackMenuItem.prototype.onClick = function(){
  vjs.MenuItem.prototype.onClick.call(this);
  this.player_.currentTime(this.cue.startTime);
  this.update(this.cue.startTime);
};

vjs.ChaptersTrackMenuItem.prototype.update = function(){
  var cue = this.cue,
      currentTime = this.player_.currentTime();

  // vjs.log(currentTime, cue.startTime);
  this.selected(cue.startTime <= currentTime && currentTime < cue.endTime);
};

// Add Buttons to controlBar
vjs.obj.merge(vjs.ControlBar.prototype.options_['children'], {
  'subtitlesButton': {},
  'captionsButton': {},
  'chaptersButton': {}
});

// vjs.Cue = vjs.Component.extend({
//   /** @constructor */
//   init: function(player, options){
//     vjs.Component.call(this, player, options);
//   }
// });
/**
 * @fileoverview Add JSON support
 * @suppress {undefinedVars}
 * (Compiler doesn't like JSON not being declared)
 */

/**
 * Javascript JSON implementation
 * (Parse Method Only)
 * https://github.com/douglascrockford/JSON-js/blob/master/json2.js
 * Only using for parse method when parsing data-setup attribute JSON.
 * @type {Object}
 * @suppress {undefinedVars}
 */
vjs.JSON;

/**
 * @suppress {undefinedVars}
 */
if (typeof window.JSON !== 'undefined' && window.JSON.parse === 'function') {
  vjs.JSON = window.JSON;

} else {
  vjs.JSON = {};

  var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;

  vjs.JSON.parse = function (text, reviver) {
      var j;

      function walk(holder, key) {
          var k, v, value = holder[key];
          if (value && typeof value === 'object') {
              for (k in value) {
                  if (Object.prototype.hasOwnProperty.call(value, k)) {
                      v = walk(value, k);
                      if (v !== undefined) {
                          value[k] = v;
                      } else {
                          delete value[k];
                      }
                  }
              }
          }
          return reviver.call(holder, key, value);
      }
      text = String(text);
      cx.lastIndex = 0;
      if (cx.test(text)) {
          text = text.replace(cx, function (a) {
              return '\\u' +
                  ('0000' + a.charCodeAt(0).toString(16)).slice(-4);
          });
      }

      if (/^[\],:{}\s]*$/
              .test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')
                  .replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, ']')
                  .replace(/(?:^|:|,)(?:\s*\[)+/g, ''))) {

          j = eval('(' + text + ')');

          return typeof reviver === 'function' ?
              walk({'': j}, '') : j;
      }

      throw new SyntaxError('JSON.parse(): invalid or malformed JSON data');
  };
}
/**
 * @fileoverview Functions for automatically setting up a player
 * based on the data-setup attribute of the video tag
 */

// Automatically set up any tags that have a data-setup attribute
vjs.autoSetup = function(){
  var options, vid, player,
      vids = document.getElementsByTagName('video');

  // Check if any media elements exist
  if (vids && vids.length > 0) {

    for (var i=0,j=vids.length; i<j; i++) {
      vid = vids[i];

      // Check if element exists, has getAttribute func.
      // IE seems to consider typeof el.getAttribute == 'object' instead of 'function' like expected, at least when loading the player immediately.
      if (vid && vid.getAttribute) {

        // Make sure this player hasn't already been set up.
        if (vid['player'] === undefined) {
          options = vid.getAttribute('data-setup');

          // Check if data-setup attr exists.
          // We only auto-setup if they've added the data-setup attr.
          if (options !== null) {

            // Parse options JSON
            // If empty string, make it a parsable json object.
            options = vjs.JSON.parse(options || '{}');

            // Create new video.js instance.
            player = videojs(vid, options);
          }
        }

      // If getAttribute isn't defined, we need to wait for the DOM.
      } else {
        vjs.autoSetupTimeout(1);
        break;
      }
    }

  // No videos were found, so keep looping unless page is finisehd loading.
  } else if (!vjs.windowLoaded) {
    vjs.autoSetupTimeout(1);
  }
};

// Pause to let the DOM keep processing
vjs.autoSetupTimeout = function(wait){
  setTimeout(vjs.autoSetup, wait);
};

if (document.readyState === 'complete') {
  vjs.windowLoaded = true;
} else {
  vjs.one(window, 'load', function(){
    vjs.windowLoaded = true;
  });
}

// Run Auto-load players
// You have to wait at least once in case this script is loaded after your video in the DOM (weird behavior only with minified version)
vjs.autoSetupTimeout(1);
vjs.plugin = function(name, init){
  vjs.Player.prototype[name] = init;
};
/*! iScroll v5.0.5 ~ (c) 2008-2013 Matteo Spinelli ~ http://cubiq.org/license */
var IScroll = (function (window, document, Math) {
var rAF = window.requestAnimationFrame	||
	window.webkitRequestAnimationFrame	||
	window.mozRequestAnimationFrame		||
	window.oRequestAnimationFrame		||
	window.msRequestAnimationFrame		||
	function (callback) { window.setTimeout(callback, 1000 / 60); };

var utils = (function () {
	var me = {};

	var _elementStyle = document.createElement('div').style;
	var _vendor = (function () {
		var vendors = ['t', 'webkitT', 'MozT', 'msT', 'OT'],
			transform,
			i = 0,
			l = vendors.length;

		for ( ; i < l; i++ ) {
			transform = vendors[i] + 'ransform';
			if ( transform in _elementStyle ) return vendors[i].substr(0, vendors[i].length-1);
		}

		return false;
	})();

	function _prefixStyle (style) {
		if ( _vendor === false ) return false;
		if ( _vendor === '' ) return style;
		return _vendor + style.charAt(0).toUpperCase() + style.substr(1);
	}

	me.getTime = Date.now || function getTime () { return new Date().getTime(); };

	me.extend = function (target, obj) {
		for ( var i in obj ) {
			target[i] = obj[i];
		}
	};

	me.addEvent = function (el, type, fn, capture) {
		el.addEventListener(type, fn, !!capture);
	};

	me.removeEvent = function (el, type, fn, capture) {
		el.removeEventListener(type, fn, !!capture);
	};

	me.momentum = function (current, start, time, lowerMargin, wrapperSize) {
		var distance = current - start,
			speed = Math.abs(distance) / time,
			destination,
			duration,
			deceleration = 0.0006;

		destination = current + ( speed * speed ) / ( 2 * deceleration ) * ( distance < 0 ? -1 : 1 );
		duration = speed / deceleration;

		if ( destination < lowerMargin ) {
			destination = wrapperSize ? lowerMargin - ( wrapperSize / 2.5 * ( speed / 8 ) ) : lowerMargin;
			distance = Math.abs(destination - current);
			duration = distance / speed;
		} else if ( destination > 0 ) {
			destination = wrapperSize ? wrapperSize / 2.5 * ( speed / 8 ) : 0;
			distance = Math.abs(current) + destination;
			duration = distance / speed;
		}

		return {
			destination: Math.round(destination),
			duration: duration
		};
	};

	var _transform = _prefixStyle('transform');

	me.extend(me, {
		hasTransform: _transform !== false,
		hasPerspective: _prefixStyle('perspective') in _elementStyle,
		hasTouch: 'ontouchstart' in window,
		hasPointer: navigator.msPointerEnabled,
		hasTransition: _prefixStyle('transition') in _elementStyle
	});

	me.isAndroidBrowser = /Android/.test(window.navigator.appVersion) && /Version\/\d/.test(window.navigator.appVersion);

	me.extend(me.style = {}, {
		transform: _transform,
		transitionTimingFunction: _prefixStyle('transitionTimingFunction'),
		transitionDuration: _prefixStyle('transitionDuration'),
		transformOrigin: _prefixStyle('transformOrigin')
	});

	me.hasClass = function (e, c) {
		var re = new RegExp("(^|\\s)" + c + "(\\s|$)");
		return re.test(e.className);
	};

	me.addClass = function (e, c) {
		if ( me.hasClass(e, c) ) {
			return;
		}

		var newclass = e.className.split(' ');
		newclass.push(c);
		e.className = newclass.join(' ');
	};

	me.removeClass = function (e, c) {
		if ( !me.hasClass(e, c) ) {
			return;
		}

		var re = new RegExp("(^|\\s)" + c + "(\\s|$)", 'g');
		e.className = e.className.replace(re, ' ');
	};

	me.offset = function (el) {
		var left = -el.offsetLeft,
			top = -el.offsetTop;

		// jshint -W084
		while (el = el.offsetParent) {
			left -= el.offsetLeft;
			top -= el.offsetTop;
		}
		// jshint +W084

		return {
			left: left,
			top: top
		};
	};

	me.preventDefaultException = function (el, exceptions) {
		for ( var i in exceptions ) {
			if ( exceptions[i].test(el[i]) ) {
				return true;
			}
		}

		return false;
	};

	me.extend(me.eventType = {}, {
		touchstart: 1,
		touchmove: 1,
		touchend: 1,

		mousedown: 2,
		mousemove: 2,
		mouseup: 2,

		MSPointerDown: 3,
		MSPointerMove: 3,
		MSPointerUp: 3
	});

	me.extend(me.ease = {}, {
		quadratic: {
			style: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',
			fn: function (k) {
				return k * ( 2 - k );
			}
		},
		circular: {
			style: 'cubic-bezier(0.1, 0.57, 0.1, 1)',	// Not properly "circular" but this looks better, it should be (0.075, 0.82, 0.165, 1)
			fn: function (k) {
				return Math.sqrt( 1 - ( --k * k ) );
			}
		},
		back: {
			style: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)',
			fn: function (k) {
				var b = 4;
				return ( k = k - 1 ) * k * ( ( b + 1 ) * k + b ) + 1;
			}
		},
		bounce: {
			style: '',
			fn: function (k) {
				if ( ( k /= 1 ) < ( 1 / 2.75 ) ) {
					return 7.5625 * k * k;
				} else if ( k < ( 2 / 2.75 ) ) {
					return 7.5625 * ( k -= ( 1.5 / 2.75 ) ) * k + 0.75;
				} else if ( k < ( 2.5 / 2.75 ) ) {
					return 7.5625 * ( k -= ( 2.25 / 2.75 ) ) * k + 0.9375;
				} else {
					return 7.5625 * ( k -= ( 2.625 / 2.75 ) ) * k + 0.984375;
				}
			}
		},
		elastic: {
			style: '',
			fn: function (k) {
				var f = 0.22,
					e = 0.4;

				if ( k === 0 ) { return 0; }
				if ( k == 1 ) { return 1; }

				return ( e * Math.pow( 2, - 10 * k ) * Math.sin( ( k - f / 4 ) * ( 2 * Math.PI ) / f ) + 1 );
			}
		}
	});

	me.tap = function (e, eventName) {
		var ev = document.createEvent('Event');
		ev.initEvent(eventName, true, true);
		ev.pageX = e.pageX;
		ev.pageY = e.pageY;
		e.target.dispatchEvent(ev);
	};

	me.click = function (e) {
		var target = e.target,
			ev;

		if (target.tagName != 'SELECT' && target.tagName != 'INPUT' && target.tagName != 'TEXTAREA') {
			ev = document.createEvent('MouseEvents');
			ev.initMouseEvent('click', true, true, e.view, 1,
				target.screenX, target.screenY, target.clientX, target.clientY,
				e.ctrlKey, e.altKey, e.shiftKey, e.metaKey,
				0, null);

			ev._constructed = true;
			target.dispatchEvent(ev);
		}
	};

	return me;
})();

function IScroll (el, options) {
	this.wrapper = typeof el == 'string' ? document.querySelector(el) : el;
	this.scroller = this.wrapper.children[0];
	this.scrollerStyle = this.scroller.style;		// cache style for better performance

	this.options = {

		resizeIndicator: true,

		mouseWheelSpeed: 20,

		snapThreshold: 0.334,

// INSERT POINT: OPTIONS 

		startX: 0,
		startY: 0,
		scrollY: true,
		directionLockThreshold: 5,
		momentum: true,

		bounce: true,
		bounceTime: 600,
		bounceEasing: '',

		preventDefault: true,
		preventDefaultException: { tagName: /^(INPUT|TEXTAREA|BUTTON|SELECT)$/ },

		HWCompositing: true,
		useTransition: true,
		useTransform: true
	};

	for ( var i in options ) {
		this.options[i] = options[i];
	}

	// Normalize options
	this.translateZ = this.options.HWCompositing && utils.hasPerspective ? ' translateZ(0)' : '';

	this.options.useTransition = utils.hasTransition && this.options.useTransition;
	this.options.useTransform = utils.hasTransform && this.options.useTransform;

	this.options.eventPassthrough = this.options.eventPassthrough === true ? 'vertical' : this.options.eventPassthrough;
	this.options.preventDefault = !this.options.eventPassthrough && this.options.preventDefault;

	// If you want eventPassthrough I have to lock one of the axes
	this.options.scrollY = this.options.eventPassthrough == 'vertical' ? false : this.options.scrollY;
	this.options.scrollX = this.options.eventPassthrough == 'horizontal' ? false : this.options.scrollX;

	// With eventPassthrough we also need lockDirection mechanism
	this.options.freeScroll = this.options.freeScroll && !this.options.eventPassthrough;
	this.options.directionLockThreshold = this.options.eventPassthrough ? 0 : this.options.directionLockThreshold;

	this.options.bounceEasing = typeof this.options.bounceEasing == 'string' ? utils.ease[this.options.bounceEasing] || utils.ease.circular : this.options.bounceEasing;

	this.options.resizePolling = this.options.resizePolling === undefined ? 60 : this.options.resizePolling;

	if ( this.options.tap === true ) {
		this.options.tap = 'tap';
	}

	this.options.invertWheelDirection = this.options.invertWheelDirection ? -1 : 1;

// INSERT POINT: NORMALIZATION

	// Some defaults	
	this.x = 0;
	this.y = 0;
	this.directionX = 0;
	this.directionY = 0;
	this._events = {};

// INSERT POINT: DEFAULTS

	this._init();
	this.refresh();

	this.scrollTo(this.options.startX, this.options.startY);
	this.enable();
}

IScroll.prototype = {
	version: '5.0.5',

	_init: function () {
		this._initEvents();

		if ( this.options.scrollbars || this.options.indicators ) {
			this._initIndicators();
		}

		if ( this.options.mouseWheel ) {
			this._initWheel();
		}

		if ( this.options.snap ) {
			this._initSnap();
		}

		if ( this.options.keyBindings ) {
			this._initKeys();
		}

// INSERT POINT: _init

	},

	destroy: function () {
		this._initEvents(true);

		this._execEvent('destroy');
	},

	_transitionEnd: function (e) {
		if ( e.target != this.scroller ) {
			return;
		}

		this._transitionTime(0);
		if ( !this.resetPosition(this.options.bounceTime) ) {
			this._execEvent('scrollEnd');
		}
	},

	_start: function (e) {
		// React to left mouse button only
		if ( utils.eventType[e.type] != 1 ) {
			if ( e.button !== 0 ) {
				return;
			}
		}

		if ( !this.enabled || (this.initiated && utils.eventType[e.type] !== this.initiated) ) {
			return;
		}

		if ( this.options.preventDefault && !utils.isAndroidBrowser && !utils.preventDefaultException(e.target, this.options.preventDefaultException) ) {
			e.preventDefault();		// This seems to break default Android browser
		}

		var point = e.touches ? e.touches[0] : e,
			pos;

		this.initiated	= utils.eventType[e.type];
		this.moved		= false;
		this.distX		= 0;
		this.distY		= 0;
		this.directionX = 0;
		this.directionY = 0;
		this.directionLocked = 0;

		this._transitionTime();

		this.isAnimating = false;
		this.startTime = utils.getTime();

		if ( this.options.useTransition && this.isInTransition ) {
			pos = this.getComputedPosition();

			this._translate(Math.round(pos.x), Math.round(pos.y));
			this.isInTransition = false;
		}

		this.startX    = this.x;
		this.startY    = this.y;
		this.absStartX = this.x;
		this.absStartY = this.y;
		this.pointX    = point.pageX;
		this.pointY    = point.pageY;

		this._execEvent('scrollStart');
	},

	_move: function (e) {
		if ( !this.enabled || utils.eventType[e.type] !== this.initiated ) {
			return;
		}

		if ( this.options.preventDefault ) {	// increases performance on Android? TODO: check!
			e.preventDefault();
		}

		var point		= e.touches ? e.touches[0] : e,
			deltaX		= this.hasHorizontalScroll ? point.pageX - this.pointX : 0,
			deltaY		= this.hasVerticalScroll   ? point.pageY - this.pointY : 0,
			timestamp	= utils.getTime(),
			newX, newY,
			absDistX, absDistY;

		this.pointX		= point.pageX;
		this.pointY		= point.pageY;

		this.distX		+= deltaX;
		this.distY		+= deltaY;
		absDistX		= Math.abs(this.distX);
		absDistY		= Math.abs(this.distY);

		// We need to move at least 10 pixels for the scrolling to initiate
		if ( timestamp - this.endTime > 300 && (absDistX < 10 && absDistY < 10) ) {
			return;
		}

		// If you are scrolling in one direction lock the other
		if ( !this.directionLocked && !this.options.freeScroll ) {
			if ( absDistX > absDistY + this.options.directionLockThreshold ) {
				this.directionLocked = 'h';		// lock horizontally
			} else if ( absDistY >= absDistX + this.options.directionLockThreshold ) {
				this.directionLocked = 'v';		// lock vertically
			} else {
				this.directionLocked = 'n';		// no lock
			}
		}

		if ( this.directionLocked == 'h' ) {
			if ( this.options.eventPassthrough == 'vertical' ) {
				e.preventDefault();
			} else if ( this.options.eventPassthrough == 'horizontal' ) {
				this.initiated = false;
				return;
			}

			deltaY = 0;
		} else if ( this.directionLocked == 'v' ) {
			if ( this.options.eventPassthrough == 'horizontal' ) {
				e.preventDefault();
			} else if ( this.options.eventPassthrough == 'vertical' ) {
				this.initiated = false;
				return;
			}

			deltaX = 0;
		}

		newX = this.x + deltaX;
		newY = this.y + deltaY;

		// Slow down if outside of the boundaries
		if ( newX > 0 || newX < this.maxScrollX ) {
			newX = this.options.bounce ? this.x + deltaX / 3 : newX > 0 ? 0 : this.maxScrollX;
		}
		if ( newY > 0 || newY < this.maxScrollY ) {
			newY = this.options.bounce ? this.y + deltaY / 3 : newY > 0 ? 0 : this.maxScrollY;
		}

		this.directionX = deltaX > 0 ? -1 : deltaX < 0 ? 1 : 0;
		this.directionY = deltaY > 0 ? -1 : deltaY < 0 ? 1 : 0;

		this.moved = true;

		this._translate(newX, newY);

/* REPLACE START: _move */

		if ( timestamp - this.startTime > 300 ) {
			this.startTime = timestamp;
			this.startX = this.x;
			this.startY = this.y;
		}

/* REPLACE END: _move */

	},

	_end: function (e) {
		if ( !this.enabled || utils.eventType[e.type] !== this.initiated ) {
			return;
		}

		if ( this.options.preventDefault && !utils.preventDefaultException(e.target, this.options.preventDefaultException) ) {
			e.preventDefault();
		}

		var point = e.changedTouches ? e.changedTouches[0] : e,
			momentumX,
			momentumY,
			duration = utils.getTime() - this.startTime,
			newX = Math.round(this.x),
			newY = Math.round(this.y),
			distanceX = Math.abs(newX - this.startX),
			distanceY = Math.abs(newY - this.startY),
			time = 0,
			easing = '';

		this.scrollTo(newX, newY);	// ensures that the last position is rounded

		this.isInTransition = 0;
		this.initiated = 0;
		this.endTime = utils.getTime();

		// reset if we are outside of the boundaries
		if ( this.resetPosition(this.options.bounceTime) ) {
			return;
		}

		// we scrolled less than 10 pixels
		if ( !this.moved ) {
			if ( this.options.tap ) {
				utils.tap(e, this.options.tap);
			}

			if ( this.options.click ) {
				utils.click(e);
			}

			return;
		}

		if ( this._events.flick && duration < 200 && distanceX < 100 && distanceY < 100 ) {
			this._execEvent('flick');
			return;
		}

		// start momentum animation if needed
		if ( this.options.momentum && duration < 300 ) {
			momentumX = this.hasHorizontalScroll ? utils.momentum(this.x, this.startX, duration, this.maxScrollX, this.options.bounce ? this.wrapperWidth : 0) : { destination: newX, duration: 0 };
			momentumY = this.hasVerticalScroll ? utils.momentum(this.y, this.startY, duration, this.maxScrollY, this.options.bounce ? this.wrapperHeight : 0) : { destination: newY, duration: 0 };
			newX = momentumX.destination;
			newY = momentumY.destination;
			time = Math.max(momentumX.duration, momentumY.duration);
			this.isInTransition = 1;
		}


		if ( this.options.snap ) {
			var snap = this._nearestSnap(newX, newY);
			this.currentPage = snap;
			time = this.options.snapSpeed || Math.max(
					Math.max(
						Math.min(Math.abs(newX - snap.x), 1000),
						Math.min(Math.abs(newY - snap.y), 1000)
					), 300);
			newX = snap.x;
			newY = snap.y;

			this.directionX = 0;
			this.directionY = 0;
			easing = this.options.bounceEasing;
		}

// INSERT POINT: _end

		if ( newX != this.x || newY != this.y ) {
			// change easing function when scroller goes out of the boundaries
			if ( newX > 0 || newX < this.maxScrollX || newY > 0 || newY < this.maxScrollY ) {
				easing = utils.ease.quadratic;
			}

			this.scrollTo(newX, newY, time, easing);
			return;
		}

		this._execEvent('scrollEnd');
	},

	_resize: function () {
		var that = this;

		clearTimeout(this.resizeTimeout);

		this.resizeTimeout = setTimeout(function () {
			that.refresh();
		}, this.options.resizePolling);
	},

	resetPosition: function (time) {
		var x = this.x,
			y = this.y;

		time = time || 0;

		if ( !this.hasHorizontalScroll || this.x > 0 ) {
			x = 0;
		} else if ( this.x < this.maxScrollX ) {
			x = this.maxScrollX;
		}

		if ( !this.hasVerticalScroll || this.y > 0 ) {
			y = 0;
		} else if ( this.y < this.maxScrollY ) {
			y = this.maxScrollY;
		}

		if ( x == this.x && y == this.y ) {
			return false;
		}

		this.scrollTo(x, y, time, this.options.bounceEasing);

		return true;
	},

	disable: function () {
		this.enabled = false;
	},

	enable: function () {
		this.enabled = true;
	},

	refresh: function () {
		var rf = this.wrapper.offsetHeight;		// Force reflow

		this.wrapperWidth	= this.wrapper.clientWidth;
		this.wrapperHeight	= this.wrapper.clientHeight;

/* REPLACE START: refresh */

		this.scrollerWidth	= this.scroller.offsetWidth;
		this.scrollerHeight	= this.scroller.offsetHeight;

/* REPLACE END: refresh */

		this.maxScrollX		= this.wrapperWidth - this.scrollerWidth;
		this.maxScrollY		= this.wrapperHeight - this.scrollerHeight;

		this.hasHorizontalScroll	= this.options.scrollX && this.maxScrollX < 0;
		this.hasVerticalScroll		= this.options.scrollY && this.maxScrollY < 0;

		if ( !this.hasHorizontalScroll ) {
			this.maxScrollX = 0;
			this.scrollerWidth = this.wrapperWidth;
		}

		if ( !this.hasVerticalScroll ) {
			this.maxScrollY = 0;
			this.scrollerHeight = this.wrapperHeight;
		}

		this.endTime = 0;
		this.directionX = 0;
		this.directionY = 0;

		this.wrapperOffset = utils.offset(this.wrapper);

		this._execEvent('refresh');

		this.resetPosition();

// INSERT POINT: _refresh

	},

	on: function (type, fn) {
		if ( !this._events[type] ) {
			this._events[type] = [];
		}

		this._events[type].push(fn);
	},

	_execEvent: function (type) {
		if ( !this._events[type] ) {
			return;
		}

		var i = 0,
			l = this._events[type].length;

		if ( !l ) {
			return;
		}

		for ( ; i < l; i++ ) {
			this._events[type][i].call(this);
		}
	},

	scrollBy: function (x, y, time, easing) {
		x = this.x + x;
		y = this.y + y;
		time = time || 0;

		this.scrollTo(x, y, time, easing);
	},

	scrollTo: function (x, y, time, easing) {
		easing = easing || utils.ease.circular;

		if ( !time || (this.options.useTransition && easing.style) ) {
			this._transitionTimingFunction(easing.style);
			this._transitionTime(time);
			this._translate(x, y);
		} else {
			this._animate(x, y, time, easing.fn);
		}
	},

	scrollToElement: function (el, time, offsetX, offsetY, easing) {
		el = el.nodeType ? el : this.scroller.querySelector(el);

		if ( !el ) {
			return;
		}

		var pos = utils.offset(el);

		pos.left -= this.wrapperOffset.left;
		pos.top  -= this.wrapperOffset.top;

		// if offsetX/Y are true we center the element to the screen
		if ( offsetX === true ) {
			offsetX = Math.round(el.offsetWidth / 2 - this.wrapper.offsetWidth / 2);
		}
		if ( offsetY === true ) {
			offsetY = Math.round(el.offsetHeight / 2 - this.wrapper.offsetHeight / 2);
		}

		pos.left -= offsetX || 0;
		pos.top  -= offsetY || 0;

		pos.left = pos.left > 0 ? 0 : pos.left < this.maxScrollX ? this.maxScrollX : pos.left;
		pos.top  = pos.top  > 0 ? 0 : pos.top  < this.maxScrollY ? this.maxScrollY : pos.top;

		time = time === undefined || time === null || time === 'auto' ? Math.max(Math.abs(this.x-pos.left), Math.abs(this.y-pos.top)) : time;

		this.scrollTo(pos.left, pos.top, time, easing);
	},

	_transitionTime: function (time) {
		time = time || 0;
		this.scrollerStyle[utils.style.transitionDuration] = time + 'ms';


		if ( this.indicator1 ) {
			this.indicator1.transitionTime(time);
		}

		if ( this.indicator2 ) {
			this.indicator2.transitionTime(time);
		}

// INSERT POINT: _transitionTime

	},

	_transitionTimingFunction: function (easing) {
		this.scrollerStyle[utils.style.transitionTimingFunction] = easing;


		if ( this.indicator1 ) {
			this.indicator1.transitionTimingFunction(easing);
		}

		if ( this.indicator2 ) {
			this.indicator2.transitionTimingFunction(easing);
		}


// INSERT POINT: _transitionTimingFunction

	},

	_translate: function (x, y) {
		if ( this.options.useTransform ) {

/* REPLACE START: _translate */

			this.scrollerStyle[utils.style.transform] = 'translate(' + x + 'px,' + y + 'px)' + this.translateZ;

/* REPLACE END: _translate */

		} else {
			x = Math.round(x);
			y = Math.round(y);
			this.scrollerStyle.left = x + 'px';
			this.scrollerStyle.top = y + 'px';
		}

		this.x = x;
		this.y = y;


	if ( this.indicator1 ) {	// usually the vertical
		this.indicator1.updatePosition();
	}

	if ( this.indicator2 ) {
		this.indicator2.updatePosition();
	}

// INSERT POINT: _translate

	},

	_initEvents: function (remove) {
		var eventType = remove ? utils.removeEvent : utils.addEvent,
			target = this.options.bindToWrapper ? this.wrapper : window;

		eventType(window, 'orientationchange', this);
		eventType(window, 'resize', this);

		eventType(this.wrapper, 'mousedown', this);
		eventType(target, 'mousemove', this);
		eventType(target, 'mousecancel', this);
		eventType(target, 'mouseup', this);

		if ( utils.hasPointer ) {
			eventType(this.wrapper, 'MSPointerDown', this);
			eventType(target, 'MSPointerMove', this);
			eventType(target, 'MSPointerCancel', this);
			eventType(target, 'MSPointerUp', this);
		}

		if ( utils.hasTouch ) {
			eventType(this.wrapper, 'touchstart', this);
			eventType(target, 'touchmove', this);
			eventType(target, 'touchcancel', this);
			eventType(target, 'touchend', this);
		}

		eventType(this.scroller, 'transitionend', this);
		eventType(this.scroller, 'webkitTransitionEnd', this);
		eventType(this.scroller, 'oTransitionEnd', this);
		eventType(this.scroller, 'MSTransitionEnd', this);
	},

	getComputedPosition: function () {
		var matrix = window.getComputedStyle(this.scroller, null),
			x, y;

		if ( this.options.useTransform ) {
			matrix = matrix[utils.style.transform].split(')')[0].split(', ');
			x = +(matrix[12] || matrix[4]);
			y = +(matrix[13] || matrix[5]);
		} else {
			x = +matrix.left.replace(/[^-\d]/g, '');
			y = +matrix.top.replace(/[^-\d]/g, '');
		}

		return { x: x, y: y };
	},

	_initIndicators: function () {
		var interactive = this.options.interactiveScrollbars,
			defaultScrollbars = typeof this.options.scrollbars != 'object',
			customStyle = typeof this.options.scrollbars != 'string',
			indicator1,
			indicator2;

		if ( this.options.scrollbars ) {
			// Vertical scrollbar
			if ( this.options.scrollY ) {
				indicator1 = {
					el: createDefaultScrollbar('v', interactive, this.options.scrollbars),
					interactive: interactive,
					defaultScrollbars: true,
					customStyle: customStyle,
					resize: this.options.resizeIndicator,
					listenX: false
				};

				this.wrapper.appendChild(indicator1.el);
			}

			// Horizontal scrollbar
			if ( this.options.scrollX ) {
				indicator2 = {
					el: createDefaultScrollbar('h', interactive, this.options.scrollbars),
					interactive: interactive,
					defaultScrollbars: true,
					customStyle: customStyle,
					resize: this.options.resizeIndicator,
					listenY: false
				};

				this.wrapper.appendChild(indicator2.el);
			}
		} else {
			indicator1 = this.options.indicators.length ? this.options.indicators[0] : this.options.indicators;
			indicator2 = this.options.indicators[1] && this.options.indicators[1];
		}

		if ( indicator1 ) {
			this.indicator1 = new Indicator(this, indicator1);
		}

		if ( indicator2 ) {
			this.indicator2 = new Indicator(this, indicator2);
		}

		this.on('refresh', function () {
			if ( this.indicator1 ) {
				this.indicator1.refresh();
			}

			if ( this.indicator2 ) {
				this.indicator2.refresh();
			}
		});

		this.on('destroy', function () {
			if ( this.indicator1 ) {
				this.indicator1.destroy();
				this.indicator1 = null;
			}

			if ( this.indicator2 ) {
				this.indicator2.destroy();
				this.indicator2 = null;
			}
		});
	},

	_initWheel: function () {
		utils.addEvent(this.wrapper, 'mousewheel', this);
		utils.addEvent(this.wrapper, 'DOMMouseScroll', this);

		this.on('destroy', function () {
			utils.removeEvent(this.wrapper, 'mousewheel', this);
			utils.removeEvent(this.wrapper, 'DOMMouseScroll', this);
		});
	},

	_wheel: function (e) {
		if ( !this.enabled ) {
			return;
		}

		var wheelDeltaX, wheelDeltaY,
			newX, newY,
			that = this;

		// Execute the scrollEnd event after 400ms the wheel stopped scrolling
		clearTimeout(this.wheelTimeout);
		this.wheelTimeout = setTimeout(function () {
			that._execEvent('scrollEnd');
		}, 400);

		e.preventDefault();

		if ( 'wheelDeltaX' in e ) {
			wheelDeltaX = e.wheelDeltaX / 120;
			wheelDeltaY = e.wheelDeltaY / 120;
		} else if ( 'wheelDelta' in e ) {
			wheelDeltaX = wheelDeltaY = e.wheelDelta / 120;
		} else if ( 'detail' in e ) {
			wheelDeltaX = wheelDeltaY = -e.detail / 3;
		} else {
			return;
		}

		wheelDeltaX *= this.options.mouseWheelSpeed;
		wheelDeltaY *= this.options.mouseWheelSpeed;

		if ( !this.hasVerticalScroll ) {
			wheelDeltaX = wheelDeltaY;
			wheelDeltaY = 0;
		}

		if ( this.options.snap ) {
			newX = this.currentPage.pageX;
			newY = this.currentPage.pageY;

			if ( wheelDeltaX > 0 ) {
				newX--;
			} else if ( wheelDeltaX < 0 ) {
				newX++;
			}

			if ( wheelDeltaY > 0 ) {
				newY--;
			} else if ( wheelDeltaY < 0 ) {
				newY++;
			}

			this.goToPage(newX, newY);

			return;
		}

		newX = this.x + (this.hasHorizontalScroll ? wheelDeltaX * this.options.invertWheelDirection : 0);
		newY = this.y + (this.hasVerticalScroll ? wheelDeltaY * this.options.invertWheelDirection : 0);

		if ( newX > 0 ) {
			newX = 0;
		} else if ( newX < this.maxScrollX ) {
			newX = this.maxScrollX;
		}

		if ( newY > 0 ) {
			newY = 0;
		} else if ( newY < this.maxScrollY ) {
			newY = this.maxScrollY;
		}

		this.scrollTo(newX, newY, 0);

// INSERT POINT: _wheel
	},

	_initSnap: function () {
		this.currentPage = {};

		if ( typeof this.options.snap == 'string' ) {
			this.options.snap = this.scroller.querySelectorAll(this.options.snap);
		}

		this.on('refresh', function () {
			var i = 0, l,
				m = 0, n,
				cx, cy,
				x = 0, y,
				stepX = this.options.snapStepX || this.wrapperWidth,
				stepY = this.options.snapStepY || this.wrapperHeight,
				el;

			this.pages = [];

			if ( !this.wrapperWidth || !this.wrapperHeight || !this.scrollerWidth || !this.scrollerHeight ) {
				return;
			}

			if ( this.options.snap === true ) {
				cx = Math.round( stepX / 2 );
				cy = Math.round( stepY / 2 );

				while ( x > -this.scrollerWidth ) {
					this.pages[i] = [];
					l = 0;
					y = 0;

					while ( y > -this.scrollerHeight ) {
						this.pages[i][l] = {
							x: Math.max(x, this.maxScrollX),
							y: Math.max(y, this.maxScrollY),
							width: stepX,
							height: stepY,
							cx: x - cx,
							cy: y - cy
						};

						y -= stepY;
						l++;
					}

					x -= stepX;
					i++;
				}
			} else {
				el = this.options.snap;
				l = el.length;
				n = -1;

				for ( ; i < l; i++ ) {
					if ( i === 0 || el[i].offsetLeft <= el[i-1].offsetLeft ) {
						m = 0;
						n++;
					}

					if ( !this.pages[m] ) {
						this.pages[m] = [];
					}

					x = Math.max(-el[i].offsetLeft, this.maxScrollX);
					y = Math.max(-el[i].offsetTop, this.maxScrollY);
					cx = x - Math.round(el[i].offsetWidth / 2);
					cy = y - Math.round(el[i].offsetHeight / 2);

					this.pages[m][n] = {
						x: x,
						y: y,
						width: el[i].offsetWidth,
						height: el[i].offsetHeight,
						cx: cx,
						cy: cy
					};

					if ( x > this.maxScrollX ) {
						m++;
					}
				}
			}

			this.goToPage(this.currentPage.pageX || 0, this.currentPage.pageY || 0, 0);

			// Update snap threshold if needed
			if ( this.options.snapThreshold % 1 === 0 ) {
				this.snapThresholdX = this.options.snapThreshold;
				this.snapThresholdY = this.options.snapThreshold;
			} else {
				this.snapThresholdX = Math.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width * this.options.snapThreshold);
				this.snapThresholdY = Math.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height * this.options.snapThreshold);
			}
		});

		this.on('flick', function () {
			var time = this.options.snapSpeed || Math.max(
					Math.max(
						Math.min(Math.abs(this.x - this.startX), 1000),
						Math.min(Math.abs(this.y - this.startY), 1000)
					), 300);

			this.goToPage(
				this.currentPage.pageX + this.directionX,
				this.currentPage.pageY + this.directionY,
				time
			);
		});
	},

	_nearestSnap: function (x, y) {
		if ( !this.pages.length ) {
			return { x: 0, y: 0, pageX: 0, pageY: 0 };
		}

		var i = 0,
			l = this.pages.length,
			m = 0;

		// Check if we exceeded the snap threshold
		if ( Math.abs(x - this.absStartX) < this.snapThresholdX &&
			Math.abs(y - this.absStartY) < this.snapThresholdY ) {
			return this.currentPage;
		}

		if ( x > 0 ) {
			x = 0;
		} else if ( x < this.maxScrollX ) {
			x = this.maxScrollX;
		}

		if ( y > 0 ) {
			y = 0;
		} else if ( y < this.maxScrollY ) {
			y = this.maxScrollY;
		}

		for ( ; i < l; i++ ) {
			if ( x >= this.pages[i][0].cx ) {
				x = this.pages[i][0].x;
				break;
			}
		}

		l = this.pages[i].length;

		for ( ; m < l; m++ ) {
			if ( y >= this.pages[0][m].cy ) {
				y = this.pages[0][m].y;
				break;
			}
		}

		if ( i == this.currentPage.pageX ) {
			i += this.directionX;

			if ( i < 0 ) {
				i = 0;
			} else if ( i >= this.pages.length ) {
				i = this.pages.length - 1;
			}

			x = this.pages[i][0].x;
		}

		if ( m == this.currentPage.pageY ) {
			m += this.directionY;

			if ( m < 0 ) {
				m = 0;
			} else if ( m >= this.pages[0].length ) {
				m = this.pages[0].length - 1;
			}

			y = this.pages[0][m].y;
		}

		return {
			x: x,
			y: y,
			pageX: i,
			pageY: m
		};
	},

	goToPage: function (x, y, time, easing) {
		easing = easing || this.options.bounceEasing;

		if ( x >= this.pages.length ) {
			x = this.pages.length - 1;
		} else if ( x < 0 ) {
			x = 0;
		}

		if ( y >= this.pages[x].length ) {
			y = this.pages[x].length - 1;
		} else if ( y < 0 ) {
			y = 0;
		}

		var posX = this.pages[x][y].x,
			posY = this.pages[x][y].y;

		time = time === undefined ? this.options.snapSpeed || Math.max(
			Math.max(
				Math.min(Math.abs(posX - this.x), 1000),
				Math.min(Math.abs(posY - this.y), 1000)
			), 300) : time;

		this.currentPage = {
			x: posX,
			y: posY,
			pageX: x,
			pageY: y
		};

		this.scrollTo(posX, posY, time, easing);
	},

	next: function (time, easing) {
		var x = this.currentPage.pageX,
			y = this.currentPage.pageY;

		x++;

		if ( x >= this.pages.length && this.hasVerticalScroll ) {
			x = 0;
			y++;
		}

		this.goToPage(x, y, time, easing);
	},

	prev: function (time, easing) {
		var x = this.currentPage.pageX,
			y = this.currentPage.pageY;

		x--;

		if ( x < 0 && this.hasVerticalScroll ) {
			x = 0;
			y--;
		}

		this.goToPage(x, y, time, easing);
	},

	_initKeys: function (e) {
		// default key bindings
		var keys = {
			pageUp: 33,
			pageDown: 34,
			end: 35,
			home: 36,
			left: 37,
			up: 38,
			right: 39,
			down: 40
		};
		var i;

		// if you give me characters I give you keycode
		if ( typeof this.options.keyBindings == 'object' ) {
			for ( i in this.options.keyBindings ) {
				if ( typeof this.options.keyBindings[i] == 'string' ) {
					this.options.keyBindings[i] = this.options.keyBindings[i].toUpperCase().charCodeAt(0);
				}
			}
		} else {
			this.options.keyBindings = {};
		}

		for ( i in keys ) {
			this.options.keyBindings[i] = this.options.keyBindings[i] || keys[i];
		}

		utils.addEvent(window, 'keydown', this);

		this.on('destroy', function () {
			utils.removeEvent(window, 'keydown', this);
		});
	},

	_key: function (e) {
		if ( !this.enabled ) {
			return;
		}

		var snap = this.options.snap,	// we are using this alot, better to cache it
			newX = snap ? this.currentPage.pageX : this.x,
			newY = snap ? this.currentPage.pageY : this.y,
			now = utils.getTime(),
			prevTime = this.keyTime || 0,
			acceleration = 0.250,
			pos;

		if ( this.options.useTransition && this.isInTransition ) {
			pos = this.getComputedPosition();

			this._translate(Math.round(pos.x), Math.round(pos.y));
			this.isInTransition = false;
		}

		this.keyAcceleration = now - prevTime < 200 ? Math.min(this.keyAcceleration + acceleration, 50) : 0;

		switch ( e.keyCode ) {
			case this.options.keyBindings.pageUp:
				if ( this.hasHorizontalScroll && !this.hasVerticalScroll ) {
					newX += snap ? 1 : this.wrapperWidth;
				} else {
					newY += snap ? 1 : this.wrapperHeight;
				}
				break;
			case this.options.keyBindings.pageDown:
				if ( this.hasHorizontalScroll && !this.hasVerticalScroll ) {
					newX -= snap ? 1 : this.wrapperWidth;
				} else {
					newY -= snap ? 1 : this.wrapperHeight;
				}
				break;
			case this.options.keyBindings.end:
				newX = snap ? this.pages.length-1 : this.maxScrollX;
				newY = snap ? this.pages[0].length-1 : this.maxScrollY;
				break;
			case this.options.keyBindings.home:
				newX = 0;
				newY = 0;
				break;
			case this.options.keyBindings.left:
				newX += snap ? -1 : 5 + this.keyAcceleration>>0;
				break;
			case this.options.keyBindings.up:
				newY += snap ? 1 : 5 + this.keyAcceleration>>0;
				break;
			case this.options.keyBindings.right:
				newX -= snap ? -1 : 5 + this.keyAcceleration>>0;
				break;
			case this.options.keyBindings.down:
				newY -= snap ? 1 : 5 + this.keyAcceleration>>0;
				break;
		}

		if ( snap ) {
			this.goToPage(newX, newY);
			return;
		}

		if ( newX > 0 ) {
			newX = 0;
			this.keyAcceleration = 0;
		} else if ( newX < this.maxScrollX ) {
			newX = this.maxScrollX;
			this.keyAcceleration = 0;
		}

		if ( newY > 0 ) {
			newY = 0;
			this.keyAcceleration = 0;
		} else if ( newY < this.maxScrollY ) {
			newY = this.maxScrollY;
			this.keyAcceleration = 0;
		}

		this.scrollTo(newX, newY, 0);

		this.keyTime = now;
	},

	_animate: function (destX, destY, duration, easingFn) {
		var that = this,
			startX = this.x,
			startY = this.y,
			startTime = utils.getTime(),
			destTime = startTime + duration;

		function step () {
			var now = utils.getTime(),
				newX, newY,
				easing;

			if ( now >= destTime ) {
				that.isAnimating = false;
				that._translate(destX, destY);

				if ( !that.resetPosition(that.options.bounceTime) ) {
					that._execEvent('scrollEnd');
				}

				return;
			}

			now = ( now - startTime ) / duration;
			easing = easingFn(now);
			newX = ( destX - startX ) * easing + startX;
			newY = ( destY - startY ) * easing + startY;
			that._translate(newX, newY);

			if ( that.isAnimating ) {
				rAF(step);
			}
		}

		this.isAnimating = true;
		step();
	},
	handleEvent: function (e) {
		switch ( e.type ) {
			case 'touchstart':
			case 'MSPointerDown':
			case 'mousedown':
				this._start(e);
				break;
			case 'touchmove':
			case 'MSPointerMove':
			case 'mousemove':
				this._move(e);
				break;
			case 'touchend':
			case 'MSPointerUp':
			case 'mouseup':
			case 'touchcancel':
			case 'MSPointerCancel':
			case 'mousecancel':
				this._end(e);
				break;
			case 'orientationchange':
			case 'resize':
				this._resize();
				break;
			case 'transitionend':
			case 'webkitTransitionEnd':
			case 'oTransitionEnd':
			case 'MSTransitionEnd':
				this._transitionEnd(e);
				break;
			case 'DOMMouseScroll':
			case 'mousewheel':
				this._wheel(e);
				break;
			case 'keydown':
				this._key(e);
				break;
		}
	}
};
function createDefaultScrollbar (direction, interactive, type) {
	var scrollbar = document.createElement('div'),
		indicator = document.createElement('div');

	if ( type === true ) {
		scrollbar.style.cssText = 'position:absolute;z-index:9999';
		indicator.style.cssText = '-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px';
	}

	indicator.className = 'iScrollIndicator';

	if ( direction == 'h' ) {
		if ( type === true ) {
			scrollbar.style.cssText += ';height:7px;left:2px;right:2px;bottom:0';
			indicator.style.height = '100%';
		}
		scrollbar.className = 'iScrollHorizontalScrollbar';
	} else {
		if ( type === true ) {
			scrollbar.style.cssText += ';width:7px;bottom:2px;top:2px;right:1px';
			indicator.style.width = '100%';
		}
		scrollbar.className = 'iScrollVerticalScrollbar';
	}

	if ( !interactive ) {
		scrollbar.style.pointerEvents = 'none';
	}

	scrollbar.appendChild(indicator);

	return scrollbar;
}

function Indicator (scroller, options) {
	this.wrapper = typeof options.el == 'string' ? document.querySelector(options.el) : options.el;
	this.indicator = this.wrapper.children[0];
	this.indicatorStyle = this.indicator.style;
	this.scroller = scroller;

	this.options = {
		listenX: true,
		listenY: true,
		interactive: false,
		resize: true,
		defaultScrollbars: false,
		speedRatioX: 0,
		speedRatioY: 0
	};

	for ( var i in options ) {
		this.options[i] = options[i];
	}

	this.sizeRatioX = 1;
	this.sizeRatioY = 1;
	this.maxPosX = 0;
	this.maxPosY = 0;

	if ( this.options.interactive ) {
		utils.addEvent(this.indicator, 'touchstart', this);
		utils.addEvent(this.indicator, 'MSPointerDown', this);
		utils.addEvent(this.indicator, 'mousedown', this);

		utils.addEvent(window, 'touchend', this);
		utils.addEvent(window, 'MSPointerUp', this);
		utils.addEvent(window, 'mouseup', this);
	}
}

Indicator.prototype = {
	handleEvent: function (e) {
		switch ( e.type ) {
			case 'touchstart':
			case 'MSPointerDown':
			case 'mousedown':
				this._start(e);
				break;
			case 'touchmove':
			case 'MSPointerMove':
			case 'mousemove':
				this._move(e);
				break;
			case 'touchend':
			case 'MSPointerUp':
			case 'mouseup':
			case 'touchcancel':
			case 'MSPointerCancel':
			case 'mousecancel':
				this._end(e);
				break;
		}
	},

	destroy: function () {
		if ( this.options.interactive ) {
			utils.removeEvent(this.indicator, 'touchstart', this);
			utils.removeEvent(this.indicator, 'MSPointerDown', this);
			utils.removeEvent(this.indicator, 'mousedown', this);

			utils.removeEvent(window, 'touchmove', this);
			utils.removeEvent(window, 'MSPointerMove', this);
			utils.removeEvent(window, 'mousemove', this);

			utils.removeEvent(window, 'touchend', this);
			utils.removeEvent(window, 'MSPointerUp', this);
			utils.removeEvent(window, 'mouseup', this);
		}

		if ( this.options.defaultScrollbars ) {
			this.wrapper.parentNode.removeChild(this.wrapper);
		}
	},

	_start: function (e) {
		var point = e.touches ? e.touches[0] : e;

		e.preventDefault();
		e.stopPropagation();

		this.transitionTime(0);

		this.initiated = true;
		this.moved = false;
		this.lastPointX	= point.pageX;
		this.lastPointY	= point.pageY;

		this.startTime	= utils.getTime();

		utils.addEvent(window, 'touchmove', this);
		utils.addEvent(window, 'MSPointerMove', this);
		utils.addEvent(window, 'mousemove', this);

		this.scroller._execEvent('scrollStart');
	},

	_move: function (e) {
		var point = e.touches ? e.touches[0] : e,
			deltaX, deltaY,
			newX, newY,
			timestamp = utils.getTime();

		this.moved = true;

		deltaX = point.pageX - this.lastPointX;
		this.lastPointX = point.pageX;

		deltaY = point.pageY - this.lastPointY;
		this.lastPointY = point.pageY;

		newX = this.x + deltaX;
		newY = this.y + deltaY;

		this._pos(newX, newY);

		e.preventDefault();
		e.stopPropagation();
	},

	_end: function (e) {
		if ( !this.initiated ) {
			return;
		}

		this.initiated = false;

		e.preventDefault();
		e.stopPropagation();

		utils.removeEvent(window, 'touchmove', this);
		utils.removeEvent(window, 'MSPointerMove', this);
		utils.removeEvent(window, 'mousemove', this);

		if ( this.scroller.options.snap ) {
			var snap = this.scroller._nearestSnap(this.scroller.x, this.scroller.y);

			var time = this.options.snapSpeed || Math.max(
					Math.max(
						Math.min(Math.abs(this.scroller.x - snap.x), 1000),
						Math.min(Math.abs(this.scroller.y - snap.y), 1000)
					), 300);

			if ( this.scroller.x != snap.x || this.scroller.y != snap.y ) {
				this.scroller.directionX = 0;
				this.scroller.directionY = 0;
				this.scroller.currentPage = snap;
				this.scroller.scrollTo(snap.x, snap.y, time, this.scroller.options.bounceEasing);
			}
		}

		if ( this.moved ) {
			this.scroller._execEvent('scrollEnd');
		}
	},

	transitionTime: function (time) {
		time = time || 0;
		this.indicatorStyle[utils.style.transitionDuration] = time + 'ms';
	},

	transitionTimingFunction: function (easing) {
		this.indicatorStyle[utils.style.transitionTimingFunction] = easing;
	},

	refresh: function () {
		this.transitionTime(0);

		if ( this.options.listenX && !this.options.listenY ) {
			this.indicatorStyle.display = this.scroller.hasHorizontalScroll ? 'block' : 'none';
		} else if ( this.options.listenY && !this.options.listenX ) {
			this.indicatorStyle.display = this.scroller.hasVerticalScroll ? 'block' : 'none';
		} else {
			this.indicatorStyle.display = this.scroller.hasHorizontalScroll || this.scroller.hasVerticalScroll ? 'block' : 'none';
		}

		if ( this.scroller.hasHorizontalScroll && this.scroller.hasVerticalScroll ) {
			utils.addClass(this.wrapper, 'iScrollBothScrollbars');
			utils.removeClass(this.wrapper, 'iScrollLoneScrollbar');

			if ( this.options.defaultScrollbars && this.options.customStyle ) {
				if ( this.options.listenX ) {
					this.wrapper.style.right = '8px';
				} else {
					this.wrapper.style.bottom = '8px';
				}
			}
		} else {
			utils.removeClass(this.wrapper, 'iScrollBothScrollbars');
			utils.addClass(this.wrapper, 'iScrollLoneScrollbar');

			if ( this.options.defaultScrollbars && this.options.customStyle ) {
				if ( this.options.listenX ) {
					this.wrapper.style.right = '2px';
				} else {
					this.wrapper.style.bottom = '2px';
				}
			}
		}

		var r = this.wrapper.offsetHeight;	// force refresh

		if ( this.options.listenX ) {
			this.wrapperWidth = this.wrapper.clientWidth;
			if ( this.options.resize ) {
				this.indicatorWidth = Math.max(Math.round(this.wrapperWidth * this.wrapperWidth / (this.scroller.scrollerWidth || this.wrapperWidth || 1)), 8);
				this.indicatorStyle.width = this.indicatorWidth + 'px';
			} else {
				this.indicatorWidth = this.indicator.clientWidth;
			}
			this.maxPosX = this.wrapperWidth - this.indicatorWidth;
			this.sizeRatioX = this.options.speedRatioX || (this.scroller.maxScrollX && (this.maxPosX / this.scroller.maxScrollX));	
		}

		if ( this.options.listenY ) {
			this.wrapperHeight = this.wrapper.clientHeight;
			if ( this.options.resize ) {
				this.indicatorHeight = Math.max(Math.round(this.wrapperHeight * this.wrapperHeight / (this.scroller.scrollerHeight || this.wrapperHeight || 1)), 8);
				this.indicatorStyle.height = this.indicatorHeight + 'px';
			} else {
				this.indicatorHeight = this.indicator.clientHeight;
			}

			this.maxPosY = this.wrapperHeight - this.indicatorHeight;
			this.sizeRatioY = this.options.speedRatioY || (this.scroller.maxScrollY && (this.maxPosY / this.scroller.maxScrollY));
		}

		this.updatePosition();
	},

	updatePosition: function () {
		var x = Math.round(this.sizeRatioX * this.scroller.x) || 0,
			y = Math.round(this.sizeRatioY * this.scroller.y) || 0;

		if ( !this.options.ignoreBoundaries ) {
			if ( x < 0 ) {
				x = 0;
			} else if ( x > this.maxPosX ) {
				x = this.maxPosX;
			}

			if ( y < 0 ) {
				y = 0;
			} else if ( y > this.maxPosY ) {
				y = this.maxPosY;
			}		
		}

		this.x = x;
		this.y = y;

		if ( this.scroller.options.useTransform ) {
			this.indicatorStyle[utils.style.transform] = 'translate(' + x + 'px,' + y + 'px)' + this.scroller.translateZ;
		} else {
			this.indicatorStyle.left = x + 'px';
			this.indicatorStyle.top = y + 'px';
		}
	},

	_pos: function (x, y) {
		if ( x < 0 ) {
			x = 0;
		} else if ( x > this.maxPosX ) {
			x = this.maxPosX;
		}

		if ( y < 0 ) {
			y = 0;
		} else if ( y > this.maxPosY ) {
			y = this.maxPosY;
		}

		x = this.options.listenX ? Math.round(x / this.sizeRatioX) : this.scroller.x;
		y = this.options.listenY ? Math.round(y / this.sizeRatioY) : this.scroller.y;

		this.scroller.scrollTo(x, y);
	}
};

IScroll.ease = utils.ease;

return IScroll;

})(window, document, Math);/*
 * @author: Jan Korreck (BB&K)
 * Script für die Behandlung von Pointer events bzw. das scrolling innerhalb des IScroll Moduls
 * (verwendet in Social Hub und Gallery)
 * Die Events auf einem gallery item werden nur verarbeitet, wenn ein scrolling nicht erfolgte
 */
 var IScrollPointerHandler = IScrollPointerHandler || {};

 ;(function($,  window, document, undefined) {
    'use strict';

    // Selektor, des IScroll Element bzw. dessen Container
    var iScrollSelector = '';
    // Für den Slider muss eine Überprüfung erfolgen, wie weit der Slider in x-richtung
    // bewegt wurde, bevor das click Event auf ein Galerie-Element ausgelöst wird.
    var clickThreshold = 2;
    // Das Event wird nur verarbeitet, wenn die y-Scroll Grenze überschritten wurde
    var pointerDownX = 0
      , pointerMoveX = 0
      , pointerDownY = 0
      , pointerMoveY = 0;

    // Überprüfung der gescrollten Distanz
    // Für touch Geräte erfolgt die Überprüfung bei Touch-Move
    // Füt nicht touch Geräte erfolgt die Überprüfung bei MouseMove
    var pointerDownEvent = 'mousedown'
      , pointerMoveEvent = 'mousemove'
      , pointerEndEvent   = 'mouseup';

    // Pointer Event Typen festlegen
    if (Modernizr.touch || window.navigator.msPointerEnabled) {
        pointerDownEvent = window.navigator.msPointerEnabled ? 'MSPointerDown' : 'touchstart';
        pointerMoveEvent = window.navigator.msPointerEnabled ? 'MSPointerMove' : 'touchmove';
        pointerEndEvent = window.navigator.msPointerEnabled ? 'MSPointerUp' : 'touchend';
    }

    // Handle Pointer Events
    function handlePointerDownEvent(event) {

        if (event.type === 'touchstart' || event.type === 'MSPointerDown') {
            if (event.originalEvent.touches) {
                pointerDownX = event.originalEvent.touches[0].clientX;
                pointerDownY = event.originalEvent.touches[0].clientY;
            } else {
                pointerDownX = event.originalEvent.clientX;
                pointerDownY = event.originalEvent.clientY;
            }
        } else if (event.type == 'mousedown') {
            pointerDownX = event.clientX;
            pointerDownY = event.clientY;
        }

        pointerMoveX = pointerDownX;
        pointerMoveY = pointerDownY;

        attachPointerMoveListener();
        attachPointerEndListener();
    }

    // Handle Pointer move
    function handlePointerMoveEvent(event) {

        if (event.type === 'touchmove' || event.type === 'MSPointerMove') {

            if (event.originalEvent.touches) {
                pointerMoveX = event.originalEvent.touches[0].clientX;
                pointerMoveY = event.originalEvent.touches[0].clientY;
            } else {
                pointerMoveX = event.clientX;
                pointerMoveY = event.clientY;
            }

        } else if (event.type == 'mousemove') {
            pointerMoveX = event.clientX;
            pointerMoveY = event.clientY;
        }
    }

    // Handle Pointer end
    function handlePointerEndEvent(event) {
        detachPointerMoveListener();
        detachPointerEndListener();
    }

    // Attach/ detach pointer event Listener
    function attachPointerDownListener(selector) {

        iScrollSelector = selector;

        $(iScrollSelector).on(pointerDownEvent, function(event) {
            handlePointerDownEvent(event);
        });
    }

    function attachPointerMoveListener() {
        $(iScrollSelector).on(pointerMoveEvent, function(event) {
            handlePointerMoveEvent(event);
        });
    }

    function attachPointerEndListener() {
        $(iScrollSelector).on(pointerEndEvent, function(event) {
            handlePointerEndEvent(event);
        });
    }

    function detachPointerMoveListener() {
        $(iScrollSelector).off(pointerMoveEvent);
    }

    function detachPointerEndListener() {
        $(iScrollSelector).off(pointerEndEvent);
    }

    // Überprüfung, ob in X-Richtung gescrollt wurde. Hier werden die callback-werte des IScroll
    // Verwendet
    function hasNotScrolledInX() {
        return (Math.abs(pointerDownX - pointerMoveX) <= clickThreshold);
    }

    // Überprüfung, ob in Y-Richtung gescrollt wurde
    function hasNotScrolledInY() {
        return (Math.abs(pointerDownY - pointerMoveY) <= clickThreshold);
    }

    IScrollPointerHandler.attachPointerDownListener = attachPointerDownListener;
    IScrollPointerHandler.hasNotScrolledInX = hasNotScrolledInX;
    IScrollPointerHandler.hasNotScrolledInY = hasNotScrolledInY;

})(jQuery, this, this.document);
/*
 * jQuery Easing v1.3 - http://gsgd.co.uk/sandbox/jquery/easing/
 *
 * Uses the built in easing capabilities added In jQuery 1.1
 * to offer multiple easing options
 *
 * TERMS OF USE - jQuery Easing
 *
 * Open source under the BSD License.
 *
 * Copyright Â© 2008 George McGinley Smith
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * Neither the name of the author nor the names of contributors may be used to endorse
 * or promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 *
*/

// t: current time, b: begInnIng value, c: change In value, d: duration
jQuery.easing['jswing'] = jQuery.easing['swing'];

jQuery.extend( jQuery.easing,
{
    def: 'easeOutQuad',
    swing: function (x, t, b, c, d) {
        //alert(jQuery.easing.default);
        return jQuery.easing[jQuery.easing.def](x, t, b, c, d);
    },
    easeInQuad: function (x, t, b, c, d) {
        return c*(t/=d)*t + b;
    },
    easeOutQuad: function (x, t, b, c, d) {
        return -c *(t/=d)*(t-2) + b;
    },
    easeInOutQuad: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return c/2*t*t + b;
        return -c/2 * ((--t)*(t-2) - 1) + b;
    },
    easeInCubic: function (x, t, b, c, d) {
        return c*(t/=d)*t*t + b;
    },
    easeOutCubic: function (x, t, b, c, d) {
        return c*((t=t/d-1)*t*t + 1) + b;
    },
    easeInOutCubic: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return c/2*t*t*t + b;
        return c/2*((t-=2)*t*t + 2) + b;
    },
    easeInQuart: function (x, t, b, c, d) {
        return c*(t/=d)*t*t*t + b;
    },
    easeOutQuart: function (x, t, b, c, d) {
        return -c * ((t=t/d-1)*t*t*t - 1) + b;
    },
    easeInOutQuart: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return c/2*t*t*t*t + b;
        return -c/2 * ((t-=2)*t*t*t - 2) + b;
    },
    easeInQuint: function (x, t, b, c, d) {
        return c*(t/=d)*t*t*t*t + b;
    },
    easeOutQuint: function (x, t, b, c, d) {
        return c*((t=t/d-1)*t*t*t*t + 1) + b;
    },
    easeInOutQuint: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return c/2*t*t*t*t*t + b;
        return c/2*((t-=2)*t*t*t*t + 2) + b;
    },
    easeInSine: function (x, t, b, c, d) {
        return -c * Math.cos(t/d * (Math.PI/2)) + c + b;
    },
    easeOutSine: function (x, t, b, c, d) {
        return c * Math.sin(t/d * (Math.PI/2)) + b;
    },
    easeInOutSine: function (x, t, b, c, d) {
        return -c/2 * (Math.cos(Math.PI*t/d) - 1) + b;
    },
    easeInExpo: function (x, t, b, c, d) {
        return (t==0) ? b : c * Math.pow(2, 10 * (t/d - 1)) + b;
    },
    easeOutExpo: function (x, t, b, c, d) {
        return (t==d) ? b+c : c * (-Math.pow(2, -10 * t/d) + 1) + b;
    },
    easeInOutExpo: function (x, t, b, c, d) {
        if (t==0) return b;
        if (t==d) return b+c;
        if ((t/=d/2) < 1) return c/2 * Math.pow(2, 10 * (t - 1)) + b;
        return c/2 * (-Math.pow(2, -10 * --t) + 2) + b;
    },
    easeInCirc: function (x, t, b, c, d) {
        return -c * (Math.sqrt(1 - (t/=d)*t) - 1) + b;
    },
    easeOutCirc: function (x, t, b, c, d) {
        return c * Math.sqrt(1 - (t=t/d-1)*t) + b;
    },
    easeInOutCirc: function (x, t, b, c, d) {
        if ((t/=d/2) < 1) return -c/2 * (Math.sqrt(1 - t*t) - 1) + b;
        return c/2 * (Math.sqrt(1 - (t-=2)*t) + 1) + b;
    },
    easeInElastic: function (x, t, b, c, d) {
        var s=1.70158;var p=0;var a=c;
        if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
        if (a < Math.abs(c)) { a=c; var s=p/4; }
        else var s = p/(2*Math.PI) * Math.asin (c/a);
        return -(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
    },
    easeOutElastic: function (x, t, b, c, d) {
        var s=1.70158;var p=0;var a=c;
        if (t==0) return b;  if ((t/=d)==1) return b+c;  if (!p) p=d*.3;
        if (a < Math.abs(c)) { a=c; var s=p/4; }
        else var s = p/(2*Math.PI) * Math.asin (c/a);
        return a*Math.pow(2,-10*t) * Math.sin( (t*d-s)*(2*Math.PI)/p ) + c + b;
    },
    easeInOutElastic: function (x, t, b, c, d) {
        var s=1.70158;var p=0;var a=c;
        if (t==0) return b;  if ((t/=d/2)==2) return b+c;  if (!p) p=d*(.3*1.5);
        if (a < Math.abs(c)) { a=c; var s=p/4; }
        else var s = p/(2*Math.PI) * Math.asin (c/a);
        if (t < 1) return -.5*(a*Math.pow(2,10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )) + b;
        return a*Math.pow(2,-10*(t-=1)) * Math.sin( (t*d-s)*(2*Math.PI)/p )*.5 + c + b;
    },
    easeInBack: function (x, t, b, c, d, s) {
        if (s == undefined) s = 1.70158;
        return c*(t/=d)*t*((s+1)*t - s) + b;
    },
    easeOutBack: function (x, t, b, c, d, s) {
        if (s == undefined) s = 1.70158;
        return c*((t=t/d-1)*t*((s+1)*t + s) + 1) + b;
    },
    easeInOutBack: function (x, t, b, c, d, s) {
        if (s == undefined) s = 1.70158;
        if ((t/=d/2) < 1) return c/2*(t*t*(((s*=(1.525))+1)*t - s)) + b;
        return c/2*((t-=2)*t*(((s*=(1.525))+1)*t + s) + 2) + b;
    },
    easeInBounce: function (x, t, b, c, d) {
        return c - jQuery.easing.easeOutBounce (x, d-t, 0, c, d) + b;
    },
    easeOutBounce: function (x, t, b, c, d) {
        if ((t/=d) < (1/2.75)) {
            return c*(7.5625*t*t) + b;
        } else if (t < (2/2.75)) {
            return c*(7.5625*(t-=(1.5/2.75))*t + .75) + b;
        } else if (t < (2.5/2.75)) {
            return c*(7.5625*(t-=(2.25/2.75))*t + .9375) + b;
        } else {
            return c*(7.5625*(t-=(2.625/2.75))*t + .984375) + b;
        }
    },
    easeInOutBounce: function (x, t, b, c, d) {
        if (t < d/2) return jQuery.easing.easeInBounce (x, t*2, 0, c, d) * .5 + b;
        return jQuery.easing.easeOutBounce (x, t*2-d, 0, c, d) * .5 + c*.5 + b;
    }
});

/*
 *
 * TERMS OF USE - EASING EQUATIONS
 *
 * Open source under the BSD License.
 *
 * Copyright Â© 2001 Robert Penner
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * Redistributions of source code must retain the above copyright notice, this list of
 * conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice, this list
 * of conditions and the following disclaimer in the documentation and/or other materials
 * provided with the distribution.
 *
 * Neither the name of the author nor the names of contributors may be used to endorse
 * or promote products derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
 *  COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 *  EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 *  GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED
 * AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
 * OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */

/*
 * jquery.requestAnimationFrame
 * https://github.com/gnarf37/jquery-requestAnimationFrame
 * Requires jQuery 1.8+
 *
 * Copyright (c) 2012 Corey Frang
 * Licensed under the MIT license.
 */
/**
 * GrassPonsive jQuery Animation Plugin
 *
 * Version:		0.1
 * Requires:	jQuery, Modernizr
 * Author: 		Christian Bäumer
 * Copyright:	Bassier, Bergmann & Kindler
 */
;(function($, window, document, undefined) {

	var CSSAnimator = (function() {

		var transEndEventNames 	= {
		    'WebkitTransition' : 'webkitTransitionEnd',
		    'MozTransition'    : 'transitionend',
		    'OTransition'      : 'oTransitionEnd',
		    'msTransition'     : 'MSTransitionEnd',
		    'transition'       : 'transitionend'
		};

		var transEndEventName = transEndEventNames[Modernizr.prefixed('transition')];

		return {

			animate: function(element, properties, duration, easing, delay, callback) {

				var propNames	= [];
				var css3Props	= [];

				for (var field in properties) {

					var css3Field = Modernizr.prefixed(field);

					if (css3Field === false) {
						propNames.push(field);
					} else {
						css3Props.push(field);
						propNames.push(css3Field.replace(/([A-Z])/g, function(str,m1){ return '-' + m1.toLowerCase(); }).replace(/^ms-/,'-ms-'));
					}


					/*
						Vorherige Lösung: erfordert allerdings die prüfung jedes einzelnen css3 blah zeugs...
						-----------------

						if (field == 'transform') {
							css3Props.push(field);
							propNames.push(Modernizr.prefixed(field).replace(/([A-Z])/g, function(str,m1){ return '-' + m1.toLowerCase(); }).replace(/^ms-/,'-ms-'));
						} else {
							propNames.push(field);
						}

					*/

				}

				var allDurations = '';
				var allEasings = '';

				for (var i = 0; i < propNames.length; i++) {
					allDurations += duration + 'ms' + ( (i == (propNames.length - 1)) ? '' : ',');
					allEasings += easing + ( (i == (propNames.length - 1)) ? '' : ',');

				}

/* 				console.log(allDurations); */

				// prepare the element for css3 transitions
				element.style[Modernizr.prefixed('backface-visibility')]	  = 'hidden';
				element.style[Modernizr.prefixed('transitionProperty')] 	  = propNames.join(',');
				element.style[Modernizr.prefixed('transitionDuration')] 	  = allDurations;
				element.style[Modernizr.prefixed('transitionTimingFunction')] = allEasings;
				element.style[Modernizr.prefixed('transitionDelay')] 		  = delay + 'ms';

				// Define the transition end event function to remove the previously added transition styles
				var transEndEventFunc = function(event) {

/*
					this.style[Modernizr.prefixed('backface-visibility')]	   = null;
					this.style[Modernizr.prefixed('transitionProperty')] 	   = null;
					this.style[Modernizr.prefixed('transitionDuration')] 	   = null;
					this.style[Modernizr.prefixed('transitionTimingFunction')] = null;
					this.style[Modernizr.prefixed('transitionDelay')] 		   = null;
*/


					// remove the event listener to prevent multiple callback and event listener calls
					element.removeEventListener(transEndEventName, transEndEventFunc, false);

					// run callback function if such a function was passed to gpAnimate
					if (callback) { callback(); }

				}

				// if transition ends undo all changes and call the callback function (if a function was passed)
				element.addEventListener(transEndEventName, transEndEventFunc, false);

				// apply the transition
				$(element).css(properties);

				for (var i = 0; i < css3Props.length; i++) {
					element.style[Modernizr.prefixed(css3Props[i])] = properties[css3Props[i]];
				}

			}
		}

	})();


	// jQuery Animation Plugin definition
	// ----------------------------------

	$.fn.gpAnimate = function(properties, duration, easing, delay, callback, forceJSAnim) {

		// Do nothing if property is not defined
		if (!properties) return;

		// Support '.gpAnimate(property, callback)'
		if (typeof(duration) === 'function') {
			callback = duration;
			duration = null;
		}

		if (duration === true) {
			forceJSAnim = duration;
			duration = null;
		}

		// Support '.gpAnimate(property, duration, callback)'
		if (typeof(easing) === 'function') {
			callback = easing;
			easing = null;
		}

		if (easing === true) {
			forceJSAnim = easing;
			duration = null;
		}

		if ($.isNumeric(easing)) {
			delay = easing;
			easing = null;
		}

		if (typeof(delay) === 'function') {
			callback = delay;
			delay = 0;
		}

		if (callback === true) {
			forceJSAnim = callback;
			callback = null;
			//console.log("use callback ans force");
		}

		// Setup defaults if no arguments are passed for duration or easing
		duration 	= duration 		||	$.fx.speeds._default;
		easing		= easing 		||	'linear';
		forceJSAnim	= forceJSAnim 	||	false;

		//console.log(forceJSAnim);

/*
		console.log(properties);
		console.log(duration);
		console.log(easing);
		console.log(delay);
		console.log(callback);
		console.log(forceJSAnim);
*/

		return this.each(function() {

			if (Modernizr.csstransitions && !forceJSAnim) {
				// If supported use css transitions
				CSSAnimator.animate(this, properties, duration, easing, delay, callback);
			} else {
				// Fallback: use jQuery animation
				$(this).delay(delay).animate(properties, duration, 'linear', callback);
			}

		});

	}


})(jQuery, this, this.document);
/*! http://mths.be/placeholder v2.0.7 by @mathias */
;(function(f,h,$){var a='placeholder' in h.createElement('input'),d='placeholder' in h.createElement('textarea'),i=$.fn,c=$.valHooks,k,j;if(a&&d){j=i.placeholder=function(){return this};j.input=j.textarea=true}else{j=i.placeholder=function(){var l=this;l.filter((a?'textarea':':input')+'[placeholder]').not('.placeholder').bind({'focus.placeholder':b,'blur.placeholder':e}).data('placeholder-enabled',true).trigger('blur.placeholder');return l};j.input=a;j.textarea=d;k={get:function(m){var l=$(m);return l.data('placeholder-enabled')&&l.hasClass('placeholder')?'':m.value},set:function(m,n){var l=$(m);if(!l.data('placeholder-enabled')){return m.value=n}if(n==''){m.value=n;if(m!=h.activeElement){e.call(m)}}else{if(l.hasClass('placeholder')){b.call(m,true,n)||(m.value=n)}else{m.value=n}}return l}};a||(c.input=k);d||(c.textarea=k);$(function(){$(h).delegate('form','submit.placeholder',function(){var l=$('.placeholder',this).each(b);setTimeout(function(){l.each(e)},10)})});$(f).bind('beforeunload.placeholder',function(){$('.placeholder').each(function(){this.value=''})})}function g(m){var l={},n=/^jQuery\d+$/;$.each(m.attributes,function(p,o){if(o.specified&&!n.test(o.name)){l[o.name]=o.value}});return l}function b(m,n){var l=this,o=$(l);if(l.value==o.attr('placeholder')&&o.hasClass('placeholder')){if(o.data('placeholder-password')){o=o.hide().next().show().attr('id',o.removeAttr('id').data('placeholder-id'));if(m===true){return o[0].value=n}o.focus()}else{l.value='';o.removeClass('placeholder');l==h.activeElement&&l.select()}}}function e(){var q,l=this,p=$(l),m=p,o=this.id;if(l.value==''){if(l.type=='password'){if(!p.data('placeholder-textinput')){try{q=p.clone().attr({type:'text'})}catch(n){q=$('<input>').attr($.extend(g(this),{type:'text'}))}q.removeAttr('name').data({'placeholder-password':true,'placeholder-id':o}).bind('focus.placeholder',b);p.data({'placeholder-textinput':q,'placeholder-id':o}).before(q)}p=p.removeAttr('id').hide().prev().attr('id',o).show()}p.addClass('placeholder');p[0].value=p.attr('placeholder')}else{p.removeClass('placeholder')}}}(this,document,jQuery));// ;(function($, window, document, undefined) {

//     'use strict';

    function openSelect(selectElement) {

        // $('body').addClass('disable-transformations');

        window.setTimeout(function() {

            if (document.createEvent) {

                var event = document.createEvent("MouseEvents");
                event.initMouseEvent("mousedown", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                selectElement.dispatchEvent(event);

            } else if (element.fireEvent) {

                selectElement.fireEvent("onmousedown");

            } else if (typeof node.onclick == 'function') {

                node.onclick();
            }

            // window.setTimeout(function() {
            //     $('body').removeClass('disable-transformations');
            // }, 0);
            scrollToElementTop();

        }, 0);

    }

    var dropDownLastPositionTop = 0;
    function scrollToElementTop() {
        window.setTimeout(function() {
            if ($(window).scrollTop() <= 5) {
                $(window).scrollTop(dropDownLastPositionTop);
            } else {
                scrollToElementTop();
            }
        }, 5);
    }

    function initCustomDropDownSelectDelegate() {
        var $dropDowns = $('select').not('.b-standard-module-wrapper select');
        var $m13StateDropDown = $('.m-13-dealer-search-form-state select').eq(0);

        $.merge($dropDowns, $m13StateDropDown);

        var userAgent = navigator.userAgent.toLowerCase();

        /*if (/android/i.test(userAgent)) {

            $dropDowns.before('<div class="gui-drop-down-click-handler" style="position: absolute; top: 0px; left: 0; right: 0; bottom: 0; z-index: 100;"></div>');
            // $dropDowns.parent().find('svg').each(function(i, e) {
            //     var newDiv = $('<div/>');
            //     newDiv.addClass($(e).attr('class'));
            //     $(e).parent().append(newDiv);
            //     $(e).remove();
            // });

            $('.gui-drop-down-click-handler').each(function(index, element) {
                var $element = $(element);

                $element.on('click', function(event) {

                        var $select = $element.parent().find('select');
                        if (!$select.prop('disabled')) {
                            dropDownLastPositionTop = $select.offset().top - 10;
                            openSelect($select.get(0));
                        }

                    return false;
                });
            });
        }*/
        // else if (/Phone/i.test(userAgent) || /Pad/i.test(userAgent) || /Pod/i.test(userAgent)) {


        //     $('.gui-drop-down-label svg').each(function(index, elem) {

        //         var self = this;

        //        $(this).on('click', function() {
        //             alert('click');
        //             $(self).parent().find('select')trigger('click');
        //             return false;
        //         });
        //     });
        // }

        //  ALT: Wie konnte das funktionieren? self ist undefiniert!
        //
        //                 // If iPad or iPhone
        //                 // http://stackoverflow.com/questions/9522518/safari-mobile-pointer-events-css-does-not-work-for-svg-content
        //                 $('.gui-drop-down-label svg').each(function(index, elem) {
        // ///*
        //                     $(this).on('click', function() {

        //                         $(self).parent().trigger('click');
        //                         return false;
        //                     });
        // //*/
        //                 });
                   // }

    }


$(document).ready(function ()
{
    // [SK] Dropdowns nur initialisieren, wenn kein DyLo Formular auf der Seite ist.
    // In diesem Fall wird die Initialisierung innerhalb der vendor/noxum/scripts/dylo/custom.js vorgenommen.

    if ($("#formdyloeventreceiver").length == 0) {
        initCustomDropDownSelect();
    }
});

function initCustomDropDownSelect() {

    var $dropDowns = $('select').not('.b-standard-content-wrapper select');
    var $extendedDropDowns = $('.b-standard-content-wrapper[data-legacy-class="content CONTENTsearch"] select');
    var $m13StateDropDown = $('.m-13-dealer-search-form-state select').eq(0);

    $.merge($extendedDropDowns, $m13StateDropDown);
    $.merge($dropDowns, $extendedDropDowns);

    //[BL] 12.05.2017 added Class 'no-mobile-restriction' / to initialize on mobile too if class set
    //[BL] 27.11.2017 commented out by Sascha K. and Benjamin L.
    // if (!Modernizr.touch || $dropDowns.hasClass('no-mobile-restriction'))
    // {


        if ($.fn.select2)
        {

            $('#categories').hide();
            $dropDowns.each(function (i, elem)
            {
                $(elem).select2({
                    containerCssClass: 'gui-select2-container',
                    dropdownCssClass: 'gui-select2-dropDown',
                    minimumResultsForSearch: -1,  // hide the search field
                    width: "100%",
                    placeholder: $(this).find(':selected').text(),
                    formatSelection: function (data, container, escapeMarkup)
                    {
                        if (!!data)
                        {
                            if (typeof data.id != "undefined")
                            {
                                $(data.element[0]).parent().find('option').removeClass("selected");
                                $(data.element[0]).addClass("selected");
                            }

                            return data ? escapeMarkup(data.text) : undefined;
                        }
                    }
                });
		// UTM Tracking 
                if((location.search.indexOf('utm') >-1) && (location.search.indexOf('?') > -1) && (location.search.indexOf('campaign') > -1)) {
	                $(elem).on("select2-selecting", function(e) { 
	                  if(e.val.indexOf('/') > -1) {
                      var _newlocation =  (e.val + "&" + location.search.split('?')[1]);
                      if(_newlocation.indexOf("aspx&") > -1) {
                        _newlocation = _newlocation.replace("aspx&", "aspx?");
                       }
                       if(_newlocation.indexOf("/&") > -1) {
                        _newlocation = _newlocation.replace("/&", "/?");
                       }
                       
	                    location = _newlocation;
	                    e.preventDefault();
	                  }
	                });
                };
                if (typeof $(elem).data('placeholder') == 'undefined' && $(elem).find(':selected').length == 1)
                {
                    $(elem).select2('val', $(elem).find(':selected').attr('value'));
                }
            });
        }

    // } else
    // {
    /*
     if((location.search.indexOf('utm') >-1) && (location.search.indexOf('?') > -1) && (location.search.indexOf('campaign') > -1)) {
     $('select').on('change', function (e) {
     $('.m-15-country-selector select:eq(1) option').each(function (i, e) {
     if($(e).val().indexOf('utm') < 0) {
     var _value = $(e).val() + "&" + window.location.search.split('?')[1];
     $(e).val(_value);
     }
     });
     })

     }


     else { */
    // initCustomDropDownSelectDelegate();
    //}
    // }
}

// })(jQuery, this, this.document);
/*
 Porsche Resize Handler
 Autor: Tillmann David@UDG
 Created on 15.09.2016
 */


function WHandler(ms) {
    var resizeArray = [], resizeTimer;

    WHandler.prototype.addResizeFunction = function(func) {
        resizeArray.push(func);
    };

    // handle Event
    window.onresize = function(e) {

        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
            for(var i=0;i<resizeArray.length;i++){
                resizeArray[i](e);
            }
        }, ms);
    };

}

var windowHandler = new WHandler(200);
(function ($, window, document, undefined) {
    'use strict';

    //$(document).ready(function () {
    //});

})(jQuery, this, this.document);

//------------------------------------------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------------------------------------------
function ScaleHandler(options)
{
    var self = this,
        defaultOptions = {};

    this.settings = {};
    this.eventNamespace = 'plugin_scaleHandler';

    _init();

    function _init()
    {
        //self.settings = $.extend(true, {}, defaultOptions, options || {});
        ;
    }


    ////////////////////////////////////////////////////////
    //
    // replaceSource()
    // desc: replaces the current image scoure with the new scaled image source
    // p1: $imgP = jQuery image Object needed to scale
    // p2: cmsSource = cms source max res url
    // p3: scaleParam = scale parameter for cmsSource
    // p4: targetAttr = target attribute to set the new image source
    // p5: onLoadedCallback = callback on image load, use false to disable Page refresh
    //
    this.replaceSource = function ($imgP, cmsSource, scaleParam, targetAttr, onLoadedCallback) {

        var _self = this;

        if ((typeof ($imgP) == 'undefined') || ($imgP.length === 0) || ($imgP.hasClass("not-change")))
        {
            return;
        }
        if (targetAttr === undefined)
        {
            targetAttr = 'src';
        }
        var currentSource = '';
        if ($imgP.attr('src'))
        {
            currentSource = $imgP.attr('src');
        }

        var replace = false;

        // always replace initial gif placeholder
        if ((currentSource.indexOf('data:image/gif;base64') === 0) || (currentSource === ''))
        {
            replace = true;
            currentSource = cmsSource;
        }

        var scaledSource = self.getScaledImageUrl(currentSource, scaleParam);

        // >> replace src if new scaled image source
        //    is different from current image source
        if (replace || (currentSource != scaledSource))
        {

            // Check if page controller refresh is wanted
            if (typeof onLoadedCallback !== 'function')
            {
                if (window.pageController)
                {
                    onLoadedCallback = function () {
                        window.pageController.refresh.call(window.pageController);
                    };
                } else
                {
                    onLoadedCallback = false;
                }
            }

            // set on load event listener
            if (onLoadedCallback !== false)
            {
                $imgP.one('load', onLoadedCallback);
            }

            $imgP.attr(targetAttr, scaledSource);
        }
    };

    ////////////////////////////////////////////////////////
    //
    // getScaleParameter()
    // desc: get scale factor
    // p1: $imgP = jQuery image Object needed to scale
    // p2: $dataElemP = jQuery Element containing the data-atributes needed for scaling (data-width, data-size)
    //     (optional)
    //
    // returns: <string>, scale pareameter for CMS
    //
    this.getScaleParameter = function ($imgP, $dataElemP) {

        if ((typeof ($imgP) == 'undefined') || ($imgP.length === 0))
        {
            return;
        }
        var $img = $imgP;
        var $dataElem = $imgP;

        if (typeof ($dataElemP) !== 'undefined')
        {
            $dataElem = $dataElemP;
        }


        // scale param for cms, default A = 100% scaling
        var scaleStep = 'A';

        // actual width of image in browser
        var iCurrentWidth = $img.width();

        // check for absolute positioned
        if (iCurrentWidth == 0)
        {
            if (typeof ($dataElemP) !== 'undefined')
            {
                iCurrentWidth = $dataElem.width();
            }
            else
            {
                iCurrentWidth = $img.parent().width();
            }
        }

        // width of underlying source image in cms
        var iSourceWidth = $dataElem.attr('data-width');

        // workaround: if data-width ist empty, assume wallpaper width
        if (iSourceWidth === '')
        {
            iSourceWidth = 3277;
        }


        // max width an image can have
        var maxContentWidth = $('html').hasClass('lt-ie9') ? 1450 : 1920;

        // get screen (device) width, capped at maxContentWidth
        var screenWidth = (window.screen.width > maxContentWidth) ? maxContentWidth : window.screen.width;

        // get current browser window width, capped at maxContentWidth
        var windowWidth = ($(window).width() > maxContentWidth) ? maxContentWidth : $(window).width();

        // determine if browser window is full width (via ratio of screen to window)
        var screenRatio = Math.round((screenWidth / windowWidth) * 1000) / 1000;
        screenRatio = ((screenRatio - 1) < 0.1) ? 1 : screenRatio;

        // determine max image width image width:
        //  >> calculate image width assuming browser window is fullscreen
        //  >> always round up so that image is never scaled up by the browser
        var iMaxWidth = Math.ceil(iCurrentWidth * screenRatio);

        // determine ratio of max image width vs source width of image in %
        var ratio = Math.round((iMaxWidth / iSourceWidth) * 100, 0);

        // modified ratio according to defined scale steps in %, default 100%
        var ratioMod = 100;

        // check if image may be scaled to calculated max width
        // >> underlaying source is larger than determiend max width
        if (iSourceWidth > iMaxWidth)
        {

            // special scaling factor for 1024 full width banner
            if (ratio <= 64 && ratio > 60)
            {
                ratioMod = 64;
            }
            else
            {
                // round down to closest 5% value
                ratioMod = ratio - (ratio % 5);
            }
            // images must not be scaled up:
            //   >> if new image width is smaller than width of image container, the image would be scaeld up (and thus blurry):
            //       -> increase scaling ratio by one step
            if (((ratioMod / 100) * iSourceWidth) <= iMaxWidth)
            {
                ratioMod = (ratioMod === 64 ? 65 : (ratioMod + 5))
            }

            scaleStep = self.getScaleStep(ratioMod);
        }

        // skip parameter for 100%
        if (scaleStep === 'A')
        {
            scaleStep = '';
        }

        return scaleStep;
    }

    // returns CMS scaling parameter for given image scaling ratio
    this.getScaleStep = function (ratioToScaleTo) {

        // special scaling factor for 1024 full width banner
        if (ratioToScaleTo === 64)
        {
            return 'Z';
        }
        else
        {
            // round down to closest 5% value
            ratioToScaleTo = ratioToScaleTo - (ratioToScaleTo % 5);
        }

        // A = 100%, B = 95%, ...
        return String.fromCharCode("A".charCodeAt() + 20 - (ratioToScaleTo / 5));
    };

    ////////////////////////////////////////////////////////
    //
    // getScaledImageUrl()
    // desc: adds scaling parameter to source url
    // p1: url = source url
    // p2: scaleParameter = parameter value for scaling
    //
    // returns: <string>, scale pareameter for CMS
    //
    this.getScaledImageUrl = function (url, scaleParameter) {

        if (typeof (url) === 'undefined' || url === '')
        {
            return '';
        }

        var resultUrl = url;

        //if (scaleParameter !== '') {
        var arrImagePath = resultUrl.split('/');
        var imageIDWithParams = arrImagePath[arrImagePath.length - 2].split(';');
        var scaleUrlParam = (scaleParameter != '') ? 's' + scaleParameter : scaleParameter;

        if (imageIDWithParams.length === 1)
        {
            // id without params
            imageIDWithParams[0] += ';' + scaleUrlParam;
            arrImagePath[arrImagePath.length - 2] = imageIDWithParams.join(';');
            resultUrl = arrImagePath.join('/');
        }
        else if (imageIDWithParams.length === 2)
        {
            // id with size
            imageIDWithParams[1] = scaleUrlParam;
            arrImagePath[arrImagePath.length - 2] = imageIDWithParams.join(';');
            resultUrl = arrImagePath.join('/');
        }
        else if (imageIDWithParams.length === 4)
        {
            // with wallpaper w/h
            imageIDWithParams[3] += ';' + scaleUrlParam;
            arrImagePath[arrImagePath.length - 2] = imageIDWithParams.join(';');
            resultUrl = arrImagePath.join('/');
        }
        //}

        return resultUrl;
    };

}
!function ($, window, document, undefined)
{

    "use strict";

    // region Private Plugin Variables
    // -----------------------------------------------------------------------------------------------------------------
    var eventNamespacePrefix = '.bpg-image';

    // -----------------------------------------------------------------------------------------------------------------
    // end region

    // region Class Definition
    // -----------------------------------------------------------------------------------------------------------------

    var BPGImage = function ($element, options)
    {
        this.initialize.call(this, $element, options);
    };

    // -----------------------------------------------------------------------------------------------------------------
    // end region

    // region Public API
    // -----------------------------------------------------------------------------------------------------------------

    BPGImage.prototype = {};

    BPGImage.prototype.$el = undefined;
    BPGImage.prototype.$canvas = undefined;

    BPGImage.prototype.options = {};
    BPGImage.prototype.defaults = {
        src: undefined,
        fallback: undefined,
        width: 600,
        height: 300,
        loop: true,
        frameDuration: 0,
        yoyo: false,
        autoPlay: true,
        debug: false,
        loadingClass: 'bpg-frame-player-loading',
        activeClass: 'bpg-frame-player-active',
        workerUrl: undefined,
        onFrameUpdate: function () { ; },
        onComplete: function () { ; },
        onLoaded: function () { ; }
    };

    BPGImage.prototype.uid = 1;
    BPGImage.prototype.playing = false;
    BPGImage.prototype.frames = undefined;
    BPGImage.prototype.frameIndex = 0;
    BPGImage.prototype.nextFrame = 1;

    BPGImage.prototype.initialize = function ($element, options)
    {
        this.$el = $element;
        this.$fallbackImage = this.$el.find('img');

        this.options = $.extend(this.options, this.defaults, options);
        this.uid = BPGImage.prototype.uid++;
        this.options.workerId = 'BPGFramePlayer_' + this.uid;
        //this.options.fallback = this.$fallbackImage.attr('src');

        this.createCanvas();
        this.load();

        //if (this.$fallbackImage.get(0).complete)
        //{
        //    this.imageReady();
        //}
        //else
        //{
        //    this.$fallbackImage.one("load", $.proxy(this.imageReady, this));
        //}

    };

    //BPGImage.prototype.imageReady = function ()
    //{
    //    var refImage;

    //    refImage = new Image();
    //    refImage.src = this.options.fallback;

    //    this.options.width = refImage.width;
    //    this.options.height = refImage.height;

    //    this.createCanvas();
    //    this.load();
    //};

    BPGImage.prototype.createCanvas = function ()
    {
        this.canvas = document.createElement('canvas');


        this.canvas.width = this.options.width;
        this.canvas.height = this.options.height;

        this.$el.append(this.canvas);
        this.canvasContext = this.canvas.getContext('2d');
    };

    BPGImage.prototype.load = function ()
    {
        var request = new XMLHttpRequest();

        this.$el.addClass(this.options.loadingClass);

        request.open('get', this.options.srcBpg, true);
        request.responseType = 'arraybuffer';
        request.onload = $.proxy(
            function ()
            {
                this.setupWorker(request.response);
            },
            this
        );
        request.send();
    };

    BPGImage.prototype.setupWorker = function (bpgData)
    {
        if (typeof this.options.workerUrl === 'string')
        {

            this.worker = new Worker(this.options.workerUrl);

            this.worker.addEventListener('message', $.proxy(function (evt)
            {

                if (evt.data.meta == this.options.workerId)
                {
                    if (evt.data.type === 'log')
                    {
                        this.options.debug && console.log('Decoding BPG: ' + evt.data.message);
                    }

                    if (evt.data.type === 'res')
                    {
                        this.worker.terminate();

                        this.options.debug && console.log('Decoded BPG: ' + this.options.src + ' with ' + this.options.workerId);

                        this.onLoaded(evt.data);
                    }
                }

            }, this));

            this.worker.postMessage({type: 'image', img: bpgData, meta: this.options.workerId});
        }
        else
        {
            this.options.debug && console.log('MISSING BPG WORKER URL');
        }
    };

    BPGImage.prototype.onLoaded = function (bpgDecodedData)
    {
        this.frames = bpgDecodedData.frames;
        this.$el.removeClass(this.options.loadingClass);

        // start sequence based on duration between first and second frame
        setTimeout(
            $.proxy(
                function ()
                {
                    window.requestAnimationFrame($.proxy(this.renderFrame, this));
                },
                this
            ),
            this.options.frameDuration > 0 ? this.options.frameDuration : this.frames[0].duration
        );

        // render first frame
        this.playing = this.options.autoPlay;
        this.draw(0);
        this.options.onLoaded(this.options.src, this.frames, this.options.workerId);
    };

    BPGImage.prototype.renderFrame = function ()
    {
        var complete = false;

        if (this.playing)
        {
            this.frameIndex += this.nextFrame;

            // at end?
            if (this.frameIndex >= this.frames.length)
            {
                switch (true)
                {
                    case this.options.yoyo:
                        this.nextFrame = -1;
                        this.frameIndex -= 2;
                        break;
                    case this.options.loop:
                        this.frameIndex = 0;
                        break;
                    default:
                        this.frameIndex = this.frames.length - 1;
                        complete = true;
                        break;
                }
            }
            // at start?
            if (this.frameIndex <= -1)
            {
                switch (true)
                {
                    case this.options.yoyo && this.options.loop:
                        this.nextFrame = 1;
                        this.frameIndex += 2;
                        break;
                    default:
                        this.frameIndex = 0;
                        complete = true;
                        break;
                }
            }

            this.draw(this.frameIndex);

            if (complete)
            {
                this.pause();
                this.options.onComplete(this.frameIndex);
            }
        }

        setTimeout(
            $.proxy(
                function ()
                {
                    window.requestAnimationFrame($.proxy(this.renderFrame, this));
                },
                this
            ),
            this.options.frameDuration > 0 ? this.options.frameDuration : this.frames[this.frameIndex].duration
        );
    };

    BPGImage.prototype.draw = function (frame)
    {
        var imageDataData,
            imageData = this.frames[frame].img,
            firefoxWorkaround = false;

        this.options.onFrameUpdate(frame, this.frames.length - 1);

        // Firefox Workaround
        try
        {
            firefoxWorkaround = !this.frames[frame].img.height
        } catch (ex)
        {
            firefoxWorkaround = true
        }

        if (firefoxWorkaround) // Firefox Bug
        {
            imageDataData = imageData;
            imageData = this.canvasContext.createImageData(this.options.width, this.options.height);
            imageData.data.set(imageDataData);
        }

        this.canvasContext.putImageData(imageData, 0, 0);

        this.$fallbackImage.remove();
        this.$el.addClass(this.options.activeClass);
    };

    BPGImage.prototype.goToFrame = function (frame)
    {
        this.frameIndex = calculateInRangeValue(frame, 0, this.frames.length - 1);
        this.draw(this.frameIndex);
    };

    BPGImage.prototype.play = function ()
    {
        return this.playing = true;
    };

    BPGImage.prototype.pause = function ()
    {
        return this.playing = false;
    };

    // -----------------------------------------------------------------------------------------------------------------
    // end region

    // region Private API
    // -----------------------------------------------------------------------------------------------------------------

    function noop()
    {
        // noop fallback
    }

    function calculateInRangeValue(n, min, max)
    {
        return ( n < min ) ? min : ( n > max ) ? max : n;
    }

    function readBPGDataOptions($element)
    {
        return $element.data();
    }

    // -----------------------------------------------------------------------------------------------------------------
    // end region

    // region jQuery Plugin Definition
    // -----------------------------------------------------------------------------------------------------------------
    $.fn.bpgImage = function (options)
    {
        var doBPG = false;

        switch (true)
        {
            // Basics
            case Modernizr.webworkers:
            case Modernizr.canvas:
                doBPG = true;
                break;

            // Default
            default:
                doBPG = false;
                break;
        }

        if (doBPG)
        {
            // Render all BPGs
            return this.each(function ()
            {

                var $this = $(this),
                    data = $this.data('bpgimage'),
                    settings;

                if (!data)
                {
                    settings = $.extend(
                        {},
                        typeof GLOBAL_CONFIG.bpgImage == 'object' ? GLOBAL_CONFIG.bpgImage : {}, // READ GLOBAL_CONFIG.bpgImage.workerUrl
                        typeof options == 'object' ? options : {},
                        readBPGDataOptions($this)
                    );

                    $this.data('bpgimage', (data = new BPGImage($this, settings)));
                }

            });
        }

        // NO BPG Support, leave Fallback
        return false;

    };
    // -----------------------------------------------------------------------------------------------------------------
    // end region


}(jQuery, this, this.document);/*
 Porsche Load Handler
 Autor: Tillmann David@UDG
 Created on 15.09.2016
 */

var loadHandler;
function LoadHandler(debug) {
    var _self = this,dColor = "00c320";

    LoadHandler.prototype.bind = function (el) {
      $(document).on('click', el, function () {
        var $el = $(this);
        var targets = $el.attr("data-dynmod").split(";");
        var splitDynEl;

        $.each(targets, function (i, dynEl) {
          splitDynEl = dynEl.split(":");
          if (splitDynEl[0] == "http" || splitDynEl[0] == "https") {
            splitDynEl.shift();
          }

          _self.loadModule(splitDynEl[0], splitDynEl, $el.attr("href"));
        });

        return false;
      });

      if (debug) {
        console.log("%c LoadHandler Binding erfolgreich", 'color: #' + dColor);
      }
    };
    LoadHandler.prototype.loadModule = function (_url, sectionArr, replaceUrl, newPageTitle) {
        $.ajax({
            url: _url,
            dataType: 'html',
            headers: {
                'xmloutput': 'allowed'
            }
        }).done(function (respondHTML) {

            var $requestedModules;

            debug && console.log("%c Dynamic Moduls loaded: " + this.url, 'color: #' + dColor);

            // Remove url from section id array
            sectionArr.shift();

            // Set History if defined
            if ($(respondHTML).attr("data-history-title") !== undefined)
            {
                _self.doHistoryReplace(replaceUrl, $(respondHTML).attr("data-history-title"));
            }

            // Parse requested modules
            $requestedModules = $(respondHTML).wrap("<div>").parent();

            var $tagginglist = $requestedModules.find('tagginglist');

            //console.log($tagginglist);

            // triggert den json Request auf die Tagging Daten, 
            // die in das fuel-economy Modul im Footer eingefügt werden müssen
            if ($tagginglist.length > 0) {
              $(document).trigger('fuel-economy.update', { moduleData: $tagginglist.attr('list') });
            }

            $.each(sectionArr, function (id, sectionName) {

                var $anchor,
                    $oldModules,
                    $newModules;

                debug && console.log("%c Replace Modulsection: " + sectionName, 'color: #' + dColor);

                // Setup
                $anchor = $("<div data-dynmod-section='" + sectionName + "' class='load-handler-anchor'/>");
                $oldModules = $("div[data-dynmod-section='" + sectionName + "']");
                $newModules = $requestedModules.find("div[data-dynmod-section='" + sectionName + "']");

                // Set reference anchor at first module appearance
                debug && console.log("%c Add anchor for section: " + sectionName, 'color: #' + dColor);
                $oldModules.first().before($anchor);

                // Remove old modules
                debug && console.log("%c remove " + $oldModules.length + " modules", 'color: #' + dColor);
                $oldModules.remove();

                // go through the markup of the newly loaded content and search for the div with the correct dynmod-section name
                $newModules.each(function (i, el) {

                    var $newModule,
                        readyEventName,
                        readyEvent;

                    // Setup
                    $newModule = $(el);
                    readyEventName = $newModule.attr("data-dynmod-event");
                    debug && console.log("%c - insert module: " + $newModule.attr("class"), 'color: #' + dColor);

                    // Mark module as replaced
                    $newModule.attr('data-dynmod-reloaded', 'true');

                    // Insert a html copy of the new module before the anchor
                    $anchor.before($newModule.wrap("<div>").parent().html());

                    // Does module have a ready event to trigger?
                    if (readyEventName)
                    {
                        // Init modules ready event
                        readyEvent = document.createEvent('Event');
                        readyEvent.initEvent(readyEventName + '_loaded', true, false);

                        // trigger modulesready event
                        document.dispatchEvent(readyEvent);
                        debug && console.log("%c - ready event dispatched: " + readyEventName + "_loaded", 'color: #' + dColor);
                    }

                });

                // Remove Anchor
                $anchor.remove();
                debug && console.log("%c ", 'color: #' + dColor);

            });

            // Trigger global ready events
            if(typeof(newPageTitle !== 'undefiend') && newPageTitle !== '') {
              $(document).trigger('m172_changePageTitle', {pageTitle: newPageTitle});
            }
            $(document).trigger('m172_rebuildModule');

            $(document).trigger('m72_rebuildModule');
            $(document).trigger('dynmod_loaded');
            $(document).trigger('fuel-economy.reinit'); // initialisiert alle Tooltips in den Modulen, die ausgetauscht wurden

      });
    };
    LoadHandler.prototype.doHistoryReplace = function(address, title){
        $('title').text(title);
        history.replaceState(null, null , address);
        if (debug) {
          console.log("%c History replaced: " + address, 'color: #' + dColor);
          console.log("%c Title replaced: " + title, 'color: #' + dColor);
        }
    };
    // execute this without clicking the element, only by passing this function with the data dynmod attr
    LoadHandler.prototype.executeLoading = function (dynmod, replaceUrl, newPageTitle) {
      var targets = dynmod.split(";");
      var splitDynEl;
  
      $.each(targets, function(i, dynEl){
        splitDynEl = dynEl.split(":");
        if(splitDynEl[0] == "http" || splitDynEl[0] == "https") {
          splitDynEl.shift();
        }
          
        _self.loadModule(splitDynEl[0], splitDynEl, replaceUrl, newPageTitle);
      });
  
      return false;
    }
}

$(function ($, window, document, undefined) {
    'use strict';

    $(document).ready(function () {
        loadHandler = new LoadHandler(false);
        loadHandler.bind("a[data-dynmod]");
    })
});/*
 Porsche History Push
 Autor: Tillmann David@UDG
 Created on 15.09.2016
 */

var historyHandler;
function HistoryHandler(debug) {
    HistoryHandler.prototype.bind = function(el) {
        var $el = document.querySelectorAll(el),
            _self = this;

        if (debug) {
          console.log("%c HistoryHandler initialisiert. " + $el.length + " Links gefunden", 'color: #0045c3');
        }

        for(var i=0;i<$el.length;i++){
            $el[i].addEventListener('click', function(e) {
                _self.setHistory(this.getAttribute('href'),this.getAttribute('data-history-title'));
            }, false);
        }
    };

    HistoryHandler.prototype.setHistory = function(address,title){

        var titleEl = document.querySelectorAll('title')[0];
        titleEl.innerHTML = title;
        history.replaceState(null, null , address);
        if (debug) {
          console.log("%c History geändert: " + address, 'color: #0045c3');
        }
    };

    if (debug) {
      window.addEventListener('popstate', function (e) {
        console.log("%c Popstate erkannt: " + JSON.stringify(e.state), 'color: #0045c3');
      });
    }
}

$(function ($, window, document, undefined) {
    'use strict';

    $(document).ready(function () {
        historyHandler = new HistoryHandler(false);
        historyHandler.bind("a[data-history-title]");
    })
});var vjsSliderPrototypeUpdate = vjs.Slider.prototype.update;
var vjsSliderPrototypeCalculateDistance = vjs.Slider.prototype.calculateDistance;

vjs.Slider.prototype.update = function(){

    if (!this.options_.vertical) {
        vjsSliderPrototypeUpdate.call(this);
        return;
    }

    // In VolumeBar init we have a setTimeout for update that pops and update to the end of the
    // execution stack. The player is destroyed before then update will cause an error
    if (!this.el_) return;

    // If scrubbing, we could use a cached value to make the handle keep up with the user's mouse.
    // On HTML5 browsers scrubbing is really smooth, but some flash players are slow, so we might want to utilize this later.
    // var progress =  (this.player_.scrubbing) ? this.player_.getCache().currentTime / this.player_.duration() : this.player_.currentTime() / this.player_.duration();

    var barProgress,
        progress = this.getPercent(),
        handle = this.handle,
        bar = this.bar;

    // Protect against no duration and other division issues
    if (isNaN(progress)) { progress = 0; }

    barProgress = progress;

    // If there is a handle, we need to account for the handle in our calculation for progress bar
    // so that it doesn't fall short of or extend past the handle.
    if (handle) {

        var box                = this.el_,
            boxHeight          = box.offsetHeight,
            handleHeight       = handle.el().offsetHeight,
            handlePercent      = (handleHeight) ? handleHeight / boxHeight : 0,
            boxAdjustedPercent = 1 - handlePercent,
            adjustedProgress   = progress * boxAdjustedPercent;



        // The bar does reach the left side, so we need to account for this in the bar's width
        barProgress = adjustedProgress + (handlePercent / 2);

        handle.el().style.top = 100 - (handlePercent * 100) - vjs.round(adjustedProgress * 100, 2) + '%';
    }

    bar.el().style.height = vjs.round(barProgress * 100, 2) + '%';
};

vjs.Slider.prototype.calculateDistance = function(event){

    if (!this.options_.vertical) {
        return vjsSliderPrototypeCalculateDistance.call(this, event);
    }

    var el, box, boxX, boxY, boxW, boxH, handle, pageX, pageY;

    el = this.el_;
    box = vjs.findPosition(el);
    boxW = boxH = el.offsetHeight;
    handle = this.handle;

    boxY = box.top;

    if (event.changedTouches) {
       pageY = event.changedTouches[0].pageY;
    } else {
        pageY = event.pageY;
    }

    if (handle) {
        var handleH = handle.el().offsetHeight;
        // Adjusted X and Width, so handle doesn't go outside the bar
        boxY = boxY + (handleH / 2);
        boxH = boxH - handleH;
    }

    // Percent that the click is through the adjusted area
    return Math.max(0, Math.min(1, ((boxY - pageY) + boxH) / boxH));
};

vjs.Player.prototype.listenForUserActivity = function(){
  var onMouseActivity, onMouseDown, mouseInProgress, onMouseUp,
      activityCheck, inactivityTimeout;

  var isHoveringControl = false;

  onMouseActivity = this.reportUserActivity;

  onMouseDown = function() {
    onMouseActivity();
    // For as long as the they are touching the device or have their mouse down,
    // we consider them active even if they're not moving their finger or mouse.
    // So we want to continue to update that they are active
    clearInterval(mouseInProgress);
    // Setting userActivity=true now and setting the interval to the same time
    // as the activityCheck interval (250) should ensure we never miss the
    // next activityCheck
    mouseInProgress = setInterval(vjs.bind(this, onMouseActivity), 250);
  };

  onMouseUp = function(event) {
    onMouseActivity();
    // Stop the interval that maintains activity if the mouse/touch is down
    clearInterval(mouseInProgress);
  };

  onMouseOver = function(event) {
      isHoveringControl = !!$(event.toElement).closest('.vjs-control').length;
  };

  // Any mouse movement will be considered user activity
  this.on('mousedown', onMouseDown);
  this.on('mousemove', onMouseActivity);
  this.on('mouseover', onMouseOver);
  this.on('mouseup', onMouseUp);

  // Listen for keyboard navigation
  // Shouldn't need to use inProgress interval because of key repeat
  this.on('keydown', onMouseActivity);
  this.on('keyup', onMouseActivity);

  // Consider any touch events that bubble up to be activity
  // Certain touches on the tech will be blocked from bubbling because they
  // toggle controls
  this.on('touchstart', onMouseDown);
  this.on('touchmove', onMouseActivity);
  this.on('touchend', onMouseUp);
  this.on('touchcancel', onMouseUp);

  // Run an interval every 250 milliseconds instead of stuffing everything into
  // the mousemove/touchmove function itself, to prevent performance degradation.
  // `this.reportUserActivity` simply sets this.userActivity_ to true, which
  // then gets picked up by this loop
  // http://ejohn.org/blog/learning-from-twitter/
  activityCheck = setInterval(vjs.bind(this, function() {
    // Check to see if mouse/touch activity has happened
    if (!isHoveringControl) {
      if (this.userActivity_) {
        // Reset the activity tracker
        this.userActivity_ = false;

        // If the user state was inactive, set the state to active
        this.userActive(true);

        // Clear any existing inactivity timeout to start the timer over
        clearTimeout(inactivityTimeout);

        // In X seconds, if no more activity has occurred the user will be
        // considered inactive
        inactivityTimeout = setTimeout(vjs.bind(this, function() {
          // Protect against the case where the inactivityTimeout can trigger just
          // before the next user activity is picked up by the activityCheck loop
          // causing a flicker
          if (!this.userActivity_) {
            this.userActive(false);
          }
        }), 2000);
      }
    }
  }), 250);

  // Clean up the intervals when we kill the player
  this.on('dispose', function(){
    clearInterval(activityCheck);
    clearTimeout(inactivityTimeout);
  });
};// Resolution switching support for videojs
//
// In this plugin I'm really going out of my way to *not* override the
// core videojs namespace and to *not* change the core API.  As a
// result this plugin is not as efficient as it might be.  It
// initializes itself *for each player* as scoped variables inside the
// plugin closure and grafts itself on to *the instance on which it was
// called* rather than on the videojs player prototype.  I don't expect
// this to be a big deal for anybody.
videojs.plugin('resolutions', function(options) {
  var player = this;

  // 'reduce' utility method
  // @param {Array} array to iterate over
  // @param {Function} iterator function for collector
  // @param {Array|Object|Number|String} initial collector
  // @return collector
  vjs.reduce = function(arr, fn, init, n) {
    if (!arr || arr.length === 0) { return; }
    for (var i=0,j=arr.length; i<j; i++) {
      init = fn.call(arr, init, arr[i], i);
    }
    return init;
  };

  this.resolutions_ = {
    options_: {},

    // takes an existing stream and stops the download entirely
    // without killing the player or disposing of the tech
    stopStream: function(){
      switch(player.techName){
      case "Html5":
        break;
      case "Flash":
        player.tech.el_.vjs_stop();
        break;
      }

      // this may cause flash or the native player to emit errors but
      // they are harmless
      player.src("");
    },

    // it is necessary to remove the sources from the DOM after
    // parsing them because otherwise the native player may be
    // inclined to stream both sources
    removeSources: function(el){
      var videoEl = player.el_.getElementsByTagName("video")[0];

      if (player.techName !== "Html5" || !videoEl) return;

      var srcs = videoEl.getElementsByTagName("source");
      for(var i=0;i<srcs.length;i++){
        videoEl.removeChild(srcs[i]);
      }
    },

    // buckets all parsed sources by their type ("video/mp4", for example)
    // @param {Array} array of sources:
    // [
    //   {
    //     "data-res": "HD",
    //     "type": "video/mp4",
    //     "src": "http://some_video_url_hd"
    //   },
    //   {
    //     "data-default": "true",
    //     "data-res": "SD",
    //     "type": "video/mp4",
    //     "src": "http://some_video_url_sd"
    //   },
    //   {
    //     "data-default": "true",
    //     "data-res": "SD",
    //     "type": "video/ogv",
    //     "src": "http://some_video_url_sd"
    //   }
    // ]
    // @return sources grouped by type:
    // {
    //   "video/mp4": [
    //       {
    //           "data-res": "HD",
    //           "type": "video/mp4",
    //           "src": "http://some_video_url_hd"
    //       },
    //       {
    //           "data-default": "true",
    //           "data-res": "SD",
    //           "type": "video/mp4",
    //           "src": "http://some_video_url_sd"
    //       }
    //   ]
    //   "video/ogv": [
    //       {
    //           "data-res": "SD",
    //           "type": "video/ogv",
    //           "src": "http://some_video_url_sd"
    //       }
    //   ]
    // }
    bucketByTypes: function(sources){
      return vjs.reduce(sources, function(init, val, i){
        (init[val.type] = init[val.type] || []).push(val);
        return init;
      }, {}, player);
    },

    // takes parsed sources and selects the most appropriate source
    // taking into account resolution, technology support, and the
    // user's previous selections.  also indexes the sources
    // @param {Array} array of sources:
    // [
    //   {
    //     "data-res": "HD",
    //     "type": "video/mp4",
    //     "src": "http://some_video_url_hd"
    //   },
    //   {
    //     "data-default": "true",
    //     "data-res": "SD",
    //     "type": "video/mp4",
    //     "src": "http://some_video_url_sd"
    //   },
    //   {
    //     "data-default": "true",
    //     "data-res": "SD",
    //     "type": "video/ogv",
    //     "src": "http://some_video_url_sd"
    //   }
    // ]
    // @return {Object} single source:
    // {
    //  "data-res": "HD",
    //  "type": "video/mp4",
    //  "src": "http://some_video_url_jd",
    //  "index": 0
    // }
    selectSource: function(sources){
      this.removeSources();

      var sourcesByType = this.bucketByTypes(sources);
      var typeAndTech   = this.selectTypeAndTech(sources);

      if (!typeAndTech) return false;

      // even though we choose the best resolution for the user here, we
      // should remember the resolutions so that we can potentially
      // change resolution later
      this.options_['sourceResolutions'] = sourcesByType[typeAndTech.type];

      return this.selectResolution(this.options_['sourceResolutions']);
    },

    // takes parsed sources and returns the most appropriate
    // technology and video type
    // @param {Array} array of sources:
    // [
    //   {
    //     "data-res": "HD",
    //     "type": "video/mp4",
    //     "src": "http://some_video_url_hd"
    //   },
    //   {
    //     "data-default": "true",
    //     "data-res": "SD",
    //     "type": "video/mp4",
    //     "src": "http://some_video_url_sd"
    //   },
    //   {
    //     "data-default": "true",
    //     "data-res": "SD",
    //     "type": "video/ogv",
    //     "src": "http://some_video_url_sd"
    //   }
    // ]
    // @return {Object} type/tech:
    // {
    //  "type": "video/ogv",
    //  "tech": "Html5"
    // }
    selectTypeAndTech: function(sources) {
      var techName;
      var tech;

      for (var i=0,j=player.options_['techOrder'];i<j.length;i++) {
        techName = videojs.capitalize(j[i]);
        tech     = window['videojs'][techName];

        // Check if the browser supports this technology
        if (tech.isSupported()) {
          // Loop through each source object
          for (var a=0,b=sources;a<b.length;a++) {
            var source = b[a];
            // Check if source can be played with this technology
            if (tech['canPlaySource'](source)) {
              return { type: source.type, tech: techName };
            }
          }
        }
      }
    },

    // takes an array of sources of homogeneous type (ie. a complete
    // "bucket" from the output of bucketByTypes) and returns the best
    // source, taking into account the user's previous preferences
    // stored in local storage
    // @param {Array} homogeneous sources:
    // [
    //   {
    //       "data-res": "HD",
    //       "type": "video/mp4",
    //       "src": "http://some_video_url_hd"
    //   },
    //   {
    //       "data-default": "true",
    //       "data-res": "SD",
    //       "type": "video/mp4",
    //       "src": "http://some_video_url_sd"
    //   }
    // ]
    // @return {Object} singular best source:
    // {
    //     "data-default": "true",
    //     "data-res": "SD",
    //     "type": "video/mp4",
    //     "src": "http://some_video_url_sd"
    //     "index": 1
    // }
    selectResolution: function(typeSources) {
      var defaultRes = 0;
      var supportsLocalStorage = !!window.localStorage;

      // check to see if any sources are marked as default
      videojs.obj.each(typeSources, function(i, s){
        // add the index here so we can reference it later
        s.index = parseInt(i, 10);

        if (s['data-default']) defaultRes = s.index;
      }, player);

      // if the user has previously selected a preference, check if
      // that preference is available. if not, use the source marked
      // default
      var preferredRes = defaultRes;

      // trying to follow the videojs code conventions of if statements
      if (supportsLocalStorage){
        var storedRes = parseInt(window.localStorage.getItem('videojs_preferred_res'), 10);

        if (!isNaN(storedRes))
          preferredRes = storedRes;
      }

      var maxRes    = (typeSources.length - 1);
      var actualRes = preferredRes > maxRes ? maxRes : preferredRes;

      return typeSources[actualRes];
    }
  };

  // convenience method
  // @return {String} cached resolution label:
  // "SD"
  player.resolution = function(){
      return this.cache_.src.res;
  };

    // takes a source and switches the player's stream to it on the fly
    // @param {Object} singular source:
    // {
    //     "data-default": "true",
    //    "data-res": "SD",
    //     "type": "video/mp4",
    //     "src": "http://some_video_url_sd"
    // }
    player.changeResolution = function(new_source, skipAutoplay){
        // has the exact same source been chosen?
        if (this.cache_.src === new_source.src){
            this.trigger('resolutionchange');
            return this; // basically a no-op
        }

        // remember our position in the current stream
        var curTime = this.currentTime();

        this.pause();

        // attempts to stop the download of the existing video
        this.resolutions_.stopStream();

        // HTML5 tends to not recover from reloading the tech but it can
        // generally handle changing src.  Flash generally cannot handle
        // changing src but can reload its tech.
        if (this.techName === "Html5"){
            this.src(new_source.src);
        } else {
            this.loadTech(this.techName, {src: new_source.src});
        }

        // when the technology is re-started, kick off the new stream
        this.ready(function() {
            this.one('loadeddata', vjs.bind(this, function() {
                this.currentTime(curTime);
            }));

            this.trigger('resolutionchange');
            this.load();

            if (!skipAutoplay) {
                this.play();
            }

            // remember this selection
            vjs.setLocalStorage('videojs_preferred_res', parseInt(new_source.index, 10));
        });
    };

  /* Resolution Menu Items
  ================================================================================ */
    var ResolutionMenuItem = videojs.MenuItem.extend({
        init: function(player, options){
            // Modify options for parent MenuItem class's init.
            options['label'] = options.label;
            videojs.MenuItem.call(this, player, options);

            this.source = options.source;
            this.resolution = options.source['data-res'];

            this.player_.one('loadstart', vjs.bind(this, this.update));
            this.player_.on('resolutionchange', vjs.bind(this, this.update));
        }
    });

    var ResolutionMenuTitleItem = videojs.MenuItem.extend({
        init: function(player, options){
            // Modify options for parent MenuItem class's init.
            options['label'] = options.label;
            videojs.MenuItem.call(this, player, options);
        }
    });

  ResolutionMenuItem.prototype.onClick = function(){
    videojs.MenuItem.prototype.onClick.call(this);
    this.player_.changeResolution(this.source);
  };

  ResolutionMenuItem.prototype.update = function(){
    var player = this.player_;
    if ((player.cache_['src'] === this.source.src)) {
      this.selected(true);
    } else {
      this.selected(false);
    }
  };

  /* Resolutions Button
  ================================================================================ */
  var ResolutionButton = videojs.MenuButton.extend({
    init: function(player, options) {
      videojs.MenuButton.call(this, player, options);

      if (this.items.length <= 1) {
        this.hide();
      }
    }
  });

  ResolutionButton.prototype.sourceResolutions_;

  ResolutionButton.prototype.sourceResolutions = function() {
    return this.sourceResolutions_;
  };

  ResolutionButton.prototype.onClick = function(e){
    // Only proceed if the target of the click was a DIV (just the button and its inner div, not the menu)
    // This prevents the menu from opening and closing when one of the menu items is clicked.
    if (e.target.className.match(/vjs-control-content/)) {

      // Toggle the 'touched' class
      this[this.el_.className.match(/touched/) ? "removeClass" : "addClass"]("touched");
    } else {

      // Remove the 'touched' class from all control bar buttons with menus to hide any already visible...
      var buttons = document.getElementsByClassName('vjs-menu-button');
      for(var i=0;i<buttons.length;i++){
        videojs.removeClass(buttons[i], 'touched');
      }

      this.removeClass('touched');
    }
  };

  ResolutionButton.prototype.createItems = function(){
    var resolutions = this.sourceResolutions_ = this.player_.resolutions_.options_['sourceResolutions'];
    var items = [];
    var listItems = $('#' + player.id_).parent().find('.ce-video-resolutions > ul > li');

    if (!resolutions || !resolutions.length) {
        return items;
    }

    items.push(new ResolutionMenuTitleItem(this.player_, {
        label : listItems.first().html()
        })
    );

    for (var i = 0; i < resolutions.length; i++) {
        var displayItem = listItems.find('.ce-video-menu-resolution-' + this.sourceResolutions_[i]['data-res']);

        if (!!displayItem.length) {
            items.push(new ResolutionMenuItem(this.player_, {
                'source': this.sourceResolutions_[i],
                label : displayItem.parent().html()
            }));
        }
    }
    return items;
  };

  /**
   * @constructor
   */
  ResolutionsButton = ResolutionButton.extend({
    /** @constructor */
    init: function(player, options, ready){
      ResolutionButton.call(this, player, options, ready);
      this.el_.setAttribute('aria-label','Resolutions Menu');
      this.el_.setAttribute('id',"vjs-resolutions-button");
    }
  });

  ResolutionsButton.prototype.kind_ = 'resolutions';
  ResolutionsButton.prototype.buttonText = 'Resolutions';
  ResolutionsButton.prototype.className = 'vjs-resolutions-button';

  // Add Button to controlBar
  videojs.obj.merge(player.controlBar.options_['children'], {
    'resolutionsButton': {}
  });

  // let's get the party started!
  // we have to grab the parsed sources and select the source with our
  // resolution-aware source selector
  var source = player.resolutions_.selectSource(player.options_['sources']);

    // when the player is ready, add the resolution button to the control bar
    player.ready(function(){
        player.changeResolution(source, true);
        var button = new ResolutionsButton(player);
        player.controlBar.addChild(button);

        var controlBar = $('#' + this.id_ + ' .vjs-control-bar');
        var selectLabel = $('<label class="ce-video-drop-down-label vjs-resolutions-menu-select vjs-control"/>');
        var selectMenu = $('<select class="b-standard-content-wrapper"/>');

        selectLabel.appendTo(controlBar);
        selectMenu.appendTo(selectLabel);

        var self = this;
        selectMenu.on('change', function () {
            self.changeResolution.call(self, self.options().sources[$(this).prop('selectedIndex')]);
            $(this).blur();
        });

        selectLabel.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="ce-video-drop-down-bg"></svg>');
        selectLabel.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="ce-video-drop-down-quality-icon"></svg>');

        var shareMenu = $('#' + this.id_ + ' .vjs-resolutions-button .vjs-menu');
        var menuItems = shareMenu.find('.vjs-menu-content').children('li');

        var selectedIndex = -1;
        for (var i=0; i < this.options().sources.length; i++) {
            if (this.options().sources[i].src == source.src) {
                selectedIndex = i;
                break;
            }
        }

        menuItems.each(function(index, element) {
            var currentElement = $(element).find('a');
            if (!!currentElement.length) {
                selectMenu.append('<option>' + currentElement.text() + '</option>');
            }
        });

        selectMenu.prop('selectedIndex', selectedIndex);
    });
});videojs.plugin('socialMedia', function(options) {
    var player = this;

    this.socialMedia_ = {
        options_: {}
    };

    /* Social Media Menu Item
    ================================================================================ */
    var SocialMediaMenuItem = videojs.MenuItem.extend({
        init: function(player, options){
            // Modify options for parent MenuItem class's init.
            options['label'] = options.label;
            videojs.MenuItem.call(this, player, options);
        }
    });

    SocialMediaMenuItem.prototype.onClick = function(){
        videojs.MenuItem.prototype.onClick.call(this);

        var urlToOpen = $(this.el_).find('a').attr('href');

        if (urlToOpen) {
            player.pause();

            window.open(urlToOpen);
        }
    };

    var SocialMediaButton = videojs.MenuButton.extend({
        init: function(player, options) {
            videojs.MenuButton.call(this, player, options);

            if (this.items.length <= 1) {
               this.hide();
            }
        }
    });

    SocialMediaButton.prototype.onClick = function(e){
        // Only proceed if the target of the click was a DIV (just the button and its inner div, not the menu)
        // This prevents the menu from opening and closing when one of the menu items is clicked.
        if (e.target.className.match(/vjs-control-content/)) {

            // Toggle the 'touched' class
            this[this.el_.className.match(/touched/) ? "removeClass" : "addClass"]("touched");
        } else {

            // Remove the 'touched' class from all control bar buttons with menus to hide any already visible...
            var buttons = document.getElementsByClassName('vjs-menu-button');

            for(var i=0;i<buttons.length;i++){
                videojs.removeClass(buttons[i], 'touched');
            }

            this.removeClass('touched');
        }
    };

    SocialMediaButton.prototype.createItems = function(){

        var items       = $('#' + player.id_).parent().find('.ce-video-share > ul > li');
        var resultItems = [];

        items.each(function(index, element) {
            resultItems.push(new SocialMediaMenuItem(player, {
                'label': $(element).html()
            }));
        });

        return resultItems;
    };

    /**
    * @constructor
    */
    ShareMenuButton = SocialMediaButton.extend({
        /** @constructor */
        init: function(player, options, ready){
            SocialMediaButton.call(this, player, options, ready);
            this.el_.setAttribute('aria-label','Social Media Menu');
            this.el_.setAttribute('id', "vjs-share-menu-button");
        }
    });

    ShareMenuButton.prototype.kind_ = 'Share';
    ShareMenuButton.prototype.buttonText = 'Social Media';
    ShareMenuButton.prototype.className = 'vjs-share-menu-button';

    /**
    * @constructor
    */
    ShareMenuSelectButton = SocialMediaButton.extend({
        /** @constructor */
        init: function(player, options, ready){
            SocialMediaButton.call(this, player, options, ready);
            this.el_.setAttribute('aria-label','Social Media Menu');
            this.el_.setAttribute('id', "vjs-share-menu-button");
        }
    });

    ShareMenuSelectButton.prototype.kind_ = 'Share';
    ShareMenuSelectButton.prototype.buttonText = 'Social Media';
    ShareMenuSelectButton.prototype.className = 'vjs-share-menu-button';

    // Add Button to controlBar
    videojs.obj.merge(player.controlBar.options_['children'], {
        'shareMenuButton': {}
    });

    // when the player is ready, add the resolution button to the control bar
    player.ready(function(){
        var button = new ShareMenuButton(player);
        player.controlBar.addChild(button);

        var controlBar = $('#' + this.id_ + ' .vjs-control-bar');
        var selectLabel = $('<label class="ce-video-drop-down-label vjs-share-menu-select vjs-control"/>');
        var selectMenu = $('<select class="b-standard-content-wrapper"/>');

        selectLabel.appendTo(controlBar);
        selectMenu.appendTo(selectLabel);

        selectMenu.on('change', function () {
            var urlToOpen = $(this).val();

            if (urlToOpen) {
                player.pause();

                window.setTimeout(function () {
                    /* First we try to open the shareURL in a new window */
                    var cannotOpenWindow = window.open(urlToOpen, '_blank');
                    /* If this is not possible we open it in the same window */
                    if (cannotOpenWindow == undefined) {
                        window.location = urlToOpen;
                    }
                }, 0);
            }
        });

        selectLabel.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="ce-video-drop-down-bg"></svg>');
        selectLabel.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="ce-video-drop-down-share-icon"></svg>');

        var shareMenu = $('#' + this.id_ + ' .vjs-share-menu-button .vjs-menu');
        var menuItems = shareMenu.find('.vjs-menu-content').children('li');

        if (!!menuItems.length) {
            menuItems.each(function(index, element) {
                var currentElement = $(element).find('a');
                if (!!currentElement.length) {
                    var currentOption = selectMenu.append('<option value="' + currentElement.attr('href') + '">' + currentElement.text() + '</option>');
                } else {
                    var menuTitle = $(element).find('span');
                    if (!!menuTitle.length) {
                        var titleOption = $('<option>' + menuTitle.text() + '</option>');
                        titleOption.prop('selected', true);
                        titleOption.prop('disabled', true);
                        selectMenu.prepend(titleOption);
                    }
                }
            });

        } else {
            selectLabel.hide();
        }
    });
});videojs.plugin('downloadMenuButton', function(options) {
    var player = this;

    this.socialMedia_ = {
        options_: {}
    };

    /* Social Media Menu Item
    ================================================================================ */
    var DownloadMenuItem = videojs.MenuItem.extend({
        init: function(player, options){
            // Modify options for parent MenuItem class's init.
            options['label'] = options.label;
            videojs.MenuItem.call(this, player, options);
        }
    });

    DownloadMenuItem.prototype.onClick = function(){
        videojs.MenuItem.prototype.onClick.call(this);

        var urlToOpen = $(this.el_).find('a').attr('href');

        if (urlToOpen) {
            player.pause();

            window.open(urlToOpen);
        }
    };

    var DownloadButton = videojs.MenuButton.extend({
        init: function(player, options) {
            videojs.MenuButton.call(this, player, options);

            if (this.items.length <= 1) {
               this.hide();
            }
        }
    });

    DownloadButton.prototype.onClick = function(e){
        // Only proceed if the target of the click was a DIV (just the button and its inner div, not the menu)
        // This prevents the menu from opening and closing when one of the menu items is clicked.
        if (e.target.className.match(/vjs-control-content/)) {

            // Toggle the 'touched' class
            this[this.el_.className.match(/touched/) ? "removeClass" : "addClass"]("touched");
        } else {

            // Remove the 'touched' class from all control bar buttons with menus to hide any already visible...
            var buttons = document.getElementsByClassName('vjs-menu-button');

            for(var i=0;i<buttons.length;i++){
                videojs.removeClass(buttons[i], 'touched');
            }

            this.removeClass('touched');
        }
    };

    DownloadButton.prototype.createItems = function(){

        var items       = $('#' + player.id_).parent().find('.ce-video-downloads > ul > li');
        var resultItems = [];

        items.each(function(index, element) {
            resultItems.push(new DownloadMenuItem(player, {
                'label': $(element).html()
            }));
        });

        return resultItems;
    };

    /**
    * @constructor
    */
    DownloadMenuButton = DownloadButton.extend({
        /** @constructor */
        init: function(player, options, ready){
            DownloadButton.call(this, player, options, ready);
            this.el_.setAttribute('aria-label','Download Menu');
            this.el_.setAttribute('id', "vjs-download-menu-button");
        }
    });

    DownloadMenuButton.prototype.kind_ = 'Downloads';
    DownloadMenuButton.prototype.buttonText = 'Downloads';
    DownloadMenuButton.prototype.className = 'vjs-downloads-menu-button';

    // Add Button to controlBar
    videojs.obj.merge(player.controlBar.options_['children'], {
        'downloadMenuButton': {}
    });

    // when the player is ready, add the resolution button to the control bar
    player.ready(function(){
        var button = new DownloadMenuButton(player);
        player.controlBar.addChild(button);

        var controlBar = $('#' + this.id_ + ' .vjs-control-bar');
        var selectLabel = $('<label class="ce-video-drop-down-label vjs-downloads-menu-select vjs-control"/>');
        var selectMenu = $('<select class="b-standard-content-wrapper"/>');

        selectLabel.appendTo(controlBar);
        selectMenu.appendTo(selectLabel);

        selectMenu.on('change', function () {
            var urlToOpen = $(this).val();

            if (urlToOpen) {
                player.pause();

                window.setTimeout(function () {
                    /* First we try to open the shareURL in a new window */
                    var cannotOpenWindow = window.open(urlToOpen, '_blank');
                    /* If this is not possible we open it in the same window */
                    if (cannotOpenWindow == undefined) {
                        window.location = urlToOpen;
                    }
                }, 0);
            }
        });

        selectLabel.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="ce-video-drop-down-bg"></svg>');
        selectLabel.append('<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="ce-video-drop-down-download-icon"></svg>');

        var downloadsMenu = $('#' + this.id_ + ' .vjs-downloads-menu-button .vjs-menu');
        var menuItems = downloadsMenu.find('.vjs-menu-content').children('li');

        menuItems.each(function(index, element) {
            var currentElement = $(element).find('a');
            if (!!currentElement.length) {
                var currentOption = selectMenu.append('<option value="' + currentElement.attr('href') + '">' + currentElement.text() + '</option>');
            } else {
                var menuTitle = $(element).find('span');
                if (!!menuTitle.length) {
                    var titleOption = $('<option>' + menuTitle.text() + '</option>');
                    titleOption.prop('selected', true);
                    titleOption.prop('disabled', true);
                    selectMenu.prepend(titleOption);
                }
            }
        });
    });
});;
(function ($, window, document, undefined) {
    'use strict';

    var namespace = 'MapBase.BaiduMaps';

    _.namespace(namespace, window,
        function (options) {

            var apiUrl,

                map,

                markerData,
                markers = [],

                settings = {
                    api: {
                        url: '{{protocol}}://{{host}}/getscript?v=2.0&ak=B74b66c16dece8bc726d25dcf77b6399&services=&key=20141104111948',
                        host: 'api.map.baidu.com',
                        protocol: 'https'
                    }
                };

            this.initialize = function (options) {

                settings = $.extend(true, {}, settings, options);

                apiUrl = getApiUrl();

                $.getScript(apiUrl)
                    .done(
                        _.bind(function (script, textStatus) {
                            onMapApiLoaded();
                        }, this)
                    )
                    .fail(
                        _.bind(function (jqxhr, settings, exception) {
                            alert('BAIDU MAPS FAILED TO LOAD');
                        }, this)
                    );

            };

            function getApiUrl()
            {
                var urlTemplate = _.template(
                    settings.api.url,
                    {
                        interpolate: /\{\{(.+?)\}\}/g
                    }
                );
                return urlTemplate(settings.api);
            }

            // READY EVENT HANDLERS
            //------------------------------------------------------

            function onMapApiLoaded()
            {

                map = new BMap.Map(settings.el);
                map.addEventListener("tilesloaded", onMapReady);

                setCenterAndZoom(settings.center.lng, settings.center.lat, settings.zoom);

                map.addControl(new BMap.MapTypeControl());
                map.addControl(new BMap.NavigationControl());


            }

            function onMapReady()
            {

                if (typeof _.getValueByName('onReady', settings) === 'function')
                {
                    settings.onReady();
                }

            }

            /*
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             *
             *     METHODS
             *
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             */

            // HELPERS
            //------------------------------------------------------
            function setCenterAndZoom()
            {
                map.centerAndZoom(new BMap.Point(settings.center.lng, settings.center.lat), settings.zoom);
            }

            function panTo(markerIndex, markerContent)
            {
                var marker = markers[markerIndex - 1];
                openInfoWindow(marker, markerContent);
            }

            // MARKERS
            //------------------------------------------------------
            function _onMarkerClicked(marker, result, id)
            {

                if (typeof _.getValueByName('onMarkerClicked', settings) === 'function')
                {
                    settings.onMarkerClicked(marker, result, id);
                }
            }

            function deleteMarkers()
            {
                map.clearOverlays();
                markers = [];
                markerData = undefined;
            }

            function addMarkers(data)
            {
                deleteMarkers();

                if (data.length)
                {
                    markerData = data;
                    _.each(markerData, _.bind(function (result, idx) {
                        var point,
                            icon,
                            marker;

                        point = new BMap.Point(result.lng, result.lat);

                        icon = new BMap.Icon(settings.icons.red, new BMap.Size(settings.icons.size.width, settings.icons.size.height), {
                            offset: new BMap.Size(10, 25),
                            imageOffset: new BMap.Size(0, 0 - idx * settings.icons.size.height)
                        });

                        marker = new BMap.Marker(point, {
                            icon: icon
                        });

                        markers.push(marker);

                        marker.addEventListener("click", _.bind(function () {
                            _onMarkerClicked(marker, result, idx);
                        }, this));

                        map.addOverlay(marker);
                    }, this));
                }
            }

            // INFO WINDOW
            //------------------------------------------------------
            function openInfoWindow(marker, result)
            {
                var view,
                    content,
                    InfoWindowView,
                    infoWindow;

                InfoWindowView = _.getValueByName('InfoWindowView', settings);

                if (InfoWindowView)
                {

                    // Generate Info Window
                    view = new InfoWindowView({model: result});
                    content = view.render().el;

                    // Open Info Window
                    infoWindow = new BMap.InfoWindow(content);
                    marker.openInfoWindow(infoWindow);

                } else
                {

                    console.warn('MISSING InfoWindowView');

                }
            }

            // GEOCODE
            //------------------------------------------------------
            function geocodeAddress(data)
            {
                var dfd,
                    location,
                    url,
                    searchValue,
                    status = 'FAIL';

                dfd = $.Deferred();

                searchValue = encodeURIComponent(data.address);
                url = "http://api.map.baidu.com/geocoder/v2/?ak=B74b66c16dece8bc726d25dcf77b6399&output=json&address=" + searchValue + "&city=" + searchValue;

                $.ajax({
                    dataType: 'jsonp',
                    contentType: "application/json;charset=utf-8",
                    type: 'GET',
                    url: url,
                    success: function (resp) {
                        if (!!data.msg)
                        {
                            location = undefined;
                        }
                        else
                        {
                            status = 'OK';
                            location = {
                                lat: resp.result.location.lat,
                                lng: resp.result.location.lng
                            };
                        }
                        dfd.resolve(status, {
                            searchValue: data.address,
                            location: location
                        });
                    }
                });

                return dfd.promise();
            }

            /*
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             *
             *     BIND MAP OBJECT FUNCTIONS
             *
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             */

            this.geocodeAddress = geocodeAddress;
            // this.reverseGeocode = function () {};
            this.addMarkers = addMarkers;
            this.panTo = panTo;
            // this.highlightMarker = function () {};
            // this.unhighlightAllMarkers = function () {};
            // this.triggerResize = function () {};

            /*
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             *
             *     FINALY INIT AND RETURN
             *
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             */
            this.initialize(options);

            return this;

        }
    );

})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
    'use strict';

    var namespace = 'MapBase.GoogleMaps';

    _.namespace(namespace, window,
        function (options) {

            var apiUrl,

                $el,

                map,
                geocoder,
                infoWindow,

                mapBounds,
                mapOffset = {x: 0, y: 0},
                TILE_SIZE = {height: 256, width: 256},
                BUFFER = 20,

                iconSize,

                markerData,
                markers = [],

                settings = {
                    api: {
                        url: '{{protocol}}://{{host}}/maps/api/js?sensor={{sensor}}&language={{language}}&client={{client}}&channel={{channel}}',
                        host: 'maps.googleapis.com',
                        protocol: 'https',
                        sensor: true,
                        language: _.getValueByName('preferredLanguage', GLOBAL_CONFIG, 'en-US'),
                        client: 'gme-volkswagenag3',
                        channel: 'PORSCHE-WW-UNKNOWN'
                    }
                };

            this.initialize = function (options) {

                settings = $.extend(true, {}, settings, options);

                $el = $(settings.el);

                apiUrl = getApiUrl();

                $.getScript(apiUrl)
                    .done(
                        _.bind(function (script, textStatus) {
                            onMapApiLoaded();
                        }, this)
                    )
                    .fail(
                        _.bind(function (jqxhr, settings, exception) {
                            alert('GOOGLE MAPS FAILED TO LOAD');
                        }, this)
                    );

            };

            function getApiUrl()
            {
                var urlTemplate = _.template(
                    settings.api.url,
                    {
                        interpolate: /\{\{(.+?)\}\}/g
                    }
                );
                return urlTemplate(settings.api);
            }

            // READY EVENT HANDLERS
            //------------------------------------------------------

            function onMapApiLoaded()
            {

                geocoder = new google.maps.Geocoder();
                infoWindow = new google.maps.InfoWindow();
                map = new google.maps.Map(settings.el, _getMapOptions());

                google.maps.event.addListenerOnce(map, 'idle', onMapReady);

                iconSize = new google.maps.Size(settings.icons.size.width, settings.icons.size.height);

            }

            function onMapReady()
            {

                if (typeof _.getValueByName('onReady', settings) === 'function')
                {
                    settings.onReady();
                }

            }

            /*
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             *
             *     METHODS
             *
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             */

            // HELPERS
            //------------------------------------------------------

            function _getMapOptions()
            {
                var mapOptions;

                mapOptions = {
                    zoom: settings.zoom,
                    center: new google.maps.LatLng(settings.center.lat, settings.center.lng),
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    disableDefaultUI: true,
                    scrollwheel: false,
                    zoomControl: true,
                    draggable: true,
                    zoomControlOptions: {
                        style: google.maps.ZoomControlStyle.DEFAULT,
                        position: google.maps.ControlPosition.TOP_RIGHT
                    }
                };

                if (settings.hasTouch)
                {
                    mapOptions.draggable = false;
                    mapOptions.panControl = false;
                    mapOptions.disableDoubleClickZoom = true;
                }

                return mapOptions;
            }


            function _showSingleMarker()
            {
                var width = $(window).outerWidth();

                return width < settings.singleMarkerBreakpoint
            }


            function _offsetLatLng(latlng, offsetX, offsetY, currZoomLevel)
            {
                var newLatLng,
                    newPoint,
                    pixelOffset,
                    point,
                    scale;

                offsetX = offsetX || 0;
                offsetY = offsetY || 0;

                currZoomLevel = currZoomLevel || map.getZoom();
                scale = Math.pow(2, currZoomLevel);
                point = map.getProjection().fromLatLngToPoint(latlng);

                pixelOffset = new google.maps.Point((offsetX / scale), (offsetY / scale));

                newPoint = new google.maps.Point(
                    point.x - pixelOffset.x,
                    point.y + pixelOffset.y
                );

                newLatLng = map.getProjection().fromPointToLatLng(newPoint);

                return newLatLng;
            }

            function panTo(markerIndex, markerContent)
            {
                var marker,
                    position,
                    newposition;

                marker = markers[markerIndex - 1];
                position = marker.getPosition();
                newposition = _offsetLatLng(position, mapOffset.x / 2, mapOffset.y / 2, 14);

                marker.setMap(map);
                marker.setIcon(marker.iconMarkerRed); // TODO: check
                map.setZoom(14);

                map.panTo(newposition);
            }

            function triggerResize()
            {
                google.maps.event.trigger(map, "resize");
            }

            function _getBoundsZoomLevel(bounds, dimensions)
            {
                var ne,
                    sw,
                    latFraction,
                    lngDiff,
                    lngFraction,
                    latZoom,
                    lngZoom,

                    latRadian = function (lat) {
                        var sin = Math.sin(lat * Math.PI / 180);
                        var radX2 = Math.log((1 + sin) / (1 - sin)) / 2;
                        return Math.max(Math.min(radX2, Math.PI), -Math.PI) / 2;
                    },
                    zoom = function (mapPx, worldPx, fraction) {
                        return Math.floor(Math.log(mapPx / worldPx / fraction) / Math.LN2);
                    };

                ne = bounds.getNorthEast();
                sw = bounds.getSouthWest();

                latFraction = (latRadian(ne.lat()) - latRadian(sw.lat())) / Math.PI;
                lngDiff = ne.lng() - sw.lng();
                lngFraction = ((lngDiff < 0) ? (lngDiff + 360) : lngDiff) / 360;

                latZoom = zoom(dimensions.height, TILE_SIZE.height, latFraction);
                lngZoom = zoom(dimensions.width, TILE_SIZE.width, lngFraction);

                return Math.min(latZoom, lngZoom, 15);
            }

            function setOffsetBounds(bounds, newOffset)
            {
                var dimensions,
                    zoomLevel,
                    newLatLng;

                _.extendOwn(mapOffset, newOffset);

                dimensions = {
                    width: $el.width() - mapOffset.x - BUFFER * 2,
                    height: $el.height() - mapOffset.y - BUFFER * 2
                };

                zoomLevel = _getBoundsZoomLevel(bounds, dimensions);
                newLatLng = _offsetLatLng(bounds.getSouthWest(), mapOffset.x, mapOffset.y, zoomLevel);

                bounds.extend(newLatLng);

                map.fitBounds(bounds);
            }

            function highlightMarker(markerIndex)
            {
                var showSingleMarker,
                    marker;

                showSingleMarker = _showSingleMarker();
                marker = markers[markerIndex - 1];

                if (marker)
                {
                    marker.setIcon(marker.iconMarkerRed);
                    marker.setMap(map);

                    if (showSingleMarker)
                    {
                        panTo(markerIndex);
                    }
                }
            }

            function unhighlightAllMarkers()
            {
                var showSingleMarker,
                    mapBounds;

                showSingleMarker = _showSingleMarker();
                mapBounds = new google.maps.LatLngBounds();

                _.each(markers, function (marker) {

                    marker.setIcon(marker.iconMarkerGrey);
                    mapBounds.extend(marker.position);

                    if (showSingleMarker)
                    {
                        marker.setMap(null);
                    }
                    else
                    {
                        marker.setMap(map);
                    }

                });

                if (!showSingleMarker)
                {
                    // map.fitBounds(mapBounds);
                    setOffsetBounds(mapBounds)
                }
            }

            // MARKERS
            //------------------------------------------------------

            function _getIconPath(path)
            {
                return settings.currentProtocol + '://' + settings.currentHost + path;
            }

            function _clearMarkers()
            {
                _.each(markers, function (marker) {
                    marker.setMap(null);
                });
            }

            function _onMarkerClicked(marker, result, id)
            {

                if (typeof _.getValueByName('onMarkerClicked', settings) === 'function')
                {
                    settings.onMarkerClicked(marker, result, id);
                }
            }

            function deleteMarkers()
            {
                _clearMarkers();
                markers = [];
                markerData = undefined;
            }

            function addMarkers(data, newOffset)
            {

                var showSingleMarker,
                    position;

                deleteMarkers();

                if (data.length)
                {
                    markerData = data;

                    mapBounds = new google.maps.LatLngBounds();
                    showSingleMarker = _showSingleMarker();

                    _.each(markerData, function (result, idx) {
                        var iconPoint,
                            icons = [],
                            marker;

                        position = new google.maps.LatLng(result.lat, result.lng);
                        mapBounds.extend(position);

                        iconPoint = new google.maps.Point(0, idx * settings.icons.size.height);

                        icons.push(new google.maps.MarkerImage(_getIconPath(settings.icons.grey), iconSize, iconPoint));
                        icons.push(new google.maps.MarkerImage(_getIconPath(settings.icons.red), iconSize, iconPoint));

                        marker = new google.maps.Marker({
                            position: position,
                            map: map,
                            title: result.title,
                            id: result.id,
                            idx: idx,
                            resultData: result,
                            icon: icons[0],
                            iconMarkerRed: icons[1],
                            iconMarkerGrey: icons[0],
                            cursor: (settings.hasTouch) ? 'default' : 'pointer'
                        });

                        google.maps.event.addListener(marker, 'click', function () {
                            _onMarkerClicked(marker, result, idx);
                        });


                        markers.push(marker);

                        if (showSingleMarker && idx > 0)
                        {
                            marker.setMap(null);
                        }
                    });

                    if (data.length > 1)
                    {
                        // map.fitBounds(mapBounds);
                        setOffsetBounds(mapBounds, newOffset)
                    } else
                    {
                        map.setZoom(13);
                        map.setCenter(new google.maps.LatLng(data[0].lat, data[0].lng));
                    }
                }
            }

            // INFO WINDOW
            //------------------------------------------------------

            function openInfoWindow(marker)
            {
                var result,
                    InfoWindowView,
                    view,
                    content;

                result = marker.resultData;

                InfoWindowView = _.getValueByName('InfoWindowView', settings);

                if (InfoWindowView)
                {

                    // Generate Info Window
                    view = new InfoWindowView({model: result});
                    content = view.render().el;

                    // Open Info Window
                    infoWindow.setContent(content);
                    infoWindow.open(map, marker);

                } else
                {

                    console.warn('MISSING InfoWindowView');

                }
            }

            // GEOCODE
            //------------------------------------------------------

            function geocodeAddress(data)
            {
                var dfd,
                    location,
                    dfdStatus = 'FAIL';

                dfd = $.Deferred();

                geocoder.geocode({
                    address: data.address,
                    region: data.region
                }, function (resp, status) {
                    if (!(status === 'ZERO_RESULTS' || status === 'INVALID_REQUEST'))
                    {
                        dfdStatus = 'OK';
                        location = {
                            lat: resp[0].geometry.location.lat(),
                            lng: resp[0].geometry.location.lng()
                        };
                    }
                    dfd.resolve(dfdStatus, {
                        searchValue: data.address,
                        location: location
                    });
                });

                return dfd.promise();
            }

            // REVERSE GEOCODE
            //------------------------------------------------------

            function reverseGeocode(lat, lng)
            {
                var dfd,
                    address,
                    found;

                found = false;
                dfd = $.Deferred();

                geocoder.geocode({
                    location: {lat: lat, lng: lng}
                }, function (resp, status) {
                    if (status === 'OK')
                    {
                        _.each(resp, function (item) {
                            if (!found && _.contains(item.types, 'postal_code'))
                            {
                                found = true;
                                address = item.formatted_address;
                            }
                        });
                        if (!found)
                        {
                            address = resp[0].formatted_address;
                        }
                    }
                    dfd.resolve({address: address});
                });
                return dfd.promise();
            }

            /*
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             *
             *     BIND MAP OBJECT FUNCTIONS
             *
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             */

            this.geocodeAddress = geocodeAddress;
            this.reverseGeocode = reverseGeocode;
            this.addMarkers = addMarkers;
            this.panTo = panTo;
            this.highlightMarker = highlightMarker;
            this.unhighlightAllMarkers = unhighlightAllMarkers;
            this.triggerResize = triggerResize;

            /*
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             *
             *     FINALY INIT AND RETURN
             *
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             */
            this.initialize(options);

            return this;

        }
    );

})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
    'use strict';

    var namespace = 'MapBase.Abstraction';

    _.namespace(namespace, window,
        function (options) {

            var map,

                currentPool,

                _callMapFunction,

                abstractionLayerNames = [
                    'BaiduMaps',
                    'GoogleMaps'
                ],

                DEV_MODE = _.getUrlParamByName('moduledebug') === 'true',
                DEV_OPTIONS = {
                    proxyHostname: 'www.porsche.com',
                    proxyProtocol: 'https'
                },

                settings = {

                    // el: undefined,

                    api: {
                        // url: undefined,
                        // host: undefined,
                        // protocol: undefined,
                        // sensor: undefined,
                        // language: undefined,
                        // client: undefined,
                        // channel: undefined
                    },

                    center: {
                        lat: 0.0,
                        lng: 0.0
                    },
                    zoom: 11,

                    // region: undefined,

                    onReady: undefined,

                    onMarkerClicked: undefined,
                    
                    icons: {
                        size: {
                            width: 26,
                            height: 40
                        },
                        red: '/images/icon_pin-sprite-type_code-red.png',
                        grey: '/images/icon_pin-sprite-type_code-grey.png'
                    },

                    // InfoWindowView: undefined,

                    // currentProtocol: undefined,
                    // currentHost: undefined,

                    singleMarkerBreakpoint: 650,

                    hasTouch: Modernizr['touch'] || false

                };

            this.initialize = function (options) {

                currentPool = _.getValueByName('GLOBAL_CONFIG.pool', window, 'international');

                settings.currentProtocol = getCurrentProtocol();
                settings.currentHost = getCurrentHost();

                settings = $.extend(true, {}, settings, options);

            };

            this.loadMapAPI = function (force) {

                var MapAbstractionObject;

                switch (true)
                {
                    case _.isStringNotEmpty(force) && (abstractionLayerNames.indexOf(force) >= 0):
                        MapAbstractionObject = _.getValueByName('MapBase.' + force, window);
                        break;
                    case currentPool === 'china':
                        MapAbstractionObject = _.getValueByName('MapBase.BaiduMaps', window);
                        break;
                    default:
                        MapAbstractionObject = _.getValueByName('MapBase.GoogleMaps', window);
                        break;
                }

                if (typeof MapAbstractionObject !== 'undefined')
                {
                    map = new MapAbstractionObject(settings);
                    return true;
                }

                return false;

            };

            /*
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             *
             *     HELPER
             *
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             */

            function getCurrentProtocol(ignoreDevMode)
            {
                if (ignoreDevMode !== true && DEV_MODE === true)
                {
                    return DEV_OPTIONS.proxyProtocol;
                }
                return document.location.protocol.slice(0, -1);
            }

            function getCurrentHost(ignoreDevMode)
            {
                if (ignoreDevMode !== true && DEV_MODE === true)
                {
                    return DEV_OPTIONS.proxyHostname;
                }
                return document.location.hostname;
            }

            /*
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             *
             *     BIND MAP OBJECT FUNCTIONS
             *
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             */

            _callMapFunction = function () {
                var name,
                    method,
                    methodArguments;

                name = arguments[0];

                if (_.isStringNotEmpty(name))
                {

                    method = _.getValueByName(name, map);
                    methodArguments = Array.prototype.slice.call(arguments, 1);

                    if (typeof method === 'function')
                    {
                        return method.apply(null, methodArguments);
                    }

                    console.warn(namespace + ': MISSING FUNCTIONALITY');
                }

                console.warn(namespace + ':MISSING METHOD NAME');

                return false;
            };

            this.geocodeAddress = _.bind(_callMapFunction, this, 'geocodeAddress');
            this.reverseGeocode = _.bind(_callMapFunction, this, 'reverseGeocode');
            this.addMarkers = _.bind(_callMapFunction, this, 'addMarkers');
            this.panTo = _.bind(_callMapFunction, this, 'panTo');
            this.highlightMarker = _.bind(_callMapFunction, this, 'highlightMarker');
            this.unhighlightAllMarkers = _.bind(_callMapFunction, this, 'unhighlightAllMarkers');
            this.triggerResize = _.bind(_callMapFunction, this, 'triggerResize');

            /*
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             *
             *     FINALY INIT AND RETURN
             *
             * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
             */
            this.initialize(options);

            return this;

        }
    );

})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
    'use strict';

    // DEFAULTS
    _.namespace('MapModuleBase.initialzed', window, false);

    _.namespace('MapModuleBase.EVENTS', window, {
        // SEARCH_VALUE_VALIDATED: 'MapModuleBase-SEARCH_VALUE_VALIDATED'
        resultMarkerClicked: 'MapModuleBase-resultMarkerClicked'
    });

    var EVENT = {
        resultMarkerClicked: 'MapModuleBase-resultMarkerClicked'
    };

    _.namespace('MapModuleBase.init', window, function () {

        var ModuleView,
            ModuleModel,

            ResultCollection,
            ResultModel,
            ResultView,
            ResultInfoWindowView,

            DEV_MODE = _.getUrlParamByName('moduledebug') === 'true';

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     VIEW
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ModuleView = ModuleBaseView.extend({
            events: {},

            moduleName: undefined,

            // BREAK POINT
            SingleMarkerBreakpoint: 650,

            // URL
            urlSearchValue: undefined,
            searchViaURLParamName: undefined,

            // TOUCH
            hasTouch: undefined,

            // RESULTS
            ResultView: undefined,
            resultCollection: undefined,

            // MAP
            map: undefined,

            //----------------------------------------------------------------------
            // region INITIALIZATION
            //----------------------------------------------------------------------

            initialize: function (options) {
                var modelData;

                ModuleBaseView.prototype.initialize.apply(this, arguments);

                // Initialize model with correct data
                this.modelDataName = this.$el.data('model');
                modelData = _.getValueByName(this.modelDataName, window, {});
                this.model = new (_.getValueByName('ModuleModel', options, ModuleModel))(modelData);

                // HAS TOUCH
                this.hasTouch = Modernizr['touch'] || false;

                // IMPLEMENT AFTER RENDER
                _.bindAll(this, 'render', 'afterRender');
                this.render = _.wrap(this.render, function (render) {
                    render();
                    this.afterRender();
                    return this;
                });

                this.moduleName = _.getValueByName('moduleNamePrefix', options, 'map-module-base');
                this.searchViaURLParamName = this.moduleName + '-search';

                this.ResultView = _.getValueByName('ResultView', options, ResultView);
                this.resultCollection = new (_.getValueByName('ResultCollection', options, ResultCollection))({moduleModel: this.model});

                this.render();

                return this;
            },

            // endregion

            //
            //----------------------------------------------------------------------
            // region RENDER
            //----------------------------------------------------------------------

            render: function () {

                // Blocker
                this.$blockerOverlay = this.$el.find('.' + this.moduleName + '__blocker-overlay');

                // Form
                this.$formContainer = this.$el.find('.' + this.moduleName + '__search-form-container');
                this.$searchForm = this.$el.find('.' + this.moduleName + '__search-form'); // TODO: CHANGE CSS dealer-search-form --> search-form
                this.$searchInput = this.$el.find('.' + this.moduleName + '__search-input'); // TODO: CHANGE CSS dealer-search-input --> search-input
                this.$searchBtn = this.$el.find('.' + this.moduleName + '__search-button'); // TODO: CHANGE CSS dealer-search-button --> search-button
                this.$errorMsg = this.$el.find('.' + this.moduleName + '__error-msg');

                // Map
                this.$mapContainer = this.$el.find('.' + this.moduleName + '__map-container');
                this.$mapCanvas = this.$el.find('#' + this.moduleName + '__map-canvas');

                // Result
                this.$resultContainer = this.$el.find('.' + this.moduleName + '__result-container');
                this.$resultList = this.$el.find('.' + this.moduleName + '__result-list'); // TODO: CHANGE CSS dealers-list --> result-list

                // DEFAULT RENDER
                ModuleBaseView.prototype.render.apply(this, arguments);
            },

            afterRender: function () {
                this.renderMap();
                this.setSlickSlider();
                this.setEventHandlers();
            },

            // endregion

            //
            //----------------------------------------------------------------------
            // region Map
            //----------------------------------------------------------------------

            renderMap: function () {

                var MapBaseAbstraction,
                    channelPostfix;

                MapBaseAbstraction = _.getValueByName('MapBase.Abstraction', window, false);
                channelPostfix = this.model.get('config.mapData.googleMapsChannelPostfix', undefined);

                if (MapBaseAbstraction)
                {

                    this.map = new MapBaseAbstraction({

                        el: this.$mapCanvas.get(0),

                        api: {
                            channel: _.isStringNotEmpty(channelPostfix) ? 'PORSCHE-' + channelPostfix : undefined
                        },

                        // TODO Bounds Prio C
                        center: {
                            lat: this.model.get('config.mapData.center.lat', 0),
                            lng: this.model.get('config.mapData.center.lng', 0)
                        },
                        zoom: this.model.get('config.mapData.zoom', 11),

                        region: this.model.get('config.mapData.region'),

                        singleMarkerBreakpoint: this.SingleMarkerBreakpoint,

                        onReady: _.bind(this.onMapReady, this),
                        onMarkerClicked: _.bind(this.onMapMarkerClicked, this),

                        InfoWindowView: ResultInfoWindowView

                    });

                    this.map.loadMapAPI();

                } else
                {
                    console.warn('MapBase.Abstraction IS MISSING');
                }

            },

            onMapReady: function () {
                if (this.checkUrlSearchValue())
                {
                    this.searchUrlSearchValue();
                }
                else
                {
                    this.searchCurrentLocation();
                }
            },

            onMapMarkerClicked: function (marker, result, id) {
                // OVERWRITE TODO
                //this.updateMarkers();
                this.unhighlightAllMarkers();
                this.highlightMarker(id + 1);
                this.goToSlickSlide(id);


            },

            showSingleMarker: function () {
                return $(window).outerWidth() < this.SingleMarkerBreakpoint;
            },

            // endregion

            //
            //----------------------------------------------------------------------
            // region SLICK SLIDER
            //----------------------------------------------------------------------

            setSlickSlider: function () {
                this.$resultList.slick({
                    lazyLoad: 'ondemand',
                    arrows: false,
                    adaptiveHeight: false,
                    centerMode: true,
                    centerPadding: '10px',
                    dots: true,
                    mobileFirst: true,
                    infinite: false,
                    nextArrow: '<span class="slick-next"></span>',
                    prevArrow: '<span class="slick-prev"></span>',
                    responsive: [
                        {
                            breakpoint: 1200,
                            settings: {
                                centerMode: false,
                                slidesToShow: 4,
                                slidesToScroll: 4,
                                arrows: true,
                                dots: false
                            }
                        },
                        {
                            breakpoint: 992,
                            settings: {
                                centerMode: false,
                                slidesToShow: 3,
                                slidesToScroll: 3,
                                arrows: true,
                                dots: false
                            }
                        },
                        {
                            breakpoint: this.SingleMarkerBreakpoint,
                            settings: {
                                centerMode: false,
                                slidesToShow: 2,
                                slidesToScroll: 2
                            }
                        }
                    ]
                });
            },

            afterSlickSliderInit: function (event, slick) {

                this.slickSlider = slick;
                this.$resultList.find(".slick-slide").addClass(this.moduleName + "__resultBox");
                this.$resultList.find(".slick-slide .number").each(function (index, element) {

                    $(element).text(index + 1);

                });
                this.$resultList.find(".slick-slide").each(function (index, element) {

                    $(element).attr("data-result-no", index + 1);

                });
                this.updateMarkers(slick);
            },

            removeSlickSlides: function () {
                if (this.slickSlider)
                {
                    for (var i = this.slickSlider.slideCount - 1; i >= 0; i--)
                    {
                        this.slickSlider.removeSlide(i);
                    }
                }
                this.$resultList.slick('unslick');
            },

            afterSlickSliderChanged: function (event, slick, currSlideNo) {
                this.updateMarkers();
            },

            updateMarkers: function () {

                this.unhighlightAllMarkers();

                if (this.highlightPinNo)
                {
                    this.highlightMarker(this.highlightPinNo);
                    this.highlightPinNo = false;
                }

                if (this.showSingleMarker())
                {
                    var activeSlides = this.$resultList.find('.slick-current');
                    var resultNo = activeSlides.data('result-no');
                    this.highlightMarker(resultNo, activeSlides);
                }
            },

            goToSlickSlide: function (slideNo) {
                this.highlightPinNo = slideNo + 1;
                this.$resultList.slick('slickGoTo', slideNo);
            },

            highlightMarker: function (index, slide) {
                if (!slide)
                {
                    slide = this.$resultList.find("." + this.moduleName + "__resultBox[data-result-no=" + index + "]");
                }
                slide.find('.' + this.moduleName + '__resultBox-marker .pin').addClass('red');
                this.map.highlightMarker(index);
            },

            unhighlightAllMarkers: function () {
                this.map.unhighlightAllMarkers();
                this.$resultList.find('.' + this.moduleName + '__resultBox-marker .pin').removeClass('red');
            },

            // endregion

            //
            //----------------------------------------------------------------------
            // region EVENTS
            //----------------------------------------------------------------------

            setEventHandlers: function () {

                this.$searchBtn.on('click', _.bind(this.onResultSearchBtnClick, this));
                this.$searchForm.on('submit', _.bind(this.onResultSearchFormSubmit, this));

                this.listenTo(this.resultCollection, 'add', _.debounce(this.onResultCollectionChange, 50));
                this.listenTo(this.resultCollection, 'error', this.onResultCollectionError);

                $('.slick-slider').on('click', '.slick-slide .' + this.moduleName + '--pan-map ', function (evt) {
                    //TODO look for better solution
                    if (!$(event.target).is("a > span") && !$(event.target).is("a"))
                    {
                        var resultNo,
                            $target;

                        evt.preventDefault();

                        $target = $(evt.currentTarget).parents('.' + this.moduleName + '__resultBox');
                        resultNo = $target.data('result-no');

                        this.unhighlightAllMarkers();
                        this.highlightMarker(resultNo, $target);
                    }

                }.bind(this));


                this.$resultList.on('afterChange', _.bind(this.afterSlickSliderChanged, this));
                this.$resultList.on('init', _.bind(this.afterSlickSliderInit, this));
            },

            // endregion

            //
            //----------------------------------------------------------------------
            // region FORM
            //----------------------------------------------------------------------

            onResultSearchBtnClick: function (evt) {
                evt.preventDefault();
                this.$searchForm.submit()
            },

            onResultSearchFormSubmit: function (evt) {
                var searchValue;

                evt.preventDefault();

                searchValue = this.$searchInput.val();

                if (_.getValueByName('geocodeAddress', this.map, false) && _.isStringNotEmpty(searchValue))
                {
                    this.map.geocodeAddress({
                        address: searchValue,
                        region: this.model.get('config.mapData.region')
                    }).then(
                        _.bind(this.onGeocodeAddressReady, this)
                    );
                }
            },

            onGeocodeAddressReady: function (status, result) {
                switch (status)
                {
                    case 'OK':
                        this.hideErrorMessage();
                        this.resultCollection.fetchWithGeoCoords(result.location);
                        break;
                    default:
                        this.showErrorMessage('noResult');
                        break;
                }
            },

            checkUrlSearchValue: function () {
                var urlSearchValue;

                if (_.isStringNotEmpty(this.searchViaURLParamName))
                {
                    urlSearchValue = this.getURLParameter(this.searchViaURLParamName);
                    if (_.isStringNotEmpty(urlSearchValue))
                    {
                        this.urlSearchValue = urlSearchValue;
                        return true;
                    }
                }

                return false;
            },

            searchUrlSearchValue: function () {
                if (this.urlSearchValue)
                {
                    this.$searchInput.val(this.urlSearchValue);
                    this.$searchForm.submit();
                    return true;
                }
                return false;
            },

            searchCurrentLocation: function () {
                if (navigator.geolocation)
                {
                    navigator.geolocation.getCurrentPosition(_.bind(function (data) {
                        this.resultCollection.fetchWithGeoCoords({
                            lat: _.getValueByName('coords.latitude', data, undefined),
                            lng: _.getValueByName('coords.longitude', data, undefined)
                        });
                    }, this));
                }
            },

            // endregion

            //----------------------------------------------------------------------
            // region RESULTS
            //----------------------------------------------------------------------

            onResultCollectionChange: function () {
                this.showResults();
            },

            onResultCollectionError: function () {
                this.showErrorMessage("default");
            },

            showResults: function () {

                var markerData = [],
                    resultHeight = 0;

                this.resultCollection.each(function (resultModel) {
                    markerData.push(resultModel.getMarkerData());
                });

                this.$mapContainer.removeClass('' + this.moduleName + '--expand-map');
                this.$mapContainer.css('height', '');

                this.addResults();

                if (this.resultCollection.length >= 1)
                {
                    this.$mapContainer.addClass('' + this.moduleName + '--expand-map');
                    resultHeight = this.$resultContainer.height();
                    if (_.isNumber(resultHeight))
                    {
                        this.$mapContainer.css('height', (resultHeight + this.model.get('config.mapData.minVisibleMap', 400)) + 'px');
                    } else
                    {
                        resultHeight = 0;
                    }
                }
                this.map.triggerResize();

                this.map.addMarkers(markerData, {y: resultHeight});

            },

            addResults: function () {
                var views = [],
                    i;
                this.$resultList.html('');
                this.$resultContainer.hide();
                this.removeSlickSlides();

                if (this.resultCollection.length)
                {
                    this.resultCollection.each(_.bind(function (resultModel) {

                        var view;

                        view = new this.ResultView(
                            {
                                templates: this.model.get('config.templates', {}),
                                model: resultModel,
                                moduleModel: this.model
                            }
                        );

                        view.render();

                        this.$resultList.append(view.$el);

                        views.push(view);

                    }, this));

                    this.$resultContainer.show();

                    this.setSlickSlider();

                    for(i = 0; i < views.length; i++) {
                        views[i].isAdded();
                    }
                }
            },

            // endregion

            //----------------------------------------------------------------------
            // region ERROR MESSAGE
            //----------------------------------------------------------------------

            showErrorMessage: function (name, msg2) {
                var msg;

                msg = this.model.get('texts.error.' + name, 'ERROR');

                if (DEV_MODE && msg2)
                {
                    msg += '<br>' + '<i>' + msg2 + '</i>';
                }

                this.$blockerOverlay.show();
                this.$errorMsg.html(msg).show();
                // this.$loading.hide();
            },

            hideErrorMessage: function () {
                this.$blockerOverlay.hide();
                this.$errorMsg.html('').hide();
                // this.$loading.hide();
            },

            // endregion

            //----------------------------------------------------------------------
            // region HELPER FUNCTIONS
            //----------------------------------------------------------------------

            getURLParameter: function (name) {
                return _.getUrlParamByName(name);
            },

            // endregion

            //----------------------------------------------------------------------
            // region DESTROY
            //----------------------------------------------------------------------

            destroy: function () {
                ModuleBaseView.prototype.destroy.apply(this, arguments);
            }

            // endregion

        });

        // EXTERNAL USE
        _.namespace('MapModuleBase.View', window, ModuleView);

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     MODEL
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ModuleModel = Backbone.Model.extend({

            initialize: function () {
                // var data = arguments[0];

                // Handlebars Helper
                Handlebars.registerHelper('if_eq', function (a, b, opts) {
                    if (a === b) // Or === depending on your needs
                        return opts.fn(this);
                    else
                        return opts.inverse(this);
                });

                return Backbone.Model.prototype.initialize.apply(this, arguments);
            },

            /**
             * Get a value of the model and give the possibility to use namespaces and have a optional fallback.
             *
             * @override
             *
             * @param {string} attributeName
             * @param {*} [fallback]
             * @returns {*}
             */
            get: function (attributeName, fallback) {
                return _.getValueByName(attributeName, this.attributes, fallback);
            },

            /**
             * Get the handlebars template to process
             * @param {string} name - template name
             * @param {object} [data] - addtitional data
             * @param {boolean} [templateSourceOnly=false] - give true to get the templates source markup
             * @returns {string}
             */
            getHandlebarsTemplate: function (name, data, templateSourceOnly) {
                var template,
                    hbsTemplate;

                templateSourceOnly = templateSourceOnly === true;

                template = this.get('config.templates.' + name + '.tpl', false);

                if (template)
                {
                    if (templateSourceOnly)
                    {
                        return template;
                    } else
                    {
                        hbsTemplate = Handlebars.compile(template);

                        return hbsTemplate(_.extend(this.attributes, data));
                    }
                }

                return "TEMPLATE NOT FOUND";
            }


        });

        // EXTERNAL USE
        _.namespace('MapModuleBase.Model', window, ModuleModel);

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     RESULT MODEL
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ResultModel = Backbone.Model.extend({

            /**
             * Get a value of the model and give the possibility to use namespaces and have a optional fallback.
             *
             * @override
             *
             * @param {string} attributeName
             * @param {*} [fallback]
             * @returns {*}
             */
            get: function (attributeName, fallback) {
                return _.getValueByName(attributeName, this.attributes, fallback);
            },

            getMarkerData: function () {
                // OVERWRITE
                return {
                    id: this.get('id'),
                    title: this.get('title'),
                    lat: this.get('lat'),
                    lng: this.get('lng')
                }
            },

            getResultTemplateData: function () {
                // OVERWRITE
                return this.toJSON();
            }


        });

        // EXTERNAL USE
        _.namespace('MapModuleBase.ResultModel', window, ResultModel);

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     RESULT COLLECTION
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ResultCollection = Backbone.Collection.extend({

            model: ResultModel,

            moduleModel: undefined,

            defaultParam: {
                from: undefined,
                to: undefined,
                max: undefined
            },

            proximityMax: undefined,

            initialize: function (options) {
                var tempDefaultParamValue;
                this.moduleModel = _.getValueByName('moduleModel', options);

                if (this.moduleModel)
                {
                    // FROM
                    tempDefaultParamValue = this.moduleModel.get('config.eventData.period.from');
                    this.defaultParam.from = _.isStringNotEmpty(tempDefaultParamValue) ? tempDefaultParamValue : undefined;

                    // TO
                    tempDefaultParamValue = this.moduleModel.get('config.eventData.period.to');
                    this.defaultParam.to = _.isStringNotEmpty(tempDefaultParamValue) ? tempDefaultParamValue : undefined;

                    // MAX
                    tempDefaultParamValue = _.tryParseInt(this.moduleModel.get('config.eventData.max'), -1);
                    this.defaultParam.max = tempDefaultParamValue > 0 ? tempDefaultParamValue : undefined;

                    // PROXIMITY MAX
                    tempDefaultParamValue = _.tryParseInt(this.moduleModel.get('config.eventData.proximityMax'), -1);
                    this.proximityMax = tempDefaultParamValue > 0 ? tempDefaultParamValue : this.defaultParam.max;
                }

                return Backbone.Collection.prototype.initialize.apply(this, arguments);
            },

            fetch: function (options) {
                var params = $.extend({data: this.defaultParam}, options);
                return Backbone.Collection.prototype.fetch.apply(this, [params]);
            },

            fetchWithGeoCoords: function (coords) {
                var params;

                if (_.getValueByName('lat', coords) && _.getValueByName('lng', coords))
                {
                    params = _.extend(this.defaultParam, coords);

                    if (this.proximityMax)
                    {
                        params.max = this.proximityMax;
                    }

                    this.fetch({data: params});
                }
            }

        });

        // EXTERNAL USE
        _.namespace('MapModuleBase.ResultCollection', window, ResultCollection);

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     RESULT VIEW
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ResultView = Backbone.View.extend({

            templateName: 'result',
            templateMarkup: '',
            moduleModel: undefined,

            tagName: 'div',

            initialize: function (options) {
                this.templateName = _.getValueByName('templateName', options, this.templateName);

                this.templateMarkup = _.getValueByName('templates.' + this.templateName + '.tpl', options, "");

                this.template = Handlebars.compile(
                    this.templateMarkup
                );

                this.moduleModel = _.getValueByName('moduleModel', options);

                return Backbone.View.prototype.initialize.apply(this, arguments);
            },

            render: function () {
                this.$el.html(this.template(
                        this.model.getResultTemplateData()
                ));
                return this;
            },

            isAdded: function () {
                // OVERWRITE
                // noop
            }

        });

        // EXTERNAL USE
        _.namespace('MapModuleBase.ResultView', window, ResultView);


        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     RESULT VIEW
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ResultInfoWindowView = Backbone.View.extend({
            tagName: 'div'
        });

        // EXTERNAL USE
        _.namespace('MapModuleBase.ResultInfoWindowView', window, ResultInfoWindowView);

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     INIT READY
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        window.MapModuleBase.initialzed = true;
        window.MapModuleBase.init = function () {
            console.log('MapModuleBase.init already done');
        };

    });

})(jQuery, this, this.document);
///////////////////////////////////////////
//
//    >>>    PS5 RESOURCE    <<<
//
///////////////////////////////////////////

/**
 * @fileoverview YouTube Media Controller - Wrapper for YouTube Media API
 */

/**
 * YouTube Media Controller - Wrapper for YouTube Media API
 * @param {videojs.Player|Object} player
 * @param {Object=} options
 * @param {Function=} ready
 * @constructor
 */
videojs.Youtube = videojs.MediaTechController.extend({
  init: function(player, options, ready){


    //console.log('YOUTUBE init Script');
    videojs.MediaTechController.call(this, player, options, ready);

    this.features.fullscreenResize = true;

    this.player_ = player;
    this.player_el_ = document.getElementById(this.player_.id());

    // Copy the Javascript options if they exist
    if (typeof options.source != 'undefined') {
      for (var key in options.source) {
        this.player_.options()[key] = options.source[key];
      }
    }

    // Disable lockShowing because YouTube controls are there
    if (this.player_.options().ytcontrols){
      this.player_.controls(false);
    }

    this.videoId = videojs.Youtube.parseVideoId(this.player_.options().src);

    if (typeof this.videoId != 'undefined') {
      // Show the YouTube poster only if we don't use YouTube poster (otherwise the controls pop, it's not nice)
      if (!this.player_.options().ytcontrols){
        // Set the YouTube poster only if none is specified
        if (typeof this.player_.poster() == 'undefined') {
          this.player_.poster('https://img.youtube.com/vi/' + this.videoId + '/0.jpg');
        }

        // Cover the entire iframe to have the same poster than YouTube
        // Doesn't exist right away because the DOM hasn't created it
        var self = this;
        setTimeout(function(){ self.player_.posterImage.el().style.backgroundSize = 'cover'; }, 50);
      }
    }

    this.id_ = this.player_.id() + '_youtube_api';

    this.el_ = videojs.Component.prototype.createEl('iframe', {
      id: this.id_,
      className: 'vjs-tech',
      scrolling: 'no',
      marginWidth: 0,
      marginHeight: 0,
      frameBorder: 0,
      webkitAllowFullScreen: '',
      mozallowfullscreen: '',
      allowFullScreen: ''
    });

    if(player.options_.allowFullScreen) {
        this.el_.setAttribute('allowfullscreen', true);
        this.el_.setAttribute('webkitallowfullscreen', true);
        this.el_.setAttribute('mozallowfullscreen', true);
    }

    this.player_el_.insertBefore(this.el_, this.player_el_.firstChild);

    var params = {
      enablejsapi: 1,
      iv_load_policy: 3,
      playerapiid: this.id(),
      disablekb: 1,
      wmode: 'transparent',
      controls: (this.player_.options().ytcontrols)?1:0,
      showinfo: 0,
      modestbranding: 1,
      rel: 0,
      autoplay: (this.player_.options().autoplay)?1:0,
      loop: (this.player_.options().loop)?1:0,
      list: videojs.Youtube.parsePlaylist(this.player_.options().src)
    };

    if (typeof params.list == 'undefined') {
      delete params.list;
    }

    // Make autoplay work for iOS
    if (this.player_.options().autoplay) {
      this.playOnReady = true;
    }

    // If we are not on a server, don't specify the origin (it will crash)
    if (window.location.protocol != 'file:') {
      params.origin = window.location.protocol + '//' + window.location.hostname;
    }

    this.el_.src = 'https://www.youtube.com/embed/' + this.videoId + '?' + videojs.Youtube.makeQueryString(params);
    //console.log("source: " + this.el_.src);

    if (this.player_.options().ytcontrols){
      // Remove the big play button and the control bar, we use Vimeo controls
      // Doesn't exist right away because the DOM hasn't created it
      var self = this;
      setTimeout(function(){
        var bigPlayDom = self.player_.bigPlayButton.el();
        bigPlayDom.parentNode.removeChild(bigPlayDom);

        var controlBarDom = self.player_.controlBar.el();
        controlBarDom.parentNode.removeChild(controlBarDom);
      }, 50);
    }

    if (videojs.Youtube.apiReady){
      //console.log('YT API ready');
      this.loadYoutube();
    } else {
      // Add to the queue because the YouTube API is not ready
      videojs.Youtube.loadingQueue.push(this);
      //console.log('YT API NOT ready');
      // Load the YouTube API if it is the first YouTube video
      if(!videojs.Youtube.apiLoading){
        //console.log('YT API NOT ready -  NOT LOADING');
        var tag = document.createElement('script');
        tag.src = 'https://www.youtube.com/iframe_api';
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
        videojs.Youtube.apiLoading = true;
      }
    }
  }
});

videojs.Youtube.prototype.dispose = function(){
  if (this.el_){
    this.el_.parentNode.removeChild(this.el_);
  }

  if (this.ytplayer) {
    this.ytplayer.destroy();
  }

  videojs.MediaTechController.prototype.dispose.call(this);
};

videojs.Youtube.prototype.src = function(src){
  this.ytplayer.loadVideoById({
    videoId: videojs.Youtube.parseVideoId(src),
    list: videojs.Youtube.parsePlaylist(src)
  });
};

videojs.Youtube.prototype.play = function(){
  if (this.isReady_){
    this.ytplayer.playVideo();
  } else {
    // We will play it when the API will be ready
    this.playOnReady = true;
  }
};

videojs.Youtube.prototype.pause = function(){ this.ytplayer.pauseVideo(); };
videojs.Youtube.prototype.paused = function(){
  return this.lastState !== YT.PlayerState.PLAYING &&
         this.lastState !== YT.PlayerState.BUFFERING;
};

videojs.Youtube.prototype.currentTime = function(){ return this.ytplayer.getCurrentTime(); };

videojs.Youtube.prototype.setCurrentTime = function(seconds){
  this.ytplayer.seekTo(seconds, true);
  this.player_.trigger('timeupdate');
};

videojs.Youtube.prototype.duration = function(){ return this.ytplayer.getDuration(); };
videojs.Youtube.prototype.buffered = function(){
  var loadedBytes = this.ytplayer.getVideoBytesLoaded();
  var totalBytes = this.ytplayer.getVideoBytesTotal();
  if (!loadedBytes || !totalBytes) return 0;

  var duration = this.ytplayer.getDuration();
  var secondsBuffered = (loadedBytes / totalBytes) * duration;
  var secondsOffset = (this.ytplayer.getVideoStartBytes() / totalBytes) * duration;
  return videojs.createTimeRange(secondsOffset, secondsOffset + secondsBuffered);
};

videojs.Youtube.prototype.volume = function() {
  if (isNaN(this.volumeVal)) {
    this.volumeVal = this.ytplayer.getVolume() / 100.0;
  }

  return this.volumeVal;
};

videojs.Youtube.prototype.setVolume = function(percentAsDecimal){
  if (percentAsDecimal && percentAsDecimal != this.volumeVal) {
    this.ytplayer.setVolume(percentAsDecimal * 100.0);
    this.volumeVal = percentAsDecimal;
    this.player_.trigger('volumechange');
  }
};

videojs.Youtube.prototype.muted = function() { return this.ytplayer.isMuted(); };
videojs.Youtube.prototype.setMuted = function(muted) {
  if (muted) {
    this.ytplayer.mute();
  } else {
    this.ytplayer.unMute();
  }

  var self = this;
  setTimeout(function() { self.player_.trigger('volumechange'); }, 50);
};

videojs.Youtube.prototype.onReady = function(){

  //console.log('videojs.Youtube.prototype.onReady');
  this.isReady_ = true;
  this.player_.trigger('techready');

  // Hide the poster when ready because YouTube has it's own
  this.triggerReady();
  this.player_.trigger('durationchange');

  // Play right away if we clicked before ready
  if (this.playOnReady){
    //console.log('playOnReady');
    this.ytplayer.playVideo();
  }
};

videojs.Youtube.prototype.onStateChange = function(state){
  if (state != this.lastState){
    switch(state){
      case -1:
        this.player_.trigger('durationchange');
        break;

      case YT.PlayerState.ENDED:
        this.player_.trigger('ended');
        break;

      case YT.PlayerState.PLAYING:
        this.player_.trigger('timeupdate');
        this.player_.trigger('durationchange');
        this.player_.trigger('playing');
        this.player_.trigger('play');
        break;

      case YT.PlayerState.PAUSED:
        this.player_.trigger('pause');
        break;

      case YT.PlayerState.BUFFERING:
        this.player_.trigger('timeupdate');
        this.player_.trigger('waiting');
        break;

      case YT.PlayerState.CUED:
        break;
    }

    this.lastState = state;
  }
};

videojs.Youtube.prototype.onPlaybackQualityChange = function(quality){
  switch(quality){
    case 'medium':
      this.player_.videoWidth = 480;
      this.player_.videoHeight = 360;
      break;

    case 'large':
      this.player_.videoWidth = 640;
      this.player_.videoHeight = 480;
      break;

    case 'hd720':
      this.player_.videoWidth = 960;
      this.player_.videoHeight = 720;
      break;

    case 'hd1080':
      this.player_.videoWidth = 1440;
      this.player_.videoHeight = 1080;
      break;

    case 'highres':
      this.player_.videoWidth = 1920;
      this.player_.videoHeight = 1080;
      break;

    case 'small':
      this.player_.videoWidth = 320;
      this.player_.videoHeight = 240;
      break;

    default:
      this.player_.videoWidth = 0;
      this.player_.videoHeight = 0;
      break;
  }

  this.player_.trigger('ratechange');
};

videojs.Youtube.prototype.onError = function(error){
  this.player_.error = error;
  this.player_.trigger('error');
};

videojs.Youtube.isSupported = function(){
  return true;
};

videojs.Youtube.prototype.supportsFullScreen = function() {
  return false;
};

videojs.Youtube.canPlaySource = function(srcObj){
  return (srcObj.type == 'video/youtube');
};

// All videos created before YouTube API is loaded
videojs.Youtube.loadingQueue = [];

// Create the YouTube player
videojs.Youtube.prototype.loadYoutube = function(){
  //console.log('videojs.Youtube.prototype.loadYoutube');
  this.ytplayer = new YT.Player(this.id_, {
    events: {
      onReady: function(e) { e.target.vjsTech.onReady(); },
      onStateChange: function(e) { e.target.vjsTech.onStateChange(e.data); },
      onPlaybackQualityChange: function(e){ e.target.vjsTech.onPlaybackQualityChange(e.data); },
      onError: function(e){ e.target.vjsTech.onError(e.data); }
    }
  });

  this.ytplayer.vjsTech = this;
};

videojs.Youtube.makeQueryString = function(args){
  var array = [];
  for (var key in args){
    if (args.hasOwnProperty(key)){
      array.push(encodeURIComponent(key) + '=' + encodeURIComponent(args[key]));
    }
  }

  return array.join('&');
};

videojs.Youtube.parseVideoId = function(src){
// Regex that parse the video ID for any YouTube URL
  var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
  var match = src.match(regExp);

  if (match && match[2].length == 11){
    return match[2];
  }
};

videojs.Youtube.parsePlaylist = function(src){
  // Check if we have a playlist
  var regExp = /[?&]list=([^#\&\?]+)/;
  var match = src.match(regExp);

  if (match != null && match.length > 1) {
    return match[1];
  }
};

// Called when YouTube API is ready to be used
window.onYouTubeIframeAPIReady = function () {
  //console.log('window.onYouTubeIframeAPIReady');
    var yt;
    while ((yt = videojs.Youtube.loadingQueue.shift())) {
        yt.loadYoutube();
    }
    videojs.Youtube.loadingQueue = [];
    videojs.Youtube.apiReady = true;
};
function destroyAllVideoJsElements() {

    var videoSelector = $('.ce-video:visible, .ce-audio:visible');
    videoSelector.each(function(index, element) {
        var currentPlayerId = $(element).attr('id');
        // if (!!$('div#' + currentPlayerId).length && currentPlayerId != id) {
            videojs(currentPlayerId).dispose();
        // }
    });
}

function destroyVideoJsWithId(id) {
    videojs(id).dispose();
}

function pauseAllVideoJSElementsExcept(id) {
    $('.ce-video:visible, .ce-audio:visible').each(function(index, element) {
        var currentPlayerId = $(element).attr('id');

        if (currentPlayerId !== id) {
            videojs(currentPlayerId).pause();
        }
    });
}

function createVideoJSElementFromId(currentPlayerId, callback) {

    var $playerByID = $('#' + currentPlayerId);

    if ($playerByID.hasClass('ce-image')) {
        var ceImageWrapper = $playerByID;

        ceImageWrapper.find('.ce-video-drop-down-label select').on('change', function() {
            var urlToOpen = $(this).val();

            if (urlToOpen) {
                window.setTimeout(function() {
                    /* First we try to open the shareURL in a new window */
                    var cannotOpenWindow = window.open(urlToOpen, '_blank');
                    /* If this is not possible we open it in the same window */
                    if (cannotOpenWindow == undefined) {
                        window.location = urlToOpen;
                    }
                }, 0);
            }
        });

        ceImageWrapper.find('img').on('click', function () {
            ceImageWrapper.find('.vjs-fullscreen-control').trigger('click');
        });

        ceImageWrapper.find('.vjs-fullscreen-control').on('click', function() {

            ceImageWrapper.find('img').removeAttr('style');
            if (ceImageWrapper.hasClass('vjs-fullscreen')) {
                // $('.gallery-icon-wrapper:hidden').parent().find('.ce-media-wrapper').append(ceImageWrapper);

                if (!!$('.gallery-icon-wrapper:hidden').length) {
                    $('.gallery-icon-wrapper:hidden').parent().find('.ce-media-wrapper').append(ceImageWrapper);
                } else if (!!$('.g-video-wrapper').length) {
                    $('.g-video-wrapper').find('.ce-media-wrapper').append(ceImageWrapper);
                }
            } else {
                var $image = ceImageWrapper.find('.gallery-thumbnail');
                if ($image.attr('src') != $image.data('image-src')) {
                    ceImageWrapper.find('.vjs-loading-spinner').show();
                    $image.attr('src', $image.data('image-src'));
                    $image.hide();
                    $image.on('load', function() {
                        ceImageWrapper.find('.vjs-loading-spinner').hide();
                        $image.show();
                        $(window).trigger('resize');
                    });
                }
                ceImageWrapper.prependTo('body');
            }

            ceImageWrapper.toggleClass('vjs-fullscreen');
            $(window).trigger('resize');

            // if (!ceImageWrapper.hasClass('vjs-fullscreen')) {
            //     ceImageWrapper.find('img').removeAttr('style');
            // }
        });

        $(window).on('resize', function () {
            if (!!$('.vjs-fullscreen img').length) {
                var image = $('.vjs-fullscreen img');
                $('.vjs-fullscreen img').css({
                    marginLeft: -$('.vjs-fullscreen img').width() / 2,
                    marginTop: -$('.vjs-fullscreen img').height() / 2
                });
            }
        }).trigger('resize');

        if (ceImageWrapper.find('.vjs-share-menu-button').length == 0 || ceImageWrapper.find('.vjs-share-menu-select').length == 0) {
            ceImageWrapper.addClass('ce-video-no-sharing');
        }

        initCustomDropDownSelectDelegate();

        ceImageWrapper.find('.vjs-fullscreen-control').trigger('click');
    }
    else {

        if (Modernizr.touch) {
            videojs.VolumeMenuButton.prototype.onClick = function(event) {

                // Workaround for touch devices
                // Check if the mute toggles were touched
                if (!$(event.target).hasClass('ce-bottom-mute-toggle') && !$(event.target).hasClass('ce-top-mute-toggle')) {

                    vjs.MenuButton.prototype.onClick.call(this);

                    // Check if the volume menu was clicked. Show and hide sound control explicit
                    if (!$('.vjs-volume-menu-button.vjs-menu-button .vjs-lock-showing').length) {
                        $('.vjs-volume-menu-button.vjs-menu-button .vjs-menu').hide();
                    } else {
                        $('.vjs-volume-menu-button.vjs-menu-button .vjs-menu').show();
                    }

                } else {
                    // Trigger click explicit on mute buttons
                    $(event.target).trigger('click');
                }
            };
        }

        videojs.BigPlayButton.prototype.onClick = function(){
            if (this.player_.paused()) {
                this.player_.play();
            } else {
                this.player_.pause();
            }
        };
        var ceMediaWrapper = $playerByID.parent();
        var ceMediaWrapperParent = $playerByID.parent().parent();
        var itemID = $(ceMediaWrapperParent).attr('id');

        // [JA] #29710 (hotfix) - prevent player from hiding all m-04-intro-section-slide-text in fullscreen mode (bad selector)
        var $playerSliderText = ceMediaWrapperParent.find('.m-04-intro-section-slide-text');

        // assign random ID if parent container doesn't have one
        if (typeof (itemID) === 'undefined') {
            itemID = 'V' + parseInt(((Math.random() * 10000000).toString()));
            $(ceMediaWrapperParent).attr('id', itemID);
        }

        ceMediaWrapper.attr('data-parent-id', itemID);

        var isAlreadyExitedFullscreen = false;
        var userAgent = navigator.userAgent.toLowerCase();

        videojs.Player.prototype.cancelFullScreen = function(){
            isAlreadyExitedFullscreen = true;

            if (!/(ipad|iphone|ipod|android)/g.test(userAgent)) {

                // ceMediaWrapper neu auslesen - da globale Variable ist sie sonst immer auf das zu letzt generierte Video Elemt gesetzt
                // aktuelles Fullscreen Element ist immer direkt unter body
                var ceMediaWrapper = $('body > .ce-media-wrapper');

                if (!!$('.gallery-icon-wrapper:hidden').length) {
                    $('.gallery-icon-wrapper:hidden').parent().append(ceMediaWrapper);
                } else if (!!$('.g-video-wrapper').length) {
                    //$('.g-video-wrapper').append(ceMediaWrapper);

                    $('#' + ceMediaWrapper.attr('data-parent-id')).prepend(ceMediaWrapper);
                }
                else if (!!$('.m-08-features-slide-left.video').length){
                    $('#' + ceMediaWrapper.attr('data-parent-id')).prepend(ceMediaWrapper);
                }
            }

            var requestFullScreen = vjs.support.requestFullScreen;
            this.isFullScreen = false;

            // Check for browser element fullscreen support
            if (requestFullScreen) {
                document[requestFullScreen.cancelFn]();
            } else if (this.tech.supportsFullScreen()) {
                this.techCall('exitFullScreen');
            } else {
                this.exitFullWindow();
                this.trigger('fullscreenchange');
            }

            return this;
        };


        videojs.FullscreenToggle.prototype.onClick = function(){
            if (!/(ipad|iphone|ipod|android)/g.test(userAgent)) {
                ceMediaWrapper.find('video').removeAttr('style');
            }
            if (!this.player_.isFullScreen) {
                if (!/(ipad|iphone|ipod|android)/g.test(userAgent)) {
                    ceMediaWrapper.prependTo('body');
                }
                this.player_.requestFullScreen();
                isAlreadyExitedFullscreen = false;
            } else {
                this.player_.cancelFullScreen();
            }
            $(window).trigger('resize');
        };

        function createSoundAdditions() {
            var $player = $(player.el_);

            if (!$player.hasClass('ce-audio')) {
                return;
            }

            var bigPlayButton = $player.find('.vjs-big-play-button');
            var soundBarWrapper = $('<div class="ce-audio-bar-wrapper"/>');
            soundBarWrapper.append('<div class="ce-audio-bar-left"/>');
            soundBarWrapper.append('<div class="ce-audio-bar-center"/>');
            soundBarWrapper.append('<div class="ce-audio-bar-right"/>');

            bigPlayButton.append(soundBarWrapper);
        }

        var isIphoneIpod = /(iPhone|iPod)/g.test( navigator.userAgent );
        var bgSoundTimer = null;

        var player = videojs(
            currentPlayerId,
            {
                allowFullScreen: true,
                width                  : '100%',
                height                 : '100%',
                nativeControlsForTouch : false,
                techOrder              : ["youtube", "html5"],//, "flash"
                ytcontrols             : true,

                flash                  : {
                    swf : "../../../scripts/vendor/video-js.swf"
                },

                plugins                : {
                    resolutions : {},
                    socialMedia : {},
                    downloadMenuButton : $(this.el_).hasClass('ce-audio') ? {} : false
                },

                children               : {

                    controlBar    : {

                        children : {

                            playToggle           : {},
                            currentTimeDisplay   : {},
                            timeDivider          : false,
                            remainingTimeDisplay : false,
                            progressControl      : {},
                            volumeControl        : false,
                            fullscreenToggle     : {},
                            volumeMenuButton     : {},
                            muteToggle           : false,
                            durationDisplay      : {}
                        }
                    }
                }

            }, function(){
                /*
                 * The Video Caption is taken from the hidden Vicdeo Caption Source Element
                 * and is added to the Controlbar. So it can be easily hidden with the
                 * default controlbar hide setting.
                 */
                var controlBar = $(this.controlBar.el());
                $playerByID.parents('.ce-media-wrapper').find('.ce-video-caption').appendTo(controlBar);

            }

        );

        player.on('fullscreenchange', function() {

            if (!player.isFullScreen && !isAlreadyExitedFullscreen) {
                player.cancelFullScreen();
                $(window).trigger('resize');
            }
        });


        player.ready(function () {

            //console.log('player.ready');
            /*
             * Add a class to html element indicating if volume control is available
             * on the device, so we can use that class in css to position control bar
             * items properly.
             */
            if (!this.tech.features.volumeControl) {
                $('html').addClass('ce-video-no-volume-control');
            }

            /*
             * To maintain the correct clicks behaviour on iphone and ipod, we need to hide
             * the video element itself. We also add a videoplay on iphone or ipod specific
             * class to html element which can be used in css files.
             */
            if (isIphoneIpod) {
                $('html').addClass('ce-video-is-iphone-ipod');
                //$('#' + currentPlayerId + ' video').css('visibility', 'hidden');
                //$('#' + currentPlayerId + ' audio').css('visibility', 'hidden');
            }

            if (!this.resolutions_.options_.sourceResolutions || this.resolutions_.options_.sourceResolutions.length <= 1) {
                // $('html').addClass('ce-video-no-resolutions');
                $(this.el_).addClass('ce-video-no-resolutions');
            }

            if ($(this.el_).parent().find('.ce-video-share').length == 0) {
                $(this.el_).addClass('ce-video-no-sharing');
            }

            /*
             * This is needed for Android Devices to add a custom Overlay for native
             * Selectboxes.
             */
            initCustomDropDownSelectDelegate();

            /*
             * Creates Soundbars if current player is a audioplayer. Thos bars are attached to the
             * big play button and will be animated
             */
            createSoundAdditions();

            /*
             * If Videoplayer is inside Royalslider we need to add rsNoDrag to some special Elements
             */
            if (!!$(this.el_).closest('.royalSlider').length) {
                $(this.el_).find('.vjs-control-bar .vjs-control').addClass('rsNoDrag');
                // $(this.el_).find('.vjs-control-bar .vjs-progress-control').addClass('rsNoDrag');
                // $(this.el_).find('.vjs-control-bar .vjs-volume-menu-button').addClass('rsNoDrag');
            }

            var $volumeMenuButton = $('#' + currentPlayerId + ' .vjs-volume-menu-button')
              , $toggleTop = $('<span class="ce-top-mute-toggle"/>')
              , $toggleBottom = $('<span class="ce-bottom-mute-toggle"/>');

            $toggleTop.on('click', function () {
                player.muted(false);
                return false;
            });

            $toggleBottom.on('click', function () {
                player.muted(true);
                return false;
            });

            $volumeMenuButton.find('.vjs-menu-content').append($toggleTop);
            $volumeMenuButton.find('.vjs-menu-content').append($toggleBottom);

            //console.log('callback');
            //console.log(callback);

            callback && callback(this);

            // >>> neuer Video claim, auf dem video
            var $player = $(this.el_);
            
            function onPlayerStateChange(event) {

              // ENDED
              if(event.data == 0) {
                $player.parents('.m-04-intro-section-slide').find('.m-04-intro-section-slide-videoclaim').removeClass('playing');
              }

              // PLAYING
              if(event.data == 1) {
                $('.m-04-intro-section-model-slider-wrapper .g-video-wrapper').addClass('noclaim');
                $player.parents('.m-04-intro-section-slide').find('.m-04-intro-section-slide-videoclaim').addClass('playing');
              }

              // BUFFERING
              if(event.data == 3) {    
                $('.m-04-intro-section-model-slider-wrapper .g-video-wrapper').addClass('noclaim');
                $player.parents('.m-04-intro-section-slide').find('.m-04-intro-section-slide-videoclaim').addClass('playing');
              }
            };
            
            /* [ZT]: Ein/ausblenden des Claims begins */
            if(!!$('.m-04-intro-section-slide .video-youtube').length && typeof YT != "undefined") {
                player = new YT.Player($('.video-youtube iframe').attr('id'), {
                    events: {
                        'onStateChange': onPlayerStateChange
                    }
                });
                /* [ZT]: der Hotfix gegen HTTP muss noch weitergemacht werden, weil das nicht die richtige Stelle ist begins*/
                $('.m-04-intro-section-slide .video-youtube iframe').each(function (i, e) {
                    var _youtubesrcurl = $('.m-04-intro-section-slide .video-youtube iframe').eq(i).attr('src');
                    if(typeof _youtubesrcurl != 'undefined' && _youtubesrcurl.indexOf('http://') != -1) {
                        $('.video-youtube iframe').eq(i).attr('src', _youtubesrcurl.replace('http', 'https'));
                    };
                });
                /* [ZT]: der Hotfix gegen HTTP muss noch weitergemacht werden, weil das nicht die richtige Stelle ist ends*/

                /*[ZT]: Ein/ausblenden des Claims ends */

                $player.parent().parent().find('.m-04-intro-section-slide-text').click(function () {
                    player.play();
                }).css({
                    'cursor': 'pointer'
                }).find('.m-04-intro-section-block, .m-04-intro-section-block-inner, .claim-part-1, .claim-part-2').css({
                    'cursor': 'pointer'
                });
                // <<< neuer Video claim, auf dem video
            };
        });
        /*
         * Video element event: webkitendfullscreen. This only applies ion Apple devices
         * with native Fullscreen support.
         */
        $('#' + currentPlayerId + ' video').on('webkitendfullscreen', function() {
            if (isIphoneIpod) {
                $('#' + currentPlayerId).find('.vjs-poster').show();
                player.pause();
                $(this).css('visibility', 'hidden');
                $(window).trigger('resize');
            }
        });

        /*
         * Player event: did start playing
         */
        player.on('play', function() {
            var $player = $(this.el_);

            $player.removeClass('vjs-ended');
            $player.addClass('vjs-has-started');

            /*
             * When the Videoplayer receives a play interaction from the user we show the
             * hidden video element on iphone and ipod again.
             */
            if (isIphoneIpod) {
                $('#' + currentPlayerId + ' video').css('visibility', 'visible');
                $('#' + currentPlayerId + ' audio').css('visibility', 'visible');
            }

            // >>> neuer Video claim, auf dem video
            $playerSliderText.addClass('vjs-hide-text');
            // <<< neuer Video claim, auf dem video

            // 2014-07-01 [SK] - ggf. vorhandener Hintergrundsound anhalten
            //$('#swfsoundloop').remove();
	        if ($('.b-soundloop').hasClass('icon-sound')) {
	            $('.b-soundloop').trigger('click', [true]);
	        }
            $('.b-soundloop').removeClass('icon-sound').addClass('icon-sound-mute');
            if (bgSoundTimer != null) {
                clearTimeout(bgSoundTimer);
                bgSoundTimer = null;
            }

            $player.parents('.m-04-intro-section-slide').find('.m-04-intro-section-slide-videoclaim').addClass('playing');

        });

        // 2014-07-01 [sk] - ggf. vorhandener hintergrundsound aktivieren    
        player.on('pause', function() {
            if (bgSoundTimer === null && !$('.b-soundloop').hasClass('icon-sound') && $.cookie("LANDINGPAGE.sound") != "mute") {
                bgSoundTimer = window.setTimeout(function() {
                    $('.b-soundloop').trigger('click', [true]);
                    bgSoundTimer = null;
                }, 3000);
            } else {

            }
        });

        /*
         * Player event: ended playing
         */
        player.on('ended', function() {
            var $player = $(this.el_);

            $player.removeClass('vjs-has-started');

            this.currentTime(0); // 2 minutes into the video
            this.pause();
            this.posterImage.el_.style.display = 'block';
            // this.bigPlayButton.show();

            // >>> neuer Video claim, auf dem video
            $playerSliderText.removeClass('vjs-hide-text');
            // <<< neuer Video claim, auf dem video

            if(this.isFullScreen === true)
            {
                player.cancelFullScreen();
            }

            $player.parents('.m-04-intro-section-slide').find('.m-04-intro-section-slide-videoclaim').removeClass('playing');

        });

        return player;
    }
}

function createVideoJSElements(earlybirds) {
    
    earlybirds = (typeof earlybirds === 'undefined') ? true : earlybirds;

    var videoSelector = (earlybirds) ? $('.ce-video:visible, .ce-audio:visible, .ce-image:visible').not('.lateinit') : $('.ce-video.lateinit:visible, .ce-audio.lateinit:visible, .ce-image.lateinit:visible');
    var isIphoneIpod = /(iPhone|iPod)/g.test( navigator.userAgent );

    videoSelector.each(function(index, element) {
        var currentPlayerId = $(element).attr('id');

        createVideoJSElementFromId(currentPlayerId);
    });
}

/*CF+SK IOS6 Ipad Video Problem*/
var iOSVersion = parseInt(
	('' + (/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent) || [0,''])[1])
	.replace('undefined', '3_2').replace('_', '.').replace('_', '')
) || false;
/* /CF+SK IOS6 Ipad Video Problem*/

$(document).ready(function() {
	/*CF+SK IOS6 Ipad Video Problem*/
	/*Resolves issue that features-slider is not loaded when non youtube video element is used*/
	/*Delete whole c$f-block to restore original state AND enable createVideoJSElements() after the c$f-block. See also c$f-block @m-08-features.js */
	
	/*In case of errors reduce to porsche.com/specials */
	/*if( iOSVersion == 6 && document.URL == "https://preview.porsche.com/specials/en/uk/sound-systems/burmester/"){*/
	if(iOSVersion != 6){
		createVideoJSElements();
	}
	/* /CF+SK IOS6 Ipad Video Problem*/
});

$(window).load(function () {
	/*CF+SK IOS6 Ipad Video Problem*/
	/*Resolves issue that features-slider is not loaded when non youtube video element is used*/
	
	/*if( iOSVersion == 6 && document.URL == "https://preview.porsche.com/specials/en/uk/sound-systems/burmester/"){*/
	if( iOSVersion == 6){
		createVideoJSElements();
	}
	/* /CF+SK IOS6 Ipad Video Problem*/
});
/*! @vimeo/player v2.5.0 | (c) 2018 Vimeo | MIT License | https://github.com/vimeo/player.js */
(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :
        typeof define === 'function' && define.amd ? define(factory) :
            (global.Vimeo = global.Vimeo || {}, global.Vimeo.Player = factory());
}(this, (function () { 'use strict';

    /**
     * @module lib/functions
     */

    /**
     * Check to see this is a node environment.
     * @type {Boolean}
     */
    /* global global */
    var isNode = typeof global !== 'undefined' && {}.toString.call(global) === '[object global]';

    /**
     * Get the name of the method for a given getter or setter.
     *
     * @param {string} prop The name of the property.
     * @param {string} type Either “get” or “set”.
     * @return {string}
     */
    function getMethodName(prop, type) {
        if (prop.indexOf(type.toLowerCase()) === 0) {
            return prop;
        }

        return '' + type.toLowerCase() + prop.substr(0, 1).toUpperCase() + prop.substr(1);
    }

    /**
     * Check to see if the object is a DOM Element.
     *
     * @param {*} element The object to check.
     * @return {boolean}
     */
    function isDomElement(element) {
        return element instanceof window.HTMLElement;
    }

    /**
     * Check to see whether the value is a number.
     *
     * @see http://dl.dropboxusercontent.com/u/35146/js/tests/isNumber.html
     * @param {*} value The value to check.
     * @param {boolean} integer Check if the value is an integer.
     * @return {boolean}
     */
    function isInteger(value) {
        // eslint-disable-next-line eqeqeq
        return !isNaN(parseFloat(value)) && isFinite(value) && Math.floor(value) == value;
    }

    /**
     * Check to see if the URL is a Vimeo url.
     *
     * @param {string} url The url string.
     * @return {boolean}
     */
    function isVimeoUrl(url) {
        return (/^(https?:)?\/\/((player|www).)?vimeo.com(?=$|\/)/.test(url)
        );
    }

    /**
     * Get the Vimeo URL from an element.
     * The element must have either a data-vimeo-id or data-vimeo-url attribute.
     *
     * @param {object} oEmbedParameters The oEmbed parameters.
     * @return {string}
     */
    function getVimeoUrl() {
        var oEmbedParameters = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

        var id = oEmbedParameters.id;
        var url = oEmbedParameters.url;
        var idOrUrl = id || url;

        if (!idOrUrl) {
            throw new Error('An id or url must be passed, either in an options object or as a data-vimeo-id or data-vimeo-url attribute.');
        }

        if (isInteger(idOrUrl)) {
            return 'https://vimeo.com/' + idOrUrl;
        }

        if (isVimeoUrl(idOrUrl)) {
            return idOrUrl.replace('http:', 'https:');
        }

        if (id) {
            throw new TypeError('\u201C' + id + '\u201D is not a valid video id.');
        }

        throw new TypeError('\u201C' + idOrUrl + '\u201D is not a vimeo.com url.');
    }

    var arrayIndexOfSupport = typeof Array.prototype.indexOf !== 'undefined';
    var postMessageSupport = typeof window !== 'undefined' && typeof window.postMessage !== 'undefined';

    if (!isNode && (!arrayIndexOfSupport || !postMessageSupport)) {
        throw new Error('Sorry, the Vimeo Player API is not available in this browser.');
    }

    var commonjsGlobal = typeof window !== 'undefined' ? window : typeof global !== 'undefined' ? global : typeof self !== 'undefined' ? self : {};





    function createCommonjsModule(fn, module) {
        return module = { exports: {} }, fn(module, module.exports), module.exports;
    }

    var index = createCommonjsModule(function (module, exports) {
        (function (exports) {
            'use strict';
            //shared pointer

            var i;
            //shortcuts
            var defineProperty = Object.defineProperty,
                is = function is(a, b) {
                    return a === b || a !== a && b !== b;
                };

            //Polyfill global objects
            if (typeof WeakMap == 'undefined') {
                exports.WeakMap = createCollection({
                    // WeakMap#delete(key:void*):boolean
                    'delete': sharedDelete,
                    // WeakMap#clear():
                    clear: sharedClear,
                    // WeakMap#get(key:void*):void*
                    get: sharedGet,
                    // WeakMap#has(key:void*):boolean
                    has: mapHas,
                    // WeakMap#set(key:void*, value:void*):void
                    set: sharedSet
                }, true);
            }

            if (typeof Map == 'undefined' || typeof new Map().values !== 'function' || !new Map().values().next) {
                exports.Map = createCollection({
                    // WeakMap#delete(key:void*):boolean
                    'delete': sharedDelete,
                    //:was Map#get(key:void*[, d3fault:void*]):void*
                    // Map#has(key:void*):boolean
                    has: mapHas,
                    // Map#get(key:void*):boolean
                    get: sharedGet,
                    // Map#set(key:void*, value:void*):void
                    set: sharedSet,
                    // Map#keys(void):Iterator
                    keys: sharedKeys,
                    // Map#values(void):Iterator
                    values: sharedValues,
                    // Map#entries(void):Iterator
                    entries: mapEntries,
                    // Map#forEach(callback:Function, context:void*):void ==> callback.call(context, key, value, mapObject) === not in specs`
                    forEach: sharedForEach,
                    // Map#clear():
                    clear: sharedClear
                });
            }

            if (typeof Set == 'undefined' || typeof new Set().values !== 'function' || !new Set().values().next) {
                exports.Set = createCollection({
                    // Set#has(value:void*):boolean
                    has: setHas,
                    // Set#add(value:void*):boolean
                    add: sharedAdd,
                    // Set#delete(key:void*):boolean
                    'delete': sharedDelete,
                    // Set#clear():
                    clear: sharedClear,
                    // Set#keys(void):Iterator
                    keys: sharedValues, // specs actually say "the same function object as the initial value of the values property"
                    // Set#values(void):Iterator
                    values: sharedValues,
                    // Set#entries(void):Iterator
                    entries: setEntries,
                    // Set#forEach(callback:Function, context:void*):void ==> callback.call(context, value, index) === not in specs
                    forEach: sharedForEach
                });
            }

            if (typeof WeakSet == 'undefined') {
                exports.WeakSet = createCollection({
                    // WeakSet#delete(key:void*):boolean
                    'delete': sharedDelete,
                    // WeakSet#add(value:void*):boolean
                    add: sharedAdd,
                    // WeakSet#clear():
                    clear: sharedClear,
                    // WeakSet#has(value:void*):boolean
                    has: setHas
                }, true);
            }

            /**
             * ES6 collection constructor
             * @return {Function} a collection class
             */
            function createCollection(proto, objectOnly) {
                function Collection(a) {
                    if (!this || this.constructor !== Collection) return new Collection(a);
                    this._keys = [];
                    this._values = [];
                    this._itp = []; // iteration pointers
                    this.objectOnly = objectOnly;

                    //parse initial iterable argument passed
                    if (a) init.call(this, a);
                }

                //define size for non object-only collections
                if (!objectOnly) {
                    defineProperty(proto, 'size', {
                        get: sharedSize
                    });
                }

                //set prototype
                proto.constructor = Collection;
                Collection.prototype = proto;

                return Collection;
            }

            /** parse initial iterable argument passed */
            function init(a) {
                var i;
                //init Set argument, like `[1,2,3,{}]`
                if (this.add) a.forEach(this.add, this);
                //init Map argument like `[[1,2], [{}, 4]]`
                else a.forEach(function (a) {
                    this.set(a[0], a[1]);
                }, this);
            }

            /** delete */
            function sharedDelete(key) {
                if (this.has(key)) {
                    this._keys.splice(i, 1);
                    this._values.splice(i, 1);
                    // update iteration pointers
                    this._itp.forEach(function (p) {
                        if (i < p[0]) p[0]--;
                    });
                }
                // Aurora here does it while Canary doesn't
                return -1 < i;
            }

            function sharedGet(key) {
                return this.has(key) ? this._values[i] : undefined;
            }

            function has(list, key) {
                if (this.objectOnly && key !== Object(key)) throw new TypeError("Invalid value used as weak collection key");
                //NaN or 0 passed
                if (key != key || key === 0) for (i = list.length; i-- && !is(list[i], key);) {} else i = list.indexOf(key);
                return -1 < i;
            }

            function setHas(value) {
                return has.call(this, this._values, value);
            }

            function mapHas(value) {
                return has.call(this, this._keys, value);
            }

            /** @chainable */
            function sharedSet(key, value) {
                this.has(key) ? this._values[i] = value : this._values[this._keys.push(key) - 1] = value;
                return this;
            }

            /** @chainable */
            function sharedAdd(value) {
                if (!this.has(value)) this._values.push(value);
                return this;
            }

            function sharedClear() {
                (this._keys || 0).length = this._values.length = 0;
            }

            /** keys, values, and iterate related methods */
            function sharedKeys() {
                return sharedIterator(this._itp, this._keys);
            }

            function sharedValues() {
                return sharedIterator(this._itp, this._values);
            }

            function mapEntries() {
                return sharedIterator(this._itp, this._keys, this._values);
            }

            function setEntries() {
                return sharedIterator(this._itp, this._values, this._values);
            }

            function sharedIterator(itp, array, array2) {
                var p = [0],
                    done = false;
                itp.push(p);
                return {
                    next: function next() {
                        var v,
                            k = p[0];
                        if (!done && k < array.length) {
                            v = array2 ? [array[k], array2[k]] : array[k];
                            p[0]++;
                        } else {
                            done = true;
                            itp.splice(itp.indexOf(p), 1);
                        }
                        return { done: done, value: v };
                    }
                };
            }

            function sharedSize() {
                return this._values.length;
            }

            function sharedForEach(callback, context) {
                var it = this.entries();
                for (;;) {
                    var r = it.next();
                    if (r.done) break;
                    callback.call(context, r.value[1], r.value[0], this);
                }
            }
        })('object' != 'undefined' && typeof commonjsGlobal != 'undefined' ? commonjsGlobal : window);
    });

    var npo_src = createCommonjsModule(function (module) {
        var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

        /*! Native Promise Only
            v0.8.1 (c) Kyle Simpson
            MIT License: http://getify.mit-license.org
        */

        (function UMD(name, context, definition) {
            // special form of UMD for polyfilling across evironments
            context[name] = context[name] || definition();
            if ('object' != "undefined" && module.exports) {
                module.exports = context[name];
            } else if (typeof undefined == "function" && undefined.amd) {
                undefined(function $AMD$() {
                    return context[name];
                });
            }
        })("Promise", typeof commonjsGlobal != "undefined" ? commonjsGlobal : commonjsGlobal, function DEF() {
            /*jshint validthis:true */
            "use strict";

            var builtInProp,
                cycle,
                scheduling_queue,
                ToString = Object.prototype.toString,
                timer = typeof setImmediate != "undefined" ? function timer(fn) {
                    return setImmediate(fn);
                } : setTimeout;

            // dammit, IE8.
            try {
                Object.defineProperty({}, "x", {});
                builtInProp = function builtInProp(obj, name, val, config) {
                    return Object.defineProperty(obj, name, {
                        value: val,
                        writable: true,
                        configurable: config !== false
                    });
                };
            } catch (err) {
                builtInProp = function builtInProp(obj, name, val) {
                    obj[name] = val;
                    return obj;
                };
            }

            // Note: using a queue instead of array for efficiency
            scheduling_queue = function Queue() {
                var first, last, item;

                function Item(fn, self) {
                    this.fn = fn;
                    this.self = self;
                    this.next = void 0;
                }

                return {
                    add: function add(fn, self) {
                        item = new Item(fn, self);
                        if (last) {
                            last.next = item;
                        } else {
                            first = item;
                        }
                        last = item;
                        item = void 0;
                    },
                    drain: function drain() {
                        var f = first;
                        first = last = cycle = void 0;

                        while (f) {
                            f.fn.call(f.self);
                            f = f.next;
                        }
                    }
                };
            }();

            function schedule(fn, self) {
                scheduling_queue.add(fn, self);
                if (!cycle) {
                    cycle = timer(scheduling_queue.drain);
                }
            }

            // promise duck typing
            function isThenable(o) {
                var _then,
                    o_type = typeof o === "undefined" ? "undefined" : _typeof(o);

                if (o != null && (o_type == "object" || o_type == "function")) {
                    _then = o.then;
                }
                return typeof _then == "function" ? _then : false;
            }

            function notify() {
                for (var i = 0; i < this.chain.length; i++) {
                    notifyIsolated(this, this.state === 1 ? this.chain[i].success : this.chain[i].failure, this.chain[i]);
                }
                this.chain.length = 0;
            }

            // NOTE: This is a separate function to isolate
            // the `try..catch` so that other code can be
            // optimized better
            function notifyIsolated(self, cb, chain) {
                var ret, _then;
                try {
                    if (cb === false) {
                        chain.reject(self.msg);
                    } else {
                        if (cb === true) {
                            ret = self.msg;
                        } else {
                            ret = cb.call(void 0, self.msg);
                        }

                        if (ret === chain.promise) {
                            chain.reject(TypeError("Promise-chain cycle"));
                        } else if (_then = isThenable(ret)) {
                            _then.call(ret, chain.resolve, chain.reject);
                        } else {
                            chain.resolve(ret);
                        }
                    }
                } catch (err) {
                    chain.reject(err);
                }
            }

            function resolve(msg) {
                var _then,
                    self = this;

                // already triggered?
                if (self.triggered) {
                    return;
                }

                self.triggered = true;

                // unwrap
                if (self.def) {
                    self = self.def;
                }

                try {
                    if (_then = isThenable(msg)) {
                        schedule(function () {
                            var def_wrapper = new MakeDefWrapper(self);
                            try {
                                _then.call(msg, function $resolve$() {
                                    resolve.apply(def_wrapper, arguments);
                                }, function $reject$() {
                                    reject.apply(def_wrapper, arguments);
                                });
                            } catch (err) {
                                reject.call(def_wrapper, err);
                            }
                        });
                    } else {
                        self.msg = msg;
                        self.state = 1;
                        if (self.chain.length > 0) {
                            schedule(notify, self);
                        }
                    }
                } catch (err) {
                    reject.call(new MakeDefWrapper(self), err);
                }
            }

            function reject(msg) {
                var self = this;

                // already triggered?
                if (self.triggered) {
                    return;
                }

                self.triggered = true;

                // unwrap
                if (self.def) {
                    self = self.def;
                }

                self.msg = msg;
                self.state = 2;
                if (self.chain.length > 0) {
                    schedule(notify, self);
                }
            }

            function iteratePromises(Constructor, arr, resolver, rejecter) {
                for (var idx = 0; idx < arr.length; idx++) {
                    (function IIFE(idx) {
                        Constructor.resolve(arr[idx]).then(function $resolver$(msg) {
                            resolver(idx, msg);
                        }, rejecter);
                    })(idx);
                }
            }

            function MakeDefWrapper(self) {
                this.def = self;
                this.triggered = false;
            }

            function MakeDef(self) {
                this.promise = self;
                this.state = 0;
                this.triggered = false;
                this.chain = [];
                this.msg = void 0;
            }

            function Promise(executor) {
                if (typeof executor != "function") {
                    throw TypeError("Not a function");
                }

                if (this.__NPO__ !== 0) {
                    throw TypeError("Not a promise");
                }

                // instance shadowing the inherited "brand"
                // to signal an already "initialized" promise
                this.__NPO__ = 1;

                var def = new MakeDef(this);

                this["then"] = function then(success, failure) {
                    var o = {
                        success: typeof success == "function" ? success : true,
                        failure: typeof failure == "function" ? failure : false
                    };
                    // Note: `then(..)` itself can be borrowed to be used against
                    // a different promise constructor for making the chained promise,
                    // by substituting a different `this` binding.
                    o.promise = new this.constructor(function extractChain(resolve, reject) {
                        if (typeof resolve != "function" || typeof reject != "function") {
                            throw TypeError("Not a function");
                        }

                        o.resolve = resolve;
                        o.reject = reject;
                    });
                    def.chain.push(o);

                    if (def.state !== 0) {
                        schedule(notify, def);
                    }

                    return o.promise;
                };
                this["catch"] = function $catch$(failure) {
                    return this.then(void 0, failure);
                };

                try {
                    executor.call(void 0, function publicResolve(msg) {
                        resolve.call(def, msg);
                    }, function publicReject(msg) {
                        reject.call(def, msg);
                    });
                } catch (err) {
                    reject.call(def, err);
                }
            }

            var PromisePrototype = builtInProp({}, "constructor", Promise,
                /*configurable=*/false);

            // Note: Android 4 cannot use `Object.defineProperty(..)` here
            Promise.prototype = PromisePrototype;

            // built-in "brand" to signal an "uninitialized" promise
            builtInProp(PromisePrototype, "__NPO__", 0,
                /*configurable=*/false);

            builtInProp(Promise, "resolve", function Promise$resolve(msg) {
                var Constructor = this;

                // spec mandated checks
                // note: best "isPromise" check that's practical for now
                if (msg && (typeof msg === "undefined" ? "undefined" : _typeof(msg)) == "object" && msg.__NPO__ === 1) {
                    return msg;
                }

                return new Constructor(function executor(resolve, reject) {
                    if (typeof resolve != "function" || typeof reject != "function") {
                        throw TypeError("Not a function");
                    }

                    resolve(msg);
                });
            });

            builtInProp(Promise, "reject", function Promise$reject(msg) {
                return new this(function executor(resolve, reject) {
                    if (typeof resolve != "function" || typeof reject != "function") {
                        throw TypeError("Not a function");
                    }

                    reject(msg);
                });
            });

            builtInProp(Promise, "all", function Promise$all(arr) {
                var Constructor = this;

                // spec mandated checks
                if (ToString.call(arr) != "[object Array]") {
                    return Constructor.reject(TypeError("Not an array"));
                }
                if (arr.length === 0) {
                    return Constructor.resolve([]);
                }

                return new Constructor(function executor(resolve, reject) {
                    if (typeof resolve != "function" || typeof reject != "function") {
                        throw TypeError("Not a function");
                    }

                    var len = arr.length,
                        msgs = Array(len),
                        count = 0;

                    iteratePromises(Constructor, arr, function resolver(idx, msg) {
                        msgs[idx] = msg;
                        if (++count === len) {
                            resolve(msgs);
                        }
                    }, reject);
                });
            });

            builtInProp(Promise, "race", function Promise$race(arr) {
                var Constructor = this;

                // spec mandated checks
                if (ToString.call(arr) != "[object Array]") {
                    return Constructor.reject(TypeError("Not an array"));
                }

                return new Constructor(function executor(resolve, reject) {
                    if (typeof resolve != "function" || typeof reject != "function") {
                        throw TypeError("Not a function");
                    }

                    iteratePromises(Constructor, arr, function resolver(idx, msg) {
                        resolve(msg);
                    }, reject);
                });
            });

            return Promise;
        });
    });

    /**
     * @module lib/callbacks
     */

    var callbackMap = new WeakMap();

    /**
     * Store a callback for a method or event for a player.
     *
     * @param {Player} player The player object.
     * @param {string} name The method or event name.
     * @param {(function(this:Player, *): void|{resolve: function, reject: function})} callback
     *        The callback to call or an object with resolve and reject functions for a promise.
     * @return {void}
     */
    function storeCallback(player, name, callback) {
        var playerCallbacks = callbackMap.get(player.element) || {};

        if (!(name in playerCallbacks)) {
            playerCallbacks[name] = [];
        }

        playerCallbacks[name].push(callback);
        callbackMap.set(player.element, playerCallbacks);
    }

    /**
     * Get the callbacks for a player and event or method.
     *
     * @param {Player} player The player object.
     * @param {string} name The method or event name
     * @return {function[]}
     */
    function getCallbacks(player, name) {
        var playerCallbacks = callbackMap.get(player.element) || {};
        return playerCallbacks[name] || [];
    }

    /**
     * Remove a stored callback for a method or event for a player.
     *
     * @param {Player} player The player object.
     * @param {string} name The method or event name
     * @param {function} [callback] The specific callback to remove.
     * @return {boolean} Was this the last callback?
     */
    function removeCallback(player, name, callback) {
        var playerCallbacks = callbackMap.get(player.element) || {};

        if (!playerCallbacks[name]) {
            return true;
        }

        // If no callback is passed, remove all callbacks for the event
        if (!callback) {
            playerCallbacks[name] = [];
            callbackMap.set(player.element, playerCallbacks);

            return true;
        }

        var index = playerCallbacks[name].indexOf(callback);

        if (index !== -1) {
            playerCallbacks[name].splice(index, 1);
        }

        callbackMap.set(player.element, playerCallbacks);
        return playerCallbacks[name] && playerCallbacks[name].length === 0;
    }

    /**
     * Return the first stored callback for a player and event or method.
     *
     * @param {Player} player The player object.
     * @param {string} name The method or event name.
     * @return {function} The callback, or false if there were none
     */
    function shiftCallbacks(player, name) {
        var playerCallbacks = getCallbacks(player, name);

        if (playerCallbacks.length < 1) {
            return false;
        }

        var callback = playerCallbacks.shift();
        removeCallback(player, name, callback);
        return callback;
    }

    /**
     * Move callbacks associated with an element to another element.
     *
     * @param {HTMLElement} oldElement The old element.
     * @param {HTMLElement} newElement The new element.
     * @return {void}
     */
    function swapCallbacks(oldElement, newElement) {
        var playerCallbacks = callbackMap.get(oldElement);

        callbackMap.set(newElement, playerCallbacks);
        callbackMap.delete(oldElement);
    }

    /**
     * @module lib/embed
     */

    var oEmbedParameters = ['autopause', 'autoplay', 'background', 'byline', 'color', 'height', 'id', 'loop', 'maxheight', 'maxwidth', 'muted', 'playsinline', 'portrait', 'responsive', 'speed', 'title', 'transparent', 'url', 'width'];

    /**
     * Get the 'data-vimeo'-prefixed attributes from an element as an object.
     *
     * @param {HTMLElement} element The element.
     * @param {Object} [defaults={}] The default values to use.
     * @return {Object<string, string>}
     */
    function getOEmbedParameters(element) {
        var defaults = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

        return oEmbedParameters.reduce(function (params, param) {
            var value = element.getAttribute('data-vimeo-' + param);

            if (value || value === '') {
                params[param] = value === '' ? 1 : value;
            }

            return params;
        }, defaults);
    }

    /**
     * Make an oEmbed call for the specified URL.
     *
     * @param {string} videoUrl The vimeo.com url for the video.
     * @param {Object} [params] Parameters to pass to oEmbed.
     * @return {Promise}
     */
    function getOEmbedData(videoUrl) {
        var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

        return new Promise(function (resolve, reject) {
            if (!isVimeoUrl(videoUrl)) {
                throw new TypeError('\u201C' + videoUrl + '\u201D is not a vimeo.com url.');
            }

            var url = 'https://vimeo.com/api/oembed.json?url=' + encodeURIComponent(videoUrl);

            for (var param in params) {
                if (params.hasOwnProperty(param)) {
                    url += '&' + param + '=' + encodeURIComponent(params[param]);
                }
            }

            var xhr = 'XDomainRequest' in window ? new XDomainRequest() : new XMLHttpRequest();
            xhr.open('GET', url, true);

            xhr.onload = function () {
                if (xhr.status === 404) {
                    reject(new Error('\u201C' + videoUrl + '\u201D was not found.'));
                    return;
                }

                if (xhr.status === 403) {
                    reject(new Error('\u201C' + videoUrl + '\u201D is not embeddable.'));
                    return;
                }

                try {
                    var json = JSON.parse(xhr.responseText);
                    resolve(json);
                } catch (error) {
                    reject(error);
                }
            };

            xhr.onerror = function () {
                var status = xhr.status ? ' (' + xhr.status + ')' : '';
                reject(new Error('There was an error fetching the embed code from Vimeo' + status + '.'));
            };

            xhr.send();
        });
    }

    /**
     * Create an embed from oEmbed data inside an element.
     *
     * @param {object} data The oEmbed data.
     * @param {HTMLElement} element The element to put the iframe in.
     * @return {HTMLIFrameElement} The iframe embed.
     */
    function createEmbed(_ref, element) {
        var html = _ref.html;

        if (!element) {
            throw new TypeError('An element must be provided');
        }

        if (element.getAttribute('data-vimeo-initialized') !== null) {
            return element.querySelector('iframe');
        }

        var div = document.createElement('div');
        div.innerHTML = html;

        element.appendChild(div.firstChild);
        element.setAttribute('data-vimeo-initialized', 'true');

        return element.querySelector('iframe');
    }

    /**
     * Initialize all embeds within a specific element
     *
     * @param {HTMLElement} [parent=document] The parent element.
     * @return {void}
     */
    function initializeEmbeds() {
        var parent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document;

        var elements = [].slice.call(parent.querySelectorAll('[data-vimeo-id], [data-vimeo-url]'));

        var handleError = function handleError(error) {
            if ('console' in window && console.error) {
                console.error('There was an error creating an embed: ' + error);
            }
        };

        elements.forEach(function (element) {
            try {
                // Skip any that have data-vimeo-defer
                if (element.getAttribute('data-vimeo-defer') !== null) {
                    return;
                }

                var params = getOEmbedParameters(element);
                var url = getVimeoUrl(params);

                getOEmbedData(url, params).then(function (data) {
                    return createEmbed(data, element);
                }).catch(handleError);
            } catch (error) {
                handleError(error);
            }
        });
    }

    /**
     * Resize embeds when messaged by the player.
     *
     * @param {HTMLElement} [parent=document] The parent element.
     * @return {void}
     */
    function resizeEmbeds() {
        var parent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document;

        var onMessage = function onMessage(event) {
            if (!isVimeoUrl(event.origin)) {
                return;
            }

            if (!event.data || event.data.event !== 'spacechange') {
                return;
            }

            var iframes = parent.querySelectorAll('iframe');

            for (var i = 0; i < iframes.length; i++) {
                if (iframes[i].contentWindow !== event.source) {
                    continue;
                }

                var space = iframes[i].parentElement;

                if (space && space.className.indexOf('vimeo-space') !== -1) {
                    space.style.paddingBottom = event.data.data[0].bottom + 'px';
                }

                break;
            }
        };

        if (window.addEventListener) {
            window.addEventListener('message', onMessage, false);
        } else if (window.attachEvent) {
            window.attachEvent('onmessage', onMessage);
        }
    }

    /**
     * @module lib/postmessage
     */

    /**
     * Parse a message received from postMessage.
     *
     * @param {*} data The data received from postMessage.
     * @return {object}
     */
    function parseMessageData(data) {
        if (typeof data === 'string') {
            data = JSON.parse(data);
        }

        return data;
    }

    /**
     * Post a message to the specified target.
     *
     * @param {Player} player The player object to use.
     * @param {string} method The API method to call.
     * @param {object} params The parameters to send to the player.
     * @return {void}
     */
    function postMessage(player, method, params) {
        if (!player.element.contentWindow || !player.element.contentWindow.postMessage) {
            return;
        }

        var message = {
            method: method
        };

        if (params !== undefined) {
            message.value = params;
        }

        // IE 8 and 9 do not support passing messages, so stringify them
        var ieVersion = parseFloat(navigator.userAgent.toLowerCase().replace(/^.*msie (\d+).*$/, '$1'));
        if (ieVersion >= 8 && ieVersion < 10) {
            message = JSON.stringify(message);
        }

        player.element.contentWindow.postMessage(message, player.origin);
    }

    /**
     * Parse the data received from a message event.
     *
     * @param {Player} player The player that received the message.
     * @param {(Object|string)} data The message data. Strings will be parsed into JSON.
     * @return {void}
     */
    function processData(player, data) {
        data = parseMessageData(data);
        var callbacks = [];
        var param = void 0;

        if (data.event) {
            if (data.event === 'error') {
                var promises = getCallbacks(player, data.data.method);

                promises.forEach(function (promise) {
                    var error = new Error(data.data.message);
                    error.name = data.data.name;

                    promise.reject(error);
                    removeCallback(player, data.data.method, promise);
                });
            }

            callbacks = getCallbacks(player, 'event:' + data.event);
            param = data.data;
        } else if (data.method) {
            var callback = shiftCallbacks(player, data.method);

            if (callback) {
                callbacks.push(callback);
                param = data.value;
            }
        }

        callbacks.forEach(function (callback) {
            try {
                if (typeof callback === 'function') {
                    callback.call(player, param);
                    return;
                }

                callback.resolve(param);
            } catch (e) {
                // empty
            }
        });
    }

    var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

    function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

    var playerMap = new WeakMap();
    var readyMap = new WeakMap();

    var Player = function () {
        /**
         * Create a Player.
         *
         * @param {(HTMLIFrameElement|HTMLElement|string|jQuery)} element A reference to the Vimeo
         *        player iframe, and id, or a jQuery object.
         * @param {object} [options] oEmbed parameters to use when creating an embed in the element.
         * @return {Player}
         */
        function Player(element) {
            var _this = this;

            var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

            _classCallCheck(this, Player);

            /* global jQuery */
            if (window.jQuery && element instanceof jQuery) {
                if (element.length > 1 && window.console && console.warn) {
                    console.warn('A jQuery object with multiple elements was passed, using the first element.');
                }

                element = element[0];
            }

            // Find an element by ID
            if (typeof document !== 'undefined' && typeof element === 'string') {
                element = document.getElementById(element);
            }

            // Not an element!
            if (!isDomElement(element)) {
                throw new TypeError('You must pass either a valid element or a valid id.');
            }

            // Already initialized an embed in this div, so grab the iframe
            if (element.nodeName !== 'IFRAME') {
                var iframe = element.querySelector('iframe');

                if (iframe) {
                    element = iframe;
                }
            }

            // iframe url is not a Vimeo url
            if (element.nodeName === 'IFRAME' && !isVimeoUrl(element.getAttribute('src') || '')) {
                throw new Error('The player element passed isn’t a Vimeo embed.');
            }

            // If there is already a player object in the map, return that
            if (playerMap.has(element)) {
                return playerMap.get(element);
            }

            this.element = element;
            this.origin = '*';

            var readyPromise = new npo_src(function (resolve, reject) {
                var onMessage = function onMessage(event) {
                    if (!isVimeoUrl(event.origin) || _this.element.contentWindow !== event.source) {
                        return;
                    }

                    if (_this.origin === '*') {
                        _this.origin = event.origin;
                    }

                    var data = parseMessageData(event.data);
                    var isReadyEvent = 'event' in data && data.event === 'ready';
                    var isPingResponse = 'method' in data && data.method === 'ping';

                    if (isReadyEvent || isPingResponse) {
                        _this.element.setAttribute('data-ready', 'true');
                        resolve();
                        return;
                    }

                    processData(_this, data);
                };

                if (window.addEventListener) {
                    window.addEventListener('message', onMessage, false);
                } else if (window.attachEvent) {
                    window.attachEvent('onmessage', onMessage);
                }

                if (_this.element.nodeName !== 'IFRAME') {
                    var params = getOEmbedParameters(element, options);
                    var url = getVimeoUrl(params);

                    getOEmbedData(url, params).then(function (data) {
                        var iframe = createEmbed(data, element);
                        // Overwrite element with the new iframe,
                        // but store reference to the original element
                        _this.element = iframe;
                        _this._originalElement = element;

                        swapCallbacks(element, iframe);
                        playerMap.set(_this.element, _this);

                        return data;
                    }).catch(function (error) {
                        return reject(error);
                    });
                }
            });

            // Store a copy of this Player in the map
            readyMap.set(this, readyPromise);
            playerMap.set(this.element, this);

            // Send a ping to the iframe so the ready promise will be resolved if
            // the player is already ready.
            if (this.element.nodeName === 'IFRAME') {
                postMessage(this, 'ping');
            }

            return this;
        }

        /**
         * Get a promise for a method.
         *
         * @param {string} name The API method to call.
         * @param {Object} [args={}] Arguments to send via postMessage.
         * @return {Promise}
         */


        _createClass(Player, [{
            key: 'callMethod',
            value: function callMethod(name) {
                var _this2 = this;

                var args = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

                return new npo_src(function (resolve, reject) {
                    // We are storing the resolve/reject handlers to call later, so we
                    // can’t return here.
                    // eslint-disable-next-line promise/always-return
                    return _this2.ready().then(function () {
                        storeCallback(_this2, name, {
                            resolve: resolve,
                            reject: reject
                        });

                        postMessage(_this2, name, args);
                    }).catch(function (error) {
                        reject(error);
                    });
                });
            }

            /**
             * Get a promise for the value of a player property.
             *
             * @param {string} name The property name
             * @return {Promise}
             */

        }, {
            key: 'get',
            value: function get(name) {
                var _this3 = this;

                return new npo_src(function (resolve, reject) {
                    name = getMethodName(name, 'get');

                    // We are storing the resolve/reject handlers to call later, so we
                    // can’t return here.
                    // eslint-disable-next-line promise/always-return
                    return _this3.ready().then(function () {
                        storeCallback(_this3, name, {
                            resolve: resolve,
                            reject: reject
                        });

                        postMessage(_this3, name);
                    });
                });
            }

            /**
             * Get a promise for setting the value of a player property.
             *
             * @param {string} name The API method to call.
             * @param {mixed} value The value to set.
             * @return {Promise}
             */

        }, {
            key: 'set',
            value: function set(name, value) {
                var _this4 = this;

                return npo_src.resolve(value).then(function (val) {
                    name = getMethodName(name, 'set');

                    if (val === undefined || val === null) {
                        throw new TypeError('There must be a value to set.');
                    }

                    return _this4.ready().then(function () {
                        return new npo_src(function (resolve, reject) {
                            storeCallback(_this4, name, {
                                resolve: resolve,
                                reject: reject
                            });

                            postMessage(_this4, name, val);
                        });
                    });
                });
            }

            /**
             * Add an event listener for the specified event. Will call the
             * callback with a single parameter, `data`, that contains the data for
             * that event.
             *
             * @param {string} eventName The name of the event.
             * @param {function(*)} callback The function to call when the event fires.
             * @return {void}
             */

        }, {
            key: 'on',
            value: function on(eventName, callback) {
                if (!eventName) {
                    throw new TypeError('You must pass an event name.');
                }

                if (!callback) {
                    throw new TypeError('You must pass a callback function.');
                }

                if (typeof callback !== 'function') {
                    throw new TypeError('The callback must be a function.');
                }

                var callbacks = getCallbacks(this, 'event:' + eventName);
                if (callbacks.length === 0) {
                    this.callMethod('addEventListener', eventName).catch(function () {
                        // Ignore the error. There will be an error event fired that
                        // will trigger the error callback if they are listening.
                    });
                }

                storeCallback(this, 'event:' + eventName, callback);
            }

            /**
             * Remove an event listener for the specified event. Will remove all
             * listeners for that event if a `callback` isn’t passed, or only that
             * specific callback if it is passed.
             *
             * @param {string} eventName The name of the event.
             * @param {function} [callback] The specific callback to remove.
             * @return {void}
             */

        }, {
            key: 'off',
            value: function off(eventName, callback) {
                if (!eventName) {
                    throw new TypeError('You must pass an event name.');
                }

                if (callback && typeof callback !== 'function') {
                    throw new TypeError('The callback must be a function.');
                }

                var lastCallback = removeCallback(this, 'event:' + eventName, callback);

                // If there are no callbacks left, remove the listener
                if (lastCallback) {
                    this.callMethod('removeEventListener', eventName).catch(function (e) {
                        // Ignore the error. There will be an error event fired that
                        // will trigger the error callback if they are listening.
                    });
                }
            }

            /**
             * A promise to load a new video.
             *
             * @promise LoadVideoPromise
             * @fulfill {number} The video with this id successfully loaded.
             * @reject {TypeError} The id was not a number.
             */
            /**
             * Load a new video into this embed. The promise will be resolved if
             * the video is successfully loaded, or it will be rejected if it could
             * not be loaded.
             *
             * @param {number} id The id of the video.
             * @return {LoadVideoPromise}
             */

        }, {
            key: 'loadVideo',
            value: function loadVideo(id) {
                return this.callMethod('loadVideo', id);
            }

            /**
             * A promise to perform an action when the Player is ready.
             *
             * @todo document errors
             * @promise LoadVideoPromise
             * @fulfill {void}
             */
            /**
             * Trigger a function when the player iframe has initialized. You do not
             * need to wait for `ready` to trigger to begin adding event listeners
             * or calling other methods.
             *
             * @return {ReadyPromise}
             */

        }, {
            key: 'ready',
            value: function ready() {
                var readyPromise = readyMap.get(this) || new npo_src(function (resolve, reject) {
                    reject('Unknown player. Probably unloaded.');
                });
                return npo_src.resolve(readyPromise);
            }

            /**
             * A promise to add a cue point to the player.
             *
             * @promise AddCuePointPromise
             * @fulfill {string} The id of the cue point to use for removeCuePoint.
             * @reject {RangeError} the time was less than 0 or greater than the
             *         video’s duration.
             * @reject {UnsupportedError} Cue points are not supported with the current
             *         player or browser.
             */
            /**
             * Add a cue point to the player.
             *
             * @param {number} time The time for the cue point.
             * @param {object} [data] Arbitrary data to be returned with the cue point.
             * @return {AddCuePointPromise}
             */

        }, {
            key: 'addCuePoint',
            value: function addCuePoint(time) {
                var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

                return this.callMethod('addCuePoint', { time: time, data: data });
            }

            /**
             * A promise to remove a cue point from the player.
             *
             * @promise AddCuePointPromise
             * @fulfill {string} The id of the cue point that was removed.
             * @reject {InvalidCuePoint} The cue point with the specified id was not
             *         found.
             * @reject {UnsupportedError} Cue points are not supported with the current
             *         player or browser.
             */
            /**
             * Remove a cue point from the video.
             *
             * @param {string} id The id of the cue point to remove.
             * @return {RemoveCuePointPromise}
             */

        }, {
            key: 'removeCuePoint',
            value: function removeCuePoint(id) {
                return this.callMethod('removeCuePoint', id);
            }

            /**
             * A representation of a text track on a video.
             *
             * @typedef {Object} VimeoTextTrack
             * @property {string} language The ISO language code.
             * @property {string} kind The kind of track it is (captions or subtitles).
             * @property {string} label The human‐readable label for the track.
             */
            /**
             * A promise to enable a text track.
             *
             * @promise EnableTextTrackPromise
             * @fulfill {VimeoTextTrack} The text track that was enabled.
             * @reject {InvalidTrackLanguageError} No track was available with the
             *         specified language.
             * @reject {InvalidTrackError} No track was available with the specified
             *         language and kind.
             */
            /**
             * Enable the text track with the specified language, and optionally the
             * specified kind (captions or subtitles).
             *
             * When set via the API, the track language will not change the viewer’s
             * stored preference.
             *
             * @param {string} language The two‐letter language code.
             * @param {string} [kind] The kind of track to enable (captions or subtitles).
             * @return {EnableTextTrackPromise}
             */

        }, {
            key: 'enableTextTrack',
            value: function enableTextTrack(language, kind) {
                if (!language) {
                    throw new TypeError('You must pass a language.');
                }

                return this.callMethod('enableTextTrack', {
                    language: language,
                    kind: kind
                });
            }

            /**
             * A promise to disable the active text track.
             *
             * @promise DisableTextTrackPromise
             * @fulfill {void} The track was disabled.
             */
            /**
             * Disable the currently-active text track.
             *
             * @return {DisableTextTrackPromise}
             */

        }, {
            key: 'disableTextTrack',
            value: function disableTextTrack() {
                return this.callMethod('disableTextTrack');
            }

            /**
             * A promise to pause the video.
             *
             * @promise PausePromise
             * @fulfill {void} The video was paused.
             */
            /**
             * Pause the video if it’s playing.
             *
             * @return {PausePromise}
             */

        }, {
            key: 'pause',
            value: function pause() {
                return this.callMethod('pause');
            }

            /**
             * A promise to play the video.
             *
             * @promise PlayPromise
             * @fulfill {void} The video was played.
             */
            /**
             * Play the video if it’s paused. **Note:** on iOS and some other
             * mobile devices, you cannot programmatically trigger play. Once the
             * viewer has tapped on the play button in the player, however, you
             * will be able to use this function.
             *
             * @return {PlayPromise}
             */

        }, {
            key: 'play',
            value: function play() {
                return this.callMethod('play');
            }

            /**
             * A promise to unload the video.
             *
             * @promise UnloadPromise
             * @fulfill {void} The video was unloaded.
             */
            /**
             * Return the player to its initial state.
             *
             * @return {UnloadPromise}
             */

        }, {
            key: 'unload',
            value: function unload() {
                return this.callMethod('unload');
            }

            /**
             * Cleanup the player and remove it from the DOM
             *
             * It won't be usable and a new one should be constructed
             *  in order to do any operations.
             *
             * @return {Promise}
             */

        }, {
            key: 'destroy',
            value: function destroy() {
                var _this5 = this;

                return new npo_src(function (resolve) {
                    readyMap.delete(_this5);
                    playerMap.delete(_this5.element);
                    if (_this5._originalElement) {
                        playerMap.delete(_this5._originalElement);
                        _this5._originalElement.removeAttribute('data-vimeo-initialized');
                    }
                    if (_this5.element && _this5.element.nodeName === 'IFRAME') {
                        _this5.element.remove();
                    }
                    resolve();
                });
            }

            /**
             * A promise to get the autopause behavior of the video.
             *
             * @promise GetAutopausePromise
             * @fulfill {boolean} Whether autopause is turned on or off.
             * @reject {UnsupportedError} Autopause is not supported with the current
             *         player or browser.
             */
            /**
             * Get the autopause behavior for this player.
             *
             * @return {GetAutopausePromise}
             */

        }, {
            key: 'getAutopause',
            value: function getAutopause() {
                return this.get('autopause');
            }

            /**
             * A promise to set the autopause behavior of the video.
             *
             * @promise SetAutopausePromise
             * @fulfill {boolean} Whether autopause is turned on or off.
             * @reject {UnsupportedError} Autopause is not supported with the current
             *         player or browser.
             */
            /**
             * Enable or disable the autopause behavior of this player.
             *
             * By default, when another video is played in the same browser, this
             * player will automatically pause. Unless you have a specific reason
             * for doing so, we recommend that you leave autopause set to the
             * default (`true`).
             *
             * @param {boolean} autopause
             * @return {SetAutopausePromise}
             */

        }, {
            key: 'setAutopause',
            value: function setAutopause(autopause) {
                return this.set('autopause', autopause);
            }

            /**
             * A promise to get the color of the player.
             *
             * @promise GetColorPromise
             * @fulfill {string} The hex color of the player.
             */
            /**
             * Get the color for this player.
             *
             * @return {GetColorPromise}
             */

        }, {
            key: 'getColor',
            value: function getColor() {
                return this.get('color');
            }

            /**
             * A promise to set the color of the player.
             *
             * @promise SetColorPromise
             * @fulfill {string} The color was successfully set.
             * @reject {TypeError} The string was not a valid hex or rgb color.
             * @reject {ContrastError} The color was set, but the contrast is
             *         outside of the acceptable range.
             * @reject {EmbedSettingsError} The owner of the player has chosen to
             *         use a specific color.
             */
            /**
             * Set the color of this player to a hex or rgb string. Setting the
             * color may fail if the owner of the video has set their embed
             * preferences to force a specific color.
             *
             * @param {string} color The hex or rgb color string to set.
             * @return {SetColorPromise}
             */

        }, {
            key: 'setColor',
            value: function setColor(color) {
                return this.set('color', color);
            }

            /**
             * A representation of a cue point.
             *
             * @typedef {Object} VimeoCuePoint
             * @property {number} time The time of the cue point.
             * @property {object} data The data passed when adding the cue point.
             * @property {string} id The unique id for use with removeCuePoint.
             */
            /**
             * A promise to get the cue points of a video.
             *
             * @promise GetCuePointsPromise
             * @fulfill {VimeoCuePoint[]} The cue points added to the video.
             * @reject {UnsupportedError} Cue points are not supported with the current
             *         player or browser.
             */
            /**
             * Get an array of the cue points added to the video.
             *
             * @return {GetCuePointsPromise}
             */

        }, {
            key: 'getCuePoints',
            value: function getCuePoints() {
                return this.get('cuePoints');
            }

            /**
             * A promise to get the current time of the video.
             *
             * @promise GetCurrentTimePromise
             * @fulfill {number} The current time in seconds.
             */
            /**
             * Get the current playback position in seconds.
             *
             * @return {GetCurrentTimePromise}
             */

        }, {
            key: 'getCurrentTime',
            value: function getCurrentTime() {
                return this.get('currentTime');
            }

            /**
             * A promise to set the current time of the video.
             *
             * @promise SetCurrentTimePromise
             * @fulfill {number} The actual current time that was set.
             * @reject {RangeError} the time was less than 0 or greater than the
             *         video’s duration.
             */
            /**
             * Set the current playback position in seconds. If the player was
             * paused, it will remain paused. Likewise, if the player was playing,
             * it will resume playing once the video has buffered.
             *
             * You can provide an accurate time and the player will attempt to seek
             * to as close to that time as possible. The exact time will be the
             * fulfilled value of the promise.
             *
             * @param {number} currentTime
             * @return {SetCurrentTimePromise}
             */

        }, {
            key: 'setCurrentTime',
            value: function setCurrentTime(currentTime) {
                return this.set('currentTime', currentTime);
            }

            /**
             * A promise to get the duration of the video.
             *
             * @promise GetDurationPromise
             * @fulfill {number} The duration in seconds.
             */
            /**
             * Get the duration of the video in seconds. It will be rounded to the
             * nearest second before playback begins, and to the nearest thousandth
             * of a second after playback begins.
             *
             * @return {GetDurationPromise}
             */

        }, {
            key: 'getDuration',
            value: function getDuration() {
                return this.get('duration');
            }

            /**
             * A promise to get the ended state of the video.
             *
             * @promise GetEndedPromise
             * @fulfill {boolean} Whether or not the video has ended.
             */
            /**
             * Get the ended state of the video. The video has ended if
             * `currentTime === duration`.
             *
             * @return {GetEndedPromise}
             */

        }, {
            key: 'getEnded',
            value: function getEnded() {
                return this.get('ended');
            }

            /**
             * A promise to get the loop state of the player.
             *
             * @promise GetLoopPromise
             * @fulfill {boolean} Whether or not the player is set to loop.
             */
            /**
             * Get the loop state of the player.
             *
             * @return {GetLoopPromise}
             */

        }, {
            key: 'getLoop',
            value: function getLoop() {
                return this.get('loop');
            }

            /**
             * A promise to set the loop state of the player.
             *
             * @promise SetLoopPromise
             * @fulfill {boolean} The loop state that was set.
             */
            /**
             * Set the loop state of the player. When set to `true`, the player
             * will start over immediately once playback ends.
             *
             * @param {boolean} loop
             * @return {SetLoopPromise}
             */

        }, {
            key: 'setLoop',
            value: function setLoop(loop) {
                return this.set('loop', loop);
            }

            /**
             * A promise to get the paused state of the player.
             *
             * @promise GetLoopPromise
             * @fulfill {boolean} Whether or not the video is paused.
             */
            /**
             * Get the paused state of the player.
             *
             * @return {GetLoopPromise}
             */

        }, {
            key: 'getPaused',
            value: function getPaused() {
                return this.get('paused');
            }

            /**
             * A promise to get the playback rate of the player.
             *
             * @promise GetPlaybackRatePromise
             * @fulfill {number} The playback rate of the player on a scale from 0.5 to 2.
             */
            /**
             * Get the playback rate of the player on a scale from `0.5` to `2`.
             *
             * @return {GetPlaybackRatePromise}
             */

        }, {
            key: 'getPlaybackRate',
            value: function getPlaybackRate() {
                return this.get('playbackRate');
            }

            /**
             * A promise to set the playbackrate of the player.
             *
             * @promise SetPlaybackRatePromise
             * @fulfill {number} The playback rate was set.
             * @reject {RangeError} The playback rate was less than 0.5 or greater than 2.
             */
            /**
             * Set the playback rate of the player on a scale from `0.5` to `2`. When set
             * via the API, the playback rate will not be synchronized to other
             * players or stored as the viewer's preference.
             *
             * @param {number} playbackRate
             * @return {SetPlaybackRatePromise}
             */

        }, {
            key: 'setPlaybackRate',
            value: function setPlaybackRate(playbackRate) {
                return this.set('playbackRate', playbackRate);
            }

            /**
             * A promise to get the text tracks of a video.
             *
             * @promise GetTextTracksPromise
             * @fulfill {VimeoTextTrack[]} The text tracks associated with the video.
             */
            /**
             * Get an array of the text tracks that exist for the video.
             *
             * @return {GetTextTracksPromise}
             */

        }, {
            key: 'getTextTracks',
            value: function getTextTracks() {
                return this.get('textTracks');
            }

            /**
             * A promise to get the embed code for the video.
             *
             * @promise GetVideoEmbedCodePromise
             * @fulfill {string} The `<iframe>` embed code for the video.
             */
            /**
             * Get the `<iframe>` embed code for the video.
             *
             * @return {GetVideoEmbedCodePromise}
             */

        }, {
            key: 'getVideoEmbedCode',
            value: function getVideoEmbedCode() {
                return this.get('videoEmbedCode');
            }

            /**
             * A promise to get the id of the video.
             *
             * @promise GetVideoIdPromise
             * @fulfill {number} The id of the video.
             */
            /**
             * Get the id of the video.
             *
             * @return {GetVideoIdPromise}
             */

        }, {
            key: 'getVideoId',
            value: function getVideoId() {
                return this.get('videoId');
            }

            /**
             * A promise to get the title of the video.
             *
             * @promise GetVideoTitlePromise
             * @fulfill {number} The title of the video.
             */
            /**
             * Get the title of the video.
             *
             * @return {GetVideoTitlePromise}
             */

        }, {
            key: 'getVideoTitle',
            value: function getVideoTitle() {
                return this.get('videoTitle');
            }

            /**
             * A promise to get the native width of the video.
             *
             * @promise GetVideoWidthPromise
             * @fulfill {number} The native width of the video.
             */
            /**
             * Get the native width of the currently‐playing video. The width of
             * the highest‐resolution available will be used before playback begins.
             *
             * @return {GetVideoWidthPromise}
             */

        }, {
            key: 'getVideoWidth',
            value: function getVideoWidth() {
                return this.get('videoWidth');
            }

            /**
             * A promise to get the native height of the video.
             *
             * @promise GetVideoHeightPromise
             * @fulfill {number} The native height of the video.
             */
            /**
             * Get the native height of the currently‐playing video. The height of
             * the highest‐resolution available will be used before playback begins.
             *
             * @return {GetVideoHeightPromise}
             */

        }, {
            key: 'getVideoHeight',
            value: function getVideoHeight() {
                return this.get('videoHeight');
            }

            /**
             * A promise to get the vimeo.com url for the video.
             *
             * @promise GetVideoUrlPromise
             * @fulfill {number} The vimeo.com url for the video.
             * @reject {PrivacyError} The url isn’t available because of the video’s privacy setting.
             */
            /**
             * Get the vimeo.com url for the video.
             *
             * @return {GetVideoUrlPromise}
             */

        }, {
            key: 'getVideoUrl',
            value: function getVideoUrl() {
                return this.get('videoUrl');
            }

            /**
             * A promise to get the volume level of the player.
             *
             * @promise GetVolumePromise
             * @fulfill {number} The volume level of the player on a scale from 0 to 1.
             */
            /**
             * Get the current volume level of the player on a scale from `0` to `1`.
             *
             * Most mobile devices do not support an independent volume from the
             * system volume. In those cases, this method will always return `1`.
             *
             * @return {GetVolumePromise}
             */

        }, {
            key: 'getVolume',
            value: function getVolume() {
                return this.get('volume');
            }

            /**
             * A promise to set the volume level of the player.
             *
             * @promise SetVolumePromise
             * @fulfill {number} The volume was set.
             * @reject {RangeError} The volume was less than 0 or greater than 1.
             */
            /**
             * Set the volume of the player on a scale from `0` to `1`. When set
             * via the API, the volume level will not be synchronized to other
             * players or stored as the viewer’s preference.
             *
             * Most mobile devices do not support setting the volume. An error will
             * *not* be triggered in that situation.
             *
             * @param {number} volume
             * @return {SetVolumePromise}
             */

        }, {
            key: 'setVolume',
            value: function setVolume(volume) {
                return this.set('volume', volume);
            }
        }]);

        return Player;
    }();

    if (!isNode) {
        initializeEmbeds();
        resizeEmbeds();
    }

    return Player;

})));// require -->  src/js/vendor/vimeo.player.js
;
(function ($, window, document, undefined) {
    'use strict';

    var $document = $(document),
        $window = $(window);

    // Namespace
    window.ContentElements = window.ContentElements || {};

    // Make sure the Vimeo Video Player is here
    if (!(typeof Vimeo === 'object' && typeof Vimeo.Player !== 'undefined'))
    {
        console.warn('WE NEED THE VIMEO PLAYER HERE');
    }

    // Backbone Module
    window.ContentElements.VideoVimeo = Backbone.View.extend({

        events: {
            "click .ce-001__poster": "_onPosterClick",
            "playMe": "_onExternalPlay",
            "pauseMe": "_onExternalPause"
        },

        vimeoPlayer: undefined,
        vimeoPlayerOptions: undefined,
        vimeoTransferEvents: [
            'play',
            'pause',
            'ended',
            // 'timeupdate',
            // 'progress',
            // 'seeked',
            // 'texttrackchange',
            // 'cuechange',
            // 'cuepoint',
            'volumechange',
            // 'playbackratechange',
            'bufferstart',
            'bufferend',
            'error',
            'loaded'
        ],


        initialize: function (options) {
            this.settings = _.extend(
                _.omit(this.$el.data(), 'lazy'),
                options.settings
            );

            this.model = new window.ContentElements.VideoVimeoModel();
            this.model.on('change', this._onOEmbedDataUpdate, this);
            this.model.on('error', this._onOEmbedDataError, this);

            this._parseVimeoPlayerOptions();

            this._getOEmbedData();
        },

        render: function () {
            this._generateVimeoPlayer(this.vimeoPlayerOptions);
        },

        _parseVimeoPlayerOptions: function () {

            this.vimeoPlayerOptions = {};

            // THE VIDEO SOURCE
            // - Required. (Either the id or) the url of the video.
            this.vimeoPlayerOptions.url = this.settings.src;

            // AUTOPLAY
            // - Automatically start playback of the video. Note that this won’t work on some devices.
            if (typeof this.settings.autoplay === 'undefined')
            {
                this.settings.autoplay = /\?.*autoplay=(1|true)/im.test(this.settings.src);
            }
            this.vimeoPlayerOptions.autoplay = this.settings.autoplay === true;
            /*
            // DEBUG: STOP AUTOPLAY
            this.vimeoPlayerOptions.autoplay = false;
            //*/

            // AUTOPAUSE
            // - Pause this video automatically when another one plays.
            this.vimeoPlayerOptions.autopause = this.settings.autopause !== false;
        },

        _getOEmbedData: function () {
            this.model.fetch({
                url: 'https://vimeo.com/api/oembed.json?url=' + encodeURIComponent(this.settings.src)
            });
        },

        _setupSize: function () {
            var oWidth,
                oHeight,
                oRatio;

            oWidth = this.model.get('width');
            oHeight = this.model.get('height');
            oRatio = oHeight / oWidth;
            this.$el.css('paddingTop', (oRatio * 100) + '%');
            this.$poster.css('paddingTop', (oRatio * 100) + '%');
        },

        _setupVideoPoster: function () {
            var template;

            template = _.template(
                '<div class="ce-001__poster">' +
                ' <img src="<%= posterImage %>" alt="<%= title %>"/>' +
                ' <span class="ce-001__button"></span>' +
                '</div>'
            );

            this.$poster = $(
                template(
                    _.extend(
                        this.model.toJSON(),
                        {}
                    )
                )
            );

            this.$el.append(this.$poster);
        },

        _showVideoPoster: function () {
            this.$poster.show();
        },

        _hideVideoPoster: function () {
            this.$poster.hide();

        },

        _generateVimeoPlayer: function (options) {
            this.vimeoPlayer = new Vimeo.Player(
                this.$el,
                options
            );

            // Internal Events
            this.vimeoPlayer.on('play', _.bind(this._onPlay, this));
            this.vimeoPlayer.on('progress', _.bind(this._onProgress, this));
            this.vimeoPlayer.on('pause', _.bind(this._onPause, this));
            this.vimeoPlayer.on('ended', _.bind(this._onEnded, this));

            // Transfer Events
            _.each(this.vimeoTransferEvents, this._transferEventListener, this);

        },

        /**
         * Set a listener to the Vimeo Player and transfer it with included eventName to trigger on the element container
         * @param eventName
         * @private
         */
        _transferEventListener: function (eventName) {
            this.vimeoPlayer.on(eventName, _.bind(
                function (e, d) {
                    this.$el.trigger(e, d);
                },
                this,
                eventName
            ));
        },

        // region LISTENER
        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
        _play: function () {
            this.vimeoPlayer && this.vimeoPlayer.play(); // be carefull Promise
        },

        _pause: function () {
            this.vimeoPlayer && this.vimeoPlayer.pause(); // be carefull Promise
        },

        // endregion

        // region LISTENER
        // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

        _onOEmbedDataUpdate: function (data) {
            this._setupVideoPoster();
            this._setupSize();
            this.render();
        },

        _onOEmbedDataError: function () {
            this.render(); // Render anyway
        },

        _onPosterClick: function () {
            this._play();
        },

        _onPlay: function () {
            // Only use once because of missed play event
            this.vimeoPlayer.off('progress');
            this._hideVideoPoster();
        },

        _onProgress: function () {
            this._onPlay().apply(this, arguments);
        },

        _onPause: function () {
            //this._hideVideoPoster();
        },

        _onEnded: function () {
            this._showVideoPoster();
        },

        _onExternalPlay: function () {
            this._play();
        },

        _onExternalPause: function () {
            this._pause();
        },

        destroy: function () {
            this.$poster.remove();
            this.vimeoPlayer.destroy();
            this.vimeoPlayer = undefined;
            this.model.off();
            this.model = undefined;
            this.$el.data('vimeoInitialized', '');
            this.$el.removeAttr('data-vimeo-initialized');
            this.$el.html('');
        }

        // endregion
    });

    window.ContentElements.VideoVimeoModel = Backbone.Model.extend({

        parse: function (response, options) {
            if (typeof response === 'object')
            {
                response.posterImage = this._generatePosterImage(
                    response['thumbnail_url'],
                    response['thumbnail_width'],
                    response['thumbnail_height']
                );
            }
            return response;
        },

        _generatePosterImage: function (src, oWidth, oHeight) {
            var ratio = oHeight / oWidth,
                windowWidth = $window.width(),
                imageWidth = oWidth,
                imageWidths = [
                    640,
                    768,
                    1024,
                    1440,
                    1600,
                    1920
                ],
                i;

            for (i = 0; i < imageWidths.length; i++)
            {
                if (windowWidth > imageWidths[i])
                {
                    imageWidth = imageWidths[i];
                } else
                {
                    break;
                }
            }

            src = src.replace(new RegExp('_' + oWidth), '_' + imageWidth);
            src = src.replace(new RegExp('x' + oHeight), 'x' + (imageWidth * ratio));

            return src;
        }

    });
})(jQuery, this, this.document);this["PCOM"] = this["PCOM"] || {};
this["PCOM"]["Templates"] = this["PCOM"]["Templates"] || {};
this["PCOM"]["Templates"]["modules"] = this["PCOM"]["Templates"]["modules"] || {};
this["PCOM"]["Templates"]["modules"]["arax-modules"] = this["PCOM"]["Templates"]["modules"]["arax-modules"] || {};
this["PCOM"]["Templates"]["modules"]["arax-modules"]["com-2017-03-PCGB-finance-calculator"] = this["PCOM"]["Templates"]["modules"]["arax-modules"]["com-2017-03-PCGB-finance-calculator"] || {};

this["PCOM"]["Templates"]["modules"]["arax-modules"]["com-2017-03-PCGB-finance-calculator"]["PCGBFinanceCalculator"] = Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data) {
    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3=container.escapeExpression, alias4="function";

  return "<!--\r\n    Document    : PCGBFinanceCalculator.hbs\r\n    Created on  : 3/8/2017, 9:07 AM\r\n    Author      : Holger Szuesz <holger.szuesz@udg.de>\r\n    Description :\r\n        Main handlebars template for finance calculator\r\n-->\r\n\r\n<div class=\"b-full-width arax finance-calculator\">\r\n\r\n    <h2 class=\"b-module-lined-headline\">\r\n        <span>"
    + alias3((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"headline",{"name":"gettext","hash":{},"data":data}))
    + "</span>\r\n    </h2>\r\n\r\n    <div class=\"introtext\">\r\n        <div class=\"left\">"
    + ((stack1 = ((helper = (helper = helpers.introtext || (depth0 != null ? depth0.introtext : depth0)) != null ? helper : alias2),(typeof helper === alias4 ? helper.call(alias1,{"name":"introtext","hash":{},"data":data}) : helper))) != null ? stack1 : "")
    + "</div>\r\n        <div class=\"right\">"
    + ((stack1 = ((helper = (helper = helpers.introtext2 || (depth0 != null ? depth0.introtext2 : depth0)) != null ? helper : alias2),(typeof helper === alias4 ? helper.call(alias1,{"name":"introtext2","hash":{},"data":data}) : helper))) != null ? stack1 : "")
    + "</div>\r\n        <br clear=\"all\" />\r\n    </div>\r\n\r\n    <div class=\"sliderContainer\">\r\n\r\n    </div>\r\n\r\n    <div class=\"btnContainer\">\r\n\r\n        <a href=\"#\" class=\"gui-btn gui-link-with-article applyChanges\" style=\"float: right; margin-top: 30px;\">\r\n            <span>"
    + alias3((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"btnApplyChanges",{"name":"gettext","hash":{},"data":data}))
    + "</span>\r\n        </a>\r\n\r\n    </div>\r\n\r\n    <div class=\"resultContainer\"></div>\r\n\r\n    <div class=\"errorContainer\">\r\n        "
    + ((stack1 = (helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"errorMessage",{"name":"gettext","hash":{},"data":data})) != null ? stack1 : "")
    + "\r\n    </div>\r\n\r\n</div>";
},"useData":true});

this["PCOM"]["Templates"]["modules"]["arax-modules"]["com-2017-03-PCGB-finance-calculator"]["Result"] = Handlebars.template({"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data) {
    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3="function", alias4=container.escapeExpression, alias5=container.lambda;

  return "<!--\r\n    Document    : Result.hbs\r\n    Created on  : 3/9/2017, 12:26 PM\r\n    Author      : Holger Szuesz <holger.szuesz@udg.de>\r\n    Description :\r\n        Handlebars template to display the result table\r\n-->\r\n<h3>"
    + ((stack1 = ((helper = (helper = helpers.introprint || (depth0 != null ? depth0.introprint : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{"name":"introprint","hash":{},"data":data}) : helper))) != null ? stack1 : "")
    + "</h3>\r\n\r\n<br />\r\n\r\n<div class=\"tables\">\r\n\r\n    <div class=\"table\">\r\n        <div class=\"row\">\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"dur_lbl",((stack1 = (depth0 != null ? depth0.dur : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"dur_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.dur : depth0)) != null ? stack1.val : stack1), depth0))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"dur_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"mpay_lbl",((stack1 = (depth0 != null ? depth0.mpay : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"mpay_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.mpay : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"mpay_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"depo_lbl",((stack1 = (depth0 != null ? depth0.depo : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"depo_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.depo : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"depo_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"anm_lbl",((stack1 = (depth0 != null ? depth0.anm : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"anm_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.anm : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"anm_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"table\">\r\n        <div class=\"row\">\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"rotrp_lbl",((stack1 = (depth0 != null ? depth0.rotrp : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"rotrp_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.rotrp : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"rotrp_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"tac_lbl",((stack1 = (depth0 != null ? depth0.tac : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"tac_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.tac : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"tac_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"ofp_lbl",((stack1 = (depth0 != null ? depth0.ofp : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"ofp_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.ofp : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"ofp_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n        </div>\r\n        <div class=\"row\">\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"tap_lbl",((stack1 = (depth0 != null ? depth0.tap : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"tap_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.tap : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"tap_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n        </div>\r\n    </div>\r\n\r\n    <div class=\"table\">\r\n        <div class=\"subtable\">\r\n            <div class=\"row\">\r\n                <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"opf_lbl",((stack1 = (depth0 != null ? depth0.opf : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n                <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"opf_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.opf : depth0)) != null ? stack1.val : stack1), depth0))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"opf_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            </div>\r\n            <div class=\"row\">\r\n                <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"roi_lbl",((stack1 = (depth0 != null ? depth0.roi : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n                <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"roi_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.roi : depth0)) != null ? stack1.val : stack1), depth0))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"roi_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            </div>\r\n        </div>\r\n        <div class=\"subtable\">\r\n            <div class=\"row\">\r\n                <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"rapr_lbl",((stack1 = (depth0 != null ? depth0.rapr : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n                <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"rapr_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.rapr : depth0)) != null ? stack1.val : stack1), depth0))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"rapr_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            </div>\r\n            <div class=\"row\">\r\n                <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"emc_lbl",((stack1 = (depth0 != null ? depth0.emc : depth0)) != null ? stack1.lbl : stack1),{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n                <div class=\"col\">"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"emc_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.emc : depth0)) != null ? stack1.val : stack1), depth0))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"emc_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n\r\n<form id=\"contactCenterForm\" action=\""
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"form_url_ref",{"name":"gettext","hash":{},"data":data}))
    + "\" method=\"post\">\r\n    <input type=\"hidden\" id=\"iccdatacheck\" name=\"iccdatacheck\" value=\"1\" />\r\n    <input type=\"hidden\" id=\"formdata_modelname\" name=\"formdata_modelname\" value=\""
    + alias4(((helper = (helper = helpers.model || (depth0 != null ? depth0.model : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{"name":"model","hash":{},"data":data}) : helper)))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_dur\" name=\"formdata_dur\" value=\""
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.dur : depth0)) != null ? stack1.val : stack1), depth0))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_mpay\" name=\"formdata_mpay\" value=\""
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.mpay : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_depo\" name=\"formdata_depo\" value=\""
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.depo : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_anm\" name=\"formdata_anm\" value=\""
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.anm : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_rotrp\" name=\"formdata_rotrp\" value=\""
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.rotrp : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_tac\" name=\"formdata_tac\" value=\""
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.tac : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_ofp\" name=\"formdata_ofp\" value=\""
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.ofp : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_tap\" name=\"formdata_tap\" value=\""
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.tap : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_opf\" name=\"formdata_opf\" value=\""
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.opf : depth0)) != null ? stack1.val : stack1), depth0))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_roi\" name=\"formdata_roi\" value=\""
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.roi : depth0)) != null ? stack1.val : stack1), depth0))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_rapr\" name=\"formdata_rapr\" value=\""
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.rapr : depth0)) != null ? stack1.val : stack1), depth0))
    + "\" />\r\n    <input type=\"hidden\" id=\"formdata_emc\" name=\"formdata_emc\" value=\""
    + alias4(alias5(((stack1 = (depth0 != null ? depth0.emc : depth0)) != null ? stack1.val : stack1), depth0))
    + "\" />\r\n</form>\r\n\r\n<div class=\"afterTables\">\r\n    <div class=\"summary\">\r\n        <div>\r\n            "
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"lblMonthlyPay",{"name":"gettext","hash":{},"data":data}))
    + "\r\n            <br/>&nbsp;<br />\r\n            <span>"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"mpay_prefix",{"name":"gettext","hash":{},"data":data}))
    + alias4((helpers.numberFormat || (depth0 && depth0.numberFormat) || alias2).call(alias1,((stack1 = (depth0 != null ? depth0.mpay : depth0)) != null ? stack1.val : stack1),{"name":"numberFormat","hash":{},"data":data}))
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"mpay_postfix",{"name":"gettext","hash":{},"data":data}))
    + "</span>\r\n        </div>\r\n        <div>\r\n            <a href=\"#\" id=\"btnContactCenter\" class=\"gui-btn gui-link-with-article\" style=\"margin-top: 50px; float: right;\"><span>"
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"btnContact",{"name":"gettext","hash":{},"data":data}))
    + "</span></a>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<div class=\"PCGBFC_disclaimer\">\r\n    "
    + alias4((helpers.gettext || (depth0 && depth0.gettext) || alias2).call(alias1,"udg_disclaimer",{"name":"gettext","hash":{},"data":data}))
    + "\r\n    <br>&nbsp;<br/>\r\n    "
    + ((stack1 = ((helper = (helper = helpers.disclaimer || (depth0 != null ? depth0.disclaimer : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{"name":"disclaimer","hash":{},"data":data}) : helper))) != null ? stack1 : "")
    + "\r\n</div>";
},"useData":true});

this["PCOM"]["Templates"]["modules"]["arax-modules"]["com-2017-03-PCGB-finance-calculator"]["Slider"] = Handlebars.template({"1":function(container,depth0,helpers,partials,data) {
    var helper;

  return " | Value: "
    + container.escapeExpression(((helper = (helper = helpers.printValue || (depth0 != null ? depth0.printValue : depth0)) != null ? helper : helpers.helperMissing),(typeof helper === "function" ? helper.call(depth0 != null ? depth0 : (container.nullContext || {}),{"name":"printValue","hash":{},"data":data}) : helper)));
},"3":function(container,depth0,helpers,partials,data) {
    return "        <div class=\"printValue\">"
    + container.escapeExpression(container.lambda(depth0, depth0))
    + "</div>\r\n";
},"compiler":[7,">= 4.0.0"],"main":function(container,depth0,helpers,partials,data) {
    var stack1, helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=helpers.helperMissing, alias3="function", alias4=container.escapeExpression;

  return "<!--\r\n    Document    : Slider.hbs\r\n    Created on  : 3/8/2017, 9:40 AM\r\n    Author      : Holger Szuesz <holger.szuesz@udg.de>\r\n    Description :\r\n        Handlebars template for slider\r\n        "
    + ((stack1 = helpers["if"].call(alias1,(depth0 != null ? depth0.printValue : depth0),{"name":"if","hash":{},"fn":container.program(1, data, 0),"inverse":container.noop,"data":data})) != null ? stack1 : "")
    + "\r\n-->\r\n\r\n<div class=\"slider-header\">\r\n    "
    + alias4(((helper = (helper = helpers.label || (depth0 != null ? depth0.label : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{"name":"label","hash":{},"data":data}) : helper)))
    + "\r\n    <span>"
    + alias4(((helper = (helper = helpers.sublabel || (depth0 != null ? depth0.sublabel : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{"name":"sublabel","hash":{},"data":data}) : helper)))
    + "</span>\r\n</div>\r\n\r\n<div class=\"slider-context\"></div>\r\n\r\n<div class=\"legend\">\r\n"
    + ((stack1 = helpers.each.call(alias1,((stack1 = (depth0 != null ? depth0.config : depth0)) != null ? stack1.printValues : stack1),{"name":"each","hash":{},"fn":container.program(3, data, 0),"inverse":container.noop,"data":data})) != null ? stack1 : "")
    + "</div>\r\n\r\n<div class=\"slider\"></div>";
},"useData":true});/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/8/2017.
 */

var PCGBFinanceCalculatorModel = Backbone.Model.extend({
    defaults: {
        model: '',
        introtext: '',
        app: undefined
    },

    initialize: function(attributes, options) {
        

        if ($('.m-65-data-value').length > 0) {
            this.set('model', $($('.m-65-data-value')[0]).text());
        } else if ($('.m-21-scn-modules-item-current').length > 0) {
            this.attributes.model = $('.m-21-scn-modules-item-current').text();
        } else if ($('.m-080__headline.claim-part-1').length > 0) {
            this.attributes.model = $('.m-080__headline.claim-part-1').text().replace('The ', '');
        } else {
            console.warn('PCGBFinanceCalculatorModel | initialize | No model name found...');
        }

        var introtext = this.get('app').collections.textCollection.get('introtext').get('value');
        var introtext2 = this.get('app').collections.textCollection.get('introtext-2').get('value');

        this.set('introtext', introtext.replace('##MODEL##', this.get('model')));
        this.set('introtext2', introtext2);
    },

    update: function() {
        

        var app = this.get('app');

        if (app.isReady) {
            app.update();
        } else {
            
        }
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/10/2017.
 */

var ResultModel = Backbone.Model.extend({
    defaults: {
        intro: 'Solutions Personal Contract Plan* representative example for Porsche ##MODEL## subject<br />to a ##PERIOD##, ##MILES## per annum agreement',
        introprint: '',
        disclaimer: '',
        model: 'Not defined',
        dur: {
            lbl: 'Duration',
            val: '12 months'
        },
        mpay: {
            lbl: '35 monthly payments',
            val: '£580.60'
        },
        depo: {
            lbl: 'Deposit',
            val: '£17,500.00'
        },
        anm: {
            lbl: 'Annual mileage',
            val: '25,000'
        },
        rotrp: {
            lbl: 'ROTRP',
            val: '£76,967.00'
        },
        tac: {
            lbl: 'Total amount credit',
            val: '£86,530.85'
        },
        ofp: {
            lbl: 'Optional final payment',
            val: '£42,011.85'
        },
        tap: {
            lbl: 'Total amount payable',
            val: '£86,530.85'
        },
        opf: {
            lbl: 'Option to purchase fee',
            val: '£ 10.00'
        },
        roi: {
            lbl: 'Rate of interest',
            val: '6.6% Fixed'
        },
        rapr: {
            lbl: 'Rep APR',
            val: '6.6% APR'
        },
        emc: {
            lbl: 'Excess mileage charge',
            val: '33.9p per mile'
        }
    },

    initialize: function(attributes, options) {
        

        if ($('.m-65-data-value').length > 0) {
            this.set('model', $($('.m-65-data-value')[0]).text());
        } else if ($('.m-21-scn-modules-item-current').length > 0) {
            this.attributes.model = $('.m-21-scn-modules-item-current').text();
        } else if ($('.m-080__headline.claim-part-1').length > 0) {
            this.attributes.model = $('.m-080__headline.claim-part-1').text().replace('The ', '');
        } else {
            console.warn('PCGBFinanceCalculatorModel | initialize | No model name found...');
        }

        this.listenTo(this, 'change',  this.onChange);
    },

    onChange: function() {
        

        var intro = this.get('intro').replace('##MODEL##', this.get('model')).replace('##PERIOD##', this.get('dur').val).replace('##MILES##', this.get('anm').val);

        this.attributes.introprint = intro;
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/8/2017.
 */

var SliderModel = Backbone.Model.extend({
    defaults: {
        label: 'DEFAULT: Label',
        sublabel: 'DEFAULT: sublabel',
        printValue: undefined,
        normFactor: 1,
        config: {
            printValues: [],
            percentOf: undefined,
            value: 0,
            max: 1
        }
    },

    initialize: function(attributes, options) {
        

        if (_.isUndefined(this.get('config').percentOf)) {
            this.set('printValue', attributes.config.printValues[attributes.config.value]);
        } else {
            this.set('printValue', this.get('config').percentOf * attributes.config.printValues[attributes.config.value]);
        }
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/29/2017.
 */

var TextModel = Backbone.Model.extend({
    defaults: {
        id: undefined,
        value: undefined
    },

    initialize: function(attributes, options) {
        
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/8/2017.
 */

var SliderCollection = Backbone.Collection.extend({
    model: SliderModel,

    initialize: function(attributes, options) {
        
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/29/2017.
 */

var TextCollection = Backbone.Collection.extend({
    model: TextModel,

    initialize: function(attributes, options) {
        
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/9/2017.
 */

/**
 * PCGBFinanceCalculator base class
 *
 * @class
 * @constructor
 */
var PCGBFinanceCalculator = function(conf, sliders, textlist) {
    

    this.defaultConf = {
        runtime: 'PROD',
        initRoot: '/apps/PCGBFinanceCalculator/VWFS/data.asmx/GetJSONCalculation',
        initMethod: 'POST',
        updateRoot: '/apps/PCGBFinanceCalculator/VWFS/data.asmx/GetJSONCalculationUpdate',
        updateMethod: 'POST'
    };

    this.conf = _.extend({}, this.defaultConf, conf);

    this.collections = {
        sliderCollection: new SliderCollection(sliders),
        textCollection: new TextCollection(textlist)
    };

    this.models = {
        PCGBFCModel: new PCGBFinanceCalculatorModel({
            app: this
        }),
        ResultModel: new ResultModel({
            intro: (this.collections.textCollection.get('resultIntroText')).get('value')
        })
    };

    /**
     * Handlebars gettext helper to get text from textCollection filled by textlist from PS5
     */
    Handlebars.registerHelper('gettext', (function(textCollection) {
        return function(id ,fallback) {
            

            var text = textCollection.get(id);

            if (_.isUndefined(text)) {
                console.warn('Handlebars.Helper | gettext | no text found for id | ', id);

                if (!_.isString(fallback)) {
                    console.warn('Handlebars.Helper | gettext | no fallback found for id | ', id);

                    return '';
                }

                return fallback;
            }

            return text.get('value');
        };
    }(this.collections.textCollection)));

    Handlebars.registerHelper('numberFormat', (function() {
        return function(number) {
            

            var nfo = Intl.NumberFormat(['en-GB'], {
                minimumFractionDigits: 2
            });

            return nfo.format(number);
        };
    }()));

    this.views = {
        PCGBFCView: new PCGBFinanceCalculatorView({
            model: this.models.PCGBFCModel,
            el: this.conf.el
        }),
        SliderContainerView: new SliderContainerView({
            collection: this.collections.sliderCollection
        }),
        ResultView: new ResultView({
            model: this.models.ResultModel
        })
    };

    this.isReady = false;
    this.cache = [];

    

    this.run = function() {
        

        this.views.SliderContainerView.render();

        $.ajax({
            url: this.conf.initRoot,
            method: this.conf.initMethod,
            data: this.conf.fetchData,
            dataType: 'json'
        }).done(_.bind(function(data, status, xhr) {
            

            this.views.PCGBFCView.doShowResultContainer();

            this.conf.fetchData.product = data.conf.product;
            this.models.ResultModel.set(data.details);

            this.isReady = true;
        }, this)).fail(_.bind(function(xhr, status, err) {
            

            this.views.PCGBFCView.doHideResultContainer();
        }, this));

        return this;
    };

    this.update = function() {
        

        var perSlider = this.collections.sliderCollection.get('PER');
        var depSlider = this.collections.sliderCollection.get('DEP');
        var anmSlider = this.collections.sliderCollection.get('ANM');

        var data = {
            code: this.conf.fetchData.code,
            price: this.conf.fetchData.price,
            product: this.conf.fetchData.product,
            periods: perSlider.get('printValue') / perSlider.get('normFactor'),
            deposit: depSlider.get('printValue') / depSlider.get('normFactor'),
            mileage: anmSlider.get('printValue') / anmSlider.get('normFactor')
        };

        var cacheID = 'cache_' + data.periods + '_' + data.deposit + '_' + data.mileage;

        if (_.isUndefined(this.cache[cacheID])) {
            $.ajax({
                url: this.conf.updateRoot,
                method: this.conf.updateMethod,
                data: data,
                dataType: 'json'
            }).done(_.bind(function(data, status, xhr) {
                

                this.views.PCGBFCView.doShowResultContainer();

                this.models.ResultModel.set(data.details);

                var perSlider = this.collections.sliderCollection.get('PER');
                var depSlider = this.collections.sliderCollection.get('DEP');
                var anmSlider = this.collections.sliderCollection.get('ANM');

                var cacheID = 'cache_' + (perSlider.get('printValue') / perSlider.get('normFactor')) + '_' + (depSlider.get('printValue') / depSlider.get('normFactor')) + '_' + (anmSlider.get('printValue') / anmSlider.get('normFactor'));

                this.cache[cacheID] = data;
            }, this)).fail(_.bind(function(xhr, status, err) {
                

                this.views.PCGBFCView.doHideResultContainer();
            }, this));
        } else {
            this.models.ResultModel.set(this.cache[cacheID].details);

            this.views.PCGBFCView.doShowResultContainer();
        }

        return this;
    };
};
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/8/2017.
 */

var PCGBFinanceCalculatorView = Backbone.View.extend({
    model: PCGBFinanceCalculatorModel,
    template: PCOM.Templates.modules['arax-modules']['com-2017-03-PCGB-finance-calculator'].PCGBFinanceCalculator,

    events: {
        'click .applyChanges': 'onApplyChanges'
    },

    $resultContainer: undefined,
    $errorContainer: undefined,

    initialize: function(options) {
        

        this.listenTo(this.model, 'change', this.render);

        this.render();
    },

    render: function() {
        

        this.$el.html(this.template(this.model.toJSON()));

        this.$resultContainer = this.$el.find('.resultContainer');
        this.$errorContainer = this.$el.find('.errorContainer');

        return this;
    },

    onApplyChanges: function(e) {
        

        e.preventDefault();

        this.model.update();
    },
    
    doHideResultContainer: function() {
        this.$resultContainer.hide();
        this.$errorContainer.show();
    },

    doShowResultContainer: function() {
        this.$resultContainer.show();
        this.$errorContainer.hide();
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/10/2017.
 */

var ResultView = Backbone.View.extend({
    model: ResultModel,
    template: PCOM.Templates.modules['arax-modules']['com-2017-03-PCGB-finance-calculator'].Result,

    el: '.resultContainer',

    events: {
        'click #btnContactCenter': 'onClickContact'
    },

    initialize: function(options) {
        

        this.listenTo(this.model, 'change', this.render);
    },

    render: function() {
        

        this.$el.html(this.template(this.model.toJSON()));

        return this;
    },

    onClickContact: function(e) {
        

        this.$el.find('#contactCenterForm').submit();
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/8/2017.
 */

var SliderContainerView = Backbone.View.extend({
    collection: undefined,
    el: 'div.sliderContainer',

    events: {},

    initialize: function(options) {
        

        this.listenTo(this.collection, 'update', this.render);
    },

    render: function() {
        

        _.each(this.collection.models, function(slider) {
            var slider = new SliderView({
                model: slider
            }).render();

            this.$el.append(slider.$el);
        }, this);
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/8/2017.
 */

var SliderView = Backbone.View.extend({
    model: SliderModel,
    template: PCOM.Templates.modules['arax-modules']['com-2017-03-PCGB-finance-calculator'].Slider,
    tagName: 'div',
    className: 'sliderModule',
    $slider: undefined,

    events: {
        'slidechange .slider': 'onSlideChange'
    },

    initialize: function(options) {
        

        // this.listenTo(this.model, 'change', this.render);
    },

    render: function() {
        

        this.$el.html(this.template(this.model.toJSON()));

        this.$slider = $(this.$el.find('.slider')[0]);

        this.$slider.financeCalculatorSlider(this.model.get('config'));

        return this;
    },

    onSlideChange: function(event, ui) {
        

        var SliderConf = this.model.get('config');

        SliderConf.value = ui.value;

        this.model.set('config', SliderConf);

        if (_.isUndefined(SliderConf.printValues)) {
            this.model.set('printValue', ui.value);
        } else {
            if (_.isUndefined(SliderConf.percentOf)) {
                this.model.set('printValue', SliderConf.printValues[ui.value]);
            } else {
                this.model.set('printValue', SliderConf.percentOf * SliderConf.printValues[ui.value]);
            }
        }

        this.render();
    }
});
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 3/8/2017.
 */

$.fn.financeCalculatorSlider = (function() {
    var defaults = {
        range: false,
        min: 0,
        max: 10,
        step: 1
    };

    return function(options) {
        

        options = $.extend({}, defaults, options);

        

        this.each(function(i) {
            

            $(this).slider(options);

            var $dots = $($(this).append('<div class="sliderDots"></div>').find('.sliderDots')[0]);

            if (!_.isUndefined(options.printValues) && options.printValues.length > 0) {
                for (var n = 0; n < options.printValues.length; n += 1) {
                    $dots.append('<div class="sliderDot"><div class="inner"></div></div>');
                }
            }
        });
    };
}());
/* Script für die besondere Behandlung von nicht dragbaren Elementen.
 * IE9 Fallback: Bekommen unselectable Attribut gesetzt
 * FF Bugfix: dragstart abfangen
 */
;(function( $,  window, document, undefined) {
    'use strict';
    $(document).ready(function(){

        var notDraggableClass = '.b-not-draggable',
            isIE9 = ($('html.ie9').length > 0);

        if (isIE9) {

            $(notDraggableClass).attr('unselectable', 'on');

        } else if (navigator.userAgent.toLowerCase().indexOf('firefox') != -1 || navigator.userAgent.toLowerCase().indexOf('msie') != -1) {

            // Fix for FF an IE 10
            $(notDraggableClass).each(function(index, element) {
                $(this).on('dragstart', function() { return false; } );
            });

        }
    });

})(jQuery, this,this.document);
// ---------------------------------------------
// UDG/BBK Corporate Website - Accordion Script
//
// Copyright(C) Bassier, Bergmann & Kindler
// ---------------------------------------------

/**
 *
 */
!function($, window, document, undefined) {

    "use strict";


    // "Private Vars"
    // -------------
    var eventNamespace = '.orinocoaccordions'
      , clickEventType  = 'click' + eventNamespace;


    // ================
    // XY CLASS DEFINITION
    // ================

    var Accordion = function (element, options) {

        this.$element = $(element);
        this.options = options;

        initialize.call(this);
    };




    // Public API
    // ----------

    Accordion.prototype = {

    };



    // Private API
    // -----------

    function initialize() {
        // jquery live is deprecated since 1.7+
        this.$element.find(this.options.accordionLinkSelector).on(clickEventType, $.proxy(displayAccordionContent, this));
    }

    // If the option is a number check if the window is smaller than the number option
    function isOptionEnabledForBreakpoint(currentOption) {

        var optionEnabled = currentOption;

        if ((typeof optionEnabled) == 'number') {

            optionEnabled = ($(window).width() < optionEnabled);
        }

        return optionEnabled;
    }


    function displayAccordionContent(event) {

        // only react on small view
        var winWidth = $(window).width();

        if (winWidth < this.options.breakpoint || this.options.ignoreBreakpoints) {

            var $target          = $(event.target)
              , targetIndex      = $(this.$element).find(this.options.accordionLinkSelector).index($target)
              , targetParent     = $target.parent()
              , targetId         = event.target.id;

            // Check if the clicked element has the class of defined accordionLinkSelector
            if (this.options.checkEventClass) {

                if (!$target.hasClass(this.options.accordionLinkSelector.substring(1, this.options.accordionLinkSelector.length))) {

                    $target = $target.parent(this.options.accordionLinkSelector);
                    targetIndex      = $(this.$element).find(this.options.accordionLinkSelector).index($target);
                    targetParent     = $target.parent();
                    targetId         = $target.attr('id');
                }
            }

            // check alwaysToggleActiveState option if it is a boolean or a number
            var toggleActiveState = isOptionEnabledForBreakpoint(this.options.alwaysToggleActiveState);

            // close all open accordions
            if (this.options.closeOpenAccordions) {

                if (toggleActiveState) {

                   var hadClass = $target.hasClass(this.options.accordionHeadlineActiveClass);

                   removeDisplayClass.call(this, targetIndex);

                   if (hadClass) {

                       $target.addClass(this.options.accordionHeadlineActiveClass);
                   }

                } else {
                    if (!$target.hasClass(this.options.accordionHeadlineActiveClass)) {
                        removeDisplayClass.call(this, targetIndex);
                    }
                }
            }

            // toggle the active class for special services
            if (toggleActiveState) {

                handleAccordionEvent.call(this, $target, targetId);

            } else {

                if (!$target.hasClass(this.options.accordionHeadlineActiveClass)) {

                    handleAccordionEvent.call(this, $target, targetId);
                }
            }
        }

        event.preventDefault();
        event.stopPropagation();

        return false;
    }

    function removeDisplayClass(targetIndex) {

        // SLIDE ANIMATION
        var slideAnimation = isOptionEnabledForBreakpoint(this.options.slideAnimation)
           , slideDuration = this.options.slideDuration
           , self = this;


        this.$element.find(this.options.accordionContent).filter(function(index) {
                return (index != targetIndex);
            }).each(function(index, element) {

                var elem = $(element)
                   , hadClass = elem.hasClass(self.options.accordionContentActiveClass);

                // check if the slide animation has to start
                // Close it
                if (slideAnimation && hadClass) {

                    elem.css({ height: curHeight, overflow: 'hidden' });
                    var curHeight  = elem.height(),
                        zeroHeight = 0;

                        if (self.options.withGPAnimate) {

                            elem.height(curHeight);
                            window.setTimeout(function() {
                                elem.gpAnimate({height: zeroHeight},
                                                        self.options.slideDuration,
                                                        "cubic-bezier(0.645, 0.045, 0.355, 1.000)",
                                                        function() {
                                                            elem.removeAttr('style');
                                                            elem.removeClass(self.options.accordionContentActiveClass);
                                                        });
                            }, 0);

                        } else {
                            elem.height(curHeight).animate(
                                                    {height: zeroHeight},
                                                    self.options.slideDuration,
                                                    function() {
                                                        elem.removeAttr('style');
                                                        elem.removeClass(self.options.accordionContentActiveClass);
                                                    });
                        }
                } else {
                    elem.removeClass(self.options.accordionContentActiveClass);
                }
            });

            $(this.$element).find(self.options.accordionLinkSelector).removeClass(self.options.accordionHeadlineActiveClass);

    }

    function handleAccordionEvent(target, targetId) {


        target.toggleClass(this.options.accordionHeadlineActiveClass);
        // get the content element of the parent - if the clicked headline has an id
        if (targetId) {
            var targetContentId = targetId + this.options.contentSuffix;

            // find the corresponding content
            var content = this.$element.find('#' + targetContentId),
            self = this;

            if (content) {


                // SLIDE ANIMATION
                var slideAnimation = isOptionEnabledForBreakpoint(this.options.slideAnimation);
                // scrollto Content or headline
                var canScroll = true;
                // to check if the option is a number and check the screen width
                if (slideAnimation) {

                    // only scroll to content or headline when animation is finished
                    canScroll = false;

                    // Open the content
                    if (!content.hasClass(this.options.accordionContentActiveClass)) {

                        content.addClass(this.options.accordionContentActiveClass);

                        window.setTimeout(function() {

                            var completeHeight = content.outerHeight(true);

                            content.height(0).css({ overflow: 'hidden' });

                            if (self.options.withGPAnimate) {

                                content.height(0).gpAnimate(
                                                            {height: completeHeight},
                                                            self.options.scrollDuration,
                                                            "cubic-bezier(0.645, 0.045, 0.355, 1.000)",
                                                            function() {
                                                                content.removeAttr('style');
                                                                scrollToContentOrHeadline.call(self, target, content);
                                });
                            } else {
                                content.height(0).animate(
                                                            {height: completeHeight},
                                                            self.options.slideDuration,
                                                            function() {
                                        content.removeAttr('style');
                                        scrollToContentOrHeadline.call(self, target, content);
                                });
                            }
                        }, 0);


                    } else {
                            // Close the content
                        var curHeight  = content.height(),
                            zeroHeight = 0;

                            content.css({ overflow: 'hidden' }).height(curHeight);

                        if (self.options.withGPAnimate) {

                            // content.height(curHeight);
                            window.setTimeout(function() {

                                content.gpAnimate(
                                                {height: 0},
                                                self.options.scrollDuration,
                                                "cubic-bezier(0.645, 0.045, 0.355, 1.000)",
                                                function() {
                                                    content.removeAttr('style');
                                                    content.removeClass(self.options.accordionContentActiveClass);
                                                });
                                }, 0);


                        } else {

                            content.height(curHeight).animate(
                                                        {height: 0},
                                                        self.options.slideDuration,
                                                        function() {
                                                            content.removeAttr('style');
                                                            content.removeClass(self.options.accordionContentActiveClass);
                                                        });
                        }

                    }
                    // content.toggleClass(this.options.accordionContentActiveClass);
                } else {
                    content.toggleClass(this.options.accordionContentActiveClass);
                }

                // show the content
                // trigger resize event for fullImage, videoplayer and slideshow
                if (this.options.triggerWindowResize) {
                    window.setTimeout(function() {
                        $(window).trigger('resize');
                    }, this.options.scrollDuration);
                }

                // Only animate when slide anmation was finished
                if (canScroll) {
                    scrollToContentOrHeadline.call(this, target, content);
                }



            }
            if (this.options.accordionClickedCallback !== null) {
                this.options.accordionClickedCallback(target);
            }
        }
    }

    function scrollToContentOrHeadline(target, content) {
        // Check If scroll to content is a number and the screen width is smaller
        var scrollToContent = isOptionEnabledForBreakpoint(this.options.scrollToContent),
            scrollToHeadline = isOptionEnabledForBreakpoint(this.options.scrollToHeadline);

        if (scrollToContent && content.hasClass(this.options.accordionContentActiveClass)) {

                $('html,body').animate({
                    scrollTop: content.offset().top
                }, this.options.scrollDuration);

        } else if (scrollToHeadline && target.hasClass(this.options.accordionHeadlineActiveClass)) {

                $('html,body').animate({
                    scrollTop: target.offset().top
                }, this.options.scrollDuration);

        }
    }


    // =========================
    // GALLERY PLUGIN DEFINITION
    // =========================

    $.fn.accordion = function(option) {


        return this.each(function() {

            var $this   = $(this)
              , data    = $this.data('accordion')
              , options = $.extend({}, $.fn.accordion.defaults, typeof option == 'object' && option);

            if (!data) {
                $this.data('accordion', (data = new Accordion(this, options)));
            }

        });
    }


    $.fn.accordion.defaults = {
          'accordionLinkSelector'        : '.accordion-headline'
        , 'accordionContent'             : '.accordion-content'
        , 'accordionContentActiveClass'  : 'display'
        , 'accordionHeadlineActiveClass' : 'active'
        , 'closeOpenAccordions'          : false
        , 'alwaysToggleActiveState'      : true
        , 'breakpoint'                   : 630
        , 'scrollDuration'               : 500
        , 'contentResizeDuration'        : 500
        , 'ignoreBreakpoints'            : false
        , 'scrollToContent'              : false
        , 'checkEventClass'              : false
        , 'scrollToHeadline'             : false
        , 'slideAnimation'               : false
        , 'triggerWindowResize'          : false
        , 'slideDuration'                : 1000
        , 'accordionClickedCallback'     : null
        , 'contentSuffix'                : '-content'
        , 'withGPAnimate'                : false
    }


}(jQuery, this, this.document);
/*
     _ _      _       _
 ___| (_) ___| | __  (_)___
/ __| | |/ __| |/ /  | / __|
\__ \ | | (__|   < _ | \__ \
|___/_|_|\___|_|\_(_)/ |___/
                   |__/

 Version: 1.6.0
  Author: Ken Wheeler
 Website: http://kenwheeler.github.io
    Docs: http://kenwheeler.github.io/slick
    Repo: http://github.com/kenwheeler/slick
  Issues: http://github.com/kenwheeler/slick/issues

 */
/* global window, document, define, jQuery, setInterval, clearInterval */
(function (factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define(['jquery'], factory);
    } else if (typeof exports !== 'undefined') {
        module.exports = factory(require('jquery'));
    } else {
        factory(jQuery);
    }

}(function ($) {
    'use strict';
    var Slick = window.Slick || {};

    Slick = (function () {

        var instanceUid = 0;

        function Slick(element, settings) {

            var _ = this, dataSettings;

            _.defaults = {
                accessibility: true,
                adaptiveHeight: false,
                appendArrows: $(element),
                appendDots: $(element),
                arrows: true,
                asNavFor: null,
                prevArrow: '<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>',
                nextArrow: '<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>',
                autoplay: false,
                autoplaySpeed: 3000,
                centerMode: false,
                centerPadding: '50px',
                cssEase: 'ease',
                customPaging: function (slider, i) {
                    return $('<button type="button" data-role="none" role="button" tabindex="0" />').text(i + 1);
                },
                dots: false,
                dotsClass: 'slick-dots',
                /*
                 * PAG CUSTOM START
                 */
                dotsToShow: 5,
                dotsInnerPosition: 0,
                dotSize: 20,
                /*
                 * PAG CUSTOM END
                 */
                draggable: true,
                easing: 'linear',
                edgeFriction: 0.35,
                fade: false,
                focusOnSelect: false,
                infinite: true,
                initialSlide: 0,
                lazyLoad: 'ondemand',
                mobileFirst: false,
                pauseOnHover: true,
                pauseOnFocus: true,
                pauseOnDotsHover: false,
                respondTo: 'window',
                responsive: null,
                rows: 1,
                rtl: false,
                slide: '',
                slidesPerRow: 1,
                slidesToShow: 1,
                slidesToScroll: 1,
                speed: 500,
                swipe: true,
                swipeToSlide: false,
                touchMove: true,
                touchThreshold: 5,
                useCSS: true,
                useTransform: true,
                variableWidth: false,
                vertical: false,
                verticalSwiping: false,
                waitForAnimate: true,
                zIndex: 1000
            };

            _.initials = {
                animating: false,
                dragging: false,
                autoPlayTimer: null,
                currentDirection: 0,
                currentLeft: null,
                currentSlide: 0,
                direction: 1,
                $dots: null,
                /*
                 * PAG CUSTOM START
                 */
                $dotsInner: null,
                dotsInnerPositionMax: 0,
                dotsVisibleLeftFrameWhenCenter: 0,
                /*
                 * PAG CUSTOM END
                 */
                listWidth: null,
                listHeight: null,
                loadIndex: 0,
                $nextArrow: null,
                $prevArrow: null,
                slideCount: null,
                slideWidth: null,
                $slideTrack: null,
                $slides: null,
                sliding: false,
                slideOffset: 0,
                swipeLeft: null,
                $list: null,
                touchObject: {},
                transformsEnabled: false,
                unslicked: false
            };

            $.extend(_, _.initials);

            _.activeBreakpoint = null;
            _.animType = null;
            _.animProp = null;
            _.breakpoints = [];
            _.breakpointSettings = [];
            _.cssTransitions = false;
            _.focussed = false;
            _.interrupted = false;
            _.hidden = 'hidden';
            _.paused = true;
            _.positionProp = null;
            _.respondTo = null;
            _.rowCount = 1;
            _.shouldClick = true;
            _.$slider = $(element);
            _.$slidesCache = null;
            _.transformType = null;
            _.transitionType = null;
            _.visibilityChange = 'visibilitychange';
            _.windowWidth = 0;
            _.windowTimer = null;

            dataSettings = $(element).data('slick') || {};

            _.options = $.extend({}, _.defaults, settings, dataSettings);

            _.currentSlide = _.options.initialSlide;

            _.originalSettings = _.options;

            if (typeof document.mozHidden !== 'undefined') {
                _.hidden = 'mozHidden';
                _.visibilityChange = 'mozvisibilitychange';
            } else if (typeof document.webkitHidden !== 'undefined') {
                _.hidden = 'webkitHidden';
                _.visibilityChange = 'webkitvisibilitychange';
            }

            _.autoPlay = $.proxy(_.autoPlay, _);
            _.autoPlayClear = $.proxy(_.autoPlayClear, _);
            _.autoPlayIterator = $.proxy(_.autoPlayIterator, _);
            _.changeSlide = $.proxy(_.changeSlide, _);
            _.clickHandler = $.proxy(_.clickHandler, _);
            _.selectHandler = $.proxy(_.selectHandler, _);
            _.setPosition = $.proxy(_.setPosition, _);
            _.swipeHandler = $.proxy(_.swipeHandler, _);
            _.dragHandler = $.proxy(_.dragHandler, _);
            _.keyHandler = $.proxy(_.keyHandler, _);

            _.instanceUid = instanceUid++;

            // A simple way to check for HTML strings
            // Strict HTML recognition (must start with <)
            // Extracted from jQuery v1.11 source
            _.htmlExpr = /^(?:\s*(<[\w\W]+>)[^>]*)$/;

            _.registerBreakpoints();
            _.init(true);

        }

        return Slick;

    }());

    Slick.prototype.activateADA = function () {
        var _ = this;

        _.$slideTrack.find('.slick-active').attr({
            'aria-hidden': 'false'
        }).find('a, input, button, select').attr({
            'tabindex': '0'
        });

    };

    Slick.prototype.addSlide = Slick.prototype.slickAdd = function (markup, index, addBefore) {

        var _ = this;

        if (typeof(index) === 'boolean') {
            addBefore = index;
            index = null;
        } else if (index < 0 || (index >= _.slideCount)) {
            return false;
        }

        _.unload();

        if (typeof(index) === 'number') {
            if (index === 0 && _.$slides.length === 0) {
                $(markup).appendTo(_.$slideTrack);
            } else if (addBefore) {
                $(markup).insertBefore(_.$slides.eq(index));
            } else {
                $(markup).insertAfter(_.$slides.eq(index));
            }
        } else {
            if (addBefore === true) {
                $(markup).prependTo(_.$slideTrack);
            } else {
                $(markup).appendTo(_.$slideTrack);
            }
        }

        _.$slides = _.$slideTrack.children(this.options.slide);

        _.$slideTrack.children(this.options.slide).detach();

        _.$slideTrack.append(_.$slides);

        _.$slides.each(function (index, element) {
            $(element).attr('data-slick-index', index);
        });

        _.$slidesCache = _.$slides;

        _.reinit();

    };

    Slick.prototype.animateHeight = function () {
        var _ = this;
        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.animate({
                height: targetHeight
            }, _.options.speed);
        }
    };

    Slick.prototype.animateSlide = function (targetLeft, callback) {

        var animProps = {},
            _ = this;

        _.animateHeight();

        if (_.options.rtl === true && _.options.vertical === false) {
            targetLeft = -targetLeft;
        }
        if (_.transformsEnabled === false) {
            if (_.options.vertical === false) {
                _.$slideTrack.animate({
                    left: targetLeft
                }, _.options.speed, _.options.easing, callback);
            } else {
                _.$slideTrack.animate({
                    top: targetLeft
                }, _.options.speed, _.options.easing, callback);
            }

        } else {

            if (_.cssTransitions === false) {
                if (_.options.rtl === true) {
                    _.currentLeft = -(_.currentLeft);
                }
                $({
                    animStart: _.currentLeft
                }).animate({
                    animStart: targetLeft
                }, {
                    duration: _.options.speed,
                    easing: _.options.easing,
                    step: function (now) {
                        now = Math.ceil(now);
                        if (_.options.vertical === false) {
                            animProps[_.animType] = 'translate(' +
                                now + 'px, 0px)';
                            _.$slideTrack.css(animProps);
                        } else {
                            animProps[_.animType] = 'translate(0px,' +
                                now + 'px)';
                            _.$slideTrack.css(animProps);
                        }
                    },
                    complete: function () {
                        if (callback) {
                            callback.call();
                        }
                    }
                });

            } else {

                _.applyTransition();
                targetLeft = Math.ceil(targetLeft);

                if (_.options.vertical === false) {
                    animProps[_.animType] = 'translate3d(' + targetLeft + 'px, 0px, 0px)';
                } else {
                    animProps[_.animType] = 'translate3d(0px,' + targetLeft + 'px, 0px)';
                }
                _.$slideTrack.css(animProps);

                if (callback) {
                    setTimeout(function () {

                        _.disableTransition();

                        callback.call();
                    }, _.options.speed);
                }

            }

        }

    };

    Slick.prototype.getNavTarget = function () {

        var _ = this,
            asNavFor = _.options.asNavFor;

        if (asNavFor && asNavFor !== null) {
            asNavFor = $(asNavFor).not(_.$slider);
        }

        return asNavFor;

    };

    Slick.prototype.asNavFor = function (index) {

        var _ = this,
            asNavFor = _.getNavTarget();

        if (asNavFor !== null && typeof asNavFor === 'object') {
            asNavFor.each(function () {
                var target = $(this).slick('getSlick');
                if (!target.unslicked) {
                    target.slideHandler(index, true);
                }
            });
        }

    };

    Slick.prototype.applyTransition = function (slide) {

        var _ = this,
            transition = {};

        if (_.options.fade === false) {
            transition[_.transitionType] = _.transformType + ' ' + _.options.speed + 'ms ' + _.options.cssEase;
        } else {
            transition[_.transitionType] = 'opacity ' + _.options.speed + 'ms ' + _.options.cssEase;
        }

        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);
        }

    };

    Slick.prototype.autoPlay = function () {

        var _ = this;

        _.autoPlayClear();

        if (_.slideCount > _.options.slidesToShow) {
            _.autoPlayTimer = setInterval(_.autoPlayIterator, _.options.autoplaySpeed);
        }

    };

    Slick.prototype.autoPlayClear = function () {

        var _ = this;

        if (_.autoPlayTimer) {
            clearInterval(_.autoPlayTimer);
        }

    };

    Slick.prototype.autoPlayIterator = function () {

        var _ = this,
            slideTo = _.currentSlide + _.options.slidesToScroll;

        if (!_.paused && !_.interrupted && !_.focussed) {

            if (_.options.infinite === false) {

                if (_.direction === 1 && (_.currentSlide + 1) === (_.slideCount - 1)) {
                    _.direction = 0;
                }

                else if (_.direction === 0) {

                    slideTo = _.currentSlide - _.options.slidesToScroll;

                    if (_.currentSlide - 1 === 0) {
                        _.direction = 1;
                    }

                }

            }

            _.slideHandler(slideTo);

        }

    };

    Slick.prototype.buildArrows = function () {

        var _ = this;

        if (_.options.arrows === true) {

            _.$prevArrow = $(_.options.prevArrow).addClass('slick-arrow');
            _.$nextArrow = $(_.options.nextArrow).addClass('slick-arrow');

            if (_.slideCount > _.options.slidesToShow) {

                _.$prevArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');
                _.$nextArrow.removeClass('slick-hidden').removeAttr('aria-hidden tabindex');

                if (_.htmlExpr.test(_.options.prevArrow)) {
                    _.$prevArrow.prependTo(_.options.appendArrows);
                }

                if (_.htmlExpr.test(_.options.nextArrow)) {
                    _.$nextArrow.appendTo(_.options.appendArrows);
                }

                if (_.options.infinite !== true) {
                    _.$prevArrow
                        .addClass('slick-disabled')
                        .attr('aria-disabled', 'true');
                }

            } else {

                _.$prevArrow.add(_.$nextArrow)

                    .addClass('slick-hidden')
                    .attr({
                        'aria-disabled': 'true',
                        'tabindex': '-1'
                    });

            }

        }

    };

    Slick.prototype.buildDots = function () {

        /*
         * PAG CUSTOM START
         */
        var _ = this,
            i, dot, dotInner, $realDots;

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$slider.addClass('slick-dotted');

            dot = $('<div />').addClass(_.options.dotsClass);
            dotInner = $('<ul />').addClass(_.options.dotsClass + '-inner');

            for (i = 0; i <= _.getDotCount(); i += 1) {
                // dotInner.append($('<li />').append(_.options.customPaging.call(this, _, i)));
                dotInner.append($('<li />').append(_.options.customPaging.call(this, _, i)));
            }

            dot.append(dotInner);

            _.$dotsInner = dotInner;
            _.$dots = dot.appendTo(_.options.appendDots);

            $realDots = _.$dots.find('li');
            $realDots.first().addClass('slick-active').attr('aria-hidden', 'false');


            _.dotsInnerPositionMax = $realDots.length > _.options.dotsToShow ? $realDots.length - _.options.dotsToShow : 0;
            _.dotsVisibleLeftFrameWhenCenter = Math.floor(_.options.dotsToShow/2);
            _.$dots.css('width', (_.options.dotsToShow * _.options.dotSize) + 'px');

        }

        /*
         * PAG CUSTOM END
         */

    };

    Slick.prototype.buildOut = function () {

        var _ = this;

        _.$slides =
            _.$slider
                .children(_.options.slide + ':not(.slick-cloned)')
                .addClass('slick-slide');

        _.slideCount = _.$slides.length;

        _.$slides.each(function (index, element) {
            $(element)
                .attr('data-slick-index', index)
                .data('originalStyling', $(element).attr('style') || '');
        });

        _.$slider.addClass('slick-slider');

        _.$slideTrack = (_.slideCount === 0) ?
            $('<div class="slick-track"/>').appendTo(_.$slider) :
            _.$slides.wrapAll('<div class="slick-track"/>').parent();

        _.$list = _.$slideTrack.wrap(
            '<div aria-live="polite" class="slick-list"/>').parent();
        _.$slideTrack.css('opacity', 0);

        if (_.options.centerMode === true || _.options.swipeToSlide === true) {
            _.options.slidesToScroll = 1;
        }

        $('img[data-lazy]', _.$slider).not('[src]').addClass('slick-loading');

        _.setupInfinite();

        _.buildArrows();

        _.buildDots();

        _.updateDots();


        _.setSlideClasses(typeof _.currentSlide === 'number' ? _.currentSlide : 0);

        /*
         * PAG CUSTOM START
         */
        _.onBeforeChange(0, typeof _.currentSlide === 'number' ? _.currentSlide : 0);
        /*
         * PAG CUSTOM END
         */

        if (_.options.draggable === true) {
            _.$list.addClass('draggable');
        }

    };

    Slick.prototype.buildRows = function () {

        var _ = this, a, b, c, newSlides, numOfSlides, originalSlides, slidesPerSection;

        newSlides = document.createDocumentFragment();
        originalSlides = _.$slider.children();

        if (_.options.rows > 1) {

            slidesPerSection = _.options.slidesPerRow * _.options.rows;
            numOfSlides = Math.ceil(
                originalSlides.length / slidesPerSection
            );

            for (a = 0; a < numOfSlides; a++) {
                var slide = document.createElement('div');
                for (b = 0; b < _.options.rows; b++) {
                    var row = document.createElement('div');
                    for (c = 0; c < _.options.slidesPerRow; c++) {
                        var target = (a * slidesPerSection + ((b * _.options.slidesPerRow) + c));
                        if (originalSlides.get(target)) {
                            row.appendChild(originalSlides.get(target));
                        }
                    }
                    slide.appendChild(row);
                }
                newSlides.appendChild(slide);
            }

            _.$slider.empty().append(newSlides);
            _.$slider.children().children().children()
                .css({
                    'width': (100 / _.options.slidesPerRow) + '%',
                    'display': 'inline-block'
                });

        }

    };

    Slick.prototype.checkResponsive = function (initial, forceUpdate) {

        var _ = this,
            breakpoint, targetBreakpoint, respondToWidth, triggerBreakpoint = false;
        var sliderWidth = _.$slider.width();
        var windowWidth = window.innerWidth || $(window).width();

        if (_.respondTo === 'window') {
            respondToWidth = windowWidth;
        } else if (_.respondTo === 'slider') {
            respondToWidth = sliderWidth;
        } else if (_.respondTo === 'min') {
            respondToWidth = Math.min(windowWidth, sliderWidth);
        }

        if (_.options.responsive &&
            _.options.responsive.length &&
            _.options.responsive !== null) {

            targetBreakpoint = null;

            for (breakpoint in _.breakpoints) {
                if (_.breakpoints.hasOwnProperty(breakpoint)) {
                    if (_.originalSettings.mobileFirst === false) {
                        if (respondToWidth < _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    } else {
                        if (respondToWidth > _.breakpoints[breakpoint]) {
                            targetBreakpoint = _.breakpoints[breakpoint];
                        }
                    }
                }
            }

            if (targetBreakpoint !== null) {
                if (_.activeBreakpoint !== null) {
                    if (targetBreakpoint !== _.activeBreakpoint || forceUpdate) {
                        _.activeBreakpoint =
                            targetBreakpoint;
                        if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                            _.unslick(targetBreakpoint);
                        } else {
                            _.options = $.extend({}, _.originalSettings,
                                _.breakpointSettings[
                                    targetBreakpoint]);
                            if (initial === true) {
                                _.currentSlide = _.options.initialSlide;
                            }
                            _.refresh(initial);
                        }
                        triggerBreakpoint = targetBreakpoint;
                    }
                } else {
                    _.activeBreakpoint = targetBreakpoint;
                    if (_.breakpointSettings[targetBreakpoint] === 'unslick') {
                        _.unslick(targetBreakpoint);
                    } else {
                        _.options = $.extend({}, _.originalSettings,
                            _.breakpointSettings[
                                targetBreakpoint]);
                        if (initial === true) {
                            _.currentSlide = _.options.initialSlide;
                        }
                        _.refresh(initial);
                    }
                    triggerBreakpoint = targetBreakpoint;
                }
            } else {
                if (_.activeBreakpoint !== null) {
                    _.activeBreakpoint = null;
                    _.options = _.originalSettings;
                    if (initial === true) {
                        _.currentSlide = _.options.initialSlide;
                    }
                    _.refresh(initial);
                    triggerBreakpoint = targetBreakpoint;
                }
            }

            // only trigger breakpoints during an actual break. not on initialize.
            if (!initial && triggerBreakpoint !== false) {
                _.$slider.trigger('breakpoint', [_, triggerBreakpoint]);
            }
        }

    };

    Slick.prototype.changeSlide = function (event, dontAnimate) {

        var _ = this,
            $target = $(event.currentTarget),
            indexOffset, slideOffset, unevenOffset;

        // If target is a link, prevent default action.
        if ($target.is('a')) {
            event.preventDefault();
        }

        // If target is not the <li> element (ie: a child), find the <li>.
        if (!$target.is('li')) {
            $target = $target.closest('li');
        }

        unevenOffset = (_.slideCount % _.options.slidesToScroll !== 0);
        indexOffset = unevenOffset ? 0 : (_.slideCount - _.currentSlide) % _.options.slidesToScroll;

        switch (event.data.message) {

            case 'previous':
                slideOffset = indexOffset === 0 ? _.options.slidesToScroll : _.options.slidesToShow - indexOffset;
                if (_.slideCount > _.options.slidesToShow) {
                    _.slideHandler(_.currentSlide - slideOffset, false, dontAnimate);
                }
                break;

            case 'next':
                slideOffset = indexOffset === 0 ? _.options.slidesToScroll : indexOffset;
                if (_.slideCount > _.options.slidesToShow) {
                    _.slideHandler(_.currentSlide + slideOffset, false, dontAnimate);
                }
                break;

            case 'index':
                var index = event.data.index === 0 ? 0 :
                    event.data.index || $target.index() * _.options.slidesToScroll;

                _.slideHandler(_.checkNavigable(index), false, dontAnimate);
                $target.children().trigger('focus');
                break;

            default:
                return;
        }

    };

    Slick.prototype.checkNavigable = function (index) {

        var _ = this,
            navigables, prevNavigable;

        navigables = _.getNavigableIndexes();
        prevNavigable = 0;
        if (index > navigables[navigables.length - 1]) {
            index = navigables[navigables.length - 1];
        } else {
            for (var n in navigables) {
                if (index < navigables[n]) {
                    index = prevNavigable;
                    break;
                }
                prevNavigable = navigables[n];
            }
        }

        return index;
    };

    Slick.prototype.cleanUpEvents = function () {

        var _ = this;

        if (_.options.dots && _.$dots !== null) {

            $('li', _.$dots)
                .off('click.slick', _.changeSlide)
                .off('mouseenter.slick', $.proxy(_.interrupt, _, true))
                .off('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

        _.$slider.off('focus.slick blur.slick');

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow && _.$prevArrow.off('click.slick', _.changeSlide);
            _.$nextArrow && _.$nextArrow.off('click.slick', _.changeSlide);
        }

        _.$list.off('touchstart.slick mousedown.slick', _.swipeHandler);
        _.$list.off('touchmove.slick mousemove.slick', _.swipeHandler);
        _.$list.off('touchend.slick mouseup.slick', _.swipeHandler);
        _.$list.off('touchcancel.slick mouseleave.slick', _.swipeHandler);

        _.$list.off('click.slick', _.clickHandler);

        $(document).off(_.visibilityChange, _.visibility);

        _.cleanUpSlideEvents();

        if (_.options.accessibility === true) {
            _.$list.off('keydown.slick', _.keyHandler);
        }

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().off('click.slick', _.selectHandler);
        }

        $(window).off('orientationchange.slick.slick-' + _.instanceUid, _.orientationChange);

        $(window).off('resize.slick.slick-' + _.instanceUid, _.resize);

        $('[draggable!=true]', _.$slideTrack).off('dragstart', _.preventDefault);

        $(window).off('load.slick.slick-' + _.instanceUid, _.setPosition);
        $(document).off('ready.slick.slick-' + _.instanceUid, _.setPosition);

    };

    Slick.prototype.cleanUpSlideEvents = function () {

        var _ = this;

        _.$list.off('mouseenter.slick', $.proxy(_.interrupt, _, true));
        _.$list.off('mouseleave.slick', $.proxy(_.interrupt, _, false));

    };

    Slick.prototype.cleanUpRows = function () {

        var _ = this, originalSlides;

        if (_.options.rows > 1) {
            originalSlides = _.$slides.children().children();
            originalSlides.removeAttr('style');
            _.$slider.empty().append(originalSlides);
        }

    };

    Slick.prototype.clickHandler = function (event) {

        var _ = this;

        if (_.shouldClick === false) {
            event.stopImmediatePropagation();
            event.stopPropagation();
            event.preventDefault();
        }

    };

    Slick.prototype.destroy = function (refresh) {

        var _ = this;

        _.autoPlayClear();

        _.touchObject = {};

        _.cleanUpEvents();

        $('.slick-cloned', _.$slider).detach();

        if (_.$dots) {
            _.$dots.remove();
        }


        if (_.$prevArrow && _.$prevArrow.length) {

            _.$prevArrow
                .removeClass('slick-disabled slick-arrow slick-hidden')
                .removeAttr('aria-hidden aria-disabled tabindex')
                .css('display', '');

            if (_.htmlExpr.test(_.options.prevArrow)) {
                _.$prevArrow.remove();
            }
        }

        if (_.$nextArrow && _.$nextArrow.length) {

            _.$nextArrow
                .removeClass('slick-disabled slick-arrow slick-hidden')
                .removeAttr('aria-hidden aria-disabled tabindex')
                .css('display', '');

            if (_.htmlExpr.test(_.options.nextArrow)) {
                _.$nextArrow.remove();
            }

        }


        if (_.$slides) {

            _.$slides
                .removeClass('slick-slide slick-active slick-center slick-visible slick-current')
                .removeAttr('aria-hidden')
                .removeAttr('data-slick-index')
                .each(function () {
                    $(this).attr('style', $(this).data('originalStyling'));
                });

            _.$slideTrack.children(this.options.slide).detach();

            _.$slideTrack.detach();

            _.$list.detach();

            _.$slider.append(_.$slides);
        }

        _.cleanUpRows();

        _.$slider.removeClass('slick-slider');
        _.$slider.removeClass('slick-initialized');
        _.$slider.removeClass('slick-dotted');

        _.unslicked = true;

        if (!refresh) {
            _.$slider.trigger('destroy', [_]);
        }

    };

    Slick.prototype.disableTransition = function (slide) {

        var _ = this,
            transition = {};

        transition[_.transitionType] = '';

        if (_.options.fade === false) {
            _.$slideTrack.css(transition);
        } else {
            _.$slides.eq(slide).css(transition);
        }

    };

    Slick.prototype.fadeSlide = function (slideIndex, callback) {

        var _ = this;

        if (_.cssTransitions === false) {

            _.$slides.eq(slideIndex).css({
                zIndex: _.options.zIndex
            });

            _.$slides.eq(slideIndex).animate({
                opacity: 1
            }, _.options.speed, _.options.easing, callback);

        } else {

            _.applyTransition(slideIndex);

            _.$slides.eq(slideIndex).css({
                opacity: 1,
                zIndex: _.options.zIndex
            });

            if (callback) {
                setTimeout(function () {

                    _.disableTransition(slideIndex);

                    callback.call();
                }, _.options.speed);
            }

        }

    };

    Slick.prototype.fadeSlideOut = function (slideIndex) {

        var _ = this;

        if (_.cssTransitions === false) {

            _.$slides.eq(slideIndex).animate({
                opacity: 0,
                zIndex: _.options.zIndex - 2
            }, _.options.speed, _.options.easing);

        } else {

            _.applyTransition(slideIndex);

            _.$slides.eq(slideIndex).css({
                opacity: 0,
                zIndex: _.options.zIndex - 2
            });

        }

    };

    Slick.prototype.filterSlides = Slick.prototype.slickFilter = function (filter) {

        var _ = this;

        if (filter !== null) {

            _.$slidesCache = _.$slides;

            _.unload();

            _.$slideTrack.children(this.options.slide).detach();

            _.$slidesCache.filter(filter).appendTo(_.$slideTrack);

            _.reinit();

        }

    };

    Slick.prototype.focusHandler = function () {

        var _ = this;

        _.$slider
            .off('focus.slick blur.slick')
            .on('focus.slick blur.slick',
                '*:not(.slick-arrow)', function (event) {

                    event.stopImmediatePropagation();
                    var $sf = $(this);

                    setTimeout(function () {

                        if (_.options.pauseOnFocus) {
                            _.focussed = $sf.is(':focus');
                            _.autoPlay();
                        }

                    }, 0);

                });
    };

    Slick.prototype.getCurrent = Slick.prototype.slickCurrentSlide = function () {

        var _ = this;
        return _.currentSlide;

    };

    Slick.prototype.getDotCount = function () {

        var _ = this;

        var breakPoint = 0;
        var counter = 0;
        var pagerQty = 0;

        if (_.options.infinite === true) {
            while (breakPoint < _.slideCount) {
                ++pagerQty;
                breakPoint = counter + _.options.slidesToScroll;
                counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
            }
        } else if (_.options.centerMode === true) {
            pagerQty = _.slideCount;
        } else if (!_.options.asNavFor) {
            pagerQty = 1 + Math.ceil((_.slideCount - _.options.slidesToShow) / _.options.slidesToScroll);
        } else {
            while (breakPoint < _.slideCount) {
                ++pagerQty;
                breakPoint = counter + _.options.slidesToScroll;
                counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
            }
        }

        return pagerQty - 1;

    };

    Slick.prototype.getLeft = function (slideIndex) {

        var _ = this,
            targetLeft,
            verticalHeight,
            verticalOffset = 0,
            targetSlide;

        _.slideOffset = 0;
        verticalHeight = _.$slides.first().outerHeight(true);

        if (_.options.infinite === true) {
            if (_.slideCount > _.options.slidesToShow) {
                _.slideOffset = (_.slideWidth * _.options.slidesToShow) * -1;
                verticalOffset = (verticalHeight * _.options.slidesToShow) * -1;
            }
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                if (slideIndex + _.options.slidesToScroll > _.slideCount && _.slideCount > _.options.slidesToShow) {
                    if (slideIndex > _.slideCount) {
                        _.slideOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * _.slideWidth) * -1;
                        verticalOffset = ((_.options.slidesToShow - (slideIndex - _.slideCount)) * verticalHeight) * -1;
                    } else {
                        _.slideOffset = ((_.slideCount % _.options.slidesToScroll) * _.slideWidth) * -1;
                        verticalOffset = ((_.slideCount % _.options.slidesToScroll) * verticalHeight) * -1;
                    }
                }
            }
        } else {
            if (slideIndex + _.options.slidesToShow > _.slideCount) {
                _.slideOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * _.slideWidth;
                verticalOffset = ((slideIndex + _.options.slidesToShow) - _.slideCount) * verticalHeight;
            }
        }

        if (_.slideCount <= _.options.slidesToShow) {
            _.slideOffset = 0;
            verticalOffset = 0;
        }

        if (_.options.centerMode === true && _.options.infinite === true) {
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2) - _.slideWidth;
        } else if (_.options.centerMode === true) {
            _.slideOffset = 0;
            _.slideOffset += _.slideWidth * Math.floor(_.options.slidesToShow / 2);
        }

        if (_.options.vertical === false) {
            targetLeft = ((slideIndex * _.slideWidth) * -1) + _.slideOffset;
        } else {
            targetLeft = ((slideIndex * verticalHeight) * -1) + verticalOffset;
        }

        if (_.options.variableWidth === true) {

            if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
            } else {
                targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow);
            }

            if (_.options.rtl === true) {
                if (targetSlide[0]) {
                    targetLeft = (_.$slideTrack.width() - targetSlide[0].offsetLeft - targetSlide.width()) * -1;
                } else {
                    targetLeft = 0;
                }
            } else {
                targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
            }

            if (_.options.centerMode === true) {
                if (_.slideCount <= _.options.slidesToShow || _.options.infinite === false) {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex);
                } else {
                    targetSlide = _.$slideTrack.children('.slick-slide').eq(slideIndex + _.options.slidesToShow + 1);
                }

                if (_.options.rtl === true) {
                    if (targetSlide[0]) {
                        targetLeft = (_.$slideTrack.width() - targetSlide[0].offsetLeft - targetSlide.width()) * -1;
                    } else {
                        targetLeft = 0;
                    }
                } else {
                    targetLeft = targetSlide[0] ? targetSlide[0].offsetLeft * -1 : 0;
                }

                targetLeft += (_.$list.width() - targetSlide.outerWidth()) / 2;
            }
        }

        return targetLeft;

    };

    Slick.prototype.getOption = Slick.prototype.slickGetOption = function (option) {

        var _ = this;

        return _.options[option];

    };

    Slick.prototype.getNavigableIndexes = function () {

        var _ = this,
            breakPoint = 0,
            counter = 0,
            indexes = [],
            max;

        if (_.options.infinite === false) {
            max = _.slideCount;
        } else {
            breakPoint = _.options.slidesToScroll * -1;
            counter = _.options.slidesToScroll * -1;
            max = _.slideCount * 2;
        }

        while (breakPoint < max) {
            indexes.push(breakPoint);
            breakPoint = counter + _.options.slidesToScroll;
            counter += _.options.slidesToScroll <= _.options.slidesToShow ? _.options.slidesToScroll : _.options.slidesToShow;
        }

        return indexes;

    };

    Slick.prototype.getSlick = function () {

        return this;

    };

    Slick.prototype.getSlideCount = function () {

        var _ = this,
            slidesTraversed, swipedSlide, centerOffset;

        centerOffset = _.options.centerMode === true ? _.slideWidth * Math.floor(_.options.slidesToShow / 2) : 0;

        if (_.options.swipeToSlide === true) {
            _.$slideTrack.find('.slick-slide').each(function (index, slide) {
                if (slide.offsetLeft - centerOffset + ($(slide).outerWidth() / 2) > (_.swipeLeft * -1)) {
                    swipedSlide = slide;
                    return false;
                }
            });

            slidesTraversed = Math.abs($(swipedSlide).attr('data-slick-index') - _.currentSlide) || 1;

            return slidesTraversed;

        } else {
            return _.options.slidesToScroll;
        }

    };

    Slick.prototype.goTo = Slick.prototype.slickGoTo = function (slide, dontAnimate) {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'index',
                index: parseInt(slide)
            }
        }, dontAnimate);

    };

    Slick.prototype.init = function (creation) {

        var _ = this;

        if (!$(_.$slider).hasClass('slick-initialized')) {

            $(_.$slider).addClass('slick-initialized');

            _.buildRows();
            _.buildOut();
            _.setProps();
            _.startLoad();
            _.loadSlider();
            _.initializeEvents();
            _.updateArrows();
            _.updateDots();
            _.checkResponsive(true);
            _.focusHandler();

        }

        if (creation) {
            _.$slider.trigger('init', [_]);
        }

        if (_.options.accessibility === true) {
            _.initADA();
        }

        if (_.options.autoplay) {

            _.paused = false;
            _.autoPlay();

        }

    };

    Slick.prototype.initADA = function () {
        var _ = this;
        _.$slides.add(_.$slideTrack.find('.slick-cloned')).attr({
            'aria-hidden': 'true',
            'tabindex': '-1'
        }).find('a, input, button, select').attr({
            'tabindex': '-1'
        });

        _.$slideTrack.attr('role', 'listbox');

        _.$slides.not(_.$slideTrack.find('.slick-cloned')).each(function (i) {
            $(this).attr({
                'role': 'option',
                'aria-describedby': 'slick-slide' + _.instanceUid + i + ''
            });
        });

        /*
         * PAG CUSTOM START
         */
        // if (_.$dots !== null) {
        //     _.$dots.attr('role', 'tablist').find('li').each(function(i) {
        if (_.$dotsInner !== null) {
            _.$dotsInner.attr('role', 'tablist').find('li').each(function (i) {
                /*
                 * PAG CUSTOM END
                 */
                $(this).attr({
                    'role': 'presentation',
                    'aria-selected': 'false',
                    'aria-controls': 'navigation' + _.instanceUid + i + '',
                    'id': 'slick-slide' + _.instanceUid + i + ''
                });
            })
                .first().attr('aria-selected', 'true').end()
                .find('button').attr('role', 'button').end()
                .closest('div').attr('role', 'toolbar');
        }
        _.activateADA();

    };

    Slick.prototype.initArrowEvents = function () {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {
            _.$prevArrow
                .off('click.slick')
                .on('click.slick', {
                    message: 'previous'
                }, _.changeSlide);
            _.$nextArrow
                .off('click.slick')
                .on('click.slick', {
                    message: 'next'
                }, _.changeSlide);
        }

    };

    Slick.prototype.initDotEvents = function () {

        var _ = this;

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {
            $('li', _.$dots).on('click.slick', {
                message: 'index'
            }, _.changeSlide);
        }

        if (_.options.dots === true && _.options.pauseOnDotsHover === true) {

            $('li', _.$dots)
                .on('mouseenter.slick', $.proxy(_.interrupt, _, true))
                .on('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

    };

    Slick.prototype.initSlideEvents = function () {

        var _ = this;

        if (_.options.pauseOnHover) {

            _.$list.on('mouseenter.slick', $.proxy(_.interrupt, _, true));
            _.$list.on('mouseleave.slick', $.proxy(_.interrupt, _, false));

        }

    };

    Slick.prototype.initializeEvents = function () {

        var _ = this;

        _.initArrowEvents();

        _.initDotEvents();
        _.initSlideEvents();

        _.$list.on('touchstart.slick mousedown.slick', {
            action: 'start'
        }, _.swipeHandler);
        _.$list.on('touchmove.slick mousemove.slick', {
            action: 'move'
        }, _.swipeHandler);
        _.$list.on('touchend.slick mouseup.slick', {
            action: 'end'
        }, _.swipeHandler);
        _.$list.on('touchcancel.slick mouseleave.slick', {
            action: 'end'
        }, _.swipeHandler);

        _.$list.on('click.slick', _.clickHandler);

        $(document).on(_.visibilityChange, $.proxy(_.visibility, _));

        if (_.options.accessibility === true) {
            _.$list.on('keydown.slick', _.keyHandler);
        }

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }

        $(window).on('orientationchange.slick.slick-' + _.instanceUid, $.proxy(_.orientationChange, _));

        $(window).on('resize.slick.slick-' + _.instanceUid, $.proxy(_.resize, _));

        $('[draggable!=true]', _.$slideTrack).on('dragstart', _.preventDefault);

        $(window).on('load.slick.slick-' + _.instanceUid, _.setPosition);
        $(document).on('ready.slick.slick-' + _.instanceUid, _.setPosition);

    };

    Slick.prototype.initUI = function () {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {

            _.$prevArrow.show();
            _.$nextArrow.show();

        }

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$dots.show();

        }

    };

    Slick.prototype.keyHandler = function (event) {

        var _ = this;
        //Dont slide if the cursor is inside the form fields and arrow keys are pressed
        if (!event.target.tagName.match('TEXTAREA|INPUT|SELECT')) {
            if (event.keyCode === 37 && _.options.accessibility === true) {
                _.changeSlide({
                    data: {
                        message: _.options.rtl === true ? 'next' : 'previous'
                    }
                });
            } else if (event.keyCode === 39 && _.options.accessibility === true) {
                _.changeSlide({
                    data: {
                        message: _.options.rtl === true ? 'previous' : 'next'
                    }
                });
            }
        }

    };

    Slick.prototype.lazyLoad = function () {

        var _ = this,
            loadRange, cloneRange, rangeStart, rangeEnd;

        function loadImages(imagesScope) {

            $('img[data-lazy]', imagesScope).each(function () {

                var image = $(this),
                    imageSource = $(this).attr('data-lazy'),
                    imageToLoad = document.createElement('img');

                imageToLoad.onload = function () {

                    image
                        .animate({opacity: 0}, 100, function () {
                            image
                                .attr('src', imageSource)
                                .animate({opacity: 1}, 200, function () {
                                    image
                                        .removeAttr('data-lazy')
                                        .removeClass('slick-loading');
                                });
                            _.$slider.trigger('lazyLoaded', [_, image, imageSource]);
                        });

                };

                imageToLoad.onerror = function () {

                    image
                        .removeAttr('data-lazy')
                        .removeClass('slick-loading')
                        .addClass('slick-lazyload-error');

                    _.$slider.trigger('lazyLoadError', [_, image, imageSource]);

                };

                imageToLoad.src = imageSource;

            });

        }

        if (_.options.centerMode === true) {
            if (_.options.infinite === true) {
                rangeStart = _.currentSlide + (_.options.slidesToShow / 2 + 1);
                rangeEnd = rangeStart + _.options.slidesToShow + 2;
            } else {
                rangeStart = Math.max(0, _.currentSlide - (_.options.slidesToShow / 2 + 1));
                rangeEnd = 2 + (_.options.slidesToShow / 2 + 1) + _.currentSlide;
            }
        } else {
            rangeStart = _.options.infinite ? _.options.slidesToShow + _.currentSlide : _.currentSlide;
            rangeEnd = Math.ceil(rangeStart + _.options.slidesToShow);
            if (_.options.fade === true) {
                if (rangeStart > 0) rangeStart--;
                if (rangeEnd <= _.slideCount) rangeEnd++;
            }
        }

        loadRange = _.$slider.find('.slick-slide').slice(rangeStart, rangeEnd);
        loadImages(loadRange);

        if (_.slideCount <= _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-slide');
            loadImages(cloneRange);
        } else if (_.currentSlide >= _.slideCount - _.options.slidesToShow) {
            cloneRange = _.$slider.find('.slick-cloned').slice(0, _.options.slidesToShow);
            loadImages(cloneRange);
        } else if (_.currentSlide === 0) {
            cloneRange = _.$slider.find('.slick-cloned').slice(_.options.slidesToShow * -1);
            loadImages(cloneRange);
        }

    };

    Slick.prototype.loadSlider = function () {

        var _ = this;

        _.setPosition();

        _.$slideTrack.css({
            opacity: 1
        });

        _.$slider.removeClass('slick-loading');

        _.initUI();

        if (_.options.lazyLoad === 'progressive') {
            _.progressiveLazyLoad();
        }

    };

    Slick.prototype.next = Slick.prototype.slickNext = function () {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'next'
            }
        });

    };

    Slick.prototype.orientationChange = function () {

        var _ = this;

        _.checkResponsive();
        _.setPosition();

    };

    Slick.prototype.pause = Slick.prototype.slickPause = function () {

        var _ = this;

        _.autoPlayClear();
        _.paused = true;

    };

    Slick.prototype.play = Slick.prototype.slickPlay = function () {

        var _ = this;

        _.autoPlay();
        _.options.autoplay = true;
        _.paused = false;
        _.focussed = false;
        _.interrupted = false;

    };

    Slick.prototype.postSlide = function (index) {

        var _ = this;

        if (!_.unslicked) {

            _.$slider.trigger('afterChange', [_, index]);

            _.animating = false;

            _.setPosition();

            _.swipeLeft = null;

            if (_.options.autoplay) {
                _.autoPlay();
            }

            if (_.options.accessibility === true) {
                _.initADA();
            }

        }

    };

    Slick.prototype.prev = Slick.prototype.slickPrev = function () {

        var _ = this;

        _.changeSlide({
            data: {
                message: 'previous'
            }
        });

    };

    Slick.prototype.preventDefault = function (event) {

        event.preventDefault();

    };

    Slick.prototype.progressiveLazyLoad = function (tryCount) {

        tryCount = tryCount || 1;

        var _ = this,
            $imgsToLoad = $('img[data-lazy]', _.$slider),
            image,
            imageSource,
            imageToLoad;

        if ($imgsToLoad.length) {

            image = $imgsToLoad.first();
            imageSource = image.attr('data-lazy');
            imageToLoad = document.createElement('img');

            imageToLoad.onload = function () {

                image
                    .attr('src', imageSource)
                    .removeAttr('data-lazy')
                    .removeClass('slick-loading');

                if (_.options.adaptiveHeight === true) {
                    _.setPosition();
                }

                _.$slider.trigger('lazyLoaded', [_, image, imageSource]);
                _.progressiveLazyLoad();

            };

            imageToLoad.onerror = function () {

                if (tryCount < 3) {

                    /**
                     * try to load the image 3 times,
                     * leave a slight delay so we don't get
                     * servers blocking the request.
                     */
                    setTimeout(function () {
                        _.progressiveLazyLoad(tryCount + 1);
                    }, 500);

                } else {

                    image
                        .removeAttr('data-lazy')
                        .removeClass('slick-loading')
                        .addClass('slick-lazyload-error');

                    _.$slider.trigger('lazyLoadError', [_, image, imageSource]);

                    _.progressiveLazyLoad();

                }

            };

            imageToLoad.src = imageSource;

        } else {

            _.$slider.trigger('allImagesLoaded', [_]);

        }

    };

    Slick.prototype.refresh = function (initializing) {

        var _ = this, currentSlide, lastVisibleIndex;

        lastVisibleIndex = _.slideCount - _.options.slidesToShow;

        // in non-infinite sliders, we don't want to go past the
        // last visible index.
        if (!_.options.infinite && (_.currentSlide > lastVisibleIndex)) {
            _.currentSlide = lastVisibleIndex;
        }

        // if less slides than to show, go to start.
        if (_.slideCount <= _.options.slidesToShow) {
            _.currentSlide = 0;

        }

        currentSlide = _.currentSlide;

        _.destroy(true);

        $.extend(_, _.initials, {currentSlide: currentSlide});

        _.init();

        if (!initializing) {

            _.changeSlide({
                data: {
                    message: 'index',
                    index: currentSlide
                }
            }, false);

        }

    };

    Slick.prototype.registerBreakpoints = function () {

        var _ = this, breakpoint, currentBreakpoint, l,
            responsiveSettings = _.options.responsive || null;

        if ($.type(responsiveSettings) === 'array' && responsiveSettings.length) {

            _.respondTo = _.options.respondTo || 'window';

            for (breakpoint in responsiveSettings) {

                l = _.breakpoints.length - 1;
                currentBreakpoint = responsiveSettings[breakpoint].breakpoint;

                if (responsiveSettings.hasOwnProperty(breakpoint)) {

                    // loop through the breakpoints and cut out any existing
                    // ones with the same breakpoint number, we don't want dupes.
                    while (l >= 0) {
                        if (_.breakpoints[l] && _.breakpoints[l] === currentBreakpoint) {
                            _.breakpoints.splice(l, 1);
                        }
                        l--;
                    }

                    _.breakpoints.push(currentBreakpoint);
                    _.breakpointSettings[currentBreakpoint] = responsiveSettings[breakpoint].settings;

                }

            }

            _.breakpoints.sort(function (a, b) {
                return (_.options.mobileFirst) ? a - b : b - a;
            });

        }

    };

    Slick.prototype.reinit = function () {

        var _ = this;

        _.$slides =
            _.$slideTrack
                .children(_.options.slide)
                .addClass('slick-slide');

        _.slideCount = _.$slides.length;

        if (_.currentSlide >= _.slideCount && _.currentSlide !== 0) {
            _.currentSlide = _.currentSlide - _.options.slidesToScroll;
        }

        if (_.slideCount <= _.options.slidesToShow) {
            _.currentSlide = 0;
        }

        _.registerBreakpoints();

        _.setProps();
        _.setupInfinite();
        _.buildArrows();
        _.updateArrows();
        _.initArrowEvents();
        _.buildDots();
        _.updateDots();
        _.initDotEvents();
        _.cleanUpSlideEvents();
        _.initSlideEvents();

        _.checkResponsive(false, true);

        if (_.options.focusOnSelect === true) {
            $(_.$slideTrack).children().on('click.slick', _.selectHandler);
        }

        _.setSlideClasses(typeof _.currentSlide === 'number' ? _.currentSlide : 0);

        _.setPosition();
        _.focusHandler();

        _.paused = !_.options.autoplay;
        _.autoPlay();

        _.$slider.trigger('reInit', [_]);

    };

    Slick.prototype.resize = function () {

        var _ = this;

        if ($(window).width() !== _.windowWidth) {
            clearTimeout(_.windowDelay);
            _.windowDelay = window.setTimeout(function () {
                _.windowWidth = $(window).width();
                _.checkResponsive();
                if (!_.unslicked) {
                    _.setPosition();
                }
            }, 50);
        }
    };

    Slick.prototype.removeSlide = Slick.prototype.slickRemove = function (index, removeBefore, removeAll) {

        var _ = this;

        if (typeof(index) === 'boolean') {
            removeBefore = index;
            index = removeBefore === true ? 0 : _.slideCount - 1;
        } else {
            index = removeBefore === true ? --index : index;
        }

        if (_.slideCount < 1 || index < 0 || index > _.slideCount - 1) {
            return false;
        }

        _.unload();

        if (removeAll === true) {
            _.$slideTrack.children().remove();
        } else {
            _.$slideTrack.children(this.options.slide).eq(index).remove();
        }

        _.$slides = _.$slideTrack.children(this.options.slide);

        _.$slideTrack.children(this.options.slide).detach();

        _.$slideTrack.append(_.$slides);

        _.$slidesCache = _.$slides;

        _.reinit();

    };

    Slick.prototype.setCSS = function (position) {

        var _ = this,
            positionProps = {},
            x, y;

        if (_.options.rtl === true) {
            position = -position;
        }
        x = _.positionProp == 'left' ? Math.ceil(position) + 'px' : '0px';
        y = _.positionProp == 'top' ? Math.ceil(position) + 'px' : '0px';

        positionProps[_.positionProp] = position;

        if (_.transformsEnabled === false) {
            _.$slideTrack.css(positionProps);
        } else {
            positionProps = {};
            if (_.cssTransitions === false) {
                positionProps[_.animType] = 'translate(' + x + ', ' + y + ')';
                _.$slideTrack.css(positionProps);
            } else {
                positionProps[_.animType] = 'translate3d(' + x + ', ' + y + ', 0px)';
                _.$slideTrack.css(positionProps);
            }
        }

    };

    Slick.prototype.setDimensions = function () {

        var _ = this;

        if (_.options.vertical === false) {
            if (_.options.centerMode === true) {
                _.$list.css({
                    padding: ('0px ' + _.options.centerPadding)
                });
            }
        } else {
            _.$list.height(_.$slides.first().outerHeight(true) * _.options.slidesToShow);
            if (_.options.centerMode === true) {
                _.$list.css({
                    padding: (_.options.centerPadding + ' 0px')
                });
            }
        }

        _.listWidth = _.$list.width();
        _.listHeight = _.$list.height();


        if (_.options.vertical === false && _.options.variableWidth === false) {
            _.slideWidth = Math.ceil(_.listWidth / _.options.slidesToShow);
            _.$slideTrack.width(Math.ceil((_.slideWidth * _.$slideTrack.children('.slick-slide').length)));

        } else if (_.options.variableWidth === true) {
            _.$slideTrack.width(5000 * _.slideCount);
        } else {
            _.slideWidth = Math.ceil(_.listWidth);
            _.$slideTrack.height(Math.ceil((_.$slides.first().outerHeight(true) * _.$slideTrack.children('.slick-slide').length)));
        }

        var offset = _.$slides.first().outerWidth(true) - _.$slides.first().width();
        if (_.options.variableWidth === false) _.$slideTrack.children('.slick-slide').width(_.slideWidth - offset);

    };

    Slick.prototype.setFade = function () {

        var _ = this,
            targetLeft;

        _.$slides.each(function (index, element) {
            targetLeft = (_.slideWidth * index) * -1;
            if (_.options.rtl === true) {
                $(element).css({
                    position: 'relative',
                    right: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            } else {
                $(element).css({
                    position: 'relative',
                    left: targetLeft,
                    top: 0,
                    zIndex: _.options.zIndex - 2,
                    opacity: 0
                });
            }
        });

        _.$slides.eq(_.currentSlide).css({
            zIndex: _.options.zIndex - 1,
            opacity: 1
        });

    };

    Slick.prototype.setHeight = function () {

        var _ = this;

        if (_.options.slidesToShow === 1 && _.options.adaptiveHeight === true && _.options.vertical === false) {
            var targetHeight = _.$slides.eq(_.currentSlide).outerHeight(true);
            _.$list.css('height', targetHeight);
        }

    };

    Slick.prototype.setOption =
        Slick.prototype.slickSetOption = function () {

            /**
             * accepts arguments in format of:
             *
             *  - for changing a single option's value:
             *     .slick("setOption", option, value, refresh )
             *
             *  - for changing a set of responsive options:
             *     .slick("setOption", 'responsive', [{}, ...], refresh )
             *
             *  - for updating multiple values at once (not responsive)
             *     .slick("setOption", { 'option': value, ... }, refresh )
             */

            var _ = this, l, item, option, value, refresh = false, type;

            if ($.type(arguments[0]) === 'object') {

                option = arguments[0];
                refresh = arguments[1];
                type = 'multiple';

            } else if ($.type(arguments[0]) === 'string') {

                option = arguments[0];
                value = arguments[1];
                refresh = arguments[2];

                if (arguments[0] === 'responsive' && $.type(arguments[1]) === 'array') {

                    type = 'responsive';

                } else if (typeof arguments[1] !== 'undefined') {

                    type = 'single';

                }

            }

            if (type === 'single') {

                _.options[option] = value;


            } else if (type === 'multiple') {

                $.each(option, function (opt, val) {

                    _.options[opt] = val;

                });


            } else if (type === 'responsive') {

                for (item in value) {

                    if ($.type(_.options.responsive) !== 'array') {

                        _.options.responsive = [value[item]];

                    } else {

                        l = _.options.responsive.length - 1;

                        // loop through the responsive object and splice out duplicates.
                        while (l >= 0) {

                            if (_.options.responsive[l].breakpoint === value[item].breakpoint) {

                                _.options.responsive.splice(l, 1);

                            }

                            l--;

                        }

                        _.options.responsive.push(value[item]);

                    }

                }

            }

            if (refresh) {

                _.unload();
                _.reinit();

            }

        };

    Slick.prototype.setPosition = function () {

        var _ = this;

        _.setDimensions();

        _.setHeight();

        if (_.options.fade === false) {
            _.setCSS(_.getLeft(_.currentSlide));
        } else {
            _.setFade();
        }

        _.$slider.trigger('setPosition', [_]);

    };

    Slick.prototype.setProps = function () {

        var _ = this,
            bodyStyle = document.body.style;

        _.positionProp = _.options.vertical === true ? 'top' : 'left';

        if (_.positionProp === 'top') {
            _.$slider.addClass('slick-vertical');
        } else {
            _.$slider.removeClass('slick-vertical');
        }

        if (bodyStyle.WebkitTransition !== undefined ||
            bodyStyle.MozTransition !== undefined ||
            bodyStyle.msTransition !== undefined) {
            if (_.options.useCSS === true) {
                _.cssTransitions = true;
            }
        }

        if (_.options.fade) {
            if (typeof _.options.zIndex === 'number') {
                if (_.options.zIndex < 3) {
                    _.options.zIndex = 3;
                }
            } else {
                _.options.zIndex = _.defaults.zIndex;
            }
        }

        if (bodyStyle.OTransform !== undefined) {
            _.animType = 'OTransform';
            _.transformType = '-o-transform';
            _.transitionType = 'OTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.MozTransform !== undefined) {
            _.animType = 'MozTransform';
            _.transformType = '-moz-transform';
            _.transitionType = 'MozTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.MozPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.webkitTransform !== undefined) {
            _.animType = 'webkitTransform';
            _.transformType = '-webkit-transform';
            _.transitionType = 'webkitTransition';
            if (bodyStyle.perspectiveProperty === undefined && bodyStyle.webkitPerspective === undefined) _.animType = false;
        }
        if (bodyStyle.msTransform !== undefined) {
            _.animType = 'msTransform';
            _.transformType = '-ms-transform';
            _.transitionType = 'msTransition';
            if (bodyStyle.msTransform === undefined) _.animType = false;
        }
        if (bodyStyle.transform !== undefined && _.animType !== false) {
            _.animType = 'transform';
            _.transformType = 'transform';
            _.transitionType = 'transition';
        }
        _.transformsEnabled = _.options.useTransform && (_.animType !== null && _.animType !== false);
    };


    Slick.prototype.setSlideClasses = function (index) {

        var _ = this,
            centerOffset, allSlides, indexOffset, remainder;

        allSlides = _.$slider
            .find('.slick-slide')
            .removeClass('slick-active slick-center slick-current')
            .attr('aria-hidden', 'true');

        _.$slides
            .eq(index)
            .addClass('slick-current');

        if (_.options.centerMode === true) {

            centerOffset = Math.floor(_.options.slidesToShow / 2);

            if (_.options.infinite === true) {

                if (index >= centerOffset && index <= (_.slideCount - 1) - centerOffset) {

                    _.$slides
                        .slice(index - centerOffset, index + centerOffset + 1)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                } else {

                    indexOffset = _.options.slidesToShow + index;
                    allSlides
                        .slice(indexOffset - centerOffset + 1, indexOffset + centerOffset + 2)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                }

                if (index === 0) {

                    allSlides
                        .eq(allSlides.length - 1 - _.options.slidesToShow)
                        .addClass('slick-center');

                } else if (index === _.slideCount - 1) {

                    allSlides
                        .eq(_.options.slidesToShow)
                        .addClass('slick-center');

                }

            }

            _.$slides
                .eq(index)
                .addClass('slick-center');

        } else {

            if (index >= 0 && index <= (_.slideCount - _.options.slidesToShow)) {

                _.$slides
                    .slice(index, index + _.options.slidesToShow)
                    .addClass('slick-active')
                    .attr('aria-hidden', 'false');

            } else if (allSlides.length <= _.options.slidesToShow) {

                allSlides
                    .addClass('slick-active')
                    .attr('aria-hidden', 'false');

            } else {

                remainder = _.slideCount % _.options.slidesToShow;
                indexOffset = _.options.infinite === true ? _.options.slidesToShow + index : index;

                if (_.options.slidesToShow == _.options.slidesToScroll && (_.slideCount - index) < _.options.slidesToShow) {

                    allSlides
                        .slice(indexOffset - (_.options.slidesToShow - remainder), indexOffset + remainder)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                } else {

                    allSlides
                        .slice(indexOffset, indexOffset + _.options.slidesToShow)
                        .addClass('slick-active')
                        .attr('aria-hidden', 'false');

                }

            }

        }

        if (_.options.lazyLoad === 'ondemand') {
            _.lazyLoad();
        }

    };

    Slick.prototype.setupInfinite = function () {

        var _ = this,
            i, slideIndex, infiniteCount;

        if (_.options.fade === true) {
            _.options.centerMode = false;
        }

        if (_.options.infinite === true && _.options.fade === false) {

            slideIndex = null;

            if (_.slideCount > _.options.slidesToShow) {

                if (_.options.centerMode === true) {
                    infiniteCount = _.options.slidesToShow + 1;
                } else {
                    infiniteCount = _.options.slidesToShow;
                }

                for (i = _.slideCount; i > (_.slideCount -
                    infiniteCount); i -= 1) {
                    slideIndex = i - 1;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '')
                        .attr('data-slick-index', slideIndex - _.slideCount)
                        .prependTo(_.$slideTrack).addClass('slick-cloned');
                }
                for (i = 0; i < infiniteCount; i += 1) {
                    slideIndex = i;
                    $(_.$slides[slideIndex]).clone(true).attr('id', '')
                        .attr('data-slick-index', slideIndex + _.slideCount)
                        .appendTo(_.$slideTrack).addClass('slick-cloned');
                }
                _.$slideTrack.find('.slick-cloned').find('[id]').each(function () {
                    $(this).attr('id', '');
                });

            }

        }

    };

    Slick.prototype.interrupt = function (toggle) {

        var _ = this;

        if (!toggle) {
            _.autoPlay();
        }
        _.interrupted = toggle;

    };

    Slick.prototype.selectHandler = function (event) {

        var _ = this;

        var targetElement =
            $(event.target).is('.slick-slide') ?
                $(event.target) :
                $(event.target).parents('.slick-slide');

        var index = parseInt(targetElement.attr('data-slick-index'));

        if (!index) index = 0;

        if (_.slideCount <= _.options.slidesToShow) {

            _.setSlideClasses(index);
            _.asNavFor(index);
            return;

        }

        _.slideHandler(index);

    };

    Slick.prototype.slideHandler = function (index, sync, dontAnimate) {

        var targetSlide, animSlide, oldSlide, slideLeft, targetLeft = null,
            _ = this, navTarget;

        sync = sync || false;

        if (_.animating === true && _.options.waitForAnimate === true) {
            return;
        }

        if (_.options.fade === true && _.currentSlide === index) {
            return;
        }

        if (_.slideCount <= _.options.slidesToShow) {
            return;
        }

        if (sync === false) {
            _.asNavFor(index);
        }

        targetSlide = index;
        targetLeft = _.getLeft(targetSlide);
        slideLeft = _.getLeft(_.currentSlide);

        _.currentLeft = _.swipeLeft === null ? slideLeft : _.swipeLeft;

        if (_.options.infinite === false && _.options.centerMode === false && (index < 0 || index > _.getDotCount() * _.options.slidesToScroll)) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function () {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        } else if (_.options.infinite === false && _.options.centerMode === true && (index < 0 || index > (_.slideCount - _.options.slidesToScroll))) {
            if (_.options.fade === false) {
                targetSlide = _.currentSlide;
                if (dontAnimate !== true) {
                    _.animateSlide(slideLeft, function () {
                        _.postSlide(targetSlide);
                    });
                } else {
                    _.postSlide(targetSlide);
                }
            }
            return;
        }

        if (_.options.autoplay) {
            clearInterval(_.autoPlayTimer);
        }

        if (targetSlide < 0) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = _.slideCount - (_.slideCount % _.options.slidesToScroll);
            } else {
                animSlide = _.slideCount + targetSlide;
            }
        } else if (targetSlide >= _.slideCount) {
            if (_.slideCount % _.options.slidesToScroll !== 0) {
                animSlide = 0;
            } else {
                animSlide = targetSlide - _.slideCount;
            }
        } else {
            animSlide = targetSlide;
        }

        _.animating = true;

        /*
         * PAG CUSTOM START
         */
        _.onBeforeChange(_.currentSlide, animSlide);
        /*
         * PAG CUSTOM END
         */
        _.$slider.trigger('beforeChange', [_, _.currentSlide, animSlide]);

        oldSlide = _.currentSlide;
        _.currentSlide = animSlide;

        _.setSlideClasses(_.currentSlide);

        if (_.options.asNavFor) {

            navTarget = _.getNavTarget();
            navTarget = navTarget.slick('getSlick');

            if (navTarget.slideCount <= navTarget.options.slidesToShow) {
                navTarget.setSlideClasses(_.currentSlide);
            }

        }

        _.updateDots();
        _.updateArrows();

        if (_.options.fade === true) {
            if (dontAnimate !== true) {

                _.fadeSlideOut(oldSlide);

                _.fadeSlide(animSlide, function () {
                    _.postSlide(animSlide);
                });

            } else {
                _.postSlide(animSlide);
            }
            _.animateHeight();
            return;
        }

        if (dontAnimate !== true) {
            _.animateSlide(targetLeft, function () {
                _.postSlide(animSlide);
            });
        } else {
            _.postSlide(animSlide);
        }

    };

    Slick.prototype.startLoad = function () {

        var _ = this;

        if (_.options.arrows === true && _.slideCount > _.options.slidesToShow) {

            _.$prevArrow.hide();
            _.$nextArrow.hide();

        }

        if (_.options.dots === true && _.slideCount > _.options.slidesToShow) {

            _.$dots.hide();

        }

        _.$slider.addClass('slick-loading');

    };

    Slick.prototype.swipeDirection = function () {

        var xDist, yDist, r, swipeAngle, _ = this;

        xDist = _.touchObject.startX - _.touchObject.curX;
        yDist = _.touchObject.startY - _.touchObject.curY;
        r = Math.atan2(yDist, xDist);

        swipeAngle = Math.round(r * 180 / Math.PI);
        if (swipeAngle < 0) {
            swipeAngle = 360 - Math.abs(swipeAngle);
        }

        if ((swipeAngle <= 45) && (swipeAngle >= 0)) {
            return (_.options.rtl === false ? 'left' : 'right');
        }
        if ((swipeAngle <= 360) && (swipeAngle >= 315)) {
            return (_.options.rtl === false ? 'left' : 'right');
        }
        if ((swipeAngle >= 135) && (swipeAngle <= 225)) {
            return (_.options.rtl === false ? 'right' : 'left');
        }
        if (_.options.verticalSwiping === true) {
            if ((swipeAngle >= 35) && (swipeAngle <= 135)) {
                return 'down';
            } else {
                return 'up';
            }
        }

        return 'vertical';

    };

    Slick.prototype.swipeEnd = function (event) {

        var _ = this,
            slideCount,
            direction;

        _.dragging = false;
        _.interrupted = false;
        _.shouldClick = (_.touchObject.swipeLength > 10) ? false : true;

        if (_.touchObject.curX === undefined) {
            return false;
        }

        if (_.touchObject.edgeHit === true) {
            _.$slider.trigger('edge', [_, _.swipeDirection()]);
        }

        if (_.touchObject.swipeLength >= _.touchObject.minSwipe) {

            direction = _.swipeDirection();

            switch (direction) {

                case 'left':
                case 'down':

                    slideCount =
                        _.options.swipeToSlide ?
                            _.checkNavigable(_.currentSlide + _.getSlideCount()) :
                            _.currentSlide + _.getSlideCount();

                    _.currentDirection = 0;

                    break;

                case 'right':
                case 'up':

                    slideCount =
                        _.options.swipeToSlide ?
                            _.checkNavigable(_.currentSlide - _.getSlideCount()) :
                            _.currentSlide - _.getSlideCount();

                    _.currentDirection = 1;

                    break;

                default:


            }

            if (direction != 'vertical') {

                _.slideHandler(slideCount);
                _.touchObject = {};
                _.$slider.trigger('swipe', [_, direction]);

            }

        } else {

            if (_.touchObject.startX !== _.touchObject.curX) {

                _.slideHandler(_.currentSlide);
                _.touchObject = {};

            }

        }

    };

    Slick.prototype.swipeHandler = function (event) {

        var _ = this;

        if ((_.options.swipe === false) || ('ontouchend' in document && _.options.swipe === false)) {
            return;
        } else if (_.options.draggable === false && event.type.indexOf('mouse') !== -1) {
            return;
        }

        _.touchObject.fingerCount = event.originalEvent && event.originalEvent.touches !== undefined ?
            event.originalEvent.touches.length : 1;

        _.touchObject.minSwipe = _.listWidth / _.options
            .touchThreshold;

        if (_.options.verticalSwiping === true) {
            _.touchObject.minSwipe = _.listHeight / _.options
                .touchThreshold;
        }

        switch (event.data.action) {

            case 'start':
                _.swipeStart(event);
                break;

            case 'move':
                _.swipeMove(event);
                break;

            case 'end':
                _.swipeEnd(event);
                break;

        }

    };

    Slick.prototype.swipeMove = function (event) {

        var _ = this,
            edgeWasHit = false,
            curLeft, swipeDirection, swipeLength, positionOffset, touches;

        touches = event.originalEvent !== undefined ? event.originalEvent.touches : null;

        if (!_.dragging || touches && touches.length !== 1) {
            return false;
        }

        curLeft = _.getLeft(_.currentSlide);

        _.touchObject.curX = touches !== undefined ? touches[0].pageX : event.clientX;
        _.touchObject.curY = touches !== undefined ? touches[0].pageY : event.clientY;

        _.touchObject.swipeLength = Math.round(Math.sqrt(
            Math.pow(_.touchObject.curX - _.touchObject.startX, 2)));

        if (_.options.verticalSwiping === true) {
            _.touchObject.swipeLength = Math.round(Math.sqrt(
                Math.pow(_.touchObject.curY - _.touchObject.startY, 2)));
        }

        swipeDirection = _.swipeDirection();

        if (swipeDirection === 'vertical') {
            return;
        }

        if (event.originalEvent !== undefined && _.touchObject.swipeLength > 4) {
            event.preventDefault();
        }

        positionOffset = (_.options.rtl === false ? 1 : -1) * (_.touchObject.curX > _.touchObject.startX ? 1 : -1);
        if (_.options.verticalSwiping === true) {
            positionOffset = _.touchObject.curY > _.touchObject.startY ? 1 : -1;
        }


        swipeLength = _.touchObject.swipeLength;

        _.touchObject.edgeHit = false;

        if (_.options.infinite === false) {
            if ((_.currentSlide === 0 && swipeDirection === 'right') || (_.currentSlide >= _.getDotCount() && swipeDirection === 'left')) {
                swipeLength = _.touchObject.swipeLength * _.options.edgeFriction;
                _.touchObject.edgeHit = true;
            }
        }

        if (_.options.vertical === false) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        } else {
            _.swipeLeft = curLeft + (swipeLength * (_.$list.height() / _.listWidth)) * positionOffset;
        }
        if (_.options.verticalSwiping === true) {
            _.swipeLeft = curLeft + swipeLength * positionOffset;
        }

        if (_.options.fade === true || _.options.touchMove === false) {
            return false;
        }

        if (_.animating === true) {
            _.swipeLeft = null;
            return false;
        }

        _.setCSS(_.swipeLeft);

    };

    Slick.prototype.swipeStart = function (event) {

        var _ = this,
            touches;

        _.interrupted = true;

        if (_.touchObject.fingerCount !== 1 || _.slideCount <= _.options.slidesToShow) {
            _.touchObject = {};
            return false;
        }

        if (event.originalEvent !== undefined && event.originalEvent.touches !== undefined) {
            touches = event.originalEvent.touches[0];
        }

        _.touchObject.startX = _.touchObject.curX = touches !== undefined ? touches.pageX : event.clientX;
        _.touchObject.startY = _.touchObject.curY = touches !== undefined ? touches.pageY : event.clientY;

        _.dragging = true;

    };

    Slick.prototype.unfilterSlides = Slick.prototype.slickUnfilter = function () {

        var _ = this;

        if (_.$slidesCache !== null) {

            _.unload();

            _.$slideTrack.children(this.options.slide).detach();

            _.$slidesCache.appendTo(_.$slideTrack);

            _.reinit();

        }

    };

    Slick.prototype.unload = function () {

        var _ = this;

        $('.slick-cloned', _.$slider).remove();

        if (_.$dots) {
            _.$dots.remove();
        }

        if (_.$prevArrow && _.htmlExpr.test(_.options.prevArrow)) {
            _.$prevArrow.remove();
        }

        if (_.$nextArrow && _.htmlExpr.test(_.options.nextArrow)) {
            _.$nextArrow.remove();
        }

        _.$slides
            .removeClass('slick-slide slick-active slick-visible slick-current')
            .attr('aria-hidden', 'true')
            .css('width', '');

    };

    Slick.prototype.unslick = function (fromBreakpoint) {

        var _ = this;
        _.$slider.trigger('unslick', [_, fromBreakpoint]);
        _.destroy();

    };

    Slick.prototype.updateArrows = function () {

        var _ = this,
            centerOffset;

        centerOffset = Math.floor(_.options.slidesToShow / 2);

        if (_.options.arrows === true &&
            _.slideCount > _.options.slidesToShow &&
            !_.options.infinite) {

            _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');
            _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            if (_.currentSlide === 0) {

                _.$prevArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$nextArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            } else if (_.currentSlide >= _.slideCount - _.options.slidesToShow && _.options.centerMode === false) {

                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            } else if (_.currentSlide >= _.slideCount - 1 && _.options.centerMode === true) {

                _.$nextArrow.addClass('slick-disabled').attr('aria-disabled', 'true');
                _.$prevArrow.removeClass('slick-disabled').attr('aria-disabled', 'false');

            }

        }

    };

    Slick.prototype.updateDots = function () {

        var _ = this;

        if (_.$dots !== null) {

            _.$dots
                .find('li')
                .removeClass('slick-active')
                .attr('aria-hidden', 'true');

            _.$dots
                .find('li')
                .eq(Math.floor(_.currentSlide / _.options.slidesToScroll))
                .addClass('slick-active')
                .attr('aria-hidden', 'false');

        }

    };

    /*
     * PAG CUSTOM START
     */
    Slick.prototype.onBeforeChange = function (lastID, newID) {

        var _,
            $loopDot,
            directionForward,
            dotCount,
            dotCountInvisibleLeftFrame,
            dotCountInvisibleRightFrame,
            $dotElements,
            i;

        _ = this;

        if (_.$dots != null) {
            $dotElements = _.$dots.find('li');
            dotCount = $dotElements.length;

            // no logic required, because not enough dots
            if (dotCount <= _.options.dotsToShow) {
                _.$dots.css('textAlign', 'center');
            }
            else {

                directionForward = lastID <= newID;

                if (lastID - newID >= -1 && lastID - newID <= 1) {

                    // SMALL JUMP
                    if (directionForward) {
                        if (
                            (
                                newID > _.options.dotsInnerPosition + _.options.dotsToShow - 2 &&
                                newID < dotCount - 1
                            )
                        ) {
                            _.options.dotsInnerPosition += 1;
                        }
                    } else {
                        if (
                            _.options.dotsInnerPosition >= newID &&
                            _.options.dotsInnerPosition > 0
                        ) {
                            _.options.dotsInnerPosition -= 1;
                        }
                    }

                } else {

                    // Big Jump
                    _.options.dotsInnerPosition = newID - _.dotsVisibleLeftFrameWhenCenter;

                }

                // Clip
                _.options.dotsInnerPosition = Math.min(Math.max(_.options.dotsInnerPosition, 0), _.dotsInnerPositionMax);

                dotCountInvisibleLeftFrame = _.options.dotsInnerPosition;
                dotCountInvisibleRightFrame = dotCount - _.options.dotsToShow - _.options.dotsInnerPosition;

                /*
                console.table({
                    element: _.$dots.parents('.b-page-wrapper > *').attr('class'),
                    instanceUid: _.instanceUid,
                    directionForward: directionForward,
                    innerPosition: _.options.dotsInnerPosition,
                    dotsInnerPosition: _.options.dotsInnerPosition,
                    lastID: lastID,
                    newID: newID,
                    length: dotCount
                });
                //*/

                for (i = 0; i < dotCount; i++) {
                    $loopDot = $dotElements.eq(i);
                    switch (true) {
                        // region IS ACTIVE
                        case (i === newID):
                            $loopDot.removeClass("slick-small");
                            $loopDot.removeClass("slick-medium");
                            break;
                        // endregion

                        // region SET SMALL ONLY
                        // LEFT FRAME: is 1st after > 2 invisible
                        case (dotCountInvisibleLeftFrame > 0 && i < _.options.dotsInnerPosition + 1):
                        // RIGHT FRAME: is 1st before > 2 invisible
                        case (dotCountInvisibleRightFrame > 0 && i >= _.options.dotsInnerPosition + _.options.dotsToShow - 1):
                            $loopDot.removeClass("slick-medium");
                            $loopDot.addClass("slick-small");
                            break;
                        // endregion
                        /*
                        // region SET SMALL
                        // LEFT FRAME: is 1st after > 2 invisible
                        case (dotCountInvisibleLeftFrame > 1 && i < _.options.dotsInnerPosition + 1):
                        // RIGHT FRAME: is 1st before > 2 invisible
                        case (dotCountInvisibleRightFrame > 1 && i >= _.options.dotsInnerPosition + _.options.dotsToShow - 1):
                            $loopDot.removeClass("slick-medium");
                            $loopDot.addClass("slick-small");
                            break;
                            // endregion

                        // region SET MEDIUM
                        // LEFT is 1st after > 1 invisible
                        case (dotCountInvisibleLeftFrame > 0 && i < _.options.dotsInnerPosition + 1):
                        // LEFT FRAME: is 2nd after > 2 invisible
                        case (dotCountInvisibleLeftFrame > 1 && i < _.options.dotsInnerPosition + 2):
                        // RIGHT FRAME: is 1st before > 1 invisible
                        case (dotCountInvisibleRightFrame > 0 && i >= _.options.dotsInnerPosition + _.options.dotsToShow - 1):
                        // RIGHT FRAME: is 2nd before > 2 invisible
                        case (dotCountInvisibleRightFrame > 1 && i >= _.options.dotsInnerPosition + _.options.dotsToShow - 2):
                            $loopDot.removeClass("slick-small");
                            $loopDot.addClass("slick-medium");
                            break;
                            // endregion
                        //*/

                        // region SET LARGE
                        default:
                            $loopDot.removeClass("slick-small");
                            $loopDot.removeClass("slick-medium");
                            break;
                        // endregion

                    }
                }

                // +20 on start and always
                _.$dotsInner.css('margin-left', (-1 * _.options.dotsInnerPosition * _.options.dotSize) + 'px');
            }
        }

    };
    /*
     * PAG CUSTOM END
     */

    Slick.prototype.visibility = function () {

        var _ = this;

        if (_.options.autoplay) {

            if (document[_.hidden]) {

                _.interrupted = true;

            } else {

                _.interrupted = false;

            }

        }

    };

    $.fn.slick = function () {
        var _ = this,
            opt = arguments[0],
            args = Array.prototype.slice.call(arguments, 1),
            l = _.length,
            i,
            ret;
        for (i = 0; i < l; i++) {
            if (typeof opt == 'object' || typeof opt == 'undefined')
                _[i].slick = new Slick(_[i], opt);
            else
                ret = _[i].slick[opt].apply(_[i].slick, args);
            if (typeof ret != 'undefined') return ret;
        }
        return _;
    };

}));
/*! nouislider - 9.2.0 - 2017-01-11 10:35:34 */

(function (factory) {

    if ( typeof define === 'function' && define.amd ) {

        // AMD. Register as an anonymous module.
        define([], factory);

    } else if ( typeof exports === 'object' ) {

        // Node/CommonJS
        module.exports = factory();

    } else {

        // Browser globals
        window.noUiSlider = factory();
    }

}(function( ){

	'use strict';

	var VERSION = '9.2.0';


	// Creates a node, adds it to target, returns the new node.
	function addNodeTo ( target, className ) {
		var div = document.createElement('div');
		addClass(div, className);
		target.appendChild(div);
		return div;
	}

	// Removes duplicates from an array.
	function unique ( array ) {
		return array.filter(function(a){
			return !this[a] ? this[a] = true : false;
		}, {});
	}

	// Round a value to the closest 'to'.
	function closest ( value, to ) {
		return Math.round(value / to) * to;
	}

	// Current position of an element relative to the document.
	function offset ( elem, orientation ) {

	var rect = elem.getBoundingClientRect(),
		doc = elem.ownerDocument,
		docElem = doc.documentElement,
		pageOffset = getPageOffset();

		// getBoundingClientRect contains left scroll in Chrome on Android.
		// I haven't found a feature detection that proves this. Worst case
		// scenario on mis-match: the 'tap' feature on horizontal sliders breaks.
		if ( /webkit.*Chrome.*Mobile/i.test(navigator.userAgent) ) {
			pageOffset.x = 0;
		}

		return orientation ? (rect.top + pageOffset.y - docElem.clientTop) : (rect.left + pageOffset.x - docElem.clientLeft);
	}

	// Checks whether a value is numerical.
	function isNumeric ( a ) {
		return typeof a === 'number' && !isNaN( a ) && isFinite( a );
	}

	// Sets a class and removes it after [duration] ms.
	function addClassFor ( element, className, duration ) {
		if (duration > 0) {
		addClass(element, className);
			setTimeout(function(){
				removeClass(element, className);
			}, duration);
		}
	}

	// Limits a value to 0 - 100
	function limit ( a ) {
		return Math.max(Math.min(a, 100), 0);
	}

	// Wraps a variable as an array, if it isn't one yet.
	// Note that an input array is returned by reference!
	function asArray ( a ) {
		return Array.isArray(a) ? a : [a];
	}

	// Counts decimals
	function countDecimals ( numStr ) {
		numStr = String(numStr);
		var pieces = numStr.split(".");
		return pieces.length > 1 ? pieces[1].length : 0;
	}

	// http://youmightnotneedjquery.com/#add_class
	function addClass ( el, className ) {
		if ( el.classList ) {
			el.classList.add(className);
		} else {
			el.className += ' ' + className;
		}
	}

	// http://youmightnotneedjquery.com/#remove_class
	function removeClass ( el, className ) {
		if ( el.classList ) {
			el.classList.remove(className);
		} else {
			el.className = el.className.replace(new RegExp('(^|\\b)' + className.split(' ').join('|') + '(\\b|$)', 'gi'), ' ');
		}
	}

	// https://plainjs.com/javascript/attributes/adding-removing-and-testing-for-classes-9/
	function hasClass ( el, className ) {
		return el.classList ? el.classList.contains(className) : new RegExp('\\b' + className + '\\b').test(el.className);
	}

	// https://developer.mozilla.org/en-US/docs/Web/API/Window/scrollY#Notes
	function getPageOffset ( ) {

		var supportPageOffset = window.pageXOffset !== undefined,
			isCSS1Compat = ((document.compatMode || "") === "CSS1Compat"),
			x = supportPageOffset ? window.pageXOffset : isCSS1Compat ? document.documentElement.scrollLeft : document.body.scrollLeft,
			y = supportPageOffset ? window.pageYOffset : isCSS1Compat ? document.documentElement.scrollTop : document.body.scrollTop;

		return {
			x: x,
			y: y
		};
	}

	// we provide a function to compute constants instead
	// of accessing window.* as soon as the module needs it
	// so that we do not compute anything if not needed
	function getActions ( ) {

		// Determine the events to bind. IE11 implements pointerEvents without
		// a prefix, which breaks compatibility with the IE10 implementation.
		return window.navigator.pointerEnabled ? {
			start: 'pointerdown',
			move: 'pointermove',
			end: 'pointerup'
		} : window.navigator.msPointerEnabled ? {
			start: 'MSPointerDown',
			move: 'MSPointerMove',
			end: 'MSPointerUp'
		} : {
			start: 'mousedown touchstart',
			move: 'mousemove touchmove',
			end: 'mouseup touchend'
		};
	}


// Value calculation

	// Determine the size of a sub-range in relation to a full range.
	function subRangeRatio ( pa, pb ) {
		return (100 / (pb - pa));
	}

	// (percentage) How many percent is this value of this range?
	function fromPercentage ( range, value ) {
		return (value * 100) / ( range[1] - range[0] );
	}

	// (percentage) Where is this value on this range?
	function toPercentage ( range, value ) {
		return fromPercentage( range, range[0] < 0 ?
			value + Math.abs(range[0]) :
				value - range[0] );
	}

	// (value) How much is this percentage on this range?
	function isPercentage ( range, value ) {
		return ((value * ( range[1] - range[0] )) / 100) + range[0];
	}


// Range conversion

	function getJ ( value, arr ) {

		var j = 1;

		while ( value >= arr[j] ){
			j += 1;
		}

		return j;
	}

	// (percentage) Input a value, find where, on a scale of 0-100, it applies.
	function toStepping ( xVal, xPct, value ) {

		if ( value >= xVal.slice(-1)[0] ){
			return 100;
		}

		var j = getJ( value, xVal ), va, vb, pa, pb;

		va = xVal[j-1];
		vb = xVal[j];
		pa = xPct[j-1];
		pb = xPct[j];

		return pa + (toPercentage([va, vb], value) / subRangeRatio (pa, pb));
	}

	// (value) Input a percentage, find where it is on the specified range.
	function fromStepping ( xVal, xPct, value ) {

		// There is no range group that fits 100
		if ( value >= 100 ){
			return xVal.slice(-1)[0];
		}

		var j = getJ( value, xPct ), va, vb, pa, pb;

		va = xVal[j-1];
		vb = xVal[j];
		pa = xPct[j-1];
		pb = xPct[j];

		return isPercentage([va, vb], (value - pa) * subRangeRatio (pa, pb));
	}

	// (percentage) Get the step that applies at a certain value.
	function getStep ( xPct, xSteps, snap, value ) {

		if ( value === 100 ) {
			return value;
		}

		var j = getJ( value, xPct ), a, b;

		// If 'snap' is set, steps are used as fixed points on the slider.
		if ( snap ) {

			a = xPct[j-1];
			b = xPct[j];

			// Find the closest position, a or b.
			if ((value - a) > ((b-a)/2)){
				return b;
			}

			return a;
		}

		if ( !xSteps[j-1] ){
			return value;
		}

		return xPct[j-1] + closest(
			value - xPct[j-1],
			xSteps[j-1]
		);
	}


// Entry parsing

	function handleEntryPoint ( index, value, that ) {

		var percentage;

		// Wrap numerical input in an array.
		if ( typeof value === "number" ) {
			value = [value];
		}

		// Reject any invalid input, by testing whether value is an array.
		if ( Object.prototype.toString.call( value ) !== '[object Array]' ){
			throw new Error("noUiSlider (" + VERSION + "): 'range' contains invalid value.");
		}

		// Covert min/max syntax to 0 and 100.
		if ( index === 'min' ) {
			percentage = 0;
		} else if ( index === 'max' ) {
			percentage = 100;
		} else {
			percentage = parseFloat( index );
		}

		// Check for correct input.
		if ( !isNumeric( percentage ) || !isNumeric( value[0] ) ) {
			throw new Error("noUiSlider (" + VERSION + "): 'range' value isn't numeric.");
		}

		// Store values.
		that.xPct.push( percentage );
		that.xVal.push( value[0] );

		// NaN will evaluate to false too, but to keep
		// logging clear, set step explicitly. Make sure
		// not to override the 'step' setting with false.
		if ( !percentage ) {
			if ( !isNaN( value[1] ) ) {
				that.xSteps[0] = value[1];
			}
		} else {
			that.xSteps.push( isNaN(value[1]) ? false : value[1] );
		}

		that.xHighestCompleteStep.push(0);
	}

	function handleStepPoint ( i, n, that ) {

		// Ignore 'false' stepping.
		if ( !n ) {
			return true;
		}

		// Factor to range ratio
		that.xSteps[i] = fromPercentage([
			 that.xVal[i]
			,that.xVal[i+1]
		], n) / subRangeRatio (
			that.xPct[i],
			that.xPct[i+1] );

		var totalSteps = (that.xVal[i+1] - that.xVal[i]) / that.xNumSteps[i];
		var highestStep = Math.ceil(Number(totalSteps.toFixed(3)) - 1);
		var step = that.xVal[i] + (that.xNumSteps[i] * highestStep);

		that.xHighestCompleteStep[i] = step;
	}


// Interface

	// The interface to Spectrum handles all direction-based
	// conversions, so the above values are unaware.

	function Spectrum ( entry, snap, direction, singleStep ) {

		this.xPct = [];
		this.xVal = [];
		this.xSteps = [ singleStep || false ];
		this.xNumSteps = [ false ];
		this.xHighestCompleteStep = [];

		this.snap = snap;
		this.direction = direction;

		var index, ordered = [ /* [0, 'min'], [1, '50%'], [2, 'max'] */ ];

		// Map the object keys to an array.
		for ( index in entry ) {
			if ( entry.hasOwnProperty(index) ) {
				ordered.push([entry[index], index]);
			}
		}

		// Sort all entries by value (numeric sort).
		if ( ordered.length && typeof ordered[0][0] === "object" ) {
			ordered.sort(function(a, b) { return a[0][0] - b[0][0]; });
		} else {
			ordered.sort(function(a, b) { return a[0] - b[0]; });
		}


		// Convert all entries to subranges.
		for ( index = 0; index < ordered.length; index++ ) {
			handleEntryPoint(ordered[index][1], ordered[index][0], this);
		}

		// Store the actual step values.
		// xSteps is sorted in the same order as xPct and xVal.
		this.xNumSteps = this.xSteps.slice(0);

		// Convert all numeric steps to the percentage of the subrange they represent.
		for ( index = 0; index < this.xNumSteps.length; index++ ) {
			handleStepPoint(index, this.xNumSteps[index], this);
		}
	}

	Spectrum.prototype.getMargin = function ( value ) {

		var step = this.xNumSteps[0];

		if ( step && ((value / step) % 1) !== 0 ) {
			throw new Error("noUiSlider (" + VERSION + "): 'limit', 'margin' and 'padding' must be divisible by step.");
		}

		return this.xPct.length === 2 ? fromPercentage(this.xVal, value) : false;
	};

	Spectrum.prototype.toStepping = function ( value ) {

		value = toStepping( this.xVal, this.xPct, value );

		return value;
	};

	Spectrum.prototype.fromStepping = function ( value ) {

		return fromStepping( this.xVal, this.xPct, value );
	};

	Spectrum.prototype.getStep = function ( value ) {

		value = getStep(this.xPct, this.xSteps, this.snap, value );

		return value;
	};

	Spectrum.prototype.getNearbySteps = function ( value ) {

		var j = getJ(value, this.xPct);

		return {
			stepBefore: { startValue: this.xVal[j-2], step: this.xNumSteps[j-2], highestStep: this.xHighestCompleteStep[j-2] },
			thisStep: { startValue: this.xVal[j-1], step: this.xNumSteps[j-1], highestStep: this.xHighestCompleteStep[j-1] },
			stepAfter: { startValue: this.xVal[j-0], step: this.xNumSteps[j-0], highestStep: this.xHighestCompleteStep[j-0] }
		};
	};

	Spectrum.prototype.countStepDecimals = function () {
		var stepDecimals = this.xNumSteps.map(countDecimals);
		return Math.max.apply(null, stepDecimals);
 	};

	// Outside testing
	Spectrum.prototype.convert = function ( value ) {
		return this.getStep(this.toStepping(value));
	};

/*	Every input option is tested and parsed. This'll prevent
	endless validation in internal methods. These tests are
	structured with an item for every option available. An
	option can be marked as required by setting the 'r' flag.
	The testing function is provided with three arguments:
		- The provided value for the option;
		- A reference to the options object;
		- The name for the option;

	The testing function returns false when an error is detected,
	or true when everything is OK. It can also modify the option
	object, to make sure all values can be correctly looped elsewhere. */

	var defaultFormatter = { 'to': function( value ){
		return value !== undefined && value.toFixed(2);
	}, 'from': Number };

	function testStep ( parsed, entry ) {

		if ( !isNumeric( entry ) ) {
			throw new Error("noUiSlider (" + VERSION + "): 'step' is not numeric.");
		}

		// The step option can still be used to set stepping
		// for linear sliders. Overwritten if set in 'range'.
		parsed.singleStep = entry;
	}

	function testRange ( parsed, entry ) {

		// Filter incorrect input.
		if ( typeof entry !== 'object' || Array.isArray(entry) ) {
			throw new Error("noUiSlider (" + VERSION + "): 'range' is not an object.");
		}

		// Catch missing start or end.
		if ( entry.min === undefined || entry.max === undefined ) {
			throw new Error("noUiSlider (" + VERSION + "): Missing 'min' or 'max' in 'range'.");
		}

		// Catch equal start or end.
		if ( entry.min === entry.max ) {
			throw new Error("noUiSlider (" + VERSION + "): 'range' 'min' and 'max' cannot be equal.");
		}

		parsed.spectrum = new Spectrum(entry, parsed.snap, parsed.dir, parsed.singleStep);
	}

	function testStart ( parsed, entry ) {

		entry = asArray(entry);

		// Validate input. Values aren't tested, as the public .val method
		// will always provide a valid location.
		if ( !Array.isArray( entry ) || !entry.length ) {
			throw new Error("noUiSlider (" + VERSION + "): 'start' option is incorrect.");
		}

		// Store the number of handles.
		parsed.handles = entry.length;

		// When the slider is initialized, the .val method will
		// be called with the start options.
		parsed.start = entry;
	}

	function testSnap ( parsed, entry ) {

		// Enforce 100% stepping within subranges.
		parsed.snap = entry;

		if ( typeof entry !== 'boolean' ){
			throw new Error("noUiSlider (" + VERSION + "): 'snap' option must be a boolean.");
		}
	}

	function testAnimate ( parsed, entry ) {

		// Enforce 100% stepping within subranges.
		parsed.animate = entry;

		if ( typeof entry !== 'boolean' ){
			throw new Error("noUiSlider (" + VERSION + "): 'animate' option must be a boolean.");
		}
	}

	function testAnimationDuration ( parsed, entry ) {

		parsed.animationDuration = entry;

		if ( typeof entry !== 'number' ){
			throw new Error("noUiSlider (" + VERSION + "): 'animationDuration' option must be a number.");
		}
	}

	function testConnect ( parsed, entry ) {

		var connect = [false];
		var i;

		// Map legacy options
		if ( entry === 'lower' ) {
			entry = [true, false];
		}

		else if ( entry === 'upper' ) {
			entry = [false, true];
		}

		// Handle boolean options
		if ( entry === true || entry === false ) {

			for ( i = 1; i < parsed.handles; i++ ) {
				connect.push(entry);
			}

			connect.push(false);
		}

		// Reject invalid input
		else if ( !Array.isArray( entry ) || !entry.length || entry.length !== parsed.handles + 1 ) {
			throw new Error("noUiSlider (" + VERSION + "): 'connect' option doesn't match handle count.");
		}

		else {
			connect = entry;
		}

		parsed.connect = connect;
	}

	function testOrientation ( parsed, entry ) {

		// Set orientation to an a numerical value for easy
		// array selection.
		switch ( entry ){
		  case 'horizontal':
			parsed.ort = 0;
			break;
		  case 'vertical':
			parsed.ort = 1;
			break;
		  default:
			throw new Error("noUiSlider (" + VERSION + "): 'orientation' option is invalid.");
		}
	}

	function testMargin ( parsed, entry ) {

		if ( !isNumeric(entry) ){
			throw new Error("noUiSlider (" + VERSION + "): 'margin' option must be numeric.");
		}

		// Issue #582
		if ( entry === 0 ) {
			return;
		}

		parsed.margin = parsed.spectrum.getMargin(entry);

		if ( !parsed.margin ) {
			throw new Error("noUiSlider (" + VERSION + "): 'margin' option is only supported on linear sliders.");
		}
	}

	function testLimit ( parsed, entry ) {

		if ( !isNumeric(entry) ){
			throw new Error("noUiSlider (" + VERSION + "): 'limit' option must be numeric.");
		}

		parsed.limit = parsed.spectrum.getMargin(entry);

		if ( !parsed.limit || parsed.handles < 2 ) {
			throw new Error("noUiSlider (" + VERSION + "): 'limit' option is only supported on linear sliders with 2 or more handles.");
		}
	}

	function testPadding ( parsed, entry ) {

		if ( !isNumeric(entry) ){
			throw new Error("noUiSlider (" + VERSION + "): 'padding' option must be numeric.");
		}

		if ( entry === 0 ) {
			return;
		}

		parsed.padding = parsed.spectrum.getMargin(entry);

		if ( !parsed.padding ) {
			throw new Error("noUiSlider (" + VERSION + "): 'padding' option is only supported on linear sliders.");
		}

		if ( parsed.padding < 0 ) {
			throw new Error("noUiSlider (" + VERSION + "): 'padding' option must be a positive number.");
		}

		if ( parsed.padding >= 50 ) {
			throw new Error("noUiSlider (" + VERSION + "): 'padding' option must be less than half the range.");
		}
	}

	function testDirection ( parsed, entry ) {

		// Set direction as a numerical value for easy parsing.
		// Invert connection for RTL sliders, so that the proper
		// handles get the connect/background classes.
		switch ( entry ) {
		  case 'ltr':
			parsed.dir = 0;
			break;
		  case 'rtl':
			parsed.dir = 1;
			break;
		  default:
			throw new Error("noUiSlider (" + VERSION + "): 'direction' option was not recognized.");
		}
	}

	function testBehaviour ( parsed, entry ) {

		// Make sure the input is a string.
		if ( typeof entry !== 'string' ) {
			throw new Error("noUiSlider (" + VERSION + "): 'behaviour' must be a string containing options.");
		}

		// Check if the string contains any keywords.
		// None are required.
		var tap = entry.indexOf('tap') >= 0;
		var drag = entry.indexOf('drag') >= 0;
		var fixed = entry.indexOf('fixed') >= 0;
		var snap = entry.indexOf('snap') >= 0;
		var hover = entry.indexOf('hover') >= 0;

		if ( fixed ) {

			if ( parsed.handles !== 2 ) {
				throw new Error("noUiSlider (" + VERSION + "): 'fixed' behaviour must be used with 2 handles");
			}

			// Use margin to enforce fixed state
			testMargin(parsed, parsed.start[1] - parsed.start[0]);
		}

		parsed.events = {
			tap: tap || snap,
			drag: drag,
			fixed: fixed,
			snap: snap,
			hover: hover
		};
	}

	function testTooltips ( parsed, entry ) {

		if ( entry === false ) {
			return;
		}

		else if ( entry === true ) {

			parsed.tooltips = [];

			for ( var i = 0; i < parsed.handles; i++ ) {
				parsed.tooltips.push(true);
			}
		}

		else {

			parsed.tooltips = asArray(entry);

			if ( parsed.tooltips.length !== parsed.handles ) {
				throw new Error("noUiSlider (" + VERSION + "): must pass a formatter for all handles.");
			}

			parsed.tooltips.forEach(function(formatter){
				if ( typeof formatter !== 'boolean' && (typeof formatter !== 'object' || typeof formatter.to !== 'function') ) {
					throw new Error("noUiSlider (" + VERSION + "): 'tooltips' must be passed a formatter or 'false'.");
				}
			});
		}
	}

	function testFormat ( parsed, entry ) {

		parsed.format = entry;

		// Any object with a to and from method is supported.
		if ( typeof entry.to === 'function' && typeof entry.from === 'function' ) {
			return true;
		}

		throw new Error("noUiSlider (" + VERSION + "): 'format' requires 'to' and 'from' methods.");
	}

	function testCssPrefix ( parsed, entry ) {

		if ( entry !== undefined && typeof entry !== 'string' && entry !== false ) {
			throw new Error("noUiSlider (" + VERSION + "): 'cssPrefix' must be a string or `false`.");
		}

		parsed.cssPrefix = entry;
	}

	function testCssClasses ( parsed, entry ) {

		if ( entry !== undefined && typeof entry !== 'object' ) {
			throw new Error("noUiSlider (" + VERSION + "): 'cssClasses' must be an object.");
		}

		if ( typeof parsed.cssPrefix === 'string' ) {
			parsed.cssClasses = {};

			for ( var key in entry ) {
				if ( !entry.hasOwnProperty(key) ) { continue; }

				parsed.cssClasses[key] = parsed.cssPrefix + entry[key];
			}
		} else {
			parsed.cssClasses = entry;
		}
	}

	function testUseRaf ( parsed, entry ) {
		if ( entry === true || entry === false ) {
			parsed.useRequestAnimationFrame = entry;
		} else {
			throw new Error("noUiSlider (" + VERSION + "): 'useRequestAnimationFrame' option should be true (default) or false.");
		}
	}

	// Test all developer settings and parse to assumption-safe values.
	function testOptions ( options ) {

		// To prove a fix for #537, freeze options here.
		// If the object is modified, an error will be thrown.
		// Object.freeze(options);

		var parsed = {
			margin: 0,
			limit: 0,
			padding: 0,
			animate: true,
			animationDuration: 300,
			format: defaultFormatter
		};

		// Tests are executed in the order they are presented here.
		var tests = {
			'step': { r: false, t: testStep },
			'start': { r: true, t: testStart },
			'connect': { r: true, t: testConnect },
			'direction': { r: true, t: testDirection },
			'snap': { r: false, t: testSnap },
			'animate': { r: false, t: testAnimate },
			'animationDuration': { r: false, t: testAnimationDuration },
			'range': { r: true, t: testRange },
			'orientation': { r: false, t: testOrientation },
			'margin': { r: false, t: testMargin },
			'limit': { r: false, t: testLimit },
			'padding': { r: false, t: testPadding },
			'behaviour': { r: true, t: testBehaviour },
			'format': { r: false, t: testFormat },
			'tooltips': { r: false, t: testTooltips },
			'cssPrefix': { r: false, t: testCssPrefix },
			'cssClasses': { r: false, t: testCssClasses },
			'useRequestAnimationFrame': { r: false, t: testUseRaf }
		};

		var defaults = {
			'connect': false,
			'direction': 'ltr',
			'behaviour': 'tap',
			'orientation': 'horizontal',
			'cssPrefix' : 'noUi-',
			'cssClasses': {
				target: 'target',
				base: 'base',
				origin: 'origin',
				handle: 'handle',
				handleLower: 'handle-lower',
				handleUpper: 'handle-upper',
				horizontal: 'horizontal',
				vertical: 'vertical',
				background: 'background',
				connect: 'connect',
				ltr: 'ltr',
				rtl: 'rtl',
				draggable: 'draggable',
				drag: 'state-drag',
				tap: 'state-tap',
				active: 'active',
				tooltip: 'tooltip',
				pips: 'pips',
				pipsHorizontal: 'pips-horizontal',
				pipsVertical: 'pips-vertical',
				marker: 'marker',
				markerHorizontal: 'marker-horizontal',
				markerVertical: 'marker-vertical',
				markerNormal: 'marker-normal',
				markerLarge: 'marker-large',
				markerSub: 'marker-sub',
				value: 'value',
				valueHorizontal: 'value-horizontal',
				valueVertical: 'value-vertical',
				valueNormal: 'value-normal',
				valueLarge: 'value-large',
				valueSub: 'value-sub'
			},
			'useRequestAnimationFrame': true
		};

		// Run all options through a testing mechanism to ensure correct
		// input. It should be noted that options might get modified to
		// be handled properly. E.g. wrapping integers in arrays.
		Object.keys(tests).forEach(function( name ){

			// If the option isn't set, but it is required, throw an error.
			if ( options[name] === undefined && defaults[name] === undefined ) {

				if ( tests[name].r ) {
					throw new Error("noUiSlider (" + VERSION + "): '" + name + "' is required.");
				}

				return true;
			}

			tests[name].t( parsed, options[name] === undefined ? defaults[name] : options[name] );
		});

		// Forward pips options
		parsed.pips = options.pips;

		var styles = [['left', 'top'], ['right', 'bottom']];

		// Pre-define the styles.
		parsed.style = styles[parsed.dir][parsed.ort];
		parsed.styleOposite = styles[parsed.dir?0:1][parsed.ort];

		return parsed;
	}


function closure ( target, options, originalOptions ){

	var actions = getActions( );

	// All variables local to 'closure' are prefixed with 'scope_'
	var scope_Target = target;
	var scope_Locations = [];
	var scope_Base;
	var scope_Handles;
	var scope_HandleNumbers = [];
	var scope_ActiveHandle = false;
	var scope_Connects;
	var scope_Spectrum = options.spectrum;
	var scope_Values = [];
	var scope_Events = {};
	var scope_Self;


	// Append a origin to the base
	function addOrigin ( base, handleNumber ) {

		var origin = addNodeTo(base, options.cssClasses.origin);
		var handle = addNodeTo(origin, options.cssClasses.handle);

		handle.setAttribute('data-handle', handleNumber);

		if ( handleNumber === 0 ) {
			addClass(handle, options.cssClasses.handleLower);
		}

		else if ( handleNumber === options.handles - 1 ) {
			addClass(handle, options.cssClasses.handleUpper);
		}

		return origin;
	}

	// Insert nodes for connect elements
	function addConnect ( base, add ) {

		if ( !add ) {
			return false;
		}

		return addNodeTo(base, options.cssClasses.connect);
	}

	// Add handles to the slider base.
	function addElements ( connectOptions, base ) {

		scope_Handles = [];
		scope_Connects = [];

		scope_Connects.push(addConnect(base, connectOptions[0]));

		// [::::O====O====O====]
		// connectOptions = [0, 1, 1, 1]

		for ( var i = 0; i < options.handles; i++ ) {
			// Keep a list of all added handles.
			scope_Handles.push(addOrigin(base, i));
			scope_HandleNumbers[i] = i;
			scope_Connects.push(addConnect(base, connectOptions[i + 1]));
		}
	}

	// Initialize a single slider.
	function addSlider ( target ) {

		// Apply classes and data to the target.
		addClass(target, options.cssClasses.target);

		if ( options.dir === 0 ) {
			addClass(target, options.cssClasses.ltr);
		} else {
			addClass(target, options.cssClasses.rtl);
		}

		if ( options.ort === 0 ) {
			addClass(target, options.cssClasses.horizontal);
		} else {
			addClass(target, options.cssClasses.vertical);
		}

		scope_Base = addNodeTo(target, options.cssClasses.base);
	}


	function addTooltip ( handle, handleNumber ) {

		if ( !options.tooltips[handleNumber] ) {
			return false;
		}

		return addNodeTo(handle.firstChild, options.cssClasses.tooltip);
	}

	// The tooltips option is a shorthand for using the 'update' event.
	function tooltips ( ) {

		// Tooltips are added with options.tooltips in original order.
		var tips = scope_Handles.map(addTooltip);

		bindEvent('update', function(values, handleNumber, unencoded) {

			if ( !tips[handleNumber] ) {
				return;
			}

			var formattedValue = values[handleNumber];

			if ( options.tooltips[handleNumber] !== true ) {
				formattedValue = options.tooltips[handleNumber].to(unencoded[handleNumber]);
			}

			tips[handleNumber].innerHTML = formattedValue;
		});
	}


	function getGroup ( mode, values, stepped ) {

		// Use the range.
		if ( mode === 'range' || mode === 'steps' ) {
			return scope_Spectrum.xVal;
		}

		if ( mode === 'count' ) {

			if ( !values ) {
				throw new Error("noUiSlider (" + VERSION + "): 'values' required for mode 'count'.");
			}

			// Divide 0 - 100 in 'count' parts.
			var spread = ( 100 / (values - 1) );
			var v;
			var i = 0;

			values = [];

			// List these parts and have them handled as 'positions'.
			while ( (v = i++ * spread) <= 100 ) {
				values.push(v);
			}

			mode = 'positions';
		}

		if ( mode === 'positions' ) {

			// Map all percentages to on-range values.
			return values.map(function( value ){
				return scope_Spectrum.fromStepping( stepped ? scope_Spectrum.getStep( value ) : value );
			});
		}

		if ( mode === 'values' ) {

			// If the value must be stepped, it needs to be converted to a percentage first.
			if ( stepped ) {

				return values.map(function( value ){

					// Convert to percentage, apply step, return to value.
					return scope_Spectrum.fromStepping( scope_Spectrum.getStep( scope_Spectrum.toStepping( value ) ) );
				});

			}

			// Otherwise, we can simply use the values.
			return values;
		}
	}

	function generateSpread ( density, mode, group ) {

		function safeIncrement(value, increment) {
			// Avoid floating point variance by dropping the smallest decimal places.
			return (value + increment).toFixed(7) / 1;
		}

		var indexes = {};
		var firstInRange = scope_Spectrum.xVal[0];
		var lastInRange = scope_Spectrum.xVal[scope_Spectrum.xVal.length-1];
		var ignoreFirst = false;
		var ignoreLast = false;
		var prevPct = 0;

		// Create a copy of the group, sort it and filter away all duplicates.
		group = unique(group.slice().sort(function(a, b){ return a - b; }));

		// Make sure the range starts with the first element.
		if ( group[0] !== firstInRange ) {
			group.unshift(firstInRange);
			ignoreFirst = true;
		}

		// Likewise for the last one.
		if ( group[group.length - 1] !== lastInRange ) {
			group.push(lastInRange);
			ignoreLast = true;
		}

		group.forEach(function ( current, index ) {

			// Get the current step and the lower + upper positions.
			var step;
			var i;
			var q;
			var low = current;
			var high = group[index+1];
			var newPct;
			var pctDifference;
			var pctPos;
			var type;
			var steps;
			var realSteps;
			var stepsize;

			// When using 'steps' mode, use the provided steps.
			// Otherwise, we'll step on to the next subrange.
			if ( mode === 'steps' ) {
				step = scope_Spectrum.xNumSteps[ index ];
			}

			// Default to a 'full' step.
			if ( !step ) {
				step = high-low;
			}

			// Low can be 0, so test for false. If high is undefined,
			// we are at the last subrange. Index 0 is already handled.
			if ( low === false || high === undefined ) {
				return;
			}

			// Make sure step isn't 0, which would cause an infinite loop (#654)
			step = Math.max(step, 0.0000001);

			// Find all steps in the subrange.
			for ( i = low; i <= high; i = safeIncrement(i, step) ) {

				// Get the percentage value for the current step,
				// calculate the size for the subrange.
				newPct = scope_Spectrum.toStepping( i );
				pctDifference = newPct - prevPct;

				steps = pctDifference / density;
				realSteps = Math.round(steps);

				// This ratio represents the ammount of percentage-space a point indicates.
				// For a density 1 the points/percentage = 1. For density 2, that percentage needs to be re-devided.
				// Round the percentage offset to an even number, then divide by two
				// to spread the offset on both sides of the range.
				stepsize = pctDifference/realSteps;

				// Divide all points evenly, adding the correct number to this subrange.
				// Run up to <= so that 100% gets a point, event if ignoreLast is set.
				for ( q = 1; q <= realSteps; q += 1 ) {

					// The ratio between the rounded value and the actual size might be ~1% off.
					// Correct the percentage offset by the number of points
					// per subrange. density = 1 will result in 100 points on the
					// full range, 2 for 50, 4 for 25, etc.
					pctPos = prevPct + ( q * stepsize );
					indexes[pctPos.toFixed(5)] = ['x', 0];
				}

				// Determine the point type.
				type = (group.indexOf(i) > -1) ? 1 : ( mode === 'steps' ? 2 : 0 );

				// Enforce the 'ignoreFirst' option by overwriting the type for 0.
				if ( !index && ignoreFirst ) {
					type = 0;
				}

				if ( !(i === high && ignoreLast)) {
					// Mark the 'type' of this point. 0 = plain, 1 = real value, 2 = step value.
					indexes[newPct.toFixed(5)] = [i, type];
				}

				// Update the percentage count.
				prevPct = newPct;
			}
		});

		return indexes;
	}

	function addMarking ( spread, filterFunc, formatter ) {

		var element = document.createElement('div');
		var out = '';
		var valueSizeClasses = [
			options.cssClasses.valueNormal,
			options.cssClasses.valueLarge,
			options.cssClasses.valueSub
		];
		var markerSizeClasses = [
			options.cssClasses.markerNormal,
			options.cssClasses.markerLarge,
			options.cssClasses.markerSub
		];
		var valueOrientationClasses = [
			options.cssClasses.valueHorizontal,
			options.cssClasses.valueVertical
		];
		var markerOrientationClasses = [
			options.cssClasses.markerHorizontal,
			options.cssClasses.markerVertical
		];

		addClass(element, options.cssClasses.pips);
		addClass(element, options.ort === 0 ? options.cssClasses.pipsHorizontal : options.cssClasses.pipsVertical);

		function getClasses( type, source ){
			var a = source === options.cssClasses.value;
			var orientationClasses = a ? valueOrientationClasses : markerOrientationClasses;
			var sizeClasses = a ? valueSizeClasses : markerSizeClasses;

			return source + ' ' + orientationClasses[options.ort] + ' ' + sizeClasses[type];
		}

		function getTags( offset, source, values ) {
			return 'class="' + getClasses(values[1], source) + '" style="' + options.style + ': ' + offset + '%"';
		}

		function addSpread ( offset, values ){

			// Apply the filter function, if it is set.
			values[1] = (values[1] && filterFunc) ? filterFunc(values[0], values[1]) : values[1];

			// Add a marker for every point
			out += '<div ' + getTags(offset, options.cssClasses.marker, values) + '></div>';

			// Values are only appended for points marked '1' or '2'.
			if ( values[1] ) {
				out += '<div ' + getTags(offset, options.cssClasses.value, values) + '>' + formatter.to(values[0]) + '</div>';
			}
		}

		// Append all points.
		Object.keys(spread).forEach(function(a){
			addSpread(a, spread[a]);
		});

		element.innerHTML = out;

		return element;
	}

	function pips ( grid ) {

		var mode = grid.mode;
		var density = grid.density || 1;
		var filter = grid.filter || false;
		var values = grid.values || false;
		var stepped = grid.stepped || false;
		var group = getGroup( mode, values, stepped );
		var spread = generateSpread( density, mode, group );
		var format = grid.format || {
			to: Math.round
		};

		return scope_Target.appendChild(addMarking(
			spread,
			filter,
			format
		));
	}


	// Shorthand for base dimensions.
	function baseSize ( ) {
		var rect = scope_Base.getBoundingClientRect(), alt = 'offset' + ['Width', 'Height'][options.ort];
		return options.ort === 0 ? (rect.width||scope_Base[alt]) : (rect.height||scope_Base[alt]);
	}

	// Handler for attaching events trough a proxy.
	function attachEvent ( events, element, callback, data ) {

		// This function can be used to 'filter' events to the slider.
		// element is a node, not a nodeList

		var method = function ( e ){

			if ( scope_Target.hasAttribute('disabled') ) {
				return false;
			}

			// Stop if an active 'tap' transition is taking place.
			if ( hasClass(scope_Target, options.cssClasses.tap) ) {
				return false;
			}

			e = fixEvent(e, data.pageOffset);

			// Handle reject of multitouch
			if ( !e ) {
				return false;
			}

			// Ignore right or middle clicks on start #454
			if ( events === actions.start && e.buttons !== undefined && e.buttons > 1 ) {
				return false;
			}

			// Ignore right or middle clicks on start #454
			if ( data.hover && e.buttons ) {
				return false;
			}

			e.calcPoint = e.points[ options.ort ];

			// Call the event handler with the event [ and additional data ].
			callback ( e, data );
		};

		var methods = [];

		// Bind a closure on the target for every event type.
		events.split(' ').forEach(function( eventName ){
			element.addEventListener(eventName, method, false);
			methods.push([eventName, method]);
		});

		return methods;
	}

	// Provide a clean event with standardized offset values.
	function fixEvent ( e, pageOffset ) {

		// Prevent scrolling and panning on touch events, while
		// attempting to slide. The tap event also depends on this.
		e.preventDefault();

		// Filter the event to register the type, which can be
		// touch, mouse or pointer. Offset changes need to be
		// made on an event specific basis.
		var touch = e.type.indexOf('touch') === 0;
		var mouse = e.type.indexOf('mouse') === 0;
		var pointer = e.type.indexOf('pointer') === 0;
		var x;
		var y;

		// IE10 implemented pointer events with a prefix;
		if ( e.type.indexOf('MSPointer') === 0 ) {
			pointer = true;
		}

		if ( touch ) {

			// Fix bug when user touches with two or more fingers on mobile devices.
			// It's useful when you have two or more sliders on one page,
			// that can be touched simultaneously.
			// #649, #663, #668
			if ( e.touches.length > 1 ) {
				return false;
			}

			// noUiSlider supports one movement at a time,
			// so we can select the first 'changedTouch'.
			x = e.changedTouches[0].pageX;
			y = e.changedTouches[0].pageY;
		}

		pageOffset = pageOffset || getPageOffset();

		if ( mouse || pointer ) {
			x = e.clientX + pageOffset.x;
			y = e.clientY + pageOffset.y;
		}

		e.pageOffset = pageOffset;
		e.points = [x, y];
		e.cursor = mouse || pointer; // Fix #435

		return e;
	}

	// Translate a coordinate in the document to a percentage on the slider
	function calcPointToPercentage ( calcPoint ) {
		var location = calcPoint - offset(scope_Base, options.ort);
		var proposal = ( location * 100 ) / baseSize();
		return options.dir ? 100 - proposal : proposal;
	}

	// Find handle closest to a certain percentage on the slider
	function getClosestHandle ( proposal ) {

		var closest = 100;
		var handleNumber = false;

		scope_Handles.forEach(function(handle, index){

			// Disabled handles are ignored
			if ( handle.hasAttribute('disabled') ) {
				return;
			}

			var pos = Math.abs(scope_Locations[index] - proposal);

			if ( pos < closest ) {
				handleNumber = index;
				closest = pos;
			}
		});

		return handleNumber;
	}

	// Moves handle(s) by a percentage
	// (bool, % to move, [% where handle started, ...], [index in scope_Handles, ...])
	function moveHandles ( upward, proposal, locations, handleNumbers ) {

		var proposals = locations.slice();

		var b = [!upward, upward];
		var f = [upward, !upward];

		// Copy handleNumbers so we don't change the dataset
		handleNumbers = handleNumbers.slice();

		// Check to see which handle is 'leading'.
		// If that one can't move the second can't either.
		if ( upward ) {
			handleNumbers.reverse();
		}

		// Step 1: get the maximum percentage that any of the handles can move
		if ( handleNumbers.length > 1 ) {

			handleNumbers.forEach(function(handleNumber, o) {

				var to = checkHandlePosition(proposals, handleNumber, proposals[handleNumber] + proposal, b[o], f[o]);

				// Stop if one of the handles can't move.
				if ( to === false ) {
					proposal = 0;
				} else {
					proposal = to - proposals[handleNumber];
					proposals[handleNumber] = to;
				}
			});
		}

		// If using one handle, check backward AND forward
		else {
			b = f = [true];
		}

		var state = false;

		// Step 2: Try to set the handles with the found percentage
		handleNumbers.forEach(function(handleNumber, o) {
			state = setHandle(handleNumber, locations[handleNumber] + proposal, b[o], f[o]) || state;
		});

		// Step 3: If a handle moved, fire events
		if ( state ) {
			handleNumbers.forEach(function(handleNumber){
				fireEvent('update', handleNumber);
				fireEvent('slide', handleNumber);
			});
		}
	}

	// External event handling
	function fireEvent ( eventName, handleNumber, tap ) {

		Object.keys(scope_Events).forEach(function( targetEvent ) {

			var eventType = targetEvent.split('.')[0];

			if ( eventName === eventType ) {
				scope_Events[targetEvent].forEach(function( callback ) {

					callback.call(
						// Use the slider public API as the scope ('this')
						scope_Self,
						// Return values as array, so arg_1[arg_2] is always valid.
						scope_Values.map(options.format.to),
						// Handle index, 0 or 1
						handleNumber,
						// Unformatted slider values
						scope_Values.slice(),
						// Event is fired by tap, true or false
						tap || false,
						// Left offset of the handle, in relation to the slider
						scope_Locations.slice()
					);
				});
			}
		});
	}


	// Fire 'end' when a mouse or pen leaves the document.
	function documentLeave ( event, data ) {
		if ( event.type === "mouseout" && event.target.nodeName === "HTML" && event.relatedTarget === null ){
			eventEnd (event, data);
		}
	}

	// Handle movement on document for handle and range drag.
	function eventMove ( event, data ) {

		// Fix #498
		// Check value of .buttons in 'start' to work around a bug in IE10 mobile (data.buttonsProperty).
		// https://connect.microsoft.com/IE/feedback/details/927005/mobile-ie10-windows-phone-buttons-property-of-pointermove-event-always-zero
		// IE9 has .buttons and .which zero on mousemove.
		// Firefox breaks the spec MDN defines.
		if ( navigator.appVersion.indexOf("MSIE 9") === -1 && event.buttons === 0 && data.buttonsProperty !== 0 ) {
			return eventEnd(event, data);
		}

		// Check if we are moving up or down
		var movement = (options.dir ? -1 : 1) * (event.calcPoint - data.startCalcPoint);

		// Convert the movement into a percentage of the slider width/height
		var proposal = (movement * 100) / data.baseSize;

		moveHandles(movement > 0, proposal, data.locations, data.handleNumbers);
	}

	// Unbind move events on document, call callbacks.
	function eventEnd ( event, data ) {

		// The handle is no longer active, so remove the class.
		if ( scope_ActiveHandle ) {
			removeClass(scope_ActiveHandle, options.cssClasses.active);
			scope_ActiveHandle = false;
		}

		// Remove cursor styles and text-selection events bound to the body.
		if ( event.cursor ) {
			document.body.style.cursor = '';
			document.body.removeEventListener('selectstart', document.body.noUiListener);
		}

		// Unbind the move and end events, which are added on 'start'.
		document.documentElement.noUiListeners.forEach(function( c ) {
			document.documentElement.removeEventListener(c[0], c[1]);
		});

		// Remove dragging class.
		removeClass(scope_Target, options.cssClasses.drag);

		setZindex();

		data.handleNumbers.forEach(function(handleNumber){
			fireEvent('set', handleNumber);
			fireEvent('change', handleNumber);
			fireEvent('end', handleNumber);
		});
	}

	// Bind move events on document.
	function eventStart ( event, data ) {

		if ( data.handleNumbers.length === 1 ) {

			var handle = scope_Handles[data.handleNumbers[0]];

			// Ignore 'disabled' handles
			if ( handle.hasAttribute('disabled') ) {
				return false;
			}

			// Mark the handle as 'active' so it can be styled.
			scope_ActiveHandle = handle.children[0];
			addClass(scope_ActiveHandle, options.cssClasses.active);
		}

		// Fix #551, where a handle gets selected instead of dragged.
		event.preventDefault();

		// A drag should never propagate up to the 'tap' event.
		event.stopPropagation();

		// Attach the move and end events.
		var moveEvent = attachEvent(actions.move, document.documentElement, eventMove, {
			startCalcPoint: event.calcPoint,
			baseSize: baseSize(),
			pageOffset: event.pageOffset,
			handleNumbers: data.handleNumbers,
			buttonsProperty: event.buttons,
			locations: scope_Locations.slice()
		});

		var endEvent = attachEvent(actions.end, document.documentElement, eventEnd, {
			handleNumbers: data.handleNumbers
		});

		var outEvent = attachEvent("mouseout", document.documentElement, documentLeave, {
			handleNumbers: data.handleNumbers
		});

		document.documentElement.noUiListeners = moveEvent.concat(endEvent, outEvent);

		// Text selection isn't an issue on touch devices,
		// so adding cursor styles can be skipped.
		if ( event.cursor ) {

			// Prevent the 'I' cursor and extend the range-drag cursor.
			document.body.style.cursor = getComputedStyle(event.target).cursor;

			// Mark the target with a dragging state.
			if ( scope_Handles.length > 1 ) {
				addClass(scope_Target, options.cssClasses.drag);
			}

			var f = function(){
				return false;
			};

			document.body.noUiListener = f;

			// Prevent text selection when dragging the handles.
			document.body.addEventListener('selectstart', f, false);
		}

		data.handleNumbers.forEach(function(handleNumber){
			fireEvent('start', handleNumber);
		});
	}

	// Move closest handle to tapped location.
	function eventTap ( event ) {

		// The tap event shouldn't propagate up
		event.stopPropagation();

		var proposal = calcPointToPercentage(event.calcPoint);
		var handleNumber = getClosestHandle(proposal);

		// Tackle the case that all handles are 'disabled'.
		if ( handleNumber === false ) {
			return false;
		}

		// Flag the slider as it is now in a transitional state.
		// Transition takes a configurable amount of ms (default 300). Re-enable the slider after that.
		if ( !options.events.snap ) {
			addClassFor(scope_Target, options.cssClasses.tap, options.animationDuration);
		}

		setHandle(handleNumber, proposal, true, true);

		setZindex();

		fireEvent('slide', handleNumber, true);
		fireEvent('set', handleNumber, true);
		fireEvent('change', handleNumber, true);
		fireEvent('update', handleNumber, true);

		if ( options.events.snap ) {
			eventStart(event, { handleNumbers: [handleNumber] });
		}
	}

	// Fires a 'hover' event for a hovered mouse/pen position.
	function eventHover ( event ) {

		var proposal = calcPointToPercentage(event.calcPoint);

		var to = scope_Spectrum.getStep(proposal);
		var value = scope_Spectrum.fromStepping(to);

		Object.keys(scope_Events).forEach(function( targetEvent ) {
			if ( 'hover' === targetEvent.split('.')[0] ) {
				scope_Events[targetEvent].forEach(function( callback ) {
					callback.call( scope_Self, value );
				});
			}
		});
	}

	// Attach events to several slider parts.
	function bindSliderEvents ( behaviour ) {

		// Attach the standard drag event to the handles.
		if ( !behaviour.fixed ) {

			scope_Handles.forEach(function( handle, index ){

				// These events are only bound to the visual handle
				// element, not the 'real' origin element.
				attachEvent ( actions.start, handle.children[0], eventStart, {
					handleNumbers: [index]
				});
			});
		}

		// Attach the tap event to the slider base.
		if ( behaviour.tap ) {
			attachEvent (actions.start, scope_Base, eventTap, {});
		}

		// Fire hover events
		if ( behaviour.hover ) {
			attachEvent (actions.move, scope_Base, eventHover, { hover: true });
		}

		// Make the range draggable.
		if ( behaviour.drag ){

			scope_Connects.forEach(function( connect, index ){

				if ( connect === false || index === 0 || index === scope_Connects.length - 1 ) {
					return;
				}

				var handleBefore = scope_Handles[index - 1];
				var handleAfter = scope_Handles[index];
				var eventHolders = [connect];

				addClass(connect, options.cssClasses.draggable);

				// When the range is fixed, the entire range can
				// be dragged by the handles. The handle in the first
				// origin will propagate the start event upward,
				// but it needs to be bound manually on the other.
				if ( behaviour.fixed ) {
					eventHolders.push(handleBefore.children[0]);
					eventHolders.push(handleAfter.children[0]);
				}

				eventHolders.forEach(function( eventHolder ) {
					attachEvent ( actions.start, eventHolder, eventStart, {
						handles: [handleBefore, handleAfter],
						handleNumbers: [index - 1, index]
					});
				});
			});
		}
	}


	// Split out the handle positioning logic so the Move event can use it, too
	function checkHandlePosition ( reference, handleNumber, to, lookBackward, lookForward ) {

		// For sliders with multiple handles, limit movement to the other handle.
		// Apply the margin option by adding it to the handle positions.
		if ( scope_Handles.length > 1 ) {

			if ( lookBackward && handleNumber > 0 ) {
				to = Math.max(to, reference[handleNumber - 1] + options.margin);
			}

			if ( lookForward && handleNumber < scope_Handles.length - 1 ) {
				to = Math.min(to, reference[handleNumber + 1] - options.margin);
			}
		}

		// The limit option has the opposite effect, limiting handles to a
		// maximum distance from another. Limit must be > 0, as otherwise
		// handles would be unmoveable.
		if ( scope_Handles.length > 1 && options.limit ) {

			if ( lookBackward && handleNumber > 0 ) {
				to = Math.min(to, reference[handleNumber - 1] + options.limit);
			}

			if ( lookForward && handleNumber < scope_Handles.length - 1 ) {
				to = Math.max(to, reference[handleNumber + 1] - options.limit);
			}
		}

		// The padding option keeps the handles a certain distance from the
		// edges of the slider. Padding must be > 0.
		if ( options.padding ) {

			if ( handleNumber === 0 ) {
				to = Math.max(to, options.padding);
			}

			if ( handleNumber === scope_Handles.length - 1 ) {
				to = Math.min(to, 100 - options.padding);
			}
		}

		to = scope_Spectrum.getStep(to);

		// Limit percentage to the 0 - 100 range
		to = limit(to);

		// Return false if handle can't move
		if ( to === reference[handleNumber] ) {
			return false;
		}

		return to;
	}

	function toPct ( pct ) {
		return pct + '%';
	}

	// Updates scope_Locations and scope_Values, updates visual state
	function updateHandlePosition ( handleNumber, to ) {

		// Update locations.
		scope_Locations[handleNumber] = to;

		// Convert the value to the slider stepping/range.
		scope_Values[handleNumber] = scope_Spectrum.fromStepping(to);

		// Called synchronously or on the next animationFrame
		var stateUpdate = function() {
			scope_Handles[handleNumber].style[options.style] = toPct(to);
			updateConnect(handleNumber);
			updateConnect(handleNumber + 1);
		};

		// Set the handle to the new position.
		// Use requestAnimationFrame for efficient painting.
		// No significant effect in Chrome, Edge sees dramatic performace improvements.
		// Option to disable is useful for unit tests, and single-step debugging.
		if ( window.requestAnimationFrame && options.useRequestAnimationFrame ) {
			window.requestAnimationFrame(stateUpdate);
		} else {
			stateUpdate();
		}
	}

	function setZindex ( ) {

		scope_HandleNumbers.forEach(function(handleNumber){
			// Handles before the slider middle are stacked later = higher,
			// Handles after the middle later is lower
			// [[7] [8] .......... | .......... [5] [4]
			var dir = (scope_Locations[handleNumber] > 50 ? -1 : 1);
			var zIndex = 3 + (scope_Handles.length + (dir * handleNumber));
			scope_Handles[handleNumber].childNodes[0].style.zIndex = zIndex;
		});
	}

	// Test suggested values and apply margin, step.
	function setHandle ( handleNumber, to, lookBackward, lookForward ) {

		to = checkHandlePosition(scope_Locations, handleNumber, to, lookBackward, lookForward);

		if ( to === false ) {
			return false;
		}

		updateHandlePosition(handleNumber, to);

		return true;
	}

	// Updates style attribute for connect nodes
	function updateConnect ( index ) {

		// Skip connects set to false
		if ( !scope_Connects[index] ) {
			return;
		}

		var l = 0;
		var h = 100;

		if ( index !== 0 ) {
			l = scope_Locations[index - 1];
		}

		if ( index !== scope_Connects.length - 1 ) {
			h = scope_Locations[index];
		}

		scope_Connects[index].style[options.style] = toPct(l);
		scope_Connects[index].style[options.styleOposite] = toPct(100 - h);
	}

	// ...
	function setValue ( to, handleNumber ) {

		// Setting with null indicates an 'ignore'.
		// Inputting 'false' is invalid.
		if ( to === null || to === false ) {
			return;
		}

		// If a formatted number was passed, attemt to decode it.
		if ( typeof to === 'number' ) {
			to = String(to);
		}

		to = options.format.from(to);

		// Request an update for all links if the value was invalid.
		// Do so too if setting the handle fails.
		if ( to !== false && !isNaN(to) ) {
			setHandle(handleNumber, scope_Spectrum.toStepping(to), false, false);
		}
	}

	// Set the slider value.
	function valueSet ( input, fireSetEvent ) {

		var values = asArray(input);
		var isInit = scope_Locations[0] === undefined;

		// Event fires by default
		fireSetEvent = (fireSetEvent === undefined ? true : !!fireSetEvent);

		values.forEach(setValue);

		// Animation is optional.
		// Make sure the initial values were set before using animated placement.
		if ( options.animate && !isInit ) {
			addClassFor(scope_Target, options.cssClasses.tap, options.animationDuration);
		}

		// Now that all base values are set, apply constraints
		scope_HandleNumbers.forEach(function(handleNumber){
			setHandle(handleNumber, scope_Locations[handleNumber], true, false);
		});

		setZindex();

		scope_HandleNumbers.forEach(function(handleNumber){

			fireEvent('update', handleNumber);

			// Fire the event only for handles that received a new value, as per #579
			if ( values[handleNumber] !== null && fireSetEvent ) {
				fireEvent('set', handleNumber);
			}
		});
	}

	// Reset slider to initial values
	function valueReset ( fireSetEvent ) {
		valueSet(options.start, fireSetEvent);
	}

	// Get the slider value.
	function valueGet ( ) {

		var values = scope_Values.map(options.format.to);

		// If only one handle is used, return a single value.
		if ( values.length === 1 ){
			return values[0];
		}

		return values;
	}

	// Removes classes from the root and empties it.
	function destroy ( ) {

		for ( var key in options.cssClasses ) {
			if ( !options.cssClasses.hasOwnProperty(key) ) { continue; }
			removeClass(scope_Target, options.cssClasses[key]);
		}

		while (scope_Target.firstChild) {
			scope_Target.removeChild(scope_Target.firstChild);
		}

		delete scope_Target.noUiSlider;
	}

	// Get the current step size for the slider.
	function getCurrentStep ( ) {

		// Check all locations, map them to their stepping point.
		// Get the step point, then find it in the input list.
		return scope_Locations.map(function( location, index ){

			var nearbySteps = scope_Spectrum.getNearbySteps( location );
			var value = scope_Values[index];
			var increment = nearbySteps.thisStep.step;
			var decrement = null;

			// If the next value in this step moves into the next step,
			// the increment is the start of the next step - the current value
			if ( increment !== false ) {
				if ( value + increment > nearbySteps.stepAfter.startValue ) {
					increment = nearbySteps.stepAfter.startValue - value;
				}
			}


			// If the value is beyond the starting point
			if ( value > nearbySteps.thisStep.startValue ) {
				decrement = nearbySteps.thisStep.step;
			}

			else if ( nearbySteps.stepBefore.step === false ) {
				decrement = false;
			}

			// If a handle is at the start of a step, it always steps back into the previous step first
			else {
				decrement = value - nearbySteps.stepBefore.highestStep;
			}


			// Now, if at the slider edges, there is not in/decrement
			if ( location === 100 ) {
				increment = null;
			}

			else if ( location === 0 ) {
				decrement = null;
			}

			// As per #391, the comparison for the decrement step can have some rounding issues.
			var stepDecimals = scope_Spectrum.countStepDecimals();

			// Round per #391
			if ( increment !== null && increment !== false ) {
				increment = Number(increment.toFixed(stepDecimals));
			}

			if ( decrement !== null && decrement !== false ) {
				decrement = Number(decrement.toFixed(stepDecimals));
			}

			return [decrement, increment];
		});
	}

	// Attach an event to this slider, possibly including a namespace
	function bindEvent ( namespacedEvent, callback ) {
		scope_Events[namespacedEvent] = scope_Events[namespacedEvent] || [];
		scope_Events[namespacedEvent].push(callback);

		// If the event bound is 'update,' fire it immediately for all handles.
		if ( namespacedEvent.split('.')[0] === 'update' ) {
			scope_Handles.forEach(function(a, index){
				fireEvent('update', index);
			});
		}
	}

	// Undo attachment of event
	function removeEvent ( namespacedEvent ) {

		var event = namespacedEvent && namespacedEvent.split('.')[0];
		var namespace = event && namespacedEvent.substring(event.length);

		Object.keys(scope_Events).forEach(function( bind ){

			var tEvent = bind.split('.')[0],
				tNamespace = bind.substring(tEvent.length);

			if ( (!event || event === tEvent) && (!namespace || namespace === tNamespace) ) {
				delete scope_Events[bind];
			}
		});
	}

	// Updateable: margin, limit, padding, step, range, animate, snap
	function updateOptions ( optionsToUpdate, fireSetEvent ) {

		// Spectrum is created using the range, snap, direction and step options.
		// 'snap' and 'step' can be updated, 'direction' cannot, due to event binding.
		// If 'snap' and 'step' are not passed, they should remain unchanged.
		var v = valueGet();

		var updateAble = ['margin', 'limit', 'padding', 'range', 'animate', 'snap', 'step', 'format'];

		// Only change options that we're actually passed to update.
		updateAble.forEach(function(name){
			if ( optionsToUpdate[name] !== undefined ) {
				originalOptions[name] = optionsToUpdate[name];
			}
		});

		var newOptions = testOptions(originalOptions);

		// Load new options into the slider state
		updateAble.forEach(function(name){
			if ( optionsToUpdate[name] !== undefined ) {
				options[name] = newOptions[name];
			}
		});

		// Save current spectrum direction as testOptions in testRange call
		// doesn't rely on current direction
		newOptions.spectrum.direction = scope_Spectrum.direction;
		scope_Spectrum = newOptions.spectrum;

		// Limit, margin and padding depend on the spectrum but are stored outside of it. (#677)
		options.margin = newOptions.margin;
		options.limit = newOptions.limit;
		options.padding = newOptions.padding;

		// Invalidate the current positioning so valueSet forces an update.
		scope_Locations = [];
		valueSet(optionsToUpdate.start || v, fireSetEvent);
	}

	// Throw an error if the slider was already initialized.
	if ( scope_Target.noUiSlider ) {
		throw new Error("noUiSlider (" + VERSION + "): Slider was already initialized.");
	}

	// Create the base element, initialise HTML and set classes.
	// Add handles and connect elements.
	addSlider(scope_Target);
	addElements(options.connect, scope_Base);

	scope_Self = {
		destroy: destroy,
		steps: getCurrentStep,
		on: bindEvent,
		off: removeEvent,
		get: valueGet,
		set: valueSet,
		reset: valueReset,
		// Exposed for unit testing, don't use this in your application.
		__moveHandles: function(a, b, c) { moveHandles(a, b, scope_Locations, c); },
		options: originalOptions, // Issue #600, #678
		updateOptions: updateOptions,
		target: scope_Target, // Issue #597
		pips: pips // Issue #594
	};

	// Attach user events.
	bindSliderEvents(options.events);

	// Use the public value method to set the start values.
	valueSet(options.start);

	if ( options.pips ) {
		pips(options.pips);
	}

	if ( options.tooltips ) {
		tooltips();
	}

	return scope_Self;

}


	// Run the standard initializer
	function initialize ( target, originalOptions ) {

		if ( !target.nodeName ) {
			throw new Error("noUiSlider (" + VERSION + "): create requires a single element.");
		}

		// Test the options and create the slider environment;
		var options = testOptions( originalOptions, target );
		var api = closure( target, options, originalOptions );

		target.noUiSlider = api;

		return api;
	}

	// Use an object instead of a function for future expansibility;
	return {
		version: VERSION,
		create: initialize
	};

}));(function(factory) {
    'use strict';
    if (typeof define === 'function' && define.amd) {
        define(['jquery'], factory);
    } else if (typeof exports !== 'undefined') {
        module.exports = factory(require('jquery'));
    } else {
        factory(jQuery);
    }

}(function($) {
    'use strict';
    var SlickSelect = window.SlickSelect || {};

    SlickSelect = (function(element, settings) {
        var $element = $(element);

        $element.on("init", function () {
            $(this).find(".slick-slide").on("click", function () {
                var $curEl = $(this);
                $curEl.parent().find(".active").removeClass("active");
                $curEl.addClass("active");

                checkIfElementIsInOffset($curEl);
            });

        }).slick(settings);
        var checkIfElementIsInOffset = function($curEl){
            var slideLeft = $curEl.position().left;
            var slideWidth = $curEl.outerWidth();
            var sliderWidth = $element.find(".slick-list").outerWidth();
            var sliderLeft = parseInt(getSliderLeftPosition()[0]);

            var curSlidePos = (slideLeft + slideWidth) + sliderLeft;

            //check if element is cutted
            if (curSlidePos > sliderWidth) {
                $element.slick("slickNext");
            }
        };

        var getSliderLeftPosition = function(){
            if($element.find(".slick-track").css('transform')===undefined)
                return false;

            var results = $element.find(".slick-track").css('transform').match(/matrix(?:(3d)\(-{0,1}\d+\.?\d*(?:, -{0,1}\d+\.?\d*)*(?:, (-{0,1}\d+\.?\d*))(?:, (-{0,1}\d+\.?\d*))(?:, (-{0,1}\d+\.?\d*)), -{0,1}\d+\.?\d*\)|\(-{0,1}\d+\.?\d*(?:, -{0,1}\d+\.?\d*)*(?:, (-{0,1}\d+\.?\d*))(?:, (-{0,1}\d+\.?\d*))\))/);

            if(!results) return [0, 0, 0];
            if(results[1] == '3d') return results.slice(2,5);

            results.push(0);
            return results.slice(5, 8);
        }
    });

    $.fn.slickSelect = function() {
        var _ = this,
            opt = arguments[0],
            args = Array.prototype.slice.call(arguments, 1),
            l = _.length,
            i,
            ret;
        for (i = 0; i < l; i++) {
            if (typeof opt == 'object' || typeof opt == 'undefined')
                _[i].slickSelect = new SlickSelect(_[i], opt);
            else
                ret = $(_[i]).slick(opt);
            if (typeof ret != 'undefined') return ret;
        }
        return _;
    };
}));;(function( $,  window, document, undefined ) {
    'use strict';

    var arrayCountryOptgroups = [];

    function deactivateDD(label) {
        // if(Modernizr.touch && $('#m-15-dd-country > select > option:selected').prop('disabled')){
        //     label.click(function(){});
        // }
        label.parent().addClass('sel-touch-disabled');
        label.find('select').prop( 'disabled', true ).select2( 'enable', false );
        $('.sel-go-wrapper>a').addClass('sel-go-disabled').removeAttr('href');
    }

    function activateDD(label) {
        // if(Modernizr.touch){
        //     label.unbind('click');
        // }
        label.parent().removeClass('sel-touch-disabled');
        label.find('select').prop( 'disabled', false ).select2( 'enable', true );
    }

    function continentSet() {
        // Go-Button reset
        $('.sel-go-wrapper>a').removeAttr('href').addClass('sel-go-disabled');

        if ( Modernizr.touch ) {
            $('.sel-dd-country > select').val( $('.sel-dd-country > select').data('placeholder') );
        } else {
            $('.sel-dd-country > select').select2('data', null);
        };

        var chosenContinent = $('.sel-dd-continent > select > option:selected');

        // iOS erlaubt die Auswahl von disabled Options
        if ( chosenContinent.prop('disabled') ) {

            deactivateDD( $('.sel-dd-country') );

        } else {
            // Eine gültige Option wurde ausgewählt
            // Country Dropdown leeren
            $('.sel-dd-country > select').children('option:not(:first)').remove();

            // Country Dropdown befüllen aus arrayCountryOptgroups
            var neededCountries = $.grep( arrayCountryOptgroups, function (e) {
                return e.title == chosenContinent.attr('value');
            });
			if (typeof neededCountries[0] !== 'undefined') {
				$('.sel-dd-country > select').append( neededCountries[0].innerHTML );
			}

            // Country Dropdown aktivieren
            activateDD( $('.sel-dd-country') );

            // Binding auf Auswahl des Country Dropdowns
            $('.sel-dd-country > select').unbind('change').change( countrySet );
        };
    }

    function countrySet() {
        var chosenCountry = $('.sel-dd-country > select > option:selected');

        if ( Modernizr.touch && chosenCountry.prop('disabled') ) {
            $('.sel-go-wrapper>a').addClass('sel-go-disabled');
        } else {
            if ( !( chosenCountry.attr('value') === undefined ) ) {
                $('.sel-go-wrapper>a').removeClass('sel-go-disabled');
                // URL aus Value des Landes nehmen und an aktuelle URL anhängen
                var addToURL = chosenCountry.attr('value');
                var currentURL = document.location.protocol + '//' + document.location.hostname; //$( location ).attr('href');
                var newURL = (addToURL.indexOf('http') > -1) ? addToURL : currentURL + addToURL;                // hier kann jetzt direkt nach Auswahl des Landes die entsprechende Seite geladen werden
                // z. B. so:
                //window.location = newURL;

                // gibts einen target-link?
                if (getURLParameter("cstarget") != "null") {
                    newURL += getURLParameter("cstarget");
                }

                if (window.location.href.indexOf("/specials/") != -1) {
                    // im specials pool wird als anchor der deeplinkpath angegeben. 
                    if (window.location.hash != "") {
                        newURL += window.location.hash.substring(1);
                    }
                    if (window.location.search != "") {
                        newURL += window.location.search;
                    }
                } else {
                    // ansonsten (microsites) bleibt der anchor ein anchor
                    if (window.location.search != "") {
                        newURL += window.location.search;
                    }
                    if (window.location.hash != "") {
                        newURL += window.location.hash;
                    }
                }

                window.location = newURL;

				// und/oder die URL auf den Go-Button gelegt werden, obwohl dieser bei der aktuellen Funktionalität nie gedrückt werden kann:
                $('.sel-go-wrapper>a').attr('href', newURL);
            };
        };
    }

    $(document).ready( function () {

        var $selectContinent = $('.sel-dd-continent > select');
        var $selectCountry   = $('.sel-dd-country > select');

        $('.sel-dd-continent > div > a.select2-choice').attr('data-tracking-rule-identifier', 'Langauge Selector');

        arrayCountryOptgroups = $selectCountry.children('optgroup').remove();
        $selectContinent.change( continentSet );

        //[BL] 23.10.2017 trigger select in first dropdown
        var isSelected = false;
        $selectContinent.find('option').each(function (i)
        {
            if (i > 0)
            {
                if ($(this).is(':selected'))
                {
                    isSelected = true;
                }
            }
        });
        if (isSelected)
        {
            $selectContinent.change();
        }
    });

})( jQuery, this, this.document );
/* Script for .b-tabs content module
 * - divides content into tabs
 *
 */
;(function( $,  window, document, undefined) {
    'use strict';
    $(document).ready(function(){
        var $bTabsContainer = $('.b-tabs'),
            bTabsIdPrefix = 'b-tab-',
            bTabsHeadlineSelector = '.b-tabs-headline',
            bTabsHeadlineActiveClass = 'gui-active-tab',
            bTabsContentSelector = '.b-tabs-content',
            bTabsContentIdSuffix = '-content',
            bTabsSelect2Array = [],
            bTabsSelectClass = '.b-tabs-select';

        bTabsInit();

        function bTabsInit() {

            
            $(bTabsContentSelector).not('.m-29-tab-content').removeClass('display');
            

            //Initialisierung jedes .b-tabs Moduls auf der Seite
            $bTabsContainer.each(function(containerIndex) {
                var currentSelect = $(this).find('select' + bTabsSelectClass).eq(0),
                    headlines = $(this).find(bTabsHeadlineSelector),
                    headlineCount = headlines.length,
                    currentHeadline = undefined,
                    contentContainers = $(this).find(bTabsContentSelector),
                    contentContainerCount = contentContainers.length,
                    currentContentContainer = undefined,
                    tabIdTemplate = undefined,
                    initialActiveHeadline = undefined,
                    initialActiveContent = undefined;

                // Select 2 Neu-Initialisierung
                if (!Modernizr.touch) {
                    bTabsSelect2Array[containerIndex] = currentSelect.select2({
                        containerCssClass: 'gui-select2-container'
                        , dropdownCssClass: 'gui-select2-dropDown'
                        , minimumResultsForSearch: -1 // hide the search field
                        , width: "100%"
                    });
                }

                // Verknüpfung jeder Headline mit dem zugehörigen Content über eine dynamisch erzeugte ID
                for(var headlineIndex = 0; headlineIndex < headlineCount; headlineIndex++) {
                    if(headlineIndex >= contentContainerCount) {
                        break;
                    }
                    currentHeadline = headlines.eq(headlineIndex);
                    currentContentContainer = contentContainers.eq(headlineIndex);
                    tabIdTemplate = bTabsIdPrefix + containerIndex + '-' + headlineIndex;

                    currentHeadline.attr('id', tabIdTemplate);
                    currentContentContainer.attr('id', (tabIdTemplate + bTabsContentIdSuffix));

                    // Drop-Down erzeugen mit den Headline Elementen
                    currentSelect.append($('<option>', {text: currentHeadline.text(), value: currentHeadline.attr('id')}));

                    currentHeadline.on('click', function(event) {
                        currentSelect.val($(this).attr('id'));

                        // Spezielle Behandlung bei nicht-touch und select2
                        if (!Modernizr.touch && bTabsSelect2Array[containerIndex] !== null && bTabsSelect2Array[containerIndex] != undefined) {
                            bTabsSelect2Array[containerIndex].select2('val', $(this).attr('id'));
                        }
                    });
                }

                // Listener für Dropdown => Button state ändern
                currentSelect.on('change', pTabsSelectChanged).trigger('change');

                //Aktivierung der Akkordeon-Funktionalität
                $(this).accordion({
                    'accordionLinkSelector': bTabsHeadlineSelector
                    , 'accordionContent': bTabsContentSelector
                    , 'closeOpenAccordions': true
                    , 'alwaysToggleActiveState': false
                    , 'ignoreBreakpoints': true
                    , 'checkEventClass': true
                    , 'accordionHeadlineActiveClass': bTabsHeadlineActiveClass
                    , 'accordionClickedCallback': bTabsAccordionCallback
                    , 'contentSuffix': bTabsContentIdSuffix
                });

                // Aktiven Content einblenden
                initialActiveHeadline = headlines.filter('.' + bTabsHeadlineActiveClass).eq(0);
                initialActiveContent = $(this).find('#' + initialActiveHeadline.attr("id") + bTabsContentIdSuffix).eq(0);
                initialActiveContent.addClass('display');
            });
        };

        function bTabsAccordionCallback(target) {

            $(target).closest('.b-tabs').trigger('tabChange');

           //$bTabsContainer.trigger('tabChange');
          if(!!$('.b-responsive-scroller-table-container').length) {
            var _whichTab = $(target).parent().index();
            var _numberOfResponsiveScrollerTable = $('.b-tabs.b-responsive-scroller-table-tabs').length;
              for (var i = 0; i< _numberOfResponsiveScrollerTable; i++) {
                if(!!$('.b-tabs.b-responsive-scroller-table-tabs').eq(i).find(target).length) {
                  $('.b-tabs.b-responsive-scroller-table-tabs').eq(i).find('.b-tabs-content-wrapper').removeClass('display');  
                  $('.b-tabs.b-responsive-scroller-table-tabs').eq(i).find('.b-tabs-content-wrapper').eq(_whichTab).addClass('display');
                };
              };
              $(window).trigger('resize');
          };
          
        };

        // Reagiert auf Änderungen im DropDown und emuliert einen Click auf das entsprechende
        // Akkordeon-Element
        function pTabsSelectChanged(event) {
            var selectedId = $($(this).children("option").filter(":selected")).attr('value');
            $('#' + selectedId).click();
        }
    });

})(jQuery, this,this.document);
var FlyoutTouchBehaviour = FlyoutTouchBehaviour || {};


;(function( $,  window, document, undefined) {
    'use strict';

    var slider;

    $(window).load(function () {
    //$(document).ready(function () {
        /*
         * For touch devices 'click' event is not the best option. So we add 'touchend' event to
         * Flyout Navigation items. Also manages closing through 'touch anywhere' except open menu
         * items and submenus.
         *
         */
        function initTouchBehaviourForFlyout() {
            if (Modernizr.touch || window.navigator.msPointerEnabled) {
                var touchEvent = window.navigator.msPointerEnabled ? 'MSPointerUp' : 'touchend';
                $('html').on(touchEvent, handleHTMLTouches);
                $('.gui-nav-flyout-item').on(touchEvent, handleFlyOutTouches);
            }
        }

        function handleHTMLTouches(event) {
            //Only hide the submenu, if the user didn't click on the opened
            //Menu Item and only hide it if it is visible
            if ($(event.target).parent().hasClass('gui-nav-flyout-item') ||
                $('.gui-nav-flyout-submenu-active').length <= 0 ||
                $(event.target).parent().hasClass('gui-submenu-link') ||
                $(event.target).hasClass('gui-submenu-link')) {
                return;
            }
            $('.gui-nav-flyout-submenu-active').removeClass('gui-nav-flyout-submenu-active');

            return false;
        }

        function handleFlyOutTouches(event) {
            if ($(event.target).hasClass('gui-submenu-link') ||
                $(event.target).parent().hasClass('gui-submenu-link')) {

                return true;
            }
            var $subMenu = $(this);
            if ($subMenu.hasClass('gui-nav-flyout-submenu-active')) {
                $subMenu.removeClass('gui-nav-flyout-submenu-active');

            } else {
                $('.gui-nav-flyout-submenu-active').removeClass('gui-nav-flyout-submenu-active');
                $subMenu.addClass('gui-nav-flyout-submenu-active');
            }
            return false;
        }


        function detailSelectChanged(event) {
            var $selectedFeature = $('.gui-nav-flyout-submenu-wrapper').filter(function (i) { return i === $(event.data.featureSelect).find('select').prop('selectedIndex') - 1; })
              , $selectedDetail = $selectedFeature.find('.gui-submenu-link').filter(function (i) { return i === $(event.data.detailSelect).find('select').prop('selectedIndex') - 1; })
              , selectedHref = $selectedDetail.attr('href');
            window.location.href = selectedHref;
        }

        FlyoutTouchBehaviour.initTouchBehaviourForFlyout = initTouchBehaviourForFlyout;
        FlyoutTouchBehaviour.detailSelectChanged = detailSelectChanged;

        FlyoutTouchBehaviour.initTouchBehaviourForFlyout();
    });

})(jQuery, this,this.document);
/* SWFObject v2.1 <http://code.google.com/p/swfobject/>
	Copyright (c) 2007-2008 Geoff Stearns, Michael Williams, and Bobby van der Sluis
	This software is released under the MIT License <http://www.opensource.org/licenses/mit-license.php>
*/
var swfobject=function(){var b="undefined",Q="object",n="Shockwave Flash",p="ShockwaveFlash.ShockwaveFlash",P="application/x-shockwave-flash",m="SWFObjectExprInst",j=window,K=document,T=navigator,o=[],N=[],i=[],d=[],J,Z=null,M=null,l=null,e=false,A=false;var h=function(){var v=typeof K.getElementById!=b&&typeof K.getElementsByTagName!=b&&typeof K.createElement!=b,AC=[0,0,0],x=null;if(typeof T.plugins!=b&&typeof T.plugins[n]==Q){x=T.plugins[n].description;if(x&&!(typeof T.mimeTypes!=b&&T.mimeTypes[P]&&!T.mimeTypes[P].enabledPlugin)){x=x.replace(/^.*\s+(\S+\s+\S+$)/,"$1");AC[0]=parseInt(x.replace(/^(.*)\..*$/,"$1"),10);AC[1]=parseInt(x.replace(/^.*\.(.*)\s.*$/,"$1"),10);AC[2]=/r/.test(x)?parseInt(x.replace(/^.*r(.*)$/,"$1"),10):0}}else{if(typeof j.ActiveXObject!=b){var y=null,AB=false;try{y=new ActiveXObject(p+".7")}catch(t){try{y=new ActiveXObject(p+".6");AC=[6,0,21];y.AllowScriptAccess="always"}catch(t){if(AC[0]==6){AB=true}}if(!AB){try{y=new ActiveXObject(p)}catch(t){}}}if(!AB&&y){try{x=y.GetVariable("$version");if(x){x=x.split(" ")[1].split(",");AC=[parseInt(x[0],10),parseInt(x[1],10),parseInt(x[2],10)]}}catch(t){}}}}var AD=T.userAgent.toLowerCase(),r=T.platform.toLowerCase(),AA=/webkit/.test(AD)?parseFloat(AD.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,q=false,z=r?/win/.test(r):/win/.test(AD),w=r?/mac/.test(r):/mac/.test(AD);/*@cc_on q=true;@if(@_win32)z=true;@elif(@_mac)w=true;@end@*/return{w3cdom:v,pv:AC,webkit:AA,ie:q,win:z,mac:w}}();var L=function(){if(!h.w3cdom){return }f(H);if(h.ie&&h.win){try{K.write("<script id=__ie_ondomload defer=true src=//:><\/script>");J=C("__ie_ondomload");if(J){I(J,"onreadystatechange",S)}}catch(q){}}if(h.webkit&&typeof K.readyState!=b){Z=setInterval(function(){if(/loaded|complete/.test(K.readyState)){E()}},10)}if(typeof K.addEventListener!=b){K.addEventListener("DOMContentLoaded",E,null)}R(E)}();function S(){if(J.readyState=="complete"){J.parentNode.removeChild(J);E()}}function E(){if(e){return }if(h.ie&&h.win){var v=a("span");try{var u=K.getElementsByTagName("body")[0].appendChild(v);u.parentNode.removeChild(u)}catch(w){return }}e=true;if(Z){clearInterval(Z);Z=null}var q=o.length;for(var r=0;r<q;r++){o[r]()}}function f(q){if(e){q()}else{o[o.length]=q}}function R(r){if(typeof j.addEventListener!=b){j.addEventListener("load",r,false)}else{if(typeof K.addEventListener!=b){K.addEventListener("load",r,false)}else{if(typeof j.attachEvent!=b){I(j,"onload",r)}else{if(typeof j.onload=="function"){var q=j.onload;j.onload=function(){q();r()}}else{j.onload=r}}}}}function H(){var t=N.length;for(var q=0;q<t;q++){var u=N[q].id;if(h.pv[0]>0){var r=C(u);if(r){N[q].width=r.getAttribute("width")?r.getAttribute("width"):"0";N[q].height=r.getAttribute("height")?r.getAttribute("height"):"0";if(c(N[q].swfVersion)){if(h.webkit&&h.webkit<312){Y(r)}W(u,true)}else{if(N[q].expressInstall&&!A&&c("6.0.65")&&(h.win||h.mac)){k(N[q])}else{O(r)}}}}else{W(u,true)}}}function Y(t){var q=t.getElementsByTagName(Q)[0];if(q){var w=a("embed"),y=q.attributes;if(y){var v=y.length;for(var u=0;u<v;u++){if(y[u].nodeName=="DATA"){w.setAttribute("src",y[u].nodeValue)}else{w.setAttribute(y[u].nodeName,y[u].nodeValue)}}}var x=q.childNodes;if(x){var z=x.length;for(var r=0;r<z;r++){if(x[r].nodeType==1&&x[r].nodeName=="PARAM"){w.setAttribute(x[r].getAttribute("name"),x[r].getAttribute("value"))}}}t.parentNode.replaceChild(w,t)}}function k(w){A=true;var u=C(w.id);if(u){if(w.altContentId){var y=C(w.altContentId);if(y){M=y;l=w.altContentId}}else{M=G(u)}if(!(/%$/.test(w.width))&&parseInt(w.width,10)<310){w.width="310"}if(!(/%$/.test(w.height))&&parseInt(w.height,10)<137){w.height="137"}K.title=K.title.slice(0,47)+" - Flash Player Installation";var z=h.ie&&h.win?"ActiveX":"PlugIn",q=K.title,r="MMredirectURL="+j.location+"&MMplayerType="+z+"&MMdoctitle="+q,x=w.id;if(h.ie&&h.win&&u.readyState!=4){var t=a("div");x+="SWFObjectNew";t.setAttribute("id",x);u.parentNode.insertBefore(t,u);u.style.display="none";var v=function(){u.parentNode.removeChild(u)};I(j,"onload",v)}U({data:w.expressInstall,id:m,width:w.width,height:w.height},{flashvars:r},x)}}function O(t){if(h.ie&&h.win&&t.readyState!=4){var r=a("div");t.parentNode.insertBefore(r,t);r.parentNode.replaceChild(G(t),r);t.style.display="none";var q=function(){t.parentNode.removeChild(t)};I(j,"onload",q)}else{t.parentNode.replaceChild(G(t),t)}}function G(v){var u=a("div");if(h.win&&h.ie){u.innerHTML=v.innerHTML}else{var r=v.getElementsByTagName(Q)[0];if(r){var w=r.childNodes;if(w){var q=w.length;for(var t=0;t<q;t++){if(!(w[t].nodeType==1&&w[t].nodeName=="PARAM")&&!(w[t].nodeType==8)){u.appendChild(w[t].cloneNode(true))}}}}}return u}function U(AG,AE,t){var q,v=C(t);if(v){if(typeof AG.id==b){AG.id=t}if(h.ie&&h.win){var AF="";for(var AB in AG){if(AG[AB]!=Object.prototype[AB]){if(AB.toLowerCase()=="data"){AE.movie=AG[AB]}else{if(AB.toLowerCase()=="styleclass"){AF+=' class="'+AG[AB]+'"'}else{if(AB.toLowerCase()!="classid"){AF+=" "+AB+'="'+AG[AB]+'"'}}}}}var AD="";for(var AA in AE){if(AE[AA]!=Object.prototype[AA]){AD+='<param name="'+AA+'" value="'+AE[AA]+'" />'}}v.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+AF+">"+AD+"</object>";i[i.length]=AG.id;q=C(AG.id)}else{if(h.webkit&&h.webkit<312){var AC=a("embed");AC.setAttribute("type",P);for(var z in AG){if(AG[z]!=Object.prototype[z]){if(z.toLowerCase()=="data"){AC.setAttribute("src",AG[z])}else{if(z.toLowerCase()=="styleclass"){AC.setAttribute("class",AG[z])}else{if(z.toLowerCase()!="classid"){AC.setAttribute(z,AG[z])}}}}}for(var y in AE){if(AE[y]!=Object.prototype[y]){if(y.toLowerCase()!="movie"){AC.setAttribute(y,AE[y])}}}v.parentNode.replaceChild(AC,v);q=AC}else{var u=a(Q);u.setAttribute("type",P);for(var x in AG){if(AG[x]!=Object.prototype[x]){if(x.toLowerCase()=="styleclass"){u.setAttribute("class",AG[x])}else{if(x.toLowerCase()!="classid"){u.setAttribute(x,AG[x])}}}}for(var w in AE){if(AE[w]!=Object.prototype[w]&&w.toLowerCase()!="movie"){F(u,w,AE[w])}}v.parentNode.replaceChild(u,v);q=u}}}return q}function F(t,q,r){var u=a("param");u.setAttribute("name",q);u.setAttribute("value",r);t.appendChild(u)}function X(r){var q=C(r);if(q&&(q.nodeName=="OBJECT"||q.nodeName=="EMBED")){if(h.ie&&h.win){if(q.readyState==4){B(r)}else{j.attachEvent("onload",function(){B(r)})}}else{q.parentNode.removeChild(q)}}}function B(t){var r=C(t);if(r){for(var q in r){if(typeof r[q]=="function"){r[q]=null}}r.parentNode.removeChild(r)}}function C(t){var q=null;try{q=K.getElementById(t)}catch(r){}return q}function a(q){return K.createElement(q)}function I(t,q,r){t.attachEvent(q,r);d[d.length]=[t,q,r]}function c(t){var r=h.pv,q=t.split(".");q[0]=parseInt(q[0],10);q[1]=parseInt(q[1],10)||0;q[2]=parseInt(q[2],10)||0;return(r[0]>q[0]||(r[0]==q[0]&&r[1]>q[1])||(r[0]==q[0]&&r[1]==q[1]&&r[2]>=q[2]))?true:false}function V(v,r){if(h.ie&&h.mac){return }var u=K.getElementsByTagName("head")[0],t=a("style");t.setAttribute("type","text/css");t.setAttribute("media","screen");if(!(h.ie&&h.win)&&typeof K.createTextNode!=b){t.appendChild(K.createTextNode(v+" {"+r+"}"))}u.appendChild(t);if(h.ie&&h.win&&typeof K.styleSheets!=b&&K.styleSheets.length>0){var q=K.styleSheets[K.styleSheets.length-1];if(typeof q.addRule==Q){q.addRule(v,r)}}}function W(t,q){var r=q?"visible":"hidden";if(e&&C(t)){C(t).style.visibility=r}else{V("#"+t,"visibility:"+r)}}function g(s){var r=/[\\\"<>\.;]/;var q=r.exec(s)!=null;return q?encodeURIComponent(s):s}var D=function(){if(h.ie&&h.win){window.attachEvent("onunload",function(){var w=d.length;for(var v=0;v<w;v++){d[v][0].detachEvent(d[v][1],d[v][2])}var t=i.length;for(var u=0;u<t;u++){X(i[u])}for(var r in h){h[r]=null}h=null;for(var q in swfobject){swfobject[q]=null}swfobject=null})}}();return{registerObject:function(u,q,t){if(!h.w3cdom||!u||!q){return }var r={};r.id=u;r.swfVersion=q;r.expressInstall=t?t:false;N[N.length]=r;W(u,false)},getObjectById:function(v){var q=null;if(h.w3cdom){var t=C(v);if(t){var u=t.getElementsByTagName(Q)[0];if(!u||(u&&typeof t.SetVariable!=b)){q=t}else{if(typeof u.SetVariable!=b){q=u}}}}return q},embedSWF:function(x,AE,AB,AD,q,w,r,z,AC){if(!h.w3cdom||!x||!AE||!AB||!AD||!q){return }AB+="";AD+="";if(c(q)){W(AE,false);var AA={};if(AC&&typeof AC===Q){for(var v in AC){if(AC[v]!=Object.prototype[v]){AA[v]=AC[v]}}}AA.data=x;AA.width=AB;AA.height=AD;var y={};if(z&&typeof z===Q){for(var u in z){if(z[u]!=Object.prototype[u]){y[u]=z[u]}}}if(r&&typeof r===Q){for(var t in r){if(r[t]!=Object.prototype[t]){if(typeof y.flashvars!=b){y.flashvars+="&"+t+"="+r[t]}else{y.flashvars=t+"="+r[t]}}}}f(function(){U(AA,y,AE);if(AA.id==AE){W(AE,true)}})}else{if(w&&!A&&c("6.0.65")&&(h.win||h.mac)){A=true;W(AE,false);f(function(){var AF={};AF.id=AF.altContentId=AE;AF.width=AB;AF.height=AD;AF.expressInstall=w;k(AF)})}}},getFlashPlayerVersion:function(){return{major:h.pv[0],minor:h.pv[1],release:h.pv[2]}},hasFlashPlayerVersion:c,createSWF:function(t,r,q){if(h.w3cdom){return U(t,r,q)}else{return undefined}},removeSWF:function(q){if(h.w3cdom){X(q)}},createCSS:function(r,q){if(h.w3cdom){V(r,q)}},addDomLoadEvent:f,addLoadEvent:R,getQueryParamValue:function(v){var u=K.location.search||K.location.hash;if(v==null){return g(u)}if(u){var t=u.substring(1).split("&");for(var r=0;r<t.length;r++){if(t[r].substring(0,t[r].indexOf("="))==v){return g(t[r].substring((t[r].indexOf("=")+1)))}}}return""},expressInstallCallback:function(){if(A&&M){var q=C(m);if(q){q.parentNode.replaceChild(M,q);if(l){W(l,true);if(h.ie&&h.win){M.style.display="block"}}M=null;l=null;A=false}}}}}();/*! http://mths.be/placeholder v2.0.7 by @mathias */
;(function(f,h,$){var a='placeholder' in h.createElement('input'),d='placeholder' in h.createElement('textarea'),i=$.fn,c=$.valHooks,k,j;if(a&&d){j=i.placeholder=function(){return this};j.input=j.textarea=true}else{j=i.placeholder=function(){var l=this;l.filter((a?'textarea':':input')+'[placeholder]').not('.placeholder').bind({'focus.placeholder':b,'blur.placeholder':e}).data('placeholder-enabled',true).trigger('blur.placeholder');return l};j.input=a;j.textarea=d;k={get:function(m){var l=$(m);return l.data('placeholder-enabled')&&l.hasClass('placeholder')?'':m.value},set:function(m,n){var l=$(m);if(!l.data('placeholder-enabled')){return m.value=n}if(n==''){m.value=n;if(m!=h.activeElement){e.call(m)}}else{if(l.hasClass('placeholder')){b.call(m,true,n)||(m.value=n)}else{m.value=n}}return l}};a||(c.input=k);d||(c.textarea=k);$(function(){$(h).delegate('form','submit.placeholder',function(){var l=$('.placeholder',this).each(b);setTimeout(function(){l.each(e)},10)})});$(f).bind('beforeunload.placeholder',function(){$('.placeholder').each(function(){this.value=''})})}function g(m){var l={},n=/^jQuery\d+$/;$.each(m.attributes,function(p,o){if(o.specified&&!n.test(o.name)){l[o.name]=o.value}});return l}function b(m,n){var l=this,o=$(l);if(l.value==o.attr('placeholder')&&o.hasClass('placeholder')){if(o.data('placeholder-password')){o=o.hide().next().show().attr('id',o.removeAttr('id').data('placeholder-id'));if(m===true){return o[0].value=n}o.focus()}else{l.value='';o.removeClass('placeholder');l==h.activeElement&&l.select()}}}function e(){var q,l=this,p=$(l),m=p,o=this.id;if(l.value==''){if(l.type=='password'){if(!p.data('placeholder-textinput')){try{q=p.clone().attr({type:'text'})}catch(n){q=$('<input>').attr($.extend(g(this),{type:'text'}))}q.removeAttr('name').data({'placeholder-password':true,'placeholder-id':o}).bind('focus.placeholder',b);p.data({'placeholder-textinput':q,'placeholder-id':o}).before(q)}p=p.removeAttr('id').hide().prev().attr('id',o).show()}p.addClass('placeholder');p[0].value=p.attr('placeholder')}else{p.removeClass('placeholder')}}}(this,document,jQuery));
/*! jQuery UI - v1.11.4 - 2015-07-16
* http://jqueryui.com
* Includes: core.js, widget.js, mouse.js, position.js, slider.js
* Copyright 2015 jQuery Foundation and other contributors; Licensed MIT */

(function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return"area"===r?(n=t.parentNode,a=n.name,t.href&&a&&"map"===n.nodeName.toLowerCase()?(o=e("img[usemap='#"+a+"']")[0],!!o&&i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:"a"===r?t.href||s:s)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),s="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&&"static"===t.css("position")?!1:n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var s=e.attr(i,"tabindex"),n=isNaN(s);return(n||s>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,s&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),a&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?o["inner"+i].call(this):this.each(function(){e(this).css(a,s(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?o["outer"+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&&s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,s,n=e(this[0]);n.length&&n[0]!==document;){if(i=n.css("position"),("absolute"===i||"relative"===i||"fixed"===i)&&(s=parseInt(n.css("zIndex"),10),!isNaN(s)&&0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&&(s||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;a.length>n;n++)e.options[a[n][0]]&&a[n][1].apply(e.element,i)}};var s=0,n=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,"events"),s&&s.remove&&e(n).triggerHandler("remove")}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(".")[0];return t=t.split(".")[1],n=l+"-"+t,s||(s=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+"."+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,a=n.call(arguments,1),o=0,r=a.length;r>o;o++)for(i in a[o])s=a[o][i],a[o].hasOwnProperty(i)&&void 0!==s&&(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(a){var o="string"==typeof a,r=n.call(arguments,1),h=this;return o?this.each(function(){var i,n=e.data(this,s);return"instance"===a?(h=n,!1):n?e.isFunction(n[a])&&"_"!==a.charAt(0)?(i=n[a].apply(n,r),i!==n&&void 0!==i?(h=i&&i.jquery?h.pushStack(i.get()):i,!1):void 0):e.error("no such method '"+a+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; "+"attempted to call method '"+a+"'")}):(r.length&&(a=e.widget.extend.apply(null,[a].concat(r))),this.each(function(){var t=e.data(this,s);t?(t.option(a||{}),t._init&&t._init()):e.data(this,s,new i(a,this))})),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=s++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(o={},s=t.split("."),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1>a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;"boolean"!=typeof t&&(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof o?a[o]:o).apply(a,arguments):void 0}"string"!=typeof o&&(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return("string"==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&&o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(s,n,a){"string"==typeof n&&(n={effect:n});var o,r=n?n===!0||"number"==typeof n?i:n.effect||i:t;n=n||{},"number"==typeof n&&(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&&s.delay(n.delay),o&&e.effects&&e.effects.effect[r]?s[t](n):r!==t&&s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&&a.call(s[0]),i()})}}),e.widget;var a=!1;e(document).mouseup(function(){a=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!a){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n="string"==typeof this.options.cancel&&t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&&!n&&this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),a=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),a=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,a,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,s=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=s.children()[0];return e("body").append(s),t=a.offsetWidth,s.css("overflow","scroll"),i=a.offsetWidth,t===i&&(i=s[0].clientWidth),s.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),s=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,a="scroll"===s||"auto"===s&&t.height<t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return f.apply(this,arguments);n=e.extend({},n);var p,m,g,v,y,b,_=e(n.of),x=e.position.getWithinInfo(n.within),w=e.position.getScrollInfo(x),k=(n.collision||"flip").split(" "),T={};return b=s(_),_[0].preventDefault&&(n.at="left top"),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each(["my","at"],function(){var e,t,i=(n[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===n.at[0]?y.left+=m:"center"===n.at[0]&&(y.left+=m/2),"bottom"===n.at[1]?y.top+=g:"center"===n.at[1]&&(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,"marginLeft"),b=i(this,"marginTop"),D=d+f+i(this,"marginRight")+w.width,S=c+b+i(this,"marginBottom")+w.height,N=e.extend({},y),M=t(T.my,u.outerWidth(),u.outerHeight());"right"===n.my[0]?N.left-=d:"center"===n.my[0]&&(N.left-=d/2),"bottom"===n.my[1]?N.top-=c:"center"===n.my[1]&&(N.top-=c/2),N.left+=M[0],N.top+=M[1],a||(N.left=h(N.left),N.top=h(N.top)),s={marginLeft:f,marginTop:b},e.each(["left","top"],function(t,i){e.ui.position[k[t]]&&e.ui.position[k[t]][i](N,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+M[0],p[1]+M[1]],my:n.my,at:n.at,within:x,elem:u})}),n.using&&(l=function(e){var t=v.left-N.left,i=t+m-d,s=v.top-N.top,a=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:N.left,top:N.top,width:d,height:c},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":s>0?"bottom":"middle"};d>m&&m>r(t+i)&&(h.horizontal="center"),c>g&&g>r(s+a)&&(h.vertical="middle"),h.important=o(r(t),r(i))>o(r(s),r(a))?"horizontal":"vertical",n.using.call(this,e,h)}),u.offset(e.extend(N,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-a-n;t.collisionWidth>a?h>0&&0>=l?(i=e.left+h+t.collisionWidth-a-n,e.left+=h-i):e.left=l>0&&0>=h?n:h>l?n+a-t.collisionWidth:n:h>0?e.left+=h:l>0?e.left-=l:e.left=o(e.left-r,e.left)},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-a-n;t.collisionHeight>a?h>0&&0>=l?(i=e.top+h+t.collisionHeight-a-n,e.top+=h-i):e.top=l>0&&0>=h?n:h>l?n+a-t.collisionHeight:n:h>0?e.top+=h:l>0?e.top-=l:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,o=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>u?(i=e.left+c+p+f+t.collisionWidth-o-a,(0>i||r(u)>i)&&(e.left+=c+p+f)):d>0&&(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s>0||d>r(s))&&(e.left+=c+p+f))},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,o=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c="top"===t.my[1],p=c?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>u?(s=e.top+p+f+m+t.collisionHeight-o-a,(0>s||r(u)>s)&&(e.top+=p+f+m)):d>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-h,(i>0||d>r(i))&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,n,o,r=document.getElementsByTagName("body")[0],h=document.createElement("div");t=document.createElement(r?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},r&&e.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText="position: absolute; left: 10.7432222px;",n=e(h).offset().left,a=n>10&&11>n,t.innerHTML="",i.removeChild(t)}()}(),e.ui.position,e.widget("ui.slider",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),a="<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>",o=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;i>t;t++)o.push(a);this.handles=n.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,s,n,a,o,r,h,l,u=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));(n>i||n===i&&(t===u._lastChangedValue||u.values(t)===d.min))&&(n=i,a=e(this),o=t)}),r=this._start(t,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass("ui-state-active").focus(),h=a.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-h.left-a.width()/2,top:t.pageY-h.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,s,n,a;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var s,n,a;this.options.values&&this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>s||1===t&&s>i)&&(i=s),i!==this.values(t)&&(n=this.values(),n[t]=i,a=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),a!==!1&&this.values(t,i))):i!==this.value()&&(a=this._trigger("slide",e,{handle:this.handles[t],value:i}),a!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var s,n,a;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length>a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(t,i){var s,n=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)>=t&&(s+=i>0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step,s=Math.floor(+(e-t).toFixed(this._precision())/i)*i;e=s+t,this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,s,n,a,o=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),u["horizontal"===h.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[l?"animate":"css"](u,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:r.animate}))),t=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](u,r.animate),"min"===o&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===o&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===o&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===o&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(t){var i,s,n,a,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),i=this._start(t,o),i===!1))return}switch(a=this.options.step,s=n=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:n=this._valueMin();break;case e.ui.keyCode.END:n=this._valueMax();break;case e.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-a)}this._slide(t,o,n)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}})});
!function(t){var i=t(window);t.fn.visible=function(t,e,o){if(!(this.length<1)){var r=this.length>1?this.eq(0):this,n=r.get(0),f=i.width(),h=i.height(),o=o?o:"both",l=e===!0?n.offsetWidth*n.offsetHeight:!0;if("function"==typeof n.getBoundingClientRect){var g=n.getBoundingClientRect(),u=g.top>=0&&g.top<h,s=g.bottom>0&&g.bottom<=h,c=g.left>=0&&g.left<f,a=g.right>0&&g.right<=f,v=t?u||s:u&&s,b=t?c||a:c&&a;if("both"===o)return l&&v&&b;if("vertical"===o)return l&&v;if("horizontal"===o)return l&&b}else{var d=i.scrollTop(),p=d+h,w=i.scrollLeft(),m=w+f,y=r.offset(),z=y.top,B=z+r.height(),C=y.left,R=C+r.width(),j=t===!0?B:z,q=t===!0?z:B,H=t===!0?R:C,L=t===!0?C:R;if("both"===o)return!!l&&p>=q&&j>=d&&m>=L&&H>=w;if("vertical"===o)return!!l&&p>=q&&j>=d;if("horizontal"===o)return!!l&&m>=L&&H>=w}}}}(jQuery);
/* Script für den Placeholder Workaround.
 * Nur in Verwendung mit jquery.placeholder.min.js !
 */
;(function( $,  window, document, undefined) {
    'use strict';
    $(document).ready(function(){

       $('input').placeholder();

    });

})(jQuery, this, this.document);
;
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 7/19/2016.
 * Edited by Benjamin Latz since 07/28/2016
 */

var ItemCollection = Backbone.Collection.extend({

    availableFilters: undefined,
    actualFilters: undefined,
    actualSeasons: undefined,

    displayedItems: undefined,
    currentItems: undefined,
    amountDisplayedItems: 0,

    filterAmounts: undefined,
    filterActive: 'active',
    filterActiveLabel: $('.m-34-filter-label-active'),

    highlightsOnly: false,

    currentCategories: undefined,

    /* pagination variables */
    displayPerPage: 5,
    page: 0,


    initialize: function ()
    {
        var self = this;
        self.add(gridData);

        self.availableFilters = gridProperties.availableFilters;
        self.actualFilters = [];
        self.actualSeasons = [];
        self.currentCategories = [];
        self.filterAmounts = [];
    },

    getActualFilters: function ()
    {
        _.each(this.models, function (model)
        {
            var categories = model.get('categories');
            if (categories.length > 0)
            {
                for (var i = 0; i < categories.length; i++)
                {
                    this.actualFilters[categories[i]] = this.getCategoryName(categories[i]);
                }
            }
        }, this);

        this.getSeasons();
    },

    getSeasons: function ()
    {
        _.each(this.models, function (model, n)
        {
            var season = model.get('season');
            if (season != "")
            {
                this.actualSeasons[season] = {'filter': season, 'filterText': 'Season ' + season};
            }
        }, this);

        this.trigger('filtersReady');
    },

    getFilterAmounts: function ()
    {
        var self = this;
        var temp = [];
        var seasonFiltered = [];
        self.filterAmounts = [];
        var allItems = this.toJSON();
        var filters = this.currentCategories;

        var season = filters['season-category'];

        if (this.highlightsOnly)
        {
            _.each(this.currentItems, function (item, n)
            {
                _.each(item.categories, function (category, n)
                {
                    if (temp.indexOf(category) < 0)
                    {
                        temp.push(category);
                        self.filterAmounts[category] = 1;
                    }
                    else
                    {
                        var current = self.filterAmounts[category];
                        self.filterAmounts[category] = current + 1;
                    }
                }, this);

            }, this);
        }
        else if (season != undefined)
        {
            _.each(allItems, function (item)
            {
                var itemSeason = item['season'];
                if (season.indexOf(itemSeason) > -1)
                {
                    seasonFiltered.push(item);
                }
            }, this);

            _.each(seasonFiltered, function (item, n)
            {
                _.each(item.categories, function (category, n)
                {
                    if (temp.indexOf(category) < 0)
                    {
                        temp.push(category);
                        self.filterAmounts[category] = 1;
                    }
                    else
                    {
                        var current = self.filterAmounts[category];
                        self.filterAmounts[category] = current + 1;
                    }
                }, this);

            }, this);
        }
        else
        {
            _.each(allItems, function (item, n)
            {
                _.each(item.categories, function (category, n)
                {
                    if (temp.indexOf(category) < 0)
                    {
                        temp.push(category);
                        self.filterAmounts[category] = 1;
                    }
                    else
                    {
                        var current = self.filterAmounts[category];
                        self.filterAmounts[category] = current + 1;
                    }
                }, this);

            }, this);
        }

        this.trigger('updateFilterAmounts');
    },

    getCategoryName: function (id)
    {
        return _.find(this.availableFilters, {filter: id});
    },

    getDisplayedItems: function ()
    {
        this.displayedItems = [];
        var page = this.page;

        if (page == 0)
        {
            this.trigger('freshStart');
        }

        var displayPerPage = this.displayPerPage;

        var first = page * displayPerPage;

        _.each(this.currentItems, function (item, n)
        {
            if (n >= first && n < (first + displayPerPage))
            {
                this.displayedItems.push(item);
            }
        }, this);
        this.amountDisplayedItems += this.displayedItems.length;

        this.trigger('itemsReady');

    },

    getFilteredItems: function ()
    {
        this.currentItems = [];
        var allItems = this.toJSON();
        var temp = [];

        if (this.highlightsOnly)
        {
            this.currentItems = _.where(allItems, {highlight: true});
            this.filterActiveLabel.addClass(this.filterActive);
            // console.log("nur highlights");
        }
        else
        {
            var filters = this.currentCategories;

            var categories = filters['filter-category'];
            var season = filters['season-category'];

            if (categories == undefined && season == undefined)
            {
                // console.log("all Items");
                this.currentItems = allItems;
                this.filterActiveLabel.removeClass(this.filterActive);
            }
            else if (season == undefined && categories != undefined)
            {
                this.filterActiveLabel.addClass(this.filterActive);
                temp = [];
                _.each(allItems, function (item)
                {
                    var itemCategories = item.categories;
                    var isInCategory = false;
                    for (var i = 0; i < itemCategories.length; i++)
                    {
                        if (categories.indexOf(itemCategories[i]) > -1)
                        {
                            isInCategory = true;
                        }
                    }
                    if (isInCategory)
                    {
                        temp.push(item);
                    }
                }, this);

                this.currentItems = temp;
                // console.log("only categories");
            }
            else if (season != undefined && categories == undefined)
            {
                this.filterActiveLabel.addClass(this.filterActive);
                temp = [];
                _.each(allItems, function (item)
                {
                    var itemSeason = item['season'];
                    if (season.indexOf(itemSeason) > -1)
                    {
                        temp.push(item);
                    }
                }, this);

                this.currentItems = temp;
                // console.log("only seasons");
            }
            else if (season != undefined && categories != undefined)
            {
                this.filterActiveLabel.addClass(this.filterActive);
                //array for filtered by category
                temp = [];
                //array for temp filtered by season
                var result = [];

                _.each(allItems, function (item)
                {
                    var itemCategories = item.categories;
                    var isInCategory = false;
                    for (var i = 0; i < itemCategories.length; i++)
                    {
                        if (categories.indexOf(itemCategories[i]) > -1)
                        {
                            isInCategory = true;
                        }
                    }
                    if (isInCategory)
                    {
                        temp.push(item);
                    }
                }, this);

                _.each(temp, function (item)
                {
                    var itemSeason = item['season'];
                    if (season.indexOf(itemSeason) > -1)
                    {
                        result.push(item);
                    }
                }, this);

                this.currentItems = result;
                // console.log("filtered seasons/categories Items");
            }
        }

        // console.log(this.currentItems);
        this.getDisplayedItems();
        this.getFilterAmounts();
        this.trigger('setFilterCookies');
    },

    updateCategories: function (list, highlightsOnly)
    {
        this.page = 0;
        this.currentCategories = list;
        this.highlightsOnly = highlightsOnly;

        this.getFilteredItems();

        // console.log(list);
    },

    checkIfEndOfContent: function ()
    {
        if (this.amountDisplayedItems == this.currentItems.length)
        {
            this.trigger('endOfContentReached');
        }
    }
});;
/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 7/19/2016.
 * Edited by Benjamin Latz since 07/28/2016
 */

var ItemsView = Backbone.View.extend({
  el: '.m34-items.second',
  template: undefined,
  loadMore: $('.m34-load-more'),
  noReports: $('.no-reports-error'),

  initialize: function () {

    var videoSourceIframe = this.setVideoTemplateIframe();
    var videoSourceHTML5 = this.setVideoTemplateHTML5();
    var source;

    switch (gridProperties.viewmode) {
      case "regularList":
        source = this.setRegularViewTemplate();
        break;
      default:
        source = this.setTemplate();
        break;
    }

    this.template = Handlebars.compile(source);
    this.templateVideoIframe = Handlebars.compile(videoSourceIframe);
    this.templateVideoHTML5 = Handlebars.compile(videoSourceHTML5);
    this.listenTo(this.collection, 'itemsReady', this.render);
    this.listenTo(this.collection, 'freshStart', this.removeContent);
    this.listenTo(this.collection, 'endOfContentReached', this.setEndOfContent);

    // bind click event
    // because Element is not in $el Scope
    this.loadMore.on('click', _.bind(this.nextPage, this));
  },

  // default
  setTemplate: function () {
    return '<a href="{{this.href}}" class="{{this.class}} {{#if this.highlight}}is-highlight{{/if}} loaded" data-filter-category="'
        + '{{#each this.categories}}'
        + '{{this}}'
        + '{{/each}}"'
        + '>'
        + '<div class="img-container">'
        + '<img src="{{this.image.src}}" alt="{{this.image.alt}}" title="{{this.image.title}}"></img>'
        + '</div>'
        + '<div class="headline-container">'
        + '<div class="m34-headline">{{this.headline}}</div>'
        + '<div class="m34-category">{{this.subtitle}}</div>'
        + '</div>'
        + '</a>';
  },

  setRegularViewTemplate: function () {
    return '<a href="{{this.href}}" class="{{this.class}} {{#if this.highlight}}is-highlight{{/if}} loaded" data-filter-category="'
        + '{{#each this.categories}}'
        + '{{this}}'
        + '{{/each}}"'
        + '>'
        + '<div class="img-container">'
        + '<img src="{{this.image.src}}" alt="{{this.image.alt}}" title="{{this.image.title}}"></img>'
        + '</div>'
        + '<div class="headline-container">'
        + '<div class="m34-headline">{{this.headline}}</div>'
        + '<div class="m34-subheadline">{{this.subtitle}}</div>'
        + '<div class="m34-category">{{#each this.categories}}<span>{{this}}</span>{{/each}}</div>'
        + '</div>'
        + '</a>';
  },

  setVideoTemplateIframe: function () {
    return '<a href="javascript:void(0);" class="{{this.class}} {{#if this.highlight}}is-highlight{{/if}} loaded" data-filter-category="'
        + '{{#each this.categories}}'
        + '{{this}}'
        + '{{/each}}"'
        + '{{#if [video-source]}} data-video-source="{{[video-source]}}" {{/if}}'
        + '>'
        + '<img src="{{this.image.src}}" alt="{{this.image.alt}}" title="{{this.image.title}}"></img>'
        + '<iframe class="m-34-video" src="{{[video-source]}}" width="100%" height="100%" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>'
        + '</a>';
  },

  setVideoTemplateHTML5: function () {
    return '<a href="javascript:void(0);" class="{{this.class}} {{#if this.highlight}}is-highlight{{/if}} loaded" data-filter-category="'
        + '{{#each this.categories}}'
        + '{{this}}'
        + '{{/each}}"'
        + '{{#if [video-source]}} data-video-source="{{[video-source]}}" {{/if}}'
        + '>'
        + '<img src="{{this.image.src}}" alt="{{this.image.alt}}" title="{{this.image.title}}"></img>'
        + '<video class="m-34-video" width="100%" height="100%" poster="{{this.image.src}}" controls>'
        + '  <source src="{{[video-source]}}" type="video/mp4">'
        + '</video>'
        + '</a>';
  },

  addRendersetToItemView: function () {
    var renderSet = this.collection.displayedItems;

    for (i = 0; i < renderSet.length; i++) {
      var currentItem = renderSet[i];

      if (currentItem['video-source']) {
        if (currentItem['video-source'].indexOf('.mp4') < 0) {
          this.$el.append(this.templateVideoIframe(currentItem));
        }
        else {
          this.$el.append(this.templateVideoHTML5(currentItem));
        }
      } else {
        this.$el.append(this.template(currentItem));
      }
    }
  },

  render: function () {
    var items = $('.second .m-34-item');
    var loadMore = this.loadMore;
    var ItemsView = this;
    var renderSet = ItemsView.collection.displayedItems;

    items.removeClass('loaded');

    if (renderSet.length > 0) {

      // remove item loop from hbs template
      // and do the looping in JS to keep the hbs simple
      this.addRendersetToItemView();

      var loadedItems = $('.second .m-34-item.loaded');
      loadMore.addClass('is-loading');

      var index = 0;

      loadedItems.each(function () {
        if (this['className'].indexOf('head-item') <= -1) {

          // TODO: this is bad as not every tile has an image
          // >> workaround for iframe and html5 video tiles
          //    is to load an unnessassary dummy image
          $(this).find('img').on("load", function () {
            index++;
            if (index == renderSet.length) {
              var delay = 0;
              loadMore.removeClass('is-loading');
              loadedItems.each(function () {
                var self = this;
                TweenMax.to($(self), 0.25, {
                  display: "inline-block",
                  scale: 1.01,
                  autoAlpha: 1,
                  ease: Linear.easeNone,
                  delay: delay
                });
                TweenMax.to($(self), 0.25, {
                  scale: 1,
                  autoAlpha: 1,
                  ease: Linear.easeNone,
                  delay: delay + 0.25
                });

                delay = delay + 0.1;
              });
              ItemsView.collection.checkIfEndOfContent();
            }
          });
        }
      });

      moduleResize(true);
    } else {
      ItemsView.setNoReports();
    }
  },

  setEndOfContent: function () {
    this.loadMore.addClass('no-more-content');
  },

  setNoReports: function () {
    this.loadMore.addClass('no-more-content');
    this.noReports.addClass('active');
  },

  nextPage: function () {
    this.collection.page++;
    this.collection.getFilteredItems();
  },

  removeContent: function () {
    this.loadMore.removeClass('no-more-content');
    this.noReports.removeClass('active');
    this.$el.find('.m-34-item').remove();
    this.collection.amountDisplayedItems = 0;
  }
});;
/**
 * Created by Benjamin Latz <benjamin.latz@udg.de> on 8/08/2016
 */

var FiltersView = Backbone.View.extend({
    el: '.m34-filter-layer',
    displayCollection: undefined,

    /* templating variables */
    filterTemplate: undefined,
    highlightTemplate: undefined,
    seasonTemplate: undefined,

    chosenFilters: undefined,
    chosenSeasons: undefined,
    filterUpdateList: undefined,

    filterCookieList: undefined,

    highlightsOnly: false,

    checked: 'is-checked',
    clickable: 'clickable',
    greyed: 'greyed',
    filterActive: 'active',

    events: {
        "click .m-34-filter-collapse": "collapseFilter",
        "click .m-34-highlights .m-34-filter.clickable": "onHighlightCheckboxClick",
        "click .m-34-seasons .m-34-filter.clickable": "onFilterCheckboxClick",
        "click .m-34-filters .m-34-filter.clickable": "onFilterCheckboxClick"
    },

    initialize: function ()
    {
        var self = this;

        self.handlebarsHelper();

        var filterTemplate = self.setFilterTemplate();
        var seasonTemplate = self.setSeasonTemplate();
        // self.highlightTemplate = self.setHighlightTemplate();

        self.filterTemplate = Handlebars.compile(filterTemplate);
        self.seasonTemplate = Handlebars.compile(seasonTemplate);

        self.chosenFilters = [];
        self.chosenSeasons = [];
        self.filterUpdateList = [];

        self.filterCookieList = [];

        this.listenTo(self.collection, 'filtersReady', self.render);
        this.listenTo(self.collection, 'updateFilterAmounts', self.setFilterAmounts);
        this.listenTo(self.collection, 'setFilterCookies', self.setFilterCookies);

        // bind click event
        // because Element is not in $el Scope
        $('.m-34-filters-reset-btn').on('click', _.bind(this.onFilterResetClick, this));
    },

    handlebarsHelper: function(){
        Handlebars.registerHelper("setNewColumnStart", function(value)
        {
            if(value % 5 == 0){
                return '<div class="column">';
            }else{
                return '';
            }
        });
        Handlebars.registerHelper("setNewColumnEnd", function(value)
        {
            if(value % 5 == 4){
                return '</div>';
            }else{
                return '';
            }
        });
        Handlebars.registerHelper("setSeasonText", function(value)
        {
            return value.replace('Season ', ' ');
        });
    },

    setFilterTemplate: function ()
    {
        return '{{#each []}}'
            + '{{{setNewColumnStart @index}}}'
            + '<div class="m-34-filter ' + this.clickable + '" data-filter-kind="filter-category" data-filter-category="'
            + '{{this.filter}}"'
            + '>'
            + '<div class="m-34-filter-checkbox"></div>'
            + '<div class="m-34-filter-label">'
            + '{{this.filterText}}<span class="filter-amount"> (0)</span></div>'
            + '</div>'
            + '{{{setNewColumnEnd @index}}}'
            + '{{/each}}';
    },

    setSeasonTemplate: function ()
    {
        var seasonText = $('#season-text').val();

        return '{{#each []}}'
            + '<div class="m-34-filter ' + this.clickable + '" data-filter-kind="season-category" data-filter-category="'
            + '{{this.filter}}"'
            + '>'
            + '<div class="m-34-filter-checkbox"></div>'
            + '<div class="m-34-filter-label">'
            + seasonText + '{{setSeasonText this.filterText}}</div>'
            + '</div>'
            + '{{/each}}';
    },

    // setHighlightTemplate: function ()
    // {
    //     return '<div class="m-34-filter ' + this.clickable + '" data-filter-kind="highlight-category" data-filter-category="'
    //         + 'highlights-only"'
    //         + '>'
    //         + '<div class="m-34-filter-checkbox"></div>'
    //         + '<div class="m-34-filter-label">'
    //         + 'Highlights</div>'
    //         + '</div>';
    // },

    render: function ()
    {
        var renderFilterSet = [];
        var renderSeasonSet = [];

        var actualFilters = this.collection.actualFilters;
        var actualSeasons = this.collection.actualSeasons;

        var filters = $('.m-34-filter-items');
        var highlights = $('.m-34-highlight-items');
        var seasons = $('.m-34-season-items');

        for (var key in actualFilters)
        {
            var value = actualFilters[key];
            renderFilterSet.push(value);
        }

        for (var key in actualSeasons)
        {
            var value = actualSeasons[key];
            renderSeasonSet.push(value);
        }

        if (renderFilterSet.length > 0)
        {
            filters.append(this.filterTemplate(renderFilterSet));
        }
        if (renderSeasonSet.length > 0)
        {
            seasons.append(this.seasonTemplate(renderSeasonSet));
        }

        // highlights.append(this.highlightTemplate);
        this.setFilterAmounts();
    },

    collapseFilter: function ()
    {
        this.$el.find('.m-34-filter-wrapper').toggleClass('is-collapsed');
    },

    onHighlightCheckboxClick: function (e)
    {
        var target = e.currentTarget;
        var filtersView = this;
        filtersView.filterUpdateList = [];

        if ($(target).hasClass(filtersView.checked))
        {
            $(target).removeClass(filtersView.checked);
        } else
        {
            $(target).addClass(filtersView.checked);
        }

        if (filtersView.highlightsOnly)
        {
            filtersView.highlightsOnly = false;

            filtersView.$el.find('.m-34-seasons').removeClass(filtersView.greyed);
            filtersView.$el.find('.m-34-filters').removeClass(filtersView.greyed);
            filtersView.$el.find('.m-34-seasons .m-34-filter').addClass(filtersView.clickable);
            filtersView.$el.find('.m-34-filters .m-34-filter').addClass(filtersView.clickable);

            filtersView.updateUpdateList();
        } else
        {
            filtersView.highlightsOnly = true;

            filtersView.$el.find('.m-34-seasons').addClass(filtersView.greyed);
            filtersView.$el.find('.m-34-filters').addClass(filtersView.greyed);
            filtersView.$el.find('.m-34-seasons .m-34-filter').removeClass(filtersView.clickable);
            filtersView.$el.find('.m-34-filters .m-34-filter').removeClass(filtersView.clickable);

            filtersView.collection.updateCategories(filtersView.filterUpdateList, filtersView.highlightsOnly);
        }

    },

    updateUpdateList: function ()
    {
        var filtersView = this;
        var filterKind;
        var filter;

        filtersView.chosenFilters = [];
        filtersView.chosenSeasons = [];
        filtersView.filterUpdateList = [];

        _.each(filtersView.$el.find('.m-34-filter'), function (item)
        {

            if ($(item).hasClass(filtersView.checked))
            {
                filterKind = item.getAttribute('data-filter-kind');
                filter = item.getAttribute('data-filter-category');

                if (filterKind == "filter-category")
                {
                    filtersView.chosenFilters.push(filter);
                    filtersView.filterUpdateList[filterKind] = filtersView.chosenFilters;
                }
                else if (filterKind == "season-category")
                {
                    filtersView.chosenSeasons.push(filter);
                    filtersView.filterUpdateList[filterKind] = filtersView.chosenSeasons;
                }
            }
        }, this);

        filtersView.collection.updateCategories(filtersView.filterUpdateList, filtersView.highlightsOnly);
    },

    onFilterCheckboxClick: function (e)
    {
        var target = e.currentTarget;
        var filtersView = this;
        var filterKind;
        var filter;

        filtersView.chosenFilters = [];
        filtersView.chosenSeasons = [];
        filtersView.filterUpdateList = [];

        if ($(target).hasClass(filtersView.checked))
        {
            $(target).removeClass(filtersView.checked);
        } else
        {
            $(target).addClass(filtersView.checked);
        }

        _.each(filtersView.$el.find('.m-34-filter'), function (item)
        {

            if ($(item).hasClass(filtersView.checked))
            {
                filterKind = item.getAttribute('data-filter-kind');
                filter = item.getAttribute('data-filter-category');

                if (filterKind == "filter-category")
                {
                    filtersView.chosenFilters.push(filter);
                    filtersView.filterUpdateList[filterKind] = filtersView.chosenFilters;
                }
                else if (filterKind == "season-category")
                {
                    filtersView.chosenSeasons.push(filter);
                    filtersView.filterUpdateList[filterKind] = filtersView.chosenSeasons;
                }
            }
        }, this);

        filtersView.collection.updateCategories(filtersView.filterUpdateList, filtersView.highlightsOnly);
    },

    onFilterResetClick: function ()
    {
        var self = this;
        self.highlightsOnly = false;

        self.chosenFilters = [];
        self.chosenSeasons = [];
        self.filterUpdateList = [];

        self.$el.find('.m-34-seasons').removeClass(self.greyed);
        self.$el.find('.m-34-filters').removeClass(self.greyed);
        self.$el.find('.m-34-filter-label-active').removeClass(self.filterActive);
        self.$el.find('.m-34-seasons .m-34-filter').addClass(self.clickable);
        self.$el.find('.m-34-filters .m-34-filter').addClass(self.clickable);

        self.$el.find('.m-34-filter').removeClass(self.checked);

        self.collection.updateCategories(self.filterUpdateList, self.highlightsOnly);
    },

    setFilterAmounts: function ()
    {
        var self = this;
        var filterAmounts = self.collection.filterAmounts;
        var filters = self.$el.find('.m-34-filters .m-34-filter');

        _.each(filters, function (filter, n)
        {
            var category = filter.getAttribute('data-filter-category');

            var amount = 0;

            if (filterAmounts[category] != undefined)
            {
                amount = filterAmounts[category];
            } else
            {
                amount = 0;
            }

            $(filter).find('.filter-amount').html(' (' + amount + ')');

        }, this);

    },

    setFilterCookies: function ()
    {
        var self = this;
        var filters = self.$el.find('.m-34-filter');
        var filterArray = [];
        var highlights = false;
        

        _.each(filters, function (filter, n)
        {
            if ($(filter).hasClass(self.checked))
            {
                var category = filter.getAttribute('data-filter-category');
                if (category == "highlights-only")
                {
                    highlights = true;
                }
                filterArray.push(filter.getAttribute('data-filter-category'));
            }
        }, this);

        var json_str = JSON.stringify(filterArray);
        $.cookie('filterArray', json_str);
        // console.log(highlights);
        $.cookie('highlights', highlights);
        // console.log($.cookie('filterArray'));
        // console.log($.cookie('highlights'));
    },

    getFilterCookies: function ()
    {
        var self = this;
        var highlights = false;
        if ($.cookie('filterArray') != undefined)
        {
            var filterArray = JSON.parse($.cookie('filterArray'));
            if (filterArray != undefined)
            {
                self.filterCookieList = filterArray;
            }
        }
        if ($.cookie('highlights') != undefined)
        {
            if($.cookie('highlights') == "true"){
                highlights = true;
            }
            else{
                highlights = false;
            }
        }

        var seasonFilters = self.$el.find('.m-34-seasons .m-34-filter');
        var categoryFilters = self.$el.find('.m-34-filters .m-34-filter');

        _.each(seasonFilters, function (filter)
        {
            var category = filter.getAttribute('data-filter-category');
            if (self.filterCookieList.indexOf(category) > -1)
            {
                $(filter).addClass(self.checked);
            }
        }, this);
        _.each(categoryFilters, function (filter)
        {
            var category = filter.getAttribute('data-filter-category');
            if (self.filterCookieList.indexOf(category) > -1)
            {
                $(filter).addClass(self.checked);
            }
        }, this);

        if(highlights){
            $('.m-34-highlights .m-34-filter.clickable').click();
        }else{
            self.updateUpdateList();
        }
    }
});;
//WICHTIG!!
//Hier wird zwischen zwei Viewmodes unterschieden ("simpleList", "regularList" und "promoteFirst")
//Bei Anpassungen beachten, in welchem Viewmode man sich befindet!
//[B.L.] 02.08.2016

(function($, window, document, undefined) {

    var countAllArticles = 0;
    var countShownArticles = 0;
    var rot = 0;
    var transtime = 350;
    this.modulName = ".m-34-report-grid";
    this.itemClass = ".m-34-item";
    this.specialtextWrapper = ".m-34-specialtext-wrapper";
    this.specialText = ".m-34-specialtext";
    this.metaWrapper = ".m-34-meta-wrapper";
    this.dynamicContent = ".m-34-dynamiccontent";
    this.galleryHeader = ".m-34-galleryheader";
    this.filterLayer = ".m34-filter-layer";
    this.leftHead = ".first-left";
    this.rightHead = ".first-right";

    this.lastBreakPoint = null;
    this.currentBreakPoint = null;

    if ($(this.modulName).length < 1) {
      return;
    }

    // filters
    var availableFilters = [],
        choosenFilters = [],
        isCollapsedClass = 'is-collapsed',
        isCheckedClass = 'is-checked',
        isHiddenClass = 'is-hidden',
        filterWrapper = '.m-34-filter-wrapper',
        filterBtnCollapse = '.m-34-filter-collapse',
        filterBtnReset = '.m-34-filters-reset-btn',
        filterCheckboxContainer = '.m-34-filters',
        filterHighlightContainer = '.m-34-highlight-items',
        filterSeasonsContainer = '.m-34-season-items',
        filterBtnCheckbox = '.m-34-filter',
        isFilterUsed = gridProperties['usefilter'],
        viewmode = gridProperties['viewmode'];

    if (viewmode == 'promoteFirst' || viewmode == 'regularList') {
        //Remove all by xslt generated HTML Items (just for old viewmode and search engines necessary)
        $(document).ready(function() {
            var items = $('.m34-items.second');
            items.find('.m-34-item img').removeAttr("src");
            items.find('.m-34-item').remove();
        });
        filterCheckboxContainer = '.m-34-filter-items';
    }

    $(this.modulName).addClass(viewmode);
    $('body').addClass(viewmode);

    if (!isFilterUsed) {
        $(this.filterLayer).addClass('hidden');
    }else{
		var parents = $(this.filterLayer).parents('.b-standard-module');
		if($(parents).length <= 0){
			$(this.filterLayer).addClass('to-grid');
		}
    }

    var self = this;

    arrange_1_1 = function() {
        arrange("1_1");
    };

    arrange_1_2 = function() {
        arrange("1_2");
    };

    arrange_2_1 = function() {
        arrange("2_1");
    };

    arrange_2_2 = function() {
        arrange("2_2");
    };

    arrange_2_3 = function() {
        arrange("2_3");
    };

    arrange_3_2 = function() {
        arrange("3_2");
    };

    clear_arrangement = function() {
        //transOut($(itemClass).removeClass("m34-full m34-half m34-third m34-66p-width"));
        $(itemClass).removeClass("m34-full m34-half m34-third m34-66p-width");
    };

    arrange = function(sort) {
        this.clear_arrangement();
        var c = 0;
        countAllArticles = $(itemClass).size();

        for (var i = 0; i < countAllArticles; i++) {

            if (!$(itemClass + ":eq(" + i + ")").hasClass(isHiddenClass)) {
                if (sort == "1_1") {
                    if (viewmode == "simpleList") {
                        $(itemClass + ":eq(" + i + ")").addClass("m34-full");
                    } else if (viewmode == "promoteFirst") {
                        if (c != 0) {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-full");
                        }
                    } else if (viewmode == "regularList") {
                        $(itemClass + ":eq(" + i + ")").addClass("m34-full");
                    }
                }
                if (sort == "1_2") {
                    if (c == 0) {
                        if (viewmode == "simpleList") {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-full");
                        }
                    } else {
                        if (c % 3 != 1) {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-half");
                        }
                    }
                }
                if (sort == "2_1") {
                    if (c == 0) {
                        if (viewmode == "simpleList") {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-full");
                        }
                    } else {
                        if (c % 3 != 0) {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-half");
                        }
                    }
                }
                if (sort == "2_2") {
                    $(itemClass + ":eq(" + i + ")").addClass("m34-half");
                }
                if (sort == "2_3") {
                    if (c == 0) {
                        if (viewmode == "simpleList") {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-66p-width");
                        }
                    } else {
                        if (c % 5 == 1 || c % 5 == 2) {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-half");
                        } else {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-third");
                        }
                    }
                }
                if (sort == "3_2") {
                    if (viewmode == "regularList") {
                        var temp = c + 1;
                        if (temp % 5 == 4 || temp % 5 == 0) {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-half");
                        } else {
                            $(itemClass + ":eq(" + i + ")").addClass("m34-third");
                        }
                    } else {
                        if (c == 0) {
                            if (viewmode == "simpleList") {
                                $(itemClass + ":eq(" + i + ")").addClass("m34-66p-width");
                            }
                        } else {
                            if (c % 5 == 4 || c % 5 == 0) {
                                $(itemClass + ":eq(" + i + ")").addClass("m34-half");
                            } else {
                                $(itemClass + ":eq(" + i + ")").addClass("m34-third");
                            }
                        }
                    }
                }
                c++;
            }
        }
        switchBreakpointHeader(currentBreakPoint);
    };

    headerThirds = function() {
        $(dynamicContent + "," + galleryHeader).appendTo(metaWrapper);
        $(itemClass).not('.' + isHiddenClass).first().addClass("m34-66p-width");
    };

    headerFull = function() {
        $(dynamicContent + "," + galleryHeader).insertAfter(metaWrapper);
        $(dynamicContent).insertAfter($(itemClass).not('.' + isHiddenClass).first());
        $(itemClass).not('.' + isHiddenClass).first().removeClass("m34-66p-width");
        $(itemClass).not('.' + isHiddenClass).first().addClass("m34-full");
    };

    headerThirdsPromote = function() {
        if ($(dynamicContent).length > 0) {
            $(galleryHeader).insertBefore(dynamicContent);
        } else {
            $(galleryHeader).appendTo(rightHead);
        }
    };

    headerFullPromote = function() {
        $(galleryHeader).appendTo(metaWrapper);
    };

    viewMobile = function() {
        arrange_1_1();
    };

    viewTablet = function() {
        if (viewmode == "simpleList") {
            myItemCount = articleVisible();
            rest = ((myItemCount - 2) % 2);
            if (rest == 0) {
                arrange_1_2();
            } else {
                arrange_2_1();
            }
        } else if (viewmode == "promoteFirst" || viewmode == 'regularList') {
            arrange_2_2();
        }

    };

    viewDesktop = function() {
        if (viewmode == "simpleList") {
            rest = ((articleVisible() - 1) % 5);
            if (rest == 3 || rest == 0) {
                arrange_3_2();
            } else {
                arrange_2_3();
            }
        } else if (viewmode == "promoteFirst" || viewmode == 'regularList') {
            arrange_3_2();
        }
    };

    moduleResize = function(force) {
        force = force || false;
        currentBreakPoint = getCurrentBreakPoint();

        if (lastBreakPoint != currentBreakPoint || force === true) {
            lastBreakPoint = currentBreakPoint;
            switchBreakpoint(currentBreakPoint);
        }
    };


    switchBreakpoint = function(currentBreakPoint) {
        switch (currentBreakPoint) {
            case "mobile":
                viewMobile();
                break;
            case "tablet":
                viewTablet();
                break;
            case "desktop":
                viewDesktop();
                break;
            default:
                console.log("error");
        }
    };

    switchBreakpointHeader = function(currentBreakPoint) {
        if (viewmode == "simpleList") {
            switch (currentBreakPoint) {
                case "mobile":
                    headerFull();
                    break;
                case "tablet":
                    headerFull();
                    break;
                case "desktop":
                    headerThirds();
                    break;
                default:
                    console.log("error");
            }
        } else if (viewmode == "promoteFirst" || viewmode == 'regularList') {
            switch (currentBreakPoint) {
                case "mobile":
                    headerFullPromote();
                    break;
                case "tablet":
                    headerFullPromote();
                    break;
                case "desktop":
                    headerThirdsPromote();
                    break;
                default:
                    console.log("error");
            }
        }
        //transIn();
    };

    transOut = function(callback) {
        $(itemClass).animate({
            opacity: 0
        }, 1, function() {
            callback;
        });
    };

    transIn = function() {
        $(itemClass).animate({
            opacity: 1
        }, 1000);
    };

    transOutText = function() {
        $(specialText).animate({
            "opacity": 1
        }, 1, function() {
            $(specialtextWrapper).addClass("open");
            $(specialtextWrapper).find('.m-34-specialtext').stop(true, true).slideDown();
        });
    };

    transInText = function() {
        $(specialText).animate({
            opacity: 1
        }, 1, function() {
            $(specialtextWrapper).removeClass("open");
            $(specialtextWrapper).find('.m-34-specialtext').stop(true, true).slideUp();
        });
    };

    m_34_specialtext_changestate = function() {
        if ($(specialtextWrapper).hasClass("open")) {
            transInText();
        } else {
            transOutText();
        }
    };


  getCurrentBreakPoint = function() {
        var type = (window.getComputedStyle(document.querySelector(modulName), ':after').getPropertyValue('content')).replace('\'', '').replace('\'', '').replace('"', '').replace('"', '');
        return type;
    };

    function myTimeoutCall(time, index) {
        window.setTimeout(myRotation, time, index, time);
    }

    function myRotation(index, time) {
        if (Modernizr.csstransitions) {
            $(itemClass).css({
                "transition": "all " + transtime + "ms ease-in-out"
            });
        }
        if (Modernizr.csstransitions) {
            $(itemClass + ":eq(" + index + ")").css({ "transform": "rotateY(" + rot + "deg)" });
        } else {
            $(itemClass).stop().animate({ rotation: rot }, {
                duration: transtime,
                step: function(now, fx) {
                    $(itemClass + ":eq(" + index + ")").css({ "transform": "rotateY(" + now + "deg)" });
                }
            });
        }
    }

    rotateItems = function() {
        for (var i = 0; i < $(itemClass).length; i++) {
            myTimeoutCall((i * transtime), i);
        }
    };

    getAvailableFilters = function() {
        var filters = gridProperties.availableFilters;

        availableFilters = [];

        for (var f = 0; f < filters.length; f++) {
            availableFilters.push(filters[f].filter);
            setAvailableFilterBox(filters[f]);
        }
        _registerFilterEvents();
    };

    function setAvailableFilterBox(filter, temp) {
        var filterHtml = '<div class="m-34-filter" data-filter-category="' + filter.filter + '">' +
            '<div class="m-34-filter-checkbox"></div>' +
            '<div class="m-34-filter-label">' + filter.filterText + '</div>' +
            '</div>';

        $(filterCheckboxContainer).append(filterHtml);
    }

    function _registerFilterEvents() {
        $(filterBtnCollapse).on('click', _onFilterCollapseClick);
        $(filterBtnCheckbox).on('click', _onFilterCheckboxClick);
        $(filterBtnReset).on('click', _onFilterResetClick);
    }

    function _onFilterCollapseClick(e) {
        e.preventDefault();
        $(filterWrapper).toggleClass(isCollapsedClass);
    }

    function _onFilterCheckboxClick(e) {
        e.preventDefault();

        var filter = $(this).attr('data-filter-category');

        if ($(this).hasClass(isCheckedClass)) {
            $(this).removeClass(isCheckedClass);
            _removeFilter(filter);
        } else {
            $(this).addClass(isCheckedClass);
            _addFilter(filter);
        }

        _refreshFilterResult();
    }


    function _addFilter(filter) {
        var index = $.inArray(filter, choosenFilters);

        if (index === -1) {
            choosenFilters.push(filter);
        }
    }

    function _removeFilter(filter) {
        var index = $.inArray(filter, choosenFilters);

        if (index !== -1) {
            choosenFilters.splice(index, 1);
        }
    }

    function _onFilterResetClick(e) {
        e.preventDefault();

        choosenFilters = [];
        $(filterBtnCheckbox).removeClass(isCheckedClass);

        _refreshFilterResult();
    }

    function articleVisible() {
        return (countAllArticles - countShownArticles);
    }

    function _refreshFilterResult() {
        countAdds = 0;
        $(itemClass).each(function(index) {
            var itemFilter = $(this).attr('data-filter-category'),
                isChoosen = $.inArray(itemFilter, choosenFilters);

            if (isChoosen !== -1 || choosenFilters.length === 0) {
                $(this).removeClass(isHiddenClass);
            } else {
                $(this).addClass(isHiddenClass);
                countAdds++;
            }
        });

        countShownArticles = countAdds;
        moduleResize(true);
    }

    $(document).ready(function() {
        if (viewmode == 'promoteFirst' || viewmode == 'regularList') {
            var itemCollection = new ItemCollection();

            var itemsView = new ItemsView({
                collection: itemCollection
            });


            var filtersView = new FiltersView({
                collection: itemCollection
            });

            itemCollection.getActualFilters();
            if ($.cookie('filterArray') != undefined && $.cookie('highlights') != undefined) {
                filtersView.getFilterCookies();
            } else {
                itemCollection.getFilteredItems();
            }
        }

        $(galleryHeader).hover(
            function() {
                transOutText();
            },
            function() {
                transInText();
            }
        );

        $(galleryHeader).bind("click", function() {
            m_34_specialtext_changestate();
        });

        if (viewmode == 'simpleList') {
            getAvailableFilters();
            moduleResize();
        }
    });


    $(window).resize(function() {
        moduleResize();
    });

    $(window).load(function() {
        if (viewmode == "simpleList") {
            rotateItems();
        }
    });

})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
    'use strict';

    var $document = $(document),
        imageScaler;

    $document.ready(function () {
        _lazyInit();
    });

    function _lazyInit()
    {
        var $elements = $('.m-36-image-reel'),
            $eventRootElement;

        if ($elements.length > 0)
        {
            imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

            $elements.each(function (i, el) {
                var $el = $(el);
                if (window.pageController)
                {
                    $eventRootElement = $el.parents(window.pageController.moduleSelectorForParentsMethod);
                    $eventRootElement = $eventRootElement.length > 0 ? $eventRootElement : $el;
                    $eventRootElement.one(window.pageController.eventNames.lazyInit, function () {
                        _init($el);
                    });
                }
                else
                {
                    _init($el);
                }
            });
        }
    }

    function _imageScaler($el)
    {
        $el.find(".m-36__poster img").each(function () {
            var $img = $(this),
                scaleParam = imageScaler.getScaleParameter($img);
            imageScaler.replaceSource($img, $img.attr('data-image-src'), scaleParam);
        });
    }

    function _init($el)
    {
        _imageScaler($el);
        new ModuleView({el: $el});
    }

    var ModuleView = Backbone.View.extend({
        events: {
            "click .m-36__activation": "_open",
            "click .m-36__close": "_close"
        },

        initialize: function () {
            this.settings = _.omit(this.$el.data(), 'lazy');

            this._parseSettings();

            this.render();
        },

        _parseSettings: function () {

            // Parse autoload via autoloadmode
            if (_.isBoolean(this.settings.autoload) === false) {
                switch (this.settings['autoloadmode']) {
                    case 'activation-mobile-only':
                        this.settings.autoload = matchMediaQuery.getCurrentMediaQuery().pos > 2;
                        break;
                    case 'activation':
                        this.settings.autoload = false;
                        break;
                    default:
                        this.settings.autoload = true;
                        break;
                }
            }
        },

        _initData: function () {
            var imageIntro,
                imageLoop,

                startOption,

                lastFrameOfIntro = 1,
                introSources = [],
                introExists = false,

                i;

            //checks the id of module and picks the matching object
            this.imageDataID = this.settings['reelImageArrayId'];
            this.imageData = window["reelImageArray_" + this.imageDataID];

            imageIntro = this.$el.find("#image-intro-" + this.imageDataID);
            imageLoop = this.$el.find("#image-loop-" + this.imageDataID);

            // Image Scaling
            this.settings.imageSize = {
                'imageIntro': imageScaler.getScaleParameter(imageIntro),
                'imageLoop': imageScaler.getScaleParameter(imageLoop)
            };
            imageScaler.replaceSource(imageIntro, imageIntro.attr('data-image-src'), this.settings.imageSize.imageIntro);
            imageScaler.replaceSource(imageLoop, imageLoop.attr('data-image-src'), this.settings.imageSize.imageLoop);

            //check if there is an intro and save the chosen last frame of intro and other variables of Intro Object into variables
            if (this.imageData.images.intro && this.imageData.images.intro.in && this.imageData.images.intro.in.length > 0)
            {
                lastFrameOfIntro = this.imageData.images.intro['last-frame-of-intro'];
                introSources = this.imageData.images.intro.in;
                introExists = true;
            }

            if (introSources.length > 0)
            {
                for (i = 0; i < introSources.length; i++)
                {
                    introSources[i] = imageScaler.getScaledImageUrl(introSources[i], this.settings.imageSize.imageIntro);
                }
            }


            this.optionsArray = [];
            //loop through content of object->images of current module
            _.each(this.imageData.images.options, _.bind(function (value, key, list) {
                this.optionsArray.push(key);
            }, this));

            //loop through options array
            _.each(this.optionsArray, _.bind(this._processOptions, this));

            // console.log(imageArray);

            //start option for loop is the first option in Array
            startOption = this.optionsArray[0];
            startOption = this.imageData.images.options[startOption];

            this.imageIntro = imageIntro;
            this.imageLoop = imageLoop;
            this.startOption = startOption;
            this.lastFrameOfIntro = lastFrameOfIntro;
            this.introExists = introExists;

        },

        _processOptions: function (value, key, list) {
            var data,
                loopSources,
                config,
                iconClass,
                i;

            data = this.imageData.images.options[value];
            loopSources = data['loop'];
            config = data['config'];
            iconClass = config['icon'];

            for (i = 0; i < loopSources.length; i++)
            {

                loopSources[i] = imageScaler.getScaledImageUrl(loopSources[i], this.settings.imageSize.imageLoop);
            }

            //if there are more than one option -> instantiate an option-switch
            if (list.length > 1)
            {
                //for each option one switch
                this.$el.find('#option-switches-' + this.imageDataID).append(
                    '<span '
                    + 'id="option-switch-' + i + '-' + key + '-' + this.imageDataID + '"'
                    + ' class="option-switch ' + iconClass + ' option-switch-id-' + this.imageDataID + '"'
                    + ' title="' + value + '"'
                    + '></span>'
                );

                m36_image_reel.initSwitch(i, key, value, this.imageDataID, this.imageData);

            } else if (this.optionsArray.length === 1 && iconClass !== 'requiredDummy')
            {

                this.$el.find('#option-switches-' + this.imageDataID).append(
                    '<span style="opacity:0" class="option-switch ' + iconClass + '"></span>'
                );
            }
        },

        render: function () {
            this.$imageReelContainer = this.$el.find('.reel-container');

            if (this.settings.autoload && !this.imageReelOpen)
            {
                this._open();
            } else
            {
                this.$imageReelContainer.hide();
            }
        },

        _open: function () {
            this.imageReelOpen = true;

            this.$imageReelContainer.show();

            if (this.imageReelInitialized !== true)
            {
                this._initData();

                //initialization of  each reel module with given parameters
                m36_image_reel.initModule(
                    this.imageData,
                    this.imageDataID,
                    this.imageIntro,
                    this.imageLoop,
                    this.startOption,
                    this.lastFrameOfIntro,
                    this.introExists,
                    undefined,
                    "spinner"
                );
                this.imageReelInitialized = true;
            }

        },

        _close: function () {
            this.$imageReelContainer.hide();
            this.imageReelOpen = false;
        }
    });
})(jQuery, this, this.document);


var m36_image_reel = {

    introClicked: false,

    //initialization function of each reel module
    initModule: function (imageArray, imageArrayID, imageIntro, imageLoop, startOption, lastFrameOfIntro, introExists, cursorOption, loadingOption) {

        var $play = $("#play-" + imageArrayID),
            self = this;

        self.introClicked = false;

        //while images are loading, the "cover" div will cover the intro section, so the Picture and the Play Button are not clickable
        $('#reel-container-' + imageArrayID).append('<div class="cover" id="cover-' + imageArrayID + '_1"></div>');

        if (!introExists)
        {
            $play.hide();
        }

        //when "play" button gets clicked, a click on the whole intro image/div gets triggered
        $play.on("click", function () {
            imageIntro.trigger("click");
            $(this).fadeOut('fast');
        });

        //when the whole intro image/div gets clicked, the "play" butten fades out and the option switches fade in
        imageIntro.on("click", function () {
            $play.fadeOut('fast');
            //$('#image-loop-' + imageArrayID + '-reel .reel-indicator').css("display", "block");

            //while image-intro is loading, the "cover" div will cover the intro section, so the animation is not draggable
            $('#reel-container-' + imageArrayID).append('<div class="cover" id="cover-' + imageArrayID + '_2"></div>');
            self.introClicked = true;
        });

        //after loop is loaded, the reel indicator gets it's span with class "inside"
        imageLoop.on("loaded", function () {
            if ($('#image-loop-' + imageArrayID + '-reel .reel-indicator.x .inside').length <= 0)
            {
                $('#image-loop-' + imageArrayID + '-reel .reel-indicator.x').append('<span class="inside"/>');
            }
            //after the images are loaded, the "cover-div" will be removed so the picture and the play button ar clickable
            $('#cover-' + imageArrayID + '_1').css("display", "none");


            // Remove loading spinner (when loop is loaded)
            $('.loadingIcon').fadeOut(1000, function () {
                $('.loadingIcon').remove();
            });

            if (!introExists && !self.introClicked)
            {
                imageIntro.trigger("click");
            }
        });

        //when "last-frame-of-intro" in images->intro->object is reached, the intro will fade out
        imageIntro.on("frameChange", function (e, depr_frame, frame) {
            var target_frame = lastFrameOfIntro;
            var first_frame = 1;
            if (frame === target_frame)
            {
                $('#image-intro-' + imageArrayID + '-reel').fadeOut();

                //after the image-intro is finished, the "cover-div" will be removed
                $('#cover-' + imageArrayID + '_2').css("display", "none");

                //and the option switches will fade in
                $('#option-switches-' + imageArrayID).animate({
                    opacity: 1
                }).find('.option-switch-id-' + imageArrayID).addClass('clickable');
            }

        });

        //check if there is a loop array in images->options->object in images-object
        if (startOption.loop)
        {
            var loop = startOption.loop;

            //[BL] 22.11.2017 hand cursor option for m-080-msp
            var cursorOptionDefault = "hand";

            if (typeof cursorOption !== 'undefined' && cursorOption !== '')
            {
                cursorOptionDefault = cursorOption;
            }

            //definition of reel loop options
            imageLoop.reel({
                cursor: cursorOptionDefault,
                images: loop,
                indicator: "16",
                responsive: "true",
                brake: "0.33",
                loops: "false"
            });
        }
        //check if there is a intro->object in images-object
        var intro,
            speed;

        if (imageArray.images.intro && imageArray.images.intro.in && imageArray.images.intro.in.length > 0)
        {
            intro = imageArray.images.intro.in;
            speed = "0.33";
        } else
        {
            intro = startOption.loop;
            speed = "0";
        }
        //definition of reel intro options
        imageIntro.reel({
            cursor: "ew-resize",
            duration: "3",
            images: intro,
            indicator: "0",
            loops: "false",
            responsive: "true",
            shy: "true",
            speed: speed
        });

        //adding classes "special-intro" and "special-loop" to intro and loop container for CSS
        $('#image-intro-' + imageArrayID + '-reel').addClass('special-intro');
        $('#image-loop-' + imageArrayID + '-reel').addClass('special-loop');

        //changing the CSS of image-intro container and of loop reel-indicator...IMPORTANT!
        $('#image-intro-' + imageArrayID + '-reel').css("position", "absolute");
        $('#image-loop-' + imageArrayID + '-reel .reel-indicator.x').css("overflow", "visible");

        // Add loading spinner (as long as loop is not loaded)
        if (loadingOption === 'spinner')
        {
            $('#image-loop-1-reel').append('<div class="loadingIcon"></div>');
        }
    },

    //change option function to load wanted images into loop reel of chosen module
    changeOption: function (option, imageArrayID, imageArray) {

        var allImages = imageArray.images;
        allImages = allImages.options[option];

        $('#image-loop-' + imageArrayID).reel("images", allImages.loop);

    },

    //init the on click eventhandler for each option switch
    initSwitch: function (index1, index2, option, imageArrayID, imageArray) {

        $('#option-switch-' + index1 + '-' + index2 + '-' + imageArrayID).click(function () {
            m36_image_reel.changeOption(option, imageArrayID, imageArray);
        });

    }
};;
(function ($, window, document, undefined) {
    'use strict';

    var DEV_MODE = false,
        DEV_OPTIONS = {
            proxyHostname: 'preview.ppn.porsche.com',
            proxyProtocol: 'https:',
            useLocalXML: true,
            useThisLocalXML: 'NY' // set to false to use the input value
        };


    var moduleClass = 'm-113__find-dealer',
        ModuleView,
        DealerBoxView,
        InfoWindowView,
        $dealerBoxViewTemplate = null,
        moduleInstances = [];

    var EVENT_NAMESPACE = moduleClass,
        EVENT = {
            searchValueValidated:   EVENT_NAMESPACE + ':' + 'searchValueValidated',
            searchStateValidated:   EVENT_NAMESPACE + ':' + 'searchStateValidated',
            searchResultProcessed:  EVENT_NAMESPACE + ':' + 'searchResultProcessed',
            dealerMarkerClicked:    EVENT_NAMESPACE + ':' + 'dealerMarkerClicked'
        };



    $(document).ready(function () {
        _lazyInit();
    });

    function _lazyInit()
    {
        $('.' + moduleClass).each(function (i, el) {
            var $el = $(el),
                $triggerElement = _getFirstRootElementOnPage($el);

            if (window.pageController)
            {
                $triggerElement.one(window.pageController.eventNames.lazyInit, function () {
                    _init(i, $el);
                    window.pageController.refresh();
                });
            }
            else
            {
                _init(i, $el);
            }
        });
    }

    function _getFirstRootElementOnPage($innerEl)
    {
        var $outerEl,
            rootElementSelector = [
                '.b-page-wrapper > div'
            ],
            i;

        if ($innerEl.length > 0)
        {
            for (i = 0; i < rootElementSelector.length; i++)
            {
                $outerEl = $innerEl.parents(rootElementSelector[i]);
                if ($outerEl.length > 0)
                {
                    return $outerEl;
                }
            }
        }
        return $innerEl;
    }

    function _init(i, $el)
    {
        var modelData = $el.data('model') != 'string' ? $el.data('model') : JSON.parse($el.data('model')),
            model = new Backbone.Model(modelData ? modelData : {}),
            view = new ModuleView({
                el: $el,
                model: model
            });

        moduleInstances[i] = view;
        fetchTemplateAndRender(view);
    }

    function fetchTemplateAndRender(moduleView) {
        var url = document.location.protocol + '//' + document.location.host;
        var pathname = document.location.pathname;
        url += '/gettext.xml?pool=root&id=hbs-api&group=hbs&text=dealersearch&language=none&callpath='+pathname;

        $.ajax({
            url : url,
            type: 'GET',
            dataType: 'xml',
            success:  function(data, status, xhr) {
                $dealerBoxViewTemplate = data.documentElement.innerHTML;
                moduleView.render();
            },
            error: function() {
            }
        });
    }

    DealerBoxView = Backbone.View.extend({
        events: {
        },
        initialize: function(options) {
            this.$view = options.$view;
        },
        render: function() {
            // var source = this.$view.html();
            var source = this.$view;
            var template = Handlebars.compile(source);
            var html = template(this.model);

            this.$el.html(html);
            return this;
        },
        onMarkerClick: function(e) {
            var $target = $(e.currentTarget);
            var dealerNo = $target.data('dealer-no');
            $(window).trigger(EVENT.dealerMarkerClicked, {dealerNo: dealerNo});
        }
    });

    InfoWindowView = Backbone.View.extend({
        initialize: function(options) {
            this.$view = options.$view;
        },
        render: function() {
            var source = this.$view.html();
            var template = Handlebars.compile(source);
            var html = template(this.model);
            this.$el.html(html);
            // this.$el.find('.m-113__infoWindow-image img').attr('src', this.model.infoWindowThumb);
            return this;
        }
    });

    ModuleView = ModuleBaseView.extend({
        events: {
        },

        // BREAK POINT
        SingleMarkerBreakpoint: 650,

        // URL
        urlSearchValue: undefined,

        // TOUCH
        hasTouch: undefined,

        // DEALER
        arrDealers: [],
        noDealersToShow: undefined,
        dealerWebSrvcType: undefined,
        dealerWebSrvcUrl: {
            proximity: undefined,
            nearestbyip: undefined,
            state: undefined,
            market: undefined,
            condition: undefined
        },

        // MAP
        map: undefined,
        mapApi: undefined,
        googleMapsHost: 'maps.googleapis.com',
        googleMapsApiUrl: undefined,
        baiduMapsApiUrl: 'https://api.map.baidu.com/getscript?v=2.0&ak=B74b66c16dece8bc726d25dcf77b6399&services=&key=20141104111948',

        //----------------------------------------------------------------------
        // INITIALIZATION
        //----------------------------------------------------------------------

        initialize: function (options) {
            ModuleBaseView.prototype.initialize.apply(this, [options]);

            // IMPLEMENT AFTER RENDER
            _.bindAll(this, 'render', 'afterRender');
            this.render = _.wrap(this.render, function(render) {
                render();
                this.afterRender();
                return this;
            });

            this.init();
            this.initModelData();
            this.initGoogleMapsApiUrl();
            this.initDealerWebSrvcUrl();
        },
        init: function() {
            this.hasTouch =  Modernizr.touch;
            this.mapApi = GLOBAL_CONFIG.pool == "china" ? "baidu" : "google";
            this.dealerWebSrvcType = (GLOBAL_CONFIG.pool == "usa" || GLOBAL_CONFIG.pool == "canada") ? "GS" : "LOCAL";
            this.noDealersToShow = (GLOBAL_CONFIG.pool == "usa" || GLOBAL_CONFIG.pool == "canada") ? 5 : 3;
        },
        initModelData: function() {
            if (typeof this.model.get('UI_GHS_SEARCH_IN_STATE') != 'string') this.model.set('UI_GHS_SEARCH_IN_STATE', '');
            if (typeof this.model.get('UI_GHS_MAXPROXIMITY') != 'string') this.model.set('UI_GHS_MAXPROXIMITY', '');
            if (typeof this.model.get('UI_GHS_MAXNUMTRIES') != 'string') this.model.set('UI_GHS_MAXNUMTRIES', '');
            if (typeof this.model.get('UI_GHS_MAXRESULTS') != 'string') this.model.set('UI_GHS_MAXRESULTS', '');
            if (typeof this.model.get('UI_GHS_LOCATION_TYPE') != 'string') this.model.set('UI_GHS_LOCATION_TYPE', 'Search.LocationTypes.Dealer');
        },
        initGoogleMapsApiUrl: function() {
            var protocol = this.getProtocol();
            var host = this.googleMapsHost;
            var UI_MAP_GOOGLE_MAPS_HOST = this.model.get('UI_MAP_GOOGLE_MAPS_HOST');

            if (UI_MAP_GOOGLE_MAPS_HOST != false && typeof UI_MAP_GOOGLE_MAPS_HOST == 'string' && UI_MAP_GOOGLE_MAPS_HOST.length > 3) {
                host = UI_MAP_GOOGLE_MAPS_HOST;
            }

            this.googleMapsApiUrl = protocol + '//' + host + '/maps/api/js?sensor=true';
            this.googleMapsApiUrl += '&language=' + GLOBAL_CONFIG.preferredLanguage;
            this.googleMapsApiUrl += '&client=gme-volkswagenag3';
            this.googleMapsApiUrl += '&channel=PORSCHE-' + GLOBAL_CONFIG.pool.toUpperCase() + '-DEALERSEARCH';
        },
        initDealerWebSrvcUrl: function() {
            var protocol = this.getProtocol();
            var host = this.getHost();
            var limit = 9;
            var url, searchpool, searchlanguage;

            if(this.dealerWebSrvcType == "LOCAL")
            {
                url = protocol + '//' + host + "/all/dealer2/GetLocationsWebService.asmx/GetLocationsInStateSpecialJS";
                searchpool = (this.model.get('UI_GHS_SEARCHPOOL') != undefined && this.model.get('UI_GHS_SEARCHPOOL') != "") ? this.model.get('UI_GHS_SEARCHPOOL') : GLOBAL_CONFIG.pool;
                searchlanguage = (this.model.get('language') != undefined && this.model.get('language') != "") ? this.model.get('language') : GLOBAL_CONFIG.language;

                this.dealerWebSrvcUrl['proximity'] = url + "?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=[[###STATE###]]&_locationType=" + this.model.get('UI_GHS_LOCATION_TYPE') + "&searchMode=proximity&searchKey=[[###POSITION###]]&address=[[###ADDRESS###]]&maxproximity=" + this.model.get('UI_GHS_MAXPROXIMITY') + "&maxnumtries=" + this.model.get('UI_GHS_MAXNUMTRIES') + "&maxresults=" + this.model.get('UI_GHS_MAXRESULTS');
                this.dealerWebSrvcUrl['nearestbyip'] = url + "?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=[[###STATE###]]&_locationType=" + this.model.get('UI_GHS_LOCATION_TYPE')  + "&searchMode=nearestbyip&searchKey=&address=&maxproximity=" + this.model.get('UI_GHS_MAXPROXIMITY') + "&maxnumtries=" + this.model.get('UI_GHS_MAXNUMTRIES') + "&maxresults=" + this.model.get('UI_GHS_MAXRESULTS');
                this.dealerWebSrvcUrl['state'] = url + "?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=[[###STATE###]]&_locationType=" + this.model.get('UI_GHS_LOCATION_TYPE')  + "&searchMode=state&searchKey=[[###STATE###]]&address=&maxproximity=" + this.model.get('UI_GHS_MAXPROXIMITY') + "&maxnumtries=" + this.model.get('UI_GHS_MAXNUMTRIES') + "&maxresults=" + this.model.get('UI_GHS_MAXRESULTS');
                this.dealerWebSrvcUrl['market'] = url + "?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=[[###STATE###]]&_locationType=" + this.model.get('UI_GHS_LOCATION_TYPE')  + "&searchMode=market&searchKey=&address=&maxproximity=" + this.model.get('UI_GHS_MAXPROXIMITY') + "&maxnumtries=" + this.model.get('UI_GHS_MAXNUMTRIES') + "&maxresults=" + this.model.get('UI_GHS_MAXRESULTS');
                this.dealerWebSrvcUrl['condition'] = url + "?market=" + GLOBAL_CONFIG.pool + "&language=" + GLOBAL_CONFIG.language + "&state=" + GLOBAL_CONFIG.region + "&siteId=" + GLOBAL_CONFIG.pool + "&searchMode=condition&_locationType=condition&searchKey=&address=&maxproximity=&maxnumtries=&maxresults=";
            }
            else
            {
                url = protocol + '//' + host + "/all/dealer2/";

                // As per the new requirement default is 9
                // if(GLOBAL_CONFIG.pool == "usa" && $(window).width() < 1007){
                //     limit = 4;
                // }

                this.dealerWebSrvcUrl['proximity'] = url + GLOBAL_CONFIG.pool + "/externalSearchXml.aspx?" + "geo=[[###POSITION###]]" + "&lim="+limit;
                this.dealerWebSrvcUrl['state'] = url + GLOBAL_CONFIG.pool + "/externalSearchXml.aspx?state=[[###STATE###]]";
                this.dealerWebSrvcUrl['condition'] = url + "GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?siteId=" + GLOBAL_CONFIG.pool + "&language=" + GLOBAL_CONFIG.language + "&state=" + GLOBAL_CONFIG.region;
            }
        },

        //
        //----------------------------------------------------------------------
        // RENDER
        //----------------------------------------------------------------------

        render: function () {
            ModuleBaseView.prototype.render.apply(this, arguments);

            // Blocker
            this.$blockerOverlay = this.$el.find('.m-113__blocker-overlay');
            // Form
            this.$formContainer = this.$el.find('.m-113__search-form-container');
            this.$dealerSearchForm = this.$el.find('.m-113__dealer-search-form');
            this.$dealerSearchInput = this.$el.find('.m-113__dealer-search-input');
            this.$dealerSearchBtn = this.$el.find('.m-113__dealer-search-button');
            this.$getCurrentLocationBtn = this.$el.find('.m-113__current-location-btn');
            this.$errorMsg = this.$el.find('.m-113__error-msg');
            // Map
            this.$mapContainer = this.$el.find('.m-113__map-container');
            this.$mapCanvas = this.$el.find('#m-113__map-canvas');
            // Result
            this.$resultContainer = this.$el.find('.m-113__result-container');
            this.$dealersList = this.$el.find('.m-113__dealers-list');
        },

        afterRender: function() {
            this.loadMap();
            this.setSlickSlider();
            this.setEventHandlers();
        },

        //
        //----------------------------------------------------------------------
        // Map
        //----------------------------------------------------------------------

        loadMap: function() {
            if(this.mapApi == 'google')
            {
                $.getScript(this.googleMapsApiUrl).done(function(script, textStatus) {
                    this.map = this.initGoogleMap();
                }.bind(this)).fail(function(jqxhr, settings, exception) {
                    alert('Google Maps Failed to load');
                }.bind(this));
            }
            else
            {
                $.getScript(this.baiduMapsApiUrl).done(function(script, textStatus) {
                    this.map = this.initBaiduMap();
                }.bind(this)).fail(function(jqxhr, settings, exception) {
                    alert('Baidu Maps Failed to load');
                }.bind(this));
            }
        },

        showSingleMarker: function() {
            var width = $(window).outerWidth();

            return width < this.SingleMarkerBreakpoint
        },

        //
        //----------------------------------------------------------------------
        // SLICK SLIDER
        //----------------------------------------------------------------------

        setSlickSlider: function() {
            this.$dealersList.slick({
                lazyLoad: 'ondemand',
                arrows: false,
                adaptiveHeight: false,
                centerMode: true,
                centerPadding: '10px',
                dots: true,
                mobileFirst: true,
                infinite: false,
                nextArrow: '<span class="slick-next"></span>',
                prevArrow: '<span class="slick-prev"></span>',
                responsive: [
                    {
                        breakpoint: 1200,
                        settings: {
                            centerMode: false,
                            slidesToShow: 4,
                            slidesToScroll: 4,
                            arrows: true,
                            dots: false
                        }
                    },
                    {
                        breakpoint: 992,
                        settings: {
                            centerMode: false,
                            slidesToShow: 3,
                            slidesToScroll: 3,
                            arrows: true,
                            dots: false
                        }
                    },
                    {
                        breakpoint: this.SingleMarkerBreakpoint,
                        settings: {
                            centerMode: false,
                            slidesToShow: 2,
                            slidesToScroll: 2
                        }
                    }
                ]
            });
        },

        afterSlickSliderInit: function(event, slick) {
            this.slickSlider = slick;
            this.updateMarkers(slick);
        },

        removeSlickSlides: function() {
            if(this.slickSlider) {
                for(var i = this.slickSlider.slideCount -1 ; i >= 0; i-- ) {
                    this.slickSlider.removeSlide(i);
                }
            }
            this.$dealersList.slick('unslick');
        },

        afterSlickSliderChanged: function(event, slick, currSlideNo) {
            this.updateMarkers();
        },

        updateMarkers: function() {
            this.unhighlightAllMarkers();

            if(this.highlightPinNo) {
                this.highlightMarker(this.highlightPinNo);
                this.highlightPinNo = false;
            }

            if(this.showSingleMarker()) {
                var activeSlides = this.$dealersList.find('.slick-current');
                var dealerNo = activeSlides.data('dealer-no');
                this.highlightMarker(dealerNo, activeSlides);
            }
        },

        goToSlickSlide: function(slideNo) {
            this.highlightPinNo = slideNo + 1;
            this.$dealersList.slick('slickGoTo', slideNo);
        },

        highlightMarker: function(index, slide) {
            if(!slide) {
                slide = this.$dealersList.find(".m-113__dealerBox[data-dealer-no="+index+"]");
            }
            slide.find('.m-113__dealerBox-marker .pin').addClass('red');
            this.map.panTo(index);
        },

        unhighlightAllMarkers: function($target) {
            this.map.unhighlightAllMarkers();
            this.$dealersList.find('.m-113__dealerBox-marker .pin').removeClass('red');
            if($target !== undefined) {
                $target.siblings().find('.m-113__dealerBox-dealerLinkList').hide(100);
                $target.siblings().find('.m-113__dealerBox-dealerName').removeClass('dealerLinkList-visible');
            }
            else {
                this.$dealersList.find('.m-113__dealerBox-dealerLinkList').hide();
                this.$dealersList.find('.m-113__dealerBox-dealerName').removeClass('dealerLinkList-visible');
            }
        },

        //
        //----------------------------------------------------------------------
        // FORM CONTAINER
        //----------------------------------------------------------------------

        hideFormContainer: function () {
            return; // SV: quick disable
            if (this.arrDealers.length) {
                TweenMax.to(this.$formContainer, 0.5, { y: -50, delay:0.5 });
            }
        },

        showFormContainer: function () {
            return; // SV: quick disable
            TweenMax.to(this.$formContainer, 0.5, { y: 0 });
        },

        //
        //----------------------------------------------------------------------
        // EVENTS
        //----------------------------------------------------------------------

        setEventHandlers: function() {
            this.$dealerSearchBtn.on('click', _.bind(this.onDealerSearchBtnClick,this));
            this.$getCurrentLocationBtn.on('click', _.bind(this.onGetCurrentLocationBtnClick,this));
            this.$dealerSearchForm.on('submit', _.bind(this.onDealerSearchFormSubmit,this));
            this.$dealerSearchForm.on(EVENT.searchValueValidated , _.bind(this.onSearchValueValidated,this));

            $('.slick-slider').on('click', '.slick-slide .m-113--pan-map', function(e){
                e.preventDefault();
                var $target = $(e.currentTarget).parents('.m-113__dealerBox');
                var dealerNo = $target.data('dealer-no');
                this.unhighlightAllMarkers($target);
                this.highlightMarker(dealerNo, $target);

                // $target.find('.m-113__dealerBox-dealerLinkList').toggle(300);

                var $dealerLinkList = $target.find('.m-113__dealerBox-dealerLinkList');
                var $dealerName = $target.find('.m-113__dealerBox-dealerName');

                if($dealerLinkList.css('display') === 'block') {
                    $dealerLinkList.slideToggle(150);
                    $dealerName.removeClass('dealerLinkList-visible');
                }
                else {
                    $dealerLinkList.slideToggle(150);
                    $dealerName.addClass('dealerLinkList-visible');
                }


            }.bind(this));

            this.$dealersList.on('afterChange', this.afterSlickSliderChanged.bind(this));
            this.$dealersList.on('init', this.afterSlickSliderInit.bind(this));

            this.$dealerSearchInput.on('focus', this.showFormContainer.bind(this));
            this.$dealerSearchInput.on('blur', this.hideFormContainer.bind(this));
        },

        //
        //----------------------------------------------------------------------
        // FORM
        //----------------------------------------------------------------------

        onDealerSearchBtnClick: function(e) {
            e.preventDefault();
            var $target = $(e.currentTarget);
            $target.closest('form').submit();
        },

        onGetCurrentLocationBtnClick: function() {
            this.map.searchCurrentLocation();
        },

        checkUrlSearchValue: function() {
            var urlSearchValue = this.getURLParameter('m-01-dealer-search-field');

            if(urlSearchValue != '' && urlSearchValue != null) {
                this.urlSearchValue = urlSearchValue;
                return true;
            }

            return false;
        },

        searchUrlSearchValue: function() {
            if(this.urlSearchValue) {
                this.$dealerSearchInput.val(this.urlSearchValue);
                this.$dealerSearchForm.submit();
            }
        },


        onSearchValueValidated: function(event, data) {
            if(data.error != false) {
                this.showErrorMessage(data.error);
            }
            else if(this.mapApi == 'google' )
            {
                this.map.geocodeAddress({
                    address : data.searchValue ,
                    region: this.model.get('UI_MAP_DEFAULT_REGION')
                }).then(function(data) {
                    var location = data.location;
                    var address = data.searchValue;
                    var position = location ? location.lat + '%7C' + location.lng : '';
                    var state = encodeURIComponent(this.model.get('UI_GHS_SEARCH_IN_STATE'));
                    var url = this.dealerWebSrvcUrl['proximity'];

                    url = url.replace(/\[\[###POSITION###\]\]/g , position);
                    url = url.replace(/\[\[###ADDRESS###\]\]/g, address);
                    url = url.replace(/\[\[###STATE###\]\]/g, state);

                    if(DEV_MODE && DEV_OPTIONS.useLocalXML) {
                        var protocol = window.location.protocol;
                        var host = window.location.hostname;
                        var filename = DEV_OPTIONS.useThisLocalXML !== false ? DEV_OPTIONS.useThisLocalXML : this.$dealerSearchInput.val();
                        url = protocol + '//' + host + '/tests/xml/' + filename + '.xml';
                    }

                    this.getDealers(url);

                }.bind(this));
            }
            else if (GLOBAL_CONFIG.pool == "china")
            {
                this.map.geocodeAddress({
                    searchValue : data.searchValue
                }).then(function(data){
                    var location = data.location;
                    var address = data.searchValue;
                    var position = location ? location.lat + '%7C' + location.lng : '';
                    var state = encodeURIComponent(this.model.get('UI_GHS_SEARCH_IN_STATE'));
                    var url = this.dealerWebSrvcUrl['proximity'];

                    url = url.replace(/\[\[###POSITION###\]\]/g , position);
                    url = url.replace(/\[\[###ADDRESS###\]\]/g, address);
                    url = url.replace(/\[\[###STATE###\]\]/g, state);

                    if(location) {
                        this.map.setCenterAndZoom(location.lat, location.lng);
                    }
                    this.getDealers(url);

                }.bind(this));
            }
        },

        onDealerSearchFormSubmit: function(e) {
            e.preventDefault();
            // this.$errorMsg.hide();
            // this.$blockerOverlay.show();
            // this.$loading.show();
            // this.$dealerStateSelect.val('').select2('val', '', true);

            var _this = this;
            var error = false;
            var searchValue = this.$dealerSearchInput.val();
            var urlGetDealerNameViaPostcode =  this.getProtocol(true) + "//" + this.getHost() + "/all/Dealer2/GetLocationsWebService.asmx/GetDealerNameViaPostcode?" ;
            var urlGetChinaCity = this.getProtocol(true) + "//" + this.getHost() + "/all/Dealer2/GetLocationsWebService.asmx/GetChinaCity?" ;
            var urlGetGeonames = "http://ba-ws.geonames.net/searchJSON?userName=udg2015&lang=en&featureClass=P&style=full&name_startsWith=" + searchValue;
            var zipPattern = {
                france: /(\b[0-9]{4,5}\b)|(\b[A-Z]{2,2}[0-9]{3,3}\b)|(\b[0-9]{3,3}[A-Z]{2,2}\b)/,
                france2: /[^A-Z]/,
                australia: /\d{4}/,
                usa: /^\d{1,4}$/
            };

            if(searchValue == '' || searchValue.length == 0)
            {
                error = "empty search value";
                this.$dealerSearchForm.trigger(EVENT.searchValueValidated, {searchValue:searchValue, error:error});
                return;
            }

            if (GLOBAL_CONFIG.pool == "france")
            {
                if( zipPattern.france.test(searchValue.toUpperCase()) || zipPattern.france2.test(searchValue) )
                {
                    urlGetDealerNameViaPostcode += "postcode=" + searchValue + "&siteId=" + "france";
                    $.get(urlGetDealerNameViaPostcode, function (resp) {
                        searchValue += (" " + resp.dealerName);
                        this.$dealerSearchForm.trigger(EVENT.searchValueValidated, {searchValue:searchValue, error:false});
                    }.bind(this));
                } else {
                    error = "ZIP pattern for FRANCE failed";
                    this.$dealerSearchForm.trigger(EVENT.searchValueValidated, {searchValue:searchValue, error:error});
                }

                return;
            }

            if (GLOBAL_CONFIG.pool == "australia")
            {
                if(zipPattern.australia.test(searchValue))
                {
                    urlGetDealerNameViaPostcode += "postcode=" + searchValue + "&siteId=" + "australia";
                    $.get(urlGetDealerNameViaPostcode, function (resp) {
                        searchValue += (" " + resp.dealerName);
                        this.$dealerSearchForm.trigger(EVENT.searchValueValidated, {searchValue:searchValue, error:false});
                    }.bind(this));
                } else {
                    error = "ZIP pattern for australia failed";
                    this.$dealerSearchForm.trigger(EVENT.searchValueValidated, {searchValue:searchValue, error:error});
                }

                return;
            }

            if (GLOBAL_CONFIG.pool == "china")
            {
                urlGetChinaCity += "city=" + searchValue + "&siteId=" + "china";
                if(DEV_MODE && DEV_OPTIONS.useLocalXML) {
                    urlGetChinaCity = 'GetChinaCity/' + this.$dealerSearchInput.val().toLowerCase() + '.xml';
                }

                if (GLOBAL_CONFIG.language == 'en' || (GLOBAL_CONFIG.language == 'zh' && /([a-zA-Z])\w+/.test(searchValue)))
                {
                    $.get(urlGetChinaCity, function (resp)
                    {
                        if ($(resp)[0].documentElement.textContent == "")
                        {
                            $.ajax({
                                dataType: 'jsonp',
                                contentType: "application/json;charset=utf-8",
                                type: 'GET',
                                url: urlGetGeonames,
                                success: function(data) {
                                    if (data.totalResultsCount != 0)
                                    {
                                        var list = data.geonames[0].alternateNames;
                                        _.each(list, function(item) {
                                            if(item.lang == 'ja') {
                                                searchValue = item.name;
                                            }
                                        });
                                        _this.$dealerSearchForm.trigger(EVENT.searchValueValidated, {searchValue:searchValue, error:false});
                                    }
                                    else
                                    {
                                        _this.showErrorMessage();
                                    }
                                }
                            });
                        }
                        else
                        {
                            searchValue = $(resp)[0].documentElement.textContent;
                            _this.$dealerSearchForm.trigger(EVENT.searchValueValidated, {searchValue:searchValue, error:false});
                        }
                    });
                }
                else
                {
                    _this.$dealerSearchForm.trigger(EVENT.searchValueValidated, {searchValue:searchValue, error:false});
                }
                return;
            }

            if (GLOBAL_CONFIG.pool == "usa")
            {
                if( zipPattern.usa.test(searchValue))
                {
                    searchValue = searchValue.length >= 5 ? searchValue : new Array(5 - searchValue.length + 1).join('0') + searchValue;
                }
            }

            if ( this.model.get('UI_GHS_SEARCHVALUE_EXTENSION') != "")
            {
                searchValue = searchValue + ", " + this.model.get('UI_GHS_SEARCHVALUE_EXTENSION');
            }

            this.$dealerSearchForm.trigger(EVENT.searchValueValidated, {searchValue:searchValue, error:false});
        },

        scrollPageToShowResults: function() {
            if($(window).width() < 500) {
                $('html, body').animate({
                    scrollTop: $("#finddealer .m-113__main-container").offset().top + 5
                }, 1000);
            }
        },

        //----------------------------------------------------------------------
        // DEALERS
        //----------------------------------------------------------------------

        getDealers: function (url) {
            $.ajax({
                url: url,
                type: 'GET',
                success: onSuccess.bind(this) ,
                error: onError.bind(this)
            });

            function onSuccess(resp, status) {
                this.processResult(resp);

                if(this.arrDealers.length)
                {
                    if (GLOBAL_CONFIG.pool == "usa") {
                        this.getDealerLatLng().then(function(){
                            this.showDealers();
                            this.hideErrorMessage();
                        }.bind(this));
                    }
                    else {
                        this.showDealers();
                        this.hideErrorMessage();
                    }
                }
                else {
                    this.showDealers();
                    this.showErrorMessage('Zero dealers found');
                }
            }

            function onError(resp) {
                this.arrDealers = [];
                this.showDealers();
                this.showErrorMessage('Ajax call failed: ' + resp.responseText);
            }
        },

        showDealers: function() {
            this.$mapContainer.removeClass('m-113--expand-map');
            if(this.arrDealers.length) {
                this.$mapContainer.addClass('m-113--expand-map');
                this.map.triggerResize();
            }
            this.map.addMarkers();
            this.addDealers();
            this.scrollPageToShowResults();
        },


        addDealers: function() {
            this.$dealersList.html('');
            this.$resultContainer.hide();
            this.removeSlickSlides();

            if(this.arrDealers.length)
            {
                _.each(this.arrDealers, function(dealer) {
                    var view = new DealerBoxView({
                        model: dealer,
                        // $view: $('#dealerBoxView')
                        $view: $dealerBoxViewTemplate
                    }).render();

                    this.$dealersList.append(view.$el.html());

                }, this);

                this.$resultContainer.show();
                this.setSlickSlider();
                this.hideFormContainer();
            }
        },

        //----------------------------------------------------------------------
        // PROCESS RESULT
        //----------------------------------------------------------------------

        processResult: function(resp) {
            var result = this.getDealerDataFromXML(resp);
            var finalResult = [];

            _.each(result, function(dealer, idx)
            {
                var final = {};
                final.dealerNo = idx + 1;
                final.phoneLegend = this.model.get('UI_STRINGCONST_DEALERINFOTEL');
                final.faxLegend = this.model.get('UI_STRINGCONST_DEALERINFOFAX');
                final.emailLegend = this.model.get('UI_STRINGCONST_DEALERINFOEMAIL');
                final.routeLegend = this.model.get('UI_STRINGCONST_DEALERINFOROUTE');
                final.websiteLegend = this.model.get('UI_STRINGCONST_DEALERINFOWEBSITE');
                final.inventoryLegend = this.model.get('UI_STRINGCONST_ENTIRE_INVENTORY');

                if (GLOBAL_CONFIG.pool == "usa")
                {
                    final.Coordinates = undefined;
                    final.name = dealer.name;
                    final.typeCode = '';
                    final.typeLegend = '';
                    final.phone = dealer.address[0].phone;
                    final.address = {
                        street: dealer.address[0].street,
                        postCode: dealer.address[0].postalCode,
                        city: dealer.address[0].city,
                        region: dealer.address[0].region
                    };
                    final.websiteUrl = dealer.url;
                    final.inventoryUrl = dealer.url + '/new/Porsche/search.php';
                    final.routeUrl = this.getDealerRouteUrl(dealer);
                    final.infoWindowThumb = this.getDealerInfoWindowThumb(dealer);
                }
                else
                {
                    final.Coordinates = {
                        lat:  dealer.Coordinates.Lat,
                        lng:  dealer.Coordinates.Lng
                    };
                    final.name = dealer.Name;
                    final.typeCode = dealer.TypeCode;
                    final.typeLegend = this.getDealerTypeLegend(dealer);
                    final.phone = dealer.AddressData.Phone;
                    final.fax = dealer.AddressData.Fax;
                    final.email = dealer.Email1;
                    final.address = {
                        street: dealer.AddressData.Street,
                        postCode: dealer.AddressData.PostCode,
                        city: dealer.AddressData.City
                    };
                    final.websiteUrl = dealer.Url1;
                    final.inventoryUrl = false;
                    final.routeUrl = this.getDealerRouteUrl(dealer);
                    final.infoWindowThumb = this.getDealerInfoWindowThumb(dealer);
                }

                finalResult.push(final);

            }.bind(this));

            this.arrDealers =  finalResult;
        },

        getDealerDataFromXML: function(xml) {
            var data = $.xml2json(xml);
            var result = [] ;

            if(data.dealer !== undefined) {
                result = data.dealer;
            }
            else if (data.ListofLocations !== undefined && data.ListofLocations.Location !== undefined) {
                result = data.ListofLocations.Location;
            }

            if(result == undefined) {
                result = [];
            }
            else if(result.constructor != Array) {
                result = [result];
            }

            return result;
        },

        getDealerRouteUrl: function(dealer) {
            var url = '';

            if(GLOBAL_CONFIG.pool == 'usa') {
                url +=  "https://www.google.de/maps/place/";
                url += dealer.address[0].street + ",";
                url += dealer.address[0].postalCode + ",";
                url += dealer.address[0].city;
            }
            else {
                url +=  "https://www.google.de/maps/place/";
                url += dealer.AddressData.Street + ",";
                url += dealer.AddressData.PostCode + " ";
                url += dealer.AddressData.City;
            }
            return url;
        },

        getDealerTypeLegend: function(dealer) {
            var TypeCode = dealer.TypeCode;
            var legend = '';

            switch(TypeCode) {
                case 'exclusiveflagship':
                    legend = this.model.get('UI_STRINGCONST_TYPE_CODE_LEGEND')['exclusiveflagship'];
                    break;
                case 'classicpartner':
                    legend = this.model.get('UI_STRINGCONST_TYPE_CODE_LEGEND')['classicpartner'];
                    break;
            }

            return legend;
        },

        getDealerInfoWindowThumb: function(dealer) {
            var defaultThumb = this.getProtocol() + '//' + this.getHost() + '/all/dealer2/assets/images/default_wide.jpg';
            var thumb;

            if(GLOBAL_CONFIG.pool == 'usa')
            {
                thumb = dealer.details.dealer_image;

                if(_.isUndefined(thumb) || thumb == '') {
                    thumb = defaultThumb;
                }
            }
            else
            {
                thumb = dealer.InfoWinThumbPath;

                if(_.isUndefined(thumb) || thumb == '') {
                    thumb = defaultThumb;
                }
                else {
                    thumb =  this.getProtocol() + '//' + this.getHost() + thumb;
                }
            }

            return thumb;
        },

        getDealerLatLng: function() {
            var _this = this;
            var dfd = $.Deferred();
            var arrXHR = [];

            _.each(this.arrDealers, function(dealer)
            {
                var xhr;
                var region = _this.model.get('UI_MAP_DEFAULT_REGION');
                var address = (function(address){
                    return address.street + ',' + address.city + ',' + address.region;
                })(dealer.address);

                xhr = _this.map.geocodeAddress({
                    address : address ,
                    region: region
                });

                arrXHR.push(xhr);
            });

            $.when.apply($,arrXHR).done(function()
            {
                _.each(arguments, function(resp, idx){
                    _this.arrDealers[idx].Coordinates = resp.location;
                });
                dfd.resolve();
            });

            return dfd.promise();
        },

        //----------------------------------------------------------------------
        // ERROR MESSAGE
        //----------------------------------------------------------------------

        showErrorMessage: function(msg2, msg2Type ) {
            var msg = this.model.get('UI_STRINGCONST_SEARCHFAIL');
            if(DEV_MODE && msg2) {
                msg += '<br>' + '<i>' + msg2 + '</i>';
            }
            if(msg2Type === 'overwrite') {
              msg = msg2;
            }

            // this.$blockerOverlay.show();
            this.$errorMsg.html(msg).show();
            // this.$loading.hide();
        },

        hideErrorMessage: function() {
            this.$blockerOverlay.hide();
            this.$errorMsg.html('').hide();
            // this.$loading.hide();
        },

        //----------------------------------------------------------------------
        // HELPER FUNCTIONS
        //----------------------------------------------------------------------

        getURLParameter: function(name) {
            var queryString = decodeURI(location.search);
            var result = RegExp(name + '=' + '(.+?)(&|$)').exec(queryString);

            if(result != null) return result[1];
            return result;
        },

        getProtocol: function(ignoreDevMode) {
            if(ignoreDevMode) return document.location.protocol;
            if(DEV_MODE) return DEV_OPTIONS.proxyProtocol;
            return document.location.protocol;
        },

        getHost: function(ignoreDevMode) {
            if(ignoreDevMode) return document.location.hostname;
            if(DEV_MODE) return DEV_OPTIONS.proxyHostname;
            return document.location.hostname;
        },


        //----------------------------------------------------------------------
        // DESTROY
        //----------------------------------------------------------------------

        destroy: function () {
            ModuleBaseView.prototype.destroy.apply(this, arguments);
        },

        //----------------------------------------------------------------------
        //----------------------------------------------------------------------
        //----------------------------------------------------------------------
        //----------------------------------------------------------------------
        //----------------------------------------------------------------------
        //
        // GOOGLE MAPS
        //
        //----------------------------------------------------------------------

        initGoogleMap: function() {
            var _this = this,
                mapCanvas   = getMapCanvas(),
                mapOptions  = getMapOptions(),
                geocoder    = new google.maps.Geocoder(),
                infoWindow  = new google.maps.InfoWindow(),
                map         = new google.maps.Map(mapCanvas, mapOptions),
                mapBounds   = undefined,
                markers     = [],

                mapOffset = { x: 200, y: 220 },
                TILE_SIZE = { height: 256, width: 256 },
                BUFFER = 20,

                iconMarkerRed,
                iconMarkerGrey,
                iconPathRed     = _this.getProtocol(true) + '//' + _this.getHost(true) + "/images/icon_pin-sprite-type_code-red.png",
                iconPathGrey    = _this.getProtocol(true) + '//' + _this.getHost(true) + "/images/icon_pin-sprite-type_code-grey.png",
                iconSize        = new google.maps.Size(26, 40),
                xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx;

            google.maps.event.addListenerOnce(map, 'idle', onMapReady);
            // google.maps.event.addDomListener(window, 'resize', onWindowResize);

            // EVENT HANDLERS
            //------------------------------------------------------

            function onMapReady () {
                if( _this.checkUrlSearchValue()) {
                    _this.searchUrlSearchValue();
                }
            }

            // function onWindowResize() {
            //     console.info('resize');
            //     if(!_.isUndefined(mapBounds)) {
            //         map.fitBounds(mapBounds);
            //         triggerResize();
            //         setOffsetBounds(mapBounds);
            //     }
            // }

            // GEOLOCATOR
            //------------------------------------------------------

            function searchCurrentLocation()
            {
                if (navigator.geolocation) {
                  navigator.geolocation.getCurrentPosition(onSuccess,onError);
                }

                function onSuccess (position){
                  var lat = position.coords.latitude;
                  var lng = position.coords.longitude;
                  reverseGeocode(lat,lng).then(function(data){
                    _this.$dealerSearchInput.val(data.address);
                    _this.$dealerSearchForm.submit();
                  });
                }

                function onError(error) {
                  // alert(error.message);
                  _this.showErrorMessage(error.message, 'overwrite');
                }
            }


            // HELPERS
            //------------------------------------------------------

            function getMapCanvas() {
                return _this.$mapCanvas.get(0);
            }

            function getMapOptions() {
                var zoom = _this.model.get('UI_MAP_DEFAULTCOORDS_ZOOMLEVEL');
                var centerLat = _this.model.get('UI_MAP_DEFAULTCOORDS_LAT');
                var centerLng = _this.model.get('UI_MAP_DEFAULTCOORDS_LNG');
                var centerLatLng = new google.maps.LatLng(centerLat, centerLng);
                var mapOptions = {
                    zoom: zoom,
                    center: centerLatLng,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    disableDefaultUI: true,
                    scrollwheel: false,
                    zoomControl: true,
                    draggable: true,
                    zoomControlOptions: {
                        style: google.maps.ZoomControlStyle.DEFAULT,
                        position: google.maps.ControlPosition.TOP_RIGHT
                    }
                };
                if(_this.hasTouch) {
                    // mapOptions.draggable = false;
                    // mapOptions.panControl = false;
                    // mapOptions.disableDoubleClickZoom = true;
                }
                return mapOptions;
            }

            function panTo(dealerNo) {
                var marker = markers[dealerNo - 1];
                var position = marker.getPosition();
                var newposition = _offsetLatLng(position,  mapOffset.x/2, mapOffset.y/2, 14);
                marker.setMap(map);
                if(_this.showSingleMarker() === true) {
                  marker.setIcon(marker.iconMarkerGrey);
                }
                else {
                  marker.setIcon(marker.iconMarkerRed);
                }
                map.setZoom(14);
                map.panTo(newposition);
            }


            function _offsetLatLng(latlng, offsetX, offsetY, currZoomLevel) {
                offsetX = offsetX || 0;
                offsetY = offsetY || 0;
                currZoomLevel = currZoomLevel ||  map.getZoom();
                var scale = Math.pow(2, currZoomLevel);
                var point = map.getProjection().fromLatLngToPoint(latlng);
                var pixelOffset = new google.maps.Point((offsetX/scale), (offsetY/scale));
                var newPoint = new google.maps.Point(
                    point.x - pixelOffset.x,
                    point.y + pixelOffset.y
                );
                var newLatLng = map.getProjection().fromPointToLatLng(newPoint);

                return newLatLng;
            }

            function _getBoundsZoomLevel(bounds, dimensions) {
                function latRadian (lat) {
                    var sin = Math.sin(lat * Math.PI / 180);
                    var radX2 = Math.log((1 + sin) / (1 - sin)) / 2;
                    return Math.max(Math.min(radX2, Math.PI), -Math.PI) / 2;
                };
                function zoom (mapPx, worldPx, fraction) {
                    return Math.floor(Math.log(mapPx / worldPx / fraction) / Math.LN2);
                };

                var ne = bounds.getNorthEast();
                var sw = bounds.getSouthWest();
                var latFraction = (latRadian(ne.lat()) - latRadian(sw.lat())) / Math.PI;
                var lngDiff = ne.lng() - sw.lng();
                var lngFraction = ((lngDiff < 0) ? (lngDiff + 360) : lngDiff) / 360;
                var latZoom = zoom(dimensions.height, TILE_SIZE.height, latFraction);
                var lngZoom = zoom(dimensions.width, TILE_SIZE.width, lngFraction);
                return Math.min(latZoom, lngZoom, 15);
            }

            function setOffsetBounds(bounds) {
                var dimensions = {
                    width: _this.$mapCanvas.width() - mapOffset.x - BUFFER * 2,
                    height: _this.$mapCanvas.height()  - mapOffset.y - BUFFER * 2
                };
                var zoomLevel = _getBoundsZoomLevel(bounds, dimensions);
                var newLatLng = _offsetLatLng(bounds.getSouthWest(), mapOffset.x, mapOffset.y, zoomLevel);

                bounds.extend(newLatLng);
                map.fitBounds(bounds);
            }

            function unhighlightAllMarkers () {
                var showSingleMarker = _this.showSingleMarker();
                var mapBounds = new google.maps.LatLngBounds();
                _.each(markers, function(marker) {
                    marker.setIcon(marker.iconMarkerGrey);
                    mapBounds.extend(marker.position);
                    if(showSingleMarker) {
                        marker.setMap(null);
                    }
                    else {
                        marker.setMap(map);
                    }
                });

                if( ! showSingleMarker ) {
                    // map.fitBounds(mapBounds);
                    setOffsetBounds(mapBounds)
                }
            }

            function highlightMarker(dealerNo) {
                var showSingleMarker = _this.showSingleMarker();
                var marker = markers[dealerNo - 1];
                marker.setIcon(marker.iconMarkerRed);
                marker.setMap(map);

                if(showSingleMarker ) {
                    panTo(dealerNo);
                }
            }

            // MARKERS
            //------------------------------------------------------

            function clearMarkers() {
                _.each(markers, function(marker){
                    marker.setMap(null);
                });
            }

            function deleteMarkers() {
                clearMarkers();
                markers = [];
            }

            function addMarkers() {
                deleteMarkers();

                if(_this.arrDealers.length)
                {
                    mapBounds = new google.maps.LatLngBounds();
                    var position;
                    var showSingleMarker = _this.showSingleMarker();

                    _.each(_this.arrDealers, function(dealer, idx) {
                        position = new google.maps.LatLng(dealer.Coordinates.lat, dealer.Coordinates.lng);
                        mapBounds.extend(position);

                        var iconPoint = new google.maps.Point(0, idx * 40);
                        iconMarkerRed = new google.maps.MarkerImage(iconPathRed, iconSize, iconPoint);
                        iconMarkerGrey = new google.maps.MarkerImage(iconPathGrey, iconSize, iconPoint);

                        var marker = new google.maps.Marker({
                            position: position,
                            map: map,
                            title: dealer.Name,
                            id: dealer.Id,
                            idx: idx,
                            dealerData: dealer,
                            icon: iconMarkerGrey,
                            iconMarkerRed: iconMarkerRed,
                            iconMarkerGrey: iconMarkerGrey,
                            cursor: (_this.hasTouch) ? 'default' : 'pointer'
                        });

                        google.maps.event.addListener(marker, 'click', function() {
                            // openInfoWindow(marker);
                            _this.goToSlickSlide(marker.idx);
                            // panTo(marker.idx + 1);
                        });

                        markers.push(marker);

                        if(showSingleMarker && idx > 0) {
                            marker.setMap(null);
                        }
                    });

                    if(_this.arrDealers.length > 1) {
                        // map.fitBounds(mapBounds);
                        setOffsetBounds(mapBounds)
                    }
                    else {
                        map.setZoom(13);
                        map.setCenter(position);
                    }
                }
            }

            // INFO WINDOW
            //------------------------------------------------------

            function openInfoWindow(marker) {
                var dealer = marker.dealerData;

                var view = new InfoWindowView({
                    model: dealer,
                    $view: $('#infoWindowView')
                }).render();

                var content = view.render().el;

                // OPEN INFOWINDOW
                infoWindow.setContent(content);
                infoWindow.open(map, marker);
            }

            // GEOCODE
            //------------------------------------------------------

            function geocodeAddress(data) {
                var dfd = $.Deferred();
                var location;

                geocoder.geocode({
                    address: data.address,
                    region: data.region
                }, function(resp, status) {
                    if ( ! (status == 'ZERO_RESULTS' || status == 'INVALID_REQUEST') ) {
                        location = {
                            lat: resp[0].geometry.location.lat(),
                            lng: resp[0].geometry.location.lng()
                        };
                    }
                    dfd.resolve({searchValue : data.address, location: location});
                });

                return dfd.promise();
            }

            // REVERSE GEOCODE
            //------------------------------------------------------

            function reverseGeocode(lat,lng) {
                var dfd = $.Deferred();
                var address;
                var found = false;

                geocoder.geocode({
                    location: {lat: lat , lng: lng}
                }, function(resp, status) {
                    if(status == 'OK') {
                        _.each(resp, function(item){
                            if(!found && _.contains(item.types , 'postal_code')) {
                                found = true;
                                address = item.formatted_address;
                            }
                        });
                        if(!found) {
                            address = resp[0].formatted_address;
                        }
                    }
                    dfd.resolve({address: address});
                });
                return dfd.promise();
            }

            function triggerResize() {
                google.maps.event.trigger(map, "resize");
            }


            // PUBLIC METHODS
            //------------------------------------------------------
            return {
                geocodeAddress: geocodeAddress,
                reverseGeocode: reverseGeocode,
                searchCurrentLocation: searchCurrentLocation,
                addMarkers: addMarkers,
                panTo: panTo,
                highlightMarker: highlightMarker,
                unhighlightAllMarkers: unhighlightAllMarkers,
                triggerResize: triggerResize
            }
        },

        //----------------------------------------------------------------------
        //----------------------------------------------------------------------
        //----------------------------------------------------------------------
        //----------------------------------------------------------------------
        //----------------------------------------------------------------------
        //
        // BAIDU MAPS
        //
        //----------------------------------------------------------------------

        initBaiduMap: function() {
            var _this = this,
                canvasId        = 'm-113__map-canvas',
                zoom            = _this.model.get('UI_MAP_DEFAULTCOORDS_ZOOMLEVEL'),
                centerLat       = _this.model.get('UI_MAP_DEFAULTCOORDS_LAT'),
                centerLng       = _this.model.get('UI_MAP_DEFAULTCOORDS_LNG'),
                map             = new BMap.Map(canvasId),
                center          = new BMap.Point(centerLng, centerLat);
            var markers = [];


            zoom = zoom < 5 ? 5 : zoom;
            map.centerAndZoom(center, zoom);
            map.addControl(new BMap.MapTypeControl());
            map.addControl(new BMap.NavigationControl());
            map.addEventListener("tilesloaded", onMapReady);

            // EVEN HANDLERS
            //------------------------------------------------------
            function onMapReady() {

            }

            // HELPERS
            //------------------------------------------------------
            function setCenterAndZoom(centerLat, centerLng, zoom) {
                var center = new BMap.Point(centerLng, centerLat);
                zoom = zoom || 11;

                map.centerAndZoom(center, zoom);
            }
            function panTo(dealerNo) {
                var marker = markers[dealerNo - 1];
                var dealer = _this.arrDealers[dealerNo - 1];
                openInfoWindow(marker, dealer);
            }

            // MARKERS
            //------------------------------------------------------
            function deleteMarkers() {
                map.clearOverlays();
                markers = [];
            }
            function addMarkers() {
                deleteMarkers();

                if(_this.arrDealers.length)
                {
                    _.each(_this.arrDealers, function(dealer, idx) {
                        var point = new BMap.Point(dealer.Coordinates.lng, dealer.Coordinates.lat);

                        // addMarker(point, i, replacePlaceholder(replacementsData, infoboxHTML));

                        var icon = new BMap.Icon("/images/icon_pin-sprite-type_code-centre.png", new BMap.Size(26, 40), {
                            offset: new BMap.Size(10, 25),
                            imageOffset: new BMap.Size(0, 0 - idx * 40)
                        });

                        var marker = new BMap.Marker(point, {
                            icon: icon
                        });

                        markers.push(marker);

                        marker.addEventListener("click", function () {
                            openInfoWindow(marker, dealer);
                        });

                        map.addOverlay(marker);
                    });
                }
            }

            // INFO WINDOW
            //------------------------------------------------------
            function openInfoWindow(marker, dealer) {
                var $viewTemplate;
                var view;
                var content;
                var infoWindow;

                if(GLOBAL_CONFIG.pool == 'usa') {
                    $viewTemplate = $('.m-113__infoWindow-view-usa');
                }
                else {
                    $viewTemplate = $('.m-113__infoWindow-view-global');
                }
                view = new InfoWindowView({ model:dealer, $viewTemplate:$viewTemplate });
                content = view.render().el;

                // OPEN INFOWINDOW
                infoWindow = new BMap.InfoWindow(content);
                marker.openInfoWindow(infoWindow);
            }

            // GEOCODE
            //------------------------------------------------------
            function geocodeAddress(data) {
                var dfd = $.Deferred();
                var location;
                var url = "http://api.map.baidu.com/geocoder/v2/?ak=B74b66c16dece8bc726d25dcf77b6399&output=json&address=" + data.searchValue + "&city=" + data.searchValue;

                $.ajax({
                    dataType: 'jsonp',
                    contentType: "application/json;charset=utf-8",
                    type: 'GET',
                    url: url,
                    success: function(resp) {
                        if (!!data.msg) {
                            location = undefined;
                        }
                        else {
                            location = {
                                lat: resp.result.location.lat,
                                lng: resp.result.location.lng
                            };
                        }
                        dfd.resolve({searchValue : data.searchValue, location: location});
                    }
                });

                return dfd.promise();
            }

            // PUBLIC METHODS
            //------------------------------------------------------
            return {
                geocodeAddress: geocodeAddress,
                addMarkers: addMarkers,
                setCenterAndZoom: setCenterAndZoom,
                panTo: panTo
            }
        }

    });

})(jQuery, this, this.document);
;
(function($, window, document, undefined) {
    'use strict';

    var uiClasses = {
            'moduleContainer': 'm-29-features-v2',
            'tabContainer': 'm-29-tabs',
            'tabNavigationWrapper': 'm-29-tabs-headline-wrapper-large',
            'tabNavigationElement': 'm-29-tab-headline',
            'hideTabNavigation': 'm-29-hide-tab-navigation',
            'tabContent': 'm-29-tab-content',
            'tabActive': 'display',
            'tabScrollContainer': 'm-29-tab-scroll-container',
            'featureItemWrapper': 'm-29-feature-item-wrapper',
            'featureItem': 'm-29-feature-item',
            'activeItem': 'gui-active-item'
        },
        isOldIe = false;

    $(document).ready(function() {

        var TabControllers = [];

        registerEvents();

        // initialize *all* feature modules with their own register tab navigation (not m-40-universal-tabs) on page
        $('.' + uiClasses.moduleContainer).each(function(index, module) {
            TabControllers[index] = new M29TabController(module);
        });

        function registerEvents() {
            $(document).on("TAB-ACTIVATION_m-29-features", prepareTabContent);
        }

        function prepareTabContent(e, activeTabContainer) {

            var $activeTabContainer = $(activeTabContainer);

            var currentTab = $activeTabContainer.attr('id');
            if (typeof currentTab === 'undefined') {
                currentTab = '.m-29-tab-content.b-tabs-content'; //No tabs in features module
            } else {
                currentTab = '#' + currentTab;
            }

            $(currentTab + ' img').each(function() {
                var $img = $(this);

                ///////////////////////////////////////
                // STV: workaround for image scaling
                //      >> copy paste from main.js
                var dataSrc = $img.attr('data-image-src');
                var s = $img.attr('data-size');

                if (s !== '') {
                    var arrImagePath = dataSrc.split('/');
                    var imageIDWithParams = arrImagePath[arrImagePath.length - 2].split(';');

                    if (imageIDWithParams.length === 1) {
                        // id without params
                        imageIDWithParams[0] += ';' + s;
                        arrImagePath[arrImagePath.length - 2] = imageIDWithParams.join(';');
                        dataSrc = arrImagePath.join('/');
                    } else if (imageIDWithParams.length === 2) {
                        // id with size
                        imageIDWithParams[1] = s;
                        arrImagePath[arrImagePath.length - 2] = imageIDWithParams.join(';');
                        dataSrc = arrImagePath.join('/');
                    } else if (imageIDWithParams.length === 3) {
                        // with wallpaper w/h
                        ; // nop
                    }
                }
                //////////////////////////////

                $img.attr('src', dataSrc);
            });


            var containerWidth = 0,
                $containerItemWrapper = $activeTabContainer.find('.' + uiClasses.featureItemWrapper),
                $containerItems = $activeTabContainer.find('.' + uiClasses.featureItem),
                $scrollContainer = $activeTabContainer.find('.' + uiClasses.tabScrollContainer);

            if ($containerItemWrapper.length === 0 || $containerItems.length === 0) {
                return false;
            }

            if ($scrollContainer.length === 0) {
                $containerItems.each(function(index) {
                    var currentWidth = $(this).outerWidth(true);

                    containerWidth += currentWidth;
                });
                containerWidth = Math.ceil(containerWidth);
                $containerItemWrapper.css('width', containerWidth + 'px');
                $containerItemWrapper.wrap('<div class="' + uiClasses.tabScrollContainer + '"></div>');
            }

            initScroller($activeTabContainer);
        }

        //  IScroll Initialisierung
        function initScroller($activeTabContainer) {

            var activeScroller;
            var $tabScrollContainer = $activeTabContainer.find('.' + uiClasses.tabScrollContainer);

            // ie 8 has no iscroll support
            if (isOldIe) {
                return false;
            }

            if (activeScroller instanceof IScroll) {
                activeScroller.destroy();
                activeScroller = undefined;
                // clear all iscroll references as well
                $tabContainer.find('.' + uiClasses.tabScrollContainer).data("iScroll", null);
            }

            activeScroller = new IScroll($tabScrollContainer[0], {
                scrollY: false,
                scrollX: true,
                scrollbars: true,
                interactiveScrollbars: true,
                eventPassthrough: true
            });

            // set active iscroll reference
            $tabScrollContainer.data("iScroll", activeScroller);
        }

    })

    /**
     * Lagacy Function für die Features-Module mit eigener Tab-Navigation.
     * Eigentlich sollten alle Features-Module ihre Register Tabs als m-40 Universal tabs erhalten.
     * Das ist aber nicht stringent durchgezogen und eine weitere Feedbackschleife bei Noxum ist nicht möglich.
     * Daher muss die Möglichkeit gegeben sein, dass auch m-29 Features mit eigenen Registertabs wie im ursprünglichen Template angedacht funktionieren.
     * @author Sascha Kreher
     * @param module
     * @constructor
     */
    function M29TabController(module) {

        var $tabContainer,
            $tabNavigationWrapper,
            $tabNavigationElements,
            $tabContentContainers,
            $tabActiveContainer,
            $tabActiveItem;

        (function init() {

            $tabContainer = $(module).find('.' + uiClasses.tabContainer).eq(0);
            $tabNavigationWrapper = $tabContainer.find('.' + uiClasses.tabNavigationWrapper).eq(0);
            $tabNavigationElements = $tabNavigationWrapper.find('.' + uiClasses.tabNavigationElement);
            $tabContentContainers = $(module).find('.' + uiClasses.tabContent);
            $tabActiveContainer = $tabContentContainers.filter('.' + uiClasses.tabActive).eq(0);
            $tabActiveItem = $tabActiveContainer.find('.' + uiClasses.featureItem + '.' + uiClasses.activeItem).eq(0);

            // return if tab container not defined
            if ($tabContainer.length === 0) {
                return false;
            }

            // check if browser is ie < 9
            if ($('html').hasClass('lt-ie9')) {
                isOldIe = true;
            }

            // Hide tab navigation if length <= 1
            if ($tabNavigationElements.length <= 1) {
                $tabContainer.addClass(uiClasses.hideTabNavigation);
            }

            prepareTabContent($tabActiveContainer);
            registerEvents();

            if ($tabActiveItem.length > 0 && isOldIe === false) {
                // Initially scroll to active tab item
                if (typeof activeScroller != 'undefined')
                    activeScroller.scrollToElement($tabActiveItem[0]);
            }

        }());

        function registerEvents() {
            $tabContainer.on('tabChange', function(event) {
                $tabActiveContainer = $tabContentContainers.filter('.' + uiClasses.tabActive).eq(0);
                prepareTabContent($tabActiveContainer);
            });
        }

        function prepareTabContent($activeTabContainer) {
            $(document).trigger("TAB-ACTIVATION_m-29-features", $activeTabContainer);
        }


    }

})(jQuery, this, this.document);;(function ($, window, document, undefined) {
  'use strict';



  var moduleContainer = 'm-63-module-bg',
    universalTabsTrigger = 'TAB-ACTIVATION_m-63-model-series-features',
    moduleInstances = []
  ;

  $(document).ready(function () {
    registerGlobalEvents();
    _lazyInit();
  });

  function registerGlobalEvents() {
   

    $(document).on(universalTabsTrigger, function (e, activeTabContainer) {
      var modul = M_63({
        el: $(activeTabContainer)
      });

      modul.init();
      moduleInstances.push(modul);

      $(activeTabContainer).on('TAB-CHANGE_m-63-model-series-features', function (e, activeTabContainer) {
        modul.destroy();
        $(activeTabContainer).off('TAB-CHANGE_m-63-model-series-features');
      });
    });
  }

  $(document).on('m63_loaded', function () {
    _lazyInit();
  });

  var ajax_url;
  $( document ).ajaxSuccess(function( event, request, settings ) {
    ajax_url = settings.url;
    if(ajax_url.search("change_slider_model") > 0)
    {
      registerGlobalEvents();
      _lazyInit();
    }
  });

  // ToDo: Reinit
  function _lazyInit() {
    $('.' + moduleContainer).each(function (i, el) {
      var $el = $(el);
      if (window.pageController) {
        $el.one(window.pageController.eventNames.lazyInit, function () {
          moduleInstances[i] = M_63({
            el: $el
          });
          moduleInstances[i].init();

          window.pageController.refresh();
        });
      } else {
        moduleInstances[i] = M_63({
          el: $el
        });
        moduleInstances[i].init();
      }
    });
  }

  function M_63(options) {

    var thiz = options;

    var is_iOS = !!BROWSER && BROWSER.os === 'iOS';

    var cssClass = {
        m39: {
          slideWrapper: 'm-63-slider-wrapper',
          sliderContainer: 'm-63-slider-container',
          sliderLink: 'm-63-slider-link',
          sliderItem: 'm-63-slider-item',
          sliderTitle: 'm-63-slide-title',
          slideDescription: 'm-63-slide-description',
          closeButton: 'm-63-content-area-close',
          tabs: 'm-63-tabs',
          moduleContainer: 'module-container',
          flyoutDropdown: 'm39-flyout-dropdown',
          flyoutLabel: 'm-39-flyout-label',
          selectItems: 'm-63-tabs a',
          panelHeadline: 'm-63-slider-headline',
          panelGroup: 'm-63-panel-group',
          detailView: 'm-63--detail-view',
          servicesFootnotes: 'm-63-services-footnotes',
          videoWrapper: 'm-63-videoWrapper',
          videoHTML: 'm-63-html-video',
          active: 'active',
          activeTab: 'gui-active-tab',
          tabHeadline: 'm-39-tab-headline',
          activeDetailSlide: 'active-detail-slide',
          offCanvasOpen: 'm-63-off-canvas__open'
        },
        pano: {
          panoContainer: 'm-63_pano-container',
          panoActive: 'm-63-slide-description-pano',
          panoPraefix: 'pano_',
          panoViewer: '_viewer',
          panoInnerContainer: 'pano',
          panoOuterContainer: 'm-63-pano-outercontainer',
          panoContainerFullscreen: 'm-63-fullscreen-wrapper',
          fullScreenCloseButton: 'm-63-content-area-close-fullscreen'
        },
        ecoDisclaimer: {
          ecoContainer: 'b-eco__container',
          tooltipContent: 'm-900__tooltip-content',
          tooltipConsumption: 'm-900__tooltip-consumption',
          tooltipEmission: 'm-900__tooltip-emission',
          tooltipEconsumption: 'm-900__tooltip-eConsumption',
          videoEcoDisclaimer: 'm-63__video-eco-wrapper',
          videoEcoDisclaimerInner: 'm-63__video-eco-disclaimer-inner',
          videoProgressBar: 'm-63__video-eco-progress-bar',
          videoProgressBarInner: 'm-63__video-eco-progress-bar-inner',
          skipButton: 'm-63__video-eco-skip',
          ecoControl: 'm-63__eco-control',
          ecoPlay: 'm-63__eco-play-button',
          ecoIsPlaying: 'm-63__eco--is-playing',
          ecoIsPausing: 'm-63__eco--is-pausing',
          ecoTimer: 'm-63__eco-timer'
        }
      }
      , slick = {
        destroy: 'unslick',
        resize: 'setPosition',
        currentSlide: 'slickCurrentSlide'
      }
      , attributes = {
        data: {
          id: 'id',
          target: 'target',
          krpano: 'krpano',
          video: 'video',
          fullslide: 'fullslide',
          index: 'index',
          indexHtml: 'indexhtml',
          plugindir: 'plugindir',
          imageSrc: 'image-src'
        }
      }
      , offCanvas = {
        html: '<div id="m-63-off-canvas" class="m-63--detail-view"><span class="m-63-content-area-close"></span></div>',
        id: '#m-63-off-canvas',
        body: 'body',
        scroll: {
          css: 'overflow',
          auto: 'auto',
          hidden: 'hidden'
        }
      }
      , iframe = {
        links: {
          vimeo: 'https://vimeo.com/{video_id}',
          youtube: 'https://www.youtube.com/watch?v={video_id}'
        },
        markup: {
          iframe: 'iframe',
          vimeo: '<div class="m-63-videoWrapper" style="visibility:visible"><iframe id="player" src="{video}" class="m-63-iframe" frameborder="0" allowfullscreen="allowfullscreen" mozallowfullscreen="mozallowfullscreen" msallowfullscreen="msallowfullscreen" oallowfullscreen="oallowfullscreen" webkitallowfullscreen="webkitallowfullscreen"></iframe></div>',
          video: '<div class="m-63-videoWrapper" style="visibility:visible"><video class="m-63-html-video" controls autoplay width="100%" height="auto"><source src="{video}" type="video/mp4"></video></div>',
        },
        playerOptions: {
          vimeo: '?autoplay=true&amp;color=900&amp;title=0&amp;byline=0&amp;portrait=0',
          youtube: '?autoplay=1&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;enablejsapi=1&amp;version=3&amp;playerapiid=ytplayer'
        }
      }
      , pano = {
        markup: '<div id="pano_{id}" class="pano" style="width:100%;height:100%"><noscript><table style="width:100%;height:100%;"><tr style="vertical-align:middle;"><td><div style="text-align:center;">ERROR:<br/><br/>Javascript not activated<br/><br/></div></td></tr></table></noscript></div>',
        fullscreenWrapper: '<div class="m-63-page-fullscreen-wrapper"><div class="m-63-fullscreen-wrapper m-63-pano-outercontainer"></div></div>',
        closeButton: '<span class="m-63-content-area-close-fullscreen"></span>',
        counter: 0,
        iframe : '<iframe src="{src}" class="m-080__iframe" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="" frameborder="0"></iframe>'
      }
      , eco = {
        ecoRequest: null,
        ecoRemainingTime: null,
        ecoEndTime: null
      }
      , normalSlickSettings = {
        slidesToShow: 1,
        infinite: false,
        dots: true,
        arrows: false,
        prevArrow: '<button type="button" class="slick-prev"></button>',
        nextArrow: '<button type="button" class="slick-next"></button>',
        touchMove: true,
        mobileFirst: true,
        adaptiveHeight: false,
        initialSlide: 0,
        responsive: [
          {
            breakpoint: 1200,
            settings: {
              slidesToShow: 3,
              dots: false,
              arrows: true,
              adaptiveHeight: true
            }
          },
          {
            breakpoint: 992,
            settings: {
              slidesToShow: 2,
              dots: false,
              arrows: true,
              adaptiveHeight: true
            }
          },
          {
            breakpoint: 768,
            settings: {
              slidesToShow: 2
            }
          },
          {
            breakpoint: 480,
            settings: {
              slidesToShow: 1,
              slidesToScroll: 1
            }
          }
        ]
      }
      , detailSlickSettings = {
        slidesToShow: 1,
        infinite: false,
        dots: true,
        arrows: false,
        prevArrow: '<button type="button" class="slick-prev"></button>',
        nextArrow: '<button type="button" class="slick-next"></button>',
        mobileFirst: true,
        touchMove: true,
        adaptiveHeight: true,
        initialSlide: 0,
        responsive: [
          {
            breakpoint: 1200,
            settings: {
              slidesToShow: 1,
              dots: false,
              arrows: true
            }
          },
          {
            breakpoint: 992,
            settings: {
              slidesToShow: 1,
              dots: false,
              arrows: true
            }
          },
          {
            breakpoint: 768,
            settings: {
              slidesToShow: 1
            }
          },
          {
            breakpoint: 480,
            settings: {
              slidesToShow: 1
            }
          }
        ]
      }
    ;

    /*
		local functions
		 */

    function init() {
      registerElements();
      registerEvents();

			wrapItemImage();

      calcTabSize();
      thiz.$allSlider.slick(getNormalSlickSettings());
      writeImgAttributes($(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active));
      calcItemHeight();
      thiz.$allSlider.slick(slick.resize);

      if (matchMediaQuery.getCurrentMediaQuery().pos < 3) {
        closeAllInactiveAccordion();
      }

      thiz.scrollTop = 0;

      deeplinking();
    }

    function destroy() {
      thiz.$allSlider.slick(slick.destroy);
      destroyPano();

      removeVideo();
    }

    function registerElements() {
      thiz.m63imageScaler = new ScaleHandler();

      thiz.$sliderContainer = $(thiz.el).find('.' + cssClass.m39.slideWrapper);

      thiz.$allSlider = $(thiz.el).find('.' + cssClass.m39.sliderContainer);
      thiz.$sliderLink = $(thiz.el).find('.' + cssClass.m39.sliderLink);
      thiz.$closeIcon = $(thiz.el).find('.' + cssClass.m39.closeButton);

      thiz.$flyoutDropdown = $(thiz.el).find('.' + cssClass.m39.flyoutDropdown);

      thiz.$selectItems = $(thiz.el).find('.' + cssClass.m39.selectItems);
      thiz.$panelHeadline = $(thiz.el).find('.' + cssClass.m39.panelHeadline);

      thiz.$tabs = $(thiz.el).find('.' + cssClass.m39.tabs);

      thiz.$contentFullScreen = null;
      thiz.mousePosX = null;
    }

    function registerEvents() {
      thiz.$closeIcon.on('click', function () {
        cancelAnimationFrame(eco.ecoRequest);
        changeSliderToMiniature($(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active).slick('slickCurrentSlide'));
        removeVideoEco();
        removeVideo();
        destroyPano();
        calcItemHeight();
      });

      thiz.$sliderLink.on('click', function (event) {
        // only execute click on normal slide view, not detail
        // otherwise eco disclaimer will be reinit on each click
        if (!$(this).closest('.' + cssClass.m39.sliderContainer).hasClass(cssClass.m39.detailView)) {
          var $sliderItem = $(this).closest('.' + cssClass.m39.sliderItem); //current slide
          if (!$sliderItem.data(attributes.data.krpano)) {
            $sliderItem = changeSliderToDetail(getClickedSlide($(this).parent()), $sliderItem);
          }
          checkIfVideoSlide($sliderItem);
          checkIfPanoSlide($sliderItem);
        }
      });

      thiz.$allSlider.on('setPosition', function (event, slick) {
        if (slick.currentSlide == 0) {
          //remove padding of container to place content of first slide into grid
          slick.$list.css('padding-left', '0px');
        }
      });

      thiz.$allSlider.on('beforeChange', function (event, slick, currentSlide, nextSlide) {
        var $curSlider = slick.$slider;
        if (!$curSlider.hasClass(cssClass.m39.detailView)) {
          return false;
        }

        if (currentSlide !== nextSlide) {
          pauseVimeoVideo();
          pauseYouTubeVideo();
          pauseHtmlVideo();

          removeVideoEco();
          //removeVideo();

          destroyPano();

          checkIfVideoSlide($(slick.$slides).eq(nextSlide));
        }
      });

      // tab event binding
      thiz.$selectItems.on('click', function () {
        // tab list
        if (!$(this).hasClass(cssClass.m39.flyoutLabel)) {
          var target = $(this).data(attributes.data.target);
          changeCompleteSlider(target);
          toggleAccordion(thiz.$sliderContainer.find('.' + cssClass.m39.panelHeadline + '[data-target=\'' + target + '\']'));
          changeActiveTab($(this));
        }
      });

      thiz.$flyoutDropdown.on('click', 'li a', function () {
        // dropdown list
        var target = $(this).data(attributes.data.target);
        changeCompleteSlider(target);
        toggleAccordion(thiz.$sliderContainer.find('.' + cssClass.m39.panelHeadline + '[data-target=\'' + target + '\']'));
        changeActiveFootnotes(target);
        changeActiveTab($(this));
      });

      thiz.$panelHeadline.on('click', function () {
        var dataId = $(this).parent().find('.' + cssClass.m39.panelHeadline).data(attributes.data.target);
        toggleAccordion($(this));
        changeActiveTab(thiz.$tabs.find('.' + cssClass.m39.tabHeadline + '[data-target=\'' + dataId + '\']'));
      });

      windowHandler.addResizeFunction(function () {
        thiz.$allSlider.removeAttr('style');
        calcTabSize();
        if (matchMediaQuery.getCurrentMediaQuery().pos < 3) {
          closeAllInactiveAccordion();
        } else {
          removeOffCanvas();

          //update Slider
          var target;
          if (thiz.$tabs.find('li a.' + cssClass.m39.activeTab).length == 0) {
            //default use the first tab
            target = $(thiz.$tabs.find('.' + cssClass.m39.tabHeadline)[0]).data(attributes.data.target);
          } else {
            //use the latest active tab
            target = $(thiz.$tabs.find('li a.' + cssClass.m39.activeTab)[0]).data(attributes.data.target);
          }
          changeCompleteSlider(target);
        }

        //resize items of slider
        calcItemHeight();
      });
    }

    function wrapItemImage() {
      thiz.$sliderLink.each(function() {
        var $img = $(this).find('> img');
        $img.wrap("<div class='m-63-slide-image'></div>");
      });
    }

    // ---------------------
    // Slider functions
    // ---------------------

    function getNormalSlickSettings(index) {

      if (index === undefined) {
        index = 0;
      }

      var slickSettings = normalSlickSettings;
      slickSettings.initialSlide = index;
      return slickSettings;
    }

    function changeActiveTab($tab) {
      thiz.$selectItems.removeClass(cssClass.m39.activeTab);
      thiz.$flyoutDropdown.find('li a').removeClass(cssClass.m39.activeTab);
      thiz.$tabs.find('li a').removeClass(cssClass.m39.activeTab);
      $tab.addClass(cssClass.m39.activeTab);

      calcItemHeight();
    }

    function calcTabSize() {
      var tabWidth = 0
        , tabOuterWidth = thiz.$tabs.outerWidth()
        , flyOutWidth = thiz.$flyoutDropdown.outerWidth()
        , windowWidth = screen.width;
      thiz.$tabs.find('.' + cssClass.m39.flyoutDropdown + ' ul').empty();
      $(thiz.el).find('ul.m-63-tabs>li:not(:last-child)').each(function () {
        tabWidth += $(this).outerWidth();

        //tab not in viewport
        // if (tabWidth > (tabOuterWidth - flyOutWidth - 250)) {
        // 	thiz.$tabs.find('.' + cssClass.m39.flyoutDropdown + ' ul').append($(this).clone().wrap('<div/>').attr('style', '').find('a').attr('class', '').parent().parent().html());
        // 	$(this).hide();
        // } else {
        // 	$(this).show();
        // }

        // if (thiz.$tabs.find('.' + cssClass.m39.flyoutDropdown + ' ul li').length == 0)
        // 	thiz.$tabs.find('.' + cssClass.m39.flyoutDropdown).hide();
        // else
        // 	thiz.$tabs.find('.' + cssClass.m39.flyoutDropdown).show();
      });

      if (tabWidth >= windowWidth - (windowWidth * 0.25)) {
        thiz.$tabs.parent().addClass('scrollContainer');
        thiz.$tabs.addClass('scrollable');
      } else {
        thiz.$tabs.parent().removeClass('scrollContainer');
        thiz.$tabs.removeClass('scrollable');
      }

      if(thiz.$tabs.find('.' + cssClass.m39.tabHeadline).length > 1){
        //Do not show the dropdown
        thiz.$tabs.find('.' + cssClass.m39.flyoutDropdown).hide();
      }else{
        thiz.$flyoutDropdown.parent().remove();
		}


    }

    function calcItemHeight() {
      if (thiz.$tabs.length > 0) {
        $('ul.' + cssClass.m39.tabs + ' .' + cssClass.m39.activeTab).each(function () {
          $(this).each(function () {
            var target = $(this).data(attributes.data.target);
            if (target != undefined && target != null) {
              $(thiz.el).find('div[data-id="' + target + '"] .' + cssClass.m39.sliderItem + ' .' + cssClass.m39.sliderLink).removeAttr('style');
              var slider_height = 0;
              $(thiz.el).find('div[data-id="' + target + '"].' + cssClass.m39.sliderContainer + ' .' + cssClass.m39.sliderItem).each(function () {
                var heigth = $(this).height();
                if (heigth != 0 && heigth > slider_height) {
                  slider_height = heigth;
                }
              });
              if (slider_height > 0) {
                $(thiz.el).find('div[data-id="' + target + '"] .' + cssClass.m39.sliderItem + ' .' + cssClass.m39.sliderLink).css('min-height', slider_height + 'px');
              }
            }
          });
        });
      } else {
        //keine Tabs oder Tabs von m40
        thiz.$allSlider.find('.' + cssClass.m39.sliderItem + ' .' + cssClass.m39.sliderLink).removeAttr('style');

        var slider_height = 0;
        thiz.$allSlider.find('.' + cssClass.m39.sliderItem).each(function () {
          var height = $(this).height();
          if (height != 0 && height > slider_height) {
            slider_height = height;
          }
        });

        if (slider_height > 0) {
          thiz.$allSlider.find('.' + cssClass.m39.sliderItem + ' .' + cssClass.m39.sliderLink).css('min-height', slider_height + 'px');
        }
      }
    }

    function toggleAccordion($cur) {
      var $currentSlider = $cur.parent().find('.' + cssClass.m39.sliderContainer),
        targetID = $currentSlider.data(attributes.data.id),
        hasActive = $currentSlider.hasClass(cssClass.m39.active)
      ;

      pauseVimeoVideo();
      pauseYouTubeVideo();
      pauseHtmlVideo();

      // at bigger screens do nothing just update panel heading
      if (matchMediaQuery.getCurrentMediaQuery().pos >= 3) {
        thiz.$panelHeadline.removeClass(cssClass.m39.active);
        $currentSlider.parent().find('.' + cssClass.m39.panelHeadline).addClass(cssClass.m39.active);
        return false;
      }

      // clicked open tab
      if (hasActive) {
        //close the open tab
        TweenMax.to($currentSlider, 0.4, {
          height: 0,
          onStart: function () {
            $currentSlider.parent().find('.' + cssClass.m39.panelHeadline).removeClass(cssClass.m39.active);
            $currentSlider.removeClass(cssClass.m39.active);
          },
          onComplete: function () {
            thiz.$closeIcon.click();
          }
        });
      } else {
        // close all active tabs except the clicked one
        // TweenMax.to($(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active).not($currentSlider), 0.4, {
        // 	height: 0,
        // 	onComplete: function () {
        // 		$(thiz.el).find('.' + cssClass.m39.sliderContainer).not($currentSlider).removeClass(cssClass.m39.active);
        // 	}
        // });

        // open the active tab
        TweenMax.set($currentSlider, {
          height: 'auto'
        });

        TweenMax.from($currentSlider, 0.4, {
          height: 0,
          onStart: function () {
            writeImgAttributes($('div[data-id=\'' + targetID + '\']'));
            $currentSlider.parent().find('.' + cssClass.m39.panelHeadline).addClass(cssClass.m39.active);
          },
          onComplete: function () {
            $currentSlider.addClass(cssClass.m39.active);
          }
        });

        TweenMax.to(window, 0.8, {
          scrollTo: {y: $currentSlider.parent()[0], offsetY: 70},
          ease: Power2.easeOut
        }, '-=0.8');
      }
    }

    function closeAllInactiveAccordion() {
      thiz.$allSlider.not('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active).each(function () {
        var $sliderContainer = $(this);
        TweenMax.to($(this), 0, {
          height: 0,
          onComplete: function () {
            $sliderContainer.parent().find('.' + cssClass.m39.panelHeadline).removeClass(cssClass.m39.active);
          }
        });
      });
    }

    function closeAllAccordion() {
      thiz.$allSlider.each(function () {
        TweenMax.to($(this), 0, {
          height: 0,
          onComplete: function () {
            $(thiz.el).find('.' + cssClass.m39.sliderContainer).removeClass(cssClass.m39.active);
            thiz.$panelHeadline.removeClass(cssClass.m39.active);
            thiz.$closeIcon.click();
          }
        });
      });
    }

    function changeCompleteSlider(target) {
      if (target != null || target != undefined) {
        var $curSlider = $(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active)
          , $newSlider = $(thiz.el).find('div[data-id=\'' + target + '\']');

        pauseVimeoVideo();
        pauseYouTubeVideo();
        pauseHtmlVideo();
        $curSlider.removeClass(cssClass.m39.active);
        $newSlider.addClass(cssClass.m39.active);
        $newSlider.slick(slick.resize);
        writeImgAttributes($newSlider);
      }
    }

    function changeSliderToMiniature(index) {
      var $curSlider = $(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active);
      if ($curSlider.hasClass(cssClass.m39.detailView)) {
        // miniature view
        $curSlider.removeClass(cssClass.m39.detailView);
        $curSlider.parent().find('.' + cssClass.m39.closeButton).removeClass(cssClass.m39.detailView);
        $curSlider.slick(slick.destroy);
        $curSlider.slick(getNormalSlickSettings(index)).slick(slick.resize);
      }
    }

    function changeSliderToDetail(index, $curSlide) {
      var $curSlider = $(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active);
      if (!$curSlider.hasClass(cssClass.m39.detailView)) {
        var detailSlickSettings = getDetailSlickSettings(index);

        //no slick slider for details at smallest viewport
        if ($(window).width() > parseInt(detailSlickSettings.responsive[detailSlickSettings.responsive.length - 2].breakpoint)) {

          // detail view
          $curSlider.addClass(cssClass.m39.detailView);
          $curSlider.slick(slick.destroy);
          $curSlider.parent().find('.' + cssClass.m39.closeButton).addClass(cssClass.m39.detailView);

          $curSlider.slick(detailSlickSettings).slick(slick.resize);
          thiz.scrollTop = 0;
        } else {
          $curSlide = addOffCanvas($curSlider, $curSlide.closest('.' + cssClass.m39.panelGroup), $curSlide);
        }
      }
      return $curSlide;
    }

    function addOffCanvas($curSlider, $canvasContainer, $curSlide) {
      //add off-canvas to content
      $canvasContainer.prepend(offCanvas.html);
      $curSlide.clone().appendTo(offCanvas.id);

      //store scroll
      thiz.scrollTop = $(document).scrollTop();
      $(offCanvas.body).css(offCanvas.scroll.css, offCanvas.scroll.hidden);

      //new curent Slide
      $curSlide = $canvasContainer.find(offCanvas.id).find('.' + cssClass.m39.sliderItem);
      //placing Header at off-canvas
      $curSlide.prepend($curSlide.find('.' + cssClass.m39.sliderTitle));
      $curSlide.find('.' + cssClass.m39.sliderLink).removeAttr('style');

      //fade off-Canvas in
      $curSlide.closest(offCanvas.id).addClass(cssClass.m39.offCanvasOpen);

      //add back functionality
      var $backButton = $curSlide.parent().find('.' + cssClass.m39.closeButton);
      $backButton.on('click', function () {
        removeOffCanvas();
      });

      //add eco-tooltip
      //$curSlide.find('.' + cssClass.ecoDisclaimer.ecoContainer).tooltipster();
      $(document).trigger('fuel-economy.reinit');

      // return nur current Slide for video at detail view
      return $curSlide;
    }

    function removeOffCanvas() {
      if ($(offCanvas.body).find(offCanvas.id).length > 0) {

        //fade off-canvas out
        $(offCanvas.id).removeClass(cssClass.m39.offCanvasOpen);

        //wait until off canvas is flyed out
        setTimeout(function () {
          $(offCanvas.id).remove();
          enableDocumentScroll();

        }, 290);
      }
    }

    function enableDocumentScroll() {
      $(offCanvas.body).css(offCanvas.scroll.css, offCanvas.scroll.auto);
      if (thiz.scrollTop != 0) {
        //scroll to stored value
        $(offCanvas.body).scrollTop(thiz.scrollTop);
        thiz.scrollTop = 0;
      }
    }

    // ---------------------
    // Slide functions
    // ---------------------

    function getDetailSlickSettings(index) {

      if (index === undefined) {
        index = 0;
      }

      var slickSettings = detailSlickSettings;
      slickSettings.initialSlide = index;
      return slickSettings;
    }

    function getNumberOfSlides() {
      // sets the number of slides to show, when return back to miniature view depending on viewport
      var currentViewport = matchMediaQuery.getCurrentMediaQuery().pos
        , numOfSlides = 1;

      switch (currentViewport) {
        case 0:
          numOfSlides = 1;
          break;
        case 1:
          numOfSlides = 1;
          break;
        case 2:
          numOfSlides = 2;
          break;
        case 3:
          numOfSlides = 2;
          break;
        case 4:
          numOfSlides = 3;
          break;
        default:
          numOfSlides = 1;
      }

      return numOfSlides;
    }

    function writeImgAttributes($slider) {
      var scaleParam;
      $slider.find('img[data-image-src]').each(function () {
        var $el = $(this);
        scaleParam = thiz.m63imageScaler.getScaleParameter($el);
        thiz.m63imageScaler.replaceSource($el, $el.data(attributes.data.imageSrc), scaleParam);
      });
    }

    function changeActiveFootnotes(target) {
      var $curFootnotes = $(thiz.el).find('.' + cssClass.m39.servicesFootnotes + '.' + cssClass.m39.active)
        , $newFootnotes = $(thiz.el).find('div[data-footnote-id=\'' + target + '\']');

      $curFootnotes.removeClass(cssClass.m39.active);
      $newFootnotes.addClass(cssClass.m39.active);
    }

    function getClickedSlide($slide) {
      return $slide.index();
    }

    // ---------------------
    // Video functions
    // ---------------------

    function pauseHtmlVideo() {
      $(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active).find('.' + cssClass.m39.videoHTML).each(function () {
        $(this).get(0).pause();
      });
    }

    function pauseVimeoVideo() {
      var command = {
        'method': 'pause',
        'value': 'true'
      };

      $(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active).find(iframe.markup.iframe).each(function (i) {
        this.contentWindow.postMessage(JSON.stringify(command), '*');
      });
    }

    function pauseYouTubeVideo() {
      $(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active).find(iframe.markup.iframe).each(function () {
        this.contentWindow.postMessage('{"event":"command","func":"' + 'pauseVideo' + '","args":""}', '*');
      });
    }

    function getVideo($curSlide) {
      var $this = $curSlide;

      var _src = $this.data(attributes.data.video);

      if (_src !== undefined && !$this.find('.' + cssClass.m39.videoWrapper)[0]) {
        var $parent = $this.find('.' + cssClass.m39.sliderLink);

        if ((_src.indexOf('vimeo') !== -1 || _src.indexOf('youtube') !== -1 || _src.indexOf('youku') !== -1)) {
          if (isMobile() && $this.data(attributes.data.fullslide)) {
            //close Detail View
            changeSliderToMiniature($(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active).slick(slick.currentSlide));
            //send link
            var win = window.open(getVideoLink(_src), '_blank');
            win.focus();
          } else {
            if ($this.data(attributes.data.fullslide)) {
              // remove calculated height
              var $curSlider = $(thiz.el).find('.' + cssClass.m39.sliderContainer + '.' + cssClass.m39.active).find('.slick-list');
              $curSlider.css('height', 'auto');
              _src = getVideoURLWithPlayerOptions(_src);
            }
            //ad iframe
            $parent.prepend((iframe.markup.vimeo.replace('{video}', _src)));
          }
        } else {
          $parent.prepend((iframe.markup.video.replace('{video}', _src)));
        }
      }
    }

    function getVideoLink(url) {
      if (url.indexOf('?') !== -1) {
        var idx = url.indexOf('?');
        url = url.substr(0, idx);
      }

      if (url.indexOf('vimeo') !== -1) {
        url = url.replace('https://player.vimeo.com/video/', '');
        url = iframe.links.vimeo.replace('{video_id}', url);
      } else if (url.indexOf('youtube') !== -1) {
        url = url.replace('https://www.youtube.com/embed/', '');
        url = iframe.links.youtube.replace('{video_id}', url);
      } else if (url.indexOf('yoku') !== -1) {
        url = url.replace('http://player.youku.com/embed/', '');
      }
      return url;
    }

    function getVideoURLWithPlayerOptions(url) {
      if (url.indexOf('?') == -1) {
        if (url.indexOf('vimeo') !== -1) {
          url += iframe.playerOptions.vimeo;
        } else if (url.indexOf('youtube') !== -1) {
          url += iframe.playerOptions.youtube;
        }
      }
      return url;
    }

    function isMobile() {
      if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
        return true;
      }
      return false;
    }

    function createVideoEcoMarkup($ecoContainer, $curSlide) {

			
      onVideoEcoSkip($curSlide);	// -> RW: deactivate disclaimer layer for market review
      return false; 							// -> RW: deactivate disclaimer layer for market review
      //////////////////////////////


      var skipText = $curSlide.data('skip-text') ? $curSlide.data('skip-text') : 'Überspringen';
      eco.ecoEndTime = null;

      // inner video eco markup, contains eco data
      var tooltipMarkup =
        '<div class="' + cssClass.ecoDisclaimer.tooltipContent + '">' +
        '<h4>#label#</h4>' +
        '<div class="' + cssClass.ecoDisclaimer.tooltipConsumption + '">' +
        '<span>#consumptionLabel#</span>' +
        '<span>#consumptionValue#</span>' +
        '</div>' +
        '<div class="' + cssClass.ecoDisclaimer.tooltipEmission + '">' +
        '<span>#emissionLabel#</span>' +
        '<span>#emissionValue#</span>' +
        '</div>' +
        '<div class="' + cssClass.ecoDisclaimer.tooltipEconsumption + '">' +
        '<span>#econsumptionLabel#</span>' +
        '<span>#econsumptionValue#</span>' +
        '</div>' +
        '</div>';
      // outer video eco markup, contains button and time
      var $ecoMarkup = $(
        '<div class="' + cssClass.ecoDisclaimer.videoEcoDisclaimer + '">' +
        '<div class="' + cssClass.ecoDisclaimer.videoEcoDisclaimerInner + '"></div>' + // <-- content inside this one
        '<div class="' + cssClass.ecoDisclaimer.ecoControl + '">' +
        '<button class="' + cssClass.ecoDisclaimer.ecoPlay + ' ' + cssClass.ecoDisclaimer.ecoIsPlaying + '"></button>' +
        '<div class="' + cssClass.ecoDisclaimer.ecoTimer + '"></div>' +
        '<button class="' + cssClass.ecoDisclaimer.skipButton + '">' + 'Überspringen' + '</button>' +
        '</div>' +
        '</div>');

      $ecoContainer.each(function () {
        // 1. get the data
        var data = $(this).attr('data-model');
        // jump out if data model does not exist, otherwise it throws error
        if (data === undefined) {
          return false;
        }
        // 2. convert data string to json object
        data = JSON.parse(data);

        var label = data.label ? data.label : ''
          , consumptionLabel = data.consumption ? data.consumption.label : ''
          , consumptionValue = data.consumption ? data.consumption.formatedvalue : ''
          , emissionLabel = data.emission ? data.emission.label : ''
          , emissionValue = data.emission ? data.emission.formatedvalue : ''
          , econsumptionLabel = data.econsumption ? data.econsumption.label : ''
          , econsumptionValue = data.econsumption ? data.econsumption.formatedvalue : ''
        ;

        // 3. add content to tooltip options
        var markup = tooltipMarkup
          .replace('#label#', label)
          .replace('#consumptionLabel#', consumptionLabel)
          .replace('#consumptionValue#', consumptionValue)
          .replace('#emissionLabel#', emissionLabel)
          .replace('#emissionValue#', emissionValue)
          .replace('#econsumptionLabel#', econsumptionLabel)
          .replace('#econsumptionValue#', econsumptionValue)
        ;

        $ecoMarkup.find('.' + cssClass.ecoDisclaimer.videoEcoDisclaimerInner).append(markup);
      });

      // add markup to slide
      $curSlide.find('.' + cssClass.m39.sliderLink).prepend($ecoMarkup);

      //bind events
      // add skip button click
      $('.' + cssClass.ecoDisclaimer.skipButton).on('click', function (e) {
        cancelAnimationFrame(eco.ecoRequest);
        onVideoEcoSkip($curSlide);
        e.stopPropagation();
      });
      // pause and resume eco disclaimer
      $('.' + cssClass.ecoDisclaimer.ecoPlay).on('click', function () {
        var $this = $(this);

        if ($this.hasClass(cssClass.ecoDisclaimer.ecoIsPlaying)) {
          $this.removeClass(cssClass.ecoDisclaimer.ecoIsPlaying)
            .addClass(cssClass.ecoDisclaimer.ecoIsPausing);
          // pause eco
          eco.ecoRemainingTime = eco.ecoEndTime - new Date().getTime();
          cancelAnimationFrame(eco.ecoRequest);
        } else {
          $this.removeClass(cssClass.ecoDisclaimer.ecoIsPausing)
            .addClass(cssClass.ecoDisclaimer.ecoIsPlaying);

          eco.ecoEndTime = new Date().getTime() + eco.ecoRemainingTime;
          startCountdown($curSlide);
        }
      });
    }

    function startCountdown($curSlide) {

      return false; // -> RW: deactivate disclaimer layer for market review

      printEcoTime($curSlide);
    }

    function printEcoTime($curSlide) {
      var $timer = $curSlide.find('.' + cssClass.ecoDisclaimer.ecoTimer);

      // calculate remaining time
      if (eco.ecoEndTime === null) {
        eco.ecoEndTime = new Date().getTime() + (5 * 1000); // default start time: 5 seconds
      }
      eco.ecoRemainingTime = eco.ecoEndTime - new Date().getTime();

      // convert time
      var seconds = pad((eco.ecoRemainingTime / 1000) % 60);
      var timeString = '- 0:' + seconds;

      if (eco.ecoRemainingTime >= 1000) {
        $timer.text(timeString);
        eco.ecoRequest = requestAnimationFrame(function () {
          printEcoTime($curSlide);
        });
      } else {
        $timer.text('- 0:00');
        // time is over
        // remove disclaimer and get video
        removeVideoEco();
        getVideo($curSlide);
      }
    }

    function onVideoEcoSkip($curSlide) {
      $curSlide.find('.' + cssClass.ecoDisclaimer.videoEcoDisclaimer).remove();

      getVideo($curSlide);
    }

    function removeVideoEco() {
      // remove eco markup
      thiz.$allSlider.find('.' + cssClass.ecoDisclaimer.videoEcoDisclaimer).remove();
    }

    function pad(value) {
      return ('0' + Math.floor(value)).slice(-2);
    }

    function removeVideo() {
      // remove video wrapper
      thiz.$allSlider.find('.' + cssClass.m39.videoWrapper).remove();
    }

    function checkIfVideoSlide($curSlide) {
      var videoLink = $curSlide.data(attributes.data.video)
        ,
        $ecoContainer = $curSlide.find('.' + cssClass.m39.slideDescription).find('.' + cssClass.ecoDisclaimer.ecoContainer)
      ;

      // check if video eco disclaimer already exist
      if (($curSlide.find('.' + cssClass.ecoDisclaimer.videoEcoDisclaimer).length > 0) ||
        (videoLink === undefined) || // check if even a video exist
        ($curSlide.find('.' + cssClass.m39.videoWrapper).length > 0)) { // check if video is already appended
        return false;
      }

      // check if there are eco information
      if ($ecoContainer.length == 0) {
        getVideo($curSlide);
        return false;
      }
      // then extract eco information and create markup layer
      createVideoEcoMarkup($ecoContainer, $curSlide);

      // start countdown
      startCountdown($curSlide);
    }

    // ---------------------
    // Krpano functions
    // ---------------------

    function checkIfPanoSlide($curSlide) {
      if ($curSlide.data(attributes.data.krpano)) {
        createPano($curSlide, pano.counter++);
        return true;
      } else {
        return false;
      }
    }

    /**
     * Erzeugen und Einbinden des HTML Viewer für das Pano
     * @param $curSlide
     * @param $containerName
     */
    function createPano($curSlide, $containerName) {
      if (!$('body').hasClass(cssClass.pano.panoContainer)) {

        $('body').addClass(cssClass.pano.panoContainer);
        $('body').prepend(pano.fullscreenWrapper);
        thiz.$contentFullScreen = $('.' + cssClass.pano.panoContainerFullscreen);

        var $panoContainer = pano.markup.replace('{id}', $containerName);
        var panoTarget = cssClass.pano.panoPraefix + $containerName;

        thiz.$contentFullScreen.prepend($panoContainer);

        //is_iOS
        if (false == true) {

          var panoHTML = $curSlide.data(attributes.data.indexHtml);

          // TODO: Embedd iFrame

          $('<iframe>', {
            src: panoHTML,
            frameborder: 0,
            scrolling: 'no',
            allowfullscreen: 'allowfullscreen',
            mozallowfullscreen: 'allowfullscreen',
            webkitallowfullscreen: 'allowfullscreen'
          }).appendTo('#' + panoTarget);

          krpano_onready_callback(false, panoTarget);

        } else {

        var panoViewer = panoTarget + cssClass.pano.panoViewer;
				var pluginPath = $curSlide.data(attributes.data.plugindir) ? $curSlide.data(attributes.data.plugindir) : '';
        var panoXML = $curSlide.data(attributes.data.index);

        embedpano({
          xml: panoXML,
          target: panoTarget,
          id: panoViewer,
          html5: 'only',
          consolelog: false,
          mobilescale: 1.0,
          initvars: {
            pluginPath: pluginPath
          },
          passQueryParameters: true,
          onready: krpano_onready_callback
        });

        }
      }
    }

    function krpano_onready_callback(krpano_interface, $target) {

      var panoViewer_ = $target || $('.pano > div').attr('id'),
          $panoViewer = $('#' + panoViewer_);

      // after start the pano, change to fullscreenmode
      if (!!krpano_interface && krpano_interface.get('device.fullscreensupport')) {
        krpano_interface.set('fullscreen', true);
      } else {
        //Fake the krpano fullscreen when not available at device (e.g. ios devices)
        $('.' + cssClass.pano.panoContainerFullscreen).parent().addClass('fullscreensupport');
      }

      //add class for style reasons
      $panoViewer.addClass('panoViewer');
      //append close Button and functionality
      $panoViewer.prepend(pano.closeButton);
      $panoViewer.find('.' + cssClass.pano.fullScreenCloseButton).click(function () {
        destroyPano();
      });
    }

    function destroyPano() {
      if (thiz.$contentFullScreen) {
        var viewername = thiz.$contentFullScreen.find(cssClass.pano.panoInnerContainer).attr('id') + cssClass.pano.panoViewer;
        removepano(viewername);

        $('body').removeClass(cssClass.pano.panoContainer);
        thiz.$contentFullScreen.parent().remove();
      }
    }

    // ---------------------
    // Deeplinking functions
    // ---------------------

    function get_url_param(name) {
      name = name.replace(/[\[]/, '\\\[').replace(/[\]]/, '\\\]');
      var regexS = '[\\?&]' + name + '=([^&#]*)';
      var regex = new RegExp(regexS);
      var results = regex.exec(window.location.href);
      if (results == null)
        return '';
      else
        return results[1];
    }

		function _gotoContent() {
		    if (typeof getCookie == 'function') {
		        if (getCookie('module_param') != '' && typeof getCookie('module_param') == 'string') {
		            var paraArray = getCookie('module_param').split('~');
		            var modul = '#' + paraArray[0];

		            if (paraArray[0].indexOf('video') > -1) {
		                // Szenario 1 
		                // Ohne Tab
		                // die id der Sektion wird von CM gepflegt.
		                $('#' + paraArray[0] + ' #' + paraArray[1]).click();
		                $.cookie('module_param', null);

		            }
		            if (paraArray[0].indexOf('panoramen') > -1) {
		                // Szenario 2 
		                // Mit Tab
		                // die id der Sektion wird von CM gepflegt.
		                $('#' + paraArray[0] + ' #' + paraArray[1]).click();
		                $.cookie('module_param', null);
		            }

		            // Tab
		            if ($(modul).find('.m-63-slider-headline').css('display') == 'none') {
		                $(modul).find('.m-63-tabs a').eq($(modul).find('.m-63-tabs').find('a[data-target=\'' + paraArray[1] + '\']').parent().index()).click();
		            }
		            if ($(modul).find('.m-63-slider-headline').css('display') == 'block') {
		                if ($('.m-63-slider-headline.active').attr('data-target') != paraArray[1]) {
		                if (!$(modul).find('.m-63-slider-headline[data-target=\'' + paraArray[1] + '\']').hasClass('active')) {
		                    $(modul).find('.m-63-slider-headline[data-target=\'' + paraArray[1] + '\']').click();
		                }
		                if (window.pageYOffset - $(modul).offset().top < -200) {
		                    setTimeout(function () {
		                        $('html').animate({ scrollTop: $(modul).find('.m-63-slider-headline.active').parent().offset().top }, 500);
		                    }, 500);
		                }
		            }
		        }
		            // Slider
		            if (typeof (paraArray[2]) != 'undefined' && typeof parseInt(paraArray[2]) == 'number') {
		                // slideto
		                if ($(modul).find('.m-63-slider-headline').css('display') == 'block') {
		                    $(modul).find('div[data-id=\'' + paraArray[1] + '\']').slick('goTo', parseInt(paraArray[2]));
		                } else {
		                    $(modul).find('.m-63-slider-container.slick-slider.active').slick('goTo', parseInt(paraArray[2]));
		                }
		                // layer
		                if (typeof paraArray[3] == 'string' && paraArray[3] == 'more') {
		                    if ($(modul).find('.m-63-slider-headline').css('display') == 'none') {
		                        $(modul).find('.m-63-slider-item').eq(parseInt(paraArray[2])).find('.m-63-button-more').click();
		                    }
		                    else {
		                    $(modul).find('div[data-id=\'' + paraArray[1] + '\']').find('.m-63-slider-item.slick-slide.slick-current.slick-active .m-63-button-more').click();
		                }
		            }
		            else {
		                $('.m-63-content-area-close:visible').click();
		                $(modul).find('.m-63-content-area-close.m-63--detail-view:visible').click();
                            
		                }
		            }
		            
		         }
		    }
		     
    }

    function deeplinking() {
		    _gotoContent();
		    window.gotocontent = _gotoContent;
    }

    /*
		global functions
		 */

    thiz.init = function () {
      init();
    };
    thiz.destroy = function () {
      destroy();
    };

    return thiz;
  }

})(jQuery, this, this.document);

function destroyPano() {
  if ($('.m-63-page-fullscreen-wrapper')) {
    var viewername = $('.m-63-page-fullscreen-wrapper').find('.pano').attr('id') + '_viewer';
    removepano(viewername);

    $('body').removeClass('m-63_pano-container');
    $('.m-63-page-fullscreen-wrapper').remove();
  }
};
/*[SK]: Die Scripts von m-29-features-v2 wurden dahingehend umgeschrieben, 
        dass die Initialisierung der IScroll Komponente nun nicht mehr auf basis
		der alten Moduleigenen Registertab Elementen passiert, sondern aufgrund von 
		Events die beim Wechel der Tabs in m-40 geworfen werden.
*/
(function ($, window, document, undefined) {
  'use strict';

  $(document).ready(function () {

    var universalTabControllers = [];

    // initialize *all* universal tab modules on page
    $('.m-40-universal-tabs').each(function (index, module) {
      universalTabControllers[index] = new UniversalTabController(module);
    });

  });

  function UniversalTabController(module) {

    var uiClasses = {
        'tabContainer': 'm-40-universal-tabs',
        'tabNavigationWrapper': 'm-40-tabs-headline-wrapper-large',
        'tabNavigationElement': 'm-40-tab-headline',
        'hideTabNavigation': 'm-40-hide-tab-navigation',
        'tabContent': 'm-40-tab-content',
        'tabActive': 'display',
        'activeItem': 'gui-active-item'
      },
      isOldIe = false,
      $tabContainer,
      $tabNavigationWrapper,
      $tabNavigationElements,
      $tabContentContainers,
      $tabActiveContainer,
      $tabActiveItem;

    (function init() {

      $tabContainer = $(module);
      $tabNavigationWrapper = $tabContainer.find('.' + uiClasses.tabNavigationWrapper).eq(0);
      $tabNavigationElements = $tabNavigationWrapper.find('.' + uiClasses.tabNavigationElement);
      $tabContentContainers = $(module).find('.' + uiClasses.tabContent);
      $tabActiveContainer = $tabContentContainers.filter('.' + uiClasses.tabActive).eq(0);
      $tabActiveItem = $tabActiveContainer.find('.' + uiClasses.featureItem + '.' + uiClasses.activeItem).eq(0);

      // return if tab container not defined
      if ($tabContainer.length === 0) {
        return false;
      }

      // check if browser is ie < 9
      if ($('html').hasClass('lt-ie9')) {
        isOldIe = true;
      }

      // Hide tab navigation if length <= 1
      if ($tabNavigationElements.length <= 1) {
        $tabContainer.addClass(uiClasses.hideTabNavigation);
      }

      prepareTabContent($tabActiveContainer);
      registerEvents();

      if ($tabActiveItem.length > 0 && isOldIe === false) {
        // Initially scroll to active tab item
        if (typeof activeScroller != 'undefined')
          activeScroller.scrollToElement($tabActiveItem[0]);

      }


    }());

    function registerEvents() {
      $tabContainer.on('tabChange', function (event) {
        $($tabActiveContainer).trigger('TAB-CHANGE_m-63-model-series-features', $tabActiveContainer);

        $tabActiveContainer = $tabContentContainers.filter('.' + uiClasses.tabActive).eq(0);
        prepareTabContent($tabActiveContainer);
      });

      windowHandler.addResizeFunction(function () {
        var tabWidth = 0,
            windowWidth = screen.width;

        $tabNavigationElements.each(function(){
          tabWidth += $(this).outerWidth();
        });

        if (tabWidth >= windowWidth - (windowWidth * 0.2)) {
          $tabNavigationWrapper.find('ul').addClass('scrollable');
        } else {
          $tabNavigationWrapper.find('ul').removeClass('scrollable');
        }

      });
    }

    function prepareTabContent($activeTabContainer) {
      switch ($activeTabContainer.attr('data-contains')) {
        case 'm-29-features':
          $(document).trigger('TAB-ACTIVATION_m-29-features', $activeTabContainer);
          break;
        case 'm-63-model-series-features':
          $(document).trigger('TAB-ACTIVATION_m-63-model-series-features', $activeTabContainer);
          break;
        default:
          //console.log($activeTabContainer.attr("data-contains") + '.reinit');
          $($($activeTabContainer).children()[0]).trigger($activeTabContainer.attr('data-contains') + '.reinit', $activeTabContainer);
          break;
      }
      $activeTabContainer.resize();
    }
  }
})(jQuery, this, this.document);/*!
* Clamp.js 0.5.1
*
* Copyright 2011-2013, Joseph Schmitt http://joe.sh
* Released under the WTFPL license
* http://sam.zoy.org/wtfpl/
*/

(function(){
    /**
     * Clamps a text node.
     * @param {HTMLElement} element. Element containing the text node to clamp.
     * @param {Object} options. Options to pass to the clamper.
     */
    function clamp(element, options) {
        options = options || {};

        var self = this,
            win = window,
            opt = {
                clamp:              options.clamp || 2,
                useNativeClamp:     typeof(options.useNativeClamp) != 'undefined' ? options.useNativeClamp : true,
                splitOnChars:       options.splitOnChars || ['.', '-', '–', '—', ' '], //Split on sentences (periods), hypens, en-dashes, em-dashes, and words (spaces).
                animate:            options.animate || false,
                truncationChar:     options.truncationChar || '…',
                truncationHTML:     options.truncationHTML
            },

            sty = element.style,
            originalText = element.innerHTML,

            supportsNativeClamp = typeof(element.style.webkitLineClamp) != 'undefined',
            clampValue = opt.clamp,
            isCSSValue = clampValue.indexOf && (clampValue.indexOf('px') > -1 || clampValue.indexOf('em') > -1),
            truncationHTMLContainer;
            
        if (opt.truncationHTML) {
            truncationHTMLContainer = document.createElement('span');
            truncationHTMLContainer.innerHTML = opt.truncationHTML;
        }


// UTILITY FUNCTIONS __________________________________________________________

        /**
         * Return the current style for an element.
         * @param {HTMLElement} elem The element to compute.
         * @param {string} prop The style property.
         * @returns {number}
         */
        function computeStyle(elem, prop) {
            if (!win.getComputedStyle) {
                win.getComputedStyle = function(el, pseudo) {
                    this.el = el;
                    this.getPropertyValue = function(prop) {
                        var re = /(\-([a-z]){1})/g;
                        if (prop == 'float') prop = 'styleFloat';
                        if (re.test(prop)) {
                            prop = prop.replace(re, function () {
                                return arguments[2].toUpperCase();
                            });
                        }
                        return el.currentStyle && el.currentStyle[prop] ? el.currentStyle[prop] : null;
                    }
                    return this;
                }
            }

            return win.getComputedStyle(elem, null).getPropertyValue(prop);
        }

        /**
         * Returns the maximum number of lines of text that should be rendered based
         * on the current height of the element and the line-height of the text.
         */
        function getMaxLines(height) {
            var availHeight = height || element.clientHeight,
                lineHeight = getLineHeight(element);

            return Math.max(Math.floor(availHeight/lineHeight), 0);
        }

        /**
         * Returns the maximum height a given element should have based on the line-
         * height of the text and the given clamp value.
         */
        function getMaxHeight(clmp) {
            var lineHeight = getLineHeight(element);
            return lineHeight * clmp;
        }

        /**
         * Returns the line-height of an element as an integer.
         */
        function getLineHeight(elem) {
            var lh = computeStyle(elem, 'line-height');
            if (lh == 'normal') {
                // Normal line heights vary from browser to browser. The spec recommends
                // a value between 1.0 and 1.2 of the font size. Using 1.1 to split the diff.
                lh = parseInt(computeStyle(elem, 'font-size')) * 1.2;
            }
            return parseInt(lh);
        }


// MEAT AND POTATOES (MMMM, POTATOES...) ______________________________________
        var splitOnChars = opt.splitOnChars.slice(0),
            splitChar = splitOnChars[0],
            chunks,
            lastChunk;
        
        /**
         * Gets an element's last child. That may be another node or a node's contents.
         */
        function getLastChild(elem) {
            //Current element has children, need to go deeper and get last child as a text node
            if (elem.lastChild.children && elem.lastChild.children.length > 0) {
                return getLastChild(Array.prototype.slice.call(elem.children).pop());
            }
            //This is the absolute last child, a text node, but something's wrong with it. Remove it and keep trying
            else if (!elem.lastChild || !elem.lastChild.nodeValue || elem.lastChild.nodeValue == '' || elem.lastChild.nodeValue == opt.truncationChar) {
                elem.lastChild.parentNode.removeChild(elem.lastChild);
                return getLastChild(element);
            }
            //This is the last child we want, return it
            else {
                return elem.lastChild;
            }
        }
        
        /**
         * Removes one character at a time from the text until its width or
         * height is beneath the passed-in max param.
         */
        function truncate(target, maxHeight) {
            if (!maxHeight) {return;}
            
            /**
             * Resets global variables.
             */
            function reset() {
                splitOnChars = opt.splitOnChars.slice(0);
                splitChar = splitOnChars[0];
                chunks = null;
                lastChunk = null;
            }
            
            var nodeValue = target.nodeValue.replace(opt.truncationChar, '');
            
            //Grab the next chunks
            if (!chunks) {
                //If there are more characters to try, grab the next one
                if (splitOnChars.length > 0) {
                    splitChar = splitOnChars.shift();
                }
                //No characters to chunk by. Go character-by-character
                else {
                    splitChar = '';
                }
                
                chunks = nodeValue.split(splitChar);
            }
            
            //If there are chunks left to remove, remove the last one and see if
            // the nodeValue fits.
            if (chunks.length > 1) {
                // console.log('chunks', chunks);
                lastChunk = chunks.pop();
                // console.log('lastChunk', lastChunk);
                applyEllipsis(target, chunks.join(splitChar));
            }
            //No more chunks can be removed using this character
            else {
                chunks = null;
            }
            
            //Insert the custom HTML before the truncation character
            if (truncationHTMLContainer) {
                target.nodeValue = target.nodeValue.replace(opt.truncationChar, '');
                element.innerHTML = target.nodeValue + ' ' + truncationHTMLContainer.innerHTML + opt.truncationChar;
            }

            //Search produced valid chunks
            if (chunks) {
                //It fits
                if (element.clientHeight <= maxHeight) {
                    //There's still more characters to try splitting on, not quite done yet
                    if (splitOnChars.length >= 0 && splitChar != '') {
                        applyEllipsis(target, chunks.join(splitChar) + splitChar + lastChunk);
                        chunks = null;
                    }
                    //Finished!
                    else {
                        return element.innerHTML;
                    }
                }
            }
            //No valid chunks produced
            else {
                //No valid chunks even when splitting by letter, time to move
                //on to the next node
                if (splitChar == '') {
                    applyEllipsis(target, '');
                    target = getLastChild(element);
                    
                    reset();
                }
            }
            
            //If you get here it means still too big, let's keep truncating
            if (opt.animate) {
                setTimeout(function() {
                    truncate(target, maxHeight);
                }, opt.animate === true ? 10 : opt.animate);
            }
            else {
                return truncate(target, maxHeight);
            }
        }
        
        function applyEllipsis(elem, str) {
            elem.nodeValue = str + opt.truncationChar;
        }


// CONSTRUCTOR ________________________________________________________________

        if (clampValue == 'auto') {
            clampValue = getMaxLines();
        }
        else if (isCSSValue) {
            clampValue = getMaxLines(parseInt(clampValue));
        }

        var clampedText;
        if (supportsNativeClamp && opt.useNativeClamp) {
            sty.overflow = 'hidden';
            sty.textOverflow = 'ellipsis';
            sty.webkitBoxOrient = 'vertical';
            sty.display = '-webkit-box';
            sty.webkitLineClamp = clampValue;

            if (isCSSValue) {
                sty.height = opt.clamp + 'px';
            }
        }
        else {
            var height = getMaxHeight(clampValue);
            if (height <= element.clientHeight) {
                clampedText = truncate(getLastChild(element), height);
            }
        }
        
        return {
            'original': originalText,
            'clamped': clampedText
        }
    }

    window.$clamp = clamp;
})();/*!
 * jQuery Cookie Plugin v1.4.0
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as anonymous module.
		define(['jquery'], factory);
	} else {
		// Browser globals.
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function encode(s) {
		return config.raw ? s : encodeURIComponent(s);
	}

	function decode(s) {
		return config.raw ? s : decodeURIComponent(s);
	}

	function stringifyCookieValue(value) {
		return encode(config.json ? JSON.stringify(value) : String(value));
	}

	function parseCookieValue(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape...
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}

		try {
			// Replace server-side written pluses with spaces.
			// If we can't decode the cookie, ignore it, it's unusable.
			// If we can't parse the cookie, ignore it, it's unusable.
			s = decodeURIComponent(s.replace(pluses, ' '));
			return config.json ? JSON.parse(s) : s;
		} catch(e) {}
	}

	function read(s, converter) {
		var value = config.raw ? s : parseCookieValue(s);
		return $.isFunction(converter) ? converter(value) : value;
	}

	var config = $.cookie = function (key, value, options) {

		// Write

		if (value !== undefined && !$.isFunction(value)) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setTime(+t + days * 864e+5);
			}

			return (document.cookie = [
				encode(key), '=', stringifyCookieValue(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// Read

		var result = key ? undefined : {};

		// To prevent the for loop in the first place assign an empty array
		// in case there are no cookies at all. Also prevents odd result when
		// calling $.cookie().
		var cookies = document.cookie ? document.cookie.split('; ') : [];

		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = parts.join('=');

			if (key && key === name) {
				// If second argument (value) is a function it's a converter...
				result = read(cookie, value);
				break;
			}

			// Prevent storing a cookie that we couldn't decode.
			if (!key && (cookie = read(cookie)) !== undefined) {
				result[name] = cookie;
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) === undefined) {
			return false;
		}

		// Must not alter options, thus extending a fresh object...
		$.cookie(key, '', $.extend({}, options, { expires: -1 }));
		return !$.cookie(key);
	};

}));
/*
 ### jQuery XML to JSON Plugin v1.2 - 2013-02-18 ###
 * http://www.fyneworks.com/ - diego@fyneworks.com
	* Licensed under http://en.wikipedia.org/wiki/MIT_License
 ###
 Website: http://www.fyneworks.com/jquery/xml-to-json/
*//*
 # INSPIRED BY: http://www.terracoder.com/
           AND: http://www.thomasfrank.se/xml_to_json.html
											AND: http://www.kawa.net/works/js/xml/objtree-e.html
*//*
 This simple script converts XML (document of code) into a JSON object. It is the combination of 2
 'xml to json' great parsers (see below) which allows for both 'simple' and 'extended' parsing modes.
*/
// Avoid collisions
;if(window.jQuery) (function($){
 
 // Add function to jQuery namespace
 $.extend({
  
  // converts xml documents and xml text to json object
  xml2json: function(xml, extended) {
   if(!xml) return {}; // quick fail
   
   //### PARSER LIBRARY
   // Core function
   function parseXML(node, simple){
    if(!node) return null;
    var txt = '', obj = null, att = null;
    var nt = node.nodeType, nn = jsVar(node.localName || node.nodeName);
    var nv = node.text || node.nodeValue || '';
    /*DBG*/ //if(window.console) console.log(['x2j',nn,nt,nv.length+' bytes']);
    if(node.childNodes){
     if(node.childNodes.length>0){
      /*DBG*/ //if(window.console) console.log(['x2j',nn,'CHILDREN',node.childNodes]);
      $.each(node.childNodes, function(n,cn){
       var cnt = cn.nodeType, cnn = jsVar(cn.localName || cn.nodeName);
       var cnv = cn.text || cn.nodeValue || '';
       /*DBG*/ //if(window.console) console.log(['x2j',nn,'node>a',cnn,cnt,cnv]);
       if(cnt == 8){
        /*DBG*/ //if(window.console) console.log(['x2j',nn,'node>b',cnn,'COMMENT (ignore)']);
        return; // ignore comment node
       }
       else if(cnt == 3 || cnt == 4 || !cnn){
        // ignore white-space in between tags
        if(cnv.match(/^\s+$/)){
         /*DBG*/ //if(window.console) console.log(['x2j',nn,'node>c',cnn,'WHITE-SPACE (ignore)']);
         return;
        };
        /*DBG*/ //if(window.console) console.log(['x2j',nn,'node>d',cnn,'TEXT']);
        txt += cnv.replace(/^\s+/,'').replace(/\s+$/,'');
								// make sure we ditch trailing spaces from markup
       }
       else{
        /*DBG*/ //if(window.console) console.log(['x2j',nn,'node>e',cnn,'OBJECT']);
        obj = obj || {};
        if(obj[cnn]){
         /*DBG*/ //if(window.console) console.log(['x2j',nn,'node>f',cnn,'ARRAY']);
         
									// http://forum.jquery.com/topic/jquery-jquery-xml2json-problems-when-siblings-of-the-same-tagname-only-have-a-textnode-as-a-child
									if(!obj[cnn].length) obj[cnn] = myArr(obj[cnn]);
									obj[cnn] = myArr(obj[cnn]);
         
									obj[cnn][ obj[cnn].length ] = parseXML(cn, true/* simple */);
         obj[cnn].length = obj[cnn].length;
        }
        else{
         /*DBG*/ //if(window.console) console.log(['x2j',nn,'node>g',cnn,'dig deeper...']);
         obj[cnn] = parseXML(cn);
        };
       };
      });
     };//node.childNodes.length>0
    };//node.childNodes
    if(node.attributes){
     if(node.attributes.length>0){
      /*DBG*/ //if(window.console) console.log(['x2j',nn,'ATTRIBUTES',node.attributes])
      att = {}; obj = obj || {};
      $.each(node.attributes, function(a,at){
       var atn = jsVar(at.name), atv = at.value;
       att[atn] = atv;
       if(obj[atn]){
        /*DBG*/ //if(window.console) console.log(['x2j',nn,'attr>',atn,'ARRAY']);
        
								// http://forum.jquery.com/topic/jquery-jquery-xml2json-problems-when-siblings-of-the-same-tagname-only-have-a-textnode-as-a-child
								//if(!obj[atn].length) obj[atn] = myArr(obj[atn]);//[ obj[ atn ] ];
        obj[cnn] = myArr(obj[cnn]);
								
								obj[atn][ obj[atn].length ] = atv;
        obj[atn].length = obj[atn].length;
       }
       else{
        /*DBG*/ //if(window.console) console.log(['x2j',nn,'attr>',atn,'TEXT']);
        obj[atn] = atv;
       };
      });
      //obj['attributes'] = att;
     };//node.attributes.length>0
    };//node.attributes
    if(obj){
     obj = $.extend( (txt!='' ? new String(txt) : {}),/* {text:txt},*/ obj || {}/*, att || {}*/);
     txt = (obj.text) ? (typeof(obj.text)=='object' ? obj.text : [obj.text || '']).concat([txt]) : txt;
     if(txt) obj.text = txt;
     txt = '';
    };
    var out = obj || txt;
    //console.log([extended, simple, out]);
    if(extended){
     if(txt) out = {};//new String(out);
     txt = out.text || txt || '';
     if(txt) out.text = txt;
     if(!simple) out = myArr(out);
    };
    return out;
   };// parseXML
   // Core Function End
   // Utility functions
   var jsVar = function(s){ return String(s || '').replace(/-/g,"_"); };
   
			// NEW isNum function: 01/09/2010
			// Thanks to Emile Grau, GigaTecnologies S.L., www.gigatransfer.com, www.mygigamail.com
			function isNum(s){
				// based on utility function isNum from xml2json plugin (http://www.fyneworks.com/ - diego@fyneworks.com)
				// few bugs corrected from original function :
				// - syntax error : regexp.test(string) instead of string.test(reg)
				// - regexp modified to accept  comma as decimal mark (latin syntax : 25,24 )
				// - regexp modified to reject if no number before decimal mark  : ".7" is not accepted
				// - string is "trimmed", allowing to accept space at the beginning and end of string
				var regexp=/^((-)?([0-9]+)(([\.\,]{0,1})([0-9]+))?$)/
				return (typeof s == "number") || regexp.test(String((s && typeof s == "string") ? jQuery.trim(s) : ''));
			};
			// OLD isNum function: (for reference only)
			//var isNum = function(s){ return (typeof s == "number") || String((s && typeof s == "string") ? s : '').test(/^((-)?([0-9]*)((\.{0,1})([0-9]+))?$)/); };
																
   var myArr = function(o){
    
				// http://forum.jquery.com/topic/jquery-jquery-xml2json-problems-when-siblings-of-the-same-tagname-only-have-a-textnode-as-a-child
				//if(!o.length) o = [ o ]; o.length=o.length;
    if(!$.isArray(o)) o = [ o ]; o.length=o.length;
				
				// here is where you can attach additional functionality, such as searching and sorting...
    return o;
   };
   // Utility functions End
   //### PARSER LIBRARY END
   
   // Convert plain text to xml
   if(typeof xml=='string') xml = $.text2xml(xml);
   
   // Quick fail if not xml (or if this is a node)
   if(!xml.nodeType) return;
   if(xml.nodeType == 3 || xml.nodeType == 4) return xml.nodeValue;
   
   // Find xml root node
   var root = (xml.nodeType == 9) ? xml.documentElement : xml;
   
   // Convert xml to json
   var out = parseXML(root, true /* simple */);
   
   // Clean-up memory
   xml = null; root = null;
   
   // Send output
   return out;
  },
  
  // Convert text to XML DOM
  text2xml: function(str) {
   // NOTE: I'd like to use jQuery for this, but jQuery makes all tags uppercase
   //return $(xml)[0];
   var out;
   try{
    var xml = ((!$.support.opacity && !$.support.style))?new ActiveXObject("Microsoft.XMLDOM"):new DOMParser();
    xml.async = false;
   }catch(e){ throw new Error("XML Parser could not be instantiated") };
   try{
    if((!$.support.opacity && !$.support.style)) out = (xml.loadXML(str))?xml:false;
    else out = xml.parseFromString(str, "text/xml");
   }catch(e){ throw new Error("Error parsing XML string") };
   return out;
  }
		
 }); // extend $

})(jQuery);
/*!
 * jQuery-ajaxTransport-XDomainRequest - v1.0.2 - 2014-05-02
 * https://github.com/MoonScript/jQuery-ajaxTransport-XDomainRequest
 * Copyright (c) 2014 Jason Moon (@JSONMOON)
 * Licensed MIT (/blob/master/LICENSE.txt)
 */
(function(factory) {
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as anonymous module.
    define(['jquery'], factory);
  } else {
    // Browser globals.
    factory(jQuery);
  }
}(function($) {

// Only continue if we're on IE8/IE9 with jQuery 1.5+ (contains the ajaxTransport function)
if ($.support.cors || !$.ajaxTransport || !window.XDomainRequest) {
  return;
}

var httpRegEx = /^https?:\/\//i;
var getOrPostRegEx = /^get|post$/i;
var sameSchemeRegEx = new RegExp('^'+location.protocol, 'i');

// ajaxTransport exists in jQuery 1.5+
$.ajaxTransport('* text html xml json', function(options, userOptions, jqXHR) {
  
  // Only continue if the request is: asynchronous, uses GET or POST method, has HTTP or HTTPS protocol, and has the same scheme as the calling page
  if (!options.crossDomain || !options.async || !getOrPostRegEx.test(options.type) || !httpRegEx.test(options.url) || !sameSchemeRegEx.test(options.url)) {
    return;
  }

  var xdr = null;

  return {
    send: function(headers, complete) {
      var postData = '';
      var userType = (userOptions.dataType || '').toLowerCase();

      xdr = new XDomainRequest();
      if (/^\d+$/.test(userOptions.timeout)) {
        xdr.timeout = userOptions.timeout;
      }

      xdr.ontimeout = function() {
        complete(500, 'timeout');
      };

      xdr.onload = function() {
        var allResponseHeaders = 'Content-Length: ' + xdr.responseText.length + '\r\nContent-Type: ' + xdr.contentType;
        var status = {
          code: 200,
          message: 'success'
        };
        var responses = {
          text: xdr.responseText
        };
        try {
          if (userType === 'html' || /text\/html/i.test(xdr.contentType)) {
            responses.html = xdr.responseText;
          } else if (userType === 'json' || (userType !== 'text' && /\/json/i.test(xdr.contentType))) {
            try {
              responses.json = $.parseJSON(xdr.responseText);
            } catch(e) {
              status.code = 500;
              status.message = 'parseerror';
              //throw 'Invalid JSON: ' + xdr.responseText;
            }
          } else if (userType === 'xml' || (userType !== 'text' && /\/xml/i.test(xdr.contentType))) {
            var doc = new ActiveXObject('Microsoft.XMLDOM');
            doc.async = false;
            try {
              doc.loadXML(xdr.responseText);
            } catch(e) {
              doc = undefined;
            }
            if (!doc || !doc.documentElement || doc.getElementsByTagName('parsererror').length) {
              status.code = 500;
              status.message = 'parseerror';
              throw 'Invalid XML: ' + xdr.responseText;
            }
            responses.xml = doc;
          }
        } catch(parseMessage) {
          throw parseMessage;
        } finally {
          complete(status.code, status.message, responses, allResponseHeaders);
        }
      };

      // set an empty handler for 'onprogress' so requests don't get aborted
      xdr.onprogress = function(){};
      xdr.onerror = function() {
        complete(500, 'error', {
          text: xdr.responseText
        });
      };

      if (userOptions.data) {
        postData = ($.type(userOptions.data) === 'string') ? userOptions.data : $.param(userOptions.data);
      }
      xdr.open(options.type, options.url);
      xdr.send(postData);
    },
    abort: function() {
      if (xdr) {
        xdr.abort();
      }
    }
  };
});

}));/*! jPlayer 2.9.2 for jQuery ~ (c) 2009-2014 Happyworm Ltd ~ MIT License */
!function(a,b){"function"==typeof define&&define.amd?define(["jquery"],b):b("object"==typeof exports?require("jquery"):a.jQuery?a.jQuery:a.Zepto)}(this,function(a,b){a.fn.jPlayer=function(c){var d="jPlayer",e="string"==typeof c,f=Array.prototype.slice.call(arguments,1),g=this;return c=!e&&f.length?a.extend.apply(null,[!0,c].concat(f)):c,e&&"_"===c.charAt(0)?g:(this.each(e?function(){var e=a(this).data(d),h=e&&a.isFunction(e[c])?e[c].apply(e,f):e;return h!==e&&h!==b?(g=h,!1):void 0}:function(){var b=a(this).data(d);b?b.option(c||{}):a(this).data(d,new a.jPlayer(c,this))}),g)},a.jPlayer=function(b,c){if(arguments.length){this.element=a(c),this.options=a.extend(!0,{},this.options,b);var d=this;this.element.bind("remove.jPlayer",function(){d.destroy()}),this._init()}},"function"!=typeof a.fn.stop&&(a.fn.stop=function(){}),a.jPlayer.emulateMethods="load play pause",a.jPlayer.emulateStatus="src readyState networkState currentTime duration paused ended playbackRate",a.jPlayer.emulateOptions="muted volume",a.jPlayer.reservedEvent="ready flashreset resize repeat error warning",a.jPlayer.event={},a.each(["ready","setmedia","flashreset","resize","repeat","click","error","warning","loadstart","progress","suspend","abort","emptied","stalled","play","pause","loadedmetadata","loadeddata","waiting","playing","canplay","canplaythrough","seeking","seeked","timeupdate","ended","ratechange","durationchange","volumechange"],function(){a.jPlayer.event[this]="jPlayer_"+this}),a.jPlayer.htmlEvent=["loadstart","abort","emptied","stalled","loadedmetadata","canplay","canplaythrough"],a.jPlayer.pause=function(){a.jPlayer.prototype.destroyRemoved(),a.each(a.jPlayer.prototype.instances,function(a,b){b.data("jPlayer").status.srcSet&&b.jPlayer("pause")})},a.jPlayer.timeFormat={showHour:!1,showMin:!0,showSec:!0,padHour:!1,padMin:!0,padSec:!0,sepHour:":",sepMin:":",sepSec:""};var c=function(){this.init()};c.prototype={init:function(){this.options={timeFormat:a.jPlayer.timeFormat}},time:function(a){a=a&&"number"==typeof a?a:0;var b=new Date(1e3*a),c=b.getUTCHours(),d=this.options.timeFormat.showHour?b.getUTCMinutes():b.getUTCMinutes()+60*c,e=this.options.timeFormat.showMin?b.getUTCSeconds():b.getUTCSeconds()+60*d,f=this.options.timeFormat.padHour&&10>c?"0"+c:c,g=this.options.timeFormat.padMin&&10>d?"0"+d:d,h=this.options.timeFormat.padSec&&10>e?"0"+e:e,i="";return i+=this.options.timeFormat.showHour?f+this.options.timeFormat.sepHour:"",i+=this.options.timeFormat.showMin?g+this.options.timeFormat.sepMin:"",i+=this.options.timeFormat.showSec?h+this.options.timeFormat.sepSec:""}};var d=new c;a.jPlayer.convertTime=function(a){return d.time(a)},a.jPlayer.uaBrowser=function(a){var b=a.toLowerCase(),c=/(webkit)[ \/]([\w.]+)/,d=/(opera)(?:.*version)?[ \/]([\w.]+)/,e=/(msie) ([\w.]+)/,f=/(mozilla)(?:.*? rv:([\w.]+))?/,g=c.exec(b)||d.exec(b)||e.exec(b)||b.indexOf("compatible")<0&&f.exec(b)||[];return{browser:g[1]||"",version:g[2]||"0"}},a.jPlayer.uaPlatform=function(a){var b=a.toLowerCase(),c=/(ipad|iphone|ipod|android|blackberry|playbook|windows ce|webos)/,d=/(ipad|playbook)/,e=/(android)/,f=/(mobile)/,g=c.exec(b)||[],h=d.exec(b)||!f.exec(b)&&e.exec(b)||[];return g[1]&&(g[1]=g[1].replace(/\s/g,"_")),{platform:g[1]||"",tablet:h[1]||""}},a.jPlayer.browser={},a.jPlayer.platform={};var e=a.jPlayer.uaBrowser(navigator.userAgent);e.browser&&(a.jPlayer.browser[e.browser]=!0,a.jPlayer.browser.version=e.version);var f=a.jPlayer.uaPlatform(navigator.userAgent);f.platform&&(a.jPlayer.platform[f.platform]=!0,a.jPlayer.platform.mobile=!f.tablet,a.jPlayer.platform.tablet=!!f.tablet),a.jPlayer.getDocMode=function(){var b;return a.jPlayer.browser.msie&&(document.documentMode?b=document.documentMode:(b=5,document.compatMode&&"CSS1Compat"===document.compatMode&&(b=7))),b},a.jPlayer.browser.documentMode=a.jPlayer.getDocMode(),a.jPlayer.nativeFeatures={init:function(){var a,b,c,d=document,e=d.createElement("video"),f={w3c:["fullscreenEnabled","fullscreenElement","requestFullscreen","exitFullscreen","fullscreenchange","fullscreenerror"],moz:["mozFullScreenEnabled","mozFullScreenElement","mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozfullscreenerror"],webkit:["","webkitCurrentFullScreenElement","webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange",""],webkitVideo:["webkitSupportsFullscreen","webkitDisplayingFullscreen","webkitEnterFullscreen","webkitExitFullscreen","",""],ms:["","msFullscreenElement","msRequestFullscreen","msExitFullscreen","MSFullscreenChange","MSFullscreenError"]},g=["w3c","moz","webkit","webkitVideo","ms"];for(this.fullscreen=a={support:{w3c:!!d[f.w3c[0]],moz:!!d[f.moz[0]],webkit:"function"==typeof d[f.webkit[3]],webkitVideo:"function"==typeof e[f.webkitVideo[2]],ms:"function"==typeof e[f.ms[2]]},used:{}},b=0,c=g.length;c>b;b++){var h=g[b];if(a.support[h]){a.spec=h,a.used[h]=!0;break}}if(a.spec){var i=f[a.spec];a.api={fullscreenEnabled:!0,fullscreenElement:function(a){return a=a?a:d,a[i[1]]},requestFullscreen:function(a){return a[i[2]]()},exitFullscreen:function(a){return a=a?a:d,a[i[3]]()}},a.event={fullscreenchange:i[4],fullscreenerror:i[5]}}else a.api={fullscreenEnabled:!1,fullscreenElement:function(){return null},requestFullscreen:function(){},exitFullscreen:function(){}},a.event={}}},a.jPlayer.nativeFeatures.init(),a.jPlayer.focus=null,a.jPlayer.keyIgnoreElementNames="A INPUT TEXTAREA SELECT BUTTON";var g=function(b){var c,d=a.jPlayer.focus;d&&(a.each(a.jPlayer.keyIgnoreElementNames.split(/\s+/g),function(a,d){return b.target.nodeName.toUpperCase()===d.toUpperCase()?(c=!0,!1):void 0}),c||a.each(d.options.keyBindings,function(c,e){return e&&a.isFunction(e.fn)&&("number"==typeof e.key&&b.which===e.key||"string"==typeof e.key&&b.key===e.key)?(b.preventDefault(),e.fn(d),!1):void 0}))};a.jPlayer.keys=function(b){var c="keydown.jPlayer";a(document.documentElement).unbind(c),b&&a(document.documentElement).bind(c,g)},a.jPlayer.keys(!0),a.jPlayer.prototype={count:0,version:{script:"2.9.2",needFlash:"2.9.0",flash:"unknown"},options:{swfPath:"js",solution:"html, flash",supplied:"mp3",auroraFormats:"wav",preload:"metadata",volume:.8,muted:!1,remainingDuration:!1,toggleDuration:!1,captureDuration:!0,playbackRate:1,defaultPlaybackRate:1,minPlaybackRate:.5,maxPlaybackRate:4,wmode:"opaque",backgroundColor:"#000000",cssSelectorAncestor:"#jp_container_1",cssSelector:{videoPlay:".jp-video-play",play:".jp-play",pause:".jp-pause",stop:".jp-stop",seekBar:".jp-seek-bar",playBar:".jp-play-bar",mute:".jp-mute",unmute:".jp-unmute",volumeBar:".jp-volume-bar",volumeBarValue:".jp-volume-bar-value",volumeMax:".jp-volume-max",playbackRateBar:".jp-playback-rate-bar",playbackRateBarValue:".jp-playback-rate-bar-value",currentTime:".jp-current-time",duration:".jp-duration",title:".jp-title",fullScreen:".jp-full-screen",restoreScreen:".jp-restore-screen",repeat:".jp-repeat",repeatOff:".jp-repeat-off",gui:".jp-gui",noSolution:".jp-no-solution"},stateClass:{playing:"jp-state-playing",seeking:"jp-state-seeking",muted:"jp-state-muted",looped:"jp-state-looped",fullScreen:"jp-state-full-screen",noVolume:"jp-state-no-volume"},useStateClassSkin:!1,autoBlur:!0,smoothPlayBar:!1,fullScreen:!1,fullWindow:!1,autohide:{restored:!1,full:!0,fadeIn:200,fadeOut:600,hold:1e3},loop:!1,repeat:function(b){b.jPlayer.options.loop?a(this).unbind(".jPlayerRepeat").bind(a.jPlayer.event.ended+".jPlayer.jPlayerRepeat",function(){a(this).jPlayer("play")}):a(this).unbind(".jPlayerRepeat")},nativeVideoControls:{},noFullWindow:{msie:/msie [0-6]\./,ipad:/ipad.*?os [0-4]\./,iphone:/iphone/,ipod:/ipod/,android_pad:/android [0-3]\.(?!.*?mobile)/,android_phone:/(?=.*android)(?!.*chrome)(?=.*mobile)/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/},noVolume:{ipad:/ipad/,iphone:/iphone/,ipod:/ipod/,android_pad:/android(?!.*?mobile)/,android_phone:/android.*?mobile/,blackberry:/blackberry/,windows_ce:/windows ce/,iemobile:/iemobile/,webos:/webos/,playbook:/playbook/},timeFormat:{},keyEnabled:!1,audioFullScreen:!1,keyBindings:{play:{key:80,fn:function(a){a.status.paused?a.play():a.pause()}},fullScreen:{key:70,fn:function(a){(a.status.video||a.options.audioFullScreen)&&a._setOption("fullScreen",!a.options.fullScreen)}},muted:{key:77,fn:function(a){a._muted(!a.options.muted)}},volumeUp:{key:190,fn:function(a){a.volume(a.options.volume+.1)}},volumeDown:{key:188,fn:function(a){a.volume(a.options.volume-.1)}},loop:{key:76,fn:function(a){a._loop(!a.options.loop)}}},verticalVolume:!1,verticalPlaybackRate:!1,globalVolume:!1,idPrefix:"jp",noConflict:"jQuery",emulateHtml:!1,consoleAlerts:!0,errorAlerts:!1,warningAlerts:!1},optionsAudio:{size:{width:"0px",height:"0px",cssClass:""},sizeFull:{width:"0px",height:"0px",cssClass:""}},optionsVideo:{size:{width:"480px",height:"270px",cssClass:"jp-video-270p"},sizeFull:{width:"100%",height:"100%",cssClass:"jp-video-full"}},instances:{},status:{src:"",media:{},paused:!0,format:{},formatType:"",waitForPlay:!0,waitForLoad:!0,srcSet:!1,video:!1,seekPercent:0,currentPercentRelative:0,currentPercentAbsolute:0,currentTime:0,duration:0,remaining:0,videoWidth:0,videoHeight:0,readyState:0,networkState:0,playbackRate:1,ended:0},internal:{ready:!1},solution:{html:!0,aurora:!0,flash:!0},format:{mp3:{codec:"audio/mpeg",flashCanPlay:!0,media:"audio"},m4a:{codec:'audio/mp4; codecs="mp4a.40.2"',flashCanPlay:!0,media:"audio"},m3u8a:{codec:'application/vnd.apple.mpegurl; codecs="mp4a.40.2"',flashCanPlay:!1,media:"audio"},m3ua:{codec:"audio/mpegurl",flashCanPlay:!1,media:"audio"},oga:{codec:'audio/ogg; codecs="vorbis, opus"',flashCanPlay:!1,media:"audio"},flac:{codec:"audio/x-flac",flashCanPlay:!1,media:"audio"},wav:{codec:'audio/wav; codecs="1"',flashCanPlay:!1,media:"audio"},webma:{codec:'audio/webm; codecs="vorbis"',flashCanPlay:!1,media:"audio"},fla:{codec:"audio/x-flv",flashCanPlay:!0,media:"audio"},rtmpa:{codec:'audio/rtmp; codecs="rtmp"',flashCanPlay:!0,media:"audio"},m4v:{codec:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:!0,media:"video"},m3u8v:{codec:'application/vnd.apple.mpegurl; codecs="avc1.42E01E, mp4a.40.2"',flashCanPlay:!1,media:"video"},m3uv:{codec:"audio/mpegurl",flashCanPlay:!1,media:"video"},ogv:{codec:'video/ogg; codecs="theora, vorbis"',flashCanPlay:!1,media:"video"},webmv:{codec:'video/webm; codecs="vorbis, vp8"',flashCanPlay:!1,media:"video"},flv:{codec:"video/x-flv",flashCanPlay:!0,media:"video"},rtmpv:{codec:'video/rtmp; codecs="rtmp"',flashCanPlay:!0,media:"video"}},_init:function(){var c=this;if(this.element.empty(),this.status=a.extend({},this.status),this.internal=a.extend({},this.internal),this.options.timeFormat=a.extend({},a.jPlayer.timeFormat,this.options.timeFormat),this.internal.cmdsIgnored=a.jPlayer.platform.ipad||a.jPlayer.platform.iphone||a.jPlayer.platform.ipod,this.internal.domNode=this.element.get(0),this.options.keyEnabled&&!a.jPlayer.focus&&(a.jPlayer.focus=this),this.androidFix={setMedia:!1,play:!1,pause:!1,time:0/0},a.jPlayer.platform.android&&(this.options.preload="auto"!==this.options.preload?"metadata":"auto"),this.formats=[],this.solutions=[],this.require={},this.htmlElement={},this.html={},this.html.audio={},this.html.video={},this.aurora={},this.aurora.formats=[],this.aurora.properties=[],this.flash={},this.css={},this.css.cs={},this.css.jq={},this.ancestorJq=[],this.options.volume=this._limitValue(this.options.volume,0,1),a.each(this.options.supplied.toLowerCase().split(","),function(b,d){var e=d.replace(/^\s+|\s+$/g,"");if(c.format[e]){var f=!1;a.each(c.formats,function(a,b){return e===b?(f=!0,!1):void 0}),f||c.formats.push(e)}}),a.each(this.options.solution.toLowerCase().split(","),function(b,d){var e=d.replace(/^\s+|\s+$/g,"");if(c.solution[e]){var f=!1;a.each(c.solutions,function(a,b){return e===b?(f=!0,!1):void 0}),f||c.solutions.push(e)}}),a.each(this.options.auroraFormats.toLowerCase().split(","),function(b,d){var e=d.replace(/^\s+|\s+$/g,"");if(c.format[e]){var f=!1;a.each(c.aurora.formats,function(a,b){return e===b?(f=!0,!1):void 0}),f||c.aurora.formats.push(e)}}),this.internal.instance="jp_"+this.count,this.instances[this.internal.instance]=this.element,this.element.attr("id")||this.element.attr("id",this.options.idPrefix+"_jplayer_"+this.count),this.internal.self=a.extend({},{id:this.element.attr("id"),jq:this.element}),this.internal.audio=a.extend({},{id:this.options.idPrefix+"_audio_"+this.count,jq:b}),this.internal.video=a.extend({},{id:this.options.idPrefix+"_video_"+this.count,jq:b}),this.internal.flash=a.extend({},{id:this.options.idPrefix+"_flash_"+this.count,jq:b,swf:this.options.swfPath+(".swf"!==this.options.swfPath.toLowerCase().slice(-4)?(this.options.swfPath&&"/"!==this.options.swfPath.slice(-1)?"/":"")+"jquery.jplayer.swf":"")}),this.internal.poster=a.extend({},{id:this.options.idPrefix+"_poster_"+this.count,jq:b}),a.each(a.jPlayer.event,function(a,d){c.options[a]!==b&&(c.element.bind(d+".jPlayer",c.options[a]),c.options[a]=b)}),this.require.audio=!1,this.require.video=!1,a.each(this.formats,function(a,b){c.require[c.format[b].media]=!0}),this.options=this.require.video?a.extend(!0,{},this.optionsVideo,this.options):a.extend(!0,{},this.optionsAudio,this.options),this._setSize(),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow),this.status.noVolume=this._uaBlocklist(this.options.noVolume),a.jPlayer.nativeFeatures.fullscreen.api.fullscreenEnabled&&this._fullscreenAddEventListeners(),this._restrictNativeVideoControls(),this.htmlElement.poster=document.createElement("img"),this.htmlElement.poster.id=this.internal.poster.id,this.htmlElement.poster.onload=function(){(!c.status.video||c.status.waitForPlay)&&c.internal.poster.jq.show()},this.element.append(this.htmlElement.poster),this.internal.poster.jq=a("#"+this.internal.poster.id),this.internal.poster.jq.css({width:this.status.width,height:this.status.height}),this.internal.poster.jq.hide(),this.internal.poster.jq.bind("click.jPlayer",function(){c._trigger(a.jPlayer.event.click)}),this.html.audio.available=!1,this.require.audio&&(this.htmlElement.audio=document.createElement("audio"),this.htmlElement.audio.id=this.internal.audio.id,this.html.audio.available=!!this.htmlElement.audio.canPlayType&&this._testCanPlayType(this.htmlElement.audio)),this.html.video.available=!1,this.require.video&&(this.htmlElement.video=document.createElement("video"),this.htmlElement.video.id=this.internal.video.id,this.html.video.available=!!this.htmlElement.video.canPlayType&&this._testCanPlayType(this.htmlElement.video)),this.flash.available=this._checkForFlash(10.1),this.html.canPlay={},this.aurora.canPlay={},this.flash.canPlay={},a.each(this.formats,function(b,d){c.html.canPlay[d]=c.html[c.format[d].media].available&&""!==c.htmlElement[c.format[d].media].canPlayType(c.format[d].codec),c.aurora.canPlay[d]=a.inArray(d,c.aurora.formats)>-1,c.flash.canPlay[d]=c.format[d].flashCanPlay&&c.flash.available}),this.html.desired=!1,this.aurora.desired=!1,this.flash.desired=!1,a.each(this.solutions,function(b,d){if(0===b)c[d].desired=!0;else{var e=!1,f=!1;a.each(c.formats,function(a,b){c[c.solutions[0]].canPlay[b]&&("video"===c.format[b].media?f=!0:e=!0)}),c[d].desired=c.require.audio&&!e||c.require.video&&!f}}),this.html.support={},this.aurora.support={},this.flash.support={},a.each(this.formats,function(a,b){c.html.support[b]=c.html.canPlay[b]&&c.html.desired,c.aurora.support[b]=c.aurora.canPlay[b]&&c.aurora.desired,c.flash.support[b]=c.flash.canPlay[b]&&c.flash.desired}),this.html.used=!1,this.aurora.used=!1,this.flash.used=!1,a.each(this.solutions,function(b,d){a.each(c.formats,function(a,b){return c[d].support[b]?(c[d].used=!0,!1):void 0})}),this._resetActive(),this._resetGate(),this._cssSelectorAncestor(this.options.cssSelectorAncestor),this.html.used||this.aurora.used||this.flash.used?this.css.jq.noSolution.length&&this.css.jq.noSolution.hide():(this._error({type:a.jPlayer.error.NO_SOLUTION,context:"{solution:'"+this.options.solution+"', supplied:'"+this.options.supplied+"'}",message:a.jPlayer.errorMsg.NO_SOLUTION,hint:a.jPlayer.errorHint.NO_SOLUTION}),this.css.jq.noSolution.length&&this.css.jq.noSolution.show()),this.flash.used){var d,e="jQuery="+encodeURI(this.options.noConflict)+"&id="+encodeURI(this.internal.self.id)+"&vol="+this.options.volume+"&muted="+this.options.muted;if(a.jPlayer.browser.msie&&(Number(a.jPlayer.browser.version)<9||a.jPlayer.browser.documentMode<9)){var f='<object id="'+this.internal.flash.id+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="0" height="0" tabindex="-1"></object>',g=['<param name="movie" value="'+this.internal.flash.swf+'" />','<param name="FlashVars" value="'+e+'" />','<param name="allowScriptAccess" value="always" />','<param name="bgcolor" value="'+this.options.backgroundColor+'" />','<param name="wmode" value="'+this.options.wmode+'" />'];d=document.createElement(f);for(var h=0;h<g.length;h++)d.appendChild(document.createElement(g[h]))}else{var i=function(a,b,c){var d=document.createElement("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)};d=document.createElement("object"),d.setAttribute("id",this.internal.flash.id),d.setAttribute("name",this.internal.flash.id),d.setAttribute("data",this.internal.flash.swf),d.setAttribute("type","application/x-shockwave-flash"),d.setAttribute("width","1"),d.setAttribute("height","1"),d.setAttribute("tabindex","-1"),i(d,"flashvars",e),i(d,"allowscriptaccess","always"),i(d,"bgcolor",this.options.backgroundColor),i(d,"wmode",this.options.wmode)}this.element.append(d),this.internal.flash.jq=a(d)}this.status.playbackRateEnabled=this.html.used&&!this.flash.used?this._testPlaybackRate("audio"):!1,this._updatePlaybackRate(),this.html.used&&(this.html.audio.available&&(this._addHtmlEventListeners(this.htmlElement.audio,this.html.audio),this.element.append(this.htmlElement.audio),this.internal.audio.jq=a("#"+this.internal.audio.id)),this.html.video.available&&(this._addHtmlEventListeners(this.htmlElement.video,this.html.video),this.element.append(this.htmlElement.video),this.internal.video.jq=a("#"+this.internal.video.id),this.internal.video.jq.css(this.status.nativeVideoControls?{width:this.status.width,height:this.status.height}:{width:"0px",height:"0px"}),this.internal.video.jq.bind("click.jPlayer",function(){c._trigger(a.jPlayer.event.click)}))),this.aurora.used,this.options.emulateHtml&&this._emulateHtmlBridge(),!this.html.used&&!this.aurora.used||this.flash.used||setTimeout(function(){c.internal.ready=!0,c.version.flash="n/a",c._trigger(a.jPlayer.event.repeat),c._trigger(a.jPlayer.event.ready)},100),this._updateNativeVideoControls(),this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),a.jPlayer.prototype.count++},destroy:function(){this.clearMedia(),this._removeUiClass(),this.css.jq.currentTime.length&&this.css.jq.currentTime.text(""),this.css.jq.duration.length&&this.css.jq.duration.text(""),a.each(this.css.jq,function(a,b){b.length&&b.unbind(".jPlayer")}),this.internal.poster.jq.unbind(".jPlayer"),this.internal.video.jq&&this.internal.video.jq.unbind(".jPlayer"),this._fullscreenRemoveEventListeners(),this===a.jPlayer.focus&&(a.jPlayer.focus=null),this.options.emulateHtml&&this._destroyHtmlBridge(),this.element.removeData("jPlayer"),this.element.unbind(".jPlayer"),this.element.empty(),delete this.instances[this.internal.instance]},destroyRemoved:function(){var b=this;a.each(this.instances,function(a,c){b.element!==c&&(c.data("jPlayer")||(c.jPlayer("destroy"),delete b.instances[a]))})},enable:function(){},disable:function(){},_testCanPlayType:function(a){try{return a.canPlayType(this.format.mp3.codec),!0}catch(b){return!1}},_testPlaybackRate:function(a){var b,c=.5;a="string"==typeof a?a:"audio",b=document.createElement(a);try{return"playbackRate"in b?(b.playbackRate=c,b.playbackRate===c):!1}catch(d){return!1}},_uaBlocklist:function(b){var c=navigator.userAgent.toLowerCase(),d=!1;return a.each(b,function(a,b){return b&&b.test(c)?(d=!0,!1):void 0}),d},_restrictNativeVideoControls:function(){this.require.audio&&this.status.nativeVideoControls&&(this.status.nativeVideoControls=!1,this.status.noFullWindow=!0)},_updateNativeVideoControls:function(){this.html.video.available&&this.html.used&&(this.htmlElement.video.controls=this.status.nativeVideoControls,this._updateAutohide(),this.status.nativeVideoControls&&this.require.video?(this.internal.poster.jq.hide(),this.internal.video.jq.css({width:this.status.width,height:this.status.height})):this.status.waitForPlay&&this.status.video&&(this.internal.poster.jq.show(),this.internal.video.jq.css({width:"0px",height:"0px"})))},_addHtmlEventListeners:function(b,c){var d=this;b.preload=this.options.preload,b.muted=this.options.muted,b.volume=this.options.volume,this.status.playbackRateEnabled&&(b.defaultPlaybackRate=this.options.defaultPlaybackRate,b.playbackRate=this.options.playbackRate),b.addEventListener("progress",function(){c.gate&&(d.internal.cmdsIgnored&&this.readyState>0&&(d.internal.cmdsIgnored=!1),d._getHtmlStatus(b),d._updateInterface(),d._trigger(a.jPlayer.event.progress))},!1),b.addEventListener("loadeddata",function(){c.gate&&(d.androidFix.setMedia=!1,d.androidFix.play&&(d.androidFix.play=!1,d.play(d.androidFix.time)),d.androidFix.pause&&(d.androidFix.pause=!1,d.pause(d.androidFix.time)),d._trigger(a.jPlayer.event.loadeddata))},!1),b.addEventListener("timeupdate",function(){c.gate&&(d._getHtmlStatus(b),d._updateInterface(),d._trigger(a.jPlayer.event.timeupdate))},!1),b.addEventListener("durationchange",function(){c.gate&&(d._getHtmlStatus(b),d._updateInterface(),d._trigger(a.jPlayer.event.durationchange))},!1),b.addEventListener("play",function(){c.gate&&(d._updateButtons(!0),d._html_checkWaitForPlay(),d._trigger(a.jPlayer.event.play))},!1),b.addEventListener("playing",function(){c.gate&&(d._updateButtons(!0),d._seeked(),d._trigger(a.jPlayer.event.playing))},!1),b.addEventListener("pause",function(){c.gate&&(d._updateButtons(!1),d._trigger(a.jPlayer.event.pause))},!1),b.addEventListener("waiting",function(){c.gate&&(d._seeking(),d._trigger(a.jPlayer.event.waiting))},!1),b.addEventListener("seeking",function(){c.gate&&(d._seeking(),d._trigger(a.jPlayer.event.seeking))},!1),b.addEventListener("seeked",function(){c.gate&&(d._seeked(),d._trigger(a.jPlayer.event.seeked))},!1),b.addEventListener("volumechange",function(){c.gate&&(d.options.volume=b.volume,d.options.muted=b.muted,d._updateMute(),d._updateVolume(),d._trigger(a.jPlayer.event.volumechange))},!1),b.addEventListener("ratechange",function(){c.gate&&(d.options.defaultPlaybackRate=b.defaultPlaybackRate,d.options.playbackRate=b.playbackRate,d._updatePlaybackRate(),d._trigger(a.jPlayer.event.ratechange))},!1),b.addEventListener("suspend",function(){c.gate&&(d._seeked(),d._trigger(a.jPlayer.event.suspend))},!1),b.addEventListener("ended",function(){c.gate&&(a.jPlayer.browser.webkit||(d.htmlElement.media.currentTime=0),d.htmlElement.media.pause(),d._updateButtons(!1),d._getHtmlStatus(b,!0),d._updateInterface(),d._trigger(a.jPlayer.event.ended))},!1),b.addEventListener("error",function(){c.gate&&(d._updateButtons(!1),d._seeked(),d.status.srcSet&&(clearTimeout(d.internal.htmlDlyCmdId),d.status.waitForLoad=!0,d.status.waitForPlay=!0,d.status.video&&!d.status.nativeVideoControls&&d.internal.video.jq.css({width:"0px",height:"0px"}),d._validString(d.status.media.poster)&&!d.status.nativeVideoControls&&d.internal.poster.jq.show(),d.css.jq.videoPlay.length&&d.css.jq.videoPlay.show(),d._error({type:a.jPlayer.error.URL,context:d.status.src,message:a.jPlayer.errorMsg.URL,hint:a.jPlayer.errorHint.URL})))},!1),a.each(a.jPlayer.htmlEvent,function(e,f){b.addEventListener(this,function(){c.gate&&d._trigger(a.jPlayer.event[f])},!1)})},_addAuroraEventListeners:function(b,c){var d=this;b.volume=100*this.options.volume,b.on("progress",function(){c.gate&&(d.internal.cmdsIgnored&&this.readyState>0&&(d.internal.cmdsIgnored=!1),d._getAuroraStatus(b),d._updateInterface(),d._trigger(a.jPlayer.event.progress),b.duration>0&&d._trigger(a.jPlayer.event.timeupdate))},!1),b.on("ready",function(){c.gate&&d._trigger(a.jPlayer.event.loadeddata)},!1),b.on("duration",function(){c.gate&&(d._getAuroraStatus(b),d._updateInterface(),d._trigger(a.jPlayer.event.durationchange))},!1),b.on("end",function(){c.gate&&(d._updateButtons(!1),d._getAuroraStatus(b,!0),d._updateInterface(),d._trigger(a.jPlayer.event.ended))},!1),b.on("error",function(){c.gate&&(d._updateButtons(!1),d._seeked(),d.status.srcSet&&(d.status.waitForLoad=!0,d.status.waitForPlay=!0,d.status.video&&!d.status.nativeVideoControls&&d.internal.video.jq.css({width:"0px",height:"0px"}),d._validString(d.status.media.poster)&&!d.status.nativeVideoControls&&d.internal.poster.jq.show(),d.css.jq.videoPlay.length&&d.css.jq.videoPlay.show(),d._error({type:a.jPlayer.error.URL,context:d.status.src,message:a.jPlayer.errorMsg.URL,hint:a.jPlayer.errorHint.URL})))},!1)},_getHtmlStatus:function(a,b){var c=0,d=0,e=0,f=0;isFinite(a.duration)&&(this.status.duration=a.duration),c=a.currentTime,d=this.status.duration>0?100*c/this.status.duration:0,"object"==typeof a.seekable&&a.seekable.length>0?(e=this.status.duration>0?100*a.seekable.end(a.seekable.length-1)/this.status.duration:100,f=this.status.duration>0?100*a.currentTime/a.seekable.end(a.seekable.length-1):0):(e=100,f=d),b&&(c=0,f=0,d=0),this.status.seekPercent=e,this.status.currentPercentRelative=f,this.status.currentPercentAbsolute=d,this.status.currentTime=c,this.status.remaining=this.status.duration-this.status.currentTime,this.status.videoWidth=a.videoWidth,this.status.videoHeight=a.videoHeight,this.status.readyState=a.readyState,this.status.networkState=a.networkState,this.status.playbackRate=a.playbackRate,this.status.ended=a.ended},_getAuroraStatus:function(a,b){var c=0,d=0,e=0,f=0;this.status.duration=a.duration/1e3,c=a.currentTime/1e3,d=this.status.duration>0?100*c/this.status.duration:0,a.buffered>0?(e=this.status.duration>0?a.buffered*this.status.duration/this.status.duration:100,f=this.status.duration>0?c/(a.buffered*this.status.duration):0):(e=100,f=d),b&&(c=0,f=0,d=0),this.status.seekPercent=e,this.status.currentPercentRelative=f,this.status.currentPercentAbsolute=d,this.status.currentTime=c,this.status.remaining=this.status.duration-this.status.currentTime,this.status.readyState=4,this.status.networkState=0,this.status.playbackRate=1,this.status.ended=!1},_resetStatus:function(){this.status=a.extend({},this.status,a.jPlayer.prototype.status)},_trigger:function(b,c,d){var e=a.Event(b);e.jPlayer={},e.jPlayer.version=a.extend({},this.version),e.jPlayer.options=a.extend(!0,{},this.options),e.jPlayer.status=a.extend(!0,{},this.status),e.jPlayer.html=a.extend(!0,{},this.html),e.jPlayer.aurora=a.extend(!0,{},this.aurora),e.jPlayer.flash=a.extend(!0,{},this.flash),c&&(e.jPlayer.error=a.extend({},c)),d&&(e.jPlayer.warning=a.extend({},d)),this.element.trigger(e)},jPlayerFlashEvent:function(b,c){if(b===a.jPlayer.event.ready)if(this.internal.ready){if(this.flash.gate){if(this.status.srcSet){var d=this.status.currentTime,e=this.status.paused;this.setMedia(this.status.media),this.volumeWorker(this.options.volume),d>0&&(e?this.pause(d):this.play(d))}this._trigger(a.jPlayer.event.flashreset)}}else this.internal.ready=!0,this.internal.flash.jq.css({width:"0px",height:"0px"}),this.version.flash=c.version,this.version.needFlash!==this.version.flash&&this._error({type:a.jPlayer.error.VERSION,context:this.version.flash,message:a.jPlayer.errorMsg.VERSION+this.version.flash,hint:a.jPlayer.errorHint.VERSION}),this._trigger(a.jPlayer.event.repeat),this._trigger(b);if(this.flash.gate)switch(b){case a.jPlayer.event.progress:this._getFlashStatus(c),this._updateInterface(),this._trigger(b);break;case a.jPlayer.event.timeupdate:this._getFlashStatus(c),this._updateInterface(),this._trigger(b);break;case a.jPlayer.event.play:this._seeked(),this._updateButtons(!0),this._trigger(b);break;case a.jPlayer.event.pause:this._updateButtons(!1),this._trigger(b);break;case a.jPlayer.event.ended:this._updateButtons(!1),this._trigger(b);break;case a.jPlayer.event.click:this._trigger(b);break;case a.jPlayer.event.error:this.status.waitForLoad=!0,this.status.waitForPlay=!0,this.status.video&&this.internal.flash.jq.css({width:"0px",height:"0px"}),this._validString(this.status.media.poster)&&this.internal.poster.jq.show(),this.css.jq.videoPlay.length&&this.status.video&&this.css.jq.videoPlay.show(),this.status.video?this._flash_setVideo(this.status.media):this._flash_setAudio(this.status.media),this._updateButtons(!1),this._error({type:a.jPlayer.error.URL,context:c.src,message:a.jPlayer.errorMsg.URL,hint:a.jPlayer.errorHint.URL});break;case a.jPlayer.event.seeking:this._seeking(),this._trigger(b);break;case a.jPlayer.event.seeked:this._seeked(),this._trigger(b);break;case a.jPlayer.event.ready:break;default:this._trigger(b)}return!1},_getFlashStatus:function(a){this.status.seekPercent=a.seekPercent,this.status.currentPercentRelative=a.currentPercentRelative,this.status.currentPercentAbsolute=a.currentPercentAbsolute,this.status.currentTime=a.currentTime,this.status.duration=a.duration,this.status.remaining=a.duration-a.currentTime,this.status.videoWidth=a.videoWidth,this.status.videoHeight=a.videoHeight,this.status.readyState=4,this.status.networkState=0,this.status.playbackRate=1,this.status.ended=!1},_updateButtons:function(a){a===b?a=!this.status.paused:this.status.paused=!a,a?this.addStateClass("playing"):this.removeStateClass("playing"),!this.status.noFullWindow&&this.options.fullWindow?this.addStateClass("fullScreen"):this.removeStateClass("fullScreen"),this.options.loop?this.addStateClass("looped"):this.removeStateClass("looped"),this.css.jq.play.length&&this.css.jq.pause.length&&(a?(this.css.jq.play.hide(),this.css.jq.pause.show()):(this.css.jq.play.show(),this.css.jq.pause.hide())),this.css.jq.restoreScreen.length&&this.css.jq.fullScreen.length&&(this.status.noFullWindow?(this.css.jq.fullScreen.hide(),this.css.jq.restoreScreen.hide()):this.options.fullWindow?(this.css.jq.fullScreen.hide(),this.css.jq.restoreScreen.show()):(this.css.jq.fullScreen.show(),this.css.jq.restoreScreen.hide())),this.css.jq.repeat.length&&this.css.jq.repeatOff.length&&(this.options.loop?(this.css.jq.repeat.hide(),this.css.jq.repeatOff.show()):(this.css.jq.repeat.show(),this.css.jq.repeatOff.hide()))},_updateInterface:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.width(this.status.seekPercent+"%"),this.css.jq.playBar.length&&(this.options.smoothPlayBar?this.css.jq.playBar.stop().animate({width:this.status.currentPercentAbsolute+"%"},250,"linear"):this.css.jq.playBar.width(this.status.currentPercentRelative+"%"));var a="";this.css.jq.currentTime.length&&(a=this._convertTime(this.status.currentTime),a!==this.css.jq.currentTime.text()&&this.css.jq.currentTime.text(this._convertTime(this.status.currentTime)));var b="",c=this.status.duration,d=this.status.remaining;this.css.jq.duration.length&&("string"==typeof this.status.media.duration?b=this.status.media.duration:("number"==typeof this.status.media.duration&&(c=this.status.media.duration,d=c-this.status.currentTime),b=this.options.remainingDuration?(d>0?"-":"")+this._convertTime(d):this._convertTime(c)),b!==this.css.jq.duration.text()&&this.css.jq.duration.text(b))},_convertTime:c.prototype.time,_seeking:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.addClass("jp-seeking-bg"),this.addStateClass("seeking")},_seeked:function(){this.css.jq.seekBar.length&&this.css.jq.seekBar.removeClass("jp-seeking-bg"),this.removeStateClass("seeking")},_resetGate:function(){this.html.audio.gate=!1,this.html.video.gate=!1,this.aurora.gate=!1,this.flash.gate=!1},_resetActive:function(){this.html.active=!1,this.aurora.active=!1,this.flash.active=!1},_escapeHtml:function(a){return a.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;")},_qualifyURL:function(a){var b=document.createElement("div");
return b.innerHTML='<a href="'+this._escapeHtml(a)+'">x</a>',b.firstChild.href},_absoluteMediaUrls:function(b){var c=this;return a.each(b,function(a,d){d&&c.format[a]&&"data:"!==d.substr(0,5)&&(b[a]=c._qualifyURL(d))}),b},addStateClass:function(a){this.ancestorJq.length&&this.ancestorJq.addClass(this.options.stateClass[a])},removeStateClass:function(a){this.ancestorJq.length&&this.ancestorJq.removeClass(this.options.stateClass[a])},setMedia:function(b){var c=this,d=!1,e=this.status.media.poster!==b.poster;this._resetMedia(),this._resetGate(),this._resetActive(),this.androidFix.setMedia=!1,this.androidFix.play=!1,this.androidFix.pause=!1,b=this._absoluteMediaUrls(b),a.each(this.formats,function(e,f){var g="video"===c.format[f].media;return a.each(c.solutions,function(e,h){if(c[h].support[f]&&c._validString(b[f])){var i="html"===h,j="aurora"===h;return g?(i?(c.html.video.gate=!0,c._html_setVideo(b),c.html.active=!0):(c.flash.gate=!0,c._flash_setVideo(b),c.flash.active=!0),c.css.jq.videoPlay.length&&c.css.jq.videoPlay.show(),c.status.video=!0):(i?(c.html.audio.gate=!0,c._html_setAudio(b),c.html.active=!0,a.jPlayer.platform.android&&(c.androidFix.setMedia=!0)):j?(c.aurora.gate=!0,c._aurora_setAudio(b),c.aurora.active=!0):(c.flash.gate=!0,c._flash_setAudio(b),c.flash.active=!0),c.css.jq.videoPlay.length&&c.css.jq.videoPlay.hide(),c.status.video=!1),d=!0,!1}}),d?!1:void 0}),d?(this.status.nativeVideoControls&&this.html.video.gate||this._validString(b.poster)&&(e?this.htmlElement.poster.src=b.poster:this.internal.poster.jq.show()),"string"==typeof b.title&&(this.css.jq.title.length&&this.css.jq.title.html(b.title),this.htmlElement.audio&&this.htmlElement.audio.setAttribute("title",b.title),this.htmlElement.video&&this.htmlElement.video.setAttribute("title",b.title)),this.status.srcSet=!0,this.status.media=a.extend({},b),this._updateButtons(!1),this._updateInterface(),this._trigger(a.jPlayer.event.setmedia)):this._error({type:a.jPlayer.error.NO_SUPPORT,context:"{supplied:'"+this.options.supplied+"'}",message:a.jPlayer.errorMsg.NO_SUPPORT,hint:a.jPlayer.errorHint.NO_SUPPORT})},_resetMedia:function(){this._resetStatus(),this._updateButtons(!1),this._updateInterface(),this._seeked(),this.internal.poster.jq.hide(),clearTimeout(this.internal.htmlDlyCmdId),this.html.active?this._html_resetMedia():this.aurora.active?this._aurora_resetMedia():this.flash.active&&this._flash_resetMedia()},clearMedia:function(){this._resetMedia(),this.html.active?this._html_clearMedia():this.aurora.active?this._aurora_clearMedia():this.flash.active&&this._flash_clearMedia(),this._resetGate(),this._resetActive()},load:function(){this.status.srcSet?this.html.active?this._html_load():this.aurora.active?this._aurora_load():this.flash.active&&this._flash_load():this._urlNotSetError("load")},focus:function(){this.options.keyEnabled&&(a.jPlayer.focus=this)},play:function(a){var b="object"==typeof a;b&&this.options.useStateClassSkin&&!this.status.paused?this.pause(a):(a="number"==typeof a?a:0/0,this.status.srcSet?(this.focus(),this.html.active?this._html_play(a):this.aurora.active?this._aurora_play(a):this.flash.active&&this._flash_play(a)):this._urlNotSetError("play"))},videoPlay:function(){this.play()},pause:function(a){a="number"==typeof a?a:0/0,this.status.srcSet?this.html.active?this._html_pause(a):this.aurora.active?this._aurora_pause(a):this.flash.active&&this._flash_pause(a):this._urlNotSetError("pause")},tellOthers:function(b,c){var d=this,e="function"==typeof c,f=Array.prototype.slice.call(arguments);"string"==typeof b&&(e&&f.splice(1,1),a.jPlayer.prototype.destroyRemoved(),a.each(this.instances,function(){d.element!==this&&(!e||c.call(this.data("jPlayer"),d))&&this.jPlayer.apply(this,f)}))},pauseOthers:function(a){this.tellOthers("pause",function(){return this.status.srcSet},a)},stop:function(){this.status.srcSet?this.html.active?this._html_pause(0):this.aurora.active?this._aurora_pause(0):this.flash.active&&this._flash_pause(0):this._urlNotSetError("stop")},playHead:function(a){a=this._limitValue(a,0,100),this.status.srcSet?this.html.active?this._html_playHead(a):this.aurora.active?this._aurora_playHead(a):this.flash.active&&this._flash_playHead(a):this._urlNotSetError("playHead")},_muted:function(a){this.mutedWorker(a),this.options.globalVolume&&this.tellOthers("mutedWorker",function(){return this.options.globalVolume},a)},mutedWorker:function(b){this.options.muted=b,this.html.used&&this._html_setProperty("muted",b),this.aurora.used&&this._aurora_mute(b),this.flash.used&&this._flash_mute(b),this.html.video.gate||this.html.audio.gate||(this._updateMute(b),this._updateVolume(this.options.volume),this._trigger(a.jPlayer.event.volumechange))},mute:function(a){var c="object"==typeof a;c&&this.options.useStateClassSkin&&this.options.muted?this._muted(!1):(a=a===b?!0:!!a,this._muted(a))},unmute:function(a){a=a===b?!0:!!a,this._muted(!a)},_updateMute:function(a){a===b&&(a=this.options.muted),a?this.addStateClass("muted"):this.removeStateClass("muted"),this.css.jq.mute.length&&this.css.jq.unmute.length&&(this.status.noVolume?(this.css.jq.mute.hide(),this.css.jq.unmute.hide()):a?(this.css.jq.mute.hide(),this.css.jq.unmute.show()):(this.css.jq.mute.show(),this.css.jq.unmute.hide()))},volume:function(a){this.volumeWorker(a),this.options.globalVolume&&this.tellOthers("volumeWorker",function(){return this.options.globalVolume},a)},volumeWorker:function(b){b=this._limitValue(b,0,1),this.options.volume=b,this.html.used&&this._html_setProperty("volume",b),this.aurora.used&&this._aurora_volume(b),this.flash.used&&this._flash_volume(b),this.html.video.gate||this.html.audio.gate||(this._updateVolume(b),this._trigger(a.jPlayer.event.volumechange))},volumeBar:function(b){if(this.css.jq.volumeBar.length){var c=a(b.currentTarget),d=c.offset(),e=b.pageX-d.left,f=c.width(),g=c.height()-b.pageY+d.top,h=c.height();this.volume(this.options.verticalVolume?g/h:e/f)}this.options.muted&&this._muted(!1)},_updateVolume:function(a){a===b&&(a=this.options.volume),a=this.options.muted?0:a,this.status.noVolume?(this.addStateClass("noVolume"),this.css.jq.volumeBar.length&&this.css.jq.volumeBar.hide(),this.css.jq.volumeBarValue.length&&this.css.jq.volumeBarValue.hide(),this.css.jq.volumeMax.length&&this.css.jq.volumeMax.hide()):(this.removeStateClass("noVolume"),this.css.jq.volumeBar.length&&this.css.jq.volumeBar.show(),this.css.jq.volumeBarValue.length&&(this.css.jq.volumeBarValue.show(),this.css.jq.volumeBarValue[this.options.verticalVolume?"height":"width"](100*a+"%")),this.css.jq.volumeMax.length&&this.css.jq.volumeMax.show())},volumeMax:function(){this.volume(1),this.options.muted&&this._muted(!1)},_cssSelectorAncestor:function(b){var c=this;this.options.cssSelectorAncestor=b,this._removeUiClass(),this.ancestorJq=b?a(b):[],b&&1!==this.ancestorJq.length&&this._warning({type:a.jPlayer.warning.CSS_SELECTOR_COUNT,context:b,message:a.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.ancestorJq.length+" found for cssSelectorAncestor.",hint:a.jPlayer.warningHint.CSS_SELECTOR_COUNT}),this._addUiClass(),a.each(this.options.cssSelector,function(a,b){c._cssSelector(a,b)}),this._updateInterface(),this._updateButtons(),this._updateAutohide(),this._updateVolume(),this._updateMute()},_cssSelector:function(b,c){var d=this;if("string"==typeof c)if(a.jPlayer.prototype.options.cssSelector[b]){if(this.css.jq[b]&&this.css.jq[b].length&&this.css.jq[b].unbind(".jPlayer"),this.options.cssSelector[b]=c,this.css.cs[b]=this.options.cssSelectorAncestor+" "+c,this.css.jq[b]=c?a(this.css.cs[b]):[],this.css.jq[b].length&&this[b]){var e=function(c){c.preventDefault(),d[b](c),d.options.autoBlur?a(this).blur():a(this).focus()};this.css.jq[b].bind("click.jPlayer",e)}c&&1!==this.css.jq[b].length&&this._warning({type:a.jPlayer.warning.CSS_SELECTOR_COUNT,context:this.css.cs[b],message:a.jPlayer.warningMsg.CSS_SELECTOR_COUNT+this.css.jq[b].length+" found for "+b+" method.",hint:a.jPlayer.warningHint.CSS_SELECTOR_COUNT})}else this._warning({type:a.jPlayer.warning.CSS_SELECTOR_METHOD,context:b,message:a.jPlayer.warningMsg.CSS_SELECTOR_METHOD,hint:a.jPlayer.warningHint.CSS_SELECTOR_METHOD});else this._warning({type:a.jPlayer.warning.CSS_SELECTOR_STRING,context:c,message:a.jPlayer.warningMsg.CSS_SELECTOR_STRING,hint:a.jPlayer.warningHint.CSS_SELECTOR_STRING})},duration:function(a){this.options.toggleDuration&&(this.options.captureDuration&&a.stopPropagation(),this._setOption("remainingDuration",!this.options.remainingDuration))},seekBar:function(b){if(this.css.jq.seekBar.length){var c=a(b.currentTarget),d=c.offset(),e=b.pageX-d.left,f=c.width(),g=100*e/f;this.playHead(g)}},playbackRate:function(a){this._setOption("playbackRate",a)},playbackRateBar:function(b){if(this.css.jq.playbackRateBar.length){var c,d,e=a(b.currentTarget),f=e.offset(),g=b.pageX-f.left,h=e.width(),i=e.height()-b.pageY+f.top,j=e.height();c=this.options.verticalPlaybackRate?i/j:g/h,d=c*(this.options.maxPlaybackRate-this.options.minPlaybackRate)+this.options.minPlaybackRate,this.playbackRate(d)}},_updatePlaybackRate:function(){var a=this.options.playbackRate,b=(a-this.options.minPlaybackRate)/(this.options.maxPlaybackRate-this.options.minPlaybackRate);this.status.playbackRateEnabled?(this.css.jq.playbackRateBar.length&&this.css.jq.playbackRateBar.show(),this.css.jq.playbackRateBarValue.length&&(this.css.jq.playbackRateBarValue.show(),this.css.jq.playbackRateBarValue[this.options.verticalPlaybackRate?"height":"width"](100*b+"%"))):(this.css.jq.playbackRateBar.length&&this.css.jq.playbackRateBar.hide(),this.css.jq.playbackRateBarValue.length&&this.css.jq.playbackRateBarValue.hide())},repeat:function(a){var b="object"==typeof a;this._loop(b&&this.options.useStateClassSkin&&this.options.loop?!1:!0)},repeatOff:function(){this._loop(!1)},_loop:function(b){this.options.loop!==b&&(this.options.loop=b,this._updateButtons(),this._trigger(a.jPlayer.event.repeat))},option:function(c,d){var e=c;if(0===arguments.length)return a.extend(!0,{},this.options);if("string"==typeof c){var f=c.split(".");if(d===b){for(var g=a.extend(!0,{},this.options),h=0;h<f.length;h++){if(g[f[h]]===b)return this._warning({type:a.jPlayer.warning.OPTION_KEY,context:c,message:a.jPlayer.warningMsg.OPTION_KEY,hint:a.jPlayer.warningHint.OPTION_KEY}),b;g=g[f[h]]}return g}e={};for(var i=e,j=0;j<f.length;j++)j<f.length-1?(i[f[j]]={},i=i[f[j]]):i[f[j]]=d}return this._setOptions(e),this},_setOptions:function(b){var c=this;return a.each(b,function(a,b){c._setOption(a,b)}),this},_setOption:function(b,c){var d=this;switch(b){case"volume":this.volume(c);break;case"muted":this._muted(c);break;case"globalVolume":this.options[b]=c;break;case"cssSelectorAncestor":this._cssSelectorAncestor(c);break;case"cssSelector":a.each(c,function(a,b){d._cssSelector(a,b)});break;case"playbackRate":this.options[b]=c=this._limitValue(c,this.options.minPlaybackRate,this.options.maxPlaybackRate),this.html.used&&this._html_setProperty("playbackRate",c),this._updatePlaybackRate();break;case"defaultPlaybackRate":this.options[b]=c=this._limitValue(c,this.options.minPlaybackRate,this.options.maxPlaybackRate),this.html.used&&this._html_setProperty("defaultPlaybackRate",c),this._updatePlaybackRate();break;case"minPlaybackRate":this.options[b]=c=this._limitValue(c,.1,this.options.maxPlaybackRate-.1),this._updatePlaybackRate();break;case"maxPlaybackRate":this.options[b]=c=this._limitValue(c,this.options.minPlaybackRate+.1,16),this._updatePlaybackRate();break;case"fullScreen":if(this.options[b]!==c){var e=a.jPlayer.nativeFeatures.fullscreen.used.webkitVideo;(!e||e&&!this.status.waitForPlay)&&(e||(this.options[b]=c),c?this._requestFullscreen():this._exitFullscreen(),e||this._setOption("fullWindow",c))}break;case"fullWindow":this.options[b]!==c&&(this._removeUiClass(),this.options[b]=c,this._refreshSize());break;case"size":this.options.fullWindow||this.options[b].cssClass===c.cssClass||this._removeUiClass(),this.options[b]=a.extend({},this.options[b],c),this._refreshSize();break;case"sizeFull":this.options.fullWindow&&this.options[b].cssClass!==c.cssClass&&this._removeUiClass(),this.options[b]=a.extend({},this.options[b],c),this._refreshSize();break;case"autohide":this.options[b]=a.extend({},this.options[b],c),this._updateAutohide();break;case"loop":this._loop(c);break;case"remainingDuration":this.options[b]=c,this._updateInterface();break;case"toggleDuration":this.options[b]=c;break;case"nativeVideoControls":this.options[b]=a.extend({},this.options[b],c),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this._restrictNativeVideoControls(),this._updateNativeVideoControls();break;case"noFullWindow":this.options[b]=a.extend({},this.options[b],c),this.status.nativeVideoControls=this._uaBlocklist(this.options.nativeVideoControls),this.status.noFullWindow=this._uaBlocklist(this.options.noFullWindow),this._restrictNativeVideoControls(),this._updateButtons();break;case"noVolume":this.options[b]=a.extend({},this.options[b],c),this.status.noVolume=this._uaBlocklist(this.options.noVolume),this._updateVolume(),this._updateMute();break;case"emulateHtml":this.options[b]!==c&&(this.options[b]=c,c?this._emulateHtmlBridge():this._destroyHtmlBridge());break;case"timeFormat":this.options[b]=a.extend({},this.options[b],c);break;case"keyEnabled":this.options[b]=c,c||this!==a.jPlayer.focus||(a.jPlayer.focus=null);break;case"keyBindings":this.options[b]=a.extend(!0,{},this.options[b],c);break;case"audioFullScreen":this.options[b]=c;break;case"autoBlur":this.options[b]=c}return this},_refreshSize:function(){this._setSize(),this._addUiClass(),this._updateSize(),this._updateButtons(),this._updateAutohide(),this._trigger(a.jPlayer.event.resize)},_setSize:function(){this.options.fullWindow?(this.status.width=this.options.sizeFull.width,this.status.height=this.options.sizeFull.height,this.status.cssClass=this.options.sizeFull.cssClass):(this.status.width=this.options.size.width,this.status.height=this.options.size.height,this.status.cssClass=this.options.size.cssClass),this.element.css({width:this.status.width,height:this.status.height})},_addUiClass:function(){this.ancestorJq.length&&this.ancestorJq.addClass(this.status.cssClass)},_removeUiClass:function(){this.ancestorJq.length&&this.ancestorJq.removeClass(this.status.cssClass)},_updateSize:function(){this.internal.poster.jq.css({width:this.status.width,height:this.status.height}),!this.status.waitForPlay&&this.html.active&&this.status.video||this.html.video.available&&this.html.used&&this.status.nativeVideoControls?this.internal.video.jq.css({width:this.status.width,height:this.status.height}):!this.status.waitForPlay&&this.flash.active&&this.status.video&&this.internal.flash.jq.css({width:this.status.width,height:this.status.height})},_updateAutohide:function(){var a=this,b="mousemove.jPlayer",c=".jPlayerAutohide",d=b+c,e=function(b){var c,d,e=!1;"undefined"!=typeof a.internal.mouse?(c=a.internal.mouse.x-b.pageX,d=a.internal.mouse.y-b.pageY,e=Math.floor(c)>0||Math.floor(d)>0):e=!0,a.internal.mouse={x:b.pageX,y:b.pageY},e&&a.css.jq.gui.fadeIn(a.options.autohide.fadeIn,function(){clearTimeout(a.internal.autohideId),a.internal.autohideId=setTimeout(function(){a.css.jq.gui.fadeOut(a.options.autohide.fadeOut)},a.options.autohide.hold)})};this.css.jq.gui.length&&(this.css.jq.gui.stop(!0,!0),clearTimeout(this.internal.autohideId),delete this.internal.mouse,this.element.unbind(c),this.css.jq.gui.unbind(c),this.status.nativeVideoControls?this.css.jq.gui.hide():this.options.fullWindow&&this.options.autohide.full||!this.options.fullWindow&&this.options.autohide.restored?(this.element.bind(d,e),this.css.jq.gui.bind(d,e),this.css.jq.gui.hide()):this.css.jq.gui.show())},fullScreen:function(a){var b="object"==typeof a;b&&this.options.useStateClassSkin&&this.options.fullScreen?this._setOption("fullScreen",!1):this._setOption("fullScreen",!0)},restoreScreen:function(){this._setOption("fullScreen",!1)},_fullscreenAddEventListeners:function(){var b=this,c=a.jPlayer.nativeFeatures.fullscreen;c.api.fullscreenEnabled&&c.event.fullscreenchange&&("function"!=typeof this.internal.fullscreenchangeHandler&&(this.internal.fullscreenchangeHandler=function(){b._fullscreenchange()}),document.addEventListener(c.event.fullscreenchange,this.internal.fullscreenchangeHandler,!1))},_fullscreenRemoveEventListeners:function(){var b=a.jPlayer.nativeFeatures.fullscreen;this.internal.fullscreenchangeHandler&&document.removeEventListener(b.event.fullscreenchange,this.internal.fullscreenchangeHandler,!1)},_fullscreenchange:function(){this.options.fullScreen&&!a.jPlayer.nativeFeatures.fullscreen.api.fullscreenElement()&&this._setOption("fullScreen",!1)},_requestFullscreen:function(){var b=this.ancestorJq.length?this.ancestorJq[0]:this.element[0],c=a.jPlayer.nativeFeatures.fullscreen;c.used.webkitVideo&&(b=this.htmlElement.video),c.api.fullscreenEnabled&&c.api.requestFullscreen(b)},_exitFullscreen:function(){var b,c=a.jPlayer.nativeFeatures.fullscreen;c.used.webkitVideo&&(b=this.htmlElement.video),c.api.fullscreenEnabled&&c.api.exitFullscreen(b)},_html_initMedia:function(b){var c=a(this.htmlElement.media).empty();a.each(b.track||[],function(a,b){var d=document.createElement("track");d.setAttribute("kind",b.kind?b.kind:""),d.setAttribute("src",b.src?b.src:""),d.setAttribute("srclang",b.srclang?b.srclang:""),d.setAttribute("label",b.label?b.label:""),b.def&&d.setAttribute("default",b.def),c.append(d)}),this.htmlElement.media.src=this.status.src,"none"!==this.options.preload&&this._html_load(),this._trigger(a.jPlayer.event.timeupdate)},_html_setFormat:function(b){var c=this;a.each(this.formats,function(a,d){return c.html.support[d]&&b[d]?(c.status.src=b[d],c.status.format[d]=!0,c.status.formatType=d,!1):void 0})},_html_setAudio:function(a){this._html_setFormat(a),this.htmlElement.media=this.htmlElement.audio,this._html_initMedia(a)},_html_setVideo:function(a){this._html_setFormat(a),this.status.nativeVideoControls&&(this.htmlElement.video.poster=this._validString(a.poster)?a.poster:""),this.htmlElement.media=this.htmlElement.video,this._html_initMedia(a)},_html_resetMedia:function(){this.htmlElement.media&&(this.htmlElement.media.id!==this.internal.video.id||this.status.nativeVideoControls||this.internal.video.jq.css({width:"0px",height:"0px"}),this.htmlElement.media.pause())},_html_clearMedia:function(){this.htmlElement.media&&(this.htmlElement.media.src="about:blank",this.htmlElement.media.load())},_html_load:function(){this.status.waitForLoad&&(this.status.waitForLoad=!1,this.htmlElement.media.load()),clearTimeout(this.internal.htmlDlyCmdId)},_html_play:function(a){var b=this,c=this.htmlElement.media;if(this.androidFix.pause=!1,this._html_load(),this.androidFix.setMedia)this.androidFix.play=!0,this.androidFix.time=a;else if(isNaN(a))c.play();else{this.internal.cmdsIgnored&&c.play();try{if(c.seekable&&!("object"==typeof c.seekable&&c.seekable.length>0))throw 1;c.currentTime=a,c.play()}catch(d){return void(this.internal.htmlDlyCmdId=setTimeout(function(){b.play(a)},250))}}this._html_checkWaitForPlay()},_html_pause:function(a){var b=this,c=this.htmlElement.media;if(this.androidFix.play=!1,a>0?this._html_load():clearTimeout(this.internal.htmlDlyCmdId),c.pause(),this.androidFix.setMedia)this.androidFix.pause=!0,this.androidFix.time=a;else if(!isNaN(a))try{if(c.seekable&&!("object"==typeof c.seekable&&c.seekable.length>0))throw 1;c.currentTime=a}catch(d){return void(this.internal.htmlDlyCmdId=setTimeout(function(){b.pause(a)},250))}a>0&&this._html_checkWaitForPlay()},_html_playHead:function(a){var b=this,c=this.htmlElement.media;this._html_load();try{if("object"==typeof c.seekable&&c.seekable.length>0)c.currentTime=a*c.seekable.end(c.seekable.length-1)/100;else{if(!(c.duration>0)||isNaN(c.duration))throw"e";c.currentTime=a*c.duration/100}}catch(d){return void(this.internal.htmlDlyCmdId=setTimeout(function(){b.playHead(a)},250))}this.status.waitForLoad||this._html_checkWaitForPlay()},_html_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1,this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),this.status.video&&(this.internal.poster.jq.hide(),this.internal.video.jq.css({width:this.status.width,height:this.status.height})))},_html_setProperty:function(a,b){this.html.audio.available&&(this.htmlElement.audio[a]=b),this.html.video.available&&(this.htmlElement.video[a]=b)},_aurora_setAudio:function(b){var c=this;a.each(this.formats,function(a,d){return c.aurora.support[d]&&b[d]?(c.status.src=b[d],c.status.format[d]=!0,c.status.formatType=d,!1):void 0}),this.aurora.player=new AV.Player.fromURL(this.status.src),this._addAuroraEventListeners(this.aurora.player,this.aurora),"auto"===this.options.preload&&(this._aurora_load(),this.status.waitForLoad=!1)},_aurora_resetMedia:function(){this.aurora.player&&this.aurora.player.stop()},_aurora_clearMedia:function(){},_aurora_load:function(){this.status.waitForLoad&&(this.status.waitForLoad=!1,this.aurora.player.preload())},_aurora_play:function(b){this.status.waitForLoad||isNaN(b)||this.aurora.player.seek(b),this.aurora.player.playing||this.aurora.player.play(),this.status.waitForLoad=!1,this._aurora_checkWaitForPlay(),this._updateButtons(!0),this._trigger(a.jPlayer.event.play)},_aurora_pause:function(b){isNaN(b)||this.aurora.player.seek(1e3*b),this.aurora.player.pause(),b>0&&this._aurora_checkWaitForPlay(),this._updateButtons(!1),this._trigger(a.jPlayer.event.pause)},_aurora_playHead:function(a){this.aurora.player.duration>0&&this.aurora.player.seek(a*this.aurora.player.duration/100),this.status.waitForLoad||this._aurora_checkWaitForPlay()},_aurora_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1)},_aurora_volume:function(a){this.aurora.player.volume=100*a},_aurora_mute:function(a){a?(this.aurora.properties.lastvolume=this.aurora.player.volume,this.aurora.player.volume=0):this.aurora.player.volume=this.aurora.properties.lastvolume,this.aurora.properties.muted=a},_flash_setAudio:function(b){var c=this;try{a.each(this.formats,function(a,d){if(c.flash.support[d]&&b[d]){switch(d){case"m4a":case"fla":c._getMovie().fl_setAudio_m4a(b[d]);break;case"mp3":c._getMovie().fl_setAudio_mp3(b[d]);break;case"rtmpa":c._getMovie().fl_setAudio_rtmp(b[d])}return c.status.src=b[d],c.status.format[d]=!0,c.status.formatType=d,!1}}),"auto"===this.options.preload&&(this._flash_load(),this.status.waitForLoad=!1)}catch(d){this._flashError(d)}},_flash_setVideo:function(b){var c=this;try{a.each(this.formats,function(a,d){if(c.flash.support[d]&&b[d]){switch(d){case"m4v":case"flv":c._getMovie().fl_setVideo_m4v(b[d]);break;case"rtmpv":c._getMovie().fl_setVideo_rtmp(b[d])}return c.status.src=b[d],c.status.format[d]=!0,c.status.formatType=d,!1}}),"auto"===this.options.preload&&(this._flash_load(),this.status.waitForLoad=!1)}catch(d){this._flashError(d)}},_flash_resetMedia:function(){this.internal.flash.jq.css({width:"0px",height:"0px"}),this._flash_pause(0/0)},_flash_clearMedia:function(){try{this._getMovie().fl_clearMedia()}catch(a){this._flashError(a)}},_flash_load:function(){try{this._getMovie().fl_load()}catch(a){this._flashError(a)}this.status.waitForLoad=!1},_flash_play:function(a){try{this._getMovie().fl_play(a)}catch(b){this._flashError(b)}this.status.waitForLoad=!1,this._flash_checkWaitForPlay()},_flash_pause:function(a){try{this._getMovie().fl_pause(a)}catch(b){this._flashError(b)}a>0&&(this.status.waitForLoad=!1,this._flash_checkWaitForPlay())},_flash_playHead:function(a){try{this._getMovie().fl_play_head(a)}catch(b){this._flashError(b)}this.status.waitForLoad||this._flash_checkWaitForPlay()},_flash_checkWaitForPlay:function(){this.status.waitForPlay&&(this.status.waitForPlay=!1,this.css.jq.videoPlay.length&&this.css.jq.videoPlay.hide(),this.status.video&&(this.internal.poster.jq.hide(),this.internal.flash.jq.css({width:this.status.width,height:this.status.height})))},_flash_volume:function(a){try{this._getMovie().fl_volume(a)}catch(b){this._flashError(b)}},_flash_mute:function(a){try{this._getMovie().fl_mute(a)}catch(b){this._flashError(b)}},_getMovie:function(){return document[this.internal.flash.id]},_getFlashPluginVersion:function(){var a,b=0;if(window.ActiveXObject)try{if(a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")){var c=a.GetVariable("$version");c&&(c=c.split(" ")[1].split(","),b=parseInt(c[0],10)+"."+parseInt(c[1],10))}}catch(d){}else navigator.plugins&&navigator.mimeTypes.length>0&&(a=navigator.plugins["Shockwave Flash"],a&&(b=navigator.plugins["Shockwave Flash"].description.replace(/.*\s(\d+\.\d+).*/,"$1")));return 1*b},_checkForFlash:function(a){var b=!1;return this._getFlashPluginVersion()>=a&&(b=!0),b},_validString:function(a){return a&&"string"==typeof a},_limitValue:function(a,b,c){return b>a?b:a>c?c:a},_urlNotSetError:function(b){this._error({type:a.jPlayer.error.URL_NOT_SET,context:b,message:a.jPlayer.errorMsg.URL_NOT_SET,hint:a.jPlayer.errorHint.URL_NOT_SET})},_flashError:function(b){var c;c=this.internal.ready?"FLASH_DISABLED":"FLASH",this._error({type:a.jPlayer.error[c],context:this.internal.flash.swf,message:a.jPlayer.errorMsg[c]+b.message,hint:a.jPlayer.errorHint[c]}),this.internal.flash.jq.css({width:"1px",height:"1px"})},_error:function(b){this._trigger(a.jPlayer.event.error,b),this.options.errorAlerts&&this._alert("Error!"+(b.message?"\n"+b.message:"")+(b.hint?"\n"+b.hint:"")+"\nContext: "+b.context)},_warning:function(c){this._trigger(a.jPlayer.event.warning,b,c),this.options.warningAlerts&&this._alert("Warning!"+(c.message?"\n"+c.message:"")+(c.hint?"\n"+c.hint:"")+"\nContext: "+c.context)},_alert:function(a){var b="jPlayer "+this.version.script+" : id='"+this.internal.self.id+"' : "+a;this.options.consoleAlerts?window.console&&window.console.log&&window.console.log(b):alert(b)},_emulateHtmlBridge:function(){var b=this;a.each(a.jPlayer.emulateMethods.split(/\s+/g),function(a,c){b.internal.domNode[c]=function(a){b[c](a)}}),a.each(a.jPlayer.event,function(c,d){var e=!0;a.each(a.jPlayer.reservedEvent.split(/\s+/g),function(a,b){return b===c?(e=!1,!1):void 0}),e&&b.element.bind(d+".jPlayer.jPlayerHtml",function(){b._emulateHtmlUpdate();var a=document.createEvent("Event");a.initEvent(c,!1,!0),b.internal.domNode.dispatchEvent(a)})})},_emulateHtmlUpdate:function(){var b=this;a.each(a.jPlayer.emulateStatus.split(/\s+/g),function(a,c){b.internal.domNode[c]=b.status[c]}),a.each(a.jPlayer.emulateOptions.split(/\s+/g),function(a,c){b.internal.domNode[c]=b.options[c]})},_destroyHtmlBridge:function(){var b=this;this.element.unbind(".jPlayerHtml");var c=a.jPlayer.emulateMethods+" "+a.jPlayer.emulateStatus+" "+a.jPlayer.emulateOptions;a.each(c.split(/\s+/g),function(a,c){delete b.internal.domNode[c]})}},a.jPlayer.error={FLASH:"e_flash",FLASH_DISABLED:"e_flash_disabled",NO_SOLUTION:"e_no_solution",NO_SUPPORT:"e_no_support",URL:"e_url",URL_NOT_SET:"e_url_not_set",VERSION:"e_version"},a.jPlayer.errorMsg={FLASH:"jPlayer's Flash fallback is not configured correctly, or a command was issued before the jPlayer Ready event. Details: ",FLASH_DISABLED:"jPlayer's Flash fallback has been disabled by the browser due to the CSS rules you have used. Details: ",NO_SOLUTION:"No solution can be found by jPlayer in this browser. Neither HTML nor Flash can be used.",NO_SUPPORT:"It is not possible to play any media format provided in setMedia() on this browser using your current options.",URL:"Media URL could not be loaded.",URL_NOT_SET:"Attempt to issue media playback commands, while no media url is set.",VERSION:"jPlayer "+a.jPlayer.prototype.version.script+" needs Jplayer.swf version "+a.jPlayer.prototype.version.needFlash+" but found "},a.jPlayer.errorHint={FLASH:"Check your swfPath option and that Jplayer.swf is there.",FLASH_DISABLED:"Check that you have not display:none; the jPlayer entity or any ancestor.",NO_SOLUTION:"Review the jPlayer options: support and supplied.",NO_SUPPORT:"Video or audio formats defined in the supplied option are missing.",URL:"Check media URL is valid.",URL_NOT_SET:"Use setMedia() to set the media URL.",VERSION:"Update jPlayer files."},a.jPlayer.warning={CSS_SELECTOR_COUNT:"e_css_selector_count",CSS_SELECTOR_METHOD:"e_css_selector_method",CSS_SELECTOR_STRING:"e_css_selector_string",OPTION_KEY:"e_option_key"},a.jPlayer.warningMsg={CSS_SELECTOR_COUNT:"The number of css selectors found did not equal one: ",CSS_SELECTOR_METHOD:"The methodName given in jPlayer('cssSelector') is not a valid jPlayer method.",CSS_SELECTOR_STRING:"The methodCssSelector given in jPlayer('cssSelector') is not a String or is empty.",OPTION_KEY:"The option requested in jPlayer('option') is undefined."},a.jPlayer.warningHint={CSS_SELECTOR_COUNT:"Check your css selector and the ancestor.",CSS_SELECTOR_METHOD:"Check your method name.",CSS_SELECTOR_STRING:"Check your css selector is a string.",OPTION_KEY:"Check your option name."}});$(document).ready( function () {

    if ($('#formcomponentform').length < 1) {
        return;
    }

    $('#disclaimerClose').on('click', function() {
       magicDisclaimerLayer();
    });

    // [SK] Formular nur initialisieren, wenn kein DyLo Formular auf der Seite ist.
    // In diesem Fall wird die Initialisierung innerhalb der vendor/noxum/scripts/dylo/custom.js vorgenommen.
    if ($("#formdyloeventreceiver").length == 0) {
        initForm();
        $('.Required > label').each(function () { jQuery(this).text(jQuery(this).text() + ' *'); });
    }

    var $dropDowns = $('.b-form-wrapper select');
    $dropDowns.each(function (i, elem) {
        if ($('#sal').find('option:selected')) {
            $('#sal').attr('selected', 'selected');
        }
    });
    // dynamic DDs
    SelectMake();
    SelectPorscheCar();
    cleardd('dmodelyear');

    $('.helpInfo').mouseover(function () {
        var fieldId = $(this).attr("for");
        $('#' + fieldId + '-help').show();
        $(this).parent().children('.helpText').show();
    });

    $('.helpInfo').mouseout(function () {
        var fieldId = $(this).attr("for");
        $('#' + fieldId + '-help').hide();
        $(this).parent().children('.helpText').hide();
    });
    if ($('#datasaveX_1').is(':checked') == false && $('#datasaveX_2').is(':checked') == false) {
        $('#datasave_1').attr('checked', false);
        $('#datasave_2').attr('checked', false);
    }
    if ($('#datasave_1').is(':checked') == true && $('#datasaveX_1').is(':checked') == false) {
        $('#datasave_1').attr('checked', true);
    }
    if ($('#datasave_2').is(':checked') == true && $('#datasaveX_2').is(':checked') == false) {
        $('#datasave_2').attr('checked', true);
    }

    if ($('#hideallowusagephone').val() == "true")
        $('#allowusagephone_1').attr('checked', true);
    else
        $('#allowusagephone_1').attr('checked', false);

    if ($('#hideallowusagemail').val() == "true")
        $('#allowusagemail_1').attr('checked', true);
    else
        $('#allowusagemail_1').attr('checked', false);
	
	$("label").click(function(){
	  if($(this).siblings().attr('type')=='radio' && $(this).parents().eq(1).hasClass('singleRadioCheckbox')){
		inputId = "#"+$("#" + $(this).attr('for')).attr('id');
		if($(inputId).attr('checked')==undefined){
		   $(inputId).attr('checked', 'checked');
		   $(inputId).attr('value', '1');
		   $(this).addClass('isChecked');
		}else{
		   $(inputId).removeAttr('checked');
		   $(inputId).attr('value', '0');
		   $(this).removeClass('isChecked');
		}
	  }
	});
	
	if($('.radiolist.singleRadioCheckbox').size() > 0){
		radioDivContainer = $('.radiolist.singleRadioCheckbox div.radio');
		radioDivContainer.each(function() {
		   $(this).addClass("checkbox");
		   $(this).removeClass("radio");
		});
	}
	
	if($('.autofillpurchaseintention select#car_wantbuymonth').size() > 0 && $('.autofillpurchaseintention select#car_wantbuyyear').size() > 0){
		now = new Date();
		month = now.getMonth();
		year = now.getFullYear();
		
		if($('#car_wantbuymonth option:nth-child(1)').attr('value') == "")
		{
			month++;
		}
		
		if(month == 11){
			month = 1;
			year += 1 
		}
		if(month < 10){
			month = "0"+month;
		}
		$('#car_wantbuyyear option, #car_wantbuymonth option').removeAttr('class selected')
		$("select#car_wantbuyyear option[value="+year+"]").attr('selected','selected');
		$("select#car_wantbuymonth option[value="+month+"]").attr('selected','selected');
	}
});
$( window ).load(function() {
	if(location.pathname.indexOf("central-eastern-europe") > -1){
		/*keep state of chosen model on error -> PCEE*/		
		$("select#make").change(
			function(){			
				setMakeModelCookie("none");	
			}
		);		

		$("select#model").change(
			function(){
				$("select#model option").removeAttr("class");
				$("option[value='"+this.value+"']").addClass("selected");
				setMakeModelCookie(this.value);
			}
		);
		
		function setMakeModelCookie(value){
			var now = new Date();
			now.setTime(now.getTime() + 1 * 3600 * 1000);
			document.cookie = "makemodel="+value+"; expires=" + now.toUTCString() + "; path=/";
		}
		
		function getCookie(name) {
			var value = "; " + document.cookie;
			var parts = value.split("; " + name + "=");
			if (parts.length == 2) return parts.pop().split(";").shift();
		}
		
		if (typeof $("#model option[value='" + getCookie("makemodel") + "']").val() !== 'undefined') {
			$("option[value='"+getCookie("makemodel")+"']").addClass("selected");
			$('#s2id_model .select2-chosen').text($('#model option[value=' + getCookie('makemodel') + ']').text());
		}	
	}
});

function initForm() {
    // ZENFO Update
    if ($('.b-form-wrapper #formcomponentform, .b-form-wrapper #formcomponentform2').length > 0) {
        $('.b-form-wrapper #formcomponentform input[type=text], .b-form-wrapper #formcomponentform input[type=password]').addClass('gui-form-text-input');
        $('.b-form-wrapper #formcomponentform2 input[type=text], .b-form-wrapper #formcomponentform2 input[type=password]').addClass('gui-form-text-input');
        $('.b-form-wrapper #formcomponentform select, .b-form-wrapper #formcomponentform2 select').addClass('gui-form-select');
        if ($('.b-form-wrapper #formcomponentform .container .birthday, .b-form-wrapper #formcomponentform2 .container .birthday').length > 0) {
            $('.b-form-wrapper #formcomponentform .container .birthday, .b-form-wrapper #formcomponentform2 .container .birthday').parent().parent().addClass('c-birthday');
        }
        // form: clear inline styling
        $('.b-form-wrapper #formcomponentform group, .b-form-wrapper #formcomponentform2 group').attr('style', '');
        // form: if layout-X class is not present: set it to 3
        if ($('.b-form-wrapper #formcomponentform, .b-form-wrapper #formcomponentform2').attr('class').indexOf('layout-') === -1) {
            $('.b-form-wrapper #formcomponentform, .b-form-wrapper #formcomponentform2').addClass('layout-3');
        }
        // radio: if colX class is not present set it to 4
        $('.b-form-wrapper #formcomponentform .radiolist > .radio, .b-form-wrapper #formcomponentform2 .radiolist > .radio').each(function () {
            if ($(this).attr('class').indexOf('cols') === -1) {
                $(this).addClass('cols4');
            }
        });
        // simple tooltip
        $('.b-form-wrapper #formcomponentform .helpInfo, .b-form-wrapper #formcomponentform2 .helpInfo').hover(
            function () { $(this).parent().addClass('showTooltip'); },
            function () { $(this).parent().removeClass('showTooltip'); }
        );
        // checkbox/radio: click handling
        $('.b-form-wrapper #formcomponentform .checkbox > label, .b-form-wrapper #formcomponentform2 .checkbox > label, .b-form-wrapper #formcomponentform .radio > label, .b-form-wrapper #formcomponentform2 .radio > label').each(function () {
            if ($('#' + $(this).attr('for')).is(':checked')) {
                $(this).addClass('isChecked');
            }
            $(this).attr('title', $(this).text());
            // radio
            if ($(this).parent().hasClass('radio')) {
                $(this).on('click', function () {
                    var checked = $(this).hasClass('isChecked');
                    // continue if clicked radio is unchecked
                    if (checked === false) {
                        // only one may be active: uncheck all in this group and check/uncheck current one
                        $(this).parent().parent().find('.radio > input[type=radio]').checked = false; // uncheck all radio buttons
                        $(this).parent().parent().find('.radio > label').removeClass('isChecked');    // remove isChecked fomr all labels
                        // check radio
                        $(this).addClass('isChecked');
                        $(this).parent().find('input[type=radio]').checked = true; // uncheck all radio buttons
                    }
                });
            }
            // checkboxes
            else if ($(this).parent().hasClass('checkbox')) {
                $(this).on('click', function () {
                    // only needs to toggle state
                    $(this).toggleClass('isChecked');
                });
            }
        });
    }
    else {
        // [SK] - 2013-11-04 - forms
        //$('div[data-legacy-id="page"]').addClass('nonavi page');
        $('body').attr("style", "");
        $('.b-page-wrapper').css({"margin-top": "-12px"});

    }
}

function submitForm(action, form) {
    if (!form)
        form = 'formcomponentform';
    if (action == "reset") {
        if ($('#' + form).length > 0) {
            document.forms[form].reset();
        }
        return false;
    }
    else {
        if ($('#' + form).length > 0) {
			
			if(!!$('#formstep_status').length) {
				$('#formstep_status').parent().remove();
			}
            $('#' + form).append('<div><input id="formstep_status" type="hidden" name="' + action + '" value="' + action + '" /></div>');
        }
        else {
            return false;
        }

        $('#' + form).submit();
        return true;
    }
}

var evaluation1 = (compareValidator('adresstype', 'adresstype-error-idnxpspagformcomponentvalidatorcebfcecdacfdceelanguagenonepoolgermany', this.value, 'business', 'equals', null));
actionsByID('fbfirma, fbstrasse, fbno, fbplz, fbort, fbLand', 'fpstrasse,fpno,fpplz,fport,fpland', evaluation1);

function fakeCheckPassword() {
    compareValidator('password1', 'adresstype-error-idnxpspagformcomponentvalidatorcebfcecdacfdceelanguagenonepoolgermany', this.va, 'business', 'equals', null);
}

function hideServerErrors() {
    $('.serverErrorText').hide();
}

function copyVal(sourceId, targetId)
{
    jQuery('#' + targetId).val(jQuery('#' + sourceId).val());
}

function copySelected(sourceId, targetId) {
    jQuery('#' + targetId).val(jQuery('#' + sourceId).val()).trigger("change");   
}
function actionsByID(idListEnable, idListDisable, evaluation) {
    //alert('actionsByID en:'+ idListEnable + ' dis:' + idListDisable + ' eval:' + evaluation);

    var tmpEnable = '';
    var tmpDisable = '';

    if (idListEnable != '') {
        tmpEnable = '#' + idListEnable.replace(/ /g, '').replace(/\,/g, ',#');
    }
    if (idListDisable != '') {
        tmpDisable = '#' + idListDisable.replace(/ /g, '').replace(/\,/g, ',#');
    }

//    log(tmpEnable);
//    log(tmpDisable);
//    log(evaluation);

    // schaaaadeee!!! jQuery(tmp1 + ',' + tmp2).toggleClass('Disabled');

    if (evaluation == true) {
        if (jQuery(tmpEnable).hasClass('Disabled')) {
            jQuery(tmpEnable).removeClass('Disabled');
        }
        if (!jQuery(tmpDisable).hasClass('Disabled')) {
            jQuery(tmpDisable).addClass('Disabled');
        }
    }
    else {
        if (!jQuery(tmpEnable).hasClass('Disabled')) {
            jQuery(tmpEnable).addClass('Disabled');
        }
        if (jQuery(tmpDisable).hasClass('Disabled')) {
            jQuery(tmpDisable).removeClass('Disabled');
        }
    }
}

// var evaluation1 = (regexValidator('contactdealer', 'contactdealer-error-idnxpspagformcomponentvalidatorisCheckedlanguagenonepoolroot', this.value, /(.)*/) ); actionsByID('rdealer', 'dealer', evaluation1); 

function regexValidator(feldid, errorid, value, regexPattern) {

    var rValue = false;

    if (regexPattern.test(value)) {
        rValue = true;
    } else {
        rValue = false;
    }

    if (rValue == true) {
        if (!jQuery('#' + feldid).hasClass('validationSuccess')) {
            jQuery('#' + feldid).addClass('validationSuccess');
        }
        if (jQuery('#' + feldid).hasClass('validationFail')) {
            jQuery('#' + feldid).removeClass('validationFail');
        }
        if (jQuery('#lbl' + feldid).hasClass('error')) {
            jQuery('#lbl' + feldid).removeClass('error');
        }
        $('#' + errorid).hide();
    }
    else {
        if (jQuery('#' + feldid).hasClass('validationSuccess')) {
            jQuery('#' + feldid).removeClass('validationSuccess');
        }
        if (!jQuery('#' + feldid).hasClass('validationFail')) {
            jQuery('#' + feldid).addClass('validationFail');
        }
        if (!jQuery('#lbl' + feldid).hasClass('error')) {
            jQuery('#lbl' + feldid).addClass('error');
        }
        $('#' + errorid).show();
    }

    return rValue;
}


//zenfo test zeug darf dann bald




function compareValidator(feldid, errorid, value1, value2, operator, datatype) {
    var rValue = false;
	    
    switch (operator) {

        case "greaterthan":
            if (value1 > value2) rValue = true; break;
        case "greaterequals":
            if (value1 >= value2) rValue = true; break;
        case "equals":
            if (value1 == value2) rValue = true; break;
        case "equalsnot":
            if (value1 != value2) rValue = true; break;
        case "smallerequals":
            if (value1 < value2) rValue = true; break;
        case "smallerthan":
            if (value1 <= value2) rValue = true; break;

    } 

    return rValue;
    //           if (rValue == false) {
    //               $('#' + errorid).show();
    //               $('#lbl' + feldid).addClass('error');

    //           }

}

function magicDisclaimerLayerReset() {
//    if ($('#datasave_1').attr('checked') == true) {
//        dialogOpenOverlay('mainprivacy');
//        $('#mainprivacy').removeClass('hidden');
//    }
//    else {
//        $('#datasaveX_1').attr('checked', false);
//        $('#datasaveX_2').attr('checked', true);
    //    }

    if ($('#datasave_1').is(':checked') == true) {
        $('#mainprivacy').show();
        $('#mainprivacy').removeClass('hidden');
        $('#datasaveX_1').attr('checked', false);
        $('#datasaveX_2').attr('checked', false);
    }
    else {
        $('#datasaveX_1').attr('checked', true);
        $('#datasaveX_2').attr('checked', false);
        if (!$('#mainprivacy').hasClass('hidden')) {
            $('#mainprivacy').addClass('hidden');
            $('#mainprivacy').hide();
        }
    }
}

function TeilnahmeLayer(fieldID) {
   
    // wenn nicht einverstanden
    if ($('#datasaveX_1').is(':checked') == true) {
        $('#teilnahmebedingung_1').attr('checked', false);
    }
    //wenn einverstanden
    else {
        $('#teilnahmebedingung_1').attr('checked', true);
    }
    dialogCloseOverlay(fieldID);
}


function magicDisclaimerLayerResetMobil() {
  if ($('#datasave_1').is(':checked') == true) {
    $('#mainprivacy').show();
    $('#mainprivacy').removeClass('hidden');
    $('#datasaveX_1').attr('checked', false);
    $('#datasaveX_2').attr('checked', false);
  }
  else {
    $('#datasaveX_1').attr('checked', true);
    $('#datasaveX_2').attr('checked', false);
    if(!$('#mainprivacy').hasClass('hidden'))
    {
      $('#mainprivacy').addClass('hidden');
      $('#mainprivacy').hide();
    }
  }
}

function openDisclaimerIAA() {
    $('#datasaveX_1').attr('checked', false);
    $('#datasaveX_2').attr('checked', false);
    $('#allowusagephone_1').attr('checked', false);
    $('#allowusagemail_1').attr('checked', false);
    $('#allowusagmail_1').attr('checked', false);
//    log("$('#datasave_1').attr('checked') : " + $('#datasave_1').attr('checked'));
    if ($('#datasave_1').attr('checked') == true) {
        dialogOpenOverlay('mainprivacy');
    }
    else {
        $('#datasaveX_1').attr('checked', false);
        $('#datasaveX_2').attr('checked', true);
    }
}

function dialogOpenOverlay(fieldID) {
   
        if ($('#overlayTest').length < 1) {
            jQuery("#formcomponentform").prepend("<div id='overlayTest' class='dialogBG'></div>");
        }
        if ($('#' + fieldID).length < 1) {
            return;
        }
        // magicDisclaimerLayerReset();
        $("html").css("overflow-y", "hidden");
        if (($.browser.msie == true) && ($.browser.version < 7.0)) {
            $(window).scrollTop(0);
        }
        $('#overlayTest').css({ 'z-index': '2000' });
        $('#' + fieldID).css({ 'z-index': '2001' });
        jQuery("#formcomponentform").append($('#' + fieldID));
        $('#overlayTest, #' + fieldID).show();
        //            $('#overlayTest').click(function () {
        //                dialogCloseOverlay(fieldID);
        //            });
  
}
function dialogCloseOverlay(fieldID) {
    $('#overlayTest, #' + fieldID).hide();
    $("html").css("overflow-y", "scroll");
    //            magicDisclaimerLayer();
}
function openValueLink(link, target)
{ 
  target = typeof target !== 'undefined' ? "_self" : "_blank";
  var valueOfOption = $(link).find('option:selected')[0].value;
    if(!!valueOfOption) {
      window.open(valueOfOption, target);
    } 
}


//changed function for switched dataprotection Buttons in PS5 ID: "webspecial_registration_right"
//with extra CSS class "dataprotection-switched"
function magicDisclaimerLayer() {

   if($('.dataprotection-switched').length){
       if ($('#datasaveX_1').is(':checked') == true) {
           $('#datasave_2').attr('checked', false);
           $('#datasave_1').attr('checked', true);
       }
       if ($('#datasaveX_2').is(':checked') == true) {
           $('#datasave_2').attr('checked', true);
           $('#datasave_1').attr('checked', false);
           $('#allowusagephone_1').attr('checked', false);
           $('#allowusagemail_1').attr('checked', false);
           $('#hideallowusagephone').val("false");
           $('#hideallowusagemail').val("false");
       }
       $('#mainprivacy').addClass('hidden');
       dialogCloseOverlay('mainprivacy');
   }else{
       if ($('#datasaveX_1').is(':checked') == true) {
           $('#datasave_2').attr('checked', true);
           $('#datasave_1').attr('checked', false);
           $('#allowusagephone_1').attr('checked', false);
           $('#allowusagemail_1').attr('checked', false);
           $('#hideallowusagephone').val("false");
           $('#hideallowusagemail').val("false");
       }
       if ($('#datasaveX_2').is(':checked') == true) {
           $('#datasave_2').attr('checked', false);
           $('#datasave_1').attr('checked', true);
       }
       $('#mainprivacy').addClass('hidden');
       dialogCloseOverlay('mainprivacy');
   }

}



function SelectPorscheCar() {
    if ($('#car_modelinterest').length == 0) {
        return;
    }
    var selPorsche1 = $('#modelinterest1').val();
    var selPorsche2 = $('#modelinterest2').val();
    var selMake = $('#car_modelinterest').val();

    // DDs leeren
    $('#formcomponentform #modelinterest1 option, #formcomponentform #modelinterest2 option').remove();
    $('#formcomponentform #modelinterest1 optgroup, #formcomponentform #modelinterest2 optgroup').remove();
    //alle betroffenen options in das eigentliche DD kopieren
    $("<option/>").val("").text("- - -").appendTo("#formcomponentform #modelinterest1");
    $("<option/>").val("").text("- - -").appendTo("#formcomponentform #modelinterest2");
    if (selMake.indexOf('6') > -1) {
        $('#tempporschemodel optgroup').clone().appendTo('#formcomponentform #modelinterest1');
        $('#tempporschemodel optgroup').clone().appendTo('#formcomponentform #modelinterest2');
    }
    else if (selMake != '') {
        $('#tempporschemodel optgroup.' + selMake).clone().appendTo('#formcomponentform #modelinterest1');
        $('#tempporschemodel optgroup.' + selMake).clone().appendTo('#formcomponentform #modelinterest2');
    }

    $('#modelinterest1').val(selPorsche1);
    $('#modelinterest2').val(selPorsche2);
}

function cleardd(dropdownId) {
    $('#formcomponentform #' + dropdownId + ' option').remove();
    $('#formcomponentform #' + dropdownId + ' optgroup').remove();
    
}

function dieselcode(country) {
    //Quickwin vermeidet fehlermeldungen
    return;
}

function selectdd(mainDdId,dropdownId) {
    // name des abhaenigen DDs uebergeben; hierfuer muss ein tempDD mit allen options gepflegt werden die abhaenigkeiten werden in Optgroup definiert
    // mainDdId = abhaengkeitserzeugendes DD, dropdownID= abhaengiges DD

    if ($('#'+ dropdownId).length == 0) {
        return;
    }
    var selDdId = $('#' + dropdownId).val();

   
    // das sichtbare DD leeren
    $('#formcomponentform #' + dropdownId + ' option').remove();
    $('#formcomponentform #' + dropdownId + ' optgroup').remove();

    // betroffene option aus dem TEMP DD in das sichtbar DD kopieren
    var selMain = $('#'+mainDdId).val();
   
    $("<option/>").val("").text("---").appendTo("#formcomponentform #"+ dropdownId);
    if (selMain != '') {
        $('#temp-' + dropdownId + ' optgroup.' + selMain).clone().appendTo('#formcomponentform #' + dropdownId);
        $('#formcomponentform #' + dropdownId + ' optgroup').remove();
        //$('#' + dropdownId).children().remove("optgroup");
        $('.b-form-wrapper #' + dropdownId).select2({
            containerCssClass: 'gui-select2-container'
            , dropdownCssClass: 'gui-select2-dropDown'
            , minimumResultsForSearch: -1  // hide the search field
            , width: "100%"
            , placeholder: $(this).find(':selected').text()

        });
    }
    $('#' + dropdownId).val(selDdId);
}



function SelectMake() {
    if ($('#model').length == 0) {
        return;
    }
    var selModel = $('#model').val();
    // das main DD leeren
    $('#formcomponentform #model option').remove();
    $('#formcomponentform #model optgroup').remove();

    //alle betroffenen options in das eigentliche DD kopieren
    var selMake = $('#make').val();

    $("<option/>").val(selMake +"000").text("- - -").appendTo("#formcomponentform #model");
    $("#model select").val(selMake + "000");
    if (selMake != '') {
        $('#tempmodel optgroup.' + selMake +'> option').clone().appendTo('#formcomponentform #model');
        $("#model").children().remove("optgroup");
        $('.b-form-wrapper #model').select2({
            containerCssClass: 'gui-select2-container'
            , dropdownCssClass: 'gui-select2-dropDown'
            , minimumResultsForSearch: -1  // hide the search field
            , width: "100%"
            , placeholder: $(this).find(':selected').text()
            
        });
    }
    
}

function Select_Make() {
    models = car[document.getElementById("make").selectedIndex][1];
    document.getElementById("model").length = 1;
    document.getElementById("model").selectedIndex = 0;
    for (count = 1; count != models.length; count++) {
        newModel = new Option(models[count][0], models[count][0], false, true);
        document.getElementById("model").options[document.getElementById("model").length] = newModel;
    }
    document.getElementById("model").selectedIndex = 0;
}

function SelectModel() {
    models = car[document.forms["formcontrol"].car_make.selectedIndex][1];
    types = models[document.forms["formcontrol"].car_model.selectedIndex][1];
}

function SelectMakeUS() {
    models_us = car_us[document.getElementById("make").selectedIndex][1];
    document.getElementById("model").length = 1;
    document.getElementById("model").selectedIndex = 0;
    for (count = 1; count != models_us.length; count++) {
        newModel = new Option(models_us[count][0], models_us[count][0], false, true);
        document.getElementById("model").options[document.getElementById("model").length] = newModel;
    }
    document.getElementById("model").selectedIndex = 0;
}

function SelectModelUS() {
    models_us = car_us[document.forms["formcontrol"].car_make.selectedIndex][1];
    types_us = models_us[document.forms["formcontrol"].car_model.selectedIndex][1];
}

/* Tracking */
function dialog_click_track(trackingvalue, value, type) {
   
   if (value) {
        try {
            if (type == 1)
                click_track(trackingvalue);

            
        }
        catch (e) {
           
        }
    }
}

 

function setMail() {

    if ($('#allowusagemail_1').is(':checked') == true) {
        $('#hideallowusagemail').val("true");}
        else{
        $('#hideallowusagemail').val("false");
    }
}

function setPhone() {
    if ($('#allowusagephone_1').is(':checked') == true) {
        $('#hideallowusagephone').val("true");
    }
    else {
        $('#hideallowusagephone').val("false");
    }
}

function positionPrivacyCommitmentLayer() {
    if ($('#privacy_commitment_layer').length > 0) {
        $('#privacy_commitment_layer > .privacyCommitment_layerMessageContainer').css({ 'top': $('body').offset().top + 'px' });
    }
}

var actvalue = 0;
var showvalue;

function maxChars(maxVal)
{
    if($('#message').length > 0){
        $('#message').attr('maxlength', maxVal);
        $('#lblmessage').text(($('#lblmessage').text()).replace(/([0-9])+/g, maxVal-$('#message').val().length));
    }
    else if($('#contactmessage').length > 0){
        $('#contactmessage').attr('maxlength', maxVal);
        $('#lblcontactmessage').text(($('#lblcontactmessage').text()).replace(/([0-9])+/g, maxVal-$('#contactmessage').val().length));
    }
    if($('#financerequestremarks').length > 0){
        $('#financerequestremarks').attr('maxlength', maxVal);
        $('#lblfinancerequestremarks').text(($('#lblfinancerequestremarks').text()).replace(/([0-9])+/g, maxVal-$('#financerequestremarks').val().length));
    }	
}

$(function () {
if(!!$('.b-form-wrapper #formcomponentform').length) {
  $('.radiolist.Required .radio').each(function () {
    if(!!$(this).find('label').hasClass('isChecked')) {
      $(this).find('input').click();
    }
    
  });

    // 2016-03-09 [SK] - Quickfix für mit Leerzeichen übermittelte Mailadressen in optout und unsubscribe Forms
    // Mantis 0027268: PCNA/PCL // Opt-Out Formular // Entfernung Leerzeichen
    if (!!$('#emailstandard').length) {
        $('#emailstandard').val($.trim($('#emailstandard').val()));
    }

}
});


$(function () {
// Zenfo_Validator Objekt
var validator_zenfo_register = function () {
  var _length = 0;
  var _value = [];
  var _path = location.pathname;
  var _zenfo_cookie_var = "zenfo_validation=";
  var _zenfo_cookie_value = [];

  var _zenfo_form_id = null;
  var _requirement_achieved = false;
  var _children = [];
  var _reset = function () {
    _children = [];
	_deleteCookie();
  }
  var _add = function (instance) { 
	var _nameArr = instance.dependency_container; 
		_length ++; 
		for (var i = 0; i <_nameArr.length; i ++) {
			_value.push( _nameArr[i] + "_required"); 
		}
		_children.push(instance);
	};
  var _getLength = function () { console.log(_length); };
  var _del = function () { _length--; };
  var _setFlag = function () {
		for (var i = 0; i <_value.length; i++) {
		  var _label = $(_value[i]).find('label');
		  console.log(_label.text());
		  if(_label.text().indexOf('*')>0) {
			_zenfo_cookie_value.push(_value[i]);
			
		  } 
		}
		_zenfo_validation_ok = true;
  };
  
  var _checkCookie = function () {
	if(document.cookie.indexOf(_zenfo_cookie_var) > -1) {
	  $(_value).each(function (i, e) { 
	    var _label = $(e).find('label');
		   _label.text(_label.text().split(' *')[0]);
	  });
	  
	  for(i in document.cookie.split(";")) {
		  if(document.cookie.split(";")[i].indexOf("zenfo_validation") > -1) {
			$(document.cookie.split(";")[i].split("=")[1].split(",")).each(function (i, e) {
				var _label = $(e).find('label');
					_label.text(_label.text() + " *");
			});
		  }
	  }
	}
  };
  
  var _deleteCookie = function () {
	document.cookie = "zenfo_validation=;"
  }
  
  var _setCookie = function () {
    _setFlag();
    document.cookie = _zenfo_cookie_var + _zenfo_cookie_value.toString() + ";";
  };
  
  var _getValue = function () { return _value };
  
  var _setFormId = function (id) {
	_zenfo_form_id = id;
  };
  
  var _plainRequiredfields = function () {
	  
	var cat = {inputText: ".textbox.Required:visible", dropdownSelect: ".selection.Required:visible", checkboxlist: ".checkboxlist.Required:visible", radiolist: ".radiolist.Required:visible"};
	var error = 0;
	
	$(cat.inputText).each(function(i, e) {
		if(!!!$(this).find("input[type='text']").val()) {
			if(!$(this).hasClass('error')) {
				$(this).addClass('error');
			}
			error++;
		}else {
			if($(this).hasClass('error')) {
				$(this).removeClass('error');
				$(this).find("input[type='text']").removeClass('error');
			}
		}
	});
	$(cat.dropdownSelect).each(function(i, e) {
		if($(this).find('select option.selected').val() == "") {
			if(!$(this).hasClass('error')) {
				$(this).addClass('error');
			}
			error++;
		}else {
			if($(this).hasClass('error')) {
				$(this).removeClass('error');
			}
		}
	});
	$(cat.checkboxlist).each(function(i, e) {
		if(!!!$(this).find('label').hasClass('isChecked')) {
			if(!$(this).hasClass('error')) {
				$(this).addClass('error');
			}
			error++;
		}else {
			if($(this).hasClass('error')) {
				$(this).removeClass('error');
			}
		}
	});
	$(cat.radiolist).each(function(i, e) {
		
		if(!!!$(this).find('label.isChecked').length) { 
			if(!$(this).hasClass('error')) {
				$(this).addClass('error');
			}
			error++;
		}else {
			if($(this).hasClass('error')) {
				$(this).removeClass('error');
			}
		}
	});
	
	return error;
  }
  
  var _processing = function () {
	$("#" + _zenfo_form_id).submit(function (e) {
		e.preventDefault();
		var _numOfErrors = 0;
		var _thisForm = this;
		var formstep_status = $('#formstep_status').attr('name');
		_zenfo_cookie_value = [];
		for (i in _children) {
		 if(_children[i].required_field_hasError()) {
		    _children[i].required_field_error(true);
			_numOfErrors++;
		 }
		}
		
		if(_numOfErrors > 0) {
			_deleteCookie();
			
		}
		
		if (_plainRequiredfields() == 0 || formstep_status == 'previous') {
			
			var __dummyemailadresse = "";
			if(typeof DUMMYEMAIL !== "undefined") {
				__dummyemailadresse = DUMMYEMAIL;
			}
			else {
				__dummyemailadresse = $('#emailstandard').val();
			}
			if(!!$('#emailrequired').length) {
				if($('#emailrequired').val().split(" ").length == 1 && $('#emailrequired').val().length == 0) {
				  $('#emailstandard').val(__dummyemailadresse);
				}
				else {
					$('#emailstandard').val($('#emailrequired').val());
				}
			}
			else {
				$('#emailstandard').val(__dummyemailadresse);
			}

			
			for (i in _children) {
				_zenfo_cookie_value.push(_children[i].required_field_whichInputHasFlag());	
			}
			zenfo_validator_register_test.setCookie(); 
			
			setTimeout(function(){ _thisForm.submit() }, 500);
			
		}
		
		
	});
  };
  
  var register = {
	add : _add,
	length : _getLength,
	getValue : _getValue,
	setCookie : _setCookie,
	deleteCookie : _deleteCookie,
	reset : _reset,
	setFormId : _setFormId,
	checkCookie : _checkCookie,
	processing : _processing
  };
  
  return register;
}

var validator_zenfo = function () {
	var requirement_achieved = false;
	var requirement_field_flag_checked = 0;
	var requirement_field_flag_active = null;
	
	var labelItem = "*";
	if(self.CURRENTPOOL == "japan" || self.CURRENTPOOL == "latin-america-en" || self.CURRENTPOOL == "latin-america-es" || self.CURRENTPOOL == "eastern-europe"){
		labelItem = "**";
	}		
	
	var required_field_flag = function (i) {

	  if(document.cookie.indexOf("zenfo_validation=#") > -1) {
	    return;
	  }

	  if(typeof i !== 'undefined') {
		var __label = $(requirement_config.dependency_elements[i]).find('label');		
		if(__label.text().indexOf('*')<0) __label.text(__label.text() + " " + labelItem);
	  }
	  else {
		  
		$(requirement_config.dependency_elements).each(function (i, e) {
		  var _label = $(e).find('label');
		  if(_label.text().indexOf('*')<0) _label.text(_label.text() + " " + labelItem); 
		});
	  }
	};

	var required_field_deflag = function (b) {
	
	  $(requirement_config.dependency_elements).each(function (i, e) {
		var _label = $(e).find('label');
		var _textbox = $(e).find('.textbox');
		var _textbox_input =  $(e).find('input');
		if(_label.text().indexOf(labelItem)>0) { _label.text(_label.text().split(' '+labelItem)[0]);  _textbox.removeClass('error');  }
		if(_textbox.hasClass('error') && _textbox_input.val().length != 0) _textbox.removeClass('error');
	
	  });	  
	};

	var required_field_value_check = function () { 
	  var _length = 0;
	  $(requirement_config.dependency_elements).each(function (i, e) { 
	    if(!!$(e).find('input').val().length) {
		  _length++;
		}
	  });
	  return _length;
	}

	var required_field_error = function (b) {
	  $(requirement_config.dependency_elements).each(function (i, e) { 
		var _textbox = $(e).find('.textbox');
		  required_field_flag();
			if(!!b) {
			  _textbox.addClass('error');   
			}
		});
	};

	var required_field_elements = function () {
	  var _rcd = requirement_config.dependency_container;
	  var _rcp = requirement_config.prefix;
	  var _rcs = requirement_config.suffix;
	  var _rcf = requirement_config.form_id;
	  

	  $(_rcd).each(function (i) {
		_rcd[i] = '#' + _rcp + _rcd[i] + _rcs;   
	  });
	  requirement_config.dependency_elements = _rcd;
	};

	var required_field_hasValue = function () {
		var numberOfValues = 0;
		var valueValid;    
		var _relatioinship = requirement_config.relationship;
		var hotfix = false;
	  $(requirement_config.dependency_elements).each(function (i, e) {
		  
		try {
			if(!!$(e).find('input').val().length) {
			   requirement_achieved = true;
			   numberOfValues++;
			   if(!!$(e).find('.error').length) $(e).find('.error').removeClass('error');
			 }
		}
		catch(err) {
			hotfix = true;			
			numberOfValues = 0;
		}
	  });  
	  
	  numberOfActiveRequiredField = numberOfValues;
	 
      if ( $('#emailrequired').length > 0 ) {
    	  if($('#emailrequired').val().split(" ").length == 1 && $('#emailrequired').val().length != 0) {
    		valueValid = /[a-z0-9]+[_a-z0-9\.-]*[a-z0-9]+@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})/.test($('#emailrequired').val());
    	  }
      }
	    
	  if(numberOfValues > 0 && (!!valueValid || typeof valueValid == 'undefined') && _relatioinship == 'or') {
		requirement_achieved = true;
	  }
	  else if (numberOfValues > 0 && (!!valueValid || typeof valueValid == 'undefined') && _relatioinship == 'and') {
	    if(numberOfValues == $(requirement_config.dependency_elements).length) {
			requirement_achieved = true;
		}
		else {
			requirement_achieved = false;
		}

	  }
	  else {
		requirement_achieved = false;
	  }
	  
	  if(hotfix){
		  requirement_achieved = true;
	  }
	}; 

	var required_field_event = function () {
	  $(requirement_config.dependency_elements).each(function (i, e) {
		var whichOne = i;
		var whichOneFocued = null;
		$(e).find('input').on('change blur keyup input', function (event) {  // blur keyup
            
		  document.cookie = "zenfo_validation=;"
		  required_field_hasValue();
		  var thisInput = requirement_config.dependency_elements.indexOf('#'+$(e).attr("id"));
		    //required_field_flag_check();
		  if(requirement_achieved && requirement_config.relationship == 'or') {
	        if(required_field_value_check() == 1 && $(e).find('input').val() != "") { 
			   required_field_deflag();
			   required_field_flag(thisInput); 
		    }
			if((required_field_value_check() > 1 && $(e).find('input').val() == "") || (required_field_value_check() == 1 && $(e).find('input').val() == "")) {
			  required_field_deflag();
			  if($(requirement_config.dependency_elements[0]).find('input').val() == 0) {
			    $(requirement_config.dependency_elements).each(function (i, e) { 
				  if($(e).find('input').val() != "") {
				    required_field_flag(i);
					return false
				  }
				})
			  }
			  else {
				required_field_flag(0);
			  }
			}
		  }
		  else if(requirement_achieved && requirement_config.relationship == 'and') { 
			    required_field_deflag();
				$(requirement_config.dependency_elements).each(function (i, e) { 
				  if($(e).find('input').val() != "") {
				    required_field_flag();
					return false
				  }
				})
			  }
		  else {
			required_field_error(false); 
		  }
		});
	});
	}

	var preprocessing = function () {
	  required_field_elements();
	  required_field_event();
	  required_field_flag(); 
	};

	var processing = function () {
	  preprocessing();
	  required_field_hasValue();
	  $('#' +requirement_config.form_id).submit(function (e) {
		if(!requirement_achieved) {
			e.preventDefault();
			required_field_error(true);
		}
		else {
		  
			//zenfo_validator_register_test.setCookie();
		}
	 });
	};
	
	var required_field_hasError = function () {
	  required_field_hasValue();
	  return !requirement_achieved;
	};
	
	var required_field_whichInputHasFlag = function () {
		
		$(requirement_config.dependency_elements).each(function (i, e) {
			if($(e).find('label').text().indexOf('*') > -1) {
				requirement_field_flag_active = requirement_config.dependency_elements[i];
			}
		});
		
		return requirement_field_flag_active;
	};
	
	var reset = function () {
	  $(requirement_config.dependency_elements).each(function (e) {
		$(e).find('input').off('keyup');
	  });
	  required_field_deflag();
	  requirement_config.dependency_elements = [];
	};
	
	var requirement_config = {
	  relationship: null,
	  prefix: null,
	  suffix: null,
	  form_id: null,
	  dependency_container : null, 
	  dependency_elements : null,
	  required_field_flag : required_field_flag,
	  required_field_deflag : required_field_deflag,
	  required_field_error : required_field_error,
	  required_field_elements : required_field_elements,
	  required_field_hasValue : required_field_hasValue,
	  required_field_whichInputHasFlag : required_field_whichInputHasFlag,
	  required_field_event : required_field_event,
	  preprocessing : preprocessing,
	  processing : processing,
	  required_field_hasError : required_field_hasError,
	  reset : reset
	};
	// object as config interface
	return requirement_config;
};

// [ZT]
// Es gibt noch TODO
// nur eine Notloeung als DEMO
// spaeer wird diese Loeung durch Noxum update ersetzt 

var cookieExpires = function (z, name) {
	var _second = z;
	var _name = name;
	var now = new Date();
	var time = now.getTime();
	time += z * 1000;
	now.setTime(time);
	document.cookie = 
	_name + "=" + '; expires=' + now.toUTCString() + '; path=' + location.path;
}

if(!!$('form.step1').length && location.pathname !== '/uk/ipl-contact/' && location.pathname !== '/france/ipl-contact/' && location.pathname !== '/germany/ipl-contact/' && location.pathname !== '/italy/ipl-contact/') { 
	if(document.cookie.indexOf('zenfo_validation') > -1) cookieExpires(0, 'zenfo_validation');
}

if(location.pathname.indexOf("/ipl-customer/ipl/search") > -1 || !!$('form.stepprint').length) {
	if(document.cookie.indexOf('zenfo_validation') > -1) cookieExpires(0, 'zenfo_validation');
}

if(!!$('form.step2').length && (location.pathname == '/uk/dealercontact/' || location.pathname == '/uk/approvedused/sellyourporsche/contact/')) {

	var zenfo_validator_register_test = new validator_zenfo_register();
		zenfo_validator_register_test.setFormId('formcomponentform');

	var group_a = new validator_zenfo();
		group_a.relationship = 'or';
		group_a.prefix = '';
		group_a.suffix = '_required';
		group_a.dependency_container = ['phone', 'mobile', 'email'];
		group_a.preprocessing();
		zenfo_validator_register_test.add(group_a);
		
	var group_b = new validator_zenfo();
		group_b.relationship = 'and';
		group_b.prefix = '';
		group_b.suffix = '_required';
		group_b.dependency_container = ['street'];
		group_b.preprocessing();
		zenfo_validator_register_test.add(group_b);
	
	var group_c = new validator_zenfo();
	
	var group_d = new validator_zenfo();
		group_d.relationship = 'or';
		group_d.prefix = '';
		group_d.suffix = '_required';
		group_d.dependency_container = ['building','no'];
		group_d.preprocessing();
		zenfo_validator_register_test.add(group_d);
		
		zenfo_validator_register_test.processing();
		zenfo_validator_register_test.checkCookie();
				
		$('#addresstype_1').on('click', function () {

			group_b.reset();
			group_c.reset();
			zenfo_validator_register_test.reset();
			
			group_b.relationship = 'and';
			group_b.prefix = '';
			group_b.suffix = '_required';
			group_b.dependency_container = ['street'];
			group_b.preprocessing();
			zenfo_validator_register_test.add(group_b);
			
			group_d.relationship = 'or';
			group_d.prefix = '';
			group_d.suffix = '_required';
			group_d.dependency_container = ['building','no'];
			group_d.preprocessing();
			zenfo_validator_register_test.add(group_d);
			
			
		})
		
		$('#addresstype_2').on('click', function () {

			group_b.reset();
			group_c.reset();
			group_d.reset();
			zenfo_validator_register_test.reset();
			/*
			group_b.relationship = 'or';
			group_b.prefix = '';
			group_b.suffix = '_required';
			group_b.dependency_container = ['no', 'building'];
			group_b.preprocessing();
			zenfo_validator_register_test.add(group_b);
			*/
			group_c.relationship = 'and';
			group_c.prefix = '';
			group_c.suffix = '_required';
			group_c.dependency_container = ['company', 'street'];
			group_c.preprocessing();
			zenfo_validator_register_test.add(group_c);
			
		})
		
		$('#lbladdresstype_1').click();
			
}

if(!!$('form.step2').length && (location.pathname == '/france/dealercontact/' || location.pathname == '/france/_guadeloupe_/dealercontact/')) {

	var zenfo_validator_register_test = new validator_zenfo_register();
		zenfo_validator_register_test.setFormId('formcomponentform');

	var group_a = new validator_zenfo();
		group_a.relationship = 'or';
		group_a.prefix = '';
		group_a.suffix = '_required';
		group_a.dependency_container = ['phone', 'mobile', 'email'];
		group_a.preprocessing();
		zenfo_validator_register_test.add(group_a);
		
		zenfo_validator_register_test.processing();
		zenfo_validator_register_test.checkCookie();

}

if(!!$('form.step2').length && location.pathname == '/germany/dealercontact/') {

	var zenfo_validator_register_test = new validator_zenfo_register();
		zenfo_validator_register_test.setFormId('formcomponentform');

	var group_a = new validator_zenfo();
		group_a.relationship = 'or';
		group_a.prefix = '';
		group_a.suffix = '_required';
		group_a.dependency_container = ['phone', 'mobile'];
		group_a.preprocessing();
		zenfo_validator_register_test.add(group_a);
		
		zenfo_validator_register_test.processing();
		zenfo_validator_register_test.checkCookie();

    var group_b = new validator_zenfo();
        group_b.relationship = 'and';
        group_b.prefix = '';
        group_b.suffix = '_required';
        group_b.dependency_container = ['email'];
        group_b.preprocessing();
        zenfo_validator_register_test.add(group_b);

    $('#formcomponentform').on('submit', (function() {
        var $addresstype_1 = $('#addresstype_1');
        var $lbladdresstype_1 = $('#lbladdresstype_1');
        var $addresstype_2 = $('#addresstype_2');
        var $lbladdresstype_2 = $('#lbladdresstype_2');
        var $companynotrequired = $('#company-notrequired');

        return function() {
            if($companynotrequired && $companynotrequired.val().length > 0) {
                $addresstype_2.attr('checked', 'checked');
                $lbladdresstype_2.addClass('isChecked');
                $addresstype_1.removeAttr('checked');
                $lbladdresstype_1.removeClass('isChecked');
            } else {
                $addresstype_1.attr('checked', 'checked');
                $lbladdresstype_1.addClass('isChecked');
                $addresstype_2.removeAttr('checked');
                $lbladdresstype_2.removeClass('isChecked');
            }
        }
    })());

}


if(!!$('form.step2').length && location.pathname == '/italy/dealercontact/') {

	var zenfo_validator_register_test = new validator_zenfo_register();
		zenfo_validator_register_test.setFormId('formcomponentform');

	var group_a = new validator_zenfo();
		group_a.relationship = 'or';
		group_a.prefix = '';
		group_a.suffix = '_required';
		group_a.dependency_container = ['phone', 'mobile', 'email'];
		group_a.preprocessing();
		zenfo_validator_register_test.add(group_a);
		
		zenfo_validator_register_test.processing();
		zenfo_validator_register_test.checkCookie();

}



if(!!$('form.step1').length && location.pathname == '/uk/ipl-contact/') {

	//$('#lbladdresstype_1').click();

	var zenfo_validator_register_test = new validator_zenfo_register();
		zenfo_validator_register_test.setFormId('formcomponentform');

	var group_a = new validator_zenfo();
		group_a.relationship = 'or';
		group_a.prefix = '';
		group_a.suffix = '_required';
		group_a.dependency_container = ['phone', 'mobile', 'email'];
		group_a.preprocessing();
		zenfo_validator_register_test.add(group_a);
		
	var group_b = new validator_zenfo();
		group_b.relationship = 'and';
		group_b.prefix = '';
		group_b.suffix = '_required';
		group_b.dependency_container = ['street'];
		group_b.preprocessing();
		zenfo_validator_register_test.add(group_b);

	var group_c = new validator_zenfo();
	
	var group_d = new validator_zenfo();
		group_d.relationship = 'or';
		group_d.prefix = '';
		group_d.suffix = '_required';
		group_d.dependency_container = ['building','houseno'];
		group_d.preprocessing();
		zenfo_validator_register_test.add(group_d);

		zenfo_validator_register_test.processing();
		zenfo_validator_register_test.checkCookie();
				
		$('#addresstype_1').on('click', function () {

			group_b.reset();
			group_c.reset();
			zenfo_validator_register_test.reset();
            zenfo_validator_register_test.add(group_a);
			
			group_b.relationship = 'and';
			group_b.prefix = '';
			group_b.suffix = '_required';
			group_b.dependency_container = ['street'];
			group_b.preprocessing();
			zenfo_validator_register_test.add(group_b);
			
			group_d.relationship = 'or';
			group_d.prefix = '';
			group_d.suffix = '_required';
			group_d.dependency_container = ['building','houseno'];
			group_d.preprocessing();
			zenfo_validator_register_test.add(group_d);

		})
		
		$('#addresstype_2').on('click', function () {

			group_b.reset();
			group_c.reset();
			group_d.reset();
			zenfo_validator_register_test.reset();
            zenfo_validator_register_test.add(group_a);
			
			//group_b.relationship = 'or';
			//group_b.prefix = '';
			//group_b.suffix = '_required';
			//group_b.dependency_container = ['houseno', 'building'];
			//group_b.preprocessing();
			//zenfo_validator_register_test.add(group_b);
			
			group_c.relationship = 'and';
			group_c.prefix = '';
			group_c.suffix = '_required';
			group_c.dependency_container = ['company', 'street'];
			group_c.preprocessing();
			
			zenfo_validator_register_test.add(group_c);
			
		})
        

		$('#lbladdresstype_1').click();
		$('#addresstype_1').click();

}

if(!!$('form.step1').length && location.pathname == '/france/ipl-contact/') {

	var zenfo_validator_register_test = new validator_zenfo_register();
		zenfo_validator_register_test.setFormId('formcomponentform');

	var group_a = new validator_zenfo();
		group_a.relationship = 'or';
		group_a.prefix = '';
		group_a.suffix = '_required';
		group_a.dependency_container = ['phone', 'mobile', 'email'];
		group_a.preprocessing();
		zenfo_validator_register_test.add(group_a);
		
		zenfo_validator_register_test.processing();
		zenfo_validator_register_test.checkCookie();

}

// 2016-12-23 [SK] Frontend group Validation für germany ipl nur noch auf phone und mobile
// PM: Sebastian Lehns
if(!!$('form.step1').length && (location.pathname == '/germany/ipl-contact/') || location.pathname == '/germany/msa-contact/') {

	var zenfo_validator_register_test = new validator_zenfo_register();
		zenfo_validator_register_test.setFormId('formcomponentform');

	var group_a = new validator_zenfo();
		group_a.relationship = 'or';
		group_a.prefix = '';
		group_a.suffix = '_required';
		group_a.dependency_container = ['phone', 'mobile'];
		group_a.preprocessing();
		zenfo_validator_register_test.add(group_a);
		
		zenfo_validator_register_test.processing();
		zenfo_validator_register_test.checkCookie();
}


if(!!$('form.step1').length && location.pathname == '/italy/ipl-contact/') {

	var zenfo_validator_register_test = new validator_zenfo_register();
		zenfo_validator_register_test.setFormId('formcomponentform');

	var group_a = new validator_zenfo();
		group_a.relationship = 'or';
		group_a.prefix = '';
		group_a.suffix = '_required';
		group_a.dependency_container = ['phone', 'mobile', 'email'];
		group_a.preprocessing();
		zenfo_validator_register_test.add(group_a);
		
		zenfo_validator_register_test.processing();
		zenfo_validator_register_test.checkCookie();
}

if(!!$('form.step2').length && location.pathname == '/germany/microsite/911-gt2-rs/' || 
   !!$('form.step2').length && location.pathname == '/germany/microsite/911-turbo-s-exclusive-series/' ||
   !!$('form.step2').length && location.pathname == '/germany/microsite/panamera-sport-turismo/' ||
   !!$('form.step2').length && location.pathname == '/germany/microsite/911-gts/' ||
   !!$('form.step2').length && location.pathname == '/germany/microsite/911-gt3/' ||
   !!$('form.step2').length && location.pathname == '/germany/microsite/panamera/' ||
   !!$('form.step2').length && location.pathname == '/germany/microsite/911-r/' ||
   !!$('form.step2').length && location.pathname == '/germany/microsite/718-request/') {
	
	
	
	if($('#mobiletel_required').is(':visible') && $('#tel_required').is(':visible')) {

		var zenfo_validator_register_test = new validator_zenfo_register();
			zenfo_validator_register_test.setFormId('formcomponentform');

		var group_a = new validator_zenfo();
			group_a.relationship = 'or';
			group_a.prefix = '';
			group_a.suffix = '_required';
			group_a.dependency_container = ['mobiletel', 'tel'];
			group_a.preprocessing();
			zenfo_validator_register_test.add(group_a);
			zenfo_validator_register_test.processing();
			zenfo_validator_register_test.checkCookie();
			$('.previousButton a').attr('href', '');
	}
		

		
}

if((location.pathname.indexOf("central-eastern-europe") > -1) && ((location.pathname.indexOf("/contactform/") > -1) || (location.pathname.indexOf("/salesform/") > -1) || (location.pathname.indexOf("/dealercontact/") > -1 ))){
	var zenfo_validator_register_test = new validator_zenfo_register();
        zenfo_validator_register_test.setFormId('formcomponentform');

        var group_a = new validator_zenfo();
        group_a.relationship = 'or';
        group_a.prefix = '';
        group_a.suffix = '_required';
        group_a.dependency_container = ['email', 'mobile'];
        group_a.preprocessing();
        zenfo_validator_register_test.add(group_a);

        zenfo_validator_register_test.processing();
        zenfo_validator_register_test.checkCookie();
}

// 2017-04-20 [BL] Frontend group Validation für germany/accessoriesandservices/classic/genuineparts/originale/requestinformation auf phone und mobile
// PM: Mandy Alt // Dimitri Koch
// CM: Mirijam Maack
    if(!!$('form.step1').length && (location.pathname == '/germany/accessoriesandservices/classic/genuineparts/originale/requestinformation/')){

        var zenfo_validator_register_test = new validator_zenfo_register();
        zenfo_validator_register_test.setFormId('formcomponentform');

        var group_a = new validator_zenfo();
        group_a.relationship = 'or';
        group_a.prefix = '';
        group_a.suffix = '_required';
        group_a.dependency_container = ['phone', 'mobile'];
        group_a.preprocessing();
        zenfo_validator_register_test.add(group_a);

        zenfo_validator_register_test.processing();
        zenfo_validator_register_test.checkCookie();
    }
	// 2017-08-25 [CF] E3Ds
	// PM: Sabrina Porto
    if(!!$('form.step1').length && (location.pathname == '/germany/microsite/cayenne-dreamsharing/')){
		var zenfo_validator_register_test = new validator_zenfo_register();
        zenfo_validator_register_test.setFormId('formcomponentform');

        var group_a = new validator_zenfo();
        group_a.relationship = 'or';
        group_a.prefix = '';
        group_a.suffix = '_required';
        group_a.dependency_container = ['phone', 'mobile'];
        group_a.preprocessing();
        zenfo_validator_register_test.add(group_a);

        zenfo_validator_register_test.processing();
        zenfo_validator_register_test.checkCookie();
    }
	// 2017-08-17 [CF] Frontend group Validation für PLAes /PLAen
	// PM: Mandy Alt

    if(!!$('form.step2').length && (
		location.pathname == '/latin-america-es/_mexico_/dealercontact/' || 
		location.pathname == '/latin-america-en/_mexico_/dealercontact/' || 
        location.pathname == '/latin-america-es/_panama_/dealercontact/' || 
		location.pathname == '/latin-america-en/_panama_/dealercontact/' || 
        location.pathname == '/latin-america-es/_colombia_/dealercontact/' || 
		location.pathname == '/latin-america-en/_colombia_/dealercontact/' || 
        location.pathname == '/latin-america-es/_dominican-republic_/dealercontact/' || 
		location.pathname == '/latin-america-en/_dominican-republic_/dealercontact/' || 
        location.pathname == '/latin-america-es/_peru_/dealercontact/' || 
		location.pathname == '/latin-america-en/_peru_/dealercontact/' || 
        location.pathname == '/latin-america-es/_puerto-rico_/dealercontact/' || 
		location.pathname == '/latin-america-en/_puerto-rico_/dealercontact/' || 
        location.pathname == '/latin-america-es/_guatemala_/dealercontact/' || 
		location.pathname == '/latin-america-en/_guatemala_/dealercontact/' || 
		location.pathname == '/latin-america-es/_chile_/dealercontact/'  ||
		location.pathname == '/latin-america-en/_chile_/dealercontact/'
		)){
		var zenfo_validator_register_test = new validator_zenfo_register();
        zenfo_validator_register_test.setFormId('formcomponentform');

        var group_a = new validator_zenfo();
        group_a.relationship = 'or';
        group_a.prefix = '';
        group_a.suffix = '_required';
        group_a.dependency_container = ['email','phone', 'mobile'];
        group_a.preprocessing();
        zenfo_validator_register_test.add(group_a);

        zenfo_validator_register_test.processing();
        zenfo_validator_register_test.checkCookie();
    }
	

});


function dealer2_state_city_dealer() {

    var _sysStateField = "dealer2_state_field";
    var _sysCityField = "dealer2_city_field";
    var _sysDealerField = "dealer2_dealer_field";

    var _sysFieldLevel0 = $('#' + _sysStateField + '_required').length && $('#' + _sysCityField + '_required').length && $('#' + _sysDealerField + '_required').length; // required
    var _sysFieldLevel1 = $('#' + _sysStateField).length && $('#' + _sysCityField).length && $('#' + _sysDealerField).length; // not required
    var _sysFieldLevel2 = $('#' + _sysStateField + '.on').length && $('#' + _sysCityField + '.on').length && $('#' + _sysDealerField + '.on').length; // active

    if (_sysFieldLevel1 == 1 && !_sysFieldLevel2) {
        $('#' + _sysStateField).addClass('on');
        $('#' + _sysCityField).addClass('on');
        $('#' + _sysDealerField).addClass('on');
    }

    if (!!_sysFieldLevel0) { $('#formcomponentform').addClass('hasdealer2statecitydealerdropdown'); }
    else { return; }

    var pool = CURRENTPOOL || 'china';
    var language = CURRENTLANGUAGE || 'zh';
    var webserviceUrl = location.origin + "/all/dealer2/GetLocationsWebService.asmx/GetProvinceCityDealer?country=" + pool + "&language=" + language;

    resetDropdown('dealer2_city_dropdown');
    resetDropdown('dealer2_dealer_dropdown');

    $.get(webserviceUrl, function (i, j) {

        var c = JSON.parse(($(i)[0].documentElement.textContent));

        var stateArray = [];
        for (var a = 0; a < c.length; a++) {
            stateArray.push(c[a].GUI_PROVINCE);
        }

        var uniqueState = [];
        $.each(stateArray, function (i, el) {
            if ($.inArray(el, uniqueState) === -1) {
                uniqueState.push(el);
                var data = {
                    id: language == 'zh' ? el.split('_')[0] : el.split('_')[0].toLowerCase(),
                    text: language == 'zh' ? el.split('_')[1] : el.split('_')[0]
                }
                var newOption = new Option(data.text, data.id, false, false);
                $('#dealer2_state_dropdown').append(newOption).trigger('change');
            }
        });

        

        $('#dealer2_state_dropdown').on("change", function (e) {

            resetDropdown('dealer2_city_dropdown');
            resetDropdown('dealer2_dealer_dropdown');
           
            if ((typeof e.val != 'undefined' && e.val != -1) || typeof $.cookie('dealer2_state_dropdown') != 'undefined') {
               
                var _value = e.val || $.cookie('dealer2_state_dropdown');

                $.cookie('dealer2_state_dropdown', _value);
                $('#dealer2_city_dropdown').prop("disabled", false);

                $('#address_state').val($(e.currentTarget).find('option.selected').text());

                var selectedState = _value.toLowerCase();

                var cityArray = [];
                for (var a = 0; a < c.length; a++) {
                    if (c[a].state == selectedState)
                        cityArray.push(c[a].city);
                }

                var uniqueCity = [];
                $.each(cityArray, function (i, el) {
                    if ($.inArray(el, uniqueCity) === -1) {
                        uniqueCity.push(el);
                        var data = {
                            id: el,
                            text: el
                        }
                        var newOption = new Option(data.text, data.id, false, false);
                        $('#dealer2_city_dropdown').append(newOption).trigger('change');
                    }
                });

            }
        });

        $('#dealer2_city_dropdown').on("change", function (e) {

            resetDropdown('dealer2_dealer_dropdown');

            if ((typeof e.val != 'undefined' && e.val != -1) || typeof $.cookie('dealer2_city_dropdown') != 'undefined') {

                var _value = e.val || $.cookie('dealer2_city_dropdown');

				$.cookie('dealer2_city_dropdown', _value);
				
                $('#dealer2_dealer_dropdown').prop("disabled", false);

				$('#address_city').val(_value);

                var selectedCity = (language == 'zh' ? _value.toLowerCase() : _value);

                var dealerArray = [];
                for (var a = 0; a < c.length; a++) {
                    if (c[a].city == selectedCity)
                        dealerArray.push(c[a].name + "#" + c[a].BPNumber);
                }

                var uniqueDealer = [];
                $.each(dealerArray, function (i, el) {
                    if ($.inArray(el, uniqueDealer) === -1) {
                        uniqueDealer.push(el);
                        var data = {
                            id: el,
                            text: el
                        }
                        var newOption = new Option(data.text.split('#')[0], data.id, false, false);
                        $('#dealer2_dealer_dropdown').append(newOption).trigger('change');
                    }
                });

            }
        });

        $('#dealer2_dealer_dropdown').on("change", function (e) {
            if ((typeof e.val != 'undefined' && e.val != -1) || typeof $.cookie('dealer2_dealer_dropdown') != 'undefined') {
                var _value = e.val || $.cookie('dealer2_dealer_dropdown');
                $.cookie('dealer2_dealer_dropdown', _value);
	    	$('#address_dealer').val(_value.split('#')[0]);
		$('#address_dealerbp').val(_value.split('#')[1]);
		
            }
        });

        $('#formcomponentform.hasdealer2statecitydealerdropdown').submit(function (e) {
            e.preventDefault();
            var _this = this;
            var _chosenText = $('#dealer2_dealer_field_required .select2-chosen').text();
            if (!!_sysFieldLevel0) {
                if ($('#dealer2_dealer_field_required select option:eq(0)').text() != _chosenText) {
					$.removeCookie('dealer2_state_dropdown');
					$.removeCookie('dealer2_city_dropdown');
					$.removeCookie('dealer2_dealer_dropdown');
                    _this.submit();
                } else {
                    $('#dealer2_dealer_field_required').css('color', '#c00');
                }
            }

        });

        if (typeof $.cookie('dealer2_state_dropdown') != 'undefined') {
            $('#dealer2_state_dropdown').val($.cookie('dealer2_state_dropdown')).trigger('change');
        }

        if (typeof $.cookie('dealer2_city_dropdown') != 'undefined') {
            if (language == 'zh') {
                $('#dealer2_city_dropdown').val(decodeURIComponent($.cookie('dealer2_city_dropdown').replace(/\+/g, " "))).trigger('change');
            }
            else {
                $('#dealer2_city_dropdown').val($.cookie('dealer2_city_dropdown')).trigger('change');
            }
        }

        if (typeof $.cookie('dealer2_dealer_dropdown') != 'undefined') {
            if (language == 'zh') {
                $('#dealer2_dealer_dropdown').val(decodeURIComponent($.cookie('dealer2_dealer_dropdown').replace(/\+/g, " "))).trigger('change');
            }
            else {
                $('#dealer2_dealer_dropdown').val($.cookie('dealer2_dealer_dropdown')).trigger('change');
            }
        }
        

    });

    function resetDropdown(id) {

        $('#' + id).select2('destroy');
        $('#' + id).find('option[value!="-1"]').remove();

        $('#' + id).select2({
            containerCssClass: 'gui-select2-container',
            dropdownCssClass: 'gui-select2-dropDown',
            minimumResultsForSearch: -1,
            width: "100%"
        });
        $('#' + id).val('-1');
        $('#' + id).trigger('change');
        $('#' + id).prop("disabled", true);
    }

};

dealer2_state_city_dealer();

var PSG_ContactUs_FieldSwitch;

//[SK] Workarounds for extra content modules, that shall not be visible on the form page until we reach the printstep
if(!!$('form.stepprint').length ){
    $('.form_printstep_only').show();
}

$(document).ready(function() {
    PSG_ContactUs_FieldSwitch = (function(){
        var $subject_dropdown = $('form.PSG_ContactUs_FieldSwitch #subject');
        var $fcarmodel = $('form.PSG_ContactUs_FieldSwitch #fcarmodel');
        var $fcarmake = $('form.PSG_ContactUs_FieldSwitch #fcarmake');
        var $fcar_purchaseintention = $('form.PSG_ContactUs_FieldSwitch #fcar_purchaseintention');
        var $fcar_buy = $('form.PSG_ContactUs_FieldSwitch #fcar_buy');
        var $fcar_buy_options = $fcar_buy.find('option');
        var $lblcar_modelinterest = $fcar_buy.find('#lblcar_modelinterest');
        var $fvehicle_plate_number = $('form.PSG_ContactUs_FieldSwitch #fvehicle_plate_number');

        $fcarmake.hide();
        $fcarmodel.hide();
        $fcar_purchaseintention.hide();
        $fcar_buy.hide();
        $fvehicle_plate_number.hide();


        return function() {
            $fcar_buy.parent().find('.fields').addClass('Disabled');
            $fcar_buy.removeClass('Disabled');

            switch($subject_dropdown.val()) {
                case 'subject_sales':
                    $lblcar_modelinterest.html('Model of Interest');

                    $fcarmake.show();
                    $fcarmodel.show();
                    $fcar_purchaseintention.show();
                    $fcar_buy.show();

                    $($fcar_buy_options[1]).hide();
                    $($fcar_buy_options[2]).hide();
                    $($fcar_buy_options[3]).hide();

                    $fvehicle_plate_number.hide();

                    break;

                case 'subject_service':
                    $lblcar_modelinterest.html('Model');

                    $fcar_buy.show();

                    $($fcar_buy_options[1]).show();
                    $($fcar_buy_options[2]).show();
                    $($fcar_buy_options[3]).show();

                    $fvehicle_plate_number.show();

                    $fcarmake.hide();
                    $fcarmodel.hide();
                    $fcar_purchaseintention.hide();

                    break;

                default:
                    $fcarmake.hide();
                    $fcarmodel.hide();
                    $fcar_purchaseintention.hide();
                    $fcar_buy.hide();
                    $fvehicle_plate_number.hide();
            }
        };
    }());
});
// -----------------------------------------
// M01 - Main Navigation
// -----------------------------------------

;(function($, window, document, undefined) {

    'use strict';

    var COUNT_resize_event = 0;
    var COUNT_layoutChangted_event = 0;

    $(document).ready(function() {

        // --- Variablendeklarationen -------------------------------------------------------------

        // "Caching" des jQuery-Window-Objektes
        var $window = $(window);

        // Breakpoint, der die Grenze zwischen der kleinsten und den größeren Ansichten beschreibt
        // var breakpoint = 720;
        var lastView = ''; //isSmallViewActive() ? 'small' : 'large';

        // Namespace für alle Events, die das Menuverhalten steuern
        var eventNamespace = '.mainnavigation';

        // layoutChange-Event Status Variable
        var layoutchangeDone = true;

		    var windowsphone = (window.navigator.appVersion.indexOf('Windows Phone') > -1);

        // Eventnamen
        var resizeEvent        = 'resize' + eventNamespace
          , layoutChangedEvent = 'layoutChange' + eventNamespace
          , mouseOverEvent     = ((window.navigator.msPointerEnabled && Modernizr.touch) ? 'MSPointerOver' : 'mouseover') + eventNamespace
          , mouseEnterEvent    = ((window.navigator.msPointerEnabled && Modernizr.touch) ? 'MSPointerEnter' : 'mouseenter') + eventNamespace
          , mouseLeaveEvent    = ((window.navigator.msPointerEnabled && Modernizr.touch) ? 'MSPointerOut' : 'mouseleave') + eventNamespace
          , touchMoveEvent     = ((window.navigator.msPointerEnabled && Modernizr.touch) ? 'MSPointerMove' : 'touchmove') + eventNamespace

          // Normalerweise würde ein touchend event ein etwas schnelleres Verhalten bei
          // Klick auf einen Menupunkt hervorrufen. Allerdings haben wir hier das Problem, das
          // unter Umständen ein weiteres Clickevent ausgelöst wird, wenn das Menu bereits geöffnet
          // ist. Das wiederum würde unter Umständen einen Deeplink auslösen. Um dies zu verhindern
          // wird nur ein Clickevent benutzt.
          , clickEvent = ((window.navigator.msPointerEnabled && Modernizr.touch && !windowsphone) ? 'MSPointerUp' : 'click') + eventNamespace
          , clickOutsideMenuEvent = (Modernizr.touch ? 'touchend' : (window.navigator.msPointerEnabled ? 'MSPointerUp' : 'click')) + eventNamespace;
          // , clickOutsideMenuEvent = (Modernizr.touch ? 'touchend' : 'click') + eventNamespace;

        // Eventlistener-Zustände
        var clickBehaviourActive     = false
          , mouseOverBehaviourActive = false
          , touchMoveBehaviourActive = false
          , clickOutsideMenuActive   = false
          , isPageScrollingByTouch   = false;

        var isIE8 = ($('html.ie8').length > 0);

        // Windowresize Timeout in ms
        var windowResizeTimeout = 100;

        // Windowresize Timeout Objekt
        var windowResizeTimeoutObject = null;

        // Animationseinstellungen zum animierten Öffnen der (Sub)Menus in ms
        var useAnimations     = false
          , animationDuration = 250
          , animationEasing   = 'cubic-bezier(0.645, 0.045, 0.355, 1.000)';

        var scrollToOpenMenu = true
          , scrollToOpenMenuAnimated = true
          , scrollAnimationDuration = 250;

        // Klassennamen von Menuelementen, auf die innerhalb des Scriptes zugegriffen wird
        var mainNavigationSelector = '.m-01-main-navigation'
          , mainMenuButtonID       = 'm-01-main-menu-button'
          , primaryMenuButtonID    = 'm-01-primary-menu-button'
          , menuItemSelector       = '.m-01-menu-item'
          , menuLinkSelector       = '.m-01-link'
          , submenuSelector        = '.m-01-sub-menu'
          , menuSectionSelector    = '.m-01-menu-section'
          , menuRootSelectorsLarge = '#m-01-model-menu, #m-01-primary-menu, #m-01-blue-buttons'
          , menuRootSelectorsSmall = mainNavigationSelector + ', ' + menuRootSelectorsLarge
          , activeClassName        = 'm-01-active'  // Wichtig: kein führender '.' !
          , pageOverlaySelector    = '.b-page-overlay';

        // "Caching" alle jQuery-Menu-Objekte, auf die innerhalb des Scriptes zugegriffen wird
        var $mainNavigation      = $(mainNavigationSelector)
          , $navigationMenuItems = $mainNavigation.find(menuItemSelector)
          , $navigationLinks     = $mainNavigation.find(menuLinkSelector)
          , $submenuRoots        = null  // Wird während eines window resize events gesetzt
          , $menuItems           = $mainNavigation.find(menuItemSelector + ", " + menuLinkSelector)
          , $pageOverlay         = $(pageOverlaySelector)
          , $html                = $('html')
          , $mainMenuButton_smallView  = $('#m-01-main-menu-button')
          , $mainMenuButton_mediumView = $('#m-01-primary-menu-button');

        // Model Flyout Zustand
        var modelFlyoutState = false // false: "zu", true: "offen"
          , $lastOpenModelFlyout = false;


        // --- INITIALISIERUNG --------------------------------------------------------------------
        //
        // Das Menu wird
        //
        //      # auf Touchgeräten und in der kleinsten Ansicht per Touch bzw. Mausklick
        //      # auf Nicht-Touchgeräten per Mausover
        //
        //  geöffnet. Das Verhalten ist also einerseits abhängig von der Interaktionsart und
        //  andererseits von der Größe des Viewports (window). Ein Window-Resize-Eventlistener
        //  hilft bei der Steuerung des Verhaltens über verschiedene Ansichten hinweg. Allerdings
        //  muss die Initialisierung schon ein mal beim laden des Scriptes ausgeführt werden.
        //  Hierzu wird, nachdem der Eventlistener am Window-Objekt angemeldet ist, einmalig
        //  getriggert.
        //
        //  Innerhalb des Eventlisteners wird ein Timeout-Objekt erzeugt und die
        //  (Re)initialisierung erst nach einer bestimmten Zeit (windowResizeTimeout) ausgeführt.
        //  Dadurch kann die Reaktionsfähigkeit (Performance) der Seite ein wenig gesteigert
        //  werden, da andernfalls bei jedem Pixelschritt während der Vergrößerung/Verkleinerung
        //  des Browserfensters die (Re)initialisierung durchgeführt werden würde.

        //$window.on(resizeEvent, function(event) {

        //    initBreakpointChangeBehaviour();
        //    window.clearTimeout(windowResizeTimeoutObject);


        //    windowResizeTimeoutObject = window.setTimeout(function() {

        //        window.setTimeout(function() {
        //            layoutModelMenu(true);
        //        }, 0);

        //        initSubmenuRoots();
        //        initTouchMoveBehaviour();
        //        initTouchOrClickBehaviour();
        //        initMouseOverBehaviour();

        //    }, windowResizeTimeout);


        //}).trigger(resizeEvent);

        //$("#m-01-models-menu-button-content .m-01-menu-item").on("mousemove",function(){
        //        $("#m-01-models-menu-button-content").height($(this).find(".m-60-module-wrapper").innerHeight());
        //});
        //$("#m-01-models-menu-button-content .m-60-series .m-60-model-series").on("mousemove",function(){
        //        $("#m-01-models-menu-button-content").height($(this).closest(".m-60-module-wrapper").innerHeight());
        //});

        // Layout-Changed Eventhandler der Hauptnavigation
        $mainNavigation.on(layoutChangedEvent, function (event) {

            // >>> DEBUG
            //COUNT_layoutChangted_event++;
            //if (typeof (console) !== 'undefined') {
            //    console.log('COUNT_layoutChangted_event: ' + COUNT_layoutChangted_event);
            //}
            // <<<

            initBreakpointChangeBehaviour();

            //layoutModelMenu(true);
            layoutModelMenu(false);
            initSubmenuRoots();
            initTouchMoveBehaviour();
            initTouchOrClickBehaviour();
            initMouseOverBehaviour();

            layoutchangeDone = true;
        });

        // resize Eventhandler und aktuelle View setzen
        $window.on(resizeEvent, function (event) {

            // >>> DEBUG
            // COUNT_resize_event++;
            //if (typeof (console) !== 'undefined') {
            //    console.log('COUNT_resize_event: ' + COUNT_resize_event);
            //}
            // <<<

            window.clearTimeout(windowResizeTimeoutObject);
            windowResizeTimeoutObject = window.setTimeout(function () {
                setActiveView();
            }, windowResizeTimeout);

        }).trigger(resizeEvent);



        // Hervorhebung des aktiven Bereichs. Muss nur einmal durchgeführt werden, da ein
        // wechsel des Bereiches immern einen Page Reload hervorruft. Daher nicht innerhalb des
        // window resize events integriert.
        $('#' + GLOBAL_CONFIG.currentMainNavigationArea).addClass('m-01-current');


        // --- INITIALISIERUNGSFUNKTIONEN ---------------------------------------------------------

        function layoutModelMenu(setSameSubmenuHeights) {

            $('#m-01-model-menu .m-01-level-2, .m-01-menu-item').height('auto').removeAttr('style');

            if (isSmallViewActive()) {
                return;
            }

            var $modelMenuItems  = $('#m-01-model-menu .m-01-level-2 > .m-01-menu-item')
                                     .not('.m-01-overview-link')
              , $activeMenuItem  = $('.m-01-active')
              , maxSubMenuHeight = 0
              , level2Height     = 0     // Baureihen Links
              , level3Height     = 0     // Model links
              , level4Height     = 0;    // Model Fylout


            //////////$modelMenuItems.each(function(index, element) {

            //////////    var $singleModelItem   = $(element)
            //////////      , modelItemOffset    = 0
            //////////      , modelItemHeight    = 0
            //////////      , $modelMenuSubItems = null
            //////////      , subMenuItemsHeight = 0
            //////////      , offsetCorrection   = 0; //$singleModelItem.hasClass('m-01-active') ? 0 : 1;

            //////////    // Öffnen des aktuellen Models ( + Hierarchie nach oben!); Vorher kann keine Höhe
            //////////    // bestimmt werden.
            //////////    $singleModelItem.addClass(activeClassName);
            //////////    $singleModelItem.parents(menuItemSelector).addClass(activeClassName);

            //////////    // Offset Position des Menu Items bestimmen
            //////////    modelItemOffset = $singleModelItem.position().top;

            //////////    // Höhe eines Baureihen Menu Items auslesen. Diese wird benötigt, um im späteren
            //////////    // Verlauf bestimmen zu können, ob die Menu Items der Modelle einer Baureihe
            //////////    // innerhalb des Menus verschoben werden müssen.
            //////////    modelItemHeight = $singleModelItem.height();


            //////////    level2Height = Math.max(level2Height, $('#m-01-model-menu .m-01-level-2').innerHeight());

            //////////    // Modelle einer Baureihe selektieren, overview-links aber ausschließen
            //////////    $modelMenuSubItems = $singleModelItem.find('.m-01-level-3 .m-01-menu-item')
            //////////                           .not('.m-01-overview-link');

            //////////    $modelMenuSubItems.first().removeAttr('style');

            //////////    // Alle Modelle einer Baureihe durchlaufen und die Gesamthöhe Berechnen.
            //////////    // Diese wir dann später benutzt, um zu bestimmen, ob eine Verschiebung der
            //////////    $modelMenuSubItems.each(function(index, element) {

            //////////        var $element     = $(element)
            //////////          , $modelFlyout = $element.find('.m-01-model-information')
            //////////          , $link        = $element.find('.m-01-link');

            //////////        subMenuItemsHeight += $link.height();

            //////////        // Model Flyout öffnen und Höhe des Model Flyouts auslesen
            //////////        $element.addClass(activeClassName);

            //////////        level3Height = Math.max(level3Height, $singleModelItem.find('.m-01-level-3').innerHeight());
            //////////        level4Height = Math.max(level4Height, $('#m-01-model-menu .m-01-level-4').innerHeight());

            //////////    });

            //////////    if (!isSmallViewActive() && (modelItemOffset + modelItemHeight) >= subMenuItemsHeight) {

            //////////        var correction = (modelItemOffset + modelItemHeight) - subMenuItemsHeight;
            //////////        //console.log($(this).find(".m-01-link span").eq(0).text() + ' // ' + (modelItemOffset + modelItemHeight) + ' >= ' + subMenuItemsHeight + ' : ' + modelItemHeight + ' : ' + correction);
            //////////        $modelMenuSubItems.first().css('margin-top', correction + offsetCorrection);

            //////////    } else {
            //////////        $modelMenuSubItems.first().removeAttr('style');
            //////////    }

            //////////});

            //////////// Alle geöffneten Menus wieder schließen.
            //////////closeSubmenus();

            //////////// Wenn ein Submenu während eines window-resizes geöffnet war, dieses wieder öffnen.
            //////////// Kann z.B. auf Tablets auftreten, wenn das Menu geöffnet ist und das Device gedreht
            //////////// wird.
            //////////$activeMenuItem.addClass(activeClassName);
            //////////$activeMenuItem.parents(menuItemSelector).addClass(activeClassName);

            // Alle Submenus auf eine Höhe bringen
            if (!isSmallViewActive() && setSameSubmenuHeights) {
                //maxSubMenuHeight = Math.max(Math.max(level2Height, level3Height), level4Height);
                //$('#m-01-model-menu .m-01-level-2').height(maxSubMenuHeight);
                $(document).trigger('m-01-resize-model-menu');
            }

        }


        function initSubmenuRoots() {

            if (isSmallViewActive()) {
                $submenuRoots = $(menuRootSelectorsSmall).children(menuItemSelector);
            } else {
                $submenuRoots = $(menuRootSelectorsLarge).children(menuItemSelector);
            }
        }

        /**
         * Um einen ungewollten Klick zu verhindern, der während des Scrollens der Seite auf
         * Touch-Geräten ausgelöst werden kann, meldet diese Funktion einen Touchmove-Eventlistener
         * am HTML-Objekt an. Der Handler setzt dann eine Variable (isPageScrollingByTouch) auf
         * den Wert TRUE, sobald die Seite per Finger gescrollt wird.
         *
         * Innerhalb des Click-/Touch-Handlers wird diese Variable überprüft und falls gescrollt
         * wurde, wird der Click-/Touch-Handler NICHT ausgeführt, die Variable aber zurück auf
         * FALSE gesetzt.
         */
        function initTouchMoveBehaviour() {

            if (!touchMoveBehaviourActive && (window.navigator.msPointerEnabled || Modernizr.touch)) {

                $html.on(touchMoveEvent, function(event) {

                    if (!window.navigator.msPointerEnabled
                            || (window.navigator.msPointerEnabled && event.isPrimary)) {

                        isPageScrollingByTouch = true;
                    }
                });

                touchMoveBehaviourActive = true;
            }

        }




        function initTouchOrClickBehaviour() {

            // IE 10 Surface Fix: Auf dem Surface müssen wir MSPointer Events nutzen, um das
            // Touch & Mausverhalten zu implementieren. Allerdings wird zusätzlich auch immer
            // ein Klick gefeuert. Um zu verhindern, das diese Klicks dazu führen, dass einem
            // Link gefolgt wird, dem eigentlich nicht gefolgt werden sollte (z.B. in den großen
            // Ansichten den Model-Links einer Baureihe), wird hier zusätzlich noch ein click
            // event handler angemeldet, der prüft ob einem link gefolgt werden darf oder nicht.
            if (Modernizr.touch && window.navigator.msPointerEnabled) {
                $navigationLinks.on('click', followDeeplink);
            }

            if ((window.navigator.msPointerEnabled && Modernizr.touch) || Modernizr.touch || isSmallViewActive()) {

                if (!clickBehaviourActive) {
                    $navigationLinks.on(clickEvent, handleMenuLinkClick);
                    clickBehaviourActive = true;
                }

            } else {

                if (clickBehaviourActive) {
                    $navigationLinks.off(clickEvent);
                    clickBehaviourActive = false;
                }
            }
        }


        function initMouseOverBehaviour() {

            if (!Modernizr.touch && !isSmallViewActive()) {

                if (!mouseOverBehaviourActive) {
                    $navigationMenuItems.on(mouseEnterEvent, handleMouseEnterMenuItem);
                    $navigationMenuItems.on(mouseOverEvent, handleMouseOverMenuItem);
                    $navigationMenuItems.on(mouseLeaveEvent, handleMouseLeaveMenuItem);
                    mouseOverBehaviourActive = true;
                }

            } else {

                if (mouseOverBehaviourActive) {
                    $navigationMenuItems.off(mouseEnterEvent);
                    $navigationMenuItems.off(mouseOverEvent);
                    $navigationMenuItems.off(mouseLeaveEvent);
                    mouseOverBehaviourActive = false;
                }
            }

        }


        function initBreakpointChangeBehaviour() {
            closeSubmenus();
            hidePageOverlay();

                //if (isSmallViewActive()) {

                //    if (lastView == 'large') {
                //        closeSubmenus();
                //        hidePageOverlay();
                //        lastView = 'small';
                //    }

                //} else {

                //    if (lastView == 'small') {
                //        closeSubmenus();
                //        hidePageOverlay();
                //        lastView = 'large';
                //    }
                //}
        }




        // --- HILFSFUNKTIONEN --------------------------------------------------------------------

        function isSubmenuOpen() {
            return $submenuRoots.hasClass(activeClassName);
        }

        function closeSubmenus() {
            $('.' + activeClassName).removeClass(activeClassName);

            // jdp-2015-05
            $('#m-01-model-menu').css({ 'padding-top': '' });
        }

        function displayPageOverlay() {
            $('html').addClass('m-01-main-navigation-shown');
            if (!isIE8) {
              $pageOverlay.addClass('m-01-main-navigation-show-overlay');
            }
        }

        function hidePageOverlay() {
          $('html').removeClass('m-01-main-navigation-shown');
          if (!isIE8) {
            $pageOverlay.removeClass('m-01-main-navigation-show-overlay');
          }
        }

        function isSmallViewActive() {

            // return $window.width() <= breakpoint;

            //$('#m-01-main-menu-button').is(':visible');
            return lastView === 'small';
        }

        function setActiveView() {

            var currentView = lastView;

            if ($mainMenuButton_smallView.is(':visible')) {
                lastView = 'small';
            }
            else if ($mainMenuButton_mediumView.is(':visible')) {
                lastView = 'medium';
            }
            else {
                lastView = 'large';
            }

            if (currentView !== lastView && (layoutchangeDone === true)) {
                layoutchangeDone = false;
                $mainNavigation.trigger(layoutChangedEvent);
            }

        }

        function areOnlyInvisibleMenusOpen() {

            var $activeMenuItems        = $('.' + activeClassName)
              , $activeMenuItemChildren = $activeMenuItems.children(menuLinkSelector);

            return ($activeMenuItems.length == 1
                        && $($activeMenuItemChildren[0]).attr('id') == mainMenuButtonID)
                    || ($activeMenuItems.length == 2
                        && $($activeMenuItemChildren[0]).attr('id') == mainMenuButtonID
                        && $($activeMenuItemChildren[1]).attr('id') == primaryMenuButtonID);
        }


        // Prüft, ob einem angeklicktem Link gefolget werden muss. Wird einerseits für IE 10 Surface
        // als eigenständiger Eventhandler angemeldet und andererseits im allgemeinen
        // Klick-/Touch-Verhalten genutzt.
        function followDeeplink(event) {

            var $linkTarget       = $(event.currentTarget)
              , $menuItemTarget   = $linkTarget.closest(menuItemSelector)
              , shouldOpenSubmenu = !$menuItemTarget.hasClass(activeClassName);

            // $html.on(clickOutsideMenuEvent, handleClickOutsideMenu);

            // Wenn ein Deeplink angecklickt wurde, darf das Click-/Touch-Verhalten nicht
            // durchgeführt werden. Ein Menulink startet immer mit #, wenn es KEIN Deeplink ist.
            // Ausnahme sind die Modelle einer Baureihe innerhalb des Model-Menus. Diese sind
            // verlinkt auf die jeweilige Model-Detail-Page. In der kleinsten Ansicht muss diesem
            // Link gefolgt werden, in den größeren Ansichten muss das Model-Flyout ausklappen.
            if (!$linkTarget.attr('href').match('^#')) {

                // Wurde auf einen Link in Level-3 des Model-Menus (dieses Level beinhaltet die
                // Modelle einer Baureihe) gecklickt, muss in der kleinen Ansicht dem Link gefolgt
                // und in den größeren Ansichten das Model-Menu ausgeklappt werden.
                if ($linkTarget.closest(menuSectionSelector).attr('id') == 'm-01-model-menu'
                        && $linkTarget.closest(submenuSelector).hasClass('m-01-level-3')) {


                    if (isSmallViewActive()) {

                        // Ist die kleinste Ansicht aktiv muss dem Deeplink gefolgt werden.
                        event.stopPropagation();
                        return true;
                    }

                } else {

                    // Ob einem anderem Link gefolgt werden darf, ist abhängig davon, ob ddie
                    // Seite auf einem Touchgerät aufgerufen wurde, oder ob die kleinste Ansicht
                    // aktiv ist. In diesem Fall muss aber noch geprüft werden, ob ein Submenu
                    // vorhanden ist, das geöffnet werden soll oder ob dem Link gefolgt werden
                    // darf.
                    if (Modernizr.touch || isSmallViewActive()) {

                        if (!!$linkTarget.parent().find(submenuSelector).length) {
                            event.stopPropagation();
                            return false;
                        } else {
                            event.stopPropagation();
                            return true;
                        }

                    } else {

                        // Wurde ein Deeplink angecklickt, der NICHT innerhalb des Level-3 des
                        // Model-Menus liegt, muss diesem Link gefolgt werden.
                        event.stopPropagation();
                        return true;

                    }
                }


            }

            return false;
        }


        // --- CLICK-/TOUCHVERHALTEN --------------------------------------------------------------

        //$(document).trigger('m-01-resize-model-menu');

        function openCloseSubMenus(shouldOpenSubmenu, $menuItemTarget) {

            // Submenus, öffnen oder schließen
            if (shouldOpenSubmenu) {
                // Submenu öffnen (inklusive der Hierarchie nach oben)

                $menuItemTarget.addClass(activeClassName);
                $menuItemTarget.parents(menuItemSelector).addClass(activeClassName);

                if (isSmallViewActive()) {

                    if ($('body').hasClass('pool-usa')) {
                        // jdp-2015-05
                        // V2: shopping buttons wurden auf mobile absolut nach oben positioniert,
                        //     dadurch schiebt sich die hauptnavi nicht mehr nach unten
                        //     wenn sich das shgopping menü öffnet.
                        //     >> wenn m-01-active Klasse im shopping flyout gesetzt wird:
                        //        höhe des shopping flyouts ermitteln und als padding-top
                        //        an das #model-menu hängen
                        //     >> #model-menu.padding-top wird generell in closeSubmenus() entfernt
                        if ($menuItemTarget.attr('id') == 'm-01-shopping-tools-item') {
                            var tmpH = $('#m-01-shopping-tools-item .m-01-sub-menu.m-01-level-2').height();
                            $('#m-01-model-menu').css({ 'padding-top': tmpH + 'px' });
                        }
                    }
                    if (Modernizr.csstransitions && useAnimations) {

                        // Animation: Sub Menu Öffnen

                        var $submenu = $menuItemTarget.children('.m-01-sub-menu')
                          , height   = $submenu.outerHeight(true);

                            $submenu.css({ overflow: 'hidden' }).height(0);

                        window.setTimeout(function() {

                            if (isSubmenuOpen()) {
                                displayPageOverlay();
                            } else {
                                hidePageOverlay();
                                $html.off(clickOutsideMenuEvent);
                                clickOutsideMenuActive = false;
                            }

                            $submenu.gpAnimate({ height: height}, animationDuration, animationEasing, 0,
                                function() {
                                    $submenu.removeAttr('style');
                                }
                            );

                        }, 0);
                    }

                    if ($menuItemTarget.children('#m-01-main-menu-button').length == 0
                            && scrollToOpenMenu) {

                        var duration = scrollToOpenMenuAnimated ? scrollAnimationDuration : 0;

                        $('html, body').animate({
                            scrollTop: $menuItemTarget.offset().top
                        }, duration);
                    }
                }


                if (isSubmenuOpen()) {
                    displayPageOverlay();

                } else {
                    hidePageOverlay();
                    $html.off(clickOutsideMenuEvent);
                    clickOutsideMenuActive = false;
                }


            } else {
                // Submenu schließen
                $menuItemTarget.parents(menuItemSelector).addClass(activeClassName);

                if (isSubmenuOpen()) {
                    displayPageOverlay();

                } else {
                    hidePageOverlay();
                    $html.off(clickOutsideMenuEvent);
                    clickOutsideMenuActive = false;
                }

            }

            // Überprüfen und "Triggern" zusätzlicher Aktionen, falls ein Modelflyout geöffnet
            // oder geschlossen wird.
            chechModelFlyoutState($menuItemTarget);
        }


        /**
         * Eventhandler, der Clicks-/Touches auf ein Menu-Item verarbeitet.
         *
         * Dieser Event-Handler wird während der Initialisierung bzw. einem Wechsel von einer der
         * großen zur kleinsten Ansicht angemeldet. Eine Abmeldung erfolgt, wenn die Ansicht von
         * der kleinsten zu einer größeren Ansicht stattfindet.
         *
         * Auf Touch-Geräten ist der Handler generell immer angemeldet.
         *
         * @param    {Object}   Click- oder Touchevent
         *
         * @returns  {Boolean}  TRUE, wenn einem Link gefolgt werden soll
         *                      FALSE, wenn ein Flyout ausgeklappt werden soll
         */
        function handleMenuLinkClick(event) {

            // Ist das Menu geöffnet, wird während eines Scrollvorganges auch dieser Event-Handler
            // aufgerufen. Demenstsprechend würde einem Link gefolgt bzw. ein Flyout ausgeklappt
            // werden. Um dies zu verhindern setzt ein Touchmove-Eventhandler die Variable
            // isPageScrollingByTouch auf TRUE, wenn ein Seitenscrolling per touch erfolgt.
            // In diesem Fall darf der Click-/Touchhandler NICHT ausgeführt werden.
            if (isSubmenuOpen() && isPageScrollingByTouch) {

                return isPageScrollingByTouch = false;
            }

            if (!clickOutsideMenuActive) {
                $html.on(clickOutsideMenuEvent, handleClickOutsideMenu);
                clickOutsideMenuActive = true;
            }

            // IE 10 Surface Fix
            if (!isSmallViewActive() && event.originalEvent.pointerType
                    && (event.originalEvent.pointerType == event.originalEvent.MSPOINTER_TYPE_MOUSE)) {

                event.stopPropagation();
                return false;
            }

            var $linkTarget       = $(event.currentTarget)
              , $menuItemTarget   = $linkTarget.closest(menuItemSelector)
              , shouldOpenSubmenu = !$menuItemTarget.hasClass(activeClassName);


            // Prüfen, ob einem Deeplink gefolgt werden muss, falls ja: true zurückliefern und
            // dem Link wird gefolgt ...
            if (followDeeplink(event)) { return true; }


            // Auf Touch-Geräten bleibt das Keyboard sichtbar, wenn ein anderes Menu-Element
            // ausgewählt wurde. Hiermit wird das Keyboard versteckt.
            $('input').blur();


            if (isSmallViewActive() ) {

                if (Modernizr.csstransitions && useAnimations) {
                    // Animation: Submenu Schließen
                    var openSubMenu = $('.m-01-active').last().children('.m-01-sub-menu');

                    if (openSubMenu.length > 0 && openSubMenu.find($menuItemTarget).length <= 0) {

                        var height = openSubMenu.height();

                        openSubMenu.css('overflow', 'hidden').height(height);

                        window.setTimeout(function() {

                            var animationHeight = $menuItemTarget.attr('id') == '#m-01-main-menu-button' ? '84px' : 0;

                            openSubMenu.height(height).gpAnimate({ height: animationHeight }, animationDuration, animationEasing, 0, function() {

                                openSubMenu.removeAttr('style');
                                closeSubmenus();
                                openCloseSubMenus(shouldOpenSubmenu, $menuItemTarget);
                            });

                        }, 0);


                    } else {

                        closeSubmenus();
                        openCloseSubMenus(shouldOpenSubmenu, $menuItemTarget);
                    }

                } else {
                    closeSubmenus();
                    openCloseSubMenus(shouldOpenSubmenu, $menuItemTarget);
                }


                if (!shouldOpenSubmenu) {

                    if ($menuItemTarget.children('#m-01-main-menu-button').length == 0
                            && scrollToOpenMenu) {

                        var duration = scrollToOpenMenuAnimated ? scrollAnimationDuration : 0;

                        $('html, body').animate({
                            scrollTop: 1
                        }, duration);
                    }
                }

            } else {

                // Zunächst alle Submenus schließen
                closeSubmenus();
                openCloseSubMenus(shouldOpenSubmenu, $menuItemTarget);
            }


            event.stopImmediatePropagation();
            event.stopPropagation();
            event.preventDefault();

            $(document).trigger('m-01-activateflyout', $menuItemTarget);
            return false;
        }


        function handleClickOutsideMenu(event) {


            if (isPageScrollingByTouch) {
                return isPageScrollingByTouch = false;
            }


            var $eventTarget = $(event.target);

            if ($eventTarget.closest(menuItemSelector).length > 0) {
                return;
            }

            if (isSmallViewActive()) {
                if ($eventTarget.closest(mainNavigationSelector).length > 0) {
                    return;
                }
            } else {
                if ($eventTarget.closest($('#m-01-shopping-tools-link').parent()).length > 0
                        || $eventTarget.closest('#m-01-model-menu').length > 0) {
                    return;
                }
            }

            if (isSubmenuOpen()) {
                $html.off(clickOutsideMenuEvent);
                clickOutsideMenuActive = false;
                openCloseSubMenus(false, $mainNavigation.children('.m-01-menu-item').first())

                closeSubmenus();
                hidePageOverlay();

            }

            // Überprüfen und "Triggern" zusätzlicher Aktionen, falls ein Modelflyout geöffnet
            // oder geschlossen wird.
            chechModelFlyoutState($lastOpenModelFlyout);

            event.preventDefault();
            return false;
        }


        // --- MOUSEOVER VERHALTEN ----------------------------------------------------------------

        function handleMouseEnterMenuItem(event) {

            // IE 10 Surface Fix
            if (event.originalEvent.pointerType
                    && (event.originalEvent.pointerType == event.originalEvent.MSPOINTER_TYPE_TOUCH)) {
                return false;
            }

            var $linkTarget       = $(event.currentTarget)
              , $menuItemTarget   = $linkTarget.closest(menuItemSelector);

            chechModelFlyoutState($menuItemTarget);
        }

        function handleMouseOverMenuItem(event) {

            // IE 10 Surface Fix
            if (event.originalEvent.pointerType
                    && (event.originalEvent.pointerType == event.originalEvent.MSPOINTER_TYPE_TOUCH)) {
                return false;
            }

            event.stopPropagation();

            if ($(event.target).closest('#m-01-dealer-search-form').length > 0
                    || $(event.target).closest('#m-01-site-search-form').length > 0
                    || $(event.currentTarget).closest('#m-01-car-configurator-button').length > 0) {
                return;
            }

            displayPageOverlay();
        }

        function handleMouseLeaveMenuItem(event) {

            // IE 10 Surface Fix
            if (event.originalEvent.pointerType
                    && (event.originalEvent.pointerType == event.originalEvent.MSPOINTER_TYPE_TOUCH)) {
                return false;
            }

            var $linkTarget       = $(event.currentTarget)
              , $menuItemTarget   = $linkTarget.closest(menuItemSelector)
              , $linkRelatetTarget = $(event.relatedTarget);

            chechModelFlyoutState($menuItemTarget);

            event.stopPropagation();
            if(!($linkRelatetTarget.parents(menuItemSelector).length > 0)) {
                hidePageOverlay();
            }
        }


        // --- MODEL FLYOUT VERHALTEN -------------------------------------------------------------

        function chechModelFlyoutState($menuItemTarget) {

          //$(document).trigger('m-01-activateflyout', $menuItemTarget);
          return;

            if ($menuItemTarget) {
                //var $modelFlyout = $menuItemTarget.children('.m-01-sub-menu .m-01-model-information');
              var $modelFlyout = $menuItemTarget.find('.m-01-level-3 > .m-60-module-wrapper');

                if ($lastOpenModelFlyout) {
                    if ($lastOpenModelFlyout != $modelFlyout) {
                        handleCloseModelFlyout($lastOpenModelFlyout);
                        $lastOpenModelFlyout = null;
                    }
                }

                if (!!$modelFlyout.length) {
                  //if ($modelFlyout.is(':visible')) {
                    handleOpenModelFlyout($menuItemTarget);
                    $lastOpenModelFlyout = $modelFlyout;
                  //}
                }
            }
        }



        function handleOpenModelFlyout($menuItemTarget) {
            //console.log('OPEN MODEL FLYOUT');
            //console.log($modelFlyout);
          //alert('OPEN MODEL FLYOUT');


          //var $currentSeriesFlyout = $menuItemTarget.find('.m-60-model-series.active');
          //if ($currentSeriesFlyout.length === 0) {
          //  $(document).trigger('m-01-activateflyout', $menuItemTarget);
          //}
          //else {
          //
          //}


            //var $img = $modelFlyout.find('.m-01-model-figure > img[data-image-src]');
            //if ($img.length > 0) {
            //  ;
            //    /*
            //    image_swapOne($img);
            //    image_scaleOne($img);

            //        setImageSize(false, '.m-01-model-figure > ', '');

            //        //console.log($img);
            //        var currentSrc = $img.attr('src');
            //        var dataSrc = $img.attr('data-image-src');
            //        if (currentSrc != dataSrc) {
            //            var s = $img.attr('data-size');
            //            $img.attr('src', dataSrc + s);
            //            //console.log(dataSrc);
            //        }
            //    */
            //}
        }

        function handleCloseModelFlyout($modelFlyout) {
            //console.log('CLOSE MODEL FLYOUT');
            //console.log($modelFlyout);
        }


    });


})(jQuery, this, this.document);
; (function ($, window, document) {
  'use strict';
  
  var debug_m101 = false;
  var M101_menu = null;
  
  // utility methods
  var UTIL = {
    log: function (args) {
      if (debug_m101 === false) {
        return;
      }
      // for(in) -> variant 3 of http://stackoverflow.com/questions/9329446/for-each-over-an-array-in-javascript#answer-9329476
      var key = null;
      for (key in args) {
        if (args.hasOwnProperty(key) &&      // These are explained
          /^0$|^[1-9]\d*$/.test(key) &&    // and then hidden
          key <= 4294967294                // away below
        ) {
          if (typeof (console) !== 'undefined') {
            console.log(args[key]);
          }
        }
      }
    },
    cancelEvent: function (event) {
      event.preventDefault();
      event.stopImmediatePropagation();
      event.stopPropagation();
    }
  };
  
  // mobile navigation module
  var M101 = function () {
    
    //////////////
    // members
    //
    var self = this;
    
    self.imageScaler = new ScaleHandler();
    self.classNames = {
      'backlink': 'm-101__backlink',
      'menulink': 'm-101__menuitem',
      'modelmenulink': 'm-101__menuitem--model',
      'shoppinglink': 'm-101__shopping-button',
      'menuopen': 'm-101__open',
      'overflowHidden': 'g__no-overflow-y',
      'menuImageWrapper': 'm-101__menuitem--image',
      'modelInfo' : 'm-101__model--info',
      'model' : 'm-101__model',
      'disclaimer' : 'm-101__menuitem--disclaimer',
      'navigation' : 'm-101__navigation',
      'menu': 'm-101__menu'
    };
    self.eventNamespace = 'm101_mainNavigation';
    self.msPointerEnabled = false;
    self.clickEventType = 'click';
    self.eventNames = {
      'click': self.clickEventType + '.' + self.eventNamespace
    };
    self.$refs = {};
    
    //////////////
    // methods
    //
    self.init = function () {
      // determine click type to handle
      self.msPointerEnabled = window.navigator.msPointerEnabled ? window.navigator.msPointerEnabled : false;
      self.clickEventType = self.msPointerEnabled ? 'MSPointerUp' : (window.ontouchstart ? 'touchstart' : 'click');

      // set dom references
      self.setReferences();

      // bind event handlers
      self.bindEvents();
      
      UTIL.log([self.msPointerEnabled, self.clickEventType]);
      
    };
    
    self.destroy = function () {
      self.unbindEvents();
    };
    
    self.setPriceData = function (evt, data) {
      
      UTIL.log(['document' + '::' + 'modelDataAvailable', evt, data]);

      // Tan: andere maerkte haben evtl. mehr disclaimer
      // von daher muesste evtl. das disclaimer object in der tech data geaendert werden
      // und dann hier durhcgeloopt werden
      // set footnote
      $("." + self.classNames.navigation + "[data-menu='models'] ." + self.classNames.menu).append(
          "<div class='" + self.classNames.menulink + "'>" +
          "<div class='" + self.classNames.disclaimer + "'></div>" +
          "</div>"
      );

      // global carrange footnotes
      var carRangeFootnotes = [];
      for(var i = 0; i < window.modelData.carrange.footnotes.length; i++) {
        carRangeFootnotes.push(window.modelData.carrange.footnotes[i]);
      }
      // set price for car ranges
      $('*[data-menu="models"] > .m-101__menu > *[data-target-menu]').each(function () {
        var $currentCarrange = $(this);
        var name = $currentCarrange.data("target-menu").toString().toLowerCase()
            , price = 0
            , $priceDisclaimer = $currentCarrange.parent().find('.' + self.classNames.menulink + ' > .' + self.classNames.disclaimer);

        var carRange = _.findWhere(window.modelData.carrange.ranges, {"id": name});
        if (typeof carRange !== "undefined") {
          if (typeof carRange.price !== "undefined" && carRange.price.length > 0) {
            var price = carRange.price[0];
            var priceLabel = price.value;

            if ((typeof price.mark !== 'undefined') && price.mark !== '' && priceLabel.indexOf(price.mark) === -1) {
              priceLabel += price.mark;
            }

            $(this).find("." + self.classNames.model + " ." + self.classNames.modelInfo).eq(0).text(priceLabel);
          }

          // add unique car range footnotes
          if(typeof carRange.footnotes !== 'undefined') {
            for (var i = 0; i < carRange.footnotes.length; i++) {
              var footnote = carRange.footnotes[i];
              if(typeof (_.findWhere(carRangeFootnotes, footnote)) === 'undefined') {
                carRangeFootnotes.push($.extend(true, {}, footnote));
              }
            }
          }
        }

        // modelseries price and footnotes for current car range
        var modelSeriesFootnotes = [];
        $currentCarrange.find('*[data-menu="' + name + '"] *[data-modelseries]').each(function() {
          var $currentSeries = $(this);
          var name = $currentSeries.data("href")
              , price = 0
              , $priceDisclaimer = $currentSeries.parent().find('.' + self.classNames.menulink + ' > .' + self.classNames.disclaimer);

          var modelSeries = _.findWhere(window.modelData.series, {"id": name});
            if (typeof modelSeries !== "undefined") {

            var prices = self._getPriceObject(modelSeries);
            var footnotes = self._getFootnoteObject(modelSeries);

            if (typeof prices !== "undefined") {
              var price = prices[0];
              var priceLabel = price.value;

              if ((typeof price.mark !== 'undefined') && price.mark !== '' && priceLabel.indexOf(price.mark) === -1) {
                priceLabel += price.mark;
              }

              $(this).find("." + self.classNames.modelInfo).eq(0).text(priceLabel);
            }

            // unique footnotes for current modelseries menu
            if(typeof footnotes !== 'undefined') {
              for (var i = 0; i < footnotes.length; i++) {
                var footnote = footnotes[i];
                if(typeof (_.findWhere(modelSeriesFootnotes, footnote)) === 'undefined') {
                  // add unique footnote and add to output
                  modelSeriesFootnotes.push($.extend(true, {}, footnote));
                  var footnoteData = (footnote.mark !== '' ? footnote.mark + ' ' : '') + footnote.value;
                  $priceDisclaimer.append('<p style="margin-top:0;">' + footnoteData + '</p>');
                }
              }
            }
          }
        });
      });

      // footnotes for car range menu
      var $priceDisclaimer = self.$refs.models.find('*[data-menu="models"]' + ' > .m-101__menu > .m-101__menuitem > .' + self.classNames.disclaimer);
      for(var i = 0; i < carRangeFootnotes.length; i++) {
        var footnote = carRangeFootnotes[i];
        var footnoteData = (footnote.mark !== '' ? footnote.mark + ' ' : '') + footnote.value;
        $priceDisclaimer.append('<p style="margin-top:0;">' + footnoteData + '</p>');
      }


    };

    self._getPriceObject = function (modelSeries) {
      if(typeof modelSeries.price === "undefined" || modelSeries.price.length === 0) {
        var model = _.findWhere(window.modelData.models, {"id" : modelSeries.modelrefid, "year": modelSeries.modelrefyear});
        if(typeof model === 'undefined') {
          return model;
        }
        return model.price;
      }
      modelSeries.price;
    };

    self._getFootnoteObject = function (modelSeries) {
      if(typeof modelSeries.footnotes === "undefined" || modelSeries.footnotes.length === 0) {
        var model = _.findWhere(window.modelData.models, {"id" : modelSeries.modelrefid, "year": modelSeries.modelrefyear});
        if(typeof model === 'undefined') {
          return model;
        }
        return model.footnotes;
      }
      modelSeries.footnotes;
    };

    self.setReferences = function() {
      self.$refs.root = $('.m-101__button-bar');
      self.$refs.models = self.$refs.root.find('> .' + self.classNames.menulink + '[data-target-menu="models"]');
      if(self.$refs.models.length === 0) {
        self.$refs.models = $('body > .pid__topbar-navigation ' + '.' + self.classNames.menulink + '[data-target-menu="models"]');
      }
      self.$refs.home = self.$refs.root.find('> .' + self.classNames.menulink + '[data-target-menu="home"]');
    }

    self.bindEvents = function () {

      // preload model images after page has finished loading
      $(window).on('load', function(evt){
        if($('.m-101__trigger[data-target-menu="models"]:visible').length < 1) {
          return;
        }

        var $modelsMenu = self.$refs.models.find('> .m-101__navigation[data-menu="models"]');

        self.scaleImages($modelsMenu);
        $modelsMenu.find("*[data-menu]").each(function(){
          self.scaleImages($(this));
        });
      });
      
      // global events
      $(document).on('modelDataAvailable', self.setPriceData);
      
      // close submenu links
      $('.' + self.classNames.backlink).on(self.eventNames.click, function (evt) {
        
        UTIL.log([self.classNames.backlink + '::' + self.eventNames.click, evt]);  // log event data
        UTIL.cancelEvent(evt);                                                       // stop event bubbling
        
        var $menuToClose = $(this).parent().parent();
        $menuToClose.removeClass(self.classNames.menuopen);
        
        // top level backlink
        if ($menuToClose.attr('data-toplevel') === 'true') {
          $('html').removeClass(self.classNames.overflowHidden);
        }
        
        return false;
      });
      
      // open submenu links
      $('.' + self.classNames.menulink + '[data-target-menu]').on(self.eventNames.click, function (evt) {

        UTIL.log([self.classNames.menulink + '::' + self.eventNames.click, evt]);  // log event data
        UTIL.cancelEvent(evt);                                                       // stop event bubbling
        
        // only handle direct clicks
        if ((evt.target.className.indexOf('m-101__menuitem__text') < 0)
          && (evt.target.className.indexOf('m-101__button__text') < 0)
          && (evt.target.nodeName !== 'NOBR')) {
          return false;
        }
        
        var $menuToOpen = $(this).find('*[data-menu=' + $(this).data('target-menu') + ']');
        $menuToOpen.addClass(self.classNames.menuopen);
        self.scaleImages($menuToOpen);
        
        // top level backlink
        if ($menuToOpen.attr('data-toplevel') === 'true') {
          $('html').addClass(self.classNames.overflowHidden);
        }
        
        return false;
      });
      
      // open model menu links
      $('.' + self.classNames.modelmenulink + '[data-target-menu]').on(self.eventNames.click, function (evt) {
        
        UTIL.log([self.classNames.modelmenulink + '::' + self.eventNames.click, evt]);  // log event data
        UTIL.cancelEvent(evt);                                                          // stop event bubbling
        
        // only handle direct clicks
        if ((evt.target.className.indexOf('m-101__menuitem--image') < 0)
          && (evt.target.className.indexOf('m-101__model') < 0)
          && (evt.target.nodeName !== 'IMG')
          && (evt.target.nodeName !== 'NOBR')) {
          return false;
        }
        
        var $menuToOpen = $(this).find('*[data-menu=' + $(this).data('target-menu') + ']');
        $menuToOpen.addClass(self.classNames.menuopen);
        self.scaleImages($menuToOpen);


        // top level backlink
        if ($menuToOpen.attr('data-toplevel') === 'true') {
          $('html').addClass(self.classNames.overflowHidden);
        }
        
        return false;
        
      });
      
      // "goto" links
      $('.' + self.classNames.modelmenulink + '[data-href]').on(self.eventNames.click, function (evt) {
        
        UTIL.log([self.classNames.modelmenulink + '::' + self.eventNames.click, evt]);  // log event data
        UTIL.cancelEvent(evt);                                                          // stop event bubbling
        
        // only handle direct clicks
        if ((evt.target.className.indexOf('m-101__menuitem--image') < 0)
          && (evt.target.className.indexOf('m-101__model') < 0)
          && (evt.target.nodeName !== 'IMG')
          && (evt.target.nodeName !== 'NOBR')
          && (evt.target.className.indexOf('m-101__menuitem--model') < 0)) {
          return false;
        }
        
        // goto url
        document.location.href = $(this).data('href');
        
      });
      $('.' + self.classNames.menulink + '[data-href]').on(self.eventNames.click, function (evt) {
        
        UTIL.log([self.classNames.menulink + '::' + self.eventNames.click, evt]);  // log event data
        UTIL.cancelEvent(evt);                                                          // stop event bubbling
        
        // only handle direct clicks
        if ((evt.target.className.indexOf('m-101__menuitem__text') < 0)
          && (evt.target.className.indexOf('m-101__button__text') < 0)
          && (evt.target.nodeName !== 'NOBR')) {
          return false;
        }
        
        // goto url
        document.location.href = $(this).data('href');
        
      });
      $('.' + self.classNames.shoppinglink + '[data-href]').on(self.eventNames.click, function (evt) {
        
        UTIL.log([self.classNames.shoppinglink + '::' + self.eventNames.click, evt]);  // log event data
        UTIL.cancelEvent(evt);                                                          // stop event bubbling
        
        // goto url
        document.location.href = $(this).data('href');
        
      });
    };
    
    self.unbindEvents = function () {
      $(document).off('modelPriceDataAvailable');
      $('.' + self.classNames.backlink).off(self.eventNames.click);
      $('.' + self.classNames.menulink + '[data-target-menu]').off(self.eventNames.click);
      $('.' + self.classNames.modelmenulink + '[data-target-menu]').off(self.eventNames.click);
      $('.' + self.classNames.modelmenulink + '[data-href]').off(self.eventNames.click);
      $('.' + self.classNames.menulink + '[data-href]').off(self.eventNames.click);
      $('.' + self.classNames.shoppinglink + '[data-href]').off(self.eventNames.click);
    };
    
    self.scaleImages = function ($root) {
      $root.find(' > .m-101__menu > .m-101__menuitem--model > .' + self.classNames.menuImageWrapper + ' > img').each(function () {
        var $el = $(this);
        var scaleParam = self.imageScaler.getScaleParameter($el);
        self.imageScaler.replaceSource($el, $el.attr('data-image-src'), scaleParam);
      });
    };
  };
  
  // init navigation module
  if (typeof (jQuery !== 'undefined')) {
    M101_menu = new M101();
    jQuery(document).ready(function () {
      M101_menu.init();
    });
  }
  else {
    UTIL.log('M101::jQuery is undefined');
  }
  
  
})(jQuery, this, this.document);;(function ($, window, document, undefined) {
    'use strict';

    var imageScaler,
        debug;

    $(document).ready(function () {
        _lazyInit();
    });

    function _lazyInit()
    {
        var moduleClass = 'm-105-teaser',
            $elements = $('.' + moduleClass);

        if($elements.length > 0)
        {
            imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

            $elements.each(function (i, el) {
                var $el = $(el);
                if (window.pageController)
                {
                    $el.one(window.pageController.eventNames.lazyInit, function () {
                        _init($el);
                    });
                }
                else
                {
                    _init($el);
                }
            });
        }
    }

    function _m105ImageScaler($tile)
    {
        $tile.each(function () {
            var $el = $(this).find(".m-105-tile__image"),
                scaleParam = debug ? '' : imageScaler.getScaleParameter($el);

            imageScaler.replaceSource($el, $el.attr('data-image-src'), scaleParam);
        });
    }

    function _getSlickOptions()
    {
        return {
          arrows: false,
          adaptiveHeight: false,
          dots: true,
          mobileFirst: true,
	        infinite: false,
          slidesToShow: 1,
          slidesToScroll: 1,
            responsive: [
                {
                    breakpoint: 1199,
                    settings: {
                        slidesToShow: 4,
                        slidesToScroll: 3,
                        arrows: true
                    }
                },
                {
                    breakpoint: 991,
                    settings: {
                        slidesToShow: 4,
                        slidesToScroll: 1
                    }
                },
                {
                    breakpoint: 479,
                    settings: {
                        slidesToShow: 2,
                        slidesToScroll: 1
                    }
                }
            ]
        };
    }

    function _init($el)
    {
        var $slider = $el.find(".m-105-slider-container"),
            $tile = $el.find(".m-105-tile");

        if ($slider.length > 0)
        {
            $slider.slick(_getSlickOptions());
            _m105ImageScaler($tile);
        }

        window.pageController && window.pageController.refresh();
    }
})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
  'use strict';

  var imageScaler,
      hasTouch,
      debug = false;

  $(document).ready(function () {
    _lazyInit();
  });

  function _lazyInit() {
    var moduleClass = 'm-107-car-range',
        $elements = $('.' + moduleClass);

    if ($elements.length > 0) {
      hasTouch = $("html").hasClass("touch");
      imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

      $elements.each(function (i, el) {
        var $el = $(el);
        if (window.pageController) {
          $el.one(window.pageController.eventNames.lazyInit, function () {
            _init($el);
            window.pageController.refresh();
          });
        }
        else {
          _init($el);
        }
      });
    }
  }


  function _init($el) {
    var $tiles = $el.find(".m-107-tile"),
        $priceDisclaimer = $el.find('.pricedisclaimer'),
        hoverClass = "m-107--is-hovered";

    _m107bindEvents($tiles, $priceDisclaimer, hoverClass);
    _m107ImageScaler($tiles);
  }

  function _m107ImageScaler($tiles) {
    $tiles.each(function () {
      var $el = $(this).find(".m-107-tile__image"),
          scaleParam = debug ? '' : imageScaler.getScaleParameter($el);

      imageScaler.replaceSource($el, $el.attr('data-image-src'), scaleParam);
    });
  }


  function _m107bindEvents($tiles, $priceDisclaimer, hoverClass) {
    $(document).one('modelDataAvailable', function (e, data) {
      _m107_onModelDataAvailable(data, $tiles, $priceDisclaimer)
    });

    if (!hasTouch) {
      _m107Events($tiles, hoverClass);
    }
  }

  function _m107Events($tiles, hoverClass) {
    $tiles.on("mouseenter", function (e) {
      $(this).addClass(hoverClass);
    });
    $tiles.on("mouseleave", function (e) {
      $(this).removeClass(hoverClass);
    });
  }

  function _m107_onModelDataAvailable(data, $tiles, $priceDisclaimer) {

    $tiles.each(function (i, e) {
      var name = $(this).find('.m-107-tile__headline span').text().toLowerCase();
      var carRange = _.findWhere(window.modelData.carrange.ranges, {"id" : name});

      if (typeof carRange !== "undefined") {
        if (typeof carRange.price !== "undefined" && carRange.price.length > 0) {
          var price = carRange.price[0];
          var priceLabel = price.value;

          if ((typeof price.mark !== 'undefined') && price.mark !== '' && priceLabel.indexOf(price.mark) === -1) {
            priceLabel += price.mark;
          }

          $(this).find('.m-107-tile__info .m-107-info__price').text(priceLabel);
        }

        // TODO: -> check if individual carrange footnotes must be added
        //for (var i = 0; i < carrange.footnotes.length; i++) {
        // var footnote = carRange.footnotes[i];
        // var footnoteData = footnote.mark !== '' ? footnote.mark + ' ' : '' + footnote.value;
        // $priceDisclaimer.append('<p style="margin-top:0;">' + footnoteData + '</p>');
        //}
      }
    });

    for (var i = 0; i < window.modelData.carrange.footnotes.length; i++) {
      var footnote = window.modelData.carrange.footnotes[i];
      var footnoteData = (footnote.mark !== '' ? footnote.mark + ' ' : '') + footnote.value;
      $priceDisclaimer.append('<p style="margin-top:0;">' + footnoteData + '</p>');
    }
  }

})(jQuery, this, this.document);$(function () {

  function M_92() {

    var SliderColumn = $('.m-92-leasing-calculator-wrapper .slider-wrapper .sliderColumn');
    var SliderColumnClassArray = [];
    var numberOfSliderColumn = SliderColumn.length;
    var jsonObject;
    var defaultTerm;
    var defaultKilometersperannum;
    var defaultDeposit;
    var summe = !!$('.result .entity .summe').length;
    var term = [];
    var kilometersperannum = [];
    var ballon_empty = false;
    var deposit = [];
    var _Total = [];
    var _init = false;
    var _initArr = [];
    var _paramSetting = false;
    var _secondSumme;
    var _energyefficiencyclass = false;

    if (!!!$('.m-92-leasing-calculator-wrapper').length) return;

    var leasingcalculator_europe = function (fn) {
      var processElementsInArray = function (arr, order) {
        var _array = arr;
        var _uniqueElements = [];
        $.each(_array, function (i, el) {
          if ($.inArray(el, _uniqueElements) === -1) _uniqueElements.push(el);
        });
        if (typeof order == "undefined" || order == 1) {
          _uniqueElements = _uniqueElements.sort(function (a, b) { return a - b });
        }
        if (order == -1) {
          _uniqueElements = _uniqueElements.sort(function (a, b) { return b - a });
        }
        return _uniqueElements;
      };

      var dataObject = {
        term: '',
        kilometersperannum: '',
        deposit: '',
        arrDeposit: '',
        search: function (jsonObject) {
          var _arrTerm = [];
          var _arrKilometersperannum = [];
          var _arrDeposit = [];

          for (var i = 0; i < jsonObject.length; i++) {
            if (jsonObject[i]["term"] == this.term) {
              _arrTerm.push(jsonObject[i]);
            }
          };
          for (var j = 0; j < _arrTerm.length; j++) {
            if (_arrTerm[j]["kilometers_per_annum"] == this.kilometersperannum) {
              _arrKilometersperannum.push(_arrTerm[j]);
            }
          };
          for (var k = 0; k < _arrKilometersperannum.length; k++) {
            if (_arrKilometersperannum[k]["deposit_in_percent"] == this.deposit) {
              _arrDeposit.push(_arrKilometersperannum[k]);
            }
          };
          this.arrDeposit = _arrDeposit;

          try {
            if (_arrDeposit.length == 1) {
              $('#m-92-price').text(new tools().numberFormat(Math.round(_arrDeposit[0]["upe"]), 3, '.')); // die Abrundung   
              $('.summe').html(new tools().numberFormat(Math.round(_arrDeposit[0]["leasing"].replace(/.[a-zA-Z]/g, '')), 3, '.'));
              if (typeof _secondSumme != "undefined") {
                $('.result .entity:eq(1) .summe').html(new tools().numberFormat(Math.round(_arrDeposit[0][_secondSumme].replace(/.[a-zA-Z]/g, '')), 3, '.'));
              }
              $('.deposit .text-rate-summe').text(new tools().numberFormat(parseInt(_arrDeposit[0]["deposit_in_percent"]), 3, '.'));
            }
            else {
              $('#m-92-price').text("N/A");
              $('.summe').text("N/A");
              $('.deposit .text-rate-summe').text("N/A");
              throw new Error("no or more results is/are found");
            }
          }
          catch (e) {
            console.log(e);
          }
        }
      };

      var jsonData = $.get(leasingjsonurl.replace(/&amp;/g, '&'), function (e) {
        jsonObject = e.leasingdata;
        var _lengthOfArray = jsonObject.length;

        for (i in jsonObject) {
          term.push(parseInt(jsonObject[i]["term"]));
        };
        for (i in jsonObject) {
          kilometersperannum.push(parseInt(jsonObject[i]["kilometers_per_annum"]));
        };
        for (i in jsonObject) {
          deposit.push(parseInt(jsonObject[i]["deposit_in_percent"]));
        };

        if (parseInt(leasingcalculator_term) >= 0 && parseInt(leasingcalculator_kilometers_per_annum) >= 0 && parseInt(leasingcalculator_deposit) >= 0) {
          _init = true;
          var configMapping = { "term": [24, 36, 48], "kilometers_per_annum": [10000, 15000, 20000], "deposit": [10, 15, 20] };

          var _initArrPush = function () {
            _initArr.push(leasingcalculator_term);
            _initArr.push(leasingcalculator_kilometers_per_annum);
            _initArr.push(leasingcalculator_deposit);
          }

          if (!!new tools().geturlparam("term") && !!new tools().geturlparam("kilometers_per_annum") && !!new tools().geturlparam("deposit") && !!configMapping.term[new tools().geturlparam("term")] && !!configMapping.kilometers_per_annum[new tools().geturlparam("kilometers_per_annum")] && !!configMapping.deposit[new tools().geturlparam("deposit")]) {
            _paramSetting = true;
            _initArr.push(configMapping.term[new tools().geturlparam("term")]);
            _initArr.push(configMapping.kilometers_per_annum[new tools().geturlparam("kilometers_per_annum")]);
            _initArr.push(configMapping.deposit[new tools().geturlparam("deposit")]);
          } else { _initArrPush(); }
        }
        term = processElementsInArray(term);
        kilometersperannum = processElementsInArray(kilometersperannum);
        deposit = processElementsInArray(deposit);

        _Total.push(term);
        _Total.push(kilometersperannum);
        _Total.push(deposit);

        for (var i = 0; i < numberOfSliderColumn; i++) {
          makeSlider(_Total, i);
        };
        setStyle();
        dataObject.search(jsonObject);
        _init = false;
        registerPoints();
        $('.sliderColumn.deposit .text-rate-summe').text(new tools().numberFormat(parseInt(dataObject.arrDeposit[0].deposit), 3, '.'));
        $('.sliderColumn.deposit .slider-header span').eq(0).append("<br/>");
        $('.energy_efficiency_class .value').text(dataObject.arrDeposit[0].energy_efficiency);

        if (_paramSetting) {
          _paramSetting = false;
          $('.m-92-module-right .slider-context span.point').each(function (i, e) {
            $('.slider').eq(i).slider('option').slide(null, { value: $('.slider').eq(i).slider('value') });
          });
        }

        if (typeof fn == "function") fn();

      });

      var makeSlider = function (arr, i) {

        var _templateString = '<div class="value_min"><div class="number">' + arr[i][0] + '</div><span class="point"></span></div>';
        for (var j = 1; j < arr[i].length - 1; j++) {
          _templateString += '<div class="value"><div class="number">' + arr[i][j] + '</div><span class="point"></span></div>';
        }
        _templateString += '<div class="value_max"><div class="number">' + arr[i][arr[i].length - 1] + '</div><span class="point"></span></div>';


        SliderColumn.eq(i).addClass(SliderColumnClassArray[i]);
        SliderColumn.eq(i).find('.slider-context').append(_templateString);
        Regler(i, arr[i].length - 1);
        Distance(i, arr[i].length - 1);
      };

      var Regler = function (n, m) {
        SliderColumn.eq(n).find('.slider').slider({
          range: "max",
          min: parseInt(_Total[n][0]),
          max: parseInt(_Total[n][_Total[n].length - 1]),
          step: parseInt((_Total[n][_Total[n].length - 1] - _Total[n][0]) / m),
          value: (!!_init) ? parseInt(_initArr[n]) : parseInt(_Total[n][0]),
          slide: function (event, ui) {
            getPrice(n, ui.value);
            dataObject.search(jsonObject);
            $('.sliderColumn.deposit .text-rate-summe').text(new tools().numberFormat(parseInt(dataObject.arrDeposit[0].deposit), 3, '.'));

            $('.energy_efficiency_class .value').text(dataObject.arrDeposit[0].energy_efficiency);
          }
        });
        getPrice(n, _Total[n][0]);
      };

      var registerPoints = function () {
        $('.m-92-module-right .slider-context span.point').each(function (i, e) {
          $(e).on('click', function () {
            var _newValue = ($(this).parent().find('.number').text().replace('.', ''));
            var _whichSlider = ($('.sliderColumn').index($(this).parentsUntil('.sliderColumn').parent()));
            $('.slider').eq(_whichSlider).slider('value', _newValue);
            $('.slider').eq(_whichSlider).slider('option').slide(null, { value: _newValue });
          });
        });
      };

      var Distance = function (i, m) {
        if (m >= 2) {
          SliderColumn.eq(i).find('.value_min').css('width', (1 / (m)) * 100 + '%');
          SliderColumn.eq(i).find('.value').css('width', (1 / (m)) * 100 + '%');
        }
      };

      var setStyle = function () {
        $('.slider-context .number').each(function (i, e) {
          var _thisNumber = parseInt($(e).text());
          $(e).text(new tools().numberFormat(_thisNumber, 3, "."));
        });
      };

      var getPrice = function (n, value) {
        switch (n) {
          case 0:
            dataObject.term = (!!_init) ? leasingcalculator_term : value;
            break;
          case 1:
            dataObject.kilometersperannum = (!!_init) ? leasingcalculator_kilometers_per_annum : value;
            break;
          case 2:
            dataObject.deposit = (!!_init) ? leasingcalculator_deposit : value;
            break;
        }
      };

      var tools = function () {
        // z.B. (21321312316, 3, '.') oder (21321312316, 3, ',')
        this.numberFormat = function (number, n, t, currency) {
          if (typeof number != "number" || typeof n != "number" || typeof t == "undefined" || t.length == 0) return;
          var _number = number;
          _number = _number.toString().split("").reverse();
          var newNumberArray = [];
          var newNumberString = "";
          var flag = 0;
          for (var i = 0; i < _number.length; i++) {
            if (flag == n) {
              newNumberArray.push(t);
              flag = 0;
            }
            flag++;
            newNumberArray.push(_number[i]);
          };
          newNumberArray = newNumberArray.reverse();
          for (var j = 0; j < newNumberArray.length; j++) {
            newNumberString += newNumberArray[j];
          };
          if (!!currency) {
            switch (currency) {
              case 'germany':
                newNumberString = newNumberString + ',00';
                break;
            }
          }
          return newNumberString;
        },
        this.geturlparam = function geturlparam(name) {
          name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
          var regexS = "[\\?&]" + name + "=([^&#]*)";
          var regex = new RegExp(regexS);
          var results = regex.exec(window.location.href);
          if (results == null) {
            return "";
          } else {
            return results[1];
          }
        },
        this.layer = function (data) {
          this.makeLayer = function (data) {
            var _layerTemplate = '';
            if (typeof data == 'string' && data.length != 0) {
              _layerTemplate = data + '<a id="close" href="javascript:void(0)" />';
              $('#layer').html(_layerTemplate);
              $('#layer').show();
              $('.m-92-leasing-calculator-wrapper').addClass('layer');
              $('html, body').animate({
                scrollTop: $(".m-92-leasing-calculator-wrapper.layer").parent().offset().top
              }, 1000);

            };
            $('#layer #close').one('click', function () {
              $('#layer').empty();
              $('#layer').hide();
              $('.m-92-leasing-calculator-wrapper').removeClass('layer');
            });
            return this;
          },
          this.dataInjection = function (data) {
            var _data = data[0];

            $('#layer .m-92-leasing-calculator-layer-content-wrapper').html($('#layer .m-92-leasing-calculator-layer-content-wrapper').html()
            .replace("###UPE###", new tools().numberFormat(parseInt(_data.upe), 3, '.'))
            .replace("###SPECIALPAYMENT###", new tools().numberFormat(parseInt(_data.deposit_in_percent), 3, '.') + " %")
            .replace("###TERM###", _data.term)
            .replace("###KPA###", new tools().numberFormat(parseInt(_data.kilometers_per_annum), 3, '.'))
            .replace("###DEPOSIT###", new tools().numberFormat(parseInt(_data.deposit), 3, '.'))
            .replace("###TOTAL###", new tools().numberFormat(parseInt(_data.total), 3, '.'))
            .replace("###LEASING###", new tools().numberFormat(Math.round(_data.leasing), 3, '.'))
            .replace("###NETLOAN###", new tools().numberFormat(Math.round(_data.net_loan), 3, '.')) //parseInt(_data.net_loan))
            .replace("###INTERESTRATE###", (parseFloat(_data.interest_rate).toFixed(4) * 100).toFixed(2))
            .replace("###ANNUALPERCENTAGERATE###", (parseFloat(_data.annual_percentage_rate).toFixed(4) * 100).toFixed(2))
            .replace("###TOTALAMOUNT###", new tools().numberFormat(Math.round(_data.total_amount), 3, '.'))
            .replace("###RATENOLEASINGS###", new tools().numberFormat(Math.round(_data.rate_no_leasing_s), 3, '.')))
            return this;
          }
          return this;
        },
        this.markerReplace = function (place, marker, result) {
          var _marker = marker;
          var _place = place;
          $(_place).html($(_place).html().replace(marker, result));

        }
      };

      $('.m-92-module-right .result .entity .info').on('click', function () {
        new tools().layer().makeLayer(leasingcalculatorlayercontent).dataInjection(dataObject.arrDeposit);
      });

      $('.m-92-module-right .gui-btn.gui-link-with-article').on('click', function (e) {
        e.preventDefault();
        var _href = $(this).attr('href');
        //var _imageHref = location.origin + encodeURI($('#techspecs').find('.m-09-techspecs-pattern .img-wrapper img').attr('src'));
        var _imageHref = encodeURI($('#techspecs').find('.m-09-techspecs-pattern .img-wrapper img').attr('src'));
        var _formular = $('body').append('<form name="postarrDepositFormular" method="POST" action="' + _href + '" id="postarrDepositFormular" style="display:none;"><input type="hidden" name="thumbUrl" value="' + _imageHref + '" /><input type="hidden" name="fn" value="' + dataObject.arrDeposit[0].model + '"><input type="hidden" name="fp" value="' + new tools().numberFormat(parseInt(dataObject.arrDeposit[0].total), 3, '.') + ' ' + leasingcalculatorcurrency + '"><input type="hidden" name="fd" value="' + dataObject.arrDeposit[0].term + ' ' + leasingcalculator_duration_unit_value + '"><input type="hidden" name="fkm" value="' + new tools().numberFormat(parseInt(dataObject.arrDeposit[0].kilometers_per_annum), 3, '.') + ' ' + leasingcalculator_mileage_unit_value + '"><input type="hidden" name="fsp" value="' + new tools().numberFormat(parseInt(dataObject.arrDeposit[0].deposit), 3, '.') + ' ' + leasingcalculatorcurrency + '"><input type="hidden" name="fmp" value="' + new tools().numberFormat(Math.round(dataObject.arrDeposit[0].leasing), 3, '.') + ' ' + leasingcalculatorcurrency + '"></form>');
        $('#postarrDepositFormular').submit();
      });

      // [BL] 26.01.2018 commented out because there is no need for removing breaks Task: 33387

      // var m_92_disclaimerArray = $('#m-92-disclaimer').html().split('<br>');
      // var _newDisclaimerText = "";
      // for (i in m_92_disclaimerArray) {
      //   _newDisclaimerText += m_92_disclaimerArray[i] + " ";
      // }
      // if (_energyefficiencyclass) {
      //   $('#m-92-disclaimer').text(_newDisclaimerText);
      // }
      // else {
      //   $('#m-92-disclaimer').text(m_92_disclaimerArray[0]);
      // }


      return {
        _markerReplace: new tools().markerReplace

      }
    }

    var leasingcalculator_asian = function () {

      var processElementsInArray = function (arr, order) {
        var _array = arr;
        var _uniqueElements = [];
        $.each(_array, function (i, el) {
          if ($.inArray(el, _uniqueElements) === -1) _uniqueElements.push(el);
        });
        if (typeof order == "undefined" || order == 1) {
          _uniqueElements = _uniqueElements.sort(function (a, b) { return a - b });
        }
        if (order == -1) {
          _uniqueElements = _uniqueElements.sort(function (a, b) { return b - a });
        }
        return _uniqueElements;
      };

      var dataObject = {
        term: '',
        kilometersperannum: '',
        deposit: '',
        arrDeposit: '',
        search: function (jsonObject) {
          var _arrTerm = [];
          var _arrKilometersperannum = [];
          var _arrDeposit = [];

          for (var i = 0; i < jsonObject.length; i++) {
            if (jsonObject[i]["term"] == this.term) {
              _arrTerm.push(jsonObject[i]);
            }
          };

          for (var j = 0; j < _arrTerm.length; j++) {
            if (_arrTerm[j]["balloon_payment_percent"] == this.kilometersperannum) {
              _arrKilometersperannum.push(_arrTerm[j]);
            }
          };

          for (var k = 0; k < _arrKilometersperannum.length; k++) {
            if (_arrKilometersperannum[k]["deposit_in_percent"] == this.deposit) {
              _arrDeposit.push(_arrKilometersperannum[k]);
            }
          };

          this.arrDeposit = _arrDeposit;
          try {
            if (_arrDeposit.length == 1) {
              $('#m-92-price').text(new tools().numberFormat(Math.round(_arrDeposit[0]["upe"]), 3, ',')); // die Abrundung   
              // new tools().numberFormat(Math.round(_data.leasing), 3, '.'))
              $('.summe').html(new tools().numberFormat(Math.round(_arrDeposit[0]["leasing"].replace(/.[a-zA-Z]/g, '')), 3, ','));
              if (ballon_empty) {
                $('.sliderColumn.deposit .text-rate-summe').text(new tools().numberFormat(Math.round(_arrDeposit[0]["deposit"]), 3, ','));
              }
              else {
                $('.sliderColumn.deposit .text-rate-summe').text(new tools().numberFormat(Math.round(_arrDeposit[0]["ballon_payment"]), 3, ','));
              }

              $('.sliderColumn.kilometers_per_annum .text-rate-summe').text(new tools().numberFormat(Math.round(_arrDeposit[0]["deposit"]), 3, ','));

            }
            else {
              $('#m-92-price').text("N/A");
              $('.summe').text("N/A");
              $('.text-rate-summe').text("N/A");
              throw new Error("no or more results is/are found");
            }
          }
          catch (e) {
            console.log(e);
          }
        }
      };

      var jsonData = $.get(leasingjsonurl.replace(/&amp;/g, '&'), function (e) {
        jsonObject = e.leasingdata;
        var _lengthOfArray = jsonObject.length;

        for (i in jsonObject) {
          term.push(parseInt(jsonObject[i]["term"]));
        };
        for (i in jsonObject) {
          if (!!!parseInt(jsonObject[i]["balloon_payment_percent"]) && ballon_empty) {
            kilometersperannum.push('');

          }
          else {
            kilometersperannum.push(parseInt(jsonObject[i]["balloon_payment_percent"]));
          }
        };
        for (i in jsonObject) {
          deposit.push(parseInt(jsonObject[i]["deposit_in_percent"]));
        };



        if ((parseInt(leasingcalculator_term) >= 0 && parseInt(leasingcalculator_deposit) >= 0 && parseInt(leasingcalculator_kilometers_per_annum) >= 0) || ballon_empty) {
          _init = true;
          var configMapping = { "term": [24, 36, 48], "balloon_payment_percent": [0, 25], "deposit_in_percent": [20, 30, 40] };
          var _initArrPush = function () {
            _initArr.push(leasingcalculator_term);
            _initArr.push(leasingcalculator_deposit);
            _initArr.push(leasingcalculator_kilometers_per_annum);

          }

          if (!!new tools().geturlparam("term") && !!new tools().geturlparam("balloon_payment_percent") && !!new tools().geturlparam("deposit_in_percent") && !!configMapping.term[new tools().geturlparam("term")] && !!configMapping.balloon_payment_percent[new tools().geturlparam("balloon_payment_percent")] && !!configMapping.deposit_in_percent[new tools().geturlparam("deposit_in_percent")]) {
            _paramSetting = true;
            _initArr.push(configMapping.term[new tools().geturlparam("term")]);
            _initArr.push(configMapping.balloon_payment_percent[new tools().geturlparam("balloon_payment_percent")]);
            _initArr.push(configMapping.deposit_in_percent[new tools().geturlparam("deposit_in_percent")]);
          } else { _initArrPush(); }
        }

        term = processElementsInArray(term);
        deposit = processElementsInArray(deposit);
        kilometersperannum = processElementsInArray(kilometersperannum);

        _Total.push(term);
        _Total.push(deposit);
        _Total.push(kilometersperannum);

        for (var i = 0; i < numberOfSliderColumn; i++) {
          makeSlider(_Total, i);
        };

        setStyle();

        dataObject.search(jsonObject);

        _init = false;
        registerPoints();

        if (ballon_empty) {
          $('.sliderColumn.deposit .text-rate-summe').text(new tools().numberFormat(Math.round(dataObject.arrDeposit[0].deposit), 3, ','));
        }
        else {
          $('.sliderColumn.deposit .text-rate-summe').text(new tools().numberFormat(Math.round(dataObject.arrDeposit[0].ballon_payment), 3, ','));
        }
        $('.sliderColumn.kilometers_per_annum .text-rate-summe').text(new tools().numberFormat(Math.round(dataObject.arrDeposit[0].deposit), 3, ','));

        $('.sliderColumn.deposit .slider-header span').eq(0).append("<br/>");
        $('.sliderColumn.kilometers_per_annum .slider-header span').eq(0).append("<br/>");

        if (_paramSetting) {
          _paramSetting = false;
          $('.m-92-module-right .slider-context span.point').each(function (i, e) {
            $('.slider').eq(i).slider('option').slide(null, { value: $('.slider').eq(i).slider('value') });
          });
        }
      });

      var makeSlider = function (arr, i) {

        var _templateString = '<div class="value_min"><div class="number">' + arr[i][0] + '</div><span class="point"></span></div>';
        for (var j = 1; j < arr[i].length - 1; j++) {
          _templateString += '<div class="value"><div class="number">' + arr[i][j] + '</div><span class="point"></span></div>';
        }
        _templateString += '<div class="value_max"><div class="number">' + arr[i][arr[i].length - 1] + '</div><span class="point"></span></div>';

        if (SliderColumnClassArray[i] != "") {
          SliderColumn.eq(i).addClass(SliderColumnClassArray[i]);
          SliderColumn.eq(i).find('.slider-context').append(_templateString);
          Regler(i, arr[i].length - 1);
          Distance(i, arr[i].length - 1);
        }
        else {
          SliderColumn.eq(i).remove();
        }

      };

      var Regler = function (n, m) {

        SliderColumn.eq(n).find('.slider').slider({
          range: "max",
          min: parseInt(_Total[n][0]),
          max: parseInt(_Total[n][_Total[n].length - 1]),
          step: parseInt((_Total[n][_Total[n].length - 1] - _Total[n][0]) / m),
          value: (!!_init) ? parseInt(_initArr[n]) : parseInt(_Total[n][0]),
          slide: function (event, ui) {
            getPrice(n, ui.value);
            dataObject.search(jsonObject);
          }
        });

        getPrice(n, _Total[n][0]);

      };

      var registerPoints = function () {
        $('.m-92-module-right .slider-context span.point').each(function (i, e) {
          $(e).on('click', function () {
            var _newValue = ($(this).parent().find('.number').text().replace('.', ''));
            var _whichSlider = ($('.sliderColumn').index($(this).parentsUntil('.sliderColumn').parent()));
            $('.slider').eq(_whichSlider).slider('value', _newValue);
            $('.slider').eq(_whichSlider).slider('option').slide(null, { value: _newValue });
          });
        });
      };

      var Distance = function (i, m) {
        if (m >= 2) {
          SliderColumn.eq(i).find('.value_min').css('width', (1 / (m)) * 100 + '%');
          SliderColumn.eq(i).find('.value').css('width', (1 / (m)) * 100 + '%');
        }
        else {
          SliderColumn.eq(i).find('.value_min').css('width', (1 / (m)) * 100 + '%');
          SliderColumn.eq(i).find('.value_max .point').css('left', 0);
        }
      };

      var setStyle = function () {
        $('.slider-context .number').each(function (i, e) {
          var _thisNumber = parseInt($(e).text());
          $(e).text(new tools().numberFormat(_thisNumber, 3, ","));
        });
      };

      var getPrice = function (n, value) {

        switch (n) {
          case 0:
            dataObject.term = (!!_init) ? leasingcalculator_term : value;

            break;
          case 2:
            dataObject.kilometersperannum = (!!_init) ? leasingcalculator_kilometers_per_annum : value;

            break;
          case 1:
            dataObject.deposit = (!!_init) ? leasingcalculator_deposit : value;

            break;
        }
      };

      var tools = function () {
        // z.B. (21321312316, 3, '.') oder (21321312316, 3, ',')
        this.numberFormat = function (number, n, t, currency) {
          if (typeof number != "number" || typeof n != "number" || typeof t == "undefined" || t.length == 0) return;
          var _number = number;
          _number = _number.toString().split("").reverse();
          var newNumberArray = [];
          var newNumberString = "";
          var flag = 0;
          for (var i = 0; i < _number.length; i++) {
            if (flag == n) {
              newNumberArray.push(t);
              flag = 0;
            }
            flag++;
            newNumberArray.push(_number[i]);
          };
          newNumberArray = newNumberArray.reverse();
          for (var j = 0; j < newNumberArray.length; j++) {
            newNumberString += newNumberArray[j];
          };
          if (!!currency) {
            switch (currency) {
              case 'germany':
                newNumberString = newNumberString + ',00';
                break;
            }
          }
          return newNumberString;
        },
        this.geturlparam = function geturlparam(name) {
          name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
          var regexS = "[\\?&]" + name + "=([^&#]*)";
          var regex = new RegExp(regexS);
          var results = regex.exec(window.location.href);
          if (results == null) {
            return "";
          } else {
            return results[1];
          }
        },
        this.layer = function (data) {
          this.makeLayer = function (data) {
            var _layerTemplate = '';
            if (typeof data == 'string' && data.length != 0) {
              _layerTemplate = data + '<a id="close" href="javascript:void(0)" />';
              $('#layer').html(_layerTemplate);
              $('#layer').show();
              $('.m-92-leasing-calculator-wrapper').addClass('layer');
              $('html, body').animate({
                scrollTop: $(".m-92-leasing-calculator-wrapper.layer").parent().offset().top
              }, 1000);

            };
            $('#layer #close').one('click', function () {
              $('#layer').empty();
              $('#layer').hide();
              $('.m-92-leasing-calculator-wrapper').removeClass('layer');
            });
            return this;
          },
          this.dataInjection = function (data) {
            var _data = data[0];
            $('#layer .m-92-leasing-calculator-layer-content-wrapper').html($('#layer .m-92-leasing-calculator-layer-content-wrapper').html()
            .replace("###UPE###", new tools().numberFormat(parseInt(_data.upe), 3, ','))
            .replace("###SPECIALPAYMENT###", new tools().numberFormat(parseInt(_data.deposit_in_percent), 3, ',') + " %")
            .replace("###TERM###", _data.term)
            .replace("###DOWNPAYMENTINPERCENT###", new tools().numberFormat(parseInt(_data.deposit_in_percent), 3, ','))
            .replace("###DOWNPAYMENT###", new tools().numberFormat(Math.round(_data.deposit), 3, ','))
            .replace("###BALLOONPAYMENTINPERCENT###", new tools().numberFormat(parseInt(_data.balloon_payment_percent), 3, ','))
            .replace("###BALLOONPAYMENT###", new tools().numberFormat(parseInt(_data.ballon_payment), 3, ','))
            .replace("###KPA###", new tools().numberFormat(parseInt(_data.kilometers_per_annum), 3, ','))
            .replace("###DEPOSIT###", new tools().numberFormat(parseInt(_data.deposit), 3, ','))
            .replace("###TOTAL###", new tools().numberFormat(parseInt(_data.total), 3, ','))
            .replace("###LEASING###", new tools().numberFormat(Math.round(_data.leasing), 3, ','))
            .replace("###NETLOAN###", new tools().numberFormat(Math.round(_data.net_loan), 3, ',')) //parseInt(_data.net_loan))
            .replace("###INTERESTRATE###", (_data.interest_rate * 100).toFixed(2))
            .replace("###ANNUALPERCENTAGERATE###", (parseFloat(_data.annual_percentage_rate).toFixed(4) * 100).toFixed(2))
            .replace("###TOTALAMOUNT###", new tools().numberFormat(Math.round(_data.total_amount), 3, ','))
            .replace("###RATENOLEASINGS###", new tools().numberFormat(Math.round(_data.leasing), 3, ',')))
            return this;
          },
          this.finance = function (k) {
            var _k = k;
            if (CURRENTPOOL == "china") {
              if (_k == 25) {
                $('#layer .finance_s').show();
              }
              if (_k == 0) {
                $('#layer .finance_s').hide();
              }
            }
            return this;
          }
          return this;
        }

      };

      $('.m-92-module-right .result .entity .info').on('click', function () {
        new tools().layer().makeLayer(leasingcalculatorlayercontent).dataInjection(dataObject.arrDeposit).finance(dataObject.arrDeposit[0].balloon_payment_percent);
        if (!!!$('#layer .disclaimer').length) {
          if (!!leasingcalculator_model_disclaimer_model.length) {
            $('#layer').append('<div class="disclaimer"><p>' + leasingcalculator_model_disclaimer_model + '</p></div>');
          } else {
            $('#layer').append('<div class="disclaimer"><p>' + leasingcalculator_model_disclaimer_standard + '</p></div>');
          }
        }
      });

      $('.m-92-module-right .gui-btn.gui-link-with-article').on('click', function (e) {
        e.preventDefault();
        var _href = $(this).attr('href');
        var _imageHref = encodeURI($('#techspecs').find('.m-09-techspecs-pattern .img-wrapper img').attr('src'));
        var _formular = $('body').append('<form name="postarrDepositFormular" method="POST" action="' + _href + '" id="postarrDepositFormular" style="display:none;"><input type="hidden" name="thumbUrl" value="' + _imageHref + '" /><input type="hidden" name="fn" value="' + dataObject.arrDeposit[0].model + '"><input type="hidden" name="fp" value="' + new tools().numberFormat(parseInt(dataObject.arrDeposit[0].total), 3, '.') + ' ' + leasingcalculatorcurrency + '"><input type="hidden" name="fd" value="' + dataObject.arrDeposit[0].term + ' ' + leasingcalculator_duration_unit_value + '"><input type="hidden" name="fkm" value="' + new tools().numberFormat(parseInt(dataObject.arrDeposit[0].kilometers_per_annum), 3, '.') + ' ' + leasingcalculator_mileage_unit_value + '"><input type="hidden" name="fsp" value="' + new tools().numberFormat(parseInt(dataObject.arrDeposit[0].deposit), 3, '.') + ' ' + leasingcalculatorcurrency + '"><input type="hidden" name="fmp" value="' + new tools().numberFormat(Math.round(dataObject.arrDeposit[0].leasing), 3, '.') + ' ' + leasingcalculatorcurrency + '"></form>');
        $('#postarrDepositFormular').submit();
      });
    }

    switch (CURRENTPOOL) {
      case 'china':
        SliderColumnClassArray = ['term', 'kilometers_per_annum', 'deposit'];
        leasingcalculator_asian();
        break;
      case 'singapore':
        ballon_empty = true;
        SliderColumnClassArray = ['term', 'deposit', ''];
        leasingcalculator_asian();
        break;
      case 'france':
        _secondSumme = "rate_no_leasing_s"; // siehe Kommentar in svn log
        SliderColumnClassArray = ['term', 'kilometers_per_annum', 'deposit'];
        var france = leasingcalculator_europe(function () {
          $('.result .entity:eq(0) .info').remove();
          $('.sliderColumn.kilometers_per_annum .value_min').prepend('<div class="newTitle">< 25.000</div>');
          $('.sliderColumn.kilometers_per_annum .value').prepend('<div class="newTitle">de 25.001 à 40.000</div>');
          $('.sliderColumn.kilometers_per_annum .value_max').prepend('<div class="newTitle">de 40.001 à 60.000</div>');
        });
        $('.sliderColumn.kilometers_per_annum').hide();


        var markerReplacement = france._markerReplace;
        markerReplacement('.sliderColumn:eq(2) .slider-header span:eq(0)', '#sup#', '<sup>');
        markerReplacement('.sliderColumn:eq(2) .slider-header span:eq(0)', '#/sup#', '</sup>');

        break;
      default:
        _energyefficiencyclass = true;
        SliderColumnClassArray = ['term', 'kilometers_per_annum', 'deposit'];
        leasingcalculator_europe();
        break;
    }

    if (window.pageController) {
      window.pageController.refresh();
    }

  }

  $(document).ready(function () {
      _lazyInit();
  });

  function _lazyInit()
  {
      var $el = $('#leasingcalculator').eq(0);

      if($el.length > 0)
      {
          if (window.pageController)
          {
              $el.one(window.pageController.eventNames.lazyInit, function () {
                  M_92();
              });
          }
          else
          {
              M_92();
          }
          $(document).on("m92_loaded", function () {
            M_92();
          });
    }
  }

});
;(function ($, window, document, undefined) {
  'use strict';

// ___________________________
//
//  gallery module: variables
// ___________________________
//
//  dom references
  var $gItems = null,
      $galleryContainer = null,
      $gallerySources = null,
      $currentGallerySource = null,
      $galleryTabControl = null,
      $galleryTabControlMobile = null,
      $galleryFullScreen = null,
      $galleryFullScreenSlider = null;

// strings
  var cssClass = {
    gallery: {
      base: 'm-39-gallery-module-wrapper',
      content: 'm-39-gallery__content',
      contentWrapper: 'm-39-gallery-content-wrapper',
      tabControl: 'm-39-gallery-filter',
      tabActive: 'gui-active-tab',
      tabControlMobile: 'm-39-mobile-drop-down',
      tabLabel: 'm-39-flyout-label',
      fullscreen: 'm-39-fullscreen',
      fullscreenClose: 'm-39-fullscreen-close',
      fullScreenSlider: 'm-39-fullscreen-slider',
      fullscreenDownload: 'm-39-fullscreen-download',
      fullscreenShare: 'm-39-fullscreen-share',
      fullscreenTitle: 'm-39-fullscreen-media-title',
      fullscreenDownloadLink: 'm-39-fullscreen-download__link',
      fullscreenDownloadLinkAndroid: 'm-39-fullscreen-download__link--android',
      arrows: 'slick-arrow',
      topbar: 'm-39-top-bar'
    },
    // gallery items
    item: {
      any: 'gitem',
      fixed: 'm-39-gi-static', // "static" is a reserved keyword therefore "fixed" is used instead
      image: 'm-39-gi-image',
      text: 'm-39-gi-text',
      video: 'm-39-gi-video',
      wallpaper: 'm-39-gi-wallpaper',
      audio: 'm-39-gi-sound'
    },
    // gallery slides
    slide: {
      base: 'm-39-slide',
      fixed: 'm-39-slide__static',
      one: 'm-39-slide__1',
      towPlusOne: 'm-39-slide__2-1',
      onePlusTwo: 'm-39-slide__1-2',
      downloadButtonSmall: 'm-39-mobile-icon-small',
      downloadButtonMedium: 'm-39-mobile-icon-medium',
      downloadButtonBig: 'm-39-mobile-icon-big',
      srcAndroid: 'm-39-fullscreen-download-android',
      srcSmall: 'm-39-fullscreen-download-small',
      srcMedium: 'm-39-fullscreen-download-medium',
      srcBig: 'm-39-fullscreen-download-large',
      imageDownloadBox: 'm-39-gi-downloadBox',
      textBox: 'hoverLayer',
      slickCurrent: 'slick-current',
      sourceBox: 'sourceBox',
      videoIframe: 'm-39-video-iframe',
      audioPlayer: 'm-39-audio-player',
      youtubePlayer: 'm-39-youtube-player',
      vimeoPlayer: 'm-39-vimeo-player',
      slickActive: 'slick-active',

    },
    state: {
      audioPause: 'pause',
      isVideo: 'm-39--is-video'
    },
    ecoDisclaimer: {
      ecoContainer: 'b-eco__container',
      tooltipContent: 'm-900__tooltip-content',
      tooltipConsumption: 'm-900__tooltip-consumption',
      tooltipEmission: 'm-900__tooltip-emission',
      tooltipEconsumption: 'm-900__tooltip-eConsumption',
      videoEcoDisclaimer: 'm-39__video-eco-disclaimer',
      videoEcoDisclaimerInner: 'm-39__video-eco-disclaimer-inner',
      videoProgressBar: 'm-39__video-eco-progress-bar',
      skipButton: 'm-39__video-eco-skip'
    }

  };
  var selectors = {
    gallery: {
      base: '.' + cssClass.gallery.base,
      content: '.' + cssClass.gallery.content,
      contentWrapper: '.' + cssClass.gallery.contentWrapper,
      sourceID: function (gallerySourceID) {
        return '[data-source-id="' + gallerySourceID + '"]';
      },
      tabControl: '.' + cssClass.gallery.tabControl,
      tabActive: '.' + cssClass.gallery.tabActive,
      tabControlMobile: '.' + cssClass.gallery.tabControlMobile,
      tabLabel: '.' + cssClass.gallery.tabLabel,
      fullscreenWrapper: '.' + cssClass.gallery.fullscreen,
      fullscreenClose: '.' + cssClass.gallery.fullscreenClose,
      fullScreenSlider: '.' + cssClass.gallery.fullScreenSlider,
      fullscreenDownload: '.' + cssClass.gallery.fullscreenDownload,
      fullscreenShare: '.' + cssClass.gallery.fullscreenShare,
      fullscreenTitle: '.' + cssClass.gallery.fullscreenTitle,
      downloadButtonSmall: '.' + cssClass.slide.downloadButtonSmall,
      downloadButtonMedium: '.' + cssClass.slide.downloadButtonMedium,
      downloadButtonBig: '.' + cssClass.slide.downloadButtonBig,
      fullscreenDownloadLink: '.' + cssClass.gallery.fullscreenDownloadLink,
      arrows: '.' + cssClass.gallery.arrows,
      topbar: '.' + cssClass.gallery.topbar
    },
    item: {
      any: '.' + cssClass.item.any,
      hasImage: '.' + cssClass.item.any +
      ':not(.' + cssClass.item.fixed + ')' +
      ':not(.' + cssClass.item.text + ')',
      forFullScreen: ':not(.' + cssClass.item.fixed + ')' +
      ':not(.' + cssClass.item.text + ')',
      audio: '.' + cssClass.item.audio
    },
    slide: {
      any: '.' + cssClass.slide.base,
      srcSmall: '.' + cssClass.slide.srcSmall,
      srcMedium: '.' + cssClass.slide.srcMedium,
      srcBig: '.' + cssClass.slide.srcBig,
      imageDownloadBox: '.' + cssClass.slide.imageDownloadBox,
      textBox: '.' + cssClass.slide.textBox,
      slickCurrent: '.' + cssClass.slide.slickCurrent,
      sourceBox: '.' + cssClass.slide.sourceBox,
      videoIframe: '.' + cssClass.slide.videoIframe,
      audioPlayer: '.' + cssClass.slide.audioPlayer,
      youtubePlayer: '.' + cssClass.slide.youtubePlayer,
      vimeoPlayer: '.' + cssClass.slide.vimeoPlayer,
      slickActive: '.' + cssClass.slide.slickActive
    },
    ecoDisclaimer: {
      ecoContainer: "." + cssClass.ecoDisclaimer.ecoContainer,
      videoEcoDisclaimer: "." + cssClass.ecoDisclaimer.videoEcoDisclaimer,
      videoEcoDisclaimerInner: "." + cssClass.ecoDisclaimer.videoEcoDisclaimerInner,
      videoProgressBar: "." + cssClass.ecoDisclaimer.videoProgressBar,
      skipButton: "." + cssClass.ecoDisclaimer.skipButton
    }

  };

  var eventNames = {
    slick: {
      afterChange: 'afterChange',
      beforeChange: 'beforeChange',
      breakpoint: 'breakpoint',
      destroy: 'destroy',
      edge: 'edge',
      init: 'init',
      reInit: 'reInit',
      setPosition: 'setPosition',
      swipe: 'swipe',
      lazyLoaded: 'lazyLoaded',
      lazyLoadError: 'lazyLoadError'
    }
  };

  var lazyLoadOnEvents = eventNames.slick.init + ' ' + eventNames.slick.beforeChange;

  // gallery tab mode: "filter" or "switch source"
  var galleryTabMode = 'filter';
  var currentGallerySourcID = '1';

// slide Layout
  var layout = ['1'],
      layoutIndex = 0,
      layoutItemCount = 1,
      itemsPerSlide = 1,
      sliderType = 'variable',
      m39SlickBaseOptions = {
          'arrows': true,
          'centerMode': false,
          'dots': true,
          'infinite': false,
          'swipe': true
      };

// utility objects
  var m39_imageScaler = null,
      mainVideoMarkup = null; // global variable to save video markup of slide
  var ecoProgressBarTl = null; // progress bar tweenmax timeline object

// ___________________________
//
//  gallery module: init
// ___________________________
//
  function init() {

   
    initDomReferences();

    if ($galleryContainer.length < 1) {
      return;
    }

    m39_imageScaler = new ScaleHandler();
    galleryTabMode = $galleryTabControl.find('*[data-sort]') > 0 ? 'filter' : 'switchSource';

    // bind gallery controls
    _bindTabs();
    _bindMobileDropdown();
     if($('.landing-page-gallery').length < 1) {
      _bindInlinesliderControl();
    }  

    // setup initial view
    setGallerySource(selectors.gallery.sourceID('1'));
    if (galleryTabMode === 'switchSource') {
      $galleryTabControl.find('li a[data-source="' + currentGallerySourcID + '"]').addClass(cssClass.gallery.tabActive);
    }

    createSlides();
    setupSlider();

    onResize();
  }

  var ajax_url;
  $( document ).ajaxSuccess(function( event, request, settings ) {
    ajax_url = settings.url;
    if(ajax_url.search("change_slider_model") > 0)
    {
      initDomReferences();
      if ($galleryContainer.length < 1) {
        return;
      }

      m39_imageScaler = new ScaleHandler();
      galleryTabMode = $galleryTabControl.find('*[data-sort]') > 0 ? 'filter' : 'switchSource';

      // bind gallery controls
      _bindTabs();
      _bindMobileDropdown();
      _bindInlinesliderControl();

      // setup initial view
      setGallerySource(selectors.gallery.sourceID('1'));
      if (galleryTabMode === 'switchSource') {
        $galleryTabControl.find('li a[data-source="' + currentGallerySourcID + '"]').addClass(cssClass.gallery.tabActive);
      }

      createSlides();
      setupSlider();

      onResize();
    }
  });

  function initDomReferences() {

    // gallery module container
    $galleryContainer = $(selectors.gallery.base);

    // get Gallery Sources and detach them from the dom
    $gallerySources = $galleryContainer.find('[data-type="gallery-source"]').eq(0);
    $gallerySources.detach();

    // gallery media controls
    $galleryTabControl = $galleryContainer.find(selectors.gallery.tabControl);
    $galleryTabControlMobile = $galleryContainer.find(selectors.gallery.tabControlMobile);

    // fullscreen container
    $galleryFullScreen = $galleryContainer.find(selectors.gallery.fullscreenWrapper);
    // fullscreen slider
    $galleryFullScreenSlider = $galleryContainer.find(selectors.gallery.fullScreenSlider);

  }

  function onResize(){
    windowHandler.addResizeFunction(function () {

      var windowWidth = screen.width;
      var tabOuterWidth = $galleryTabControl.outerWidth();

      if(windowWidth - (windowWidth*0.25) <= tabOuterWidth){
        $galleryTabControl.addClass('scrollable');
      }else{
        $galleryTabControl.removeClass('scrollable');
      }

    });
  }

// ___________________________
//
//  gallery content
// ___________________________
//
  function filterGallerySource(itemFilterSelector) {
    destroySlider();
    setGallerySource(null);
    createSlides(itemFilterSelector);
    setupSlider();
  }

  function changeGallerySource(sourceSelector) {
    destroySlider();
    setGallerySource(sourceSelector);
    resetTabControl();
    createSlides();
    setupSlider();
  }

  function setGallerySource(sourceSelector) {
    if (sourceSelector === null) {
      sourceSelector = selectors.gallery.sourceID($currentGallerySource.attr('data-source-id'));
    }

    $currentGallerySource = $gallerySources.find(sourceSelector);
    if ($currentGallerySource.length == 0) {
      //console.log(sourceSelector + ' -> ' + 'no such source');
      return;
    }
    $currentGallerySource = $currentGallerySource.clone();
    $galleryContainer.find(selectors.gallery.contentWrapper).append($currentGallerySource);

    currentGallerySourcID = $currentGallerySource.attr('data-source-id');
    layout = $currentGallerySource.data('layout').slice(); // clone array;
    layoutItemCount = $currentGallerySource.data('layoutItemcount').slice(); // clone array
    var oldSliderType = sliderType;
    sliderType = $currentGallerySource.data('layoutSliderType');
    if (oldSliderType !== sliderType) {
      $galleryContainer.find(selectors.gallery.content)
      .removeClass('m-39__slider-type--' + oldSliderType)
      .addClass('m-39__slider-type--' + sliderType);
    }
  }

// ___________________________
//
//  gallery content: slider
// ___________________________
//
  function createSlides(itemFilterSelector) {
    var filterString = typeof(itemFilterSelector) === 'undefined' ? selectors.item.any : itemFilterSelector;

    $gItems = $currentGallerySource.children(filterString);

    // check if there are sufficient assets for the slide layout
    var minSlidesForLayout = 0; // default for variable width slides
    if (sliderType === 'fixed') {
      // sum number of assets in layout
      for (var x = 0; x < layoutItemCount.length; x++) {
        minSlidesForLayout += layoutItemCount[x];
      }
    } else {
      minSlidesForLayout = 13; // default for variable width slides
    }

    if ($gItems.length < minSlidesForLayout) {
      itemsPerSlide = 1;
      for (var i = 0; i < $gItems.length; i += itemsPerSlide) {
        var $div = $("<div/>", {
          'class': cssClass.slide.base + ' ' + cssClass.slide.one + ' m-39__slider-type--' + sliderType
        });
        $gItems.slice(i, i + itemsPerSlide).wrapAll($div);
      }
    } else {

      // start with first slide layout
      layoutIndex = 0;

      // merge items into slides
      while ($gItems.length > 0) {

        // get number of items for current slide layout
        itemsPerSlide = layoutItemCount[layoutIndex % layoutItemCount.length];

        // get css classname for slide
        var slideCssClassName = '';
        if (itemsPerSlide > $gItems.length) {
          // not enough items for current slide layout
          //  >> make single item slide
          itemsPerSlide = 1;
          slideCssClassName = cssClass.slide.one;
          layoutIndex--; // retry current slide layout in next loop cycle
        } else {
          // check for static slides
          var countStaticSlides = 0;
          for (var z = 0; z < itemsPerSlide; z++) {
            // array length check already done one step above
            if ($($gItems[z]).hasClass(cssClass.item.fixed)) {
              countStaticSlides++;
            }
          }
          if (countStaticSlides > 0) {
            // static slides ignore current layout
            //  >> make single item static slide
            itemsPerSlide = 1;
            slideCssClassName = cssClass.slide.fixed;
            layoutIndex--; // retry current slide layout in next loop cycle
          } else {
            // apply current slide layout
            slideCssClassName = 'm-39-slide__' + layout[layoutIndex % layoutItemCount.length];
          }
        }

        // wrapping div for slides
        var $div = $("<div/>", {
          'class': cssClass.slide.base + ' ' + slideCssClassName + ' m-39__slider-type--' + sliderType
        });
        $gItems.slice(0, itemsPerSlide).wrapAll($div);

        // slide layout for next slide
        layoutIndex++;

        // refresh collection
        $gItems = $currentGallerySource.children(filterString);
      }
    }
  }

  function setupSlider() {
    var $slides = $currentGallerySource.find(selectors.slide.any);

    // create slider
    var m39SlickOptions = {};
    switch (sliderType) {
      case "variable": {
        $.extend(m39SlickOptions, m39SlickBaseOptions, {
          'appendArrows': $galleryContainer.find(selectors.gallery.content),
          'variableWidth': true
        });
      }
        break;
      case "fixed": {
        $.extend(m39SlickOptions, m39SlickBaseOptions, {
          'appendArrows': $galleryContainer.find(selectors.gallery.content),
          'variableWidth': false,
          'slidesToShow': 2,
          'slidesToScroll': 2,
          'responsive': [
            {
              breakpoint: 992,
              settings: {
                'slidesToShow': 2,
                'slidesToScroll': 2,
              }
            },
            {
              breakpoint: 768,
              settings: {
                'slidesToShow': 1,
                'slidesToScroll': 1,
              }
            },
            {
              breakpoint: 480,
              settings: {
                'slidesToShow': 1,
                'slidesToScroll': 1,
              }
            }
        ]
      });
      }
        break;
    }

    // preload images on slick.init and slick.beforeChange
    $currentGallerySource.on(lazyLoadOnEvents, function (event, slick, currentSlide, nextSlide) {

      // preload images for nextSlide -2 / +3
      var start = (event.type == 'init') ? 0 : nextSlide - 2;
      start = (start <= 0) ? 0 : start;
      var end = (event.type == 'init') ? start + 4 : nextSlide + 3;
      end = (end <= 4) ? 4 : end;

      for (var slideNumber = start; slideNumber <= end; slideNumber++) {
        if (slideNumber < 0) {
          continue;
        }
        if (slideNumber >= $slides.length) {
          break;
        }

        $slides.eq(slideNumber).find(selectors.item.hasImage).each(function () {
          var $gitem = $(this);
          var $imgEl = $gitem.find('img');
          var scaleParam = m39_imageScaler.getScaleParameter($imgEl, $gitem);
          m39_imageScaler.replaceSource($imgEl, $gitem.attr('data-src'), scaleParam);
        });
      }
    });


    //  >> use slick filter option to remove gallery items
    //     that were not matched in the createSlides() step
    //  >> filtered items are removed from dom
    $currentGallerySource.slick(m39SlickOptions).slick('slickFilter', selectors.slide.any);
  }

  function destroySlider() {
    $currentGallerySource.slick('unslick');
    $currentGallerySource.remove();
  }

// ___________________________
//
//  gallery content: full screen slider
// ___________________________
//

  function createFullScreenSlider($el) {

    var sourceSelector = selectors.gallery.sourceID($currentGallerySource.attr('data-source-id'));
    var $fullscreenGallerySource = $gallerySources.find(sourceSelector).clone();

    // ---- create slides -----

    // consider tab filter first
    // get sorted tab
    var filteredItems = selectors.item.any;
    if ($galleryTabControl.length > 0 && galleryTabMode === 'filter') {
      filteredItems = $galleryTabControl.find("li a" + selectors.gallery.tabActive).data("sort");
    }
    // if all items are selected, get all without text and static gallery items
    if (filteredItems === selectors.item.any) {
      filteredItems = selectors.item.any + selectors.item.forFullScreen;
    }
    // extract filtered gallery items and make them to slides
    var gItems = $fullscreenGallerySource.find(filteredItems);
    for (var i = 0; i < gItems.length; i++) {
      var $curEl = $(gItems[i]);

      if ($curEl.hasClass(cssClass.item.video)) {
        // add slide with videosource to slider
        $curEl.appendTo($galleryFullScreenSlider);
      } else if ($curEl.hasClass(cssClass.item.audio)) {
        // add slide with audio source to slider
        $curEl.appendTo($galleryFullScreenSlider);
      } else if ($curEl.hasClass(cssClass.item.wallpaper) || $curEl.hasClass(cssClass.item.image)) {
        // add image markup to slider
        // no need for markup changes, because it is already  correct
        $curEl.appendTo($galleryFullScreenSlider);
      }
    }

    // ----- init and call lazy loading -----
    // preload images on slick.init and slick.beforeChange
    $galleryFullScreenSlider.on(lazyLoadOnEvents, function (event, slick, currentSlide, nextSlide) {

      var $curEl = (event.type == 'init') ? $galleryFullScreenSlider.find(selectors.slide.slickCurrent) : $(gItems.eq(nextSlide)); //$(gItems.eq(nextSlide));
      var initIndex = $curEl.data("slick-index");

      // preload images for prev and next slide
      var start = (event.type == 'init') ? initIndex - 1 : nextSlide - 1;
      start = (start <= 0) ? 0 : start;
      var end = (event.type == 'init') ? initIndex + 1 : nextSlide + 1;
      end = (end <= 1) ? 1 : end;

      for (var slideNumber = start; slideNumber <= end; slideNumber++) {
        if (slideNumber < 0) {
          continue;
        }
        if (slideNumber >= gItems.length) {
          break;
        }

        gItems.eq(slideNumber).each(function () {
          var $gitem = $(this);
          var $imgEl = $gitem.find('img');
          var scaleParam = m39_imageScaler.getScaleParameter($imgEl, $gitem);

          m39_imageScaler.replaceSource($imgEl, $gitem.attr('data-src'), scaleParam);
        });
      }

      // check if current slide has video
      if ($curEl.hasClass(cssClass.item.video)) {
        // check if an iframe is already appended
        if ($curEl.find("iframe").length > 0) {
          return
        }
        // create markup for video slide
        var videoSource = $curEl.find(selectors.slide.sourceBox).find("source").attr("src"),
          vimeoMarkup = $('<iframe src="' + videoSource + '" class="' + cssClass.slide.videoIframe + ' ' + cssClass.slide.vimeoPlayer + '" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen="">' +
            '</iframe>'),
          youtubeMarkup = $('<iframe src="' + videoSource + '?version=3&enablejsapi=1" class="' + cssClass.slide.videoIframe + ' ' + cssClass.slide.youtubePlayer + '" frameborder="0" allowfullscreen></iframe>'),
          videoTmp = "";

        // check video player
        if (/vimeo/i.test(videoSource)) {
          videoTmp = vimeoMarkup;
        } else if (/youtube/i.test(videoSource)) {
          videoTmp = youtubeMarkup;
        }

        mainVideoMarkup = videoTmp;
        // add video eco disclaimer

        // prevents previous timeline fires onComplete on old timing
        if(ecoProgressBarTl instanceof TimelineMax) {
          ecoProgressBarTl.pause();
        }
        addVideoEcoDisclaimer($curEl);

      } else if ($curEl.hasClass(cssClass.item.audio)) { // check if current slide has audio
        // check if an audio tag is already appended
        if ($curEl.find(selectors.slide.audioPlayer).length > 0) {
          return
        }
        // create markup for audio, get all video-js ce-audio vjs-porsche-skin
        var audioMarkup = '<audio  class="' + cssClass.slide.audioPlayer + '" preload="none">';
        $curEl.find(selectors.slide.sourceBox).find("source").each(function () {
          audioMarkup += $(this).prop('outerHTML');
        });
        audioMarkup += '</audio>';
        // insert audio into slide wrapper
        $(audioMarkup).appendTo($curEl);
        bindSoundEvents($curEl.find(selectors.slide.audioPlayer));
      }

      // remove video from current slide, when slide is going to change
      removeVideoFromFullscreenSlide($(gItems.eq(nextSlide - 1)));
      removeVideoFromFullscreenSlide($(gItems.eq(nextSlide + 1)));

      // remove eco disclaimer and the skip button
      removeVideoEcoDisclaimer($(gItems.eq(nextSlide - 1)));
      removeVideoEcoDisclaimer($(gItems.eq(nextSlide + 1)));

    });

    // ----- init fullscreen slick slider ----
    $galleryFullScreenSlider.slick({
      'arrows': true,
      'centerMode': false,
      'dots': true,
      'infinite': false,
      'swipe': true,
      'slidesToShow': 1,
      'initialSlide': setInitialFullscreenSlide($el)
    });

    _bindFullscreenControl();
  }

  function setInitialFullscreenSlide($el) {
    // $el = clicked element
    // search for data id of clicked element

    var dataId = $el.data("id");
    return $galleryFullScreenSlider.find(selectors.item.any + "[data-id='" + dataId + "']").index();
  }

  function removeFullscreenSlider() {
    _unbindFullscreenControl();
    unbindSoundEvent();
    $galleryFullScreenSlider.slick("unslick").empty();
  }

  function openFullscreen() {
    $galleryFullScreen.css("display", "block");
  }

  function closeFullscreen() {
    $galleryFullScreen.css("display", "none");
  }


  function goToCurrentInlineSlide() {
    var curFullscreenSlideId = $galleryFullScreenSlider.find(selectors.slide.slickCurrent).data("id"),
      curSlide = $currentGallerySource.find(selectors.item.any + "[data-id='" + curFullscreenSlideId + "']").closest(".slick-slide").index();

    $currentGallerySource.slick("slickGoTo", curSlide);
  }

  function toggleDownloadBox() {
    // hide this icon, when not wallpaper and vice versa
    var curSlide = $galleryFullScreenSlider.find(selectors.slide.slickCurrent);

    if (curSlide.hasClass(cssClass.item.wallpaper)) {
      $galleryFullScreen.find(selectors.gallery.fullscreenDownload).show();
    } else {
      $galleryFullScreen.find(selectors.gallery.fullscreenDownload).hide();
    }
  }

  function changeFullscreenTitle() {
    // get title from hoverLayer div inside slide
    var title = $galleryFullScreenSlider.find(selectors.slide.slickCurrent)
    .find(selectors.slide.textBox).text();
    $galleryFullScreen.find(selectors.gallery.fullscreenTitle).text(title);
  }

  function changeDownloadSource() {
    // the slide divs need have 3 data attr for each image size
    var $el = $galleryFullScreenSlider.find(selectors.slide.slickCurrent),
      downloadSource = $el.find(selectors.slide.imageDownloadBox)
      //get download source
      ,
      srcSmall = downloadSource.find(selectors.slide.srcSmall + " a").attr("href"),
      srcMedium = downloadSource.find(selectors.slide.srcMedium + " a").attr("href"),
      srcBig = downloadSource.find(selectors.slide.srcBig + " a").attr("href");


    // set download sources in attribute
    $galleryFullScreen.find(selectors.gallery.downloadButtonSmall + " " + selectors.gallery.fullscreenDownloadLink).attr("href", srcSmall);
    $galleryFullScreen.find(selectors.gallery.downloadButtonMedium + " " + selectors.gallery.fullscreenDownloadLink).attr("href", srcMedium);
    $galleryFullScreen.find(selectors.gallery.downloadButtonBig + " " + selectors.gallery.fullscreenDownloadLink).attr("href", srcBig);
  }

  function pauseVideos() {

    // pause vimeo videos
    var command = {
      "method": "pause",
      "value": "true"
    };

    // TD: these lines could prevent autoplay, and are not needed anyway
    // videos/iframe are getting removed after slidechange anyway
    // $galleryFullScreenSlider.find(selectors.slide.vimeoPlayer).each(function (i) {
    //   this.contentWindow.postMessage(JSON.stringify(command), "*");
    // });

    // pause youtube videos
    $galleryFullScreenSlider.find(selectors.slide.youtubePlayer).each(function () {
      this.contentWindow.postMessage('{"event":"command","func":"' + 'stopVideo' + '","args":""}', '*')
    });
  }

  function pauseAudios() {
    $galleryFullScreenSlider.find(selectors.slide.audioPlayer).each(function () {
      $(this).get(0).pause();
    });
  }

  function toggleSound($el) {
    var audio = $el.find(selectors.slide.audioPlayer).get(0);
    if (audio.paused) {
      audio.play();
    } else {
      audio.pause();
    }
  }

  function removeVideoFromFullscreenSlide($el) {
    $el.find("img").show();
    $el.find(selectors.slide.videoIframe).remove();
  }

  function removeVideoEcoDisclaimer($el) {
    $el.find(selectors.ecoDisclaimer.videoEcoDisclaimer).remove();
  }

  function checkForVideoSlide() {
    // check if the current slide contains video, if true, hide change arrows shape and height
    var $curSlide = $galleryFullScreenSlider.find(selectors.slide.slickActive),
      $arrows = $galleryFullScreenSlider.find(selectors.gallery.arrows);

    if ($curSlide.hasClass(cssClass.item.video)) {
      $arrows.addClass(cssClass.state.isVideo);
    } else {
      $arrows.removeClass(cssClass.state.isVideo);
    }
  }

  // eco container stuff
  // clone eco container to topbar
  function cloneEcoToTopbar() {
    var $curSlide = $galleryFullScreenSlider.find(selectors.slide.slickActive)
      , $ecoContainer = $curSlide.find(selectors.ecoDisclaimer.ecoContainer)
      , $topbar = $galleryFullScreen.find(selectors.gallery.topbar)
      , $fullscreenTitle = $galleryFullScreen.find(selectors.gallery.fullscreenTitle);

    // if current slide is video slide, dont copy to topbar
    if( $curSlide.hasClass(cssClass.item.video) ) {
      return false;
    }

    // delete previous eco container in topbar
    $topbar.find(selectors.ecoDisclaimer.ecoContainer).remove();

    // add to topbar
    $ecoContainer.each(function () {
      $fullscreenTitle.after($(this).clone());
    });

    if (typeof window.reInitEcoDisclaimer === "function") {
      window.reInitEcoDisclaimer();
    }

  }

  // function adds disclaimer before video init
  function addVideoEcoDisclaimer($curEl) {
    var $curSlide = $curEl
      , $ecoContainer = $curSlide.find(selectors.ecoDisclaimer.ecoContainer);
    // get skip button text from item data attr
    var skipText = $curSlide.data("skip-text") ? $curSlide.data("skip-text") : "skip";
    // inner video eco markup
    var tooltipMarkup =
      '<div class="' + cssClass.ecoDisclaimer.tooltipContent + '">' +
        '<h4>#label#</h4>' +
        '<div class="' + cssClass.ecoDisclaimer.tooltipConsumption + '">' +
          '<span>#consumptionLabel#</span>' +
          '<span>#consumptionValue#</span>' +
        '</div>' +
        '<div class="' + cssClass.ecoDisclaimer.tooltipEmission + '">' +
          '<span>#emissionLabel#</span>' +
          '<span>#emissionValue#</span>' +
        '</div>' +
        '<div class="' + cssClass.ecoDisclaimer.tooltipEconsumption + '">' +
          '<span>#econsumptionLabel#</span>' +
          '<span>#econsumptionValue#</span>' +
        '</div>' +
      '</div>';
    // outer video eco markup
    var $ecoMarkup = $('<div class="' + cssClass.ecoDisclaimer.videoEcoDisclaimer + '">' +
      '<button class="gui-btn ' + cssClass.ecoDisclaimer.skipButton + '">' + skipText + '</button>' +
      '<div class="' + cssClass.ecoDisclaimer.videoEcoDisclaimerInner + '"></div>' + // <-- content inside this one
      '<div class="' + cssClass.ecoDisclaimer.videoProgressBar + '"></div>' +
      '</div>');


    // first check, if there are any eco container to display
    // if not, go right away to the video
    if($ecoContainer.length == 0) {
      addVideo();
      return false;
    }

    // get video disclaimer
    $ecoContainer.each(function () {
      // 1. get the data
      var data = $(this).attr("data-model");
      // jump out if data model does not exist, otherwise it throws error
      if (data === undefined) {
        return false;
      }
      // 2. convert data string to json object
      data = JSON.parse(data);

      var label = data.label ? data.label : ""
        , consumptionLabel = data.consumption ? data.consumption.label : ""
        , consumptionValue = data.consumption ? data.consumption.formatedvalue : ""
        , emissionLabel = data.emission ? data.emission.label : ""
        , emissionValue = data.emission ? data.emission.formatedvalue : ""
        , econsumptionLabel = data.econsumption ? data.econsumption.label : ""
        , econsumptionValue = data.econsumption ? data.econsumption.formatedvalue : ""
        ;

      // 3. add content to tooltip options
      var markup = tooltipMarkup
        .replace("#label#", label)
        .replace("#consumptionLabel#", consumptionLabel)
        .replace("#consumptionValue#", consumptionValue)
        .replace("#emissionLabel#", emissionLabel)
        .replace("#emissionValue#", emissionValue)
        .replace("#econsumptionLabel#", econsumptionLabel)
        .replace("#econsumptionValue#", econsumptionValue)
        ;
      $ecoMarkup.find(selectors.ecoDisclaimer.videoEcoDisclaimerInner).append(markup);
    });

    // add markup to slide
    $curSlide.append($ecoMarkup);

    startEcoProgressBar();

    // bind event on skip button
    $(selectors.ecoDisclaimer.skipButton).on("click", function () {
      onVideoEcoSkip();
    });
  }

  function startEcoProgressBar() {
    var $progressBar = $(selectors.ecoDisclaimer.videoProgressBar);

    ecoProgressBarTl = new TimelineMax({
      paused: true
    });

    ecoProgressBarTl.to({}, 7, {
      force3D:true,
      onUpdateParams: ["{self}"],
      onUpdate: function(timeline) {

        TweenMax.set($progressBar, {
          scaleX:timeline.progress(),
          transformOrigin: "0px 0px"
        });
      },
      onComplete: function () {
        // hide or remove eco disclaimer
        $(selectors.ecoDisclaimer.videoEcoDisclaimer).remove();
        addVideo();
      }
    });

    ecoProgressBarTl.play();
  }

  function addVideo() {
    var $curSlide = $galleryFullScreenSlider.find(selectors.slide.slickActive);
    // insert video into slide wrapper
    $(mainVideoMarkup).appendTo($curSlide);
    $curSlide.find("img").hide();
  }

  function onVideoEcoSkip() {
    ecoProgressBarTl.invalidate().kill();
    $(selectors.ecoDisclaimer.videoEcoDisclaimer).remove();
    addVideo();
  }


// end fullscreen gallery functions

// ___________________________
//
//  gallery content: controls
// ___________________________
//
// TODO: rename "tabs" and "mobile dropdown" to "gallery controls"
  function _bindTabs() {
    $galleryTabControl.find('li a:not( ' + selectors.gallery.tabLabel + ')').each(function () {
      $(this).on('click', _onClickTabControl);
    });
  }

  function _onClickTabControl() {

    _unbindMobileDropdown();
    var $newSelectedOption = null;
    var $this = $(this);

    if ($this.data('sort')) {
      // filter current data source
      filterGallerySource($this.data('sort'));
      // update active tab state
      $galleryTabControl.find('li a').removeClass(cssClass.gallery.tabActive);
      $this.addClass(cssClass.gallery.tabActive);
      $newSelectedOption = $galleryTabControlMobile.find('select option[data-sort="' + $this.data('sort') + '"]');
    } else if ($this.data('source')) {
      // change data source
      changeGallerySource(selectors.gallery.sourceID($this.data('source')));
      if(galleryTabMode === 'switchSource') {
        $galleryTabControl.find('li a').removeClass(cssClass.gallery.tabActive);
        $this.addClass(cssClass.gallery.tabActive);
      }
      $newSelectedOption = $galleryTabControlMobile.find('select option[data-source="' + $this.data('source') + '"]');
    }

    $galleryTabControlMobile.find('select').val($newSelectedOption.attr('value'));
    _bindMobileDropdown();
  }

  function resetTabControl() {
    _unbindMobileDropdown();
    $galleryTabControl.find('li a').removeClass(cssClass.gallery.tabActive);
    if(galleryTabMode === 'filter') {
      $galleryTabControl.find('li a[data-sort="' + selectors.item.any + '"]').addClass(cssClass.gallery.tabActive);
    }
    else {
      $galleryTabControl.find('li a[data-source="' + currentGallerySourcID + '"]').addClass(cssClass.gallery.tabActive);
    }
    $galleryTabControlMobile.find('select').val("0");
    _bindMobileDropdown();
  }

  function _bindMobileDropdown() {
    $galleryTabControlMobile.find('select').on('change', _onChangeTabControlMobile);
  }

  function _unbindMobileDropdown() {
    $galleryTabControlMobile.find('select').off('change');
  }

  function _onChangeTabControlMobile(evt) {
    var $this = $(this);
    var $selectedOption = $this.children('option.selected');

    if ($selectedOption.attr('data-sort')) {
      filterGallerySource($selectedOption.attr('data-sort'));
      // keep desktop in synch
      // >> update active tab state
      $galleryTabControl.find('li a').removeClass(cssClass.gallery.tabActive);
      $galleryTabControl.find('li a[data-sort="' + $selectedOption.data('sort') + '"]').addClass(cssClass.gallery.tabActive);
    } else if ($selectedOption.attr('data-source')) {
      changeGallerySource(selectors.gallery.sourceID($selectedOption.attr('data-source')));
      // keep desktop in synch
      // >> update active tab state
      $galleryTabControl.find('li a').removeClass(cssClass.gallery.tabActive);
      if(galleryTabMode === 'switchSource') {
        $galleryTabControl.find('li a[data-source="' + currentGallerySourcID + '"]').addClass(cssClass.gallery.tabActive);
      }
      else {
        $galleryTabControl.find('li a[data-sort="' + selectors.item.any + '"]').addClass(cssClass.gallery.tabActive);
      }
    }
  }

  function _bindInlinesliderControl() {
    $galleryContainer.find(selectors.gallery.contentWrapper).on("click", selectors.item.hasImage, function () {
      _onSlideClick($(this));
    });
  }

  function _bindFullscreenControl() {
    // top bar
    $galleryFullScreen.find(selectors.gallery.fullscreenClose).on("click", _onFullscreenClose);
    $galleryFullScreen.find(selectors.gallery.fullscreenDownload)
    .add($galleryFullScreen.find(selectors.gallery.fullscreenShare))
    .add($galleryFullScreen.find(selectors.gallery.fullscreenClose)).on("mouseenter", function () {
      $(this).addClass("hover");
    });
    $galleryFullScreen.find(selectors.gallery.fullscreenDownload)
    .add($galleryFullScreen.find(selectors.gallery.fullscreenShare))
    .add($galleryFullScreen.find(selectors.gallery.fullscreenClose)).on("mouseleave", function () {
      $(this).removeClass("hover");
    });

    $galleryFullScreenSlider.on("afterChange", function () {
      toggleDownloadBox();
      changeFullscreenTitle();
      changeDownloadSource();
      // pauseVideos();
      pauseAudios();
      checkForVideoSlide();
      cloneEcoToTopbar();
    });

    $galleryFullScreenSlider.on("keydown", function (e) {
      if (e.which === 27) {
        _onFullscreenClose();
      }
    });

    // mobile share and download icons
    $galleryFullScreen.find(selectors.gallery.fullscreenDownload).add(selectors.gallery.fullscreenShare).on("touchstart", function (event) {
      var $el = $(this);
      // open/close download and share panel
      // only do when parent was clicked
      if (event.target.parentElement === this) { // event.target = selector and this = top icon (children of selector
        if ($el.hasClass("hover")) {
          $el.removeClass("hover");
        } else {
          $el.addClass("hover");
        }
      }
    });

    $galleryFullScreen.on("click.audio", selectors.item.audio, function () {
      toggleSound($(this));
    });
  }

  function bindSoundEvents($el) {
    $el.on("play.sound", function () {
      $(this).closest(selectors.item.audio).addClass(cssClass.state.audioPause);
    });
    $el.on("pause.sound", function () {
      $(this).closest(selectors.item.audio).removeClass(cssClass.state.audioPause);
    });
  }

  function unbindSoundEvent() {
    $galleryFullScreen.find(selectors.slide.audioPlayer).off("play.sound");
    $galleryFullScreen.find(selectors.slide.audioPlayer).off("pause.sound");
  }

  function _unbindInlinescreenControl() {
    $galleryContainer.find(selectors.gallery.contentWrapper).off("click");
  }

  function _unbindFullscreenControl() {
    $galleryFullScreen.find(selectors.gallery.fullscreenClose).off("click");
    $galleryFullScreen.find(selectors.gallery.fullscreenDownload)
    .add($galleryFullScreen.find(selectors.gallery.fullscreenShare))
    .add($galleryFullScreen.find(selectors.gallery.fullscreenClose)).off("mouseenter");
    $galleryFullScreen.find(selectors.gallery.fullscreenDownload).add(selectors.gallery.fullscreenShare).off("mouseleave");
    $galleryFullScreenSlider.off("afterChange");
    $galleryFullScreenSlider.off("keydown");
    $galleryFullScreen.off("click.audio");
  }

  function _onSlideClick($el) {
    openFullscreen();
    createFullScreenSlider($el);
    toggleDownloadBox();
    changeFullscreenTitle();
    changeDownloadSource();
    checkForVideoSlide();
    cloneEcoToTopbar();
  }

// ___________________________
//
//  topbar controls
// ___________________________

  function _onFullscreenClose() {
    goToCurrentInlineSlide();
    closeFullscreen();
    removeFullscreenSlider();
    // pauseVideos(); // not really necessary, because video and audio will be removed
    pauseAudios();
  }

// ___________________________
//
//  create gallery module
// ___________________________
//
  $(document).ready(function () {
      _lazyInit();
  });

  function _lazyInit()
  {
      var $el = $('.m-39-gallery-module-wrapper').eq(0);
      // THERE IS NO REAL ENCLOSURE FOR THIS MODULE
      // ALL MODULES ARE INITIALIZED AT ONCE
      // IT IS RISKY TO HAVE 2 OF THIS MODULE ON ONE PAGE

      if($el.length > 0)
      {
        if (window.pageController)
        {
            $el.one(window.pageController.eventNames.lazyInit, function () {
                init($el);
            });
        }
        else
        {
            init($el);
        }
      }
  }

})(jQuery, this, this.document);
;(function ($, window, document) {
  'use strict';

  var M73_MODULE = {

    init: function () {

      if (typeof ScaleHandler !== undefined) {
        var m73ImageScaler = new ScaleHandler();

        $('.m-73-model-teaser img[data-image-src]').each(function () {
          var $el = $(this);
          var scaleParam = m73ImageScaler.getScaleParameter($el);
          m73ImageScaler.replaceSource($el, $el.attr('data-image-src'), scaleParam);
        });
      }

      window.pageController && window.pageController.refresh();
    }
  };

  $(document).ready(function () {
      _lazyInit();
  });

  function _lazyInit()
  {
      var $el = $('.m-73-model-teaser').eq(0);
      // THERE IS NO REAL ENCLOSURE FOR THIS MODULE
      // ALL MODULES ARE INITIALIZED AT ONCE
      // IT IS RISKY TO HAVE 2 OF THIS MODULE ON ONE PAGE

      if($el.length > 0)
      {
        if (window.pageController)
        {
            $el.one(window.pageController.eventNames.lazyInit, function () {
                M73_MODULE.init();
            });
        }
        else
        {
            M73_MODULE.init();
        }

        $(document).on("m73_loaded", function () {
          M73_MODULE.init();
        });
      }
  }

}(jQuery, this, this.document));/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 5/5/2017.
 *
 * Definition of animations for different Modules that get triggered by waypoint.
 * The animation has to be coded as a TimelineLite object attached to the DOM element by the
 * timeline property.
 *
 * @requires: matchMediaQuery.plugin.js - placed after
 * @requires: waypoints
 * @requires: Tweenmax
 */
(function ($, window, document, undefined) {
    'use strict';

    var animationController;

    $(document).ready(function() {
        if ($('.b-page-wrapper').hasClass('animated')) {
            if (!!window.TweenMax && !!window.TimelineLite && !!$.waypoints) {
                animationController = new AnimationController();
            } else {
                console.warn('animations.js loaded but GSAP and/or waypoints is missing!!!');
            }
        }
    });

    function AnimationController() {
        var self = this,
            animationDefinitions = {
                '.m-43-flex-banner' : animateFlexBanner,
                '.m-73-model-teaser' : animateModelTeaser,
                '.m-08-features-wrapper > *:first-child' : defaultModuleAnimation,
                '.m-41-image-teaser-navigation' : animateTeaserNavigation,
                '.b-teaser-wrapper > *:first-child' : animateTeaser,
                // '.m-03-more-about' : defaultModuleAnimation,
                '.m-29-features-v2 > *:first-child' : animateFeatures,
                '.m-33-small-teaser' : animateSmallTeaser,
                '.m-12-gallery > .m-12-gallery-content' : animateGallery,
                '.m-35-info-card > .m-35-info-card-inner' : animateInfoCard
            };
        this.eventNamespace = 'animationController';

        self.currentViewport = {
            pos: 3
        };

        _init();

        function _init() {

            console.log('Init Animation Controller');

            _setListener();
            _initAnimations();
        }

        function _setListener() {
            $(document).on('MatchMediaQuery_match.' + self.eventNamespace, _onMediaQueryMatch);
        }

        function _initAnimations() {
            /**
             * Play predefined animations on waypoints trigger for all DOM elements with class animated
             * If the class no-reverse is also set then the animation is not reversed on direction up.
             */
            $.each(animationDefinitions, function(selector, callback) {
                if (typeof callback === "function") {
                    $(selector).each(callback);
                }

                // Attach waypoint to first Child element of the module to not disturb the content navigation. :-/
                $(selector).waypoint(function(direction) {
                    if (direction === 'up') {
                        return;
                    }

                    console.log('Waypoint animation trigger 85% | ', direction, this);

                    var timelineContainer = this;
                    console.log('Waypoint animation timeline Container | ', timelineContainer);

                    if (!!timelineContainer.timeline && (!!timelineContainer.timeline[self.currentViewport.pos] || !!timelineContainer.timeline['-1'])) {
                        if (direction === 'down') {
                            console.log('Waypoint animation trigger 85% | play');

                            (!!timelineContainer.timeline[self.currentViewport.pos]) ? timelineContainer.timeline[self.currentViewport.pos].play() : null;
                            (!!timelineContainer.timeline['-1']) ? timelineContainer.timeline['-1'].play() : null;
                        }
                    } else {
                        console.warn('No Timeline');
                    }
                }, {
                    offset: '85%'
                });

                $(selector).waypoint(function(direction) {
                    if (direction === 'down') {
                        return;
                    }

                    console.log('Waypoint animation trigger 100% | ', direction, this);

                    var timelineContainer = this;
                    console.log('Waypoint animation timeline Container | ', timelineContainer);

                    if (!!timelineContainer.timeline && (!!timelineContainer.timeline[self.currentViewport.pos] || !!timelineContainer.timeline['-1'])) {
                        if (direction === 'up') {
                            if (!$(timelineContainer).hasClass('no-reverse')) {
                                console.log('Waypoint animation trigger 100% | reset');

                                (!!timelineContainer.timeline[self.currentViewport.pos]) ? timelineContainer.timeline[self.currentViewport.pos].pause() : null;
                                (!!timelineContainer.timeline[self.currentViewport.pos]) ? timelineContainer.timeline[self.currentViewport.pos].progress(0) : null;
                                (!!timelineContainer.timeline['-1']) ? timelineContainer.timeline['-1'].pause() : null;
                                (!!timelineContainer.timeline['-1']) ? timelineContainer.timeline['-1'].progress(0) : null;
                            }
                        }
                    } else {
                        console.warn('No Timeline');
                    }
                }, {
                    offset: '100%'
                })
            });
        }

        function _onMediaQueryMatch(evt, data) {
            // refresh Animation definitions
            console.group();
            console.log("Media Query Match - shall I redefine the Animations?");
            console.log(evt);
            console.log(data);
            console.groupEnd();

            self.currentViewport = data;
        }

        //region animation definition
        //--------------------------
        function defaultModuleAnimation(index, element) {
            var tl = new TimelineMax({paused: true});

            tl
                .fromTo(
                    $( element ).parent(),
                    0.6,
                    { y: 50, opacity: 0 },
                    { y: 0, opacity: 1, ease: Sine.easeOut}
                );

            element.timeline = {
                '-1': tl
            };
        }

        function animateFeatures(index, element) {
            var tl = new TimelineMax({paused: true});

            tl.add(
                TweenMax.fromTo(
                    $( element ).parent().find( ".m-29-features-v2-headline-wrapper" ),
                    0.6,
                    { x: 50, opacity: 0 },
                    { x: 0, opacity: 1, ease: Sine.easeOut}
                )
            );

            tl.add(
                TweenMax.staggerFromTo(
                    $( element ).parent().find( ".m-29-feature-item" ),
                    0.6,
                    { scale: 0.9, x: 50, opacity: 0 },
                    { scale: 1, x: 0, opacity: 1, ease: Sine.easeOut},
                    0.1
                ), "-=0.3"
            );

            element.timeline = {
                '-1': tl
            };
        }

        function animateTeaser(index, element) {
            var tl = new TimelineMax({paused: true});

            tl.add(
                TweenMax.staggerFromTo(
                    $( element ).parent().find( "a" ),
                    0.6,
                    { scale: 0.9, x: 50, opacity: 0 },
                    { scale: 1, x: 0, opacity: 1, ease: Sine.easeOut},
                    0.1
                )
            );

            element.timeline = {
                '-1': tl
            };
        }

        function animateTeaserNavigation(index, element) {
            var tl = new TimelineMax({paused: true});

            tl.add(
                TweenMax.staggerFromTo(
                    $( element ).find( ".m-41-image-teaser-navigation-item" ),
                    0.6,
                    { scale: 0.9, x: 50, opacity: 0 },
                    { scale: 1, x: 0, opacity: 1, ease: Sine.easeOut},
                    0.1
                )
            );

            element.timeline = {
                '-1': tl
            };
        }

        function animateFlexBanner(index, element) {
            var tl = new TimelineMax({paused: true});
            var tl2 = new TimelineMax({paused: true});

            tl
                .fromTo(
                    $( element ).find( '.m-43-flex-banner-inner' ),
                    0.6,
                    { y: 50, opacity: 0 },
                    { y: 0, opacity: 1, ease: Sine.easeOut}
                )
                .fromTo(
                    $( element ).find( '.m-43-flex-banner-background' ),
                    0,
                    {y: '100%'},
                    {y: '0%', ease: Power0.easeNone},
                    0
                )
                .to(
                    $( element ).find( '.m-43-flex-banner-image-overlay-left' ),
                    4,
                    {width: '0%', ease: Power0.easeNone}
                )
                .to(
                    $( element ).find( '.m-43-flex-banner-image-overlay-right' ),
                    4,
                    {width: '100%', ease: Power0.easeNone},
                    1.5
                )
                .to(
                    $( element ).find( '.m-43-flex-banner-body' ),
                    2,
                    {y: 0, x: 0, autoAlpha: 1, ease: Expo.easeOut},
                    0
                );

            tl2.fromTo(
                $( element ).find( '.m-43-flex-banner-inner' ),
                0.6,
                { y: 50, opacity: 0 },
                { y: 0, opacity: 1, ease: Sine.easeOut}
            );

            if ($( element ).find('.m-43-flex-banner-image-overlay-left').length > 0) {
                tl2.fromTo(
                    $( element ).find( '.m-43-flex-banner-background' ),
                    2,
                    {y: '100%'},
                    {y: '0%', ease: Power3.easeOut},
                    .3
                );
            }

            element.timeline = {
                4: tl,
                3: tl,
                2: tl2,
                1: tl2,
                0: tl2
            };
        }

        function animateModelTeaser(index, element) {
            var tl = new TimelineMax({paused: true});

            tl.add(
                TweenMax.fromTo(
                    $( element ).find( ".m-73-intro-text" ),
                    0.6,
                    { x: 50, opacity: 0 },
                    { x: 0, opacity: 1, ease: Sine.easeOut}
                )
            );

            console.info($( element ).find('.m-73-tile-wrapper img'));
            var images =  $( element ).find('.m-73-tile-wrapper img');
            var mod = 1;

            // if ($(element).hasClass('swap')) {
            //     mod *= -1;
            // }

            tl.fromTo(
                images[0],
                0.6,
                { scale: 0.9, x: 100*mod, opacity: 0 },
                { scale: 1, x: 0, opacity: 1, ease: Sine.easeOut},
                0.1
            );

            tl.fromTo(
                images[1],
                0.6,
                { scale: 0.9, x: -100*mod, y: -100, opacity: 0 },
                { scale: 1, x: 0, y: 0, opacity: 1, ease: Sine.easeOut},
                0.3
            );

            tl.fromTo(
                images[2],
                0.6,
                { scale: 0.9, x: -100*mod, y: 100, opacity: 0 },
                { scale: 1, x: 0, y: 0, opacity: 1, ease: Sine.easeOut},
                0.5
            );

            tl.add(
                TweenMax.fromTo(
                    $( element ).find( ".m-73-outro-text" ),
                    0.6,
                    { x: 50, opacity: 0 },
                    { x: 0, opacity: 1, ease: Sine.easeOut}
                )
            );

            element.timeline = {
                '-1': tl
            };
        }

        function animateSmallTeaser(index, element) {
            var tl = new TimelineMax({paused: true});
            tl.add(
                TweenMax.staggerFromTo(
                    $( element ).parent().find( ".m-33-small-teaser-tile" ),
                    0.6,
                    { scale: 0.9, x: 50, opacity: 0 },
                    { scale: 1, x: 0, opacity: 1, ease: Sine.easeOut},
                    0.1
                )
            );
            element.timeline = {
                '-1': tl
            };
        }

        function animateGallery(index, element) {
            var tl = new TimelineMax({paused: true});

            tl
                .fromTo(
                    $( element ).parent(),
                    0.6,
                    { y: 50, opacity: 0 },
                    { y: 0, opacity: 1, ease: Sine.easeOut}
                );
            tl.add(
                TweenMax.staggerFromTo(
                    $( element ).find( ".gallery-slide-element" ),
                    0.6,
                    { scale: 0.9, opacity: 0 },
                    { scale: 1, opacity: 1, ease: Sine.easeOut},
                    0.1
                )
            );

            element.timeline = {
                '-1': tl
            };
        }

        function animateInfoCard(index, element) {
            var tl = new TimelineMax({paused: true});

            tl
                .fromTo(
                    $( element ).parent(),
                    0.6,
                    { y: 50, opacity: 0 },
                    { y: 0, opacity: 1, ease: Sine.easeOut}
                );
            tl.add(
                TweenMax.staggerFromTo(
                    $( element ).find( ".m-35-card-item" ),
                    0.6,
                    { scale: 0.9, opacity: 0 },
                    { scale: 1, opacity: 1, ease: Sine.easeOut},
                    0.1
                )
            );

            element.timeline = {
                '-1': tl
            };
        }
        //endregion
    }

})(jQuery, this, this.document);




/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 5/15/2017.
 */

$(document).ready(function() {
    (function(maxBodyHeight, $bodies) {
        $bodies.find('.m-41-image-teaser-navigation-item-body-link').each(function() {
            $(this).addClass('gui-link-with-arrow');
            $(this).html('<span>' + $(this).html() + '</span>');
    });

        //[BL} 04.07.2017 Task: 32050 fixed height over all viewports
        if(window.innerWidth > 1022){
            setBodyHeight($bodies);
        }else{
            $bodies.css('height', 'auto');
        }
        //[BL} 04.07.2017 Task: 32050 fixed height over all viewports
        $(window).resize(function ()
        {
            if(window.innerWidth > 1022){
                setBodyHeight($bodies);
            }else{
                $bodies.css('height', 'auto');
            }
        });
    }(0, $('.m-41-image-teaser-navigation-item-body')));

    //[BL} 04.07.2017 Task: 32050 fixed height over all viewports
    function setBodyHeight($bodies){

        var maxHeight = 0;
        $bodies.css('height', 'auto');

        $bodies.each(function() {
            if ($(this).height() > maxHeight) {
                maxHeight = $(this).height();
            }
        });

        $bodies.css('height', maxHeight + 15);
    }

    $('.m-41-image-teaser-navigation-item').each(function() {
        var tl = new TimelineLite({paused: true});

        tl.fromTo(
            $(this).find('.m-41-image-teaser-navigation-item-image'),
            .6,
            {
                scale: 1.04,
                x: 0
            },
            {
                scale: 1.04,
                x: '2%',
                ease: Power0.easeNone
            }
        );

        this.animation = tl;

        $(this).hover(function() {
            if ($(this).css('margin-left') >= '0px') {
                this.animation.play();
            }
        }, function() {
            if ($(this).css('margin-left') >= '0px') {
                this.animation.reverse();
            }
        }).click(function(e) {

            //[BL] 28.07.2017 BUGFIX - Opened the link twice on Firefox
            var $target = $(e.target);

            var isLink = $target.hasClass('m-41-image-teaser-navigation-item-body-link');
            var parentIsLink = $target.parents('a').hasClass('m-41-image-teaser-navigation-item-body-link');

            //if clicked target is link or inside of link don't open
            if((!isLink)&&(!parentIsLink)){
                window.location.href = $(this).find('a').attr('href');
            }
        });
    });
});/**
 * Created by Holger Szuesz <holger.szuesz@udg.de> on 5/15/2017.
 */

$(document).ready(function() {
    $('.with-overlay').each(function() {
        $(this).on('click', (function(trigger, overlay, background) {
            var tl = new TimelineLite({paused: true});
            var y = 400;

            if ($(trigger).parent().hasClass('posTop')) {
                y *= -1;
            }

            tl
                .fromTo(trigger,  .5, {y: 0, ease: Expo.easeOut}, {y: y})
                .fromTo(overlay, 1, {autoAlpha: 0, display: 'none'}, {autoAlpha: 1, display: 'flex'}, 0)
                .fromTo(background, 1, {scale: 1}, {scale: 1.0625, onUpdate: function(tl) {
                    TweenMax.set(tl.target,  {filter: 'blur(' + 10 * tl.progress() + 'px)'});
                }, onUpdateParams: ['{self}']}, 0);

            trigger.overlayAnimation = tl;
            overlay.overlayAnimation = tl;

            $(overlay).on('click', function() {
                this.overlayAnimation.reverse();
            });

            return function() {
                TweenLite.to(window, .25, {scrollTo: $($(this).parents('.m-43-flex-banner')[0]).offset().top - 200});

                this.overlayAnimation.play();
            };
        }(this, $(this).parents('.m-43-flex-banner').find('.m-43-flex-banner-text-overlay')[0], $(this).parents('.m-43-flex-banner').find('.m-43-flex-banner-background')[0])))
    });
});;

$(document).ready(function () {
    $('.m-43-flex-banner-slider .b-standard-module-wrapper').slick({
        dots: true,
        infinite: false,
        arrows: true,
        prevArrow: '<button type="button" class="slick-prev"></button>',
        nextArrow: '<button type="button" class="slick-next"></button>',
        responsive: [
            {
                breakpoint: 991,
                settings: {
                    arrows: false
                }
            }
        ]
    });

});

;(function ($, window, document, undefined) {
    'use strict';

    var imageScaler,
        debug;

    $(document).ready(function () {
        _lazyInit();
    });

    function _lazyInit()
    {
        var moduleClass = 'm-71-extended-teaser',
            $elements = $('.' + moduleClass);

        if($elements.length > 0)
        {
            imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

                $elements.each(function (i, el) {
                var $el = $(el);

                if (window.pageController)
                {
                    $el.one(window.pageController.eventNames.lazyInit, function () {
                        _init($el);
                    });
                }
                else
                {
                    _init($el);
                }
            });
        }
    }

    function _m71ImageScaler($slider)
    {
        $slider.find("img[data-image-src]").each(function () {
            var $el = $(this),
                scaleParam = debug ? '' : imageScaler.getScaleParameter($el);

            imageScaler.replaceSource($el, $el.attr('data-image-src'), scaleParam);
        });
    }

  function _getSlickOptions()
  {
    return {
      arrows: false,
      adaptiveHeight: false,
      dots: true,
      mobileFirst: true,
      infinite: false,
      slidesToShow: 1,
      slidesToScroll: 1,
      responsive: [
        {
          breakpoint: 1199,
          settings: {
            slidesToShow: 4,
            slidesToScroll: 3,
            arrows: true
          }
        },
        {
          breakpoint: 991,
          settings: {
            slidesToShow: 4,
            slidesToScroll: 1
          }
        },
        {
          breakpoint: 479,
          settings: {
            slidesToShow: 2,
            slidesToScroll: 1
          }
        }
      ]
    };
  }

    function _init($el)
    {
        var $slider = $el.find(".m-71-extended-teaser-container");

        if ($slider.length > 0)
        {
            $slider.slick(_getSlickOptions());
            _m71ImageScaler($el);
        }

        window.pageController && window.pageController.refresh();
    }
})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
    'use strict';

    var moduleClass = 'm-108',
        ModuleView,
        FeatureView,
        ImageSliderView,
        ImageSliderModel,
        moduleInstances = [];

    $(document).ready(function () {
        _lazyInit();
    });

    $(document).on('dynmod_loaded', function () {
        _lazyInit(true);
    });

    function _lazyInit(reInit)
    {
        reInit = (reInit === true);

        $('.' + moduleClass).each(function (i, el) {

            var $el = $(el);

            if (reInit === false && window.pageController)
            {
                $el.one(window.pageController.eventNames.lazyInit, function () {
                    _init(i, $el);
                    window.pageController.refresh();
                });
            }
            else
            {
                _init(i, $el, reInit);
            }

        });
    }

    function _init(i, $el, reInit)
    {

        var dynmodReloaded = $el.attr('data-dynmod-reloaded'),
            modelData = $el.data('model'),
            model = new Backbone.Model(modelData ? modelData : {});

        if (reInit && dynmodReloaded !== 'true')
        {
            return;
        }

        moduleInstances[i] = new ModuleView({
            el: $el,
            model: model
        });

        moduleInstances[i].render();
        $el.attr('data-dynmod-reloaded', 'false');

    }

    /** MODULE VIEW (CONTROLLER)
     *
     */
    ModuleView = ModuleBaseView.extend({
        events: {
        },

        // add only backbone instance variables here

        initialize: function (options)
        {
            ModuleBaseView.prototype.initialize.apply(this, [options]);

            // documentation: http://backbonejs.org/#View
            // init instance variables here
            // e.g. this.variable = 'string'
            this.features = [];
            this.isCategoryTypeB = false;
            this.sliderActive = false;
            this.scrollOffset = 0;
            this.model.set('preventInitialImageLoading', true);
        },

        render: function ()
        {
            ModuleBaseView.prototype.render.apply(this, arguments);

            // start point - render/update module here
            this.isCategoryTypeB = this.$el.hasClass('m-108__category-type-b');

            this._registerUiElements();
            this._getScrollOffset();
            this._parseFeatures();

            if(window.matchMediaQuery.getCurrentMediaQuery().pos < 3)
            {
                //this._enableSlider();
            }

            this._setListener();
        },

        _setListener: function ()
        {
            var self = this;

            $(document).on('MatchMediaQuery_match.' + moduleClass, function (evt, data)
            {
                self._onMediaQueryChange(evt, data);
            });
        },

        _removeListener: function ()
        {
            $(document).off('MatchMediaQuery_match.' + moduleClass);
        },

        _registerUiElements: function ()
        {
            this.$featureList = this.$el.find('.m-108__feature-list').eq(0);
            this.$features = this.$featureList.find('.m-108__feature');
            this.$contentNavigation = $('.m-72-content-navigation');
        },

        _getScrollOffset: function ()
        {
            if(this.$contentNavigation.length > 0)
            {
                this.scrollOffset = this.$contentNavigation.outerHeight();
            }
        },

        _parseFeatures: function ()
        {
            var self = this;

            this.$features.each(function (index, element) {
                self.features.push(new FeatureView({
                    el: $(element),
                    model: new Backbone.Model({
                        scrollOffset: self.scrollOffset
                    })
                }));

                self.features[index].render();
            });
        },

        _enableSlider: function ()
        {
            var self = this;

            if(!this.isCategoryTypeB || !this.model.get('enableSlider') || this.sliderActive)
            {
                return;
            }

            // TODO: INTEGRATE SLIDER
            this.$featureList.slick({
                arrows: false,
                dots: true
                //adaptiveHeight: true
            });

            this.featuresActiveSlide = 0;
            this.$featureList.off('afterChange');
            this.$featureList.on('afterChange', function (evt, slick)
            {
                if(self.featuresActiveSlide === slick.slickCurrentSlide())
                {
                    return;
                }
                self.featuresActiveSlide = slick.slickCurrentSlide();

                for(var i = 0, length = self.features.length; i < length; i++)
                {
                    self.features[i].closeDetails();
                }
            });

            this.sliderActive = true;
        },

        _disableSlider: function ()
        {
            if(!this.isCategoryTypeB || !this.sliderActive)
            {
                return;
            }

            this.$featureList.slick('unslick');

            this.sliderActive = false;
        },

        _onMediaQueryChange: function (evt, data)
        {
            if(data.pos < 3)
            {
                //this._enableSlider();
            }else
            {
                //this._disableSlider();
            }
        },

        destroy: function ()
        {
            ModuleBaseView.prototype.destroy.apply(this, arguments);

            // destroy module here
        }
    });

    /** FEATURE VIEW
     *
     */
    FeatureView = Backbone.View.extend({
        events: {
            'click .m-108__btn-more': '_onBtnMoreClick',
            'click .m-108__btn-detail-close': '_onBtnDetailCloseClick',
            'click .m-108__feature-card-headline-wrapper-small' : '_onToggleAccordion'
        },

        initialize: function (options)
        {
            this.detailsOpened = false;

            if(!this.model.get('scrollOffset'))
            {
                this.model.set('scrollOffset', 0);
            }
        },

        render: function ()
        {
            this._registerUiElements();
            this._enableImageSlider();

            // load feature card images
            ModuleBaseView.loadImages(this.$imageLoaderFeatureCardImages);
        },

        _registerUiElements: function ()
        {
            this.$featureCard = this.$el.find('.m-108__feature-card').eq(0);
            this.$featureDetail = this.$el.find('.m-108__feature-detail').eq(0);
            this.$btnMore = this.$featureCard.find('.m-108__btn-more').eq(0);
            this.$featureCardImageWrapper = this.$featureCard.find('.m-108__feature-card-image-wrapper').eq(0);
            this.$featureCardImages = this.$featureCardImageWrapper.find('.m-108__feature-card-image');
            this.$featureDetailVideos = this.$featureDetail.find('.ce-media-wrapper video');
            this.$featureDetailVideosVimeo = this.$featureDetail.find('.ce-media-wrapper.video-vimeo');

            this.$smallHeading = this.$featureCard.find('.m-108__feature-card-headline-wrapper-small');
            this.$featureCardContent = this.$featureCard.find('.m-108__feature-card-content');
            this.$cardHeading = this.$smallHeading.find('.m-108__heading');
            this.$cardImage = this.$featureCard.find('.m-108__feature-card-image-wrapper');

            this.$imageLoaderFeatureCardImages = this.$featureCard.find('img[data-image-src]');
            this.$imageLoaderFeatureDetailImages = this.$featureDetail.find('img[data-image-src]');
        },

        _toggleDetails: function ()
        {
            if(!this.detailsOpened)
            {
                this._openDetails(false);
            }else
            {
                this._closeDetails(false);
            }
        },

        _openDetails: function (isAccordion)
        {
            isAccordion = (typeof isAccordion === 'undefined') ? false : isAccordion;

            if(!this.detailsOpened)
            {
                //TweenMax.set(this.$featureDetail, {display: 'block'});
                if(this.detailTl instanceof TimelineMax)
                {
                    this.detailTl.pause();
                }
                this.detailTl = new TimelineMax();



				this.detailTl.set(this.$featureDetail, {display: 'block', height: 'auto', autoAlpha: 1});
                if(isAccordion){
                    var thiz = this;

					thiz.detailTl.set(thiz.$cardHeading, {display: 'block', height: 'auto', autoAlpha: 1});
					thiz.detailTl.set(thiz.$cardImage, {display: 'block', height: 'auto', autoAlpha: 1});
					thiz.detailTl.set(thiz.$featureCardContent, {display: 'block', height: 'auto', autoAlpha: 1});

                    this.detailTl.from(this.$el, 0.8, {height: 'auto', autoAlpha: 0, ease: Power2.easeOut,
                        onStart: function(){
							thiz.$smallHeading.find('.m-108__subheading').addClass('active');
							thiz.$el.addClass('active');
						},
                        onComplete: function () {
                            thiz.$el.css('height','auto');
						}
					});
					this.detailTl.to(window, 0.8, {scrollTo: {y: this.$el[0], offsetY: this.model.get('scrollOffset')}, ease: Power2.easeOut}, '-=0.8');
				}else{
					this.detailTl.from(this.$featureDetail, 0.8, {height: '0', autoAlpha: 0, ease: Power2.easeOut});
					this.detailTl.to(window, 0.8, {scrollTo: {y: this.$featureDetail[0], offsetY: this.model.get('scrollOffset')}, ease: Power2.easeOut}, '-=0.8');
					this.detailTl.to(this.$btnMore, 0.6, {autoAlpha: 0, ease: Power2.easeOut}, '-=0.3');
                }


                this.detailsOpened = true;
                // load feature detail images
                ModuleBaseView.loadImages(this.$imageLoaderFeatureCardImages);
                ModuleBaseView.loadImages(this.$imageLoaderFeatureDetailImages);
                this._enableDetailVideos();
            }
        },

        _closeDetails: function (isAccordion) {
          isAccordion = (typeof isAccordion === 'undefined') ? false : isAccordion;

          if (this.detailsOpened) {
            //TweenMax.set(this.$featureDetail, {clearProps: 'display'});
            if (this.detailTl instanceof TimelineMax) {
              this.detailTl.pause();
            }
            this.detailTl = new TimelineMax();

            if (isAccordion) {
              var thiz = this;


              this.detailTl.to(this.$featureDetail, 0.6, {
                height: '0', autoAlpha: 0, ease: Power2.easeOut,
                onStart: function () {

                  thiz.detailTl.to(thiz.$featureCardContent, 0.2, {
                    height: '0', autoAlpha: 0, ease: Power2.easeOut, onComplete: function () {
                      thiz.detailTl.set(thiz.$featureCardContent, {display: 'none'});
                    }
                  });

                  thiz.detailTl.to(thiz.$cardImage, 0.2, {
                    height: '0', autoAlpha: 0, ease: Power2.easeOut, onComplete: function () {
                      thiz.detailTl.set(thiz.$cardImage, {display: 'none'});
                    }
                  });

                },
                onComplete: function () {
                  thiz.detailTl.set(thiz.$featureDetail, {display: 'none'});

                  thiz.detailTl.to(thiz.$cardHeading, 0.1, {
                    height: '0', autoAlpha: 0, ease: Power2.easeOut, onComplete: function () {
                      thiz.detailTl.set(thiz.$cardHeading, {display: 'none'});

                      thiz.detailTl.to(thiz.$el, 0.8, {
                        height: 'auto', autoAlpha: 1, ease: Power2.easeOut,
                        onStart: function () {
                          thiz.$smallHeading.find('.m-108__subheading').removeClass('active');
                        },
                        onComplete: function () {
                          thiz.$el.removeClass('active');

                          thiz.detailTl.to(window, 0.8, {
                            scrollTo: {
                              y: thiz.$el[0],
                              offsetY: thiz.model.get('scrollOffset')
                            }, ease: Power2.easeOut
                          }, '-=0.8');
                        }
                      });
                    }
                  });
                }
              });
            } else {
              this.detailTl.to(this.$featureDetail, 0.8, {height: '0', autoAlpha: 0, ease: Power2.easeOut});

              this.detailTl.to(window, 0.8, {
                scrollTo: {y: this.$el[0], offsetY: this.model.get('scrollOffset')},
                ease: Power2.easeOut
              }, '-=0.8');
              this.detailTl.set(this.$featureDetail, {display: 'none'});

              this.detailTl.to(this.$btnMore, 0.6, {autoAlpha: 1, ease: Power2.easeOut}, '-=0.3');
            }

            this.detailsOpened = false;
            this._disableDetailVideos();
          }
        },

		/**
		 * open/close Accordion while click
		 * @private
		 */
		_toggleAccordion: function(){
			if(this.$smallHeading.find('.m-108__subheading').hasClass('active')){
			    //close the accordion
				this._closeDetails(true);
            }else{
			    //open the accordion
				this._openDetails(true);
            }
		},

		_enableDetailVideos: function ()
        {
            var $video,
                videoId;

            this.$featureDetailVideosVimeo.each(function (index, video)
            {
                $video = $(video);

                if(!$video.hasClass('m-108-video-initialized'))
                {
                    new window.ContentElements.VideoVimeo({el: $video});
                    $video.addClass('m-108-video-initialized');
                }
            });

            this.$featureDetailVideos.each(function (index, video)
            {
                $video = $(video);
                videoId = $video.attr('id');

                if(videoId !== undefined && !$video.hasClass('m-108-video-initialized'))
                {
                    try {
                        createVideoJSElementFromId(videoId);
                    }catch (e)
                    {
                    }
                    $video.addClass('m-108-video-initialized');
                }
            });
        },

        _disableDetailVideos: function ()
        {
            var $video,
                videoId;

            this.$featureDetailVideosVimeo.each(function (index, video)
            {
                $(video).trigger('pauseMe');
            });

            this.$featureDetailVideos.each(function (index, video)
            {
                $video = $(video);
                videoId = $video.attr('id');

                if(videoId !== undefined && $video.hasClass('m-108-video-initialized'))
                {
                    $video[0].pause();
                }
            });
        },

        _enableImageSlider: function ()
        {
            if(this.$featureCardImages.length < 2)
            {
                return;
            }

            this.imageSlider = new ImageSliderView({
                $images: this.$featureCardImages,
                model: new ImageSliderModel()
            });

            this.$featureCardImageWrapper.find('.m-108__feature-card-image-slider-wrapper').remove();
            this.$featureCardImageWrapper.append(this.imageSlider.$el);
        },

        _onBtnMoreClick: function (evt)
        {
            evt.preventDefault();
            this._toggleDetails();
        },

        _onBtnDetailCloseClick: function (evt)
        {
            evt.preventDefault();
            this._closeDetails(false);
        },

		_onToggleAccordion: function(evt){

			evt.preventDefault();
			this._toggleAccordion();
        },

        closeDetails: function ()
        {
            this._closeDetails(false);

        },

        destroy: function ()
        {
        }
    });

    /** IMAGE SLIDER VIEW
     *
     */
    ImageSliderView = Backbone.View.extend({
        events: {
        },

        tagName: 'div',
        className: 'm-108__feature-card-image-slider-wrapper',

        initialize: function (options)
        {
            this.options = options || {};

            this.sliderTemplate = '<div class="m-108__feature-card-image-slider"></div>';
            this.dotTemplate = '<div class="m-108__image-slider-dot"></div>';
            this.model.set('rangeSteps', this.model.get('rangeMax') / (this.options.$images.length - 1));

            this.render();
        },

        render: function ()
        {
            this.$el.empty();
            this.$el.append($(this.sliderTemplate));

            this._registerUiElements();
            this._addStepDots();
            this._initImageTl();
            this._initSlider();
            this._setListener();
        },

        _registerUiElements: function ()
        {
            this.$imageSlider = this.$el.find('.m-108__feature-card-image-slider').eq(0);
        },

        _setListener: function ()
        {
            var self = this;

            this.$imageSlider.on('slidechange', function (evt, ui)
            {
                self._onSlideChange(evt, ui);
            });
        },

        _initImageTl: function ()
        {
            var self = this;

            this.imageSliderTl = new TimelineMax({
                paused: true
            });

            TweenMax.set(this.options.$images, {autoAlpha: 0});
            TweenMax.set(this.options.$images.eq(0), {autoAlpha: 1});

            this.options.$images.each(function (index, element)
            {
                var $element = $(element);

                if(index === 0)
                {
                    return;
                }

                self.imageSliderTl.to($element, 0.5, {autoAlpha: 1});
            });
        },

        _initSlider: function ()
        {
            this.$imageSlider.slider({
                value: this.model.get('rangeValue'),
                min: this.model.get('rangeMin'),
                max: this.model.get('rangeMax'),
                step: this.model.get('rangeSteps')
            });
            this.lastValue = this.model.get('rangeMin');
        },

        _addStepDots: function ()
        {
            this.$imageSlider.append($(this.dotTemplate).css('left', '1px'));

            for(var i = 1, length = this.options.$images.length - 2; i <= length; i++)
            {
                this.$imageSlider.append($(this.dotTemplate).css({'left': (i * this.model.get('rangeSteps')) + '%', 'margin-left': '-3px'}));
            }

            this.$imageSlider.append($(this.dotTemplate).css('right', '1px'));
        },

        _onSlideChange: function (evt, ui)
        {
            if(ui.value === this.lastValue)
            {
                return;
            }

            this.imageSliderTl.tweenTo(this.imageSliderTl.duration() * (ui.value / 100));

            this.lastValue = ui.value;
        },

        destroy: function ()
        {
        }
    });

    ImageSliderModel = Backbone.Model.extend({
        defaults: function ()
        {
            return {
                rangeMin: 0,
                rangeMax: 100,
                rangeValue: 0
            }
        }
    });

})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
  'use strict';

  var debug = false,
      imageScaler,
      imageSelector = ".m-131__bg-image";

  $(document).ready(function () {
    _lazyInit();
  });

  function _lazyInit() {

    var moduleClass = 'm-131',
        $elements = $('.' + moduleClass);

    if ($elements.length > 0) {
      imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

      $elements.each(function (i, el) {
        var $el = $(el);
        if (window.pageController) {
          $el.one(window.pageController.eventNames.lazyInit, function () {
            _init($el);
          });
        }
        else {
          _init($el);
        }
      });
    }
  }

  function _m131ImageScaler($img) {
    var scaleParam = debug ? '' : imageScaler.getScaleParameter($img);
    imageScaler.replaceSource($img, $img.attr('data-image-src'), scaleParam);
  }

  function _init($el) {
    var $img = $el.find(imageSelector);

    if ($img.length > 0) {
      _m131ImageScaler($img);
    }

    window.pageController && window.pageController.refresh();
  }

})(jQuery, this, this.document);
;(function ($, window, document, undefined) {
  'use strict';

  var $document = $(document),
    imageScaler;

  // Lazy load the module
  $document.ready(function () {
    _lazyInit();
  });

  function _lazyInit() {
    var $elements = $('.m-052');

    if($elements.length > 0) {
      imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

      $elements.each(function (i, el) {
        var $el = $(el),
          $eventRootElement;

        if (window.pageController) {
          $eventRootElement = $el.parents(window.pageController.moduleSelectorForParentsMethod);
          $eventRootElement = $eventRootElement.length > 0 ? $eventRootElement : $el;

          $eventRootElement.one(window.pageController.eventNames.lazyInit, function () {
            _init($el);
          });
        } else {
          _init($el);
        }
      });
    }
  }

  function _init($el) {
    new ModuleView({el: $el});
  }

  // Application logic
  var ModuleView = Backbone.View.extend({
    events: {
      'afterChange .m-052__content': '_onAfterChange'
    },

    initialize: function() {
      this.$container = this.$el.find('.m-052__container');
      this.$images = this.$container.children('img');
      this.$content = this.$el.find('.m-052__content');

      this.render();
    },

    render: function() {
      this.scaleImages();
      this.parseAnimationValues();
    },

    // Background image
    scaleImages: function() {
      this.imageReadyCounter = 0;

      if (this.$images.length > 0) {
        this.$images.each(_.bind(function(i, el) {
          var $image = $(el),
            scaleParam = imageScaler.getScaleParameter($image);
          imageScaler.replaceSource($image, $image.attr('data-image-src'), scaleParam, undefined, _.bind(this._onImageReady, this));
        }, this));
      }
    },

    _onImageReady: function() {
      this.imageReadyCounter++;

      if (this.$images.length === this.imageReadyCounter) {
        this._onImagesReady();
      }
    },

    _onImagesReady: function() {
      this.scrollAnimationCounter = 0;

      this.attachBackground(0);
      this.initializeSlick();

      $document.on('MatchMediaQuery_match', _.bind(this._onMediaQueryMatch, this));
      window.pageController && window.pageController.refresh();
    },

    attachBackground: function(index) {
      // TODO: IS INDEX AVAILABLE?
      var bgsrc = this.$images.eq(index).attr('src');
      this.$container.css('background-image', 'url(' + bgsrc + ')');
    },

    // Background animation
    parseAnimationValues: function() {
      this.animationValues = [];

      this.$content.children().each(_.bind(function(i, el) {
        var $slide = $(el);
        this.animationValues.push($slide.data('animation') || 0);
      }, this));

      this.generateTimeline();
    },

    generateTimeline: function() {
      this.tl = new TimelineMax({
        paused: true,
        onUpdate: this._onTimelineUpdate,
        onUpdateScope: this
      });

      this.tlProgress = {value: 0};
      this.speed = .5;

      this.tl.to(
        this.tlProgress,
        this.speed,
        {
          'value': 1,
          ease: Linear.easeNone
        }
      );
    },

    _onAfterChange: function(e, slick, currentSlide) {
      TweenMax.to(
        this.tl,
        this.speed,
        {
          progress: this.animationValues[currentSlide],
          ease: Linear.easeNone
        }
      );
    },

    _onTimelineUpdate: function() {
      this.trueImgLength = this.$images.length - 1;
      var index = Math.round(this.tlProgress.value * this.trueImgLength);

      this.attachBackground(index);
    },

    // Slick Slider
    _onMediaQueryMatch: function (e, data) {
      this.updateSlick(data.pos);
    },

    initializeSlick: function() {
      this.$content.slick({
        dots: true,
        arrows: false,
        mobileFirst: true,
        responsive: [{
          breakpoint: 1200,
          settings: 'unslick'
        }]
      });
    },

    updateSlick: function(MediaQueryPos) {
      var tabletBreakpoint = 4;

      if (MediaQueryPos >= tabletBreakpoint && this.$content.hasClass('slick-initialized')) {
        this.destroySlick();
      } else if (MediaQueryPos < tabletBreakpoint && !this.$content.hasClass('slick-initialized')) {
        this.initializeSlick();
      }
    },

    destroySlick: function() {
      this.$content.slick('unslick');
    }
  });
})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
    'use strict';

    var ModuleView;
    var imageScaler;

    var $document = $(document);

    $document.ready(function () {
        _lazyInit();
    });

    function _lazyInit()
    {
        var $elements = $('.m-053-look-through'),
            $eventRootElement;

        if ($elements.length > 0)
        {

            imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

            $elements.each(function (i, el) {
                var $el = $(el);
                if (window.pageController)
                {
                    $eventRootElement = $el.parents(window.pageController.moduleSelectorForParentsMethod);
                    $eventRootElement = $eventRootElement.length > 0 ? $eventRootElement : $el;
                    $eventRootElement.one(window.pageController.eventNames.lazyInit, function () {
                        _init($el);
                    });
                }
                else
                {
                    _init($el);
                }
            });

        }
    }

    function _init($el)
    {
        new ModuleView({el: $el});
    }


    ModuleView = Backbone.View.extend({
        events: {},

        initialize: function () {
            this.settings = _.omit(this.$el.data(), 'lazy');
            this.render();
        },

        render: function () {

            this.$lookThroughImageContainer = this.$el.find('.m-053__images');
            this.$lookThroughImageLandscape = this.$lookThroughImageContainer.find('img.landscape');
            this.$lookThroughImagePortrait = this.$lookThroughImageContainer.find('img.portrait');
            this.$lookThroughContainer = this.$el.find(".m-053__parallax");

            if ($(this.$lookThroughImagePortrait).length > 0)
            {

                this._m053ImageScaler(this.$lookThroughImagePortrait);
            }


            if ($(this.$lookThroughImageLandscape).length > 0)
            {

                this._m053ImageScaler(this.$lookThroughImageLandscape);
            }


        },

        callback: function () {
            var src, viewportRatio;
            viewportRatio = $(window).width() / $(window).height();
            if (viewportRatio < 1)
            {
                src = this.$lookThroughImagePortrait.attr('src');
                this.$lookThroughContainer.addClass("portrait")

                if ($(this.$lookThroughImagePortrait).length == 0)
                {
                    src = this.$lookThroughImageLandscape.attr('src');
                }
            }
            else
            {
                src = this.$lookThroughImageLandscape.attr('src');
            }

            this.$lookThroughContainer.css('background-image', 'url(' + src + ')');
            this.$lookThroughImageContainer.css("display", "none");

        },

        _m053ImageScaler: function ($image) {
            var scaleParam,
                containerWidth,
                containerHeight;

            this.$lookThroughImageContainer.css("display", "block");

            //containerWidth = this.$lookThroughImageContainer.width();
            //containerHeight = this.$lookThroughImageContainer.height();


            scaleParam = imageScaler.getScaleParameter($image);
            imageScaler.replaceSource($image, $image.data('image-src'), scaleParam, undefined, _.bind(this.callback, this));
        }


    });
})(jQuery, this, this.document);
;
(function ($, window, document, undefined) {
    'use strict';

    var $document = $(document);

    $document.ready(function () {
        _lazyInit();
    });

    function _lazyInit()
    {
        var $elements = $('.m-054-pano'),
            $eventRootElement;

        if ($elements.length > 0)
        {
            $elements.each(function (i, el) {
                var $el = $(el);
                if (window.pageController)
                {
                    $eventRootElement = $el.parents(window.pageController.moduleSelectorForParentsMethod);
                    $eventRootElement = $eventRootElement.length > 0 ? $eventRootElement : $el;
                    $eventRootElement.one(window.pageController.eventNames.lazyInit, function () {
                        _init($el);
                    });
                }
                else
                {
                    _init($el);
                }
            });
        }
    }

    function _init($el)
    {
        new ModuleView({el: $el});
    }

    var ModuleView = Backbone.View.extend({
        events: {
            "click .m-054__activation": "_openPano",
            "click .m-054__pano-close": "_closePano"
        },

        initialize: function () {
            this.settings = _.omit(this.$el.data(), 'lazy');
            this.render();
        },

        render: function () {
            this.$panoContainer = this.$el.find('.m-054__pano');

            if (this.settings.autoload && !this.panoOpen)
            {
                this._openPano();
            }
        },

        _openPano: function () {
            this.panoOpen = true;

            if (this.settings.fullscreen)
            {
                this.scrollTop = $document.scrollTop(); // save scroll position
            }

            if (!this.$iFrame)
            {
                this.$iFrame = $('<iframe src="/' + this.settings.src + '/index.html" frameborder="0" webkitallowfullscreen="" mozallowfullscreen="" allowfullscreen=""></iframe>')
            }

            this.$panoContainer.prepend(this.$iFrame);
            this.$panoContainer.show();

        },

        _closePano: function () {
            if (this.settings.fullscreen)
            {
                $document.scrollTop(this.scrollTop); // reset scroll position
            }

            this.$panoContainer.hide();
            this.$iFrame.remove();

            this.panoOpen = false;
        }
    });
})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
  'use strict';

  var imageScaler;

  $(document).ready(function () {
    _lazyInit();
  });

  function _lazyInit()
  {
    var moduleClass = 'm-55',
        $elements = $('.' + moduleClass);

    if ($elements.length > 0)
    {
      imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

      $elements.each(function (i, el) {
        var $el = $(el);
        if (window.pageController)
        {
          $el.one(window.pageController.eventNames.lazyInit, function () {
            _init($el);
          });
        }
        else
        {
          _init($el);
        }
      });
    }
  }

  function _init($el)
  {
    var $image = $el.find(".m-55__background-image")

    if ($image.length > 0)
    {
      _m055ImageScaler($image);
    }

    window.pageController && window.pageController.refresh();
  }

  function _m055ImageScaler($image)
  {
     var scaleParam = imageScaler.getScaleParameter($image);
     imageScaler.replaceSource($image, $image.attr('data-image-src'), scaleParam);
  }

})(jQuery, this, this.document);
;
(function ($, window, document, undefined) {
    'use strict';

    var ModuleView,
        ModuleModel,
        imageScaler,

        M056_STATE_PREFIX = 'm-056__state',
        M056_STATE = {
            RUNNING: M056_STATE_PREFIX + '--running',
            ENDED: M056_STATE_PREFIX + '--ended'
        },

        $document = $(document);

    $document.ready(function () {
        _lazyInit();
    });

    function _lazyInit()
    {
        var $elements = $('.countdown_module'),
            $eventRootElement;

        if ($elements.length > 0)
        {
            imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

            $elements.each(function (i, el) {
                var $el = $(el);
                if (window.pageController)
                {
                    $eventRootElement = $el.parents(window.pageController.moduleSelectorForParentsMethod);
                    $eventRootElement = $eventRootElement.length > 0 ? $eventRootElement : $el;
                    $eventRootElement.one(window.pageController.eventNames.lazyInit, function () {
                        _init($el);
                    });
                }
                else
                {
                    _init($el);
                }
            });
        }
    }

    function _init($el)
    {
        new ModuleView({el: $el});
    }

    ModuleView = Backbone.View.extend({
        events: {
            //"click .m-054__activation": "_openPano",
        },

        endDatetime: undefined,

        counterPartContainer: undefined,
        counterPartSettings: undefined,
        $innerWrapper: undefined,

        requestAnimationFrameID: undefined,

        initialize: function () {
            var modelData;

            // Initialize model with correct data
            this.modelDataName = this.$el.data('model');
            modelData = _.getValueByName(this.modelDataName, window, {});
            this.model = new ModuleModel(modelData);

            // Parse end datetime
            this.endDatetime = this._parseDatetime(this.model.get('config.global.countdown.end'));
            //this.endDatetime = new Date(Date.now()-500);

            // Handle state and set state listener
            this.model.set(
                'state',
                this._getRemainingTime(this.endDatetime) < 0 ? M056_STATE.ENDED : M056_STATE.RUNNING
            );
            this.listenTo(this.model, 'change:state', this.render);

            // Get inner wrapper dom element
            this.$innerWrapper = this.$el.find('.m-056__countdown-module');

            this.counterPartContainer = {};
            this.counterPartSettings = {
                use: {},
                last: {}
            };

            this.render();


        },

        render: function () {
            var markup,
                showButton,
                STATE;

            // Cancel the last animation frames
            if (typeof this.requestAnimationFrameID !== 'undefined')
            {
                cancelAnimationFrame(this.requestAnimationFrameID);
            }

            // read model
            showButton = this.model.get('config.showButton');
            STATE = this.model.get('state');

            // render markup
            markup = $(this.model.getHandlebarsTemplate());
            this.$innerWrapper.html(markup);

            // set state class
            _.removeClassByPrefix(this.$el, M056_STATE_PREFIX);
            this.$el.addClass(STATE);

            // Handle states
            switch (STATE)
            {
                case M056_STATE.RUNNING:
                    this._initCounter();
                    break;
                case M056_STATE.ENDED:
                    this._initCounterEnded();
                    break;
            }
        },


        // Scale images
        _scaleImages: function ($images) {
            $images.each(function (i, el) {
                var $image = $(el),
                    scaleParam = imageScaler.getScaleParameter($image);

                imageScaler.replaceSource($image, $image.attr('data-image-src'), scaleParam);
            });
        },

        // Parse Datetime
        _parseDatetime: function (val) {
            var datetime,
                parts,
                i;

            parts = val.split(/[\- :.]/ig);

            for (i = 0; i < 7; i++)
            {
                parts[i] = _.tryParseInt(parts[i], 0);
            }

            datetime = new Date(Date.UTC(
                parts[0],
                parts[1] - 1, // Month is 0 based
                parts[2],
                parts[3],
                parts[4],
                parts[5],
                parts[6]
            ));

            return datetime;
        },

        //Counter Function
        _initCounterEnded: function () {
            //select markup for display
            //console.log('ended');
        },

        _initCounter: function () {
            //select markup for display
            this.counterPartContainer.$days = this.$el.find('.m-056__days .m-056__value');
            this.counterPartSettings.use.days = this.counterPartContainer.$days.length > 0;

            this.counterPartContainer.$hours = this.$el.find('.m-056__hours .m-056__value');
            this.counterPartSettings.use.hours = this.counterPartContainer.$hours.length > 0;

            this.counterPartContainer.$minutes = this.$el.find('.m-056__minutes .m-056__value');
            this.counterPartSettings.use.minutes = this.counterPartContainer.$minutes.length > 0;

            this.counterPartContainer.$seconds = this.$el.find('.m-056__seconds .m-056__value');
            this.counterPartSettings.use.seconds = this.counterPartContainer.$seconds.length > 0;

            this.counterPartContainer.$milliseconds = this.$el.find('.m-056__milliseconds .m-056__value');
            this.counterPartSettings.use.milliseconds = this.counterPartContainer.$milliseconds.length > 0;

            this.requestAnimationFrameID = requestAnimationFrame(_.bind(this._showTime, this));
        },


        //calculate time between actual time and target time
        _getRemainingTime: function (deadline) {
            return deadline - new Date().getTime();
        },

        //set 0 advanced
        _addNumberPadding: function (value, slice) {
            slice = typeof slice === 'undefined' ? 2 : slice;
            return ('0' + Math.floor(value)).slice(-1 * slice);
        },

        //show time repeatedly
        _showTime: function () {

            var remainingTime,

                days,
                hours,
                minutes,
                seconds,
                milliseconds,

                daysChanged = false,
                hoursChanged = false,
                minutesChanged = false,
                secondsChanged = false,
                millisecondsChanged = false;

            this.requestAnimationFrameID = undefined;

            remainingTime = this._getRemainingTime(this.endDatetime);

            // Only when the previous changed
            if (this.counterPartSettings.use.milliseconds)
            {
                milliseconds = this._addNumberPadding((remainingTime % 1000), 3);
                if (milliseconds !== this.counterPartSettings.last.milliseconds)
                {
                    this.counterPartSettings.last.milliseconds = milliseconds;
                    this.counterPartContainer.$milliseconds.html(milliseconds);
                    millisecondsChanged = true;
                }
            }

            // Only when the previous changed
            if ((millisecondsChanged || !this.counterPartSettings.use.milliseconds) && this.counterPartSettings.use.seconds)
            {
                seconds = this._addNumberPadding((remainingTime / 1000) % 60);
                if (seconds !== this.counterPartSettings.last.seconds)
                {
                    this.counterPartSettings.last.seconds = seconds;
                    this.counterPartContainer.$seconds.html(seconds);
                    secondsChanged = true;
                }
            }

            // Only when the previous changed
            if ((secondsChanged || !this.counterPartSettings.use.seconds) && this.counterPartSettings.use.minutes)
            {
                minutes = this._addNumberPadding((remainingTime / (60 * 1000)) % 60);
                if (minutes !== this.counterPartSettings.last.minutes)
                {
                    this.counterPartSettings.last.minutes = minutes;
                    this.counterPartContainer.$minutes.html(minutes);
                    minutesChanged = true;
                }
            }

            // Only when the previous changed
            if ((minutesChanged || !this.counterPartSettings.use.minutes) && this.counterPartSettings.use.hours)
            {
                hours = this._addNumberPadding((remainingTime / (60 * 60 * 1000)) % 24);
                if (hours !== this.counterPartSettings.last.hours)
                {
                    this.counterPartSettings.last.hours = hours;
                    this.counterPartContainer.$hours.html(hours);
                    hoursChanged = true;
                }
            }

            // Only when the previous changed
            if ((hoursChanged || !this.counterPartSettings.use.hours) && this.counterPartSettings.use.days)
            {
                days = this._addNumberPadding(remainingTime / (24 * 60 * 60 * 1000));
                if (days !== this.counterPartSettings.last.days)
                {
                    this.counterPartSettings.last.days = days;
                    this.counterPartContainer.$days.html(days);
                    daysChanged = true;
                }
            }


            //update if second o more is remaining
            if (remainingTime > 0)
            {
                this.requestAnimationFrameID = requestAnimationFrame(_.bind(this._showTime, this));
            } else
            {
                this.model.set('state', M056_STATE.ENDED);
            }

        }

    });

    ModuleModel = Backbone.Model.extend({

        constructor: function () {
            var data = arguments[0];

            // Handlebars Helper
            Handlebars.registerHelper('if_eq', function (a, b, opts) {
                if (a == b) // Or === depending on your needs
                    return opts.fn(this);
                else
                    return opts.inverse(this);
            });

            // Button Parsing
            data.button = {
                label: _.getValueByName('texts.content.button_label', data, _.getValueByName('defaultTexts.moreabout', data, '')),
                link: _.getValueByName('texts.content.button_link', data, '').replace(/.*href="([^"]*)".*/ig, '$1')
            };

            Backbone.Model.apply(this, arguments);
        },

        /**
         * Get a value of the model and give the possibility to use namespaces and have a optional fallback.
         *
         * @override
         *
         * @param {string} attributeName
         * @param {*} [fallback]
         * @returns {*}
         */
        get: function (attributeName, fallback) {
            return _.getValueByName(attributeName, this.attributes, fallback);
        },

        /**
         * Get the handlebars template to process
         * @param {object} [data] - addtitional data
         * @returns {*}
         */
        getHandlebarsTemplate: function (data) {
            var template,
                hbsTemplate;

            template = this.get('config.template');
            hbsTemplate = Handlebars.compile(template);

            return hbsTemplate(_.extend(this.attributes, data));
        }


    });
})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
    'use strict';

    var mapModuleBaseIsAvailable = _.getValueByName('MapModuleBase', window, false) !== false,

        moduleName = 'm-057',

        ModuleViewMap,
        ModuleViewList,
        ModuleViewSingle,
        ModuleModel,

        ResultView,
        ResultModel,
        ResultCollection,

        theModuleViews = [],

        DEV_MODE = _.getUrlParamByName('moduledebug') === 'true',

        $document = $(document);

    $document.ready(function () {
        _lazyInit();
    });

    function _lazyInit()
    {
        var $elements = $('.' + moduleName),
            $eventRootElement;

        if ($elements.length > 0)
        {
            $elements.each(function (i, el) {
                var $el = $(el);
                if (window.pageController)
                {
                    $eventRootElement = $el.parents(window.pageController.moduleSelectorForParentsMethod);
                    $eventRootElement = $eventRootElement.length > 0 ? $eventRootElement : $el;
                    $eventRootElement.one(window.pageController.eventNames.lazyInit, function () {
                        _init($el);
                    });
                }
                else
                {
                    _init($el);
                }
            });
        }
    }

    function _init($el)
    {
        var viewmode,
            ViewmodeRelatedModuleView;

        viewmode = $el.attr('data-viewmode');

        if (!mapModuleBaseIsAvailable)
        {

            console.error('MISSING MapModuleBase in m-057');

        } else
        {

            if (typeof ModuleViewMap === 'undefined')
            {
                _initModulesAndViews();
            }

            switch (viewmode)
            {
                case 'single':
                    ViewmodeRelatedModuleView = ModuleViewSingle;
                    break;
                case 'list':
                    ViewmodeRelatedModuleView = ModuleViewList;
                    break;
                case 'map':
                default:
                    ViewmodeRelatedModuleView = ModuleViewMap;
                    break;
            }

            theModuleViews.push(new ViewmodeRelatedModuleView(
                {
                    el: $el,
                    moduleNamePrefix: moduleName,
                    ModuleModel: ModuleModel,
                    ResultView: ResultView,
                    ResultCollection: ResultCollection
                }
            ));

        }
    }

    function _initModulesAndViews()
    {
        // Make MapModuleBase fully available
        MapModuleBase.init();

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     VIEW - Viewmode map
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ModuleViewMap = MapModuleBase.View.extend({});

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     VIEW - Viewmode single
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ModuleViewList = ModuleBaseView.extend({
            events: {},

            moduleName: undefined,

            // TOUCH
            hasTouch: undefined,

            // RESULTS
            ResultView: undefined,
            resultCollection: undefined,

            //----------------------------------------------------------------------
            // region INITIALIZATION
            //----------------------------------------------------------------------

            initialize: function (options) {
                var modelData;

                ModuleBaseView.prototype.initialize.apply(this, arguments);

                // Initialize model with correct data
                this.modelDataName = this.$el.data('model');
                modelData = _.getValueByName(this.modelDataName, window, {});
                this.model = new (_.getValueByName('ModuleModel', options, ModuleModel))(modelData);

                // HAS TOUCH
                this.hasTouch = Modernizr['touch'] || false;

                // IMPLEMENT AFTER RENDER
                _.bindAll(this, 'render', 'afterRender');
                this.render = _.wrap(this.render, function (render) {
                    render();
                    this.afterRender();
                    return this;
                });

                this.moduleName = _.getValueByName('moduleNamePrefix', options, 'map-module-base-single');

                this.ResultView = _.getValueByName('ResultView', options, ResultView);
                this.resultCollection = new (_.getValueByName('ResultCollection', options, ResultCollection))({moduleModel: this.model});

                this.render();
            },

            // endregion

            //
            //----------------------------------------------------------------------
            // region RENDER
            //----------------------------------------------------------------------

            render: function () {

                // Result
                this.$resultContainer = this.$el.find('.' + this.moduleName + '__listView-container');
                this.$resultList = this.$el.find('.' + this.moduleName + '__listView-list');

                // DEFAULT RENDER
                ModuleBaseView.prototype.render.apply(this, arguments);
            },

            afterRender: function () {

                this.setEventHandlers();

                this.resultCollection.fetch();
            },

            // endregion

            //----------------------------------------------------------------------
            // region EVENTS
            //----------------------------------------------------------------------

            setEventHandlers: function () {
                this.listenTo(this.resultCollection, 'add', this.onResultCollectionChange);
            },

            // endregion


            //----------------------------------------------------------------------
            // region RESULTS
            //----------------------------------------------------------------------

            onResultCollectionChange: function () {
                this.showResults();
            },

            showResults: function () {

                this.$resultList.html('');
                this.$resultContainer.hide();

                if (this.resultCollection.length)
                {
                    this.resultCollection.each(_.bind(function (resultModel) {

                        var view;

                        view = new this.ResultView(
                            {
                                templates: this.model.get('config.templates', {}),
                                model: resultModel,
                                moduleModel: this.model
                            }
                        );

                        view.render();

                        this.$resultList.append(view.$el);

                    }, this));

                    this.$resultContainer.show();
                }
            },

            // endregion

            //----------------------------------------------------------------------
            // region ERROR MESSAGE
            //----------------------------------------------------------------------

            showErrorMessage: function (name, msg2) {
                var msg;

                msg = this.model.get('texts.error.' + name, 'ERROR');

                if (DEV_MODE && msg2)
                {
                    msg += '<br>' + '<i>' + msg2 + '</i>';
                }

                console.warn(msg); // TODO
            },

            hideErrorMessage: function () {
                // TODO
            },

            // endregion

            //----------------------------------------------------------------------
            // region DESTROY
            //----------------------------------------------------------------------

            destroy: function () {
                ModuleBaseView.prototype.destroy.apply(this, arguments);
            }

            // endregion

        });

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     VIEW - Viewmode single
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ModuleViewSingle = ModuleBaseView.extend({
            events: {},

            moduleName: undefined,

            // TOUCH
            hasTouch: undefined,

            // RESULTS
            ResultView: undefined,
            resultCollection: undefined,

            //----------------------------------------------------------------------
            // region INITIALIZATION
            //----------------------------------------------------------------------

            initialize: function (options) {
                var modelData;

                ModuleBaseView.prototype.initialize.apply(this, arguments);

                // Initialize model with correct data
                this.modelDataName = this.$el.data('model');
                modelData = _.getValueByName(this.modelDataName, window, {});
                this.model = new (_.getValueByName('ModuleModel', options, ModuleModel))(modelData);

                // HAS TOUCH
                this.hasTouch = Modernizr['touch'] || false;

                // IMPLEMENT AFTER RENDER
                _.bindAll(this, 'render', 'afterRender');
                this.render = _.wrap(this.render, function (render) {
                    render();
                    this.afterRender();
                    return this;
                });

                this.moduleName = _.getValueByName('moduleNamePrefix', options, 'map-module-base-single');

                this.ResultView = _.getValueByName('ResultView', options, ResultView);
                this.resultCollection = new (_.getValueByName('ResultCollection', options, ResultCollection))({moduleModel: this.model});

                this.render();
            },

            // endregion

            //
            //----------------------------------------------------------------------
            // region RENDER
            //----------------------------------------------------------------------

            render: function () {

                // Result
                this.$resultContainer = this.$el.find('.' + this.moduleName + '__singleView-container');
                this.$resultList = this.$el.find('.' + this.moduleName + '__singleView-list');

                // DEFAULT RENDER
                ModuleBaseView.prototype.render.apply(this, arguments);
            },

            afterRender: function () {
                var eventID;

                eventID = this.getEventID();

                this.setEventHandlers();

                if (_.isStringNotEmpty(eventID))
                {
                    this.resultCollection.fetchWithID(eventID);
                }
                else
                {
                    console.warn('057 Single Viewmode needs eventid as url parameter.');
                }
            },

            // endregion

            //----------------------------------------------------------------------
            // region EVENTS
            //----------------------------------------------------------------------

            setEventHandlers: function () {

                this.listenTo(this.resultCollection, 'add', this.onResultCollectionChange);
            },

            // endregion


            //----------------------------------------------------------------------
            // region RESULTS
            //----------------------------------------------------------------------

            onResultCollectionChange: function () {
                this.resultModel = this.resultCollection.at(0);
                this.showResult();
                this.checkParticipants();

            },

            checkParticipants: function () {
                var show,
                    count,
                    $select,
                    selectedValue,
                    selectedMarkup,
                    optionsMarkup,
                    i;

                show = this.resultModel.get('showParticipants', true);
                count = this.resultModel.get('maxParticipants');
                optionsMarkup = "";

                if (!show || count < 2)
                {
                    $('.m-057__select-participants').remove();
                }
                else
                {
                    if (_.isInteger(count))
                    {
                        $select = $('.m-057__select-participants select');

                        selectedValue = _.tryParseInt($select.find('option.selected').val());
                        if (selectedValue > 0)
                        {
                            $select.find('option').remove();
                        } else
                        {
                            $select.find('option:not(.selected)').remove();
                        }

                        for (i = 1; i <= count; i++)
                        {
                            selectedMarkup = '';
                            if (selectedValue === i)
                            {
                                selectedMarkup = '  selected="selected" class="selected"'
                            }
                            optionsMarkup += '<option value="' + i + '"' + selectedMarkup + '>' + i + '</option>';
                        }

                        $select.append(optionsMarkup);
                    }
                }
            },

            showResult: function () {
                var view;

                this.$resultList.html('');
                this.$resultContainer.hide();

                if (this.resultModel)
                {
                    view = new this.ResultView(
                        {
                            templateName: 'eventSingle',
                            templates: this.model.get('config.templates', {}),
                            model: this.resultModel,
                            moduleModel: this.model
                        }
                    );

                    view.render();

                    this.$resultList.append(view.$el);

                    this.$resultContainer.show();
                }
            },

            // endregion

            //----------------------------------------------------------------------
            // region ERROR MESSAGE
            //----------------------------------------------------------------------

            showErrorMessage: function (name, msg2) {
                var msg;

                msg = this.model.get('texts.error.' + name, 'ERROR');

                if (DEV_MODE && msg2)
                {
                    msg += '<br>' + '<i>' + msg2 + '</i>';
                }

                console.warn(msg); // TODO
            },

            hideErrorMessage: function () {
                // TODO
            },

            // endregion

            //----------------------------------------------------------------------
            // region HELPER FUNCTIONS
            //----------------------------------------------------------------------

            getEventID: function () {
                var eventID;

                eventID = this.getURLParameter('eventid');

                if (_.isStringNotEmpty(eventID))
                {
                    return eventID;
                }

                eventID = this.getGlobalInputValue('eventid');

                if (_.isStringNotEmpty(eventID))
                {
                    return eventID;
                }

                return undefined;
            },

            getGlobalInputValue: function (name) {
                return $('input#eventid').val();
            },

            getURLParameter: function (name) {
                return _.getUrlParamByName(name);
            },

            // endregion

            //----------------------------------------------------------------------
            // region DESTROY
            //----------------------------------------------------------------------

            destroy: function () {
                ModuleBaseView.prototype.destroy.apply(this, arguments);
            }

            // endregion

        });

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     MODEL
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ModuleModel = MapModuleBase.Model.extend({

            initialize: function () {
                var data = arguments[0];

                // parse default texts
                _.namespace('texts.map.placeholder', data, _.getValueByName('texts.map.placeholder', data, _.getValueByName('defaultTexts.searchinput', data, '')));
                _.namespace('texts.map.submit', data, _.getValueByName('texts.map.submit', data, _.getValueByName('defaultTexts.search', data, '')));
                _.namespace('texts.error.noResult', data, _.getValueByName('texts.error.noResult', data, _.getValueByName('defaultTexts.UI_STRINGCONST_SEARCHFAIL', data, '')));
                _.deleteValueByName('defaultTexts', data);

                // map data
                _.namespace('config.mapData.center.lat', data, _.getValueByName('config.mapData.UI_MAP_DEFAULTCOORDS_LAT', data, 0.0));
                _.deleteValueByName('config.mapData.UI_MAP_DEFAULTCOORDS_LAT', data);
                _.namespace('config.mapData.center.lng', data, _.getValueByName('config.mapData.UI_MAP_DEFAULTCOORDS_LNG', data, 0.0));
                _.deleteValueByName('config.mapData.UI_MAP_DEFAULTCOORDS_LNG', data);
                _.namespace('config.mapData.zoom', data, _.getValueByName('config.mapData.UI_MAP_DEFAULTCOORDS_ZOOMLEVEL', data, 11));
                _.deleteValueByName('config.mapData.UI_MAP_DEFAULTCOORDS_ZOOMLEVEL', data);
                _.namespace('config.mapData.region', data, _.getValueByName('config.mapData.UI_MAP_DEFAULT_REGION', data, undefined));
                _.deleteValueByName('config.mapData.UI_MAP_DEFAULT_REGION', data);

                // api url
                _.namespace('config.api', data, _.getValueByName('config.global.api', data, {'url': '/json/{{market}}/{{language}}/{{category}}/events.json'}));
                _.deleteValueByName('config.global.api', data);

                // delete templates
                _.deleteValueByName('config.global.templates', data);

                // delete templates
                _.deleteValueByName('config.global', data);

                return MapModuleBase.Model.prototype.initialize.apply(this, arguments);
            }

        });

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     RESULT MODEL
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ResultModel = MapModuleBase.ResultModel.extend({
            getMarkerData: function () {
                return {
                    id: this.get('id'),
                    title: this.get('headline'),
                    lat: this.get('locationdata.latitude'),
                    lng: this.get('locationdata.longitude')
                }
            },

            getResultTemplateData: function () {
                var baseData = this.toJSON();

                var startDate = this.get('startdate'),
                    endDate = this.get('enddate'),
                    startTime = this.get('starttime'),
                    endTime = this.get('endtime');

                var combinedStartDate,
                    combinedEndDate,
                    localeStartDate,
                    localeEndDate;

                var useReplyemail = this.get('useReplyemail'),
                    useExternalForm = this.get('useExternalForm'),
                    externalForm = this.get('externalForm'),
                    useDataExport = this.get('useDataExport'),
                    fullyBooked = this.get('fullyBooked');

                if (startTime !== undefined)
                {
                    combinedStartDate = new Date(startDate + 'T' + startTime + 'Z');
                    localeStartDate = combinedStartDate.toLocaleString(undefined, {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: 'numeric',
                        minute: 'numeric'
                    });

                    baseData.formattedStartDate = localeStartDate.replace(' ', '&nbsp;');

                } else
                {

                    combinedStartDate = new Date(startDate);
                    localeStartDate = combinedStartDate.toLocaleString(undefined, {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });

                    baseData.formattedStartDate = localeStartDate.replace(' ', '&nbsp;');
                }

                if (endDate !== undefined)
                {
                    if (endTime !== undefined)
                    {
                        combinedEndDate = new Date(endDate + 'T' + endTime + 'Z');
                        localeEndDate = combinedEndDate.toLocaleString(undefined, {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric',
                            hour: 'numeric',
                            minute: 'numeric'
                        });

                        baseData.formattedEndDate = localeEndDate.replace(' ', '&nbsp;');

                    } else
                    {

                        combinedEndDate = new Date(endDate);
                        localeEndDate = combinedEndDate.toLocaleString(undefined, {
                            day: 'numeric',
                            month: 'long',
                            year: 'numeric'
                        });

                        baseData.formattedEndDate = localeEndDate.replace(' ', '&nbsp;');
                    }
                }

                switch (true)
                {
                    case useExternalForm && externalForm !== undefined && !fullyBooked:
                        baseData.externalFormButton = true;
                        baseData.externalFormLink = externalForm;
                        break;
                    case fullyBooked:
                        baseData.fullyBooked = true;
                        break;
                    case !useReplyemail && !useExternalForm && !useDataExport:
                        baseData.freeForAll = true;
                        break;
                    default:
                        baseData.registerButton = true;
                }

                // Needed for event-single.hbs
                baseData.formattedContent = this.get('content').replace('\\n', '<br>');

                return baseData;
            }

        });

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     RESULT COLLECTION
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ResultCollection = MapModuleBase.ResultCollection.extend({

            model: ResultModel,

            initialize: function (options) {

                MapModuleBase.ResultCollection.prototype.initialize.apply(this, arguments);

                if (this.moduleModel)
                {
                    this.apiData = {
                        url: this.moduleModel.get('config.api.url', ''),
                        market: this.moduleModel.get('config.eventData.market', ''),
                        language: this.moduleModel.get('config.eventData.language', ''),
                        category: this.moduleModel.get('config.eventData.category', '')
                    };

                    this.url = this.setupUrl();
                }

                return this;
            },

            fetchWithID: function (id) {
                this.fetch({data: _.extend(this.defaultParam, {ids: id})});
            },

            setupUrl: function () {
                var template,
                    url;

                template = _.template(
                    this.apiData.url,
                    {
                        interpolate: /\{\{(.+?)\}\}/g
                    }
                );

                url = template(this.apiData);

                return url;

            },

            parse: function (response) {
                return _.getValueByName('events', response, []);
            }

        });

        /*
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         *
         *     RESULT VIEW
         *
         * - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
         */
        ResultView = MapModuleBase.ResultView.extend({
            templateName: 'event',

            render: function () {
                var data,
                    eventId,
                    registerLink;

                data = this.model.getResultTemplateData();
                eventId = this.model.get('id');
                registerLink = this.moduleModel.get('config.eventData.registration');

                if (_.isStringNotEmpty(registerLink))
                {
                    registerLink += '?eventid=' + encodeURIComponent(eventId);
                } else
                {
                    data.registerButton = false;
                }

                data = _.extend(
                    {
                        texts: this.moduleModel.get('texts.registration'),
                        registerLink: registerLink
                    },
                    data
                );

                this.$el.html(this.template(data));
                return this;
            },

            isAdded: function () {
                MapModuleBase.ResultView.prototype.isAdded.apply(this, arguments);

                this.clampCopy();
            },

            clampCopy: function () {
                var $copy;

                $copy = this.$el.find('.m-057__resultBox-copy');

                $clamp($copy[0], {
                    clamp: 5,
                    useNativeClamp: false,
                    truncationChar: '...',
                    splitOnChars: ['.', ','] //, ' ']
                });
            }
        });

    }

})(jQuery, this, this.document);
;(function ($, window, document, undefined) {
    'use strict';

    var $document = $(document),
        imageScaler,
        ModuleView;

    // Sample usage: $el.trigger(M056_EVENTS.OPEN_FOLD, {foldID: 'THE_FOLD_ID'});
    window.M056_EVENTS = {
        OPEN_FOLD: 'open-fold',
        CLOSE_FOLD: 'close-fold',
        CLOSE_FOLD_ALL: 'close-fold-all'
    };

// region LAZY LOAD
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

    $document.ready(function () {
        _lazyInit();
    });

    function _lazyInit() {
        var $elements = $('.m-058'),
            $eventRootElement;

        if ($elements.length > 0) {
            imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();

            $elements.each(function (i, el) {
                var $el = $(el);

                if (window.pageController) {
                    $eventRootElement = $el.parents(window.pageController.moduleSelectorForParentsMethod);
                    $eventRootElement = $eventRootElement.length > 0 ? $eventRootElement : $el;

                    $eventRootElement.one(window.pageController.eventNames.lazyInit, function () {
                        _init($el);
                    });
                } else {
                    _init($el);
                }
            });
        }
    }

    function _init($el) {
        new ModuleView({el: $el});
    }

// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
// endregion

    ModuleView = Backbone.View.extend({
        events: (function () {
            var events = {};

            events[window.M056_EVENTS.OPEN_FOLD] = '_onFoldEvent';
            events[window.M056_EVENTS.CLOSE_FOLD] = '_onFoldEvent';
            events[window.M056_EVENTS.CLOSE_FOLD_ALL] = '_onFoldEvent';
            events['click .m-058__fold-header'] = '_onFoldClick';

            return events;
        })(),

        initialize: function () {
            this.$fold = this.$el.find('.m-058__fold');
            this.$headerImages = this.$el.find('img.m-058__fold-header-image');

            this.render();
        },

        render: function () {
            this._scaleImages(this.$headerImages);
            this._closeAllFolds();
            var $firstFold = $(".m-058__fold-01");
            this._openFold($firstFold,false);

            window.pageController && window.pageController.refresh();
        },

// region IMAGES & SLIDER
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

        _scaleImages: function ($images) {
            $images.each(function (i, el) {
                var $image = $(el),
                    scaleParam = imageScaler.getScaleParameter($image);

                imageScaler.replaceSource($image, $image.attr('data-image-src'), scaleParam);
            });
        },

        _initializeSlick: function ($fold) {
            var excludeSelectors = [
                    '.m-058__fold-entry-template--highlight',
                    '.m-058__fold-entry-template--single-media'
                ],
                $entriesWithSlider = $fold.find('.m-058__fold-entry:not(' + excludeSelectors.join(',') + ')');

            $entriesWithSlider.each(_.bind(function (i, el) {
                var $el = $(el),
                    $sliderContainer = $el.find('.m-058__fold-entry-media');

                if (!$sliderContainer.hasClass('slick-initialized')) {
                    $sliderContainer.slick({
                        dots: true
                    });
                }
            }, this));
        },

// endregion

// region FOLD ACTIONS
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

        _openFold: function ($fold, animate) {
            var $entryImages = $fold.find('.m-058__fold-entry-image'),
                $entries = $fold.find(".m-058__fold-entries");

            $fold.addClass('m-058__fold--active');

            this._scaleImages($entryImages);
            this._initializeSlick($fold);

            if (animate) {

                TweenMax.to(window, .25, {
                    scrollTo: {y: $fold.offset().top - 60},
                    onComplete: _.bind(function () {
                        this._closeAllFolds($fold);
                        TweenMax.set(window, {
                            scrollTo: {y: $fold.offset().top - 60}
                        });
                    }, this),
                    onCompleteParams: [$fold]
                });

                TweenMax.set($entries, {height: "100vh"});
                TweenMax.from($entries, 0.4, {
                    height: 0,
                    onComplete: function () {
						TweenMax.set($entries, {height: "auto"});
					},
                    onCompleteParams: [$entries]
                });
            }
        },

        _closeFold: function ($fold, animate) {
            var isOpen = $fold.hasClass('m-058__fold--active'),
				$entries = $fold.find(".m-058__fold-entries");

            if (isOpen) {
                if (animate) {
					TweenMax.set($entries, {height: "100vh"});
                    TweenMax.to($entries, 0.2, {
                        height: 0,
                        onComplete: function () {
							$fold.removeClass('m-058__fold--active');
						},
                        onCompleteParams: [$fold]
                    });
                } else {
                    $fold.removeClass('m-058__fold--active');
                }
            }
        },

        _closeAllFolds: function ($stayOpen) {
            this.$fold.each(_.bind(function (i, el) {
                var $fold = $(el);

                if (!$fold.is($stayOpen)) {
                    this._closeFold($fold);
                }
            }, this));
        },

// endregion

// region FOLD EVENTS
// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -

        _onFoldClick: function (event, data) {
            var $target = $(event.target),
                $currentTarget = $(event.currentTarget),
                $fold = $currentTarget.parents('.m-058__fold'),

                isEco = ($target.hasClass('b-eco__container') || $target.parents('.b-eco__container').length > 0),
                isOpen = $fold.hasClass('m-058__fold--active');

            if (!isEco) {
                event.preventDefault();

                if (isOpen) {
                    this._closeFold($fold, true);
                } else {
                    this._openFold($fold, true);
                }
            }
        },

        _onFoldEvent: function (event, data) {
            var $fold = this.$el.find('.m-058__fold[data-fold-id="' + data['foldID'] + '"]');

            if ($fold.length > 0) {
                switch (event.type) {
                    case window.M056_EVENTS.OPEN_FOLD:
                        this._openFold($fold, true);
                        break;
                    case window.M056_EVENTS.CLOSE_FOLD:
                        this._closeFold($fold, true);
                        break;
                    case window.M056_EVENTS.CLOSE_FOLD_ALL:
                        this._closeAllFolds($fold);
                        break;
                }
            }
        }

// endregion

    });
})(jQuery, this, this.document);
//var STRY = {
//    loaded: false
//};
//var script_tag = document.createElement('script');
//script_tag.setAttribute("type", "text/javascript");
////script_tag.setAttribute("src", "../../../scripts/vendor/storystream/csapi-min.js?112233");
//script_tag.setAttribute("src", "/redesign-scripts/vendor/storystream/csapi-min.js?112233");
//if (script_tag.readyState)
//{
//    script_tag.onreadystatechange = function ()
//    { // For old versions of IE
//        if (this.readyState == 'complete' || this.readyState == 'loaded')
//        {
//            scriptLoadHandler();
//        }
//    };
//} else
//{ // Other browsers
//    script_tag.onload = scriptLoadHandler;
//}
//
//(document.getElementsByTagName("head")[0] || document.documentElement).appendChild(script_tag);

//function scriptLoadHandler()
//{
//    STRY.loaded = true;
//    if (STRY.onSTRYReady)
//    {
//        STRY.onSTRYReady();
//    }
//    //else if (onSTRYReady)
//    //{
//    //    onSTRYReady();
//    //}
//}

/*
	Author: Andy Taylor andy.taylor@storystream.it
	Description: Front end interface to the StoryStream client side API
*/

(function(STRY, $) {
	'use strict';

	STRY.Interface = function Interface(el, options) {
		if (!(this instanceof(Interface))) {
			return new Interface(el, options || {});
		}

		if (!el) {
			el = 'body';
		}

		// have to add prototype so we can use this type for string splitting
		var Stack = function () {
		    this.items = [];
		};

		// truncate function and Stack prototype taken from http://jsperf.com/html-truncate-by-javascript/2
		Stack.prototype = {
		    size: function () {
		        return this.items.length;
		    },

		    push: function (key) {
		        this.items.push(key);
		    },

		    pop: function () {
		        return this.items.pop();
		    },
		    
		    /**
		     * dump all close tags and append to truncated content while reaching upperbound
		     */
		    dumpCloseTag: function () {
		        var html = '',
		            i, len, tag;

		        for(i = 0, len = this.size(); i < len; ++i) {
		            tag = this.pop();
		            html += '</' + tag.tag + '>';
		        }
		        
		        return html;
		    }
		};

		var that = {};
		var stack = new Stack();

		that.version = '0.0.1';
		that.className = 'Interface';
		that.paneObjects = [];
		that.el = _getElement(el);
		that.itemRenderer = null;

		var _options = ((typeof(el) === 'string') || typeof(el.nodeName) === 'string') ? options : el;
		var _wrapperObj = null;
		var _items = null;
		var _numOfCols = 1; // will be recalculated in _setGrid() based on window size
		var _numOfPanels = 3; // change depending on desired layout

		that.init = function() {

			// create a containing div
			_wrapperObj = $('<div class="stry-storywidget"></div>').appendTo(that.el);

			//  New item renderer
			that.itemRenderer = new STRY.ItemRenderer({
				templateUrl: _options.templateUrl
			});
			that.itemRenderer.init();

			_setGrid();
			_createDomStructure();
			//_setUpPopup();

		};

		/*
		This function gets called both at initialisation and when new data has been polled.
		This means it has to handle setting up a whole new list as well as adding a 
			random amount of new items to the grid.
		*/
		that.addData = function(data) {

			// make sure the data is valid
			
			if (!data || typeof data === 'undefined') {
				STRY.log("Provided wrapper DOM element not valid", true);
				return;
			}

			var _dataObj = data;

			if(!_dataObj || !_dataObj.length) {
				STRY.log("No content items to manipulate", true);
				return;
			}

			// populate the lists with the correct number of items
			var _numOfLists = _numOfCols * _numOfPanels;
			var _count = 0;
			var _j = 0;
			var _listObject;

			do {
				var _indexVal = _count;

				/* 
				if we have fewer new items than lists, make sure each new item doesn't 
					just end up attached to the first list item.
				so we have to randomise if we have under a certain amount of items.
				*/
				if (_dataObj.length < _numOfLists) {
					_indexVal = Math.floor(Math.random()*_numOfLists);
				}

				// create an <li> item that will contain the new data item.
				_listObject = $('<li></li>').appendTo(_wrapperObj.find('.viewport:eq('+_indexVal+') ul'));

				// format the time
				_dataObj[_j].created_date = _dataObj[_j].created_date.split('T')[0];
				
				// format the text
				if (_dataObj[_j].body) {
					_dataObj[_j].body = _truncate(_dataObj[_j].body, 100, false) + '&hellip;';
				} 
				if (_dataObj[_j].snippet) {
					_dataObj[_j].snippet = _truncate(_dataObj[_j].snippet, 100, false) + '&hellip;';
				}

				// render the item, once rendered call the callback function '_appendItem'
				that.itemRenderer.render(_dataObj[_j], {listObject: _listObject}, _appendItem);

				_j++;
				_count++;
				// when loading new data at the start -
				// if we have more items than one per list, start adding them at the start
				if(_count == _numOfLists) {
					_count = 0;
				}
			} while (_j<_dataObj.length);

			// now configure the styles (width and padding) based on the length of the <ul>
			_calculateStyle(_wrapperObj.find('.column:nth-child(odd) .viewport:first-child ul, .column:nth-child(even) .viewport:last-child ul'));
			
			// and finally kick off the animations
			_setUpAnimations();
		};

		return that;

		// Function to calculate the layout of the page based on the window width
		function _setGrid() {

			// how wide is the page, set up the grid appropriately
			var _windowWidth = parseInt($(window).width());

			if(_windowWidth > 567) {
				_numOfCols = 2;
			}
			if(_windowWidth > 767) {
				_numOfCols = 3;
			}

		}

		// Make sure we have the desired number of columns and <ul>s for our data to sit in
		function _createDomStructure() {

			// create the correct amount of lists
			var numOfLists = _numOfCols * _numOfPanels;

			var i = 0;
			do {
				$('<div class="viewport"><ul class="grid-pane"></ul></div>').appendTo(_wrapperObj);
				i++;
			} while (i < numOfLists);

			// now put in the correct number of columns
			var k = 0;
			var lists = _wrapperObj.find('.viewport');
			do {
				var _colObj = $('<div class="column"></div>').appendTo(_wrapperObj);
				_colObj.css('width', (100 / _numOfCols)+'%');

				// append the selected items to the created column
				_colObj.append(lists.splice(0, _numOfPanels));
				k++;
			} while (k < _numOfCols);


		}

		// The callback function used after the item has been rendered
		function _appendItem(item, params) {
            // mantis task 29486 --> deeplink for each tile ++++***********************************************//
            // get social media wall base url
            var currentURL = ($('.m-31-btn-bar').find('.gui-link-with-article').attr('href')),
                // slice part of url
                newURL = currentURL.slice(0, currentURL.indexOf('?', 0));
            // append id of each post to url
            $(item).find('a.deeplink').attr('href', newURL + '?lid=' + item.attributes['data-content-item'].nodeValue);
            // end ********************************************************************************************//
			$(item).appendTo(params.listObject);
			return $(item);
		}

		// for items that go left/right we need to work out the correct width of the elements based on the number of elements that exist
		function _calculateStyle(largeList) {

			largeList.each(function() {

				// 100 x num items for the list itself.
				var lengthOfList = $(this).find('li').length;
				$(this).css('width', (lengthOfList * 100) + '%');

				// 100 / num items for the lists items
				$(this).find('li').each(function() {
					$(this).css('max-width', (100 / lengthOfList) + '%');
				});
				
			});

		}

		// foreach pane, create an animatable object we can control
		function _setUpAnimations() {
			// if we don't have any paneObjects then create all of them
			if (!that.paneObjects.length) {
				_wrapperObj.find('.grid-pane').each(function(i) {
					var _paneObj = new STRY.GridPane($(this), _wrapperObj);
					that.paneObjects[i] = _paneObj;
				});
			} 
			// if we are adding new data from polling, we only want to restart the animations
			else {
				var a = 0;
				do {
					that.paneObjects[a].startAnimation();
					a++;
				} while (a < that.paneObjects.length);
			}
		}

		function _setUpPopup() {
			$('<div class="popover-container"><div class="popover-backdrop"></div><div class="popover-wrapper"><div class="popover video-container"></div><span class="icon close">A</span></div></div>').appendTo(_wrapperObj);

			// handle popover click
			_wrapperObj.bind('click', function(e) {
				_closePopup(e);
			});
		}

		function _closePopup(e) {

			var _videoContainer = _wrapperObj.find('.video-container');
			// IE9 will keep playing the iframe and throw errors unless we change the src before we remove the element
			_videoContainer.find('iframe').attr('src', 'about:blank');
			_videoContainer.html('');
	
			_wrapperObj.removeClass('popover');
			
		}

		function _getElement(arg) {
			// by default, append it to the body
			var elem = 'body';
			if (arg && typeof(arg) === 'object' && arg.nodeName) {
				elem = arg;
			}
			else if (arg && typeof(arg) === 'string') {
				elem = $(arg);
				if(!elem.length) {
					STRY.log("Provided wrapper DOM element not valid, appending to <body>", true);
				}
			}
			return elem;
		}

		function _truncate(string, maxLength, options) {
		    var content = '',       // traced text
		        total = 0,          // record how many characters we traced so far
		        matches = true,
		        result, index, tag, tail;

		    while(matches) {
		        matches = /<\/?\w+(\s+\w+="[^"]*")*>/g.exec(string);
		        if ( ! matches) { break; }
		        result = matches[0];
		        index = matches.index;

		        // overceed, dump everything to clear stack
		        if (total + index > maxLength) {
		            content += string.substring(0, maxLength - total);
		            content += stack.dumpCloseTag();
		            
		            break;
		        } else {
		            total += index;
		            content += string.substring(0, index);
		        }

		        if (-1 === result.indexOf('</')) {
		            tail = result.indexOf(' ');
		            tail = (-1 === tail) ? result.indexOf('>') : tail;
		            stack.push({
		                tag: result.substring(1, tail),
		                html: result
		            });
		        } else {
		            stack.pop();
		        }

		        content += result;

		        string = string.substring(index + result.length);
		    }

		   	// if no HMTL tags have been found we need to truncate it anyway
		    if (content === '') {
		    	content = string.substring(0, maxLength);
		    }

		    return content;
		}

	};

}(this.STRY = this.STRY || {}, jQuery));
/*
	Author: Andy Taylor andy.taylor@storystream.it
	Description: A class to handle each individual item pane in the grid
*/

(function(STRY, $) {
	'use strict';

	STRY.GridPane = function GridPane(element, wrapper) {
		if (!(this instanceof(GridPane))) {
			return new GridPane(element, wrapper || {});
		}

		var that = {};
		that.reverse = false;
		that.currentItem = 0;
		that.nextItem = 1;
		that.direction = 'top';
		that.el = element;
		that.intervalID = null;

		that.init = function() {

			// calculate the correct direction to use
			_calculateDirection(that.el);

			// start the interval to trigger the animations
			this.startAnimation();

			// toggle a class on the element if it is hovered.
			that.el.hover(function() {
				$(this).toggleClass('hovered');
			});

			that.el.click(function(e) {
			
				e.stopPropagation();
				
				if (!$(e.target).is('a')) {
					_triggerPopup();
				}
			});

		};

		that.startAnimation = function() {
			
	    	// we don't want to animate anything if there is nothing to animate to
	    	var child_count = (that.el.find('li').length) - 1;
	    	if (child_count !== 0) {

	    		// clear the interval if we have one so that two intervals don't get set on one pane
	    		if (that.intervalID) {
	    			window.clearInterval(that.intervalID);
	    		}

	    		// run the interval with random delay and interval amount
	    		that.timeoutID = setTimeout(function() {
	    			_runTheGrid(that.el, child_count);
					that.intervalID = setInterval(function() {
						_runTheGrid(that.el, child_count);
					}, _randomInterval());
				}, _randomDelay());

	    	}
		};

		that.init();

		return that;

		// run the grid function
		function _runTheGrid(list, child_count) {
			// don't run the animation if the element is hovered
	    	if (list.hasClass('hovered') || wrapper.hasClass('popover')) {
	    		return;
	    	}

	    	// update the currentitem var with what is next. 
	    	that.currentItem = that.nextItem;

			// run the animation. transforms work better than transitioning left/right positions
			if (Modernizr.csstransitions) {
				var _translateString = '';

				// transform using percentage value
				if(list.attr('direction') == 'left') {
					_translateString = 'translate('+(0 - (100 / (child_count + 1)) * that.currentItem) + '%,' + ' 0)';
				}
				if(list.attr('direction') == 'top') {
					_translateString = 'translate(0, '+(0 - (100) * that.currentItem) + '%';
				}
				
				list.css('-webkit-transform', _translateString);
				list.css('-ms-transform', _translateString);
				list.css('transform', _translateString);
				
			} else {
				// ie9 and below handling
				var animateParams = {};
				animateParams[list.attr('direction')] = (0 - (100) * that.currentItem) + '%';
				list.animate(animateParams, 1000);
			}
			

			// if we've reached the end then reverse the animation
			if (child_count == that.currentItem) {
				that.reverse = true;
			}

			// and if we've reached the beginning then normalise the animation
			if (that.currentItem === 0) {
				that.reverse = false;
			}

			// work out if we are adding or subtracting to list to determine which element we want to show
			that.nextItem = (that.reverse) ? that.currentItem - 1 : that.currentItem + 1;
		}

		function _triggerPopup() {

			// current item in view on clicked pane
			var _visibleItem = that.el.find('li:eq('+that.currentItem+') .list-item');
			// get the popover container
			var _videoContainer = wrapper.find('.video-container');

			if(_visibleItem.hasClass('media')) {
				// get the iframe
				var _videoPH = _visibleItem.find('.video-ph');

				// handle video popover
				if(_videoPH.length) {

					// add the iframe to the popover container
					_videoContainer.html(_videoPH.html());

					// if we need to swap the src then do so
					var _video = _videoContainer.find('iframe');
					if(_video.attr('data-videoUrl')) {
						_video.attr('src', _video.attr('data-videoUrl'));
					}

				} 
				// handle image popover
				else {
					var _bgImage = _visibleItem.find('.front').attr('data-img');
					_videoContainer.html('<img class="popover-image" src="'+_bgImage+'" alt="" />');
				}

				// this will trigger the popover styles and pause any animation
				wrapper.addClass('popover');

			}

		}

		// randomise the interval
		function _randomInterval() {
			return _randomNumber(10000, 15000);
		}

		// randomise the delay
		function _randomDelay() {
			return _randomNumber(1000, 10000);
		}

		function _randomNumber(min, max) {
    		return Math.floor(Math.random()*(max-min+1)+min);
		}

		// calculate direction function
		function _calculateDirection(element) {
			// if we've got a wide element we have to move it left
			if(element.width() > $('.stry-storywidget .column').width()) {
				that.direction = 'left';
			}
			// have to assign it as a data attr so that css styles can be picked up
			element.attr('direction', that.direction);
		}
	};


}(this.STRY = this.STRY || {}, jQuery));;
(function ($, window, document, STRY, undefined) {
    'use strict';

    var STRY_READY = false,
        DOC_READY = false,
        debug = false;

    if (typeof (STRY) === 'undefined')
    {
        return;
    }

    $(document).ready(function () {
        DOC_READY = true;

        if(GLOBAL_CONFIG && GLOBAL_CONFIG.pool == 'uk') {
            _removeModule();
            return false;
        }

        _lazyInit();
    });

    function _removeModule() {
        $('.m-31-social-media-widget').each(function (i, el) {
            var $el = $(el);
            var $lazyParent = $el.parents('.b-standard-module')[0];
            $lazyParent.remove();
        });
    }

    function _lazyInit()
    {
        var $el = _getFirstRootElementOnPage();

        if($el.length > 0)
        {
            $el.data('lazyloadready', false);

            // THERE IS NO REAL ENCLOSURE FOR THIS MODULE
            // ALL MODULES HAVE THE SAME DATA AND ARE INITIALIZED AT ONCE
            // IT IS RISKY TO HAVE 2 OF THIS MODULE ON ONE PAGE
            // see global id StryAdUnit
            if (window.pageController)
            {
                $el.one(window.pageController.eventNames.lazyInit, function () {
                    $el.data('lazyloadready', true);
                    _init($el);
                });
            }
            else
            {
                $el.data('lazyloadready', true);
                _init($el);
            }
        }
    }

    function _init($el)
    {
        var widget,
            frontInterface;

        if (
            STRY_READY === true
            && $el && $el.length === 1
            && $el.data('lazyloadready') === true
        )
        {
            $('head').append($('<style>@font-face { font-family: "storystream"; src: url(\'/fonts/storystream/storystream.eot\'); src: url(\'/fonts/storystream/storystream.eot?#iefix\') format(\'embedded-opentype\'), url(\'/fonts/storystream/storystream.woff\') format(\'woff\'), url(\'/fonts/storystream/storystream.ttf\') format(\'truetype\'), url(\'/fonts/storystream/storystream.svg#storystream\') format(\'svg\'); font-weight: normal; font-style: normal; } </style>'));

            STRY.debug = debug;

            frontInterface = new STRY.Interface('.stry-widget-grid', {
                //templateUrl: 'item-templates/porsche-item.html'
                //[BL] 23.01.2017 Mission Report highlighting of posts with Category: 'highlight'
                templateUrl: '<div class="list-item {{=it.categories}} {{=it.feed_class}}{{? it.videos && it.videos.length || it.images && it.images.length}} media{{?}}"> {{? it.images && it.images.length }} <a class="deeplink" href="#"/> <div class="flipper"> <div class="front" data-img="{{? it.images && it.images.length }}{{=it.images[0].two_up || it.images[0].original || it.images[0].external_url}}{{?}}" style="{{? it.images && it.images.length }}background-image: url(\'{{=it.images[0].two_up || it.images[0].original || it.images[0].external_url}}\');{{?}}"> {{? it.videos && it.videos.length }} <span class="icon play">5</span> <div class="video-ph"> {{? it.videos[0].embedded }} {{=it.videos[0].embedded}} {{?? it.videos[0].url }} <iframe width="560" height="315" src="about:blank" data-videoUrl="{{= it.videos[0].url }}?autoplay=1" frameborder="0" allowfullscreen></iframe> {{?}} </div> {{?}} <span class="icon {{=it.feed_class}}"></span></div> <div class="back"> <div class="stry-source"> {{? it.avatar_url }}<img class="stry-avatar" src="{{=it.avatar_url}}" alt=""/>{{?}} <div class="stry-detail"><h3>{{=it.author}}</h3> <p>{{=it.created_date}}</p></div> <div class="stry-social-icon"></div> </div> <div class="stry-text"> {{? it.title && it.feed_class != "twitter" && it.feed_class != "instagram" }}<!--<p class="stry-title">{{=it.title}}</p>-->{{?}} {{? it.feed_class === "twitter" && it.body }} <div class="stry-snippet">{{=it.body}}</div> {{?? it.snippet }} <div class="stry-snippet">{{=it.snippet}}</div> {{?}} </div> <span class="icon {{=it.feed_class}}"></span></div> </div> {{??}} <div class="back text-only"> <div class="stry-source"> {{? it.avatar_url }}<img class="stry-avatar" src="{{=it.avatar_url}}" alt=""/>{{?}} <div class="stry-detail"><h3>{{=it.author}}</h3> <p>{{=it.created_date}}</p></div> <div class="stry-social-icon"></div> </div> <div class="stry-text"> {{? it.title && it.feed_class != "twitter" && it.feed_class != "instagram" }} <h2 class="stry-title">{{=it.title}}</h2>{{?}} {{? it.feed_class === "twitter" && it.body }} <div class="stry-snippet">{{=it.body}}</div> {{?? it.snippet }} <div class="stry-snippet">{{=it.snippet}}</div> {{?}} </div> <span class="icon {{=it.feed_class}}"></span></div> {{?}} </div>'
            });
            frontInterface.init();

            widget = new STRY.Widget({
                limit: m31itemsPerPage,
                story: {
                    // european porsche china story: https://admin.storystream.it/porschechina/
                    name: m31storyId,
                    environment: m31environmentURL,
                    token: m31accessToken
                },
                layout: 'grid',
                polling: false,
                init: true,
                events: {
                    'onLoadingComplete': function (e) {
                        //console.log('onLoadingComplete', e);
                        frontInterface.addData(e.data);
                        frontInterface.el.addClass('loaded');
                    },
                    'onPollingComplete': function (e) {
                        //console.log('onPollingComplete', e);
                    }
                }
            });

            window.pageController && window.pageController.refresh();
        }
    }

    function _getFirstRootElementOnPage()
    {
        var $innerEl,
            $outerEl;

        if (DOC_READY)
        {
            $innerEl = $('.m-31-social-media-widget');
            if ($innerEl.length > 0)
            {
                $outerEl = $innerEl.parents('.b-standard-module');
                if ($outerEl.length > 0)
                {
                    return $outerEl;
                }
            }
            return $innerEl;
        }
    }

    STRY.onSTRYReady = _.bind(function () {
        STRY_READY = true;
        _init(_getFirstRootElementOnPage());
    }, this);

})(jQuery, this, this.document, this.STRY);/*!
 * Isotope PACKAGED v3.0.1
 *
 * Licensed GPLv3 for open source use
 * or Isotope Commercial License for commercial use
 *
 * http://isotope.metafizzy.co
 * Copyright 2016 Metafizzy
 */

/**
 * Bridget makes jQuery widgets
 * v2.0.0
 * MIT license
 */

/* jshint browser: true, strict: true, undef: true, unused: true */

( function( window, factory ) {
    'use strict';
    /* globals define: false, module: false, require: false */

    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'jquery-bridget/jquery-bridget',[ 'jquery' ], function( jQuery ) {
            factory( window, jQuery );
        });
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory(
            window,
            require('jquery')
        );
    } else {
        // browser global
        window.jQueryBridget = factory(
            window,
            window.jQuery
        );
    }

}( window, function factory( window, jQuery ) {
    'use strict';

// ----- utils ----- //

    var arraySlice = Array.prototype.slice;

// helper function for logging errors
// $.error breaks jQuery chaining
    var console = window.console;
    var logError = typeof console == 'undefined' ? function() {} :
        function( message ) {
            console.error( message );
        };

// ----- jQueryBridget ----- //

    function jQueryBridget( namespace, PluginClass, $ ) {
        $ = $ || jQuery || window.jQuery;
        if ( !$ ) {
            return;
        }

        // add option method -> $().plugin('option', {...})
        if ( !PluginClass.prototype.option ) {
            // option setter
            PluginClass.prototype.option = function( opts ) {
                // bail out if not an object
                if ( !$.isPlainObject( opts ) ){
                    return;
                }
                this.options = $.extend( true, this.options, opts );
            };
        }

        // make jQuery plugin
        $.fn[ namespace ] = function( arg0 /*, arg1 */ ) {
            if ( typeof arg0 == 'string' ) {
                // method call $().plugin( 'methodName', { options } )
                // shift arguments by 1
                var args = arraySlice.call( arguments, 1 );
                return methodCall( this, arg0, args );
            }
            // just $().plugin({ options })
            plainCall( this, arg0 );
            return this;
        };

        // $().plugin('methodName')
        function methodCall( $elems, methodName, args ) {
            var returnValue;
            var pluginMethodStr = '$().' + namespace + '("' + methodName + '")';

            $elems.each( function( i, elem ) {
                // get instance
                var instance = $.data( elem, namespace );
                if ( !instance ) {
                    logError( namespace + ' not initialized. Cannot call methods, i.e. ' +
                        pluginMethodStr );
                    return;
                }

                var method = instance[ methodName ];
                if ( !method || methodName.charAt(0) == '_' ) {
                    logError( pluginMethodStr + ' is not a valid method' );
                    return;
                }

                // apply method, get return value
                var value = method.apply( instance, args );
                // set return value if value is returned, use only first value
                returnValue = returnValue === undefined ? value : returnValue;
            });

            return returnValue !== undefined ? returnValue : $elems;
        }

        function plainCall( $elems, options ) {
            $elems.each( function( i, elem ) {
                var instance = $.data( elem, namespace );
                if ( instance ) {
                    // set options & init
                    instance.option( options );
                    instance._init();
                } else {
                    // initialize new instance
                    instance = new PluginClass( elem, options );
                    $.data( elem, namespace, instance );
                }
            });
        }

        updateJQuery( $ );

    }

// ----- updateJQuery ----- //

// set $.bridget for v1 backwards compatibility
    function updateJQuery( $ ) {
        if ( !$ || ( $ && $.bridget ) ) {
            return;
        }
        $.bridget = jQueryBridget;
    }

    updateJQuery( jQuery || window.jQuery );

// -----  ----- //

    return jQueryBridget;

}));

/**
 * EvEmitter v1.0.3
 * Lil' event emitter
 * MIT License
 */

/* jshint unused: true, undef: true, strict: true */

( function( global, factory ) {
    // universal module definition
    /* jshint strict: false */ /* globals define, module, window */
    if ( typeof define == 'function' && define.amd ) {
        // AMD - RequireJS
        define( 'ev-emitter/ev-emitter',factory );
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS - Browserify, Webpack
        module.exports = factory();
    } else {
        // Browser globals
        global.EvEmitter = factory();
    }

}( typeof window != 'undefined' ? window : this, function() {



    function EvEmitter() {}

    var proto = EvEmitter.prototype;

    proto.on = function( eventName, listener ) {
        if ( !eventName || !listener ) {
            return;
        }
        // set events hash
        var events = this._events = this._events || {};
        // set listeners array
        var listeners = events[ eventName ] = events[ eventName ] || [];
        // only add once
        if ( listeners.indexOf( listener ) == -1 ) {
            listeners.push( listener );
        }

        return this;
    };

    proto.once = function( eventName, listener ) {
        if ( !eventName || !listener ) {
            return;
        }
        // add event
        this.on( eventName, listener );
        // set once flag
        // set onceEvents hash
        var onceEvents = this._onceEvents = this._onceEvents || {};
        // set onceListeners object
        var onceListeners = onceEvents[ eventName ] = onceEvents[ eventName ] || {};
        // set flag
        onceListeners[ listener ] = true;

        return this;
    };

    proto.off = function( eventName, listener ) {
        var listeners = this._events && this._events[ eventName ];
        if ( !listeners || !listeners.length ) {
            return;
        }
        var index = listeners.indexOf( listener );
        if ( index != -1 ) {
            listeners.splice( index, 1 );
        }

        return this;
    };

    proto.emitEvent = function( eventName, args ) {
        var listeners = this._events && this._events[ eventName ];
        if ( !listeners || !listeners.length ) {
            return;
        }
        var i = 0;
        var listener = listeners[i];
        args = args || [];
        // once stuff
        var onceListeners = this._onceEvents && this._onceEvents[ eventName ];

        while ( listener ) {
            var isOnce = onceListeners && onceListeners[ listener ];
            if ( isOnce ) {
                // remove listener
                // remove before trigger to prevent recursion
                this.off( eventName, listener );
                // unset once flag
                delete onceListeners[ listener ];
            }
            // trigger listener
            listener.apply( this, args );
            // get next listener
            i += isOnce ? 0 : 1;
            listener = listeners[i];
        }

        return this;
    };

    return EvEmitter;

}));

/*!
 * getSize v2.0.2
 * measure size of elements
 * MIT license
 */

/*jshint browser: true, strict: true, undef: true, unused: true */
/*global define: false, module: false, console: false */

( function( window, factory ) {
    'use strict';

    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'get-size/get-size',[],function() {
            return factory();
        });
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory();
    } else {
        // browser global
        window.getSize = factory();
    }

})( window, function factory() {
    'use strict';

// -------------------------- helpers -------------------------- //

// get a number from a string, not a percentage
    function getStyleSize( value ) {
        var num = parseFloat( value );
        // not a percent like '100%', and a number
        var isValid = value.indexOf('%') == -1 && !isNaN( num );
        return isValid && num;
    }

    function noop() {}

    var logError = typeof console == 'undefined' ? noop :
        function( message ) {
            console.error( message );
        };

// -------------------------- measurements -------------------------- //

    var measurements = [
        'paddingLeft',
        'paddingRight',
        'paddingTop',
        'paddingBottom',
        'marginLeft',
        'marginRight',
        'marginTop',
        'marginBottom',
        'borderLeftWidth',
        'borderRightWidth',
        'borderTopWidth',
        'borderBottomWidth'
    ];

    var measurementsLength = measurements.length;

    function getZeroSize() {
        var size = {
            width: 0,
            height: 0,
            innerWidth: 0,
            innerHeight: 0,
            outerWidth: 0,
            outerHeight: 0
        };
        for ( var i=0; i < measurementsLength; i++ ) {
            var measurement = measurements[i];
            size[ measurement ] = 0;
        }
        return size;
    }

// -------------------------- getStyle -------------------------- //

    /**
     * getStyle, get style of element, check for Firefox bug
     * https://bugzilla.mozilla.org/show_bug.cgi?id=548397
     */
    function getStyle( elem ) {
        var style = getComputedStyle( elem );
        if ( !style ) {
            logError( 'Style returned ' + style +
                '. Are you running this code in a hidden iframe on Firefox? ' +
                'See http://bit.ly/getsizebug1' );
        }
        return style;
    }

// -------------------------- setup -------------------------- //

    var isSetup = false;

    var isBoxSizeOuter;

    /**
     * setup
     * check isBoxSizerOuter
     * do on first getSize() rather than on page load for Firefox bug
     */
    function setup() {
        // setup once
        if ( isSetup ) {
            return;
        }
        isSetup = true;

        // -------------------------- box sizing -------------------------- //

        /**
         * WebKit measures the outer-width on style.width on border-box elems
         * IE & Firefox<29 measures the inner-width
         */
        var div = document.createElement('div');
        div.style.width = '200px';
        div.style.padding = '1px 2px 3px 4px';
        div.style.borderStyle = 'solid';
        div.style.borderWidth = '1px 2px 3px 4px';
        div.style.boxSizing = 'border-box';

        var body = document.body || document.documentElement;
        body.appendChild( div );
        var style = getStyle( div );

        getSize.isBoxSizeOuter = isBoxSizeOuter = getStyleSize( style.width ) == 200;
        body.removeChild( div );

    }

// -------------------------- getSize -------------------------- //

    function getSize( elem ) {
        setup();

        // use querySeletor if elem is string
        if ( typeof elem == 'string' ) {
            elem = document.querySelector( elem );
        }

        // do not proceed on non-objects
        if ( !elem || typeof elem != 'object' || !elem.nodeType ) {
            return;
        }

        var style = getStyle( elem );

        // if hidden, everything is 0
        if ( style.display == 'none' ) {
            return getZeroSize();
        }

        var size = {};
        size.width = elem.offsetWidth;
        size.height = elem.offsetHeight;

        var isBorderBox = size.isBorderBox = style.boxSizing == 'border-box';

        // get all measurements
        for ( var i=0; i < measurementsLength; i++ ) {
            var measurement = measurements[i];
            var value = style[ measurement ];
            var num = parseFloat( value );
            // any 'auto', 'medium' value will be 0
            size[ measurement ] = !isNaN( num ) ? num : 0;
        }

        var paddingWidth = size.paddingLeft + size.paddingRight;
        var paddingHeight = size.paddingTop + size.paddingBottom;
        var marginWidth = size.marginLeft + size.marginRight;
        var marginHeight = size.marginTop + size.marginBottom;
        var borderWidth = size.borderLeftWidth + size.borderRightWidth;
        var borderHeight = size.borderTopWidth + size.borderBottomWidth;

        var isBorderBoxSizeOuter = isBorderBox && isBoxSizeOuter;

        // overwrite width and height if we can get it from style
        var styleWidth = getStyleSize( style.width );
        if ( styleWidth !== false ) {
            size.width = styleWidth +
                    // add padding and border unless it's already including it
                ( isBorderBoxSizeOuter ? 0 : paddingWidth + borderWidth );
        }

        var styleHeight = getStyleSize( style.height );
        if ( styleHeight !== false ) {
            size.height = styleHeight +
                    // add padding and border unless it's already including it
                ( isBorderBoxSizeOuter ? 0 : paddingHeight + borderHeight );
        }

        size.innerWidth = size.width - ( paddingWidth + borderWidth );
        size.innerHeight = size.height - ( paddingHeight + borderHeight );

        size.outerWidth = size.width + marginWidth;
        size.outerHeight = size.height + marginHeight;

        return size;
    }

    return getSize;

});

/**
 * matchesSelector v2.0.1
 * matchesSelector( element, '.selector' )
 * MIT license
 */

/*jshint browser: true, strict: true, undef: true, unused: true */

( function( window, factory ) {
    /*global define: false, module: false */
    'use strict';
    // universal module definition
    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'desandro-matches-selector/matches-selector',factory );
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory();
    } else {
        // browser global
        window.matchesSelector = factory();
    }

}( window, function factory() {
    'use strict';

    var matchesMethod = ( function() {
        var ElemProto = Element.prototype;
        // check for the standard method name first
        if ( ElemProto.matches ) {
            return 'matches';
        }
        // check un-prefixed
        if ( ElemProto.matchesSelector ) {
            return 'matchesSelector';
        }
        // check vendor prefixes
        var prefixes = [ 'webkit', 'moz', 'ms', 'o' ];

        for ( var i=0; i < prefixes.length; i++ ) {
            var prefix = prefixes[i];
            var method = prefix + 'MatchesSelector';
            if ( ElemProto[ method ] ) {
                return method;
            }
        }
    })();

    return function matchesSelector( elem, selector ) {
        return elem[ matchesMethod ]( selector );
    };

}));

/**
 * Fizzy UI utils v2.0.2
 * MIT license
 */

/*jshint browser: true, undef: true, unused: true, strict: true */

( function( window, factory ) {
    // universal module definition
    /*jshint strict: false */ /*globals define, module, require */

    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'fizzy-ui-utils/utils',[
            'desandro-matches-selector/matches-selector'
        ], function( matchesSelector ) {
            return factory( window, matchesSelector );
        });
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory(
            window,
            require('desandro-matches-selector')
        );
    } else {
        // browser global
        window.fizzyUIUtils = factory(
            window,
            window.matchesSelector
        );
    }

}( window, function factory( window, matchesSelector ) {



    var utils = {};

// ----- extend ----- //

// extends objects
    utils.extend = function( a, b ) {
        for ( var prop in b ) {
            a[ prop ] = b[ prop ];
        }
        return a;
    };

// ----- modulo ----- //

    utils.modulo = function( num, div ) {
        return ( ( num % div ) + div ) % div;
    };

// ----- makeArray ----- //

// turn element or nodeList into an array
    utils.makeArray = function( obj ) {
        var ary = [];
        if ( Array.isArray( obj ) ) {
            // use object if already an array
            ary = obj;
        } else if ( obj && typeof obj.length == 'number' ) {
            // convert nodeList to array
            for ( var i=0; i < obj.length; i++ ) {
                ary.push( obj[i] );
            }
        } else {
            // array of single index
            ary.push( obj );
        }
        return ary;
    };

// ----- removeFrom ----- //

    utils.removeFrom = function( ary, obj ) {
        var index = ary.indexOf( obj );
        if ( index != -1 ) {
            ary.splice( index, 1 );
        }
    };

// ----- getParent ----- //

    utils.getParent = function( elem, selector ) {
        while ( elem != document.body ) {
            elem = elem.parentNode;
            if ( matchesSelector( elem, selector ) ) {
                return elem;
            }
        }
    };

// ----- getQueryElement ----- //

// use element as selector string
    utils.getQueryElement = function( elem ) {
        if ( typeof elem == 'string' ) {
            return document.querySelector( elem );
        }
        return elem;
    };

// ----- handleEvent ----- //

// enable .ontype to trigger from .addEventListener( elem, 'type' )
    utils.handleEvent = function( event ) {
        var method = 'on' + event.type;
        if ( this[ method ] ) {
            this[ method ]( event );
        }
    };

// ----- filterFindElements ----- //

    utils.filterFindElements = function( elems, selector ) {
        // make array of elems
        elems = utils.makeArray( elems );
        var ffElems = [];

        elems.forEach( function( elem ) {
            // check that elem is an actual element
            if ( !( elem instanceof HTMLElement ) ) {
                return;
            }
            // add elem if no selector
            if ( !selector ) {
                ffElems.push( elem );
                return;
            }
            // filter & find items if we have a selector
            // filter
            if ( matchesSelector( elem, selector ) ) {
                ffElems.push( elem );
            }
            // find children
            var childElems = elem.querySelectorAll( selector );
            // concat childElems to filterFound array
            for ( var i=0; i < childElems.length; i++ ) {
                ffElems.push( childElems[i] );
            }
        });

        return ffElems;
    };

// ----- debounceMethod ----- //

    utils.debounceMethod = function( _class, methodName, threshold ) {
        // original method
        var method = _class.prototype[ methodName ];
        var timeoutName = methodName + 'Timeout';

        _class.prototype[ methodName ] = function() {
            var timeout = this[ timeoutName ];
            if ( timeout ) {
                clearTimeout( timeout );
            }
            var args = arguments;

            var _this = this;
            this[ timeoutName ] = setTimeout( function() {
                method.apply( _this, args );
                delete _this[ timeoutName ];
            }, threshold || 100 );
        };
    };

// ----- docReady ----- //

    utils.docReady = function( callback ) {
        var readyState = document.readyState;
        if ( readyState == 'complete' || readyState == 'interactive' ) {
            callback();
        } else {
            document.addEventListener( 'DOMContentLoaded', callback );
        }
    };

// ----- htmlInit ----- //

// http://jamesroberts.name/blog/2010/02/22/string-functions-for-javascript-trim-to-camel-case-to-dashed-and-to-underscore/
    utils.toDashed = function( str ) {
        return str.replace( /(.)([A-Z])/g, function( match, $1, $2 ) {
            return $1 + '-' + $2;
        }).toLowerCase();
    };

    var console = window.console;
    /**
     * allow user to initialize classes via [data-namespace] or .js-namespace class
     * htmlInit( Widget, 'widgetName' )
     * options are parsed from data-namespace-options
     */
    utils.htmlInit = function( WidgetClass, namespace ) {
        utils.docReady( function() {
            var dashedNamespace = utils.toDashed( namespace );
            var dataAttr = 'data-' + dashedNamespace;
            var dataAttrElems = document.querySelectorAll( '[' + dataAttr + ']' );
            var jsDashElems = document.querySelectorAll( '.js-' + dashedNamespace );
            var elems = utils.makeArray( dataAttrElems )
                .concat( utils.makeArray( jsDashElems ) );
            var dataOptionsAttr = dataAttr + '-options';
            var jQuery = window.jQuery;

            elems.forEach( function( elem ) {
                var attr = elem.getAttribute( dataAttr ) ||
                    elem.getAttribute( dataOptionsAttr );
                var options;
                try {
                    options = attr && JSON.parse( attr );
                } catch ( error ) {
                    // log error, do not initialize
                    if ( console ) {
                        console.error( 'Error parsing ' + dataAttr + ' on ' + elem.className +
                            ': ' + error );
                    }
                    return;
                }
                // initialize
                var instance = new WidgetClass( elem, options );
                // make available via $().data('layoutname')
                if ( jQuery ) {
                    jQuery.data( elem, namespace, instance );
                }
            });

        });
    };

// -----  ----- //

    return utils;

}));

/**
 * Outlayer Item
 */

( function( window, factory ) {
    // universal module definition
    /* jshint strict: false */ /* globals define, module, require */
    if ( typeof define == 'function' && define.amd ) {
        // AMD - RequireJS
        define( 'outlayer/item',[
                'ev-emitter/ev-emitter',
                'get-size/get-size'
            ],
            factory
        );
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS - Browserify, Webpack
        module.exports = factory(
            require('ev-emitter'),
            require('get-size')
        );
    } else {
        // browser global
        window.Outlayer = {};
        window.Outlayer.Item = factory(
            window.EvEmitter,
            window.getSize
        );
    }

}( window, function factory( EvEmitter, getSize ) {
    'use strict';

// ----- helpers ----- //

    function isEmptyObj( obj ) {
        for ( var prop in obj ) {
            return false;
        }
        prop = null;
        return true;
    }

// -------------------------- CSS3 support -------------------------- //


    var docElemStyle = document.documentElement.style;

    var transitionProperty = typeof docElemStyle.transition == 'string' ?
        'transition' : 'WebkitTransition';
    var transformProperty = typeof docElemStyle.transform == 'string' ?
        'transform' : 'WebkitTransform';

    var transitionEndEvent = {
        WebkitTransition: 'webkitTransitionEnd',
        transition: 'transitionend'
    }[ transitionProperty ];

// cache all vendor properties that could have vendor prefix
    var vendorProperties = {
        transform: transformProperty,
        transition: transitionProperty,
        transitionDuration: transitionProperty + 'Duration',
        transitionProperty: transitionProperty + 'Property',
        transitionDelay: transitionProperty + 'Delay'
    };

// -------------------------- Item -------------------------- //

    function Item( element, layout ) {
        if ( !element ) {
            return;
        }

        this.element = element;
        // parent layout class, i.e. Masonry, Isotope, or Packery
        this.layout = layout;
        this.position = {
            x: 0,
            y: 0
        };

        this._create();
    }

// inherit EvEmitter
    var proto = Item.prototype = Object.create( EvEmitter.prototype );
    proto.constructor = Item;

    proto._create = function() {
        // transition objects
        this._transn = {
            ingProperties: {},
            clean: {},
            onEnd: {}
        };

        this.css({
            position: 'absolute'
        });
    };

// trigger specified handler for event type
    proto.handleEvent = function( event ) {
        var method = 'on' + event.type;
        if ( this[ method ] ) {
            this[ method ]( event );
        }
    };

    proto.getSize = function() {
        this.size = getSize( this.element );
    };

    /**
     * apply CSS styles to element
     * @param {Object} style
     */
    proto.css = function( style ) {
        var elemStyle = this.element.style;

        for ( var prop in style ) {
            // use vendor property if available
            var supportedProp = vendorProperties[ prop ] || prop;
            elemStyle[ supportedProp ] = style[ prop ];
        }
    };

    // measure position, and sets it
    proto.getPosition = function() {
        var style = getComputedStyle( this.element );
        var isOriginLeft = this.layout._getOption('originLeft');
        var isOriginTop = this.layout._getOption('originTop');
        var xValue = style[ isOriginLeft ? 'left' : 'right' ];
        var yValue = style[ isOriginTop ? 'top' : 'bottom' ];
        // convert percent to pixels
        var layoutSize = this.layout.size;
        var x = xValue.indexOf('%') != -1 ?
        ( parseFloat( xValue ) / 100 ) * layoutSize.width : parseInt( xValue, 10 );
        var y = yValue.indexOf('%') != -1 ?
        ( parseFloat( yValue ) / 100 ) * layoutSize.height : parseInt( yValue, 10 );

        // clean up 'auto' or other non-integer values
        x = isNaN( x ) ? 0 : x;
        y = isNaN( y ) ? 0 : y;
        // remove padding from measurement
        x -= isOriginLeft ? layoutSize.paddingLeft : layoutSize.paddingRight;
        y -= isOriginTop ? layoutSize.paddingTop : layoutSize.paddingBottom;

        this.position.x = x;
        this.position.y = y;
    };

// set settled position, apply padding
    proto.layoutPosition = function() {
        var layoutSize = this.layout.size;
        var style = {};
        var isOriginLeft = this.layout._getOption('originLeft');
        var isOriginTop = this.layout._getOption('originTop');

        // x
        var xPadding = isOriginLeft ? 'paddingLeft' : 'paddingRight';
        var xProperty = isOriginLeft ? 'left' : 'right';
        var xResetProperty = isOriginLeft ? 'right' : 'left';

        var x = this.position.x + layoutSize[ xPadding ];
        // set in percentage or pixels
        style[ xProperty ] = this.getXValue( x );
        // reset other property
        style[ xResetProperty ] = '';

        // y
        var yPadding = isOriginTop ? 'paddingTop' : 'paddingBottom';
        var yProperty = isOriginTop ? 'top' : 'bottom';
        var yResetProperty = isOriginTop ? 'bottom' : 'top';

        var y = this.position.y + layoutSize[ yPadding ];
        // set in percentage or pixels
        style[ yProperty ] = this.getYValue( y );
        // reset other property
        style[ yResetProperty ] = '';

        this.css( style );
        this.emitEvent( 'layout', [ this ] );
    };

    proto.getXValue = function( x ) {
        var isHorizontal = this.layout._getOption('horizontal');
        return this.layout.options.percentPosition && !isHorizontal ?
        ( ( x / this.layout.size.width ) * 100 ) + '%' : x + 'px';
    };

    proto.getYValue = function( y ) {
        var isHorizontal = this.layout._getOption('horizontal');
        return this.layout.options.percentPosition && isHorizontal ?
        ( ( y / this.layout.size.height ) * 100 ) + '%' : y + 'px';
    };

    proto._transitionTo = function( x, y ) {
        this.getPosition();
        // get current x & y from top/left
        var curX = this.position.x;
        var curY = this.position.y;

        var compareX = parseInt( x, 10 );
        var compareY = parseInt( y, 10 );
        var didNotMove = compareX === this.position.x && compareY === this.position.y;

        // save end position
        this.setPosition( x, y );

        // if did not move and not transitioning, just go to layout
        if ( didNotMove && !this.isTransitioning ) {
            this.layoutPosition();
            return;
        }

        var transX = x - curX;
        var transY = y - curY;
        var transitionStyle = {};
        transitionStyle.transform = this.getTranslate( transX, transY );

        this.transition({
            to: transitionStyle,
            onTransitionEnd: {
                transform: this.layoutPosition
            },
            isCleaning: true
        });
    };

    proto.getTranslate = function( x, y ) {
        // flip cooridinates if origin on right or bottom
        var isOriginLeft = this.layout._getOption('originLeft');
        var isOriginTop = this.layout._getOption('originTop');
        x = isOriginLeft ? x : -x;
        y = isOriginTop ? y : -y;
        return 'translate3d(' + x + 'px, ' + y + 'px, 0)';
    };

// non transition + transform support
    proto.goTo = function( x, y ) {
        this.setPosition( x, y );
        this.layoutPosition();
    };

    proto.moveTo = proto._transitionTo;

    proto.setPosition = function( x, y ) {
        this.position.x = parseInt( x, 10 );
        this.position.y = parseInt( y, 10 );
    };

// ----- transition ----- //

    /**
     * @param {Object} style - CSS
     * @param {Function} onTransitionEnd
     */

// non transition, just trigger callback
    proto._nonTransition = function( args ) {
        this.css( args.to );
        if ( args.isCleaning ) {
            this._removeStyles( args.to );
        }
        for ( var prop in args.onTransitionEnd ) {
            args.onTransitionEnd[ prop ].call( this );
        }
    };

    /**
     * proper transition
     * @param {Object} args - arguments
     *   @param {Object} to - style to transition to
     *   @param {Object} from - style to start transition from
     *   @param {Boolean} isCleaning - removes transition styles after transition
     *   @param {Function} onTransitionEnd - callback
     */
    proto.transition = function( args ) {
        // redirect to nonTransition if no transition duration
        if ( !parseFloat( this.layout.options.transitionDuration ) ) {
            this._nonTransition( args );
            return;
        }

        var _transition = this._transn;
        // keep track of onTransitionEnd callback by css property
        for ( var prop in args.onTransitionEnd ) {
            _transition.onEnd[ prop ] = args.onTransitionEnd[ prop ];
        }
        // keep track of properties that are transitioning
        for ( prop in args.to ) {
            _transition.ingProperties[ prop ] = true;
            // keep track of properties to clean up when transition is done
            if ( args.isCleaning ) {
                _transition.clean[ prop ] = true;
            }
        }

        // set from styles
        if ( args.from ) {
            this.css( args.from );
            // force redraw. http://blog.alexmaccaw.com/css-transitions
            var h = this.element.offsetHeight;
            // hack for JSHint to hush about unused var
            h = null;
        }
        // enable transition
        this.enableTransition( args.to );
        // set styles that are transitioning
        this.css( args.to );

        this.isTransitioning = true;

    };

// dash before all cap letters, including first for
// WebkitTransform => -webkit-transform
    function toDashedAll( str ) {
        return str.replace( /([A-Z])/g, function( $1 ) {
            return '-' + $1.toLowerCase();
        });
    }

    var transitionProps = 'opacity,' + toDashedAll( transformProperty );

    proto.enableTransition = function(/* style */) {
        // HACK changing transitionProperty during a transition
        // will cause transition to jump
        if ( this.isTransitioning ) {
            return;
        }

        // make `transition: foo, bar, baz` from style object
        // HACK un-comment this when enableTransition can work
        // while a transition is happening
        // var transitionValues = [];
        // for ( var prop in style ) {
        //   // dash-ify camelCased properties like WebkitTransition
        //   prop = vendorProperties[ prop ] || prop;
        //   transitionValues.push( toDashedAll( prop ) );
        // }
        // munge number to millisecond, to match stagger
        var duration = this.layout.options.transitionDuration;
        duration = typeof duration == 'number' ? duration + 'ms' : duration;
        // enable transition styles
        this.css({
            transitionProperty: transitionProps,
            transitionDuration: duration,
            transitionDelay: this.staggerDelay || 0
        });
        // listen for transition end event
        this.element.addEventListener( transitionEndEvent, this, false );
    };

// ----- events ----- //

    proto.onwebkitTransitionEnd = function( event ) {
        this.ontransitionend( event );
    };

    proto.onotransitionend = function( event ) {
        this.ontransitionend( event );
    };

// properties that I munge to make my life easier
    var dashedVendorProperties = {
        '-webkit-transform': 'transform'
    };

    proto.ontransitionend = function( event ) {
        // disregard bubbled events from children
        if ( event.target !== this.element ) {
            return;
        }
        var _transition = this._transn;
        // get property name of transitioned property, convert to prefix-free
        var propertyName = dashedVendorProperties[ event.propertyName ] || event.propertyName;

        // remove property that has completed transitioning
        delete _transition.ingProperties[ propertyName ];
        // check if any properties are still transitioning
        if ( isEmptyObj( _transition.ingProperties ) ) {
            // all properties have completed transitioning
            this.disableTransition();
        }
        // clean style
        if ( propertyName in _transition.clean ) {
            // clean up style
            this.element.style[ event.propertyName ] = '';
            delete _transition.clean[ propertyName ];
        }
        // trigger onTransitionEnd callback
        if ( propertyName in _transition.onEnd ) {
            var onTransitionEnd = _transition.onEnd[ propertyName ];
            onTransitionEnd.call( this );
            delete _transition.onEnd[ propertyName ];
        }

        this.emitEvent( 'transitionEnd', [ this ] );
    };

    proto.disableTransition = function() {
        this.removeTransitionStyles();
        this.element.removeEventListener( transitionEndEvent, this, false );
        this.isTransitioning = false;
    };

    /**
     * removes style property from element
     * @param {Object} style
     **/
    proto._removeStyles = function( style ) {
        // clean up transition styles
        var cleanStyle = {};
        for ( var prop in style ) {
            cleanStyle[ prop ] = '';
        }
        this.css( cleanStyle );
    };

    var cleanTransitionStyle = {
        transitionProperty: '',
        transitionDuration: '',
        transitionDelay: ''
    };

    proto.removeTransitionStyles = function() {
        // remove transition
        this.css( cleanTransitionStyle );
    };

// ----- stagger ----- //

    proto.stagger = function( delay ) {
        delay = isNaN( delay ) ? 0 : delay;
        this.staggerDelay = delay + 'ms';
    };

// ----- show/hide/remove ----- //

// remove element from DOM
    proto.removeElem = function() {
        this.element.parentNode.removeChild( this.element );
        // remove display: none
        this.css({ display: '' });
        this.emitEvent( 'remove', [ this ] );
    };

    proto.remove = function() {
        // just remove element if no transition support or no transition
        if ( !transitionProperty || !parseFloat( this.layout.options.transitionDuration ) ) {
            this.removeElem();
            return;
        }

        // start transition
        this.once( 'transitionEnd', function() {
            this.removeElem();
        });
        this.hide();
    };

    proto.reveal = function() {
        delete this.isHidden;
        // remove display: none
        this.css({ display: '' });

        var options = this.layout.options;

        var onTransitionEnd = {};
        var transitionEndProperty = this.getHideRevealTransitionEndProperty('visibleStyle');
        onTransitionEnd[ transitionEndProperty ] = this.onRevealTransitionEnd;

        this.transition({
            from: options.hiddenStyle,
            to: options.visibleStyle,
            isCleaning: true,
            onTransitionEnd: onTransitionEnd
        });
    };

    proto.onRevealTransitionEnd = function() {
        // check if still visible
        // during transition, item may have been hidden
        if ( !this.isHidden ) {
            this.emitEvent('reveal');
        }
    };

    /**
     * get style property use for hide/reveal transition end
     * @param {String} styleProperty - hiddenStyle/visibleStyle
     * @returns {String}
     */
    proto.getHideRevealTransitionEndProperty = function( styleProperty ) {
        var optionStyle = this.layout.options[ styleProperty ];
        // use opacity
        if ( optionStyle.opacity ) {
            return 'opacity';
        }
        // get first property
        for ( var prop in optionStyle ) {
            return prop;
        }
    };

    proto.hide = function() {
        // set flag
        this.isHidden = true;
        // remove display: none
        this.css({ display: '' });

        var options = this.layout.options;

        var onTransitionEnd = {};
        var transitionEndProperty = this.getHideRevealTransitionEndProperty('hiddenStyle');
        onTransitionEnd[ transitionEndProperty ] = this.onHideTransitionEnd;

        this.transition({
            from: options.visibleStyle,
            to: options.hiddenStyle,
            // keep hidden stuff hidden
            isCleaning: true,
            onTransitionEnd: onTransitionEnd
        });
    };

    proto.onHideTransitionEnd = function() {
        // check if still hidden
        // during transition, item may have been un-hidden
        if ( this.isHidden ) {
            this.css({ display: 'none' });
            this.emitEvent('hide');
        }
    };

    proto.destroy = function() {
        this.css({
            position: '',
            left: '',
            right: '',
            top: '',
            bottom: '',
            transition: '',
            transform: ''
        });
    };

    return Item;

}));

/*!
 * Outlayer v2.1.0
 * the brains and guts of a layout library
 * MIT license
 */

( function( window, factory ) {
    'use strict';
    // universal module definition
    /* jshint strict: false */ /* globals define, module, require */
    if ( typeof define == 'function' && define.amd ) {
        // AMD - RequireJS
        define( 'outlayer/outlayer',[
                'ev-emitter/ev-emitter',
                'get-size/get-size',
                'fizzy-ui-utils/utils',
                './item'
            ],
            function( EvEmitter, getSize, utils, Item ) {
                return factory( window, EvEmitter, getSize, utils, Item);
            }
        );
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS - Browserify, Webpack
        module.exports = factory(
            window,
            require('ev-emitter'),
            require('get-size'),
            require('fizzy-ui-utils'),
            require('./item')
        );
    } else {
        // browser global
        window.Outlayer = factory(
            window,
            window.EvEmitter,
            window.getSize,
            window.fizzyUIUtils,
            window.Outlayer.Item
        );
    }

}( window, function factory( window, EvEmitter, getSize, utils, Item ) {
    'use strict';

// ----- vars ----- //

    var console = window.console;
    var jQuery = window.jQuery;
    var noop = function() {};

// -------------------------- Outlayer -------------------------- //

// globally unique identifiers
    var GUID = 0;
// internal store of all Outlayer intances
    var instances = {};


    /**
     * @param {Element, String} element
     * @param {Object} options
     * @constructor
     */
    function Outlayer( element, options ) {
        var queryElement = utils.getQueryElement( element );
        if ( !queryElement ) {
            if ( console ) {
                console.error( 'Bad element for ' + this.constructor.namespace +
                    ': ' + ( queryElement || element ) );
            }
            return;
        }
        this.element = queryElement;
        // add jQuery
        if ( jQuery ) {
            this.$element = jQuery( this.element );
        }

        // options
        this.options = utils.extend( {}, this.constructor.defaults );
        this.option( options );

        // add id for Outlayer.getFromElement
        var id = ++GUID;
        this.element.outlayerGUID = id; // expando
        instances[ id ] = this; // associate via id

        // kick it off
        this._create();

        var isInitLayout = this._getOption('initLayout');
        if ( isInitLayout ) {
            this.layout();
        }
    }

// settings are for internal use only
    Outlayer.namespace = 'outlayer';
    Outlayer.Item = Item;

// default options
    Outlayer.defaults = {
        containerStyle: {
            position: 'relative'
        },
        initLayout: true,
        originLeft: true,
        originTop: true,
        resize: true,
        resizeContainer: true,
        // item options
        transitionDuration: '0.4s',
        hiddenStyle: {
            opacity: 0,
            transform: 'scale(0.001)'
        },
        visibleStyle: {
            opacity: 1,
            transform: 'scale(1)'
        }
    };

    var proto = Outlayer.prototype;
// inherit EvEmitter
    utils.extend( proto, EvEmitter.prototype );

    /**
     * set options
     * @param {Object} opts
     */
    proto.option = function( opts ) {
        utils.extend( this.options, opts );
    };

    /**
     * get backwards compatible option value, check old name
     */
    proto._getOption = function( option ) {
        var oldOption = this.constructor.compatOptions[ option ];
        return oldOption && this.options[ oldOption ] !== undefined ?
            this.options[ oldOption ] : this.options[ option ];
    };

    Outlayer.compatOptions = {
        // currentName: oldName
        initLayout: 'isInitLayout',
        horizontal: 'isHorizontal',
        layoutInstant: 'isLayoutInstant',
        originLeft: 'isOriginLeft',
        originTop: 'isOriginTop',
        resize: 'isResizeBound',
        resizeContainer: 'isResizingContainer'
    };

    proto._create = function() {
        // get items from children
        this.reloadItems();
        // elements that affect layout, but are not laid out
        this.stamps = [];
        this.stamp( this.options.stamp );
        // set container style
        utils.extend( this.element.style, this.options.containerStyle );

        // bind resize method
        var canBindResize = this._getOption('resize');
        if ( canBindResize ) {
            this.bindResize();
        }
    };

// goes through all children again and gets bricks in proper order
    proto.reloadItems = function() {
        // collection of item elements
        this.items = this._itemize( this.element.children );
    };


    /**
     * turn elements into Outlayer.Items to be used in layout
     * @param {Array or NodeList or HTMLElement} elems
     * @returns {Array} items - collection of new Outlayer Items
     */
    proto._itemize = function( elems ) {

        var itemElems = this._filterFindItemElements( elems );
        var Item = this.constructor.Item;

        // create new Outlayer Items for collection
        var items = [];
        for ( var i=0; i < itemElems.length; i++ ) {
            var elem = itemElems[i];
            var item = new Item( elem, this );
            items.push( item );
        }

        return items;
    };

    /**
     * get item elements to be used in layout
     * @param {Array or NodeList or HTMLElement} elems
     * @returns {Array} items - item elements
     */
    proto._filterFindItemElements = function( elems ) {
        return utils.filterFindElements( elems, this.options.itemSelector );
    };

    /**
     * getter method for getting item elements
     * @returns {Array} elems - collection of item elements
     */
    proto.getItemElements = function() {
        return this.items.map( function( item ) {
            return item.element;
        });
    };

// ----- init & layout ----- //

    /**
     * lays out all items
     */
    proto.layout = function() {
        this._resetLayout();
        this._manageStamps();

        // don't animate first layout
        var layoutInstant = this._getOption('layoutInstant');
        var isInstant = layoutInstant !== undefined ?
            layoutInstant : !this._isLayoutInited;
        this.layoutItems( this.items, isInstant );

        // flag for initalized
        this._isLayoutInited = true;
    };

// _init is alias for layout
    proto._init = proto.layout;

    /**
     * logic before any new layout
     */
    proto._resetLayout = function() {
        this.getSize();
    };


    proto.getSize = function() {
        this.size = getSize( this.element );
    };

    /**
     * get measurement from option, for columnWidth, rowHeight, gutter
     * if option is String -> get element from selector string, & get size of element
     * if option is Element -> get size of element
     * else use option as a number
     *
     * @param {String} measurement
     * @param {String} size - width or height
     * @private
     */
    proto._getMeasurement = function( measurement, size ) {
        var option = this.options[ measurement ];
        var elem;
        if ( !option ) {
            // default to 0
            this[ measurement ] = 0;
        } else {
            // use option as an element
            if ( typeof option == 'string' ) {
                elem = this.element.querySelector( option );
            } else if ( option instanceof HTMLElement ) {
                elem = option;
            }
            // use size of element, if element
            this[ measurement ] = elem ? getSize( elem )[ size ] : option;
        }
    };

    /**
     * layout a collection of item elements
     * @api public
     */
    proto.layoutItems = function( items, isInstant ) {
        items = this._getItemsForLayout( items );

        this._layoutItems( items, isInstant );

        this._postLayout();
    };

    /**
     * get the items to be laid out
     * you may want to skip over some items
     * @param {Array} items
     * @returns {Array} items
     */
    proto._getItemsForLayout = function( items ) {
        return items.filter( function( item ) {
            return !item.isIgnored;
        });
    };

    /**
     * layout items
     * @param {Array} items
     * @param {Boolean} isInstant
     */
    proto._layoutItems = function( items, isInstant ) {
        this._emitCompleteOnItems( 'layout', items );

        if ( !items || !items.length ) {
            // no items, emit event with empty array
            return;
        }

        var queue = [];

        items.forEach( function( item ) {
            // get x/y object from method
            var position = this._getItemLayoutPosition( item );
            // enqueue
            position.item = item;
            position.isInstant = isInstant || item.isLayoutInstant;
            queue.push( position );
        }, this );

        this._processLayoutQueue( queue );
    };

    /**
     * get item layout position
     * @param {Outlayer.Item} item
     * @returns {Object} x and y position
     */
    proto._getItemLayoutPosition = function( /* item */ ) {
        return {
            x: 0,
            y: 0
        };
    };

    /**
     * iterate over array and position each item
     * Reason being - separating this logic prevents 'layout invalidation'
     * thx @paul_irish
     * @param {Array} queue
     */
    proto._processLayoutQueue = function( queue ) {
        this.updateStagger();
        queue.forEach( function( obj, i ) {
            this._positionItem( obj.item, obj.x, obj.y, obj.isInstant, i );
        }, this );
    };

// set stagger from option in milliseconds number
    proto.updateStagger = function() {
        var stagger = this.options.stagger;
        if ( stagger === null || stagger === undefined ) {
            this.stagger = 0;
            return;
        }
        this.stagger = getMilliseconds( stagger );
        return this.stagger;
    };

    /**
     * Sets position of item in DOM
     * @param {Outlayer.Item} item
     * @param {Number} x - horizontal position
     * @param {Number} y - vertical position
     * @param {Boolean} isInstant - disables transitions
     */
    proto._positionItem = function( item, x, y, isInstant, i ) {
        if ( isInstant ) {
            // if not transition, just set CSS
            item.goTo( x, y );
        } else {
            item.stagger( i * this.stagger );
            item.moveTo( x, y );
        }
    };

    /**
     * Any logic you want to do after each layout,
     * i.e. size the container
     */
    proto._postLayout = function() {
        this.resizeContainer();
    };

    proto.resizeContainer = function() {
        var isResizingContainer = this._getOption('resizeContainer');
        if ( !isResizingContainer ) {
            return;
        }
        var size = this._getContainerSize();
        if ( size ) {
            this._setContainerMeasure( size.width, true );
            this._setContainerMeasure( size.height, false );
        }
    };

    /**
     * Sets width or height of container if returned
     * @returns {Object} size
     *   @param {Number} width
     *   @param {Number} height
     */
    proto._getContainerSize = noop;

    /**
     * @param {Number} measure - size of width or height
     * @param {Boolean} isWidth
     */
    proto._setContainerMeasure = function( measure, isWidth ) {
        if ( measure === undefined ) {
            return;
        }

        var elemSize = this.size;
        // add padding and border width if border box
        if ( elemSize.isBorderBox ) {
            measure += isWidth ? elemSize.paddingLeft + elemSize.paddingRight +
            elemSize.borderLeftWidth + elemSize.borderRightWidth :
            elemSize.paddingBottom + elemSize.paddingTop +
            elemSize.borderTopWidth + elemSize.borderBottomWidth;
        }

        measure = Math.max( measure, 0 );
        this.element.style[ isWidth ? 'width' : 'height' ] = measure + 'px';
    };

    /**
     * emit eventComplete on a collection of items events
     * @param {String} eventName
     * @param {Array} items - Outlayer.Items
     */
    proto._emitCompleteOnItems = function( eventName, items ) {
        var _this = this;
        function onComplete() {
            _this.dispatchEvent( eventName + 'Complete', null, [ items ] );
        }

        var count = items.length;
        if ( !items || !count ) {
            onComplete();
            return;
        }

        var doneCount = 0;
        function tick() {
            doneCount++;
            if ( doneCount == count ) {
                onComplete();
            }
        }

        // bind callback
        items.forEach( function( item ) {
            item.once( eventName, tick );
        });
    };

    /**
     * emits events via EvEmitter and jQuery events
     * @param {String} type - name of event
     * @param {Event} event - original event
     * @param {Array} args - extra arguments
     */
    proto.dispatchEvent = function( type, event, args ) {
        // add original event to arguments
        var emitArgs = event ? [ event ].concat( args ) : args;
        this.emitEvent( type, emitArgs );

        if ( jQuery ) {
            // set this.$element
            this.$element = this.$element || jQuery( this.element );
            if ( event ) {
                // create jQuery event
                var $event = jQuery.Event( event );
                $event.type = type;
                this.$element.trigger( $event, args );
            } else {
                // just trigger with type if no event available
                this.$element.trigger( type, args );
            }
        }
    };

// -------------------------- ignore & stamps -------------------------- //


    /**
     * keep item in collection, but do not lay it out
     * ignored items do not get skipped in layout
     * @param {Element} elem
     */
    proto.ignore = function( elem ) {
        var item = this.getItem( elem );
        if ( item ) {
            item.isIgnored = true;
        }
    };

    /**
     * return item to layout collection
     * @param {Element} elem
     */
    proto.unignore = function( elem ) {
        var item = this.getItem( elem );
        if ( item ) {
            delete item.isIgnored;
        }
    };

    /**
     * adds elements to stamps
     * @param {NodeList, Array, Element, or String} elems
     */
    proto.stamp = function( elems ) {
        elems = this._find( elems );
        if ( !elems ) {
            return;
        }

        this.stamps = this.stamps.concat( elems );
        // ignore
        elems.forEach( this.ignore, this );
    };

    /**
     * removes elements to stamps
     * @param {NodeList, Array, or Element} elems
     */
    proto.unstamp = function( elems ) {
        elems = this._find( elems );
        if ( !elems ){
            return;
        }

        elems.forEach( function( elem ) {
            // filter out removed stamp elements
            utils.removeFrom( this.stamps, elem );
            this.unignore( elem );
        }, this );
    };

    /**
     * finds child elements
     * @param {NodeList, Array, Element, or String} elems
     * @returns {Array} elems
     */
    proto._find = function( elems ) {
        if ( !elems ) {
            return;
        }
        // if string, use argument as selector string
        if ( typeof elems == 'string' ) {
            elems = this.element.querySelectorAll( elems );
        }
        elems = utils.makeArray( elems );
        return elems;
    };

    proto._manageStamps = function() {
        if ( !this.stamps || !this.stamps.length ) {
            return;
        }

        this._getBoundingRect();

        this.stamps.forEach( this._manageStamp, this );
    };

// update boundingLeft / Top
    proto._getBoundingRect = function() {
        // get bounding rect for container element
        var boundingRect = this.element.getBoundingClientRect();
        var size = this.size;
        this._boundingRect = {
            left: boundingRect.left + size.paddingLeft + size.borderLeftWidth,
            top: boundingRect.top + size.paddingTop + size.borderTopWidth,
            right: boundingRect.right - ( size.paddingRight + size.borderRightWidth ),
            bottom: boundingRect.bottom - ( size.paddingBottom + size.borderBottomWidth )
        };
    };

    /**
     * @param {Element} stamp
     **/
    proto._manageStamp = noop;

    /**
     * get x/y position of element relative to container element
     * @param {Element} elem
     * @returns {Object} offset - has left, top, right, bottom
     */
    proto._getElementOffset = function( elem ) {
        var boundingRect = elem.getBoundingClientRect();
        var thisRect = this._boundingRect;
        var size = getSize( elem );
        var offset = {
            left: boundingRect.left - thisRect.left - size.marginLeft,
            top: boundingRect.top - thisRect.top - size.marginTop,
            right: thisRect.right - boundingRect.right - size.marginRight,
            bottom: thisRect.bottom - boundingRect.bottom - size.marginBottom
        };
        return offset;
    };

// -------------------------- resize -------------------------- //

// enable event handlers for listeners
// i.e. resize -> onresize
    proto.handleEvent = utils.handleEvent;

    /**
     * Bind layout to window resizing
     */
    proto.bindResize = function() {
        window.addEventListener( 'resize', this );
        this.isResizeBound = true;
    };

    /**
     * Unbind layout to window resizing
     */
    proto.unbindResize = function() {
        window.removeEventListener( 'resize', this );
        this.isResizeBound = false;
    };

    proto.onresize = function() {
        this.resize();
    };

    utils.debounceMethod( Outlayer, 'onresize', 100 );

    proto.resize = function() {
        // don't trigger if size did not change
        // or if resize was unbound. See #9
        if ( !this.isResizeBound || !this.needsResizeLayout() ) {
            return;
        }

        this.layout();
    };

    /**
     * check if layout is needed post layout
     * @returns Boolean
     */
    proto.needsResizeLayout = function() {
        var size = getSize( this.element );
        // check that this.size and size are there
        // IE8 triggers resize on body size change, so they might not be
        var hasSizes = this.size && size;
        return hasSizes && size.innerWidth !== this.size.innerWidth;
    };

// -------------------------- methods -------------------------- //

    /**
     * add items to Outlayer instance
     * @param {Array or NodeList or Element} elems
     * @returns {Array} items - Outlayer.Items
     **/
    proto.addItems = function( elems ) {
        var items = this._itemize( elems );
        // add items to collection
        if ( items.length ) {
            this.items = this.items.concat( items );
        }
        return items;
    };

    /**
     * Layout newly-appended item elements
     * @param {Array or NodeList or Element} elems
     */
    proto.appended = function( elems ) {
        var items = this.addItems( elems );
        if ( !items.length ) {
            return;
        }
        // layout and reveal just the new items
        this.layoutItems( items, true );
        this.reveal( items );
    };

    /**
     * Layout prepended elements
     * @param {Array or NodeList or Element} elems
     */
    proto.prepended = function( elems ) {
        var items = this._itemize( elems );
        if ( !items.length ) {
            return;
        }
        // add items to beginning of collection
        var previousItems = this.items.slice(0);
        this.items = items.concat( previousItems );
        // start new layout
        this._resetLayout();
        this._manageStamps();
        // layout new stuff without transition
        this.layoutItems( items, true );
        this.reveal( items );
        // layout previous items
        this.layoutItems( previousItems );
    };

    /**
     * reveal a collection of items
     * @param {Array of Outlayer.Items} items
     */
    proto.reveal = function( items ) {
        this._emitCompleteOnItems( 'reveal', items );
        if ( !items || !items.length ) {
            return;
        }
        var stagger = this.updateStagger();
        items.forEach( function( item, i ) {
            item.stagger( i * stagger );
            item.reveal();
        });
    };

    /**
     * hide a collection of items
     * @param {Array of Outlayer.Items} items
     */
    proto.hide = function( items ) {
        this._emitCompleteOnItems( 'hide', items );
        if ( !items || !items.length ) {
            return;
        }
        var stagger = this.updateStagger();
        items.forEach( function( item, i ) {
            item.stagger( i * stagger );
            item.hide();
        });
    };

    /**
     * reveal item elements
     * @param {Array}, {Element}, {NodeList} items
     */
    proto.revealItemElements = function( elems ) {
        var items = this.getItems( elems );
        this.reveal( items );
    };

    /**
     * hide item elements
     * @param {Array}, {Element}, {NodeList} items
     */
    proto.hideItemElements = function( elems ) {
        var items = this.getItems( elems );
        this.hide( items );
    };

    /**
     * get Outlayer.Item, given an Element
     * @param {Element} elem
     * @param {Function} callback
     * @returns {Outlayer.Item} item
     */
    proto.getItem = function( elem ) {
        // loop through items to get the one that matches
        for ( var i=0; i < this.items.length; i++ ) {
            var item = this.items[i];
            if ( item.element == elem ) {
                // return item
                return item;
            }
        }
    };

    /**
     * get collection of Outlayer.Items, given Elements
     * @param {Array} elems
     * @returns {Array} items - Outlayer.Items
     */
    proto.getItems = function( elems ) {
        elems = utils.makeArray( elems );
        var items = [];
        elems.forEach( function( elem ) {
            var item = this.getItem( elem );
            if ( item ) {
                items.push( item );
            }
        }, this );

        return items;
    };

    /**
     * remove element(s) from instance and DOM
     * @param {Array or NodeList or Element} elems
     */
    proto.remove = function( elems ) {
        var removeItems = this.getItems( elems );

        this._emitCompleteOnItems( 'remove', removeItems );

        // bail if no items to remove
        if ( !removeItems || !removeItems.length ) {
            return;
        }

        removeItems.forEach( function( item ) {
            item.remove();
            // remove item from collection
            utils.removeFrom( this.items, item );
        }, this );
    };

// ----- destroy ----- //

// remove and disable Outlayer instance
    proto.destroy = function() {
        // clean up dynamic styles
        var style = this.element.style;
        style.height = '';
        style.position = '';
        style.width = '';
        // destroy items
        this.items.forEach( function( item ) {
            item.destroy();
        });

        this.unbindResize();

        var id = this.element.outlayerGUID;
        delete instances[ id ]; // remove reference to instance by id
        delete this.element.outlayerGUID;
        // remove data for jQuery
        if ( jQuery ) {
            jQuery.removeData( this.element, this.constructor.namespace );
        }

    };

// -------------------------- data -------------------------- //

    /**
     * get Outlayer instance from element
     * @param {Element} elem
     * @returns {Outlayer}
     */
    Outlayer.data = function( elem ) {
        elem = utils.getQueryElement( elem );
        var id = elem && elem.outlayerGUID;
        return id && instances[ id ];
    };


// -------------------------- create Outlayer class -------------------------- //

    /**
     * create a layout class
     * @param {String} namespace
     */
    Outlayer.create = function( namespace, options ) {
        // sub-class Outlayer
        var Layout = subclass( Outlayer );
        // apply new options and compatOptions
        Layout.defaults = utils.extend( {}, Outlayer.defaults );
        utils.extend( Layout.defaults, options );
        Layout.compatOptions = utils.extend( {}, Outlayer.compatOptions  );

        Layout.namespace = namespace;

        Layout.data = Outlayer.data;

        // sub-class Item
        Layout.Item = subclass( Item );

        // -------------------------- declarative -------------------------- //

        utils.htmlInit( Layout, namespace );

        // -------------------------- jQuery bridge -------------------------- //

        // make into jQuery plugin
        if ( jQuery && jQuery.bridget ) {
            jQuery.bridget( namespace, Layout );
        }

        return Layout;
    };

    function subclass( Parent ) {
        function SubClass() {
            Parent.apply( this, arguments );
        }

        SubClass.prototype = Object.create( Parent.prototype );
        SubClass.prototype.constructor = SubClass;

        return SubClass;
    }

// ----- helpers ----- //

// how many milliseconds are in each unit
    var msUnits = {
        ms: 1,
        s: 1000
    };

// munge time-like parameter into millisecond number
// '0.4s' -> 40
    function getMilliseconds( time ) {
        if ( typeof time == 'number' ) {
            return time;
        }
        var matches = time.match( /(^\d*\.?\d*)(\w*)/ );
        var num = matches && matches[1];
        var unit = matches && matches[2];
        if ( !num.length ) {
            return 0;
        }
        num = parseFloat( num );
        var mult = msUnits[ unit ] || 1;
        return num * mult;
    }

// ----- fin ----- //

// back in global
    Outlayer.Item = Item;

    return Outlayer;

}));

/**
 * Isotope Item
 **/

( function( window, factory ) {
    // universal module definition
    /* jshint strict: false */ /*globals define, module, require */
    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'isotope/js/item',[
                'outlayer/outlayer'
            ],
            factory );
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory(
            require('outlayer')
        );
    } else {
        // browser global
        window.Isotope = window.Isotope || {};
        window.Isotope.Item = factory(
            window.Outlayer
        );
    }

}( window, function factory( Outlayer ) {
    'use strict';

// -------------------------- Item -------------------------- //

// sub-class Outlayer Item
    function Item() {
        Outlayer.Item.apply( this, arguments );
    }

    var proto = Item.prototype = Object.create( Outlayer.Item.prototype );

    var _create = proto._create;
    proto._create = function() {
        // assign id, used for original-order sorting
        this.id = this.layout.itemGUID++;
        _create.call( this );
        this.sortData = {};
    };

    proto.updateSortData = function() {
        if ( this.isIgnored ) {
            return;
        }
        // default sorters
        this.sortData.id = this.id;
        // for backward compatibility
        this.sortData['original-order'] = this.id;
        this.sortData.random = Math.random();
        // go thru getSortData obj and apply the sorters
        var getSortData = this.layout.options.getSortData;
        var sorters = this.layout._sorters;
        for ( var key in getSortData ) {
            var sorter = sorters[ key ];
            this.sortData[ key ] = sorter( this.element, this );
        }
    };

    var _destroy = proto.destroy;
    proto.destroy = function() {
        // call super
        _destroy.apply( this, arguments );
        // reset display, #741
        this.css({
            display: ''
        });
    };

    return Item;

}));

/**
 * Isotope LayoutMode
 */

( function( window, factory ) {
    // universal module definition
    /* jshint strict: false */ /*globals define, module, require */
    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'isotope/js/layout-mode',[
                'get-size/get-size',
                'outlayer/outlayer'
            ],
            factory );
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory(
            require('get-size'),
            require('outlayer')
        );
    } else {
        // browser global
        window.Isotope = window.Isotope || {};
        window.Isotope.LayoutMode = factory(
            window.getSize,
            window.Outlayer
        );
    }

}( window, function factory( getSize, Outlayer ) {
    'use strict';

    // layout mode class
    function LayoutMode( isotope ) {
        this.isotope = isotope;
        // link properties
        if ( isotope ) {
            this.options = isotope.options[ this.namespace ];
            this.element = isotope.element;
            this.items = isotope.filteredItems;
            this.size = isotope.size;
        }
    }

    var proto = LayoutMode.prototype;

    /**
     * some methods should just defer to default Outlayer method
     * and reference the Isotope instance as `this`
     **/
    var facadeMethods = [
        '_resetLayout',
        '_getItemLayoutPosition',
        '_manageStamp',
        '_getContainerSize',
        '_getElementOffset',
        'needsResizeLayout',
        '_getOption'
    ];

    facadeMethods.forEach( function( methodName ) {
        proto[ methodName ] = function() {
            return Outlayer.prototype[ methodName ].apply( this.isotope, arguments );
        };
    });

    // -----  ----- //

    // for horizontal layout modes, check vertical size
    proto.needsVerticalResizeLayout = function() {
        // don't trigger if size did not change
        var size = getSize( this.isotope.element );
        // check that this.size and size are there
        // IE8 triggers resize on body size change, so they might not be
        var hasSizes = this.isotope.size && size;
        return hasSizes && size.innerHeight != this.isotope.size.innerHeight;
    };

    // ----- measurements ----- //

    proto._getMeasurement = function() {
        this.isotope._getMeasurement.apply( this, arguments );
    };

    proto.getColumnWidth = function() {
        this.getSegmentSize( 'column', 'Width' );
    };

    proto.getRowHeight = function() {
        this.getSegmentSize( 'row', 'Height' );
    };

    /**
     * get columnWidth or rowHeight
     * segment: 'column' or 'row'
     * size 'Width' or 'Height'
     **/
    proto.getSegmentSize = function( segment, size ) {
        var segmentName = segment + size;
        var outerSize = 'outer' + size;
        // columnWidth / outerWidth // rowHeight / outerHeight
        this._getMeasurement( segmentName, outerSize );
        // got rowHeight or columnWidth, we can chill
        if ( this[ segmentName ] ) {
            return;
        }
        // fall back to item of first element
        var firstItemSize = this.getFirstItemSize();
        this[ segmentName ] = firstItemSize && firstItemSize[ outerSize ] ||
                // or size of container
            this.isotope.size[ 'inner' + size ];
    };

    proto.getFirstItemSize = function() {
        var firstItem = this.isotope.filteredItems[0];
        return firstItem && firstItem.element && getSize( firstItem.element );
    };

    // ----- methods that should reference isotope ----- //

    proto.layout = function() {
        this.isotope.layout.apply( this.isotope, arguments );
    };

    proto.getSize = function() {
        this.isotope.getSize();
        this.size = this.isotope.size;
    };

    // -------------------------- create -------------------------- //

    LayoutMode.modes = {};

    LayoutMode.create = function( namespace, options ) {

        function Mode() {
            LayoutMode.apply( this, arguments );
        }

        Mode.prototype = Object.create( proto );
        Mode.prototype.constructor = Mode;

        // default options
        if ( options ) {
            Mode.options = options;
        }

        Mode.prototype.namespace = namespace;
        // register in Isotope
        LayoutMode.modes[ namespace ] = Mode;

        return Mode;
    };

    return LayoutMode;

}));

/*!
 * Masonry v4.1.0
 * Cascading grid layout library
 * http://masonry.desandro.com
 * MIT License
 * by David DeSandro
 */

( function( window, factory ) {
    // universal module definition
    /* jshint strict: false */ /*globals define, module, require */
    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'masonry/masonry',[
                'outlayer/outlayer',
                'get-size/get-size'
            ],
            factory );
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory(
            require('outlayer'),
            require('get-size')
        );
    } else {
        // browser global
        window.Masonry = factory(
            window.Outlayer,
            window.getSize
        );
    }

}( window, function factory( Outlayer, getSize ) {



// -------------------------- masonryDefinition -------------------------- //

    // create an Outlayer layout class
    var Masonry = Outlayer.create('masonry');
    // isFitWidth -> fitWidth
    Masonry.compatOptions.fitWidth = 'isFitWidth';

    Masonry.prototype._resetLayout = function() {
        this.getSize();
        this._getMeasurement( 'columnWidth', 'outerWidth' );
        this._getMeasurement( 'gutter', 'outerWidth' );
        this.measureColumns();

        // reset column Y
        this.colYs = [];
        for ( var i=0; i < this.cols; i++ ) {
            this.colYs.push( 0 );
        }

        this.maxY = 0;
    };

    Masonry.prototype.measureColumns = function() {
        this.getContainerWidth();
        // if columnWidth is 0, default to outerWidth of first item
        if ( !this.columnWidth ) {
            var firstItem = this.items[0];
            var firstItemElem = firstItem && firstItem.element;
            // columnWidth fall back to item of first element
            this.columnWidth = firstItemElem && getSize( firstItemElem ).outerWidth ||
                    // if first elem has no width, default to size of container
                this.containerWidth;
        }

        var columnWidth = this.columnWidth += this.gutter;

        // calculate columns
        var containerWidth = this.containerWidth + this.gutter;
        var cols = containerWidth / columnWidth;
        // fix rounding errors, typically with gutters
        var excess = columnWidth - containerWidth % columnWidth;
        // if overshoot is less than a pixel, round up, otherwise floor it
        var mathMethod = excess && excess < 1 ? 'round' : 'floor';
        cols = Math[ mathMethod ]( cols );
        this.cols = Math.max( cols, 1 );
    };

    Masonry.prototype.getContainerWidth = function() {
        // container is parent if fit width
        var isFitWidth = this._getOption('fitWidth');
        var container = isFitWidth ? this.element.parentNode : this.element;
        // check that this.size and size are there
        // IE8 triggers resize on body size change, so they might not be
        var size = getSize( container );
        this.containerWidth = size && size.innerWidth;
    };

    Masonry.prototype._getItemLayoutPosition = function( item ) {
        item.getSize();
        // how many columns does this brick span
        var remainder = item.size.outerWidth % this.columnWidth;
        var mathMethod = remainder && remainder < 1 ? 'round' : 'ceil';
        // round if off by 1 pixel, otherwise use ceil
        var colSpan = Math[ mathMethod ]( item.size.outerWidth / this.columnWidth );
        colSpan = Math.min( colSpan, this.cols );

        var colGroup = this._getColGroup( colSpan );
        // get the minimum Y value from the columns
        var minimumY = Math.min.apply( Math, colGroup );
        var shortColIndex = colGroup.indexOf( minimumY );

        // position the brick
        var position = {
            x: this.columnWidth * shortColIndex,
            y: minimumY
        };

        // apply setHeight to necessary columns
        var setHeight = minimumY + item.size.outerHeight;
        var setSpan = this.cols + 1 - colGroup.length;
        for ( var i = 0; i < setSpan; i++ ) {
            this.colYs[ shortColIndex + i ] = setHeight;
        }

        return position;
    };

    /**
     * @param {Number} colSpan - number of columns the element spans
     * @returns {Array} colGroup
     */
    Masonry.prototype._getColGroup = function( colSpan ) {
        if ( colSpan < 2 ) {
            // if brick spans only one column, use all the column Ys
            return this.colYs;
        }

        var colGroup = [];
        // how many different places could this brick fit horizontally
        var groupCount = this.cols + 1 - colSpan;
        // for each group potential horizontal position
        for ( var i = 0; i < groupCount; i++ ) {
            // make an array of colY values for that one group
            var groupColYs = this.colYs.slice( i, i + colSpan );
            // and get the max value of the array
            colGroup[i] = Math.max.apply( Math, groupColYs );
        }
        return colGroup;
    };

    Masonry.prototype._manageStamp = function( stamp ) {
        var stampSize = getSize( stamp );
        var offset = this._getElementOffset( stamp );
        // get the columns that this stamp affects
        var isOriginLeft = this._getOption('originLeft');
        var firstX = isOriginLeft ? offset.left : offset.right;
        var lastX = firstX + stampSize.outerWidth;
        var firstCol = Math.floor( firstX / this.columnWidth );
        firstCol = Math.max( 0, firstCol );
        var lastCol = Math.floor( lastX / this.columnWidth );
        // lastCol should not go over if multiple of columnWidth #425
        lastCol -= lastX % this.columnWidth ? 0 : 1;
        lastCol = Math.min( this.cols - 1, lastCol );
        // set colYs to bottom of the stamp

        var isOriginTop = this._getOption('originTop');
        var stampMaxY = ( isOriginTop ? offset.top : offset.bottom ) +
            stampSize.outerHeight;
        for ( var i = firstCol; i <= lastCol; i++ ) {
            this.colYs[i] = Math.max( stampMaxY, this.colYs[i] );
        }
    };

    Masonry.prototype._getContainerSize = function() {
        this.maxY = Math.max.apply( Math, this.colYs );
        var size = {
            height: this.maxY
        };

        if ( this._getOption('fitWidth') ) {
            size.width = this._getContainerFitWidth();
        }

        return size;
    };

    Masonry.prototype._getContainerFitWidth = function() {
        var unusedCols = 0;
        // count unused columns
        var i = this.cols;
        while ( --i ) {
            if ( this.colYs[i] !== 0 ) {
                break;
            }
            unusedCols++;
        }
        // fit container to columns that have been used
        return ( this.cols - unusedCols ) * this.columnWidth - this.gutter;
    };

    Masonry.prototype.needsResizeLayout = function() {
        var previousWidth = this.containerWidth;
        this.getContainerWidth();
        return previousWidth != this.containerWidth;
    };

    return Masonry;

}));

/*!
 * Masonry layout mode
 * sub-classes Masonry
 * http://masonry.desandro.com
 */

( function( window, factory ) {
    // universal module definition
    /* jshint strict: false */ /*globals define, module, require */
    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'isotope/js/layout-modes/masonry',[
                '../layout-mode',
                'masonry/masonry'
            ],
            factory );
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory(
            require('../layout-mode'),
            require('masonry-layout')
        );
    } else {
        // browser global
        factory(
            window.Isotope.LayoutMode,
            window.Masonry
        );
    }

}( window, function factory( LayoutMode, Masonry ) {
    'use strict';

// -------------------------- masonryDefinition -------------------------- //

    // create an Outlayer layout class
    var MasonryMode = LayoutMode.create('masonry');

    var proto = MasonryMode.prototype;

    var keepModeMethods = {
        _getElementOffset: true,
        layout: true,
        _getMeasurement: true
    };

    // inherit Masonry prototype
    for ( var method in Masonry.prototype ) {
        // do not inherit mode methods
        if ( !keepModeMethods[ method ] ) {
            proto[ method ] = Masonry.prototype[ method ];
        }
    }

    var measureColumns = proto.measureColumns;
    proto.measureColumns = function() {
        // set items, used if measuring first item
        this.items = this.isotope.filteredItems;
        measureColumns.call( this );
    };

    // point to mode options for fitWidth
    var _getOption = proto._getOption;
    proto._getOption = function( option ) {
        if ( option == 'fitWidth' ) {
            return this.options.isFitWidth !== undefined ?
                this.options.isFitWidth : this.options.fitWidth;
        }
        return _getOption.apply( this.isotope, arguments );
    };

    return MasonryMode;

}));

/**
 * fitRows layout mode
 */

( function( window, factory ) {
    // universal module definition
    /* jshint strict: false */ /*globals define, module, require */
    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'isotope/js/layout-modes/fit-rows',[
                '../layout-mode'
            ],
            factory );
    } else if ( typeof exports == 'object' ) {
        // CommonJS
        module.exports = factory(
            require('../layout-mode')
        );
    } else {
        // browser global
        factory(
            window.Isotope.LayoutMode
        );
    }

}( window, function factory( LayoutMode ) {
    'use strict';

    var FitRows = LayoutMode.create('fitRows');

    var proto = FitRows.prototype;

    proto._resetLayout = function() {
        this.x = 0;
        this.y = 0;
        this.maxY = 0;
        this._getMeasurement( 'gutter', 'outerWidth' );
    };

    proto._getItemLayoutPosition = function( item ) {
        item.getSize();

        var itemWidth = item.size.outerWidth + this.gutter;
        // if this element cannot fit in the current row
        var containerWidth = this.isotope.size.innerWidth + this.gutter;
        if ( this.x !== 0 && itemWidth + this.x > containerWidth ) {
            this.x = 0;
            this.y = this.maxY;
        }

        var position = {
            x: this.x,
            y: this.y
        };

        this.maxY = Math.max( this.maxY, this.y + item.size.outerHeight );
        this.x += itemWidth;

        return position;
    };

    proto._getContainerSize = function() {
        return { height: this.maxY };
    };

    return FitRows;

}));

/**
 * vertical layout mode
 */

( function( window, factory ) {
    // universal module definition
    /* jshint strict: false */ /*globals define, module, require */
    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( 'isotope/js/layout-modes/vertical',[
                '../layout-mode'
            ],
            factory );
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory(
            require('../layout-mode')
        );
    } else {
        // browser global
        factory(
            window.Isotope.LayoutMode
        );
    }

}( window, function factory( LayoutMode ) {
    'use strict';

    var Vertical = LayoutMode.create( 'vertical', {
        horizontalAlignment: 0
    });

    var proto = Vertical.prototype;

    proto._resetLayout = function() {
        this.y = 0;
    };

    proto._getItemLayoutPosition = function( item ) {
        item.getSize();
        var x = ( this.isotope.size.innerWidth - item.size.outerWidth ) *
            this.options.horizontalAlignment;
        var y = this.y;
        this.y += item.size.outerHeight;
        return { x: x, y: y };
    };

    proto._getContainerSize = function() {
        return { height: this.y };
    };

    return Vertical;

}));

/*!
 * Isotope v3.0.1
 *
 * Licensed GPLv3 for open source use
 * or Isotope Commercial License for commercial use
 *
 * http://isotope.metafizzy.co
 * Copyright 2016 Metafizzy
 */

( function( window, factory ) {
    // universal module definition
    /* jshint strict: false */ /*globals define, module, require */
    if ( typeof define == 'function' && define.amd ) {
        // AMD
        define( [
                'outlayer/outlayer',
                'get-size/get-size',
                'desandro-matches-selector/matches-selector',
                'fizzy-ui-utils/utils',
                'isotope/js/item',
                'isotope/js/layout-mode',
                // include default layout modes
                'isotope/js/layout-modes/masonry',
                'isotope/js/layout-modes/fit-rows',
                'isotope/js/layout-modes/vertical'
            ],
            function( Outlayer, getSize, matchesSelector, utils, Item, LayoutMode ) {
                return factory( window, Outlayer, getSize, matchesSelector, utils, Item, LayoutMode );
            });
    } else if ( typeof module == 'object' && module.exports ) {
        // CommonJS
        module.exports = factory(
            window,
            require('outlayer'),
            require('get-size'),
            require('desandro-matches-selector'),
            require('fizzy-ui-utils'),
            require('isotope/js/item'),
            require('isotope/js/layout-mode'),
            // include default layout modes
            require('isotope/js/layout-modes/masonry'),
            require('isotope/js/layout-modes/fit-rows'),
            require('isotope/js/layout-modes/vertical')
        );
    } else {
        // browser global
        window.Isotope = factory(
            window,
            window.Outlayer,
            window.getSize,
            window.matchesSelector,
            window.fizzyUIUtils,
            window.Isotope.Item,
            window.Isotope.LayoutMode
        );
    }

}( window, function factory( window, Outlayer, getSize, matchesSelector, utils,
                             Item, LayoutMode ) {



// -------------------------- vars -------------------------- //

    var jQuery = window.jQuery;

// -------------------------- helpers -------------------------- //

    var trim = String.prototype.trim ?
        function( str ) {
            return str.trim();
        } :
        function( str ) {
            return str.replace( /^\s+|\s+$/g, '' );
        };

// -------------------------- isotopeDefinition -------------------------- //

    // create an Outlayer layout class
    var Isotope = Outlayer.create( 'isotope', {
        layoutMode: 'masonry',
        isJQueryFiltering: true,
        sortAscending: true
    });

    Isotope.Item = Item;
    Isotope.LayoutMode = LayoutMode;

    var proto = Isotope.prototype;

    proto._create = function() {
        this.itemGUID = 0;
        // functions that sort items
        this._sorters = {};
        this._getSorters();
        // call super
        Outlayer.prototype._create.call( this );

        // create layout modes
        this.modes = {};
        // start filteredItems with all items
        this.filteredItems = this.items;
        // keep of track of sortBys
        this.sortHistory = [ 'original-order' ];
        // create from registered layout modes
        for ( var name in LayoutMode.modes ) {
            this._initLayoutMode( name );
        }
    };

    proto.reloadItems = function() {
        // reset item ID counter
        this.itemGUID = 0;
        // call super
        Outlayer.prototype.reloadItems.call( this );
    };

    proto._itemize = function() {
        var items = Outlayer.prototype._itemize.apply( this, arguments );
        // assign ID for original-order
        for ( var i=0; i < items.length; i++ ) {
            var item = items[i];
            item.id = this.itemGUID++;
        }
        this._updateItemsSortData( items );
        return items;
    };


    // -------------------------- layout -------------------------- //

    proto._initLayoutMode = function( name ) {
        var Mode = LayoutMode.modes[ name ];
        // set mode options
        // HACK extend initial options, back-fill in default options
        var initialOpts = this.options[ name ] || {};
        this.options[ name ] = Mode.options ?
            utils.extend( Mode.options, initialOpts ) : initialOpts;
        // init layout mode instance
        this.modes[ name ] = new Mode( this );
    };


    proto.layout = function() {
        // if first time doing layout, do all magic
        if ( !this._isLayoutInited && this._getOption('initLayout') ) {
            this.arrange();
            return;
        }
        this._layout();
    };

    // private method to be used in layout() & magic()
    proto._layout = function() {
        // don't animate first layout
        var isInstant = this._getIsInstant();
        // layout flow
        this._resetLayout();
        this._manageStamps();
        this.layoutItems( this.filteredItems, isInstant );

        // flag for initalized
        this._isLayoutInited = true;
    };

    // filter + sort + layout
    proto.arrange = function( opts ) {
        // set any options pass
        this.option( opts );
        this._getIsInstant();
        // filter, sort, and layout

        // filter
        var filtered = this._filter( this.items );
        this.filteredItems = filtered.matches;

        this._bindArrangeComplete();

        if ( this._isInstant ) {
            this._noTransition( this._hideReveal, [ filtered ] );
        } else {
            this._hideReveal( filtered );
        }

        this._sort();
        this._layout();
    };
    // alias to _init for main plugin method
    proto._init = proto.arrange;

    proto._hideReveal = function( filtered ) {
        this.reveal( filtered.needReveal );
        this.hide( filtered.needHide );
    };

    // HACK
    // Don't animate/transition first layout
    // Or don't animate/transition other layouts
    proto._getIsInstant = function() {
        var isLayoutInstant = this._getOption('layoutInstant');
        var isInstant = isLayoutInstant !== undefined ? isLayoutInstant :
            !this._isLayoutInited;
        this._isInstant = isInstant;
        return isInstant;
    };

    // listen for layoutComplete, hideComplete and revealComplete
    // to trigger arrangeComplete
    proto._bindArrangeComplete = function() {
        // listen for 3 events to trigger arrangeComplete
        var isLayoutComplete, isHideComplete, isRevealComplete;
        var _this = this;
        function arrangeParallelCallback() {
            if ( isLayoutComplete && isHideComplete && isRevealComplete ) {
                _this.dispatchEvent( 'arrangeComplete', null, [ _this.filteredItems ] );
            }
        }
        this.once( 'layoutComplete', function() {
            isLayoutComplete = true;
            arrangeParallelCallback();
        });
        this.once( 'hideComplete', function() {
            isHideComplete = true;
            arrangeParallelCallback();
        });
        this.once( 'revealComplete', function() {
            isRevealComplete = true;
            arrangeParallelCallback();
        });
    };

    // -------------------------- filter -------------------------- //

    proto._filter = function( items ) {
        var filter = this.options.filter;
        filter = filter || '*';
        var matches = [];
        var hiddenMatched = [];
        var visibleUnmatched = [];

        var test = this._getFilterTest( filter );

        // test each item
        for ( var i=0; i < items.length; i++ ) {
            var item = items[i];
            if ( item.isIgnored ) {
                continue;
            }
            // add item to either matched or unmatched group
            var isMatched = test( item );
            // item.isFilterMatched = isMatched;
            // add to matches if its a match
            if ( isMatched ) {
                matches.push( item );
            }
            // add to additional group if item needs to be hidden or revealed
            if ( isMatched && item.isHidden ) {
                hiddenMatched.push( item );
            } else if ( !isMatched && !item.isHidden ) {
                visibleUnmatched.push( item );
            }
        }

        // return collections of items to be manipulated
        return {
            matches: matches,
            needReveal: hiddenMatched,
            needHide: visibleUnmatched
        };
    };

    // get a jQuery, function, or a matchesSelector test given the filter
    proto._getFilterTest = function( filter ) {
        if ( jQuery && this.options.isJQueryFiltering ) {
            // use jQuery
            return function( item ) {
                return jQuery( item.element ).is( filter );
            };
        }
        if ( typeof filter == 'function' ) {
            // use filter as function
            return function( item ) {
                return filter( item.element );
            };
        }
        // default, use filter as selector string
        return function( item ) {
            return matchesSelector( item.element, filter );
        };
    };

    // -------------------------- sorting -------------------------- //

    /**
     * @params {Array} elems
     * @public
     */
    proto.updateSortData = function( elems ) {
        // get items
        var items;
        if ( elems ) {
            elems = utils.makeArray( elems );
            items = this.getItems( elems );
        } else {
            // update all items if no elems provided
            items = this.items;
        }

        this._getSorters();
        this._updateItemsSortData( items );
    };

    proto._getSorters = function() {
        var getSortData = this.options.getSortData;
        for ( var key in getSortData ) {
            var sorter = getSortData[ key ];
            this._sorters[ key ] = mungeSorter( sorter );
        }
    };

    /**
     * @params {Array} items - of Isotope.Items
     * @private
     */
    proto._updateItemsSortData = function( items ) {
        // do not update if no items
        var len = items && items.length;

        for ( var i=0; len && i < len; i++ ) {
            var item = items[i];
            item.updateSortData();
        }
    };

    // ----- munge sorter ----- //

    // encapsulate this, as we just need mungeSorter
    // other functions in here are just for munging
    var mungeSorter = ( function() {
        // add a magic layer to sorters for convienent shorthands
        // `.foo-bar` will use the text of .foo-bar querySelector
        // `[foo-bar]` will use attribute
        // you can also add parser
        // `.foo-bar parseInt` will parse that as a number
        function mungeSorter( sorter ) {
            // if not a string, return function or whatever it is
            if ( typeof sorter != 'string' ) {
                return sorter;
            }
            // parse the sorter string
            var args = trim( sorter ).split(' ');
            var query = args[0];
            // check if query looks like [an-attribute]
            var attrMatch = query.match( /^\[(.+)\]$/ );
            var attr = attrMatch && attrMatch[1];
            var getValue = getValueGetter( attr, query );
            // use second argument as a parser
            var parser = Isotope.sortDataParsers[ args[1] ];
            // parse the value, if there was a parser
            sorter = parser ? function( elem ) {
                return elem && parser( getValue( elem ) );
            } :
                // otherwise just return value
                function( elem ) {
                    return elem && getValue( elem );
                };

            return sorter;
        }

        // get an attribute getter, or get text of the querySelector
        function getValueGetter( attr, query ) {
            // if query looks like [foo-bar], get attribute
            if ( attr ) {
                return function getAttribute( elem ) {
                    return elem.getAttribute( attr );
                };
            }

            // otherwise, assume its a querySelector, and get its text
            return function getChildText( elem ) {
                var child = elem.querySelector( query );
                return child && child.textContent;
            };
        }

        return mungeSorter;
    })();

    // parsers used in getSortData shortcut strings
    Isotope.sortDataParsers = {
        'parseInt': function( val ) {
            return parseInt( val, 10 );
        },
        'parseFloat': function( val ) {
            return parseFloat( val );
        }
    };

    // ----- sort method ----- //

    // sort filteredItem order
    proto._sort = function() {
        var sortByOpt = this.options.sortBy;
        if ( !sortByOpt ) {
            return;
        }
        // concat all sortBy and sortHistory
        var sortBys = [].concat.apply( sortByOpt, this.sortHistory );
        // sort magic
        var itemSorter = getItemSorter( sortBys, this.options.sortAscending );
        this.filteredItems.sort( itemSorter );
        // keep track of sortBy History
        if ( sortByOpt != this.sortHistory[0] ) {
            // add to front, oldest goes in last
            this.sortHistory.unshift( sortByOpt );
        }
    };

    // returns a function used for sorting
    function getItemSorter( sortBys, sortAsc ) {
        return function sorter( itemA, itemB ) {
            // cycle through all sortKeys
            for ( var i = 0; i < sortBys.length; i++ ) {
                var sortBy = sortBys[i];
                var a = itemA.sortData[ sortBy ];
                var b = itemB.sortData[ sortBy ];
                if ( a > b || a < b ) {
                    // if sortAsc is an object, use the value given the sortBy key
                    var isAscending = sortAsc[ sortBy ] !== undefined ? sortAsc[ sortBy ] : sortAsc;
                    var direction = isAscending ? 1 : -1;
                    return ( a > b ? 1 : -1 ) * direction;
                }
            }
            return 0;
        };
    }

    // -------------------------- methods -------------------------- //

    // get layout mode
    proto._mode = function() {
        var layoutMode = this.options.layoutMode;
        var mode = this.modes[ layoutMode ];
        if ( !mode ) {
            // TODO console.error
            throw new Error( 'No layout mode: ' + layoutMode );
        }
        // HACK sync mode's options
        // any options set after init for layout mode need to be synced
        mode.options = this.options[ layoutMode ];
        return mode;
    };

    proto._resetLayout = function() {
        // trigger original reset layout
        Outlayer.prototype._resetLayout.call( this );
        this._mode()._resetLayout();
    };

    proto._getItemLayoutPosition = function( item  ) {
        return this._mode()._getItemLayoutPosition( item );
    };

    proto._manageStamp = function( stamp ) {
        this._mode()._manageStamp( stamp );
    };

    proto._getContainerSize = function() {
        return this._mode()._getContainerSize();
    };

    proto.needsResizeLayout = function() {
        return this._mode().needsResizeLayout();
    };

    // -------------------------- adding & removing -------------------------- //

    // HEADS UP overwrites default Outlayer appended
    proto.appended = function( elems ) {
        var items = this.addItems( elems );
        if ( !items.length ) {
            return;
        }
        // filter, layout, reveal new items
        var filteredItems = this._filterRevealAdded( items );
        // add to filteredItems
        this.filteredItems = this.filteredItems.concat( filteredItems );
    };

    // HEADS UP overwrites default Outlayer prepended
    proto.prepended = function( elems ) {
        var items = this._itemize( elems );
        if ( !items.length ) {
            return;
        }
        // start new layout
        this._resetLayout();
        this._manageStamps();
        // filter, layout, reveal new items
        var filteredItems = this._filterRevealAdded( items );
        // layout previous items
        this.layoutItems( this.filteredItems );
        // add to items and filteredItems
        this.filteredItems = filteredItems.concat( this.filteredItems );
        this.items = items.concat( this.items );
    };

    proto._filterRevealAdded = function( items ) {
        var filtered = this._filter( items );
        this.hide( filtered.needHide );
        // reveal all new items
        this.reveal( filtered.matches );
        // layout new items, no transition
        this.layoutItems( filtered.matches, true );
        return filtered.matches;
    };

    /**
     * Filter, sort, and layout newly-appended item elements
     * @param {Array or NodeList or Element} elems
     */
    proto.insert = function( elems ) {
        var items = this.addItems( elems );
        if ( !items.length ) {
            return;
        }
        // append item elements
        var i, item;
        var len = items.length;
        for ( i=0; i < len; i++ ) {
            item = items[i];
            this.element.appendChild( item.element );
        }
        // filter new stuff
        var filteredInsertItems = this._filter( items ).matches;
        // set flag
        for ( i=0; i < len; i++ ) {
            items[i].isLayoutInstant = true;
        }
        this.arrange();
        // reset flag
        for ( i=0; i < len; i++ ) {
            delete items[i].isLayoutInstant;
        }
        this.reveal( filteredInsertItems );
    };

    var _remove = proto.remove;
    proto.remove = function( elems ) {
        elems = utils.makeArray( elems );
        var removeItems = this.getItems( elems );
        // do regular thing
        _remove.call( this, elems );
        // bail if no items to remove
        var len = removeItems && removeItems.length;
        // remove elems from filteredItems
        for ( var i=0; len && i < len; i++ ) {
            var item = removeItems[i];
            // remove item from collection
            utils.removeFrom( this.filteredItems, item );
        }
    };

    proto.shuffle = function() {
        // update random sortData
        for ( var i=0; i < this.items.length; i++ ) {
            var item = this.items[i];
            item.sortData.random = Math.random();
        }
        this.options.sortBy = 'random';
        this._sort();
        this._layout();
    };

    /**
     * trigger fn without transition
     * kind of hacky to have this in the first place
     * @param {Function} fn
     * @param {Array} args
     * @returns ret
     * @private
     */
    proto._noTransition = function( fn, args ) {
        // save transitionDuration before disabling
        var transitionDuration = this.options.transitionDuration;
        // disable transition
        this.options.transitionDuration = 0;
        // do it
        var returnValue = fn.apply( this, args );
        // re-enable transition for reveal
        this.options.transitionDuration = transitionDuration;
        return returnValue;
    };

    // ----- helper methods ----- //

    /**
     * getter method for getting filtered item elements
     * @returns {Array} elems - collection of item elements
     */
    proto.getFilteredItemElements = function() {
        return this.filteredItems.map( function( item ) {
            return item.element;
        });
    };

    // -----  ----- //

    return Isotope;

}));
/*!
 * masonryHorizontal layout mode for Isotope
 * v1.1.0
 * http://isotope.metafizzy.co/layout-modes/masonryhorizontal.html
 */

/*jshint browser: true, strict: true, undef: true, unused: true */

( function( window ) {

    'use strict';

// -------------------------- helpers -------------------------- //

    var indexOf = Array.prototype.indexOf ?
        function( items, value ) {
            return items.indexOf( value );
        } :
        function ( items, value ) {
            for ( var i=0, len = items.length; i < len; i++ ) {
                var item = items[i];
                if ( item === value ) {
                    return i;
                }
            }
            return -1;
        };

// -------------------------- definition -------------------------- //

    function masonryHorizontalDefinition( getSize, LayoutMode ) {
        // create an Outlayer layout class
        var MasonryHorizontal = LayoutMode.create('masonryHorizontal');

        MasonryHorizontal.prototype._resetLayout = function() {
            this.getRowHeight();
            this._getMeasurement( 'gutter', 'outerHeight' );

            this.rowHeight += this.gutter;
            // measure rows
            this.rows = Math.floor( ( this.isotope.size.innerHeight + this.gutter ) / this.rowHeight );
            this.rows = Math.max( this.rows, 1 );

            // reset row Xs
            var i = this.rows;
            this.rowXs = [];
            while (i--) {
                this.rowXs.push( 0 );
            }

            this.maxX = 0;
        };

        MasonryHorizontal.prototype._getItemLayoutPosition = function( item ) {
            item.getSize();
            // how many rows does this brick span
            var rowSpan = Math.ceil( item.size.outerHeight / this.rowHeight );
            rowSpan = Math.min( rowSpan, this.rows );

            var rowGroup = this._getRowGroup( rowSpan );
            // get the minimum X value from the rows
            var minimumX = Math.min.apply( Math, rowGroup );
            var shortRowIndex = indexOf( rowGroup, minimumX );

            // position the brick
            var position = {
                x: minimumX,
                y: this.rowHeight * shortRowIndex
            };

            // apply setHeight to necessary rows
            var setWidth = minimumX + item.size.outerWidth;
            var setSpan = this.rows + 1 - rowGroup.length;
            for ( var i = 0; i < setSpan; i++ ) {
                this.rowXs[ shortRowIndex + i ] = setWidth;
            }

            return position;
        };

        /**
         * @param {Number} rowSpan - number of rows the element spans
         * @returns {Array} rowGroup
         */
        MasonryHorizontal.prototype._getRowGroup = function( rowSpan ) {
            if ( rowSpan < 2 ) {
                // if brick spans only one row, use all the row Xs
                return this.rowXs;
            }

            var rowGroup = [];
            // how many different places could this brick fit horizontally
            var groupCount = this.rows + 1 - rowSpan;
            // for each group potential horizontal position
            for ( var i = 0; i < groupCount; i++ ) {
                // make an array of rowX values for that one group
                var groupRowXs = this.rowXs.slice( i, i + rowSpan );
                // and get the max value of the array
                rowGroup[i] = Math.max.apply( Math, groupRowXs );
            }
            return rowGroup;
        };

        MasonryHorizontal.prototype._manageStamp = function( stamp ) {
            var stampSize = getSize( stamp );
            var offset = this.isotope._getElementOffset( stamp );
            // get the rows that this stamp affects
            var firstY = this.isotope.options.isOriginTop ? offset.top : offset.bottom;
            var lastY = firstY + stampSize.outerHeight;
            var firstRow = Math.floor( firstY / this.rowHeight );
            firstRow = Math.max( 0, firstRow );
            var lastRow = Math.floor( lastY / this.rowHeight );
            lastRow = Math.min( this.rows - 1, lastRow );
            // set rowXs to outside edge of the stamp
            var stampMaxX = ( this.isotope.options.isOriginLeft ? offset.left : offset.right ) +
                stampSize.outerWidth;
            for ( var i = firstRow; i <= lastRow; i++ ) {
                this.rowXs[i] = Math.max( stampMaxX, this.rowXs[i] );
            }
        };

        MasonryHorizontal.prototype._getContainerSize = function() {
            this.maxX = Math.max.apply( Math, this.rowXs );

            return {
                width: this.maxX
            };
        };

        MasonryHorizontal.prototype.needsResizeLayout = function() {
            return this.needsVerticalResizeLayout();
        };

        return MasonryHorizontal;

    }

    if ( typeof define === 'function' && define.amd ) {
        // AMD
        define( [
                'get-size/get-size',
                'isotope/js/layout-mode'
            ],
            masonryHorizontalDefinition );
    } else if ( typeof exports === 'object' ) {
        // CommonJS
        module.exports = masonryHorizontalDefinition(
            require('get-size'),
            require('isotope-layout/js/layout-mode')
        );
    } else {
        // browser global
        masonryHorizontalDefinition(
            window.getSize,
            window.Isotope.LayoutMode
        );
    }

})( window );;
(function ($, window, document, undefined) {
  'use strict';
  
  var moduleClass = 'm-082',
    ModuleView,
    moduleInstances = [];
  
  $(document).ready(function () {
    _init();
  });
  
  $(document).on('dynmod_loaded', function () {
    _init(true);
  });
  
  function _init(reInit) {
    $('.' + moduleClass).each(function (index, element) {
      var $element = $(element),
        dynmodReloaded = $element.attr('data-dynmod-reloaded'),
        modelData = $element.data('model'),
        model = new Backbone.Model(modelData ? modelData : {});
      
      if (reInit && dynmodReloaded !== 'true') {
        return;
      }
      
      moduleInstances[index] = new ModuleView({
        el: $element,
        model: model
      });
      
      moduleInstances[index].render();
      $element.attr('data-dynmod-reloaded', 'false');
      
      // do everything in ModuleView
    });
  }
  
  ModuleView = ModuleBaseView.extend({
    cssClasses: {
      module: "m-082",
      introButton: "m-082__intro-button",
      embeddedForm: "m-082__embedded-form",
      noFold: "m-082--no-folding",
      bgImage : "m-082__form-background-imag"
    },
    
    events: {
      "click .m-082__intro-button": "_toggleForm"
    },
    
    // add only backbone instance variables here
    
    initialize: function (options) {
      ModuleBaseView.prototype.initialize.apply(this, [options]);
      
      // set variable
      this.isFormOpen = false;

      this.imageScaler = typeof (ScaleHandler) === 'undefined' ? null : new ScaleHandler();
      
      this._registerUiElements(options.el);
      this._initTimeline();
    },
    
    render: function () {
      ModuleBaseView.prototype.render.apply(this, arguments);
      
      // start point - render/update module here
        this._resizeImages();
    },
    
    _registerUiElements: function (el) {
      this.$module = $(el);
      this.$introButton = $("." + this.cssClasses.introButton);
      this.$embeddedForm = $("." + this.cssClasses.embeddedForm);
    },
    
    
    _initTimeline: function () {
      // if no fold class is set, initial state of form is open and button does not work
      console.log(this.$module);
      if( this.$module.hasClass(this.cssClasses.noFold) ) {
        return false;
      }
      this.timeline = new TimelineMax({
        paused: true
      });
      
      this.timeline.set(this.$embeddedForm, {display: 'none'});
      this.timeline.from(this.$embeddedForm, 0.6, {height: '0', autoAlpha: 0});
    },
    
    _openForm: function () {
      
      if (!this.isFormOpen) {
        
        if (this.timeline instanceof TimelineMax) {
          this.timeline.pause();
        }
        
        this.timeline = new TimelineMax();
        this.timeline.set(this.$embeddedForm, {display: 'block', height: 'auto', autoAlpha: 1});
        this.timeline.from(this.$embeddedForm, 0.8, {height: '0', autoAlpha: 1, ease: Power2.easeOut});
        this.timeline.to(window, 0.8, {scrollTo: this.$embeddedForm[0], ease: Power2.easeOut}, "-=0.7");
        
        this.isFormOpen = true;
      }
    },
    
    _closeForm: function () {
      
      if (this.isFormOpen) {
        
        if (this.timeline instanceof TimelineMax) {
          this.timeline.pause();
        }
        
        this.timeline = new TimelineMax();
        this.timeline.to(this.$embeddedForm, 0.8, {height: "0", autoAlpha: 1});
        // this.timeline.to(window, 0.8, {scrollTo: this.$embeddedForm[0], ease: Power2.easeOut}, '-=0.3');
        
        this.isFormOpen = false;
      }
    },
    
    _toggleForm: function () {
      // prevent folding, when no-fold class is set
      if( this.$module.hasClass(this.cssClasses.noFold) ) {
        return false;
      }
      
      if (!this.isFormOpen) {
        this._openForm();
      } else {
        this._closeForm();
      }
    },

      _resizeImages : function () {
          var thiz = this;
          this.$embeddedForm.find('.' + this.cssClasses.bgImage).each(function () {
			  thiz._resizeImage($(this), thiz.imageScaler);
		  });
	  },

      _resizeImage : function($image, imageScaler){
        var scaleParam = imageScaler.getScaleParameter($image);
        imageScaler.replaceSource($image, $image.attr('data-image-src'), scaleParam);
      },
    
    
    destroy: function () {
      ModuleBaseView.prototype.destroy.apply(this, arguments);
      
      // destroy module here
    }
  });
  
})(jQuery, this, this.document);var Noxum;
(function (Noxum) {
    (function (DyLoElementType) {
        DyLoElementType[DyLoElementType["Load"] = 0] = "Load";
        DyLoElementType[DyLoElementType["Submit"] = 1] = "Submit";
        DyLoElementType[DyLoElementType["Change"] = 2] = "Change";
        DyLoElementType[DyLoElementType["Click"] = 3] = "Click";
        DyLoElementType[DyLoElementType["Unknown"] = 4] = "Unknown";
    })(Noxum.DyLoElementType || (Noxum.DyLoElementType = {}));
    var DyLoElementType = Noxum.DyLoElementType;
    (function (DyLoDomOperation) {
        DyLoDomOperation[DyLoDomOperation["Replace"] = 0] = "Replace";
        DyLoDomOperation[DyLoDomOperation["After"] = 1] = "After";
        DyLoDomOperation[DyLoDomOperation["Before"] = 2] = "Before";
        DyLoDomOperation[DyLoDomOperation["Append"] = 3] = "Append";
        DyLoDomOperation[DyLoDomOperation["Prepend"] = 4] = "Prepend";
        DyLoDomOperation[DyLoDomOperation["Inner"] = 5] = "Inner";
    })(Noxum.DyLoDomOperation || (Noxum.DyLoDomOperation = {}));
    var DyLoDomOperation = Noxum.DyLoDomOperation;
})(Noxum || (Noxum = {}));
//# sourceMappingURL=dylo.interfaces.js.map
var Noxum;
(function (Noxum) {
    var DyLoHelper = (function () {
        function DyLoHelper() {
        }
        DyLoHelper.IsJquerySelector = function (value) {
            if (!value || value === "") {
                return false;
            }
            var firstChar = value[0];
            if (firstChar === "." || firstChar === "#" || firstChar === ":" || firstChar === ">") {
                return true;
            }
            if (value.indexOf(" ") >= 0 || value.indexOf(",") >= 0) {
                return true;
            }
            return false;
        };
        DyLoHelper.IsJsonString = function (value) {
            if (!value || value === "") {
                return false;
            }
            var firstChar = value[0];
            if (firstChar === "[" || firstChar === "{") {
                return true;
            }
            return false;
        };
        DyLoHelper.ExecuteCallback = function (callback, data, thisArg) {
            if (data === void 0) { data = undefined; }
            if (thisArg === void 0) { thisArg = undefined; }
            if (callback !== undefined && callback !== null) {
                if (data && !$.isArray(data))
                    data = [data];
                if (!$.isArray(callback)) {
                    callback.apply(thisArg, data);
                }
                else {
                    var callbackArray = callback;
                    for (var i = 0, length = callbackArray.length; i < length; i++) {
                        var cb = callbackArray[i];
                        if (cb)
                            cb.apply(thisArg, data);
                    }
                }
            }
        };
        DyLoHelper.CopyDimensions = function (source, target) {
            var height = source.height();
            var width = source.width();
            var marginT = parseInt(source.css("margin-top"));
            var marginB = parseInt(source.css("margin-bottom"));
            var marginL = parseInt(source.css("margin-left"));
            var marginR = parseInt(source.css("margin-right"));
            height = (height - (marginT + marginB));
            width = (width - (marginL + marginR));
            var position = source.css("position");
            if (position === "absolute" || position === "fixed") {
                var absolutT = parseInt(source.css("top"));
                var absolutB = parseInt(source.css("bottom"));
                var absolutL = parseInt(source.css("left"));
                var absolutR = parseInt(source.css("right"));
                if (!isNaN(absolutT) && !isNaN(absolutB)) {
                    height = (height - (absolutT + absolutB));
                }
                else {
                    if (!isNaN(absolutT)) {
                        height = (height - absolutT);
                    }
                    else if (!isNaN(absolutB)) {
                        height = (height - absolutB);
                    }
                }
                if (!isNaN(absolutL) && !isNaN(absolutR)) {
                    width = (width - (absolutL + absolutR));
                }
                else {
                    if (!isNaN(absolutL)) {
                        width = (width - absolutL);
                    }
                    else if (!isNaN(absolutR)) {
                        width = (width - absolutR);
                    }
                }
            }
            var paddingT = parseInt(source.css("padding-top"));
            var paddingB = parseInt(source.css("padding-bottom"));
            var paddingL = parseInt(source.css("padding-left"));
            var paddingR = parseInt(source.css("padding-right"));
            height = (height - (paddingB + paddingT));
            width = (width - (paddingL + paddingR));
            var pos = source.position();
            if (pos.top > 0) {
                var diff = source.offset().top - source.parent().offset().top;
                if (diff > 0) {
                    height = height - diff;
                }
                diff = source.offset().left - source.parent().offset().left;
                if (diff > 0) {
                    width = width - diff;
                }
            }
            target.css("width", width);
            target.css("height", height);
        };
        return DyLoHelper;
    })();
    Noxum.DyLoHelper = DyLoHelper;
})(Noxum || (Noxum = {}));
//# sourceMappingURL=dylo.helper.js.map
var Noxum;
(function (Noxum) {
    var DyLoFormHandler = (function () {
        function DyLoFormHandler() {
        }
        DyLoFormHandler.prototype.Submit = function (form, callback) {
            var me = this;
            var action = form.attr("action");
            var method = form.attr("method");
            var data = Noxum.DyLo.FormHandler.Serialize(form);
            $.ajax({
                url: action,
                type: method ? method : "GET",
                data: data,
                xhrFields: {
                    withCredentials: true
                },
                success: function (result, textStatus, xhr) {
                    callback({
                        Url: action,
                        Content: xhr.responseText,
                        Error: false,
                        StatusCode: xhr.status
                    });
                },
                error: function (xhr) {
                    Noxum.DyLo.Error("Fehler beim ausfuehren des Form Submit!", action);
                    callback({
                        Url: action,
                        Content: undefined,
                        Error: true,
                        StatusCode: xhr.status
                    });
                }
            });
        };
        DyLoFormHandler.prototype.Serialize = function (form) {
            return form.serializeArray();
        };
        return DyLoFormHandler;
    })();
    Noxum.DyLoFormHandler = DyLoFormHandler;
})(Noxum || (Noxum = {}));
//# sourceMappingURL=dylo.form.js.map
var Noxum;
(function (Noxum) {
    var DyLoModel = (function () {
        function DyLoModel(urlOrModel, options) {
            this._onLoadFunctions = [];
            this._loaded = false;
            this._runOnLoad = false;
            this._options = options;
            if (!urlOrModel) {
                this._loaded = true;
                return;
            }
            if ($.isFunction(urlOrModel.text)) {
                urlOrModel = urlOrModel.text();
            }
            if ($.isFunction(urlOrModel)) {
                this._object = urlOrModel;
                this._runOnLoad = true;
            }
            else if ($.isArray(urlOrModel) || $.isPlainObject(urlOrModel) || typeof (urlOrModel) === "object") {
                this._object = urlOrModel;
                this.TriggerOnLoad();
            }
            else if (typeof (urlOrModel) === "string" && urlOrModel.indexOf("{{") >= 0) {
                Noxum.DyLo.Error("Handlebars-Funktion als Model!", urlOrModel);
                this._loaded = true;
            }
            else if (Noxum.DyLoHelper.IsJsonString(urlOrModel)) {
                this.ParseJson(urlOrModel);
            }
            else {
                this.LoadFromUrl(options.ModelUrl, options.Caching);
            }
        }
        DyLoModel.prototype.LoadFromUrl = function (url, caching) {
            var me = this;
            $.ajax({
                url: url,
                cache: caching,
                dataType: "json",
                xhrFields: {
                    withCredentials: true
                },
                success: function (data) {
                    if ($.type(data) === "string") {
                        Noxum.DyLo.Error("Data-Model ist kein JSON!", url, data);
                    }
                    else {
                        me._object = data;
                    }
                    me.TriggerOnLoad();
                },
                error: function (e) {
                    if (e.status === 200) {
                        Noxum.DyLo.Error("Fehlerhaftes Data-Model!", url, e.responseText);
                    }
                    else {
                        Noxum.DyLo.Error("Fehler beim laden des Data-Model!", url);
                    }
                    me.TriggerOnLoad();
                }
            });
        };
        DyLoModel.prototype.ParseJson = function (jsonString) {
            var json;
            try {
                var str = jsonString.replace(/\/\/'/g, "\"");
                json = JSON.parse(str);
            }
            catch (e) {
                try {
                    str = jsonString.replace(/'/g, "\"");
                    json = JSON.parse(str);
                }
                catch (e) {
                }
            }
            if (json) {
                this._object = json;
            }
            this.TriggerOnLoad();
        };
        DyLoModel.prototype.TriggerOnLoad = function () {
            this._loaded = true;
            $.each(this._onLoadFunctions, function (i, cb) {
                cb();
            });
            this._onLoadFunctions = [];
        };
        Object.defineProperty(DyLoModel.prototype, "Object", {
            get: function () {
                return this._object;
            },
            enumerable: true,
            configurable: true
        });
        DyLoModel.prototype.OnLoad = function (callback) {
            var me = this;
            if (this._runOnLoad) {
                var func = this._object;
                func(function () {
                    me.TriggerOnLoad();
                });
            }
            if (this._loaded) {
                callback();
            }
            else {
                this._onLoadFunctions.push(callback);
            }
        };
        return DyLoModel;
    })();
    Noxum.DyLoModel = DyLoModel;
})(Noxum || (Noxum = {}));
//# sourceMappingURL=dylo.model.js.map
var Noxum;
(function (Noxum) {
    var DyLoView = (function () {
        function DyLoView(options, model, parents) {
            if (parents === void 0) { parents = []; }
            this.HasError = false;
            this.Model = null;
            this.Caching = false;
            var me = this;
            this.ViewUrl = options.ViewUrl;
            this.Parents = parents;
            this.Model = model;
            this.Caching = options.Caching;
            if (options.Caching) {
                $.each(DyLoView.PreCompiledTemplates, function (i, tpl) {
                    if (tpl.name === options.ViewUrl) {
                        me.Template = tpl.template;
                    }
                });
            }
            else {
                this.Template = null;
            }
        }
        DyLoView.prototype.Render = function (view, model, viewName) {
            var me = this;
            var preCompiledHandlebarView = view.indexOf("Handlebars.template({\"compiler\"") > 0;
            if ((model && model !== "") || preCompiledHandlebarView) {
                try {
                    var win = window;
                    if (!win.Handlebars) {
                        return view;
                    }
                    var template;
                    if (preCompiledHandlebarView) {
                        if (parseInt(Handlebars.VERSION) < 2) {
                            throw { message: "Your Handlebars version dosn´t support precompliled templates!" };
                        }
                        var jsPos = viewName.indexOf(".hbs");
                        var tmp = viewName.substr(0, jsPos);
                        var sep = tmp.indexOf("/");
                        var varName = tmp;
                        if (sep >= 0) {
                            varName = tmp.substr(sep + 1);
                        }
                        eval(view);
                        try {
                            template = eval(varName);
                        }
                        catch (e) {
                        }
                        if (!template) {
                            throw { message: "Missing precompiled template! (var " + varName + " = ...)" };
                        }
                    }
                    else {
                        template = Handlebars.compile(view);
                    }
                    return template(model);
                }
                catch (e) {
                    Noxum.DyLo.Error("Error while Handlebars-template!", viewName, undefined, e.message);
                    me.HasError = true;
                    return null;
                }
            }
            else {
                return view;
            }
        };
        DyLoView.prototype.ParentCheck = function () {
            var me = this;
            if (!Noxum.DyLo.RecursionProtection)
                return false;
            var result = false;
            $.each(me.Parents, function (i, parent) {
                if (parent === me.ViewUrl) {
                    result = true;
                }
            });
            return result;
        };
        DyLoView.prototype.Load = function (callback) {
            var me = this;
            if (!me.ParentCheck()) {
                var model = me.Model.Object;
                if (me.Template) {
                    callback(me.Template(model));
                    return;
                }
                if (me.ViewUrl.indexOf("#") === 0 || me.ViewUrl.indexOf(".") === 0) {
                    var viewElement = $(me.ViewUrl);
                    if (viewElement && viewElement.length > 0) {
                        callback(me.Render(viewElement.first().html(), model, me.ViewUrl));
                        return;
                    }
                }
                $.ajax({
                    url: me.ViewUrl,
                    cache: me.Caching,
                    type: "GET",
                    xhrFields: {
                        withCredentials: true
                    },
                    success: function (view) {
                        callback(me.Render(view, model, me.ViewUrl));
                    },
                    error: function (e) {
                        Noxum.DyLo.Error("Fehler beim laden des View-Templates!", me.ViewUrl);
                        me.HasError = true;
                        callback(null);
                    }
                });
            }
            else {
                Noxum.DyLo.Error("RecursionException!", me.ViewUrl);
                me.HasError = true;
                callback(null);
            }
        };
        DyLoView.prototype.GetParents = function () {
            var myParents = this.Parents.slice(0);
            myParents.push(this.ViewUrl);
            return myParents;
        };
        DyLoView.PreCompiledTemplates = [];
        return DyLoView;
    })();
    Noxum.DyLoView = DyLoView;
})(Noxum || (Noxum = {}));
//# sourceMappingURL=dylo.view.js.map
var Noxum;
(function (Noxum) {
    var DyLo = (function () {
        function DyLo(element, parent, model, forceLoad) {
            if (forceLoad === void 0) { forceLoad = false; }
            this.IsReady = false;
            this.OptionsError = false;
            this.ReadyCallbacks = [];
            this._successCallbacks = [];
            var me = this;
            if (parent) {
                me.Parent = parent;
            }
            this.$Context = $(element);
            this.$Form = this.$Context.parents("form").first();
            this.Model = undefined;
            if (this.$Context.data("dylo") === "false") {
                return;
            }
            this.Options = this.ReadOptions();
            if (forceLoad) {
                this.Options.Type = Noxum.DyLoElementType.Load;
            }
            if (this.Options.Type === Noxum.DyLoElementType.Submit) {
                if (!this.$Context.is("form") || (!this.Options.ViewUrl && !this.Options.SrcUrl && this.$Context.attr("action") === "")) {
                    this.OptionsError;
                }
            }
            else if ((!this.Options.ViewUrl && !this.Options.SrcUrl)) {
                this.OptionsError = true;
            }
            if (this.OptionsError) {
                return;
            }
            if (model) {
                this.Model = new Noxum.DyLoModel(model, this.Options);
            }
            if (this.Options.Type === Noxum.DyLoElementType.Submit) {
                this.$Form = this.$Context;
                this.$Context.submit(function (e) {
                    e.preventDefault();
                    var action = me.$Form.attr("action");
                    if (action && action !== "" && me.Options.ViewUrl) {
                        me.Model = new Noxum.DyLoModel(function (callback) {
                            DyLo.FormHandler.Submit(me.$Form, function (result) {
                                me.Model = new Noxum.DyLoModel(result.Content, me.Options);
                                callback();
                            });
                        }, me.Options);
                    }
                    me.Render();
                    return false;
                });
            }
            else if (this.Options.Type === Noxum.DyLoElementType.Load) {
                this.Render();
            }
            else if (this.Options.Type === Noxum.DyLoElementType.Change) {
                var saveOptions = $.extend({}, me.Options);
                this.$Context.change(function (e) {
                    var $formField = $(this);
                    var doRender = true;
                    if ($formField.is("select")) {
                        var $selectedValue = $formField.find(":selected");
                        if ($formField.val() !== "") {
                            me.Options = me.ReadOptionsFromElement($selectedValue, saveOptions);
                        }
                        else {
                            doRender = false;
                        }
                    }
                    if (doRender) {
                        me.Render();
                    }
                });
            }
            else {
                this.$Context.click(function (e) {
                    me.Render();
                    e.preventDefault();
                    return false;
                });
            }
            this.$Context.data("DyLo", this);
            $.each(DyLo._onInitCallbacks, function (i, callback) {
                callback(element);
            });
        }
        DyLo.Init = function () {
            var win = window;
            if (win.debug) {
                DyLo._debug = Boolean(win.debug);
            }
            if (win.Handlebars) {
                Handlebars.registerHelper("json", function (object) {
                    if (object) {
                        var json = JSON.stringify(object);
                        json = json.replace(/"/g, "//'");
                        return new Handlebars.SafeString(json);
                    }
                    else {
                        return "";
                    }
                });
            }
            DyLo.Parse($("body"));
            DyLo._isReady = true;
            Noxum.DyLoHelper.ExecuteCallback(DyLo._readyCallbacks);
        };
        DyLo.Ready = function (callback) {
            if (DyLo._isReady) {
                Noxum.DyLoHelper.ExecuteCallback(callback);
            }
            else {
                DyLo._readyCallbacks.push(callback);
            }
        };
        DyLo.Parse = function (context, callback, parent) {
            var elements = context.find("[data-dylo]");
            DyLo.Load(elements, parent, function (result) {
                if (callback) {
                    callback(result);
                }
            });
        };
        DyLo.Load = function (elements, parent, callback, model, forceLoad) {
            if (forceLoad === void 0) { forceLoad = false; }
            var maxCount = elements.length;
            if (maxCount === 0) {
                if (callback && $.isFunction(callback)) {
                    callback();
                }
                return;
            }
            var count = 0;
            var results = [];
            function done() {
                if (count === maxCount) {
                    if (callback && $.isFunction(callback)) {
                        callback($(results));
                    }
                }
            }
            elements.each(function (i, el) {
                var de = new DyLo(el, parent, model, forceLoad);
                if (de.Options.Type !== Noxum.DyLoElementType.Load || de.OptionsError) {
                    count++;
                    done();
                }
                else {
                    de.OnReady(function (result) {
                        count++;
                        if (result) {
                            result.each(function (i, el) {
                                results.push(el);
                            });
                        }
                        done();
                    });
                }
            });
        };
        DyLo.Error = function (title, url, model, message) {
            var error = { Title: title };
            if (message) {
                error.Message = message;
            }
            if (url) {
                error.Url = url;
            }
            if (model) {
                error.Model = model;
            }
            if (DyLo._debug && console && console.error && $.isFunction(console.error)) {
                console.error(title, error);
            }
            DyLo._errorMessages.push(error);
        };
        DyLo.OnInit = function (callback) {
            DyLo._onInitCallbacks.push(callback);
        };
        DyLo.OnLoad = function (callback) {
            DyLo._onLoadCallbacks.push(callback);
        };
        DyLo.OnSuccess = function (selector, callback) {
            DyLo.Ready(function () {
                $(selector).each(function (i, el) {
                    var dylo = $(el).data("DyLo");
                    if (dylo) {
                        dylo._successCallbacks.push(callback);
                    }
                });
            });
        };
        DyLo.BeforeLoad = function (callback) {
            DyLo._beforeLoadCallbacks.push(callback);
        };
        DyLo.OnError = function (callback) {
            DyLo._onErrorCallbacks.push(callback);
        };
        DyLo.prototype.ReadOptions = function (loadOnRender) {
            if (loadOnRender === void 0) { loadOnRender = false; }
            var parentDyLoTempContainer = this.$Context.parents(".DyLoTemp").first();
            var options = undefined;
            if (parentDyLoTempContainer.length === 0 || parentDyLoTempContainer.find(this.$Form).length === 1) {
                options = this.ReadOptionsFromElement(this.$Form, loadOnRender ? this.Options : undefined, loadOnRender);
            }
            options = this.ReadOptionsFromElement(this.$Context, options, loadOnRender);
            return options;
        };
        DyLo.prototype.ReadOptionsFromElement = function ($element, parentOptions, loadOnRender) {
            if (loadOnRender === void 0) { loadOnRender = false; }
            var result = {
                Type: Noxum.DyLoElementType.Unknown,
                Mode: Noxum.DyLoDomOperation.Replace,
                Target: this.$Context,
                IsEmptyElement: false,
                Caching: false
            };
            if (parentOptions) {
                result = $.extend({}, result, parentOptions);
            }
            if ($element.length === 0) {
                return result;
            }
            if (!loadOnRender) {
                var type = $element.attr("data-dylo");
                if (type && type !== "" || !result.Type) {
                    switch (type) {
                        case "load":
                            result.Type = Noxum.DyLoElementType.Load;
                            break;
                        case "change":
                            result.Type = Noxum.DyLoElementType.Change;
                            break;
                        case "click":
                            result.Type = Noxum.DyLoElementType.Click;
                            break;
                        case "submit":
                            result.Type = Noxum.DyLoElementType.Submit;
                            break;
                        default:
                            result.Type = Noxum.DyLoElementType.Unknown;
                            break;
                    }
                }
                var mode = $element.attr("data-dylo-mode");
                if (mode && mode !== "" || !result.Mode) {
                    switch (mode) {
                        case "inner":
                            result.Mode = Noxum.DyLoDomOperation.Inner;
                            break;
                        case "append":
                            result.Mode = Noxum.DyLoDomOperation.Append;
                            break;
                        case "prepend":
                            result.Mode = Noxum.DyLoDomOperation.Prepend;
                            break;
                        case "before":
                            result.Mode = Noxum.DyLoDomOperation.Before;
                            break;
                        case "after":
                            result.Mode = Noxum.DyLoDomOperation.After;
                            break;
                        case "replace":
                        default:
                            result.Mode = Noxum.DyLoDomOperation.Replace;
                            break;
                    }
                }
            }
            var update = $element.attr("data-dylo-update");
            if (update && update !== "") {
                if (update.indexOf(".") === 0) {
                    result.Target = this.Find(update, this.$Context);
                }
                else {
                    result.Target = $(update);
                }
            }
            result.IsEmptyElement = result.Target.is("br,hr,meta,link,base,img,embed,param,area,col");
            var viewUrl = $element.attr("data-dylo-view");
            if (viewUrl && viewUrl !== "") {
                if (viewUrl.indexOf("/") === 0) {
                    result.ViewUrl = viewUrl;
                }
                else {
                    result.ViewUrl = (result.ViewUrl ? result.ViewUrl : "") + viewUrl;
                }
            }
            var srcUrl = $element.attr("data-dylo-src");
            if (srcUrl && srcUrl !== "") {
                if (srcUrl.indexOf("/") === 0) {
                    result.SrcUrl = srcUrl;
                }
                else {
                    result.SrcUrl = (result.SrcUrl ? result.SrcUrl : "") + srcUrl;
                }
            }
            var modelurl = $element.attr("data-dylo-model");
            if (modelurl && modelurl !== "") {
                if (Noxum.DyLoHelper.IsJsonString(modelurl)) {
                    result.ModelUrl = modelurl;
                }
                else {
                    if (modelurl.indexOf("/") === 0) {
                        result.ModelUrl = modelurl;
                    }
                    else {
                        result.ModelUrl = (result.ModelUrl ? result.ModelUrl : "") + modelurl;
                    }
                }
            }
            if (!loadOnRender) {
                var clientModel = $element.attr("data-dylo-clientmodel");
                if (clientModel && clientModel !== "") {
                    result.ClientModel = clientModel;
                }
                var loadClass = $element.attr("data-dylo-load");
                if (loadClass && loadClass !== "") {
                    result.LoadClass = loadClass;
                }
                var errorClass = $element.attr("data-dylo-error");
                if (errorClass && errorClass !== "") {
                    result.ErrorClass = errorClass;
                }
                var successClass = $element.attr("data-dylo-success");
                if (successClass && successClass !== "") {
                    result.SuccessClass = successClass;
                }
                var caching = $element.attr("data-dylo-cache");
                if (caching && caching !== "") {
                    result.Caching = Boolean(caching);
                }
            }
            return result;
        };
        DyLo.prototype.Render = function () {
            var me = this;
            var options = me.Options;
            if (me.IsRender) {
                return;
            }
            me.$Context.trigger("Dylo-StartLoading");
            Noxum.DyLoHelper.ExecuteCallback(DyLo._beforeLoadCallbacks, me.$Context.get(0));
            me.IsRender = true;
            if (!(options.Type === Noxum.DyLoElementType.Unknown)) {
                if (options.Type === Noxum.DyLoElementType.Click) {
                    options = this.ReadOptions(true);
                }
                if (options.Target.selector !== "") {
                    options.Target = $(options.Target.selector);
                    if (options.Target.length === 0) {
                        DyLo.Error("Target not found! (" + options.Target.selector + ")");
                        return;
                    }
                }
                me.$Placeholder = $("<div id=\"dylo-placeholder-" + Math.random() + "\" class=\"dylo-placeholder\"/>");
                switch (options.Mode) {
                    case Noxum.DyLoDomOperation.Replace:
                        if (me.Options.LoadClass && me.Options.LoadClass !== "") {
                            if (DyLo.CopyDimensions) {
                                Noxum.DyLoHelper.CopyDimensions(me.Options.Target, me.$Placeholder);
                            }
                        }
                        else {
                            me.$Placeholder = options.Target;
                        }
                        break;
                }
                if (options.IsEmptyElement) {
                    switch (options.Mode) {
                        case Noxum.DyLoDomOperation.Before:
                            me.$Placeholder = me.$Placeholder.insertBefore(options.Target);
                            break;
                        case Noxum.DyLoDomOperation.Inner:
                        case Noxum.DyLoDomOperation.Prepend:
                        case Noxum.DyLoDomOperation.Append:
                        case Noxum.DyLoDomOperation.After:
                            me.$Placeholder = me.$Placeholder.insertAfter(options.Target);
                            break;
                        case Noxum.DyLoDomOperation.Replace:
                            if (!me.$Placeholder.is(options.Target)) {
                                me.$Placeholder = me.$Placeholder.insertAfter(options.Target);
                                options.Target.remove();
                            }
                            break;
                    }
                }
                else {
                    switch (options.Mode) {
                        case Noxum.DyLoDomOperation.Inner:
                            me.$Placeholder = me.$Placeholder.appendTo(options.Target);
                            break;
                        case Noxum.DyLoDomOperation.Append:
                            me.$Placeholder = me.$Placeholder.appendTo(options.Target);
                            break;
                        case Noxum.DyLoDomOperation.Prepend:
                            me.$Placeholder = me.$Placeholder.prependTo(options.Target);
                            break;
                        case Noxum.DyLoDomOperation.Before:
                            me.$Placeholder = me.$Placeholder.insertBefore(options.Target);
                            break;
                        case Noxum.DyLoDomOperation.After:
                            me.$Placeholder = me.$Placeholder.insertAfter(options.Target);
                            break;
                        case Noxum.DyLoDomOperation.Replace:
                            if (!me.$Placeholder.is(options.Target)) {
                                me.$Placeholder = me.$Placeholder.insertAfter(options.Target);
                                options.Target.remove();
                            }
                            break;
                    }
                }
                this.IsReady = false;
                this.StartLoading();
                this.LoadModel(function () {
                    me.$Context.trigger("Dylo-AfterLoadModel", [me.Model]);
                    if (options.Type === Noxum.DyLoElementType.Submit && !me.Model) {
                        DyLo.FormHandler.Submit(me.$Form, function (result) {
                            me.RenderResult(result.Content);
                        });
                    }
                    else if (me.Model && options.ViewUrl) {
                        var parents = [];
                        if (me.Parent && me.Parent.View && options.Type === Noxum.DyLoElementType.Load) {
                            parents = me.Parent.View.GetParents();
                        }
                        me.View = new Noxum.DyLoView(options, me.Model, parents);
                        me.View.Load(function (result) {
                            me.RenderResult(result);
                        });
                    }
                    else if (options.SrcUrl) {
                        $.ajax({
                            url: options.SrcUrl,
                            type: "GET",
                            xhrFields: {
                                withCredentials: true
                            }}).done(function (result) {
                            me.RenderResult(result);
                        }).fail(function (xhr) {
                            DyLo.Error("Fehler beim laden des Ergebnisses!", options.SrcUrl);
                            me.Done();
                        });
                    }
                    else {
                        me.Done();
                    }
                });
            }
            else {
                me.Done();
            }
        };
        DyLo.prototype.RenderResult = function (result) {
            var me = this;
            var options = me.Options;
            if (me.Options.Mode === Noxum.DyLoDomOperation.Inner) {
                me.$Placeholder.prevAll().remove();
            }
            me.$Context.trigger("Dylo-AfterLoadView", [result]);
            if (me.View && me.View.HasError) {
                me.ShowError();
            }
            if (!result || result == null) {
                me.Done();
                return;
            }
            var tmpId = "DyLoTemp";
            me.$Placeholder.append("<div class=\"" + tmpId + "\" style=\"display:none;\"></div>");
            var tmp = me.$Placeholder.find("> ." + tmpId);
            tmp.html(result);
            DyLo.Parse(tmp, function () {
                var $result = tmp.contents();
                me.$Context.trigger("Dylo-AfterLoadContent", [$result]);
                if (options.SuccessClass && options.SuccessClass !== "") {
                    $result.addClass(options.SuccessClass);
                }
                me.$Result = $result.replaceAll(me.$Placeholder);
                me.Done();
            }, me);
        };
        DyLo.prototype.Done = function () {
            var me = this;
            me.EndLoading();
            me.IsReady = true;
            me.IsRender = false;
            $.each(me.ReadyCallbacks, function (i, cb) {
                cb(me.$Result);
            });
            me.ReadyCallbacks = [];
            if (!me.Parent || me.Options.Type !== Noxum.DyLoElementType.Load) {
                var result = me.$Result ? me.$Result : $("");
                this.$Context.trigger("Dylo-Success", [this.$Context, result]);
                Noxum.DyLoHelper.ExecuteCallback(this._successCallbacks, [result]);
                Noxum.DyLoHelper.ExecuteCallback(DyLo._onLoadCallbacks, [me.$Context.get(0), result]);
            }
        };
        DyLo.prototype.StartLoading = function () {
            this.ChangePlaceholder(this.Options.LoadClass);
        };
        DyLo.prototype.EndLoading = function () {
            if (this.Options.LoadClass && this.Options.LoadClass !== "" && !Noxum.DyLoHelper.IsJquerySelector(this.Options.LoadClass)) {
                this.$Placeholder.removeClass(this.Options.LoadClass);
            }
        };
        DyLo.prototype.ShowError = function () {
            var me = this;
            this.EndLoading();
            this.ChangePlaceholder(this.Options.ErrorClass);
            if (this.Options.ErrorClass && this.Options.ErrorClass !== "" && Noxum.DyLoHelper.IsJquerySelector(this.Options.ErrorClass)) {
                this.$Placeholder.replaceWith(this.$Placeholder.children());
            }
            this.$Context.trigger("Dylo-Error");
            $.each(DyLo._onErrorCallbacks, function (i, cb) {
                cb(me.$Context.get(0), me.$Result);
            });
        };
        DyLo.prototype.ChangePlaceholder = function (selector) {
            if (selector && selector !== "") {
                if (Noxum.DyLoHelper.IsJquerySelector(selector)) {
                    var $copyMe = $(selector);
                    this.$Placeholder.html($copyMe.html());
                }
                else {
                    this.$Placeholder.addClass(selector);
                }
            }
        };
        DyLo.prototype.OnReady = function (callback) {
            if (this.IsReady) {
                callback(this.$Result);
            }
            else {
                this.ReadyCallbacks.push(callback);
            }
        };
        DyLo.prototype.Find = function (jquerySelector, context) {
            var result = context.find(jquerySelector);
            if (result.length === 0) {
                result = context.nextAll(jquerySelector);
            }
            if (result.length === 0) {
                if (context.is("body")) {
                    DyLo.Error("Element not found! Selector: " + jquerySelector);
                }
                else {
                    var parent = context.parent();
                    if (parent.is(jquerySelector)) {
                        result = parent;
                    }
                    if (result.length === 0) {
                        result = this.Find(jquerySelector, parent);
                    }
                }
            }
            return result.first();
        };
        DyLo.prototype.LoadModel = function (callback) {
            var me = this;
            var json = undefined;
            if (me.Model) {
                me.Model.OnLoad(callback);
                return;
            }
            if (this.Options.ClientModel && this.Options.ClientModel !== "") {
                try {
                    var tmp = eval(this.Options.ClientModel);
                    if (tmp && ($.isPlainObject(tmp) || $.isArray(tmp) || typeof (tmp) === "object")) {
                        this.Model = new Noxum.DyLoModel(tmp, this.Options);
                    }
                    callback();
                    return;
                }
                catch (e) {
                    DyLo.Error("Error while parsing clientmodel! Attribute value: " + me.Options.ClientModel);
                }
            }
            ;
            if (this.Options.ModelUrl && this.Options.ModelUrl !== "") {
                me.Model = new Noxum.DyLoModel(this.Options.ModelUrl, this.Options);
                me.Model.OnLoad(callback);
            }
            else {
                callback();
            }
        };
        DyLo.Version = "1.5.2";
        DyLo.Caching = false;
        DyLo.CopyDimensions = false;
        DyLo.RecursionProtection = true;
        DyLo.FormHandler = new Noxum.DyLoFormHandler();
        DyLo._debug = false;
        DyLo._errorMessages = [];
        DyLo._onInitCallbacks = [];
        DyLo._onLoadCallbacks = [];
        DyLo._beforeLoadCallbacks = [];
        DyLo._onErrorCallbacks = [];
        DyLo._readyCallbacks = [];
        DyLo._isReady = false;
        return DyLo;
    })();
    Noxum.DyLo = DyLo;
})(Noxum || (Noxum = {}));
(function ($) {
    $.fn.dylo = function (model, callback) {
        if ($.isFunction(model)) {
            callback = model;
            model = undefined;
        }
        Noxum.DyLo.Load($(this), null, callback, model, true);
    };
})(jQuery);
$(document).ready(function () {
    Noxum.DyLo.Init();
});
//# sourceMappingURL=dylo.js.map
$("#formdyloeventreceiver").bind("Dylo-StartLoading", function (event, element, result) {
    //window.console.info("DyloForm: Laden startet.");
    $("#formdyloeventreceiver div.loading:first").css("visibility", "visible");
});
$("#formdyloeventreceiver").bind("Dylo-AfterLoadView", function (event, element, result) {
    console.log("DyloForm: Laden endet.");
    $("#formdyloeventreceiver div.loading:first").css("visibility", "hidden");
});
$("#formdyloeventreceiver").bind("Dylo-AfterLoadContent", function (event, element, result) {
    // init select2 Dropdowns
    initCustomDropDownSelect();
    if(typeof(initForm) == 'function') {
        initForm();
        $('.Required > label').each(function () { jQuery(this).text(jQuery(this).text() + ' *'); });
    }
});

; (function ($, window, document, undefined) {
  'use strict';

  var rs_ImageScaler = (typeof (ScaleHandler) === 'function') ? new ScaleHandler() : null;
  var $techdataClaim = null;
  var soundPlayingSliderId;

  ////////////////////
  //
  // from docs:
  //
  //slider.currSlideId // current slide index
  //slider.currSlide // current slide object
  //slider.numSlides // total number of slides
  //slider.slides // array, contains all data about each slide
  //slider.slidesJQ // array, contains list of HTML slides that are added to slider
  ////////////////////

  function injectTechdataClaim($claim) {
    if(typeof $claim === 'undefined') {
      $claim = $('');
    }
    var $pageIntro = $('.b-page-wrapper > .m-04-intro-section-home-slider-wrapper').eq(0);

    // >> check if individual model data needs to be shown
    var modelid = $pageIntro.attr('data-modelid');
    if((typeof modelid !== 'undefined') && modelid !== '') {
      var modelyear = $pageIntro.attr('data-modelyear');
      var model = _.findWhere(window.modelData.models, {"id": modelid, "year": modelyear});
      $claim = $(model.techdataModelClaim);
    }
    // <<

    // >> check if only price must be show
    var patt = /(uk|france|italy|spain|portugal|russia|swiss|eastern-europe|belgium|netherlands|luxembourg|turkey|international|germany|pcb|pch)/i;
    if (patt.test(GLOBAL_CONFIG.pool) === true) {
      $claim.find('.m-60-data-item:not(.m-60-data-item--price)').remove();
    }
    // <<

    if($claim.length > 0) {
      //console.log('on::techdataClaim-available = ' + $techdataClaim);
      $pageIntro.find('.m-04-intro-section-slide-img .m-04-intro-section-slide-text').remove();
      $pageIntro.find('.m-04-intro-section-slide-img').append($claim);
    }
  }

  function initHomeSlider() {
    var sliderHome = $('.m-04-intro-section-home-slider');
    var maxSlideCountInIE8 = 5;
    var isIE8 = ($('html.lt-ie9').length > 0);
    var showArrows = true,
        currentSlideCount = 0;

    $techdataClaim = $('');

    $(document).on('techdataClaim-available', function (event, data) {

      $techdataClaim = $(data.claim); // model series data
      injectTechdataClaim($techdataClaim);

    });

    if (sliderHome.length) {

      sliderHome.each(function (index) {

        var $this = $(this);
        currentSlideCount = $this.find('.m-04-intro-section-slide').length;

        $this.royalSlider({
          controlNavigation: (currentSlideCount > 1 ? 'bullets' : 'none'),
          autoScaleSlider: false,
          autoHeight: true,
          triggerGlobalReady: true,
          controlsInside: false,
          allowCSS3: true,

          loop: true,

          numImagesToPreload: 20,
          navigateByClick: false,
          sliderDrag: false,

          arrowsNav: (currentSlideCount <= 1) ? false : true,
          arrowsNavAutoHide: true,
          arrowsNavHideOnTouch: true,

          keyboardNavEnabled: false,

          globalCaption: false,

          slidesSpacing: 0,
          transitionSpeed: 1200,
          transitionType: 'move',
          easeInOut: 'easeInOutSine',
          easeOut: 'easeInOutSine',

          autoPlay: {
            // autoplay options go gere
            enabled: true,
            pauseOnHover: true,
            delay: 6000,
            stopAtAction: true
          }
        });

        // get slider instance
        var curSlider = $this.data('royalSlider');

        // preaload the first set of images on init
        _initSliderImages(curSlider);

        // add click handler to whole slide instead of only the claim
        $this.find('.m-04-intro-section-slide-img').each(function () {
          var $slideImage = $(this);
          var $slideLink = $slideImage.find('a[href]');
          if ($slideLink.length < 1) {
            return true;
          }

          $slideImage.find('img').data('href', $slideLink.attr('href'));

          $slideLink.on('click', function () {
            var href = $(this).attr('href');

            TRACKING && TRACKING.event(
              'interaction',
              'open',
              'm-04_' + index + TRACKING.LABEL_SEPARATOR + TRACKING.HELPER.labelByURL(href)
            );
          });

          $slideImage.find('img').on('click', function () {
            var href = $(this).data('href');

            TRACKING && TRACKING.event(
              'interaction',
              'open',
              'm-04_' + index + TRACKING.LABEL_SEPARATOR + TRACKING.HELPER.labelByURL(href)
            );

            document.location.href = $(this).data('href');
          })
              .css({'cursor': 'pointer'});
        });



        // preload event handelers
        curSlider.ev.on("rsAfterSlideChange", function (e) {

          //console.log('on::rsAfterSlideChange = ' + $techdataClaim);

          if ($this.parent().parent().children().attr('id') === soundPlayingSliderId) {
            if ($('.jp-audio.jp-state-playing').length > 0)
              $('.jp-audio.jp-state-playing').parent().find(".jp-jplayer").data("jPlayer").pause();
          }

          // fires when every time when slide content is loaded and added to DOM
          initJPlayer();

          _initSliderImages(curSlider);

          if(TRACKING)
          {
              var lastAction = $this.data('lastAction');
              var lastSlideId = $this.data('lastSlideId');

              if(lastSlideId !== e.target.currSlideId)
              {

                if (lastAction === 'none' && e.target.dragSuccess === true)
                {
                    lastAction = 'swipe';
                }

                if (lastAction !== 'none')
                {
                    TRACKING.event(
                        'interaction',
                        lastAction,
                        'm-04_' + index // + TRACKING.LABEL_SEPARATOR + e.target.currSlideId
                    );
                    $this.data('lastAction', 'none');
                }

                $this.data('lastSlideId', e.target.currSlideId);

              }
          }

        });

        $this.find($('.rsNav')).insertAfter($(this));

        if(TRACKING)
        {
          $this.data('lastAction', 'none');
          $this.parent().find('.rsArrow, .rsBullet').on('click', function () {
            var $el = $(this);
            switch (true)
            {
              case $el.hasClass('rsArrowRight'):
                $this.data('lastAction', 'next');
                break;
              case $el.hasClass('rsArrowLeft'):
                $this.data('lastAction', 'prev');
                break;
              case $el.hasClass('rsBullet'):
                $this.data('lastAction', 'jump');
                break;
            }
          });
        }

        window.setTimeout(_initFirstSliderImage, 100);
      });
    }
  }

  function _initFirstSliderImage() {
    $('.m-04-intro-section-home-slider').each( function(){
      var curSlider = $(this).data('royalSlider');
      var $preloadSlide = $(curSlider.slides[0].content);
      _initImage($preloadSlide);
    });
  }

  function _initTechdataClaim($preloadSlide) {
    if ($techdataClaim.length != 0) {
      $preloadSlide.find('.m-04-intro-section-slide-img').each(function () {

        var $slideImageCnotainer = $(this);

        if ($slideImageCnotainer.find('.m-04-shadow-gradient-bottom').length == 0) {
          $slideImageCnotainer.find('m-04-intro-section-slide-text').remove();
          $slideImageCnotainer.append($techdataClaim);
        }
      });
    }
  }
  function _initImage($preloadSlide) {
    $preloadSlide.find('img[data-image-src]').each(function () {
      var $el = $(this);
      var scaleParam = rs_ImageScaler.getScaleParameter($el);
      rs_ImageScaler.replaceSource($el, $el.attr('data-image-src'), scaleParam);
    });
  }

  function _initSliderImages(curSlider) {
    // after slider is initialized,
    // use single image preloading if new scaler is avbailable
    if (rs_ImageScaler !== null) {

      //console.log('m04::init::Preloading::setTimeout');
      //console.log('m04::init::Preloading::Callback');

      var lastSlide = (curSlider.slides.length > 0) ? curSlider.slides.length - 1 : 0;
      var prevSlide = (curSlider.currSlideId > 0) ? curSlider.currSlideId - 1 : lastSlide;
      var nextSlide = (curSlider.currSlideId === lastSlide) ? 0 : curSlider.currSlideId + 1;
      var currentSlide = curSlider.currSlideId;

      for (var i = 0; i < curSlider.slides.length; i++) {
        if ((i === prevSlide) || (i === currentSlide) || (i === nextSlide)) {

          //console.log('on::rsAfterSlideChange::scaleSlideImage(' + i + ')');

          var $preloadSlide = $(curSlider.slides[i].content);

          _initImage($preloadSlide);
          _initTechdataClaim($preloadSlide);

        }
      }
    }
    else {
      // haesslicher workaround, damit slides > 3 vorgeladen und korrekt skaliert werden
      // kein techdata claim handling für alte seiten ohne image scaler
      scaleSliderImages();
    }
  }

  function initJPlayer() {

    var jPlayers = $('.m-04-intro-section-home-slider .jp-jplayer:not([id])');

    if (jPlayers.length > 0) {
      jPlayers.each(function (index) {
        var randomID = Math.round(new Date().getTime() + (Math.random() * 100)),
            $player = $(this);

        $player.attr("id", "jp-player-" + randomID);

        var jPlayerContainer = $player.siblings('.jp-audio');
        jPlayerContainer.attr("id", "jp-audio-" + randomID);


        $player.on('play', function () {
          $player.parents('.m-04-intro-section-slide').find('.m-04-intro-section-slide-videoclaim').addClass('playing');
        });
        $player.on('ended', function () {
          $player.parents('.m-04-intro-section-slide').find('.m-04-intro-section-slide-videoclaim').removeClass('playing');
        });

        $player.jPlayer({
          //$('#jplayer1').jPlayer({
          ready: function () {

            $player.jPlayer("setMedia", {
              title: jPlayerContainer.attr("data-title"),
              m4a: jPlayerContainer.attr("data-m4a"),
              oga: jPlayerContainer.attr("data-ogg") //,
              //mp3: jPlayerContainer.attr("data-mp3")
            });
          },
          play: function () { // To avoid multiple jPlayers playing together

            $player.jPlayer("pauseOthers");
            $player.closest(".m-04-intro-section-slide").addClass("jp-state-playing");

            // stop RoyalSlider Autoplay
            var parentSlider = $player.closest(".m-04-intro-section-home-slider").data('royalSlider');
            parentSlider.stopAutoPlay();
            soundPlayingSliderId = $("#" + $('.jp-audio.jp-state-playing').attr('id')).closest('.b-standard-module').children().attr('id');

          },
          pause: function () {
            $player.closest(".m-04-intro-section-slide").removeClass("jp-state-playing");

          },

          //swfPath: "http://lu-krativ:8080/production/prototype/modules/04-intro-section/assets",
          swfPath: "/all/media/flash",
          solution: "flash, html",
          //solution: "html",

          //supplied: "mp3, m4a, oga",
          supplied: "m4a, oga",
          cssSelectorAncestor: '#' + jPlayerContainer.attr("id"),
          wmode: "window",
          globalVolume: true,
          useStateClassSkin: true,
          autoBlur: false,
          smoothPlayBar: true,
          keyEnabled: true,
          errorAlerts: false
        });
      });

      $(".jp-title").click(function () {
        $player.closest(".jp-audio").find(".jp-play").trigger("click");
      });

    }
  }

  function initVimeoPlayer($el){
    var $vimeoVideos = $el.find('.video-vimeo');

    if ($vimeoVideos.length > 0)
    {
      /*
      if ($el.find('.m-04-intro-section-slide').length === $vimeoVideos.length)
      {
          $el.addClass('m-04__hasVimeoVideoOnly');
      }
      //*/

      $vimeoVideos.each(function (i, el) {

        var $vimeoVideo = $(el);

        new window.ContentElements.VideoVimeo(
            {
              el: $vimeoVideo,
              settings: {
                // autoplay: true
              }
            }
        );

        $vimeoVideo.on('play', function () {
          $el.find('.m-04-intro-section-slide-videoclaim').addClass('playing');
        });
        $vimeoVideo.on('ended', function () {
          $el.find('.m-04-intro-section-slide-videoclaim').removeClass('playing');
        });

      });
    }
  }

  function _lazyInit() {
    var moduleSelector = [
          '.m-04-intro-section-home-slider-wrapper',
          '.m-04-intro-section-model-slider-wrapper'
        ],
        $elements = $(moduleSelector.join(', '));


    $elements.each(function (i, el) {
      var $el;

      $el = _getFirstRootElementOnPage(el);

      if($el !== false && $el.length === 1)
      {
        if (window.pageController) {
          $el.one(window.pageController.eventNames.lazyInit, function () {
            _init($(el));
            window.pageController.refresh();
          });
        }
        else {
          _init($(el));
        }
      }
    });
  }

  function _getFirstRootElementOnPage(el)
  {
    var $innerEl,
        $outerEl,
        returnValue = false;

    $innerEl = $(el);

    if ($innerEl.length > 0)
    {
      $outerEl = $innerEl.parents('.b-standard-module');
      switch (true)
      {
        case ($innerEl.parents('.m-130').length > 0):
          // Exclude m-130 -> This module is doing it on his own.
          returnValue = false;
          break;
        case $outerEl.length > 0:
          // Found root.
          returnValue = $outerEl;
          break;
        default:
          // Is root, probably.
          returnValue = $innerEl;
          break;

      }
    }
    return returnValue;
  }

  function _init($el) {
    initHomeSlider();
    initJPlayer();
    initVimeoPlayer($el);
  }

  var ajax_url;
  $( document ).ajaxSuccess(function( event, request, settings ) {
    ajax_url = settings.url;
    if(ajax_url.search("load_banner_model") > 0)
    {
      initHomeSlider();
    }
  });

  //$( window ).load( function () {
  $(document).ready(function () {

    _lazyInit();

    $(document).on("m04_loaded", function () {
      _lazyInit();
      injectTechdataClaim();
    });

  });
})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
  'use strict';

  var moduleClass = 'm-132',
      ModuleView,
      moduleInstances = [];

  $(document).ready(function () {

    if(GLOBAL_CONFIG && GLOBAL_CONFIG.pool == 'uk') {
      _removeModule();
      return false;
    }

    _lazyInit();
  });

  function _removeModule() {
    $('.' + moduleClass).each(function (i, el) {
      var $el = $(el);
      var $lazyParent = _getLazyRoot($el);
      $lazyParent.remove();
    });
  }


  function _lazyInit(reInit) {
    reInit = (reInit === true);

    $('.' + moduleClass).each(function (i, el) {

      var $el = $(el);
      var $lazyParent = _getLazyRoot($el);

      if (reInit === false && window.pageController) {
        $lazyParent.one(window.pageController.eventNames.lazyInit, function () {
          _init(i, $el);
          window.pageController.refresh();
        });
      }
      else {
        _init(i, $el, reInit);
      }

    });
  }

  function _init(i, $el, reInit) {

    var dynmodReloaded = $el.attr('data-dynmod-reloaded'),
        modelData = $el.data('model'),
        model = new Backbone.Model(modelData ? modelData : {});

    if (reInit && dynmodReloaded !== 'true') {
      return;
    }

    moduleInstances[i] = new ModuleView({
      el: $el,
      model: model
    });

    moduleInstances[i].render();
    $el.attr('data-dynmod-reloaded', 'false');

  }
  function _getLazyRoot($el)
  {
    var $innerEl,
        $outerEl;

    $innerEl = $el;
    if ($innerEl.length > 0)
    {
      $outerEl = $innerEl.parents('.b-standard-module');
      if ($outerEl.length > 0)
      {
        return $outerEl;
      }
    }
    return $innerEl;
  }
  ModuleView = ModuleBaseView.extend({
    events: {},

    // add only backbone instance variables here

    initialize: function (options) {
      ModuleBaseView.prototype.initialize.apply(this, [options]);

      // documentation: http://backbonejs.org/#View
      // init instance variables here
      // e.g. this.variable = 'string'
    },

    render: function () {
      ModuleBaseView.prototype.render.apply(this, arguments);

      // start point - render/update module here
      $('<script src="' + this.model.attributes.scripturl + '" />').insertAfter($(this.el).find(this.model.attributes.widgetid));
    },

    _privateFunction: function () {
      // do stuff
    },

    destroy: function () {
      ModuleBaseView.prototype.destroy.apply(this, arguments);

      // destroy module here
    }
  });

})(jQuery, this, this.document);;
(function ($, window, document, undefined) {
    'use strict';

    var moduleClass = 'm-164-model-selector',
        ModuleView,
        moduleInstances = [],
        scrollerClone = null;

    $(document).ready(function () {
        _lazyInit();
    });

    $(document).on('dynmod_loaded', function () {
        _lazyInit(true);
    });

    function _lazyInit(reInit)
    {
        reInit = (reInit === true);

        $('.' + moduleClass).each(function (i, el) {

            var $el = $(el);

            if (reInit === false && window.pageController)
            {
                $el.one(window.pageController.eventNames.lazyInit, function () {
                    _init(i, $el);
                    window.pageController.refresh();
                });
            }
            else
            {
                _init(i, $el, reInit);
            }

        });
    }

    function _init(i, $el, reInit)
    {

        var dynmodReloaded = $el.attr('data-dynmod-reloaded'),
            modelData = $el.data('model'),
            model = new Backbone.Model(modelData ? modelData : {});

        if (reInit && dynmodReloaded !== 'true')
        {
            return;
        }

        moduleInstances[i] = new ModuleView({
            el: $el,
            model: model
        });

        moduleInstances[i].render();
        $el.attr('data-dynmod-reloaded', 'false');

    }


    ModuleView = ModuleBaseView.extend({
        cssClasses: {
            modelSelector: "m-164-model-selector",
            slider: "m-164__slider",
            sliderItem: "m-164__slider-item",
            sliderImage: "m-164__slider-image",
            modelName: "m-164__model-name",
            icon360: "m-164__icon-360",

            cloneWrapper: "m-164__model-selector-clone",
            activeSlide: "m-164--actives",

            prevArrow: "m-164-heading-slider-prev",
            nextArrow: "m-164-heading-slider-next",

            cnTitle: "m-164-cn-title",
            m72dockButton: "m-72-cn-dock-button",
            m72dockButtonContent: "m-72-cn-dock-button-content"
        },

        eventNamespace: "m-164",

        events: {},

        // add only backbone instance variables here

        initialize: function (options) {
            ModuleBaseView.prototype.initialize.apply(this, [options]);

            this._registerUiElements();
            this._bindEvents();
            this._scaleImages();
            this._referenceCloneElements();
            this._createSlider();
        },

        render: function () {
            ModuleBaseView.prototype.render.apply(this, arguments);

            // start point - render/update module here
        },

        _registerUiElements: function () {
            this.$slider = $("." + this.cssClasses.slider).eq(0);
            this.$sliderItem = this.$slider.find("." + this.cssClasses.sliderItem);
            this.$modelSelector = $("." + this.cssClasses.modelSelector);
            this.$icon360 = $("." + this.cssClasses.icon360);

            this.$modelSelectorClone = null;
            this.$sliderClone = null;
            this.$sliderItemClone = null;

            this.$prevArrow = $("." + this.cssClasses.prevArrow);
            this.$nextArrow = $("." + this.cssClasses.nextArrow);

            this.$m72dockButton = $("." + this.cssClasses.m72dockButton).eq(0);
            this.$m72dockButtonContent = $("." + this.cssClasses.m72dockButtonContent).eq(0);
        },

        _bindEvents: function () {
            var _self = this;

            // events for main slider items
            this.$sliderItem.on("click", function (e) {
                var $el = $(e.currentTarget)
                    , dynmod = $el.attr("data-dynmod") ? $el.attr("data-dynmod") : ""
                    , url = $el.attr("data-dynmod-url") ? $el.attr("data-dynmod-url") : ""
                    , newPageTitle = $el.find(".m-164__model-name").text();

                // check if the current slide is not already active, then load stuff
                // else you do an unnecessary load
                if (!$el.hasClass(_self.cssClasses.activeSlide))
                {
                    _self._synchSlider(e, _self);
                    _self._loadNewContent(dynmod, url, newPageTitle);
                }
            });

            $(document).on("modelselection_dock", function (e, data) {
                _self._onDockEvent(e, data);
            });

            _self.hideDockAfterChange == true;
            this.$slider.on("afterChange", function (slick, currentSlide) {
                _self._checkContentNavArrows(_self);
                _self._onMobileSlideChange(_self);
                if(_self.hideDockAfterChange) {
                    _self.$m72dockButton.trigger('click');
                }
                else {
                    _self.hideDockAfterChange = true;
                }
            });


            // arrow in content nav controls binding
            this.$prevArrow.on("click", function (e) {
                _self.hideDockAfterChange = false;
                _self._synchSlider(e, _self);
            });
            this.$nextArrow.on("click", function (e) {
                _self.hideDockAfterChange = false;
                _self._synchSlider(e, _self);
            });

            $(document).on('MatchMediaQuery_match', function (e, data) {
                _self._toggleBetweenSliderAndIscroll(data, _self);
            });

            // 360 icon go to intro button
            this.$icon360.on("click", function () {
                TweenMax.to(window, 1, {scrollTo: $("#intro").get(0)});
            });
        },

        // end binding

        ////////////////////
        // start functions
        ///////////////////

        _createSlider: function () {
            var sliderOptions = {
                    arrows: false,
                    centerMode: false, //needed to center active slide
                    infinite: false,
                    dots: true,
                    dotsClass: "m-164__slider-dots",
                    mobileFirst: true,
                    focusOnSelect: true,
                    variableWidth: true,
                    slidesToShow: 1,
                    slidesToScroll: 1,
                    responsive: [
                        {
                            breakpoint: 767,
                            settings: {
                                slidesToShow: 1,
                                arrows: true,
                                dots: false,
                                centerMode: false
                            }
                        },
                        {
                            breakpoint: 1200,
                            settings: {
                                slidesToShow: 1,
                                arrows: true,
                                dots: false,
                                centerMode: false
                            }
                        }
                    ]
                },
                activeUrlParts,
                activeIndex = 0,
                highestUrlPartsScore = 0;

            // Read current url to set active index
            activeUrlParts = (location.pathname || '').replace(/(^\/|\/$)/g, '').split('/');
            // Read active index by checking slider items url
            this.$sliderItem.each(function (elIndex, el) {
                var elUrlParts,
                    urlPartScore = 0,
                    j;

                // Read model url and split
                elUrlParts = ($(el).data('dynmod-url') || '').replace(/(^\/|\/$)/g, '').split('/');

                for (j = 0; j < elUrlParts.length; j++)
                {
                    // Compare url parts
                    if (activeUrlParts[j] === elUrlParts[j])
                    {
                        // update score
                        urlPartScore++;
                    } else
                    {
                        // break
                        break;
                    }
                }

                // compare score with former
                if (urlPartScore > highestUrlPartsScore)
                {
                    // set current highscore
                    highestUrlPartsScore = urlPartScore;
                    // set current index
                    activeIndex = elIndex;
                }

                // Break model loop on highest possible score
                if (highestUrlPartsScore === activeUrlParts.length)
                {
                    // break;
                    return false;
                }

            });

            // Set active Index
            sliderOptions.initialSlide = activeIndex;

            // 480px, 768px, 992px, 1200px
            this.$slider.slick(sliderOptions);
            this.$sliderItem.eq(activeIndex).addClass(this.cssClasses.activeSlide);

        },

        _scaleImages: function () {
            var imageScaler = new ScaleHandler()
                , _self = this;

            this.$sliderItem.each(function () {
                var $image = $(this).find("." + _self.cssClasses.sliderImage)
                    , scaleParam = imageScaler.getScaleParameter($image);

                imageScaler.replaceSource($image, $image.attr('data-image-src'), scaleParam);
            });
        },

        _referenceCloneElements: function () {
            // this creates the markup for the clone
            // use after image scaler to not having empty img src and prevent loading images again after on dock

            var $clonedModelSelector = this.$modelSelector.clone()
                .prop("id", "modelSelectorClone") // change id, otherwise content nav go to doesnt work
                .removeAttr("data-dock-event") // remove data attributes to prevent future problems
                .removeAttr("data-module-name")
                .removeAttr("data-m-02-cn-anchor");

            this.$modelSelectorClone = $('<div class="' + this.cssClasses.cloneWrapper + '">').append($clonedModelSelector);
            this.$sliderClone = this.$modelSelectorClone.find("." + this.cssClasses.slider);
            this.$sliderItemClone = this.$modelSelectorClone.find("." + this.cssClasses.sliderItem);
        },


        // --------------------------------------
        // model switch and content navi stuff
        // --------------------------------------
        // put the active model name into the content nav
        _setModelNameInContentNavi: function (_self) {
            if (_self === undefined)
            {
                _self = this;
            }
            _self.$m72dockButtonContent
                .empty()
                .append(_self._getModelNameInContentNavi(_self));
        },

        _getModelNameInContentNavi: function (_self) {
            if (_self === undefined)
            {
                _self = this;
            }
            var $activeSlide = _self.$slider.find(".m-164--active");

            return $('<div class="' + this.cssClasses.cnTitle + '">' + $activeSlide.find("." + this.cssClasses.modelName).eq(0).text() + '</div>');
        },

        // docking stuff
        // listens to event from content navi
        _onDockEvent: function (evt, data) {
            var _self = this;
            switch (data.type)
            {
                case 'dock':
                    // console.log('DOCK');
                    $(document).trigger(data.responseEventName, {
                        responseId: data.responseId,
                        $buttonContent: this._getModelNameInContentNavi(this), // modelname in content navi
                        $dockContent: this.$modelSelectorClone, // content to be cloned into content navi
                        dockAnchor: this.$modelSelector.next().eq(0) // point when dock button is visible
                    });
                    break;
                case 'undock':
                    // console.log('UNDOCK');
                    this._disableSliderClone();
                    this._disableScrollerClone();
                    break;
                case 'active':
                    // Aufruf nach erfolgreichem andocken
                    this._toggleBetweenSliderAndIscroll();
                    this._checkContentNavArrows();
                    // console.log('ACTIVE');
                    break;
                case 'opened':
                    // console.log("OPENED");
                    this._refreshSliderClone(); // jump to active slide in slider when opening cn
                    break;
                case 'closed':
                    // console.log('CLOSED');
                    break;
            }
        },

        // get called by mq change and when cn is docking
        _toggleBetweenSliderAndIscroll: function (viewport, _self) {
            if (viewport === undefined)
            {
                viewport = matchMediaQuery.getCurrentMediaQuery();
            }
            if (_self === undefined)
            {
                _self = this;
            }

            if (viewport.pos >= 0)
            { // set to 2, when they want to have the iScroller D:
                _self._disableScrollerClone();
                _self._enableSliderClone();
            }
            else
            {
                _self._disableSliderClone();
                _self._enableScrollerClone();
            }
        },

        _enableSliderClone: function () {
            var _self = this
                , currentSlideIndex = this.$slider.slick("slickCurrentSlide")
                , cloneSlideOptions = {
                arrows: false,
                centerMode: false, //needed to center active slide
                infinite: false,
                dots: false,
                dotsClass: "m-164__slider-dots",
                mobileFirst: true,
                initialSlide: currentSlideIndex,
                focusOnSelect: false,
                variableWidth: true,
                slidesToShow: 1,
                slidesToScroll: 1,
                responsive: [
                    // {
                    //   breakpoint: 480,
                    //   settings: {
                    //     slidesToShow: 1,
                    //     arrows: false,
                    //     dots: false,
                    //     variableWidth: true,
                    //     centerMode: false,
                    //   }
                    // },
                    {
                        breakpoint: 767,
                        settings: {
                            slidesToShow: 1,
                            arrows: false,
                            dots: false,
                            variableWidth: true,
                            centerMode: false,

                        }
                    },
                    {
                        breakpoint: 1200,
                        settings: {
                            slidesToShow: 1,
                            arrows: false,
                            dots: false,
                            variableWidth: true,
                            centerMode: false,
                        }
                    }
                ]
            };

            // check if it is already initialized
            if (this.$sliderClone.hasClass('slick-initialized'))
            {
                this.$sliderClone.slick("slickGoTo", currentSlideIndex);
                this.$sliderClone.slick("setPosition");
                return;
            }

            // init slider
            this.$sliderClone
                .slick(cloneSlideOptions)
                .slick("setPosition");

            // set active class
            this.$sliderItemClone.removeClass(this.cssClasses.activeSlide);
            this.$sliderItemClone.eq(currentSlideIndex).addClass(this.cssClasses.activeSlide);

            // get mouse x, to determine click and swipe on slide
            var mouseXBefore = null
                , mouseXAfter = null;
            // events for clone slider items
            this.$sliderItemClone.on("mousedown.m164", function (e) {
                mouseXBefore = e.clientX;

            }).on("mouseup.m164", function (e) {
                mouseXAfter = e.clientX;
                var difference = Math.abs(mouseXBefore - mouseXAfter);

                if (difference <= 10)
                {
                    var $el = $(e.currentTarget)
                        , dynmod = $el.attr("data-dynmod") ? $el.attr("data-dynmod") : ""
                        , url = $el.attr("data-dynmod-url") ? $el.attr("data-dynmod-url") : ""
                        , newPageTitle = $el.find(".m-164__model-name").text();

                    // only fire on not mobile
                    if (matchMediaQuery.getCurrentMediaQuery().pos >= 1)
                    {
                        _self._synchSlider(e, _self);
                        _self._loadNewContent(dynmod, url, newPageTitle); // todo when clciked and reloaded, right slide jumps to left place
                    }
                    else {
                        _self.$m72dockButton.trigger('click');
                    }
                }


            });

            //_onMobileSlideChange
            // this only fires on mobile: viewport 0
            this.$sliderClone.on("afterChange.m164", function (e) {
                if (matchMediaQuery.getCurrentMediaQuery().pos < 1)
                {
                    _self.hideDockAfterChange = false;
                    var oldSlideIndex = _self.$sliderClone.find("." + _self.cssClasses.activeSlide).index();
                    // sync with main slider
                    _self._synchSlider(e, _self);

                    // get data to load new content
                    var $activeSlide = _self.$sliderClone.find("." + _self.cssClasses.activeSlide)
                        , dynmod = $activeSlide.attr("data-dynmod") ? $activeSlide.attr("data-dynmod") : ""
                        , url = $activeSlide.attr("data-dynmod-url") ? $activeSlide.attr("data-dynmod-url") : "";

                    var newSlideIndex = _self.$sliderClone.find("." + _self.cssClasses.activeSlide).index();
                    // check if slide has changed
                    if (oldSlideIndex !== newSlideIndex)
                    {
                        _self._loadNewContent(dynmod, url);
                    }

                    _self._checkContentNavArrows();
                }
            });
        },

        _disableSliderClone: function () {
            if (this.$sliderClone.hasClass('slick-initialized') === false)
            {
                return;
            }
            this.$sliderClone.slick('unslick');
            this.$sliderItemClone.off("click.m164");
        },

        _enableScrollerClone: function () {
            // set active slide on active
            var activeSlideIndex = this.$slider.slick("slickCurrentSlide")
                , _self = this;
            this.$sliderItemClone.removeClass(this.cssClasses.activeSlide); // prevent multiple active items
            this.$sliderItemClone.eq(activeSlideIndex).addClass(this.cssClasses.activeSlide);

            scrollerClone = new IScroll(this.$modelSelectorClone.get(0), { // $modelSelectorClone
                tap: true,
                preventDefault: false

                // click: true
            });
            // bind click event
            this.$sliderItemClone.on("click.m164", function () {
                _self._onIScrollItemClick(_self, $(this));
            });
        },

        _disableScrollerClone: function () {
            this.$sliderItemClone.off("click.m164");
            if (scrollerClone instanceof IScroll)
            {
                scrollerClone.destroy();
                // console.log("destroy scroller");
            }
        },

        _refreshSliderClone: function () {
            var viewport = matchMediaQuery.getCurrentMediaQuery();
            if (viewport.pos >= 2)
            {
                // refresh slider
                this.$sliderClone.slick("setPosition");
            }
        },

        // end content navi stuff

        // content navi controls
        _onPrevArrow: function (_self) {
            var viewport = matchMediaQuery.getCurrentMediaQuery();

            // get current active item
            var $activeSlideClone = _self.$sliderClone.find("." + _self.cssClasses.activeSlide)
                , activeSlideIndex = $activeSlideClone.index();
            // case: not mobile
            if (viewport.pos >= 1 && activeSlideIndex > 0)
            {
                // remove class
                $activeSlideClone.removeClass(_self.cssClasses.activeSlide);
                // add class to prev model but only when its not the last one
                _self.$sliderItemClone.eq(activeSlideIndex - 1).addClass(_self.cssClasses.activeSlide);
                _self.$sliderClone.slick("slickPrev");

                // synch with model selector
                _self.$slider.slick("slickGoTo", activeSlideIndex - 1);
                // add custom active class to active slide
                _self.$sliderItem.removeClass(_self.cssClasses.activeSlide);
                _self.$sliderItem.eq(activeSlideIndex - 1).addClass(_self.cssClasses.activeSlide);

                // load  new content
                var newActiveSlide = _self.$sliderItemClone.eq(activeSlideIndex - 1)
                    , dynmod = newActiveSlide.attr("data-dynmod") ? newActiveSlide.attr("data-dynmod") : ""
                    , url = newActiveSlide.attr("data-dynmod-url") ? newActiveSlide.attr("data-dynmod-url") : "";
                // using timeout to finish slide animation first, then load new content to prevent poor animation
                setTimeout(function () {
                    _self._loadNewContent(dynmod, url);
                }, 400);
                _self._setModelNameInContentNavi(_self);

            } // case: mobile
            else if (viewport.pos == 0 && _self.$sliderClone.slick("slickCurrentSlide") > 0)
            {
                _self.$sliderClone.slick("slickPrev");
            }
        },

        _onNextArrow: function (_self) {
            var viewport = matchMediaQuery.getCurrentMediaQuery();

            // get current active item
            var $activeSlideClone = _self.$sliderClone.find("." + _self.cssClasses.activeSlide)
                , activeSlideIndex = $activeSlideClone.index()
                , itemLength = _self.$sliderItemClone.length - 1;

            // not mobile
            if (viewport.pos >= 1 && activeSlideIndex < itemLength)
            {
                // remove class
                $activeSlideClone.removeClass(_self.cssClasses.activeSlide);
                // add class to next model but only when its not the last one
                _self.$sliderItemClone.eq(activeSlideIndex + 1).addClass(_self.cssClasses.activeSlide);
                _self.$sliderClone.slick("slickNext");

                // synch with main model selector
                _self.$slider.slick("slickGoTo", activeSlideIndex + 1); // faster/more precise than slickNext/slickPrev when clicked very fast
                // add custom active class to active slide
                _self.$sliderItem.removeClass(_self.cssClasses.activeSlide);
                _self.$sliderItem.eq(activeSlideIndex + 1).addClass(_self.cssClasses.activeSlide);

                // load  new content
                var newActiveSlide = _self.$sliderItemClone.eq(activeSlideIndex + 1)
                    , dynmod = newActiveSlide.attr("data-dynmod") ? newActiveSlide.attr("data-dynmod") : ""
                    , url = newActiveSlide.attr("data-dynmod-url") ? newActiveSlide.attr("data-dynmod-url") : ""
                    , newPageTitle = newActiveSlide.find(".m-164__model-name").text();

                setTimeout(function () {
                    _self._loadNewContent(dynmod, url, newPageTitle);
                }, 400);
                _self._setModelNameInContentNavi(_self);
            }
            // mobile
            else if (viewport.pos == 0 && activeSlideIndex < itemLength)
            {
                _self.$sliderClone.slick("slickNext");
            }
        },
        // end content navi controls
        ///////////////////////////////


        _onIScrollItemClick: function (_self, $el) {
            var viewport = matchMediaQuery.getCurrentMediaQuery();
            if (viewport.pos < 2)
            {
                var clickedIndex = $el.index();

                _self.$sliderItemClone.removeClass(_self.cssClasses.activeSlide);
                $el.addClass(_self.cssClasses.activeSlide);

                _self.$slider.slick("slickGoTo", clickedIndex);
            }
        },

        // load new content, when new model is selected
        _loadNewContent: function (dynmod, url, newPageTitle) {
            // reload content
            // loadHandler is global
            loadHandler.executeLoading(dynmod, url, newPageTitle);
        },

        // check if there is next or prev slide to indicate arrows
        _checkContentNavArrows: function (_self) {
            if (_self === undefined)
            {
                _self = this;
            }

            var curIndex = _self.$slider.slick("slickCurrentSlide")
                , sliderLength = _self.$sliderItem.length - 1
                , cssArrowDisabledClass = "m-164--arrow-disabled";

            _self.$prevArrow.removeClass(cssArrowDisabledClass);
            _self.$nextArrow.removeClass(cssArrowDisabledClass);

            if (curIndex <= 0)
            {
                _self.$prevArrow.addClass(cssArrowDisabledClass);
            }
            if (curIndex >= sliderLength)
            {
                _self.$nextArrow.addClass(cssArrowDisabledClass);
            }

        },

        // manages that both slider are on same active item and scroll position
        // this is fired on
        // afterchange and click (item) of clone slider
        // prev and next arrows in content navi,
        // click on main slide item
        // main slider change doesnt trigger this
        _synchSlider: function (source, _self) {
            var $el = $(source.currentTarget)
                , viewport = matchMediaQuery.getCurrentMediaQuery().pos;

            // if arrows are triggered do this
            if ($el.hasClass(_self.cssClasses.prevArrow))
            {
                _self._onPrevArrow(_self);
            }
            else if ($el.hasClass(_self.cssClasses.nextArrow))
            {
                _self._onNextArrow(_self);
            }
            // main slider got triggered
            else if ($el.parents(".m-164__model-selector-clone").length == 0)
            {
                _self.$sliderItem.removeClass(_self.cssClasses.activeSlide);
                $el.addClass(_self.cssClasses.activeSlide);
                _self._setModelNameInContentNavi();
            }
            // clone slider got triggered
            else if ($el.parents(".m-164__model-selector-clone").length > 0)
            {
                // change active slider
                _self.$sliderItemClone.removeClass(_self.cssClasses.activeSlide);
                // on mobile you pass the slider because its trigerring on afterChange
                if (viewport == 0)
                {
                    $el.find(".slick-current").addClass(_self.cssClasses.activeSlide); // add active class to clone slide
                }
                // on not mobile (desktop) it is triggered by click on slide item (clone), so you pass the clicked item
                else if (viewport > 0)
                {
                    $($el.get(0)).addClass(_self.cssClasses.activeSlide);
                }

                var activeSlideIndex = _self.$sliderClone.find("." + _self.cssClasses.activeSlide).index();
                _self.$sliderItem.removeClass(_self.cssClasses.activeSlide); // remove main slider active class
                _self.$sliderItem.eq(activeSlideIndex).addClass(_self.cssClasses.activeSlide); // set main slider active classes
                _self.$slider.slick("slickGoTo", activeSlideIndex); // synch with main slider

                _self._setModelNameInContentNavi(_self); // set name from main slder
            }
        },

        // ------------------------
        // mobile function, when element you change slide
        // ------------------------

        _onMobileSlideChange: function (_self) {
            var viewport = matchMediaQuery.getCurrentMediaQuery().pos;
            // if not mobile, do nothing
            if (viewport > 0)
            { // maybe change to 1
                return false;
            }
            var oldSlideIndex = _self.$slider.find("." + _self.cssClasses.activeSlide).index();
            // change active slide
            _self.$sliderItem.removeClass(_self.cssClasses.activeSlide);
            _self.$slider.find(".slick-current").addClass(_self.cssClasses.activeSlide);
            var newSlideIndex = _self.$slider.find("." + _self.cssClasses.activeSlide).index();

            // load new content, when slide has really change, not just touched
            if (oldSlideIndex !== newSlideIndex)
            {
                var $activeSlide = _self.$slider.find(".slick-current")
                    , dynmod = $activeSlide.attr("data-dynmod") ? $activeSlide.attr("data-dynmod") : ""
                    , url = $activeSlide.attr("data-dynmod-url") ? $activeSlide.attr("data-dynmod-url") : ""
                    , newPageTitle = $activeSlide.find(".m-164__model-name").text();

                _self._loadNewContent(dynmod, url, newPageTitle);
            }

        },


        destroy: function () {
            ModuleBaseView.prototype.destroy.apply(this, arguments);

            // destroy module here
        }


    });

})(jQuery, this, this.document);(function ($, window, document, undefined) {
    'use strict';

    $(document).ready(function () {
        m66init();
    });
    $(document).on("m66_loaded",function(){
        m66init();
    });
    function m66init(){
        var $slider = $(".m-66-container-clone");
        $slider.html($(".m-66-container").clone().html());

        $slider.slick({
            mobileFirst: true,
            slidesToScroll: 1,
            arrows: false,
            dots: true,
            responsive: [

                {
                    breakpoint: 768,
                    settings: {
                        slidesToShow: 2
                    }
                },
                {
                    breakpoint: 480,
                    settings: {
                        slidesToShow: 1
                    }
                }]
        });
    }
})(jQuery, this, this.document);

;(function( $,  window, document) {
    'use strict';
    var m09dropdownval;
    var m09ddno;
    var m09imageScaler;


    function changeVals(){
        $('.m-09-techspecs-selected').removeClass('m-09-techspecs-selected').addClass('m-09-techspecs-unselected');
        $('.m-09-techspecs-tabs-med a').removeClass('gui-active-tab');
        m09ddno = $('.m-09-techspecs-tabs > label > select').find('option:selected').data('no');
        m09ddno = parseInt(m09ddno);
        if(m09ddno == 0){
            m09dropdownval = "manual";
        } else if(m09ddno == 1){
            m09dropdownval = "pdk";
        }

        $('.m-09-techspecs-table > colgroup > .m-09-techspecs-col-'+m09dropdownval).addClass('m-09-techspecs-selected').removeClass('m-09-techspecs-unselected');
        $('.m-09-techspecs-tabs-med a.m-09-techspecs-tabmed-'+m09dropdownval).addClass('gui-active-tab');
        $('.m-09-techspecs-table .m-09-techspecs-'+m09dropdownval).removeClass('m-09-techspecs-unselected').addClass('m-09-techspecs-selected');

        // Binding für Tabs
        $('.m-09-techspecs-tabs-med a').unbind('click');
        $('.m-09-techspecs-tabs-med a').not($('.gui-active-tab')).click(function(){

            m09ddno = $(this).data('no');
            $('.m-09-techspecs-tabs > label > select').prop('selectedIndex', m09ddno );
            if (!Modernizr.touch && $('.m-09-techspecs-tabs > label > select') !== null && $('.m-09-techspecs-tabs > label > select') != undefined) {
                $('.m-09-techspecs-tabs > label > select').select2('val', $('.m-09-techspecs-tabs > label > select').val() );
            }
            changeVals();
            return false;
        });
    }

    $(document).ready(function () {
        m09init();
    });

    $(document).on("m09_loaded",function(){
        m09init();
    });

    function m09init(){
      m09imageScaler = new ScaleHandler();

      //replace sideshot
      var $sideShot = $(".m-09-techspecs-img");
      var scaleParam = m09imageScaler.getScaleParameter($sideShot);
      m09imageScaler.replaceSource($sideShot, $sideShot.attr('data-image-src'), scaleParam);

      if ($('.m-09-techspecs-compare').length > 0) {
            $('.m-09-techspecs-manual, .m-09-techspecs-pdk').addClass('m-09-techspecs-unselected');
            if ($('.m-09-techspecs-compare').hasClass('m-09-pdk-only')) {

                // PDK only chosen
                $('.m-09-techspecs-pdk, .m-09-techspecs-col-pdk').removeClass('m-09-techspecs-unselected').addClass('m-09-techspecs-selected');
                $('.m-09-techspecs-manual, .m-09-techspecs-col-manual').removeClass('m-09-techspecs-selected').addClass('m-09-techspecs-unselected');

            } else {

                if ($('.m-09-techspecs-compare').hasClass('m-09-manual-only')) {

                    // Manual only chosen
                    $('.m-09-techspecs-manual, .m-09-techspecs-col-manual').removeClass('m-09-techspecs-unselected').addClass('m-09-techspecs-selected');
                    $('.m-09-techspecs-pdk, .m-09-techspecs-col-pdk').removeClass('m-09-techspecs-selected').addClass('m-09-techspecs-unselected');

                } else {

                    // both columns
                    $('.m-09-techspecs-tabs > label > select').change(changeVals);
                    changeVals();
                }
            }
        }
        //init manmuell
        $('.m-09-techspecs-tabmed-manual').click();
    }
})(jQuery, this, this.document);;
(function ($, window, document, undefined)
{
    'use strict';

    var visualizerController = null

    $(document).ready(function ()
    {
        visualizerController = new VisualizerController({});
    });

    //------------------------------------------------------------------------------------------------------------------
    //region VISUALIZER CONTROLLER
    //------------------------------------------------------------------------------------------------------------------
    function VisualizerController(options)
    {
        var self = this,
            defaultOptions = {
                $supportedBrowsers: [
                    {browser: "Chrome", version: "39"}, 
                    {browser: "Firefox", version: "31"},
                    {browser: "Explorer", version: "10"},
                    {browser: "Safari", version: "8"}
                ]
            }, 
            container = [];
        
        this.settings = {};
        
        // Constructor
        (function init()
        {
            self.settings = $.extend(true, {}, defaultOptions, options || {});
            self.container = $("#cc-colorator-iframe").closest('.b-standard-module');

            _checkSupportedBrowsers();
        }());

        function _checkSupportedBrowsers() {
            var isSupported = false, 
                i = self.settings.$supportedBrowsers.length;

            while (i--) {
                if (BROWSER.browser == self.settings.$supportedBrowsers[i].browser &&
                    BROWSER.version >= self.settings.$supportedBrowsers[i].version) {
                    isSupported = true;
                    break;
                }
            }

            if (!isSupported) {
                if (self.container.length > 0)
                    self.container.hide();
            }
        }
    }

    $("#cc-colorator-iframe").load(function(){

        // if reading the iframes location does NOT fail because of cross domain origin issues,
        // it means we are on the same domain as the modelpage ... and not in ppn.porsche.com or cc.porsche.com
        var sameOrigin;
        try
        {
            sameOrigin = window.frames['cc-colorator-iframe'].location.host == window.location.host;
        }
        catch (e)
        {
            sameOrigin = false;
        }
        if (sameOrigin) {
            var container = $("#cc-colorator-iframe").closest('.b-standard-module-wrapper');
            container.hide();
            container.prev().hide();
        }


    });


})(jQuery, this, this.document);


// Message receiver from Visualizer iFrame content for height resizing on accordion actions and window resize events
window.onmessage = function(event) {
    if(event.data) {
        var ccFrame = $('#cc-colorator-iframe');
        var coloratorHeight = event.data.colorator.windowsHeight;
        ccFrame.closest('.b-iframe-wrapper').css({"padding-top" : coloratorHeight + "px", "border" : "none"});
    }
}
;
(function ($, window, document, undefined)
{
    'use strict';
    $(document).ready(function ()
    {

        // [SK] - 2013-11-08 - Start
        // Ausblenden von Visualizer und Map im IE8 wegen Perfomance-Problemen
        var isLowerIE = false;
        if (/MSIE (\d+\.\d+);/.test(navigator.userAgent))
        { //test for MSIE x.x;
            var ieversion = new Number(RegExp.$1) // capture x.x portion and store as a number
            isLowerIE = ieversion <= 8;
        }
        if (isLowerIE && /\/models\//g.test(window.location.href))
        {
            // .m-13-dealer-map verstecken
            $('div.m-13-dealer-map').hide();
            // Visualizer entfernen
            $('div[data-m-02-cn-anchor="Visualizer"]').remove();
        }
        // [SK] - 2013-11-08 - End

        var eventNamespace = '.b-btn-download-filling', clickEventType = 'click' + eventNamespace;

        // Little script to add the special filling class to the download link
        // => Filling background
        $('.b-btn-download').on(clickEventType, function ()
        {

            var link = $(this);

            if (!link.hasClass('filling') && !link.hasClass('filled'))
            {

                link.addClass('filling');

                window.setTimeout(function ()
                {
                    link.removeClass('filling');
                    link.addClass('filled');
                }, 1300);
            }
        });

        var mapIsInitialized = false,
            $findDealer = $('#finddealer');

        // #32954 - check initially if module is in view to init map
        if ($('.m-13-find-dealer-wrapper').length > 0)
        {
            if(isScrolledIntoView($findDealer) && !mapIsInitialized)
            {
                initMap();
            }else
            {
                $(window).scroll(function ()
                {
                    if(isScrolledIntoView($findDealer) && !mapIsInitialized)
                    {
                        initMap();
                    }
                });
            }
        }


        $('#m-01-dealer-search-form').submit(function (e)
        {

            // 2015-07-24 [SK] Leerzeichen im GET Querystring müssen URI Encoded sein (Kein "+" als Standardtrenner bei Formulareingaben)
            // führt sonst zu fehlerhaften Suchergebnissen beim Google Service

            if(GLOBAL_CONFIG.pool !== "china" && GLOBAL_CONFIG.language !== "zh") {
				$('#m-01-dealer-search-field').val(encodeURI($('#m-01-dealer-search-field').val()));
			}
            return true;

            // track m-01 GHS searchfield post
            //TRACKING && TRACKING.page(ga_data[0].page[0].pool+"/"+ga_data[0].page[0].area+"/"+ga_data[0].page[0].name+"dealersearch/?searchkey="+$('#m-01-dealer-search-field').val()+"&searchcat=portal dealer search");


            // JD POWER 10-2014 bring dealer search home
            /*
             if (GLOBAL_CONFIG.pool == 'usa' || GLOBAL_CONFIG.pool == 'canada') {
             TRACKING && TRACKING.page("dealersearch/?searchkey="+$('#m-01-dealer-search-field').val()+"&searchcat=portal dealer search");

             e.preventDefault();
             // [SK] Interimslösung ... eigentlich sollte für den USA Pool in der Action des Suchformulars der Link zur porschedealers.com
             // hinterlegt sein. Das ist als externer Link angelegt, wird aber nicht durchgereicht.
             // Daher kurzfristig hier in ein GLOBAL_CONFIG property ausgelagert.
             POPUP.openPopup({
             "urlTarget": replacePlaceholder({ZIP: $('#m-01-dealer-search-field').val()}, decodeURIComponent(GLOBAL_CONFIG.dealersearch.porschedealerLocatorURL)),
             "height": 666,
             "width": 1024,
             "menubar": 'no',
             "resizable": 'no',
             "scrollable": 'no',
             "targetWindow": "_self"  // JDP
             });
             return false;
             } else
             {
             //*/
            // return true;
            //*/
         });
        initStateDropdown();

        function initMap()
        {
            var $mapCanvas = $('#m-13-dealer-map-canvas'),
                map;

            if (!!($mapCanvas.length) && CURRENTPOOL != 'china')
            {
                map = maps();
                map.initGoogle();
            }else if(!!($mapCanvas.length) && CURRENTPOOL == 'china')
            {
                map = maps();
                map.initBaidu();
            }

            mapIsInitialized = true;
        }
    });

    function initStateDropdown()
    {
        var uiClasses = {
                'stateForm': 'm-13-dealer-search-form-state'
            },
            $dealerSearchStateForm = undefined,
            $stateSelect = undefined,
            states = undefined;

        $dealerSearchStateForm = $('.' + uiClasses.stateForm).eq(0);
        states = GLOBAL_CONFIG.dealersearch.UI_GHS_STATES;

        // Check if state drop down and data exists
        if ($dealerSearchStateForm.length <= 0 || typeof states !== 'string')
        {
            return false;
        }

        states = states.split(';');
        $stateSelect = $dealerSearchStateForm.find('select').eq(0);

        for (var i = 0; i < states.length; i++)
        {
            var currentState = states[i].split(':');
            $stateSelect.append($('<option />').val(currentState[0]).text(currentState[1]));
        }

        // Touch placeholder
        if(Modernizr.touch)
        {
            var $firstOption = $stateSelect.find('option').eq(0);

            if($firstOption.length > 0 && $firstOption.text() === "" && (typeof $stateSelect.data('placeholder') === "string"))
            {
                $firstOption.text($stateSelect.data('placeholder'));
                $firstOption.attr('selected', '').attr('disabled', '');
            }
        }
    }

})(jQuery, this, this.document);

function accordionInit()
{
    var $accordionContainer = $('.m-13-dealer-accordion-usa'),
        accordionIdPrefix = 'accordion-',
        accordionHeadlineSelector = '.accordion-headline',
        accordionHeadlineActiveClass = 'gui-active-tab',
        accordionContentSelector = '.accordion-content',
        accordionContentIdSuffix = '-content';

    $(accordionContentSelector).removeClass('display');

    // initializing all dealer-accordions

    $accordionContainer.each(function (containerIndex)
    {
        var headlines = $(this).find(accordionHeadlineSelector),
            headlineCount = headlines.length,
            currentHeadline = undefined,
            contentContainers = $(this).find(accordionContentSelector),
            contentContainerCount = contentContainers.length,
            currentContentContainer = undefined,
            tabIdTemplate = undefined;

        // relation between headline and content through index inside id
        for (var headlineIndex = 0; headlineIndex < headlineCount; headlineIndex++)
        {
            if (headlineIndex >= contentContainerCount)
            {
                break;
            }
            currentHeadline = headlines.eq(headlineIndex);
            currentContentContainer = contentContainers.eq(headlineIndex);
            tabIdTemplate = accordionIdPrefix + containerIndex + '-' + headlineIndex;

            currentHeadline.attr('id', tabIdTemplate);
            currentContentContainer.attr('id', (tabIdTemplate + accordionContentIdSuffix));
        }

        // activate accordion functionality
        $(this).accordion({
            'accordionLinkSelector': accordionHeadlineSelector,
            'accordionContent': accordionContentSelector,
            'closeOpenAccordions': true,
            'alwaysToggleActiveState': true,
            'ignoreBreakpoints': true,
            'checkEventClass': true,
            'accordionHeadlineActiveClass': accordionHeadlineActiveClass,
            'accordionClickedCallback': null,
            'contentSuffix': accordionContentIdSuffix
        });


    });
}

function isScrolledIntoView(elem)
{
    var docViewTop = $(window).scrollTop();
    var docViewBottom = docViewTop + $(window).height();

    var elemTop = $(elem).offset().top;
    var elemBottom = elemTop; // + $(elem).height();

    return ((elemBottom <= docViewBottom) && (elemTop >= docViewTop));
}


  var maps = function () {
  // self extracting init Listener
  (function ()
  {
    $('form a[href="#m-13-dealer-search-submit"]').on('click', function (evt)
    {
      evt.preventDefault();
      var $btn = $(evt.target),
          $form = $btn.closest('form');
          $form.submit();
      return false;
    });
  })();
    // Prototyping Pool Simulation - kann nach PS5-Implementierung entfernt werden.
    GLOBAL_CONFIG.pool = (getURLParameter('pool') != "null") ? getURLParameter('pool') : GLOBAL_CONFIG.pool;

    // Prototyping force "Touchable" option
    if (getURLParameter('faketouch') != null)
    {
        var HASTOUCH = (getURLParameter('faketouch') == 'true') ? true : false;
    } else
    {
        var HASTOUCH = Modernizr.touch;
    }

    // Which dealer webservice should be used?
    var GLOBAL_DEALER_WS = (GLOBAL_CONFIG.pool == "usa" || GLOBAL_CONFIG.pool == "canada") ? "GS" : "LOCAL";

    // references to standard dom objects
    var $moduleWrapper = $('.m-13-dealer-search').eq(0);
    var dealerMap = $moduleWrapper.find(".m-13-dealer-map");
    var dealerMapCanvas = dealerMap.find(".m-13-dealer-map-canvas");
    var dealerMapFilter = dealerMap.find(".m-13-dealer-map-filter");
    var dealerWrapper = $moduleWrapper.find(".m-13-dealer-wrapper");
    var dealerResultList = dealerWrapper.find('.m-13-dealer');
    var dealerTypeLegend = $moduleWrapper.find('.m-13-dealer-type-legend');

    // Legend Variables
    var dealerResultTypesList = [];
    var minDealerResultTypesToDisplayLegend = 1;
    var dealerTypeLegendHasTypesClassName = 'm-13-dealer-type-legend-has-types';
    var dealerTypeLegendAddTypePrefixClassName = 'm-13-dealer-type-legend-has-type-';
    var geoCount = 0;
    // class to delete 
    var ctdArray = []; 
    var iconMarker = [];
        iconMarker["default"] = [];
        iconMarker["mouseover"] = [];
    var iconMarkerClickedFlag = null;
    var iconMarkerLastOne = null;
    
    // die Voreinstellung der Anzhal der Händler 
    var defaultNumberOfDealer = 3;
    // Init Objekt für USA / Kanada
    (function (z) {
      defaultNumberOfDealer = defaultNumberOfDealer || 3;
      if(CURRENTPOOL == 'usa' || CURRENTPOOL == 'canada') {
        defaultNumberOfDealer = 5;
      }  
    }(defaultNumberOfDealer));
    if (!(/\/models\//i.test(location.href))
        || getURLParameter('showAll') == 'true'
        || getURLParameter('m-01-dealer-search-field') != 'null'
        || GLOBAL_CONFIG.dealersearch.UI_INIT_SHOW_ALL == '1'
    )
    {
        dealerResultList.addClass("showAll");
    }
    var SHOWALL = dealerResultList.hasClass("showAll");

    // -------------- start - HTML Templates -----------------------------------------
    var singleDealerBoxTemplate =

        "<div class=\"m-13-single-dealer-box m-13-dealer-type-code-[[###TYPECODE###]] m-13-dealer-search-mode-[[###SEARCHMODE###]]\" data-type-code=\"[[###TYPECODE###]]\">"
        + "<div class=\"m-13-single-dealer-box-content-wrapper\">"
        + "<div class=\"m-13-dealer-info\">"
        + "<span class=\"m-13-dealer-marker\"></span>"
        + "<span data-number=\"[[###NUMBER###]]\" class=\"m-13-dealer-marker-number\">[[###NUMBER###]]</span>"
        + "<span data-number=\"[[###NUMBER###]]\" class=\"m-13-dealer-name\">[[###NAME###]]</span>"
        + "[[###TYPE_LEGEND###]]"
        + "<p>[[###ADDRESS###]]<span class=\"m-13-dealer-phone\">"
        + "<br />" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOTEL + " <a class=\"gui-link\" href=\"[[###PHONEHREF###]]\" ><span>[[###PHONE###]]</span></a>"
        + ((GLOBAL_DEALER_WS == "LOCAL") ? "<br /><span class=\"[[###FAX-HIDE-IF-EMPTY###]]\">" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOFAX + " [[###FAX###]]</span>" : "")
        + (((GLOBAL_DEALER_WS == "LOCAL" && (CURRENTPOOL != "japan" && CURRENTLANGUAGE != "jp")) && CURRENTPOOL !="turkey")? ("<br /><span class=\"[[###EMAIL-HIDE-IF-EMPTY###]]\">" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOEMAIL + " [[###EMAIL###]]</span>") : "")
        + "</span></p>"
        + "[[###LINKLIST###]]"
        + "</div>"
        + "<div class=\"m-13-link-buttons\">"
        + ((GLOBAL_CONFIG.pool == "turkey") ? "<br/>" : "<a class=\"gui-btn gui-link-with-pin\" target=\"_blank\" href=\"[[###ROUTE###]]\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOROUTE + "</span></a>")
        + "<a class=\"gui-btn gui-link-with-phone\" href=\"[[###PHONEHREF###]]\" ><span>[[###PHONE###]]</span></a>"
        + "<a class=\"gui-btn gui-link-with-globe\" target=\"_blank\" href=\"[[###LINKHREF###]]\" ><span>"+ GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOWEBSITE +"</span></a>"
        + "</div>"
        + "</div>"
        + "</div>";


    var singleDealerBoxTemplateUSA =

        "<div class=\"m-13-single-dealer-box usa m-13-dealer-type-code-[[###TYPECODE###]]\" data-type-code=\"[[###TYPECODE###]]\">"
        + "<div class=\"m-13-single-dealer-box-content-wrapper\">"
        + "<div class=\"m-13-dealer-info\">"
        + "<span class=\"m-13-dealer-marker\"></span>"
        + "<span data-number=\"[[###NUMBER###]]\" class=\"m-13-dealer-marker-number\">[[###NUMBER###]]</span>"
        + "<span data-number=\"[[###NUMBER###]]\" class=\"m-13-dealer-name usa\">[[###NAME###]]</span><br/>"
        + "<div class=\"m-13-dealer-address-box\">"
        + "<div class=\"m-13-dealer-address-usa\">"
        + "<p>[[###ADDRESS###]]<span class=\"m-13-dealer-phone\">"
        + "<br />" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOTEL + " <a class=\"gui-link\" href=\"[[###PHONEHREF###]]\" ><span>[[###PHONE###]]</span></a>"
        + "</span></p>"
        /*+ "<li><a class=\"gui-btn-with-arrow m-13-grey-btn\" target=\"_blank\" href=\"[[###ROUTE###]]\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOROUTE + "</span></a></li>"*/
        + "</div>"
        + "</div>"
        + "<div class=\"m-13-dealer-content-usa\">"
        + "<ul class=\"m-13-dealer-link-list\">"
        + "<li><a class=\"gui-btn-with-arrow m-13-grey-btn dealer-info-website\" target=\"_blank\" href=\"[[###LINKHREF###]]\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOWEBSITE + "</span></a></li>"
        + "<li class=\"m-13-even\"><a class=\"gui-btn-with-arrow m-13-grey-btn\" target=\"_blank\" href=\"[[###LINKHREF###]]/new/Porsche/search.php\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_ENTIRE_INVENTORY + "</span></a></li>"
        + "</ul>"
        + "<div class=\"m-13-dealer-accordion-usa\">"
        + "<div class=\"accordion-content\">"
        + "<ul class=\"m-13-dealer-link-list\">"
        + "<li><a class=\"gui-btn-with-arrow m-13-grey-btn\" target=\"_blank\" href=\"[[###LINKHREF###]]/about_us/contact_us.php\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_CONTACT + "</span></a></li>"
        + "<li class=\"m-13-even\"><a class=\"gui-btn-with-arrow m-13-grey-btn\" target=\"_blank\" href=\"[[###LINKHREF###]]/service/service_request.php\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_SCHEDULE_SERVICE_APPT + "</span></a></li>"
        + "<li><a class=\"gui-btn-with-arrow m-13-grey-btn\" target=\"_blank\" href=\"[[###LINKHREF###]]/specials/\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_SPECIALS + "</span></a></li>"
        + "</ul>"
        + "<div class=\"m-13-dealer-hours\">"
        + "<div class=\"m-13-dealer-hours-row\">"
        + "<div class=\"m-13-dealer-hours-item\">"
        + "<p><strong>Sales:</strong> [[###SALESPHONE###]]</p>"
        + "<p>[[###SALESHOURS###]]</p>"
        + "</div>"

        + "<div class=\"m-13-dealer-hours-item m-13-even\">"
        + "<p><strong>Service:</strong> [[###SERVICEPHONE###]]</p>"
        + "<p>[[###SERVICEHOURS###]]</p>"
        + "</div>"
        + "</div>"

        + "<div class=\"m-13-dealer-hours-row\">"
        + "<div class=\"m-13-dealer-hours-item\">"
        + "<p><strong>Parts:</strong> [[###PARTSPHONE###]]</p>"
        + "<p>[[###PARTSHOURS###]]</p>"
        + "</div>"
        + "</div>"
        + "</div>"
        + "</div>"
        + "<a href=\"#\" class=\"accordion-headline\"><span class=\"accordion-more\">More</span><span class=\"accordion-less\">Less</span></a>"
        + "</div>"
        + "</div>"
        + "</div>"
        + "</div>"
        + "</div>";


//gui-btn-with-icon pin phone globe
    var dealerLinkListTemplate = {
        GS: "<ul class=\"b-link-list m-13-link-list\">"
        + "<li><a class=\"gui-link-with-arrow\" target=\"_blank\" href=\"[[###ROUTE###]]\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOROUTE + "</span></a></li>"
        + "<li><a class=\"gui-link-with-arrow dealer-info-website\" target=\"_blank\" href=\"[[###LINKHREF###]]\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOWEBSITE + "</span></a></li>"
        + "<li><a class=\"gui-link-with-arrow\" target=\"_blank\" href=\"[[###LINKHREF###]]/about_us/contact_us.php\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_CONTACT + "</span></a></li>"
        + "<li><a class=\"gui-link-with-arrow\" target=\"_blank\" href=\"[[###LINKHREF###]]/specials/\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_SPECIALS + "</span></a></li>"
        + "<li><a class=\"gui-link-with-arrow\" target=\"_blank\" href=\"[[###LINKHREF###]]/new/Porsche/search.php\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_ENTIRE_INVENTORY + "</span></a></li>"
        + "<li><a class=\"gui-link-with-arrow\" target=\"_blank\" href=\"[[###LINKHREF###]]/service/service_request.php\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_SCHEDULE_SERVICE_APPT + "</span></a></li>"
        + "<li><a class=\"gui-link-with-arrow\" target=\"_blank\" href=\"http://mobileapp.porschedealer.com\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DOWNLOAD_MOBIL_APP + "</span></a></li>"
        + "</ul>",

        LOCAL: "<ul class=\"b-link-list m-13-link-list\">"
        + "<li><a class=\"gui-link-with-arrow\" target=\"_blank\" href=\"[[###ROUTE###]]\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOROUTE + "</span></a></li>"
        + "<li><a class=\"gui-link-with-arrow dealer-info-website\" target=\"_blank\" href=\"[[###LINKHREF###]]\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOWEBSITE + "</span></a></li>"
        + "</ul>"
    };

    var infoboxHTML =
        "<div class=\"m-13-infobox m-13-dealer-info [[###HASIMGCLASS###]]  m-13-dealer-type-code-[[###TYPECODE###]]\" data-type-code=\"[[###TYPECODE###]]\">"
        + "<div class=\"m-13-infobox-info\">"
        + "<span class=\"m-13-dealer-name \">[[###NAME###]]</span>"
        + "<p class=\"m-13-dealer-address\">[[###ADDRESS###]]<br />"
        + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOTEL + "[[###PHONE###]]<br />"
        + '<div class="fax [[###FAX-HIDE-IF-EMPTY###]]">' + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOFAX + "[[###FAX###]]</div><br/>"
        + "<div class=\"m-13-infobox-links\">"
        + ((GLOBAL_CONFIG.pool=="turkey")? "": "<a class=\"gui-btn-with-arrow m-13-grey-btn m-13-infobox-btn\" href=\"[[###ROUTE###]]\" ><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOROUTE + "</span></a><br/>")
        + "<a class=\"gui-btn-with-arrow m-13-grey-btn m-13-infobox-btn dealer-info-website\" href=\"[[###LINKHREF###]]\" id=#ibid#><span>" + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOWEBSITE + "</span></a>"
        + "</div>"
        + "</div>"
        + "<div class=\"m-13-infobox-image\">"
        + "<img src=\"[[###IMAGEURL###]]\" />"
        + "</div>"
        + "</div>";
    // -------------- end - HTML Templates -----------------------------------------

    // Variables for substitution in singleDealerBoxTemplate
    var replacementsData = {
        LINKLIST: dealerLinkListTemplate[GLOBAL_DEALER_WS],
        NUMBER: '',
        TYPECODE: '',
        SEARCHMODE: '',
        NAME: '',
        PHONE: '',
        PHONEHREF: '',
        FAX: '-',
        EMAIL: '-',
        ADDRESS: '',
        LINKHREF: '',
        LINK: '',
        IMAGEURL: '',
        HASIMGCLASS: '',
        DEALERID: '',
        TYPE_LEGEND: ''
    };
    var br = "<BR />";

    var dealerImageBaseURL = document.location.protocol + '//' + document.location.host; //"http://www.porsche.com";
    var iconPathActive = {
        'unknown': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-grey.png",
        'centre': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-red.png",
        'classicpartner': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-red.png",
        'classiccentre': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-grey.png",
        'exclusiveflagship': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-red.png",
        'exclusivefsdandclassicpartner': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-red.png",
        'independentbodyrepair': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-grey.png",
        'preownedcentre': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-green.png",
        'servicecentre': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-blue.png",
        'site': document.location.protocol + '//' + document.location.host + "/images/icon_pin-sprite-type_code-grey.png"
    };
    var iconPath = "";
    var typeLabels = {
        'unknown': false,
        'centre': false,
        'classicpartner': ['classicpartner'],
        'classiccentre': false,
        'exclusiveflagship': ['exclusiveflagship'],
        'exclusivefsdandclassicpartner': ['exclusiveflagship','classicpartner'],
        'independentbodyrepair': false,
        'preownedcentre': false,
        'servicecentre': false,
        'site': false
    };
    var dataServiceProxy = ""; //"/prototype/modules/13-bind-and-services/content/proxy.php";
    var dataAddress = "";

    if ((getURLParameter('m-01-dealer-search-field') != '') && getURLParameter('m-01-dealer-search-field') != "null")
    {
        dataAddress = getURLParameter('m-01-dealer-search-field');
    }

     // URLs for dealer search requests. (Gary Stock for USA / CANADA)
    if (GLOBAL_DEALER_WS == "LOCAL")
    {
        var searchpool = (GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHPOOL != undefined && GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHPOOL != "") ? GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHPOOL : GLOBAL_CONFIG.pool;
        var searchlanguage = (GLOBAL_CONFIG.dealersearch.language != undefined && GLOBAL_CONFIG.dealersearch.language != "") ? GLOBAL_CONFIG.dealersearch.language : GLOBAL_CONFIG.language;

        /*
         * _locationType Values:

         Händler und Servicezentren
         Search.LocationTypes.Dealer value="centre,servicecentre"

         Nur Händler (Servicezentren ausgeschlossen)
         Search.LocationTypes.DealerNoServiceCentre value="centre"

         Standorte, spezielle Locations
         Search.LocationTypes.Site value="site"

         Alles
         Search.LocationTypes.All value="centre,servicecentre,site"
         */

        if (typeof GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCH_IN_STATE != 'string') GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCH_IN_STATE = '';
        if (typeof GLOBAL_CONFIG.dealersearch.UI_GHS_MAXPROXIMITY != 'string') GLOBAL_CONFIG.dealersearch.UI_GHS_MAXPROXIMITY = '';
        if (typeof GLOBAL_CONFIG.dealersearch.UI_GHS_MAXNUMTRIES != 'string') GLOBAL_CONFIG.dealersearch.UI_GHS_MAXNUMTRIES = '';
        if (typeof GLOBAL_CONFIG.dealersearch.UI_GHS_MAXRESULTS != 'string') GLOBAL_CONFIG.dealersearch.UI_GHS_MAXRESULTS = '';
        if (typeof GLOBAL_CONFIG.dealersearch.UI_GHS_LOCATION_TYPE != 'string') GLOBAL_CONFIG.dealersearch.UI_GHS_LOCATION_TYPE = 'Search.LocationTypes.Dealer';
        //if (typeof GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHMODE == 'undefined') GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHMODE = '';

        var dataurl = {
            'proximity': document.location.protocol + '//' + document.location.host + "/all/dealer2/GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=[[###STATE###]]&_locationType=" + GLOBAL_CONFIG.dealersearch.UI_GHS_LOCATION_TYPE + "&searchMode=proximity&searchKey=[[###POSITION###]]&address=[[###ADDRESS###]]&maxproximity=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXPROXIMITY + "&maxnumtries=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXNUMTRIES + "&maxresults=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXRESULTS,
            'nearestbyip': document.location.protocol + '//' + document.location.host + "/all/dealer2/GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=[[###STATE###]]&_locationType=" + GLOBAL_CONFIG.dealersearch.UI_GHS_LOCATION_TYPE + "&searchMode=nearestbyip&searchKey=&address=&maxproximity=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXPROXIMITY + "&maxnumtries=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXNUMTRIES + "&maxresults=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXRESULTS,
            'state': document.location.protocol + '//' + document.location.host + "/all/dealer2/GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=[[###STATE###]]&_locationType=" + GLOBAL_CONFIG.dealersearch.UI_GHS_LOCATION_TYPE + "&searchMode=state&searchKey=[[###STATE###]]&address=&maxproximity=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXPROXIMITY + "&maxnumtries=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXNUMTRIES + "&maxresults=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXRESULTS,
            'market': document.location.protocol + '//' + document.location.host + "/all/dealer2/GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=[[###STATE###]]&_locationType=" + GLOBAL_CONFIG.dealersearch.UI_GHS_LOCATION_TYPE + "&searchMode=market&searchKey=&address=&maxproximity=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXPROXIMITY + "&maxnumtries=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXNUMTRIES + "&maxresults=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXRESULTS,
			'condition': document.location.protocol + '//' + document.location.host + "/all/dealer2/" + "GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?" + "market=" + CURRENTPOOL + "&language=" + CURRENTLANGUAGE + "&state=" + CURRENTCONDITION + "&siteId=" + CURRENTPOOL + "&searchMode=condition&_locationType=condition&searchKey=&address=&maxproximity=&maxnumtries=&maxresults="
		};

        /*
        var dataurl = {
            'proximity': document.location.protocol + '//' + document.location.host + "/all/dealer2/GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=&maxproximity=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXPROXIMITY + "&maxnumtries=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXNUMTRIES + "&maxresults=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXRESULTS + "&_locationType=" + GLOBAL_CONFIG.dealersearch.UI_GHS_LOCATION_TYPE + "&searchMode=" + GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHMODE + "&searchKey=[[###POSITION###]]&address=[[###ADDRESS###]]",
            'nearestbyip': document.location.protocol + '//' + document.location.host + "/all/dealer2/GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=&maxproximity=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXPROXIMITY + "&maxnumtries=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXNUMTRIES + "&maxresults=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXRESULTS + "&_locationType=" + GLOBAL_CONFIG.dealersearch.UI_GHS_LOCATION_TYPE + "&searchMode=" + GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHMODE + "",
            'state': document.location.protocol + '//' + document.location.host + "/all/dealer2/GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&state=&maxproximity=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXPROXIMITY + "&maxnumtries=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXNUMTRIES + "&maxresults=" + GLOBAL_CONFIG.dealersearch.UI_GHS_MAXRESULTS + "&_locationType=" + GLOBAL_CONFIG.dealersearch.UI_GHS_LOCATION_TYPE + "&searchMode=" + GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHMODE + "&searchKey=[[###STATE###]]",
            'market': document.location.protocol + '//' + document.location.host + "/all/dealer2/GetLocationsWebService.asmx/GetLocations?market=" + searchpool + "&siteId=" + searchpool + "&language=" + searchlanguage + "&_locationType=Search.LocationTypes.Dealer" + "&searchMode=market" + "&searchKey="
        };
        */
    } else
    {


        //document.location.
        var dataurl = {
            'proximity': document.location.protocol + '//' + document.location.host + "/all/dealer2/" + GLOBAL_CONFIG.pool + "/externalSearchXml.aspx?geo=[[###POSITION###]]&lim=9",
            'nearestbyip': undefined,
            'state': document.location.protocol + '//' + document.location.host + "/all/dealer2/" + GLOBAL_CONFIG.pool + "/externalSearchXml.aspx?state=[[###STATE###]]",
            'market': undefined,
			'condition': document.location.protocol + '//' + document.location.host + "/all/dealer2/" + "GetLocationsWebService.asmx/GetLocationsInStateSpecialJS?siteId=" + CURRENTPOOL + "&language=" + CURRENTLANGUAGE + "" + "state=" + CURRENTCONDITION
        }

    }

    if(GLOBAL_DEALER_WS === 'GS')
    {
        // add class 'm-13-gs-mode' to module wrapper
        $moduleWrapper.addClass('m-13-gs-mode');
    }

    /** b4 JD Power 2014/2
     if (GLOBAL_CONFIG.pool == "usa")
     {
         var gsAllDealerUrl = "http://porschedealer.com/dealer/usLocator/?zip=[[###ZIP###]]&page=search";
     } else
     {
         var gsAllDealerUrl = "http://porschecentre.ca/index.php/?zip=[[###ZIP###]]&language=" + GLOBAL_CONFIG.language;
     }
     */
    // global variables
    var map;
    var markers = [];
    var infoWindows = [];
    var navPos = 0;
    var homePos;
    var mapBounds;
    var searchValue;
    var state;
    var locationsArray;
    var dealerScrollButton;

    $('.m-13-dealer-search-input').placeholder();

     /**
     * Activate Loader-gif, Request browsers geo-localization
     * substitute the POSITION placeholder in the Data-URL, request for
     * dealers and process the result by passing it to processResult function
     * */
    $('.m-13-find-dealer-localization').click(function locateMe()
    {
        hide_error();
        searchValue = "currentLocation";

        $('.m-13-dealer-search-input').val("").focus().blur();

        toggleLoader();

        if (navigator.geolocation)
        {
            navigator.geolocation.getCurrentPosition(function (position)
            {

                homePos = position;

                var tmpDataurl = dataurl['proximity'].replace(/\[\[###POSITION###\]\]/g, position.coords.latitude + '%7C' + position.coords.longitude);
                tmpDataurl = tmpDataurl.replace(/\[\[###ADDRESS###\]\]/g, '');
                tmpDataurl = tmpDataurl.replace(/\[\[###STATE###\]\]/g, encodeURIComponent(GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCH_IN_STATE));
                TRACKING && TRACKING.page("dealersearch/?searchkey=" + position.coords.latitude + "%7C" + position.coords.longitude + "&searchcat=portal dealer search");

                if (dataServiceProxy != "")
                {
                    $.ajax({
                        url: dataServiceProxy,
                        type: 'POST',
                        dataType: 'xml',
                        data: {
                            address: tmpDataurl
                        },
                        success: processResult
                    });
                } else
                {
                    $.ajax({
                        url: tmpDataurl,
                        dataType: 'xml',
                        type: 'GET',
                        success: processResult
                    });
                }

            }, error);
        } else
        {

            var tmpDataurl = dataurl['nearestbyip'];
            tmpDataurl = tmpDataurl.replace(/\[\[###STATE###\]\]/g, encodeURIComponent(GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCH_IN_STATE));

            if (typeof tmpDataurl == 'string')
            {
                if (dataServiceProxy != "")
                {
                    $.ajax({
                        url: dataServiceProxy,
                        type: 'POST',
                        data: {
                            address: tmpDataurl
                        },
                        success: processResult
                    });
                } else
                {
                    $.ajax({
                        url: tmpDataurl,
                        type: 'GET',
                        success: processResult
                    });
                }
            }
        }


    });

    $('.m-13-show-all-dealers').click(function ()
    {
        showAll($(this).attr('data-target'));
    });

    function toggleLoader()
    {
        if ($('.m-13-dealer-map-filter').is(':visible'))
        {
            $('.m-13-dealer-map-filter').hide();
            $('.m-13-dealer-map-loader').removeClass('active');
        } else
        {
            $('.m-13-dealer-map-filter').show();
            $('.m-13-dealer-map-loader').addClass('active');
        }
    }

    function processResult(xml)
    {
        $('.m-13-show-all-dealers').hide();

        var data = $.xml2json(xml);

        dealerResultList.empty();
        var newSingleDealer;
        var geoCount = 0;

        if (GLOBAL_DEALER_WS == "LOCAL")
        {
            locationsArray = data.ListofLocations.Location;
        } else
        {
            locationsArray = data.dealer;
        }

        if (locationsArray == undefined)
        {
            show_error(GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_SEARCHFAIL);
            return false;
        }

        // only one is found? Then we don't get an array and have to build our own.
        if (locationsArray.length == undefined)
        {
          locationsArray = [locationsArray];
        }

        // ClearTypeList
        dealerResultTypesList.length = 0;
        dealerResultTypesList = [];




    }

    function error(msg)
    {

    }

    function showAll(target)
    {
        insertURLParameter({showAll: "true", searchValue: searchValue, searchValueState: state}, target);
        /** b4 JD Power
         if (GLOBAL_DEALER_WS == "LOCAL")
         {
             insertURLParameter({showAll: "true", searchValue: searchValue}, target);
         } else
         {
             POPUP.openPopup({
                 urlTarget: replacePlaceholder({ ZIP: searchValue }, gsAllDealerUrl),
                 height: 666,
                 width: 1024,
                 menubar: 'no',
                 resizable: 'no',
                 scrollable: 'no'
             });
         }
         */
    }

    /**
     * Ergänzt einen URL Parameter in einer URL
     * */
    function insertURLParameter(params, target)
    {
        if (target != "")
        {
            var urlp = target.split('?');
            if (urlp.length == 1)
            {
                var kvp = [];
            } else
            {
                var kvp = urlp[1].split('&');
            }
        }
        else
        {
            var kvp = document.location.search.substr(1).split('&');
        }

        var length = kvp.length;
        $.each(params, function (key, value)
        {
            key = encodeURI(key);
            value = encodeURI(value);

            // add already existing params
            var i = kvp.length;
            var x;
            while (i--)
            {
                x = kvp[i].split('=');

                if (x[0] == key)
                {
                    x[1] = value;
                    kvp[i] = x.join('=');
                    break;
                }
            }
            if (i < 0)
            {
                kvp[length] = [key, value].join('=');
                length++;
            }
        });

        window.location.href = urlp[0] + "?" + kvp.join('&');

    }

    function show_error(error_msg)
    {
        toggleLoader();
        $(".m-13-dealer-error-msg").empty().html(error_msg).addClass('active');
        $(".m-13-dealer-map .m-13-dealer-map-filter").show();
    }

    function hide_error()
    {
        $(".m-13-dealer-map .m-13-dealer-map-filter").hide();
        $('.m-13-dealer-error-msg').removeClass("active");
    }

    function resetOthersInputFields(activeForm)
    {
        var others = [
                {
                    "formSelector": ".m-13-dealer-search-form",
                    "type": "input",
                    "elementSelector": ".gui-search-input"
                },
                {
                    "formSelector": ".m-13-dealer-search-form-name",
                    "type": "input",
                    "elementSelector": ".gui-search-input"
                },
                {
                    "formSelector": ".m-13-dealer-search-form-state",
                    "type": "select",
                    "elementSelector": "select"
                }
            ],
            $activeForm = $(activeForm),
            $currentForm = null,
            $currentElement = null,
            i = 0;

        for(i = 0; i < others.length; i++)
        {
            $currentForm = $(others[i].formSelector);
            if($currentForm.length > 0 && !$currentForm.is($activeForm))
            {
                $currentElement = $currentForm.find(others[i].elementSelector);
                if($currentElement.length > 0)
                {
                    switch (others[i].type)
                    {
                        case 'input':
                            $currentElement.val('');
                            break;
                        case 'select':
                            $currentElement.val('').select2('val','',true);
                            break;
                    }
                }
            }
        }
    }


    function replacePlaceholder(data, template, ctd)
{
    //newSingleDealer = singleDealerBoxTemplate;
    /*c$f checks if link to website exists*/
    noWebsite = false;
    var $template = $(template);
    $.each(data, function (index, value)
    {
        if (index == "LINK" && typeof value === 'undefined')
        {
            noWebsite = true;
        }
    });

    /*c$f search for specific template and removes the link if the website don´t exist*/
    if(noWebsite) {
        $template.find('.dealer-info-website').remove();
        $template.find('.gui-btn.gui-link-with-globe').remove();
        template = $template.get(0).outerHTML;
    }
    /* /c$f*/

    var html = template;

    $.each(data, function (index, value)
    {
        /*c$f removes link to wensite if link don´t exist*/
        if (index == "LINKLIST" && noWebsite)
        {
            value = ((GLOBAL_CONFIG.pool == "turkey")?'':'<ul class="b-link-list m-13-link-list"><li><a class="gui-link-with-arrow" target="_blank" href="[[###ROUTE###]]" ><span>' + GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_DEALERINFOROUTE + '</span></a></li></ul>');
            noWebsite = false;
        }
        /* /c$f*/
        var pattern = new RegExp('\\[\\[###' + index + '###\\]\\]', 'g');
        html = html.replace(pattern, value);

        // [SK] 2016-01-11 hide elements on empty value
        var hidepattern = new RegExp('\\[\\[###' + index + '-HIDE-IF-EMPTY###\\]\\]', 'g');
        if (value == "" || value == undefined || value == "-") {
            html = html.replace(hidepattern, "b-hidden");
        }

    });

    if(Array.isArray(ctd) && ctd.length != 0) {
      for(var i = 0; i< ctd.length; i++) {
        if(!!$(html).find('.' + ctd[i]).length) {
          html = $(html).find('.' + ctd[i]).remove().end().get(0);
        }
      }
    };
    
    return html;
}

function uniformDealerBoxes()
{

//    var currentTallest = 0,
//        currentRowStart = 0,
//        rowDivs = new Array(),
//        $el,
//        topPosition = 0;
//
//    $('.m-13-single-dealer-box').each(function ()
//    {
//
//        $el = $(this);
//        topPosition = $el.position().top;
//
//        if (currentRowStart != topPosition)
//        {
//
//            // we just came to a new row.  Set all the heights on the completed row
//            for (currentDiv = 0; currentDiv < rowDivs.length; currentDiv++)
//            {
//                rowDivs[currentDiv].height(currentTallest);
//            }
//
//            // set the variables for the new row
//            rowDivs.length = 0; // empty the array
//            currentRowStart = topPosition;
//            currentTallest = $el.height();
//            alert(currentTallest);
//            rowDivs.push($el);
//
//        } else
//        {
//
//            // another div on the current row.  Add it to the list and check if it's taller
//            rowDivs.push($el);
//            currentTallest = (currentTallest < $el.height()) ? ($el.height()) : (currentTallest);
//
//        }
//
//        // do the last row
//        for (currentDiv = 0; currentDiv < rowDivs.length; currentDiv++)
//        {
//            rowDivs[currentDiv].height(currentTallest);
//        }
//
//    });

}


    var googleMap = function () {
      var geocoder;
      window.initDealerSearch = initDealerSearch;
      var googleMapsHost = 'maps.googleapis.com';
      if(typeof GLOBAL_CONFIG.dealersearch.UI_MAP_GOOGLE_MAPS_HOST == 'string' && GLOBAL_CONFIG.dealersearch.UI_MAP_GOOGLE_MAPS_HOST.length > 0)
      {
          googleMapsHost = GLOBAL_CONFIG.dealersearch.UI_MAP_GOOGLE_MAPS_HOST
      }
      var gMapsURL = document.location.protocol + '//' + googleMapsHost + '/maps/api/js?sensor=true';
          gMapsURL += '&language=' + GLOBAL_CONFIG.preferredLanguage;
          gMapsURL += '&callback=initDealerSearch';
          if (!(document.location.host == 'localhost' || document.location.host.indexOf('lu-') == 0))
          {
	    //gMapsURL += '&client=gme-porsche';
            //#22221
            gMapsURL += '&client=gme-volkswagenag3';
            gMapsURL += '&channel=PORSCHE-' + GLOBAL_CONFIG.pool.toUpperCase() + '-DEALERSEARCH';
          }
          $.ajax({dataType: 'script', cache: true, url: gMapsURL});

      function initDealerSearch() {

       if (typeof (google) == 'undefined')
        {
          return;
        }

           /*
           * Clears all Overlays (Markers) in current map.
           * neccessary to remove existing search results after new search processes.
           * */


            google.maps.Map.prototype.clearOverlays = function ()
            {
                for (var i = 0; i < markers.length; i++)
                {
                    markers[i].setMap(null);
                }
            }



        geocoder = new google.maps.Geocoder();

        if (homePos != undefined)
        {
            var homeLatlng = new google.maps.LatLng(homePos.coords.latitude, homePos.coords.longitude);
            var zoom = 8;
        } else
        {
            var homeLatlng = new google.maps.LatLng(GLOBAL_CONFIG.dealersearch.UI_MAP_DEFAULTCOORDS_LAT, GLOBAL_CONFIG.dealersearch.UI_MAP_DEFAULTCOORDS_LNG);
            var zoom = GLOBAL_CONFIG.dealersearch.UI_MAP_DEFAULTCOORDS_ZOOMLEVEL;
        }

        if (HASTOUCH)
        {
            // Static map for touch devices
            var mapOptions = {
                zoom: zoom,
                center: homeLatlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                disableDefaultUI: true,
                draggable: false,
                scrollwheel: false,
                zoomControl: true,
                zoomControlOptions: {
                    style: google.maps.ZoomControlStyle.DEFAULT,
                    position: google.maps.ControlPosition.TOP_RIGHT
                }
            };
        } else
        {
            // interactive map for devices without touchevents
            var mapOptions = {
                zoom: zoom,
                center: homeLatlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                disableDefaultUI: true,
                draggable: true,
                scrollwheel: false,
                zoomControl: true,
                zoomControlOptions: {
                    style: google.maps.ZoomControlStyle.DEFAULT,
                    position: google.maps.ControlPosition.TOP_RIGHT
                }

            };
        }

        map = new google.maps.Map(document.getElementById('m-13-dealer-map-canvas'), mapOptions);

        google.maps.event.addListenerOnce(map, 'idle', function ()
        {
            if (getURLParameter('searchValue') != "null" || (getURLParameter('m-01-dealer-search-field') != '' && getURLParameter('m-01-dealer-search-field') != "null"))
            {

                searchValue = (decodeURI(getURLParameter('searchValue')) != "null") ? decodeURI(getURLParameter('searchValue')) : decodeURI(getURLParameter('m-01-dealer-search-field'));
                state = (decodeURI(getURLParameter('searchValueState')) != "null") ? decodeURI(getURLParameter('searchValueState')) : decodeURI(getURLParameter('m-01-dealer-search-field'));

                if (searchValue == "currentLocation")
                {
                    $('.m-13-find-dealer-localization').trigger('click');
                }
                else if (typeof searchValue == 'string' && searchValue.length > 0 && searchValue != 'undefined')
                {
                    $('.m-13-dealer-search-input').val(searchValue);
                    $('.m-13-dealer-search-form').submit();
                }
                else if (typeof state == 'string' && state.length > 0 && state != 'undefined')
                {
                    state = state.toUpperCase();
                    $('.m-13-dealer-search-form-state select').val(state).select2('val', state);
                    $('.m-13-dealer-search-form-state').submit();
                }
            } else if (!!GLOBAL_CONFIG.dealersearch.UI_INIT_MARKETSEARCH && GLOBAL_CONFIG.dealersearch.UI_INIT_MARKETSEARCH == '1') {
                // Ausgabe aller Händler
                loadMarketDealer();
            }
        });

          $('.m-13-marketsearch').click(function (){
              var sitename = "dealersearch";
              if((window.location.href.indexOf(sitename) > -1)){
                  loadMarketDealer();
              }else{
                  myUrl = location.host;
                  myUrl += "/" + GLOBAL_CONFIG.pool;
                  if(GLOBAL_CONFIG.language != 'none' || GLOBAL_CONFIG.language != ''){
                      myUrl += "/" + GLOBAL_CONFIG.language;
                  }
                  myUrl += "/" + sitename;
                  location.href = window.location.protocol + "//" + myUrl;
              }
          });
      }

        // use only as instance
        function DealerScrollButton()
        {
            // dealerWrapper
            var $dealerScrollWrapper = dealerWrapper.find('.m-13-dealer-scroll-wrapper').eq(0),
                $scrollButton = dealerWrapper.find('.m-13-dealer-scroll-button').eq(0),
                eventNamespace = 'dealerScrollButton',
                visibilityClass = 'm-13-is-visible';

            _initDealerScrollButton();

            function _initDealerScrollButton()
            {
                $scrollButton.addClass(visibilityClass);
                _registerEvents();
            }

            function _registerEvents()
            {
                $scrollButton.on('click.' + eventNamespace, _scrollToNextDealer);
            }

            function _unregisterEvents()
            {
                $scrollButton.off('click.' + eventNamespace);
            }

            function _scrollToNextDealer(evt)
            {
                var $dealerItems = dealerWrapper.find('.m-13-single-dealer-box'),
                    scrollWrapperPosition = $dealerScrollWrapper.scrollTop(),
                    itemPosition = -1;

                $dealerItems.each(function() {
                    itemPosition = $(this).position().top;

                    if(itemPosition > scrollWrapperPosition + 10)
                    {
                        return false;
                    }else
                    {
                        itemPosition = -1;
                    }
                });

                if(itemPosition !== -1)
                {
                    $dealerScrollWrapper.animate({
                        scrollTop: itemPosition
                    }, 300);
                }
            }

            this.terminate = function() {
                $scrollButton.removeClass(visibilityClass);
                _unregisterEvents();
            }
        }

      function googleTemplate (locationsArray) {

      google.maps.event.addDomListener(window, 'resize', function ()
        {
          map.fitBounds(mapBounds);
        });

        mapBounds = new google.maps.LatLngBounds();
        map.clearOverlays();
        markers = [];
        geoCount = 0;

        // add class "m-13-results-loaded" to results list
        $moduleWrapper.find('.m-13-context').addClass('m-13-results-loaded');
        google.maps.event.trigger(map, "resize");

        // clear dealer scroll button instance
        if(dealerScrollButton instanceof DealerScrollButton)
        {
          dealerScrollButton.terminate();
        }

        if (locationsArray)
        {
          for (var i = 0; i < locationsArray.length; i++)
          {
              iconPath = iconPathActive.unknown;

              if (GLOBAL_DEALER_WS == "LOCAL")
              {
                  replacementsData.NUMBER = i + 1;

                  if (GLOBAL_CONFIG.dealersearch.UI_SHOW_TYPE_CODES)
                  {
                      replacementsData.TYPECODE = locationsArray[i].TypeCode;
                      replacementsData.TYPECODE = (typeof replacementsData.TYPECODE == 'string' && replacementsData.TYPECODE != '' ? replacementsData.TYPECODE : 'unknown');
                      if (replacementsData.TYPECODE != 'unknown' && $.inArray(replacementsData.TYPECODE, dealerResultTypesList))
                      {
                          dealerResultTypesList.push(replacementsData.TYPECODE);
                      }
                  } else
                  {
                      replacementsData.TYPECODE = 'unknown';
                  }

                  replacementsData.SEARCHMODE = ("" + locationsArray[i].SearchMode).toLowerCase();

                  replacementsData.NAME = locationsArray[i].Name;
                  replacementsData.ADDRESS = (GLOBAL_CONFIG.pool == 'japan' && GLOBAL_CONFIG.language == 'jp') ? (((locationsArray[i].AddressData.PostCode != "" && locationsArray[i].AddressData.PostCode != undefined) ? (locationsArray[i].AddressData.PostCode + " ") : "") + br + ((locationsArray[i].StateName != "" && locationsArray[i].StateName != undefined) ? (locationsArray[i].StateName + " ") : "") + ((locationsArray[i].AddressData.City != "" && locationsArray[i].AddressData.City != undefined) ? (locationsArray[i].AddressData.City + " ") : "") + locationsArray[i].AddressData.Street) : (locationsArray[i].AddressData.Street + br + ((locationsArray[i].AddressData.PostCode != "" && locationsArray[i].AddressData.PostCode != undefined) ? (locationsArray[i].AddressData.PostCode + " ") : "") + ((locationsArray[i].AddressData.City != "" && locationsArray[i].AddressData.City != undefined) ? (locationsArray[i].AddressData.City + " ") : ""));
                  replacementsData.PHONE = (locationsArray[i].AddressData.Phone != "" && typeof locationsArray[i].AddressData.Phone !== 'undefined') ? locationsArray[i].AddressData.Phone : "-";
                  replacementsData.PHONEHREF = "tel:" + locationsArray[i].AddressData.Phone;
                  if(typeof locationsArray[i].AddressData.Fax !=='undefined' && /([0-9])\w+/.test(locationsArray[i].AddressData.Fax)) {
                    replacementsData.FAX = locationsArray[i].AddressData.Fax;
                  }
                  replacementsData.EMAIL = (GLOBAL_CONFIG.pool == 'japan' && GLOBAL_CONFIG.language == 'jp') ? '' : ((locationsArray[i].Email1 != "" && locationsArray[i].Email1 != undefined) ? "<a class=\"gui-link\" href=\"mailto:" + locationsArray[i].Email1 + "\">" + locationsArray[i].Email1 + "</a>" : "-");
                  replacementsData.LINKHREF = locationsArray[i].Url1;
                  replacementsData.LINK = locationsArray[i].Url1;
                  replacementsData.IMAGEURL = dealerImageBaseURL + locationsArray[i].InfoWinThumbPath;
                  replacementsData.HASIMGCLASS = (locationsArray[i].InfoWinThumbPath == '') ? 'no-img' : '';

		  if(!!locationsArray[i].Mapslink) {
		  	replacementsData.ROUTE = locationsArray[i].Mapslink;
		  }
		  else {
			  if (navigator.userAgent.match(/iPhone|iPad|iPod/i) != null)
	                  {
	                      replacementsData.ROUTE = "http://maps.apple.com/maps?q="
	                          + locationsArray[i].AddressData.Street.replace(" ", "+").replace("&", "%26") + ","
	                          + ((locationsArray[i].AddressData.PostCode != undefined) ? (locationsArray[i].AddressData.PostCode.replace(" ", "+") + ",") : "")
	                          + ((locationsArray[i].AddressData.City != undefined) ? (locationsArray[i].AddressData.City.replace(" ", "+") + "@") : "@")
	                          + locationsArray[i].Coordinates.Lat + "," + locationsArray[i].Coordinates.Lng;
	                  }
	                  else
	                  {
	                      replacementsData.ROUTE = "https://www.google.de/maps/place/" + locationsArray[i].AddressData.Street + "," + locationsArray[i].AddressData.PostCode + " " + locationsArray[i].AddressData.City;
	                  }
		  }
                  var typeLegendPattern = typeLabels[replacementsData.TYPECODE];
                  replacementsData.TYPE_LEGEND = "";
                  if ($.isArray(typeLegendPattern) && typeLegendPattern.length > 0)
                  {
                      replacementsData.TYPE_LEGEND = '<div class="m-13-dealers-type-legend">';
                      for (var tlpi = 0; tlpi < typeLegendPattern.length; tlpi++)
                      {
                          var tlpLabel;
                          try
                          {
                              tlpLabel = GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_TYPE_CODE_LEGEND[typeLegendPattern[tlpi]];
                          } catch (ex)
                          {
                              tlpLabel = '';
                          }
                          if (typeof tlpLabel == 'string' && tlpLabel.length > 0)
                          {
                              replacementsData.TYPE_LEGEND += '<span class="';
                              replacementsData.TYPE_LEGEND += typeLegendPattern[tlpi];
                              if (tlpi + 1 == typeLegendPattern.length)
                              {
                                  replacementsData.TYPE_LEGEND += ' last';
                              }
                              replacementsData.TYPE_LEGEND += '">';

                              replacementsData.TYPE_LEGEND += GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_TYPE_CODE_LEGEND[typeLegendPattern[tlpi]];
                              replacementsData.TYPE_LEGEND += '</span>';

                          }
                      }
                      replacementsData.TYPE_LEGEND += '</div>';
                  }

                  iconPath = typeof iconPathActive[replacementsData.TYPECODE] == 'string' ? iconPathActive[replacementsData.TYPECODE] : iconPath;
                  
                  iconMarker = new google.maps.MarkerImage(iconPath, new google.maps.Size(26, 40), new google.maps.Point(0, i * 40));
                
                  if (SHOWALL || i < 3)
                  {
                      var curLatLng = new google.maps.LatLng(locationsArray[i].Coordinates.Lat, locationsArray[i].Coordinates.Lng);
                      mapBounds.extend(curLatLng);

                      var marker = new google.maps.Marker({
                          position: curLatLng,
                          map: map,
                          cursor: (HASTOUCH) ? 'default' : 'pointer',
                          title: locationsArray[i].Name,
                          icon: iconMarker,
                          id: i,
                          infoWinHTML: replacePlaceholder(replacementsData, infoboxHTML)
                      });

                      // event listener for click on Marker
                      if (!HASTOUCH)
                      {
                          google.maps.event.addListener(marker, 'click', function ()
                          {
                              gotoPorscheCenter(this);
                          });
                      }
                      markers.push(marker);
                  }

                  geoCount++;

                  if (SHOWALL || i < 3)
                  {
                      dealerResultList.append(
                          replacePlaceholder(replacementsData, singleDealerBoxTemplate)
                      );
                  }

                  if (i == locationsArray.length - 1)
                  {
                      dealerArrayReady(locationsArray);
                  }
              } else
              {
                  // We don't have coordinates from USA dealersearch... we have to ask google
                  var geocodeResults = function (index)
                  {
                      geocoder.geocode({
                          //address: data.dealer[index].address[0].street + ","
                          address: locationsArray[index].address[0].street + ","
                          + locationsArray[index].address[0].city + ","
                          + locationsArray[index].address[0].region
                      }, function (response, status)
                      {
                          locationsArray[index].theData = $.extend({}, replacementsData);
                          locationsArray[index].theData.NUMBER = index + 1;
                          locationsArray[index].theData.NAME = locationsArray[index].name;
                          locationsArray[index].theData.ADDRESS =
                              locationsArray[index].address[0].street + br
                              + locationsArray[index].address[0].city + ", <nobr>" + locationsArray[index].address[0].region + " "
                              + locationsArray[index].address[0].postalCode + "</nobr>";
                          locationsArray[index].theData.PHONE = locationsArray[index].address[0].phone;
                          locationsArray[index].theData.PHONEHREF = "tel:" + locationsArray[index].address[0].phone;
                          locationsArray[index].theData.LINKHREF = locationsArray[index].url;
                          locationsArray[index].theData.LINK = locationsArray[index].url;
                          locationsArray[index].theData.IMAGEURL = locationsArray[index].details.dealer_image || document.location.protocol + '//' + document.location.host + '/all/dealer2/assets/images/default_wide.jpg';
                          locationsArray[index].theData.HASIMGCLASS = "no-img";
                          locationsArray[index].theData.TYPECODE = 'unknown';

                          locationsArray[index].theData.SALESPHONE = locationsArray[index].details.sales.phone;
                          locationsArray[index].theData.SALESHOURS = locationsArray[index].details.sales.hours;

                          locationsArray[index].theData.SERVICEPHONE = locationsArray[index].details.service.phone;
                          locationsArray[index].theData.SERVICEHOURS = locationsArray[index].details.service.hours;

                          locationsArray[index].theData.PARTSPHONE = locationsArray[index].details.parts.phone;
                          locationsArray[index].theData.PARTSHOURS = locationsArray[index].details.parts.hours;

                          if(locationsArray[index].theData.FAX.replace(/\s/g,'') == "-") { 
                            ctdArray.push('fax');
                          }
                            
                          locationsArray[index].theData.ROUTE = "http://maps.apple.com/maps?q="
                              + locationsArray[index].address[0].street.replace(" ", "+") + ","
                              + locationsArray[index].address[0].postalCode.replace(" ", "+") + ","
                              + locationsArray[index].address[0].city.replace(" ", "+");

                          locationsArray[index].latLng = new google.maps.LatLng(response[0].geometry.location.lat(), response[0].geometry.location.lng());

                          geoCount++;
                          if (geoCount == locationsArray.length)
                          {
                              for (var finalIndex = 0; finalIndex < locationsArray.length; finalIndex++)
                              {
                                        if (SHOWALL || finalIndex < defaultNumberOfDealer)
                                {    
                                    iconMarker["default"].push(new google.maps.MarkerImage(iconPath, new google.maps.Size(26, 40), new google.maps.Point(0, finalIndex * 40)));
                                    iconMarker["mouseover"].push(new google.maps.MarkerImage(iconPathActive.exclusiveflagship, new google.maps.Size(26, 40), new google.maps.Point(0, finalIndex * 40)));

                                    if (typeof locationsArray[finalIndex].latLng == 'object')
                                    {
                                      // Apend Marker
                                      mapBounds.extend(locationsArray[finalIndex].latLng);
                                      var marker = new google.maps.Marker({
                                          position: locationsArray[finalIndex].latLng,
                                          map: map,
                                          cursor: (HASTOUCH) ? 'default' : 'pointer',
                                          title: '',
                                          icon: iconMarker["default"][finalIndex],
                                          infoWinHTML: replacePlaceholder(locationsArray[finalIndex].theData, infoboxHTML, ctdArray)
                                      });

                                      markers.push(marker);
                                      map.fitBounds(mapBounds);

                                      // event listener for click on Marker
                                      if (!HASTOUCH)
                                      {
                                        google.maps.event.addListener(marker, 'click', function ()
                                        {
                                          gotoPorscheCenter(this);
                                          iconMarkerClickedFlag = this.icon.origin.y/40;
                                          if(!!iconMarkerLastOne && iconMarkerLastOne != this.icon.origin.y/40) {
                                            iconMarkerLastOne.setIcon(iconMarker["default"][iconMarkerLastOne.icon.origin.y/40]); 
                                            iconMarkerLastOne = this;
                                          }
                                          iconMarkerLastOne = this;
                                        });
                                        google.maps.event.addListener(marker, 'mouseover', function ()
                                        {
                                          this.setIcon(iconMarker["mouseover"][this.icon.origin.y/40]);
                                        });
                                        google.maps.event.addListener(marker, 'mouseout', function ()
                                        {
                                          if(!!iconMarkerLastOne && iconMarkerLastOne == this) {
                                          }else {this.setIcon(iconMarker["default"][this.icon.origin.y/40]); }  
                                        });
                                      }
                                      
                                    }
                                    // Append Data
                                    dealerResultList.append(replacePlaceholder(locationsArray[finalIndex].theData, singleDealerBoxTemplateUSA));
                                    if (finalIndex % 2 !== 0)
                                    {
                                      dealerResultList.append("<div class=\"separator\">");
                                    }
                                  }
                              }
                              new google.maps.event.trigger(markers[0], 'click');
                              toggleLoader();
                              dealerResultList.find('.m-13-dealer-marker-number, .m-13-dealer-name').click(function ()
                              {
                                new google.maps.event.trigger(markers[$(this).attr("data-number") - 1], 'click');
                              });
                              dealerArrayReady(locationsArray);
                          }
                      });
                  };
                  // But we must send them separately with a delay (google restrictions)
                  if (locationsArray.length > 9)
                  {
                      window.setTimeout($.proxy(geocodeResults, this, i), i * 600);
                  }
                  else
                  {
                      geocodeResults(i);
                  }
                  ctdArray = [];
                  
              }
          }
        }
        // init dealer scroll button
        dealerScrollButton = new DealerScrollButton();
      }

      function dealerArrayReady(locationsArray)
        {
            if (GLOBAL_DEALER_WS == "LOCAL")
            {
              if (locationsArray.length == 1)
              {
                map.setCenter(new google.maps.LatLng(locationsArray[0].Coordinates.Lat, locationsArray[0].Coordinates.Lng));
                map.setZoom(16);
                if (!SHOWALL && locationsArray.length > 3) $('.m-13-show-all-dealers').show();
                $('.m-13-show-all-dealers').hide();

              } else
              {
                map.fitBounds(mapBounds);
                if (!SHOWALL && locationsArray.length > 3) $('.m-13-show-all-dealers').show();

              }
            }

            /*
             * Legend Processing
             */
            // Cleanup
            if (GLOBAL_CONFIG.dealersearch.UI_SHOW_TYPE_CODES)
            {
                if (dealerTypeLegend.hasClass(dealerTypeLegendHasTypesClassName))
                {
                    dealerTypeLegend.removeClass(dealerTypeLegendHasTypesClassName);
                    dealerTypeLegend.removeClass(function (i, c)
                    {
                        return (c.match(new RegExp("\\b" + dealerTypeLegendAddTypePrefixClassName + "\\S+", "g")) || []).join(' ');
                    });
                }
                // Display
                if (dealerResultTypesList.length >= minDealerResultTypesToDisplayLegend)
                {
                    var dealerResultTypeListClassNames = [];
                    for (var i = 0; i < dealerResultTypesList.length; i++)
                    {
                        dealerResultTypeListClassNames.push(dealerTypeLegendAddTypePrefixClassName + dealerResultTypesList[i]);
                    }
                    if (dealerResultTypeListClassNames.length > 0)
                    {
                        dealerResultTypeListClassNames.push(dealerTypeLegendHasTypesClassName);
                        dealerTypeLegend.addClass(dealerResultTypeListClassNames.join(' '));
                    }
                }
            }
            accordionInit();

            dealerWrapper.show();

            // Add deeplinks when search results loaded (in PS5)
            $(document).trigger('m-13-searchresult-ready');

            if (GLOBAL_DEALER_WS == "LOCAL")
            {
              toggleLoader();
              uniformDealerBoxes();

              $('.m-13-dealer-marker-number, .m-13-dealer-name').click(function ()
              {
                new google.maps.event.trigger(markers[$(this).attr("data-number") - 1], 'click');
              });
            }

            if (!SHOWALL && locationsArray.length > 3) $('.m-13-show-all-dealers').show();

        }

      function clearInfoWindows()
        {
          if (infoWindows)
          {
            for (var i in infoWindows)
            {
                infoWindows[i].close();
            }
            infoWindows.length = 0;
          }
        }

        function gotoPorscheCenter(marker)
        {
        
          clearInfoWindows();
          var infoWindow = new google.maps.InfoWindow({
              content: marker.infoWinHTML
          });
          infoWindows.push(infoWindow);
          infoWindow.open(map, marker);
          google.maps.event.addListener(infoWindow,'closeclick',function(e){
            iconMarkerLastOne.setIcon(iconMarker["default"][iconMarkerLastOne.icon.origin.y/40]);
            iconMarkerLastOne = null;
            $('.m-13-single-dealer-box').removeClass('mouseover');
          });
          google.maps.event.addListener(infoWindow, 'domready', function(e) {
          marker.setIcon(iconMarker["mouseover"][this.anchor.icon.origin.y/40]);
            $('.m-13-single-dealer-box').removeClass('mouseover');
            if(typeof this.anchor.icon != "undefined") {
              $('.m-13-dealer-scroll-wrapper').scrollTo('div.m-13-single-dealer-box:eq('+ this.anchor.icon.origin.y/40+')', {duration:100,axis:'y'});
            }
            $('.m-13-single-dealer-box').eq(this.anchor.icon.origin.y/40).addClass('mouseover');
          });
        }

        function loadMarketDealer()
        {

            hide_error();
            toggleLoader();

            var tmpDataurl = dataurl['market'].replace(/\[\[###STATE###\]\]/g, state);
			
			if(!!CURRENTCONDITION.length) {
				tmpDataurl = dataurl.condition; 
			}
			
            if (dataServiceProxy != "")
            {
                $.ajax({
                    url: dataServiceProxy,
                    type: 'POST',
                    data: {
                        address: tmpDataurl
                    },
                    success: processResult,
                    complete: function ()
                    {
                        googleTemplate(locationsArray)
                    }

                });
            } else
            {
                $.ajax({
                    url: tmpDataurl,
                    type: 'GET',
                    success: processResult,
                    complete: function ()
                    {
                        googleTemplate(locationsArray)
                    }
                });
            }

        }
		
		function geocoder_geocode($address) {
			
			geocoder.geocode({
				address: $address,
				region: GLOBAL_CONFIG.dealersearch.UI_MAP_DEFAULT_REGION
            }, function (response, status)
            {

                if (status == 'ZERO_RESULTS' || status == 'INVALID_REQUEST')
                {
                    homePos = false;
                    if(!GLOBAL_CONFIG.dealersearch.ENABLE_ADDRESS_SEARCH)
                    {
                        show_error(GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_SEARCHFAIL);
                        return false;
                    }
                }
                else
                {
                    homePos = {
                        coords: {
                            latitude: response[0].geometry.location.lat(),
                            longitude: response[0].geometry.location.lng()
                        }
                    };
                }

                var tmpDataurl = dataurl['proximity'].replace(/\[\[###POSITION###\]\]/g, homePos != false ? homePos.coords.latitude + '%7C' + homePos.coords.longitude : '');
                tmpDataurl = tmpDataurl.replace(/\[\[###ADDRESS###\]\]/g, encodeURIComponent(dataAddress));
                tmpDataurl = tmpDataurl.replace(/\[\[###STATE###\]\]/g, encodeURIComponent(GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCH_IN_STATE) || CURRENTCONDITION || "");

                // debugger;
                if (dataServiceProxy != "")
                {
                    $.ajax({
                        url: dataServiceProxy,
                        type: 'POST',
                        data: {
                            address: tmpDataurl
                        },
                        success: processResult,
                        complete: function ()
                        {
                            googleTemplate(locationsArray)
                        }

                    });
                } else
                {
                    $.ajax({
                        url: tmpDataurl,
                        type: 'GET',
                        success: processResult,
                        complete: function ()
                        {
                            googleTemplate(locationsArray)
                        }
                    });
                }
            });
		};

        $('.m-13-dealer-search-form').submit(function (event)
        {
            event.preventDefault();

            //TRACKING && TRACKING.page(ga_data[0].page[0].pool+"/"+ga_data[0].page[0].area+"/"+ga_data[0].page[0].name+"dealersearch/?searchkey="+$('.m-13-dealer-search-input').val()+"&searchcat=portal dealer search");
            if (getURLParameter('searchValue') != "null" || (getURLParameter('m-01-dealer-search-field') != '' && getURLParameter('m-01-dealer-search-field') != "null"))
            {
                // Searchtracking nur auslösen wenn die Suchanfrage nicht über URL-Parameter getriggert ist.
            } else
            {
                //            TRACKING && TRACKING.page("dealersearch/?searchkey=" + $('.m-13-dealer-search-input').val() + "&searchcat=portal dealer search");
            }

            $('.m-13-dealer-search-input').focus().blur();

            hide_error();
            toggleLoader();
            resetOthersInputFields(this);

            state = undefined;
            searchValue = $('.m-13-dealer-search-input').val();
            dataAddress = searchValue;

            var $address = $('.m-13-dealer-search-input').val();

            // 2015-08-12 [SK] - führende Nullen bei reiner Zahleneingabe von weniger als 5 stellen um gültige ZIP codes sicher zu stellen
            var $zipPattern = new RegExp(/^\d{1,4}$/);
            if (GLOBAL_CONFIG.pool == 'usa' && $zipPattern.test($address))
            {
                $address = $address.length >= 5 ? $address : new Array(5 - $address.length + 1).join('0') + $address;
            }
			
			
            // 2015-10-08 [ZT] -Die PLZ für Frankreich und Andorra hat max. 5 Stellen, wobei die ersten zwei Stellen oder die letzten zwei Stellen Buschstaben sein können
			
            var $zipPatternPOF = /(\b[0-9]{4,5}\b)|(\b[A-Z]{2,2}[0-9]{3,3}\b)|(\b[0-9]{3,3}[A-Z]{2,2}\b)/;
            if (GLOBAL_CONFIG.pool == 'france')
            {
                if ((typeof $address === 'string' && $address.length != 0 && $zipPatternPOF.test($address.toUpperCase())) || (/[^A-Z]/.test($address)))
                {
					$.get(window.location.protocol + "//" + window.location.hostname + "/all/Dealer2/GetLocationsWebService.asmx/GetDealerNameViaPostcode?postcode=" + $address + "&siteId=france", function (data) {
						$address += (" " + data.dealerName);
						geocoder_geocode($address);
						
					});

					return;
                }
                else
                {
                    show_error(GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_SEARCHFAIL);
		
                    return false;
                }
            }
			
			// 2017-05-16 [ZT] 
	                // der market australia needs to allow the user to find the center via postcode  
			
			if (GLOBAL_CONFIG.pool == 'australia' && (/\d{4}/.test($address)))
            {
                if (typeof $address === 'string' && $address.length != 0 && (/\d{4}/.test($address)))
                {
					$.get(window.location.protocol + "//" + window.location.hostname + "/all/Dealer2/GetLocationsWebService.asmx/GetDealerNameViaPostcode?postcode=" + $address + "&siteId=australia", function (data) {
						$address += (" " + data.dealerName);
						geocoder_geocode($address);
						
					});

					return;
                }
                else
                {
                    show_error(GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_SEARCHFAIL);
		
                    return false;
                }
            }
			
			
			
			
            if (GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHVALUE_EXTENSION != "")
            {
                $address = $address + ", " + GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCHVALUE_EXTENSION;
            }

			geocoder_geocode($address);
			
            return false;
        });

        $('.m-13-dealer-search-form-state').submit(function (evt)
        {
            evt.preventDefault();

            searchValue = undefined;
            var stateValue = $('.m-13-dealer-search-form-state select').val();
            //$stateSelect = stateValue:
            if (typeof stateValue === 'string' && stateValue !== '')
            {
                state = stateValue;
            } else
            {
                return;
            }

            TRACKING && TRACKING.page("dealersearch/?searchkey=STATE:" + state + "&searchcat=portal dealer search");

            hide_error();
            toggleLoader();
            resetOthersInputFields(this);

            var tmpDataurl = dataurl['state'].replace(/\[\[###STATE###\]\]/g, state);

            if (dataServiceProxy != "")
            {
                $.ajax({
                    url: dataServiceProxy,
                    type: 'POST',
                    data: {
                        address: tmpDataurl
                    },
                    success: processResult,
                    complete: function ()
                    {
                        googleTemplate(locationsArray)
                    }
                });
            } else
            {
                $.ajax({
                    url: tmpDataurl,
                    type: 'GET',
                    success: processResult,
                    complete: function ()
                    {
                        googleTemplate(locationsArray)
                    }
                });
            }

            return false;

        });


    };
    var baiduMap = function ()
    {

        function addMarker(point, index, sContent)
        {
            // baidu
            var myIcon = new BMap.Icon("/images/icon_pin-sprite-type_code-centre.png", new BMap.Size(26, 40), {
                offset: new BMap.Size(10, 25),
                imageOffset: new BMap.Size(0, 0 - index * 40)
            });

            var marker = new BMap.Marker(point, {icon: myIcon});
            var infoWindow = new BMap.InfoWindow(sContent);

            baiduMap.addOverlay(marker);
            marker.addEventListener("click", function ()
            {
                this.openInfoWindow(infoWindow);
                $('img[src$="iws3.png"]').hide();
            });
        }


        $.getScript('https://api.map.baidu.com/getscript?v=2.0&ak=B74b66c16dece8bc726d25dcf77b6399&services=&key=20141104111948&s=1', function ()
        {
            baiduMap = new BMap.Map("m-13-dealer-map-canvas");
            var top_left_navigation = new BMap.NavigationControl();
            var baiduMapLoaded = false;
            baiduMap.centerAndZoom(new BMap.Point(GLOBAL_CONFIG.dealersearch.UI_MAP_DEFAULTCOORDS_LNG, GLOBAL_CONFIG.dealersearch.UI_MAP_DEFAULTCOORDS_LAT), 6);
            baiduMap.addControl(new BMap.MapTypeControl());
            baiduMap.addControl(top_left_navigation);
            baiduMap.addEventListener("tilesloaded", function ()
            {
                if (getURLParameter('searchValue') != "null" || (getURLParameter('m-01-dealer-search-field') != '' && getURLParameter('m-01-dealer-search-field') != "null") && !!!baiduMapLoaded)
                {

                    searchValue = (decodeURI(getURLParameter('searchValue')) != "null") ? decodeURI(getURLParameter('searchValue')) : getURLParameter('m-01-dealer-search-field');
                    state = (decodeURI(getURLParameter('searchValueState')) != "null") ? decodeURI(getURLParameter('searchValueState')) : getURLParameter('m-01-dealer-search-field');

                    if (searchValue == "currentLocation")
                    {
                        $('.m-13-find-dealer-localization').trigger('click');
                    }
                    else if (typeof searchValue == 'string' && searchValue.length > 0 && searchValue != 'undefined')
                    {
                        $('.m-13-dealer-search-input').val(searchValue);
                        $('.m-13-dealer-search-form').submit();
                    }
                    else if (typeof state == 'string' && state.length > 0 && state != 'undefined')
                    {
                        state = state.toUpperCase();
                        $('.m-13-dealer-search-form-state select').val(state).select2('val', state);
                        $('.m-13-dealer-search-form-state').submit();
                    }
                }
                baiduMapLoaded = true;
            });

            function baiduTemplate(locationsArray, tmpDataurl)
            {

                if (typeof locationsArray === "undefined") return;
                baiduMap.clearOverlays();

                var chinesedataobject = {'zh': []};

                if (CURRENTLANGUAGE === "en")
                {
                    $.ajax({
                        url: tmpDataurl,
                        type: 'GET',
                        success: function (data)
                        {
                            chinesedataobject['zh'] = $.xml2json(data).ListofLocations.Location;
                        },
                        complete: function ()
                        {

                            for (var i = 0; i < locationsArray.length; i++)
                            {
                                iconPath = iconPathActive.unknown;

                                if (GLOBAL_DEALER_WS == "LOCAL")
                                {
                                    replacementsData.NUMBER = i + 1;

                                    if (GLOBAL_CONFIG.dealersearch.UI_SHOW_TYPE_CODES)
                                    {
                                        replacementsData.TYPECODE = locationsArray[i].TypeCode;
                                        replacementsData.TYPECODE = (typeof replacementsData.TYPECODE == 'string' && replacementsData.TYPECODE != '' ? replacementsData.TYPECODE : 'unknown');
                                        if (replacementsData.TYPECODE != 'unknown' && $.inArray(replacementsData.TYPECODE, dealerResultTypesList))
                                        {
                                            dealerResultTypesList.push(replacementsData.TYPECODE);
                                        }
                                    } else
                                    {
                                        replacementsData.TYPECODE = 'unknown';
                                    }

                                    replacementsData.NAME = locationsArray[i].Name;
                                    replacementsData.ADDRESS = (GLOBAL_CONFIG.pool == 'japan' && GLOBAL_CONFIG.language == 'jp') ? (((locationsArray[i].AddressData.PostCode != "" && locationsArray[i].AddressData.PostCode != undefined) ? (locationsArray[i].AddressData.PostCode + " ") : "") + br + ((locationsArray[i].StateName != "" && locationsArray[i].StateName != undefined) ? (locationsArray[i].StateName + " ") : "") + ((locationsArray[i].AddressData.City != "" && locationsArray[i].AddressData.City != undefined) ? (locationsArray[i].AddressData.City + " ") : "") + locationsArray[i].AddressData.Street) : (locationsArray[i].AddressData.Street + br + ((locationsArray[i].AddressData.PostCode != "" && locationsArray[i].AddressData.PostCode != undefined) ? (locationsArray[i].AddressData.PostCode + " ") : "") + ((locationsArray[i].AddressData.City != "" && locationsArray[i].AddressData.City != undefined) ? (locationsArray[i].AddressData.City + " ") : ""));
                                    replacementsData.PHONE = (locationsArray[i].AddressData.Phone != "" && locationsArray[i].AddressData.Phone != undefined) ? locationsArray[i].AddressData.Phone : "-";
                                    replacementsData.PHONEHREF = "tel:" + locationsArray[i].AddressData.Phone;
                                    replacementsData.FAX = (locationsArray[i].AddressData.Fax != "" && locationsArray[i].AddressData.Fax != undefined) ? locationsArray[i].AddressData.Fax : "-";
                                    replacementsData.EMAIL = (GLOBAL_CONFIG.pool == 'japan' && GLOBAL_CONFIG.language == 'jp') ? '' : ((locationsArray[i].Email1 != "" && locationsArray[i].Email1 != undefined) ? "<a class=\"gui-link\" href=\"mailto:" + locationsArray[i].Email1 + "\">" + locationsArray[i].Email1 + "</a>" : "-");
                                    replacementsData.LINKHREF = locationsArray[i].Url1;
                                    replacementsData.LINK = locationsArray[i].Url1;
                                    replacementsData.IMAGEURL = dealerImageBaseURL + locationsArray[i].InfoWinThumbPath;
                                    replacementsData.HASIMGCLASS = (locationsArray[i].InfoWinThumbPath == '') ? 'no-img' : '';

                                    replacementsData.ROUTE = "https://api.map.baidu.com/marker?s=1&location=" + locationsArray[i].Coordinates["Lat"] + "," + locationsArray[i].Coordinates["Lng"] + "&amp;title=&amp;content=" + locationsArray[i]["Name"] + "," + locationsArray[i]["AddressData"]["City"] + "&amp;output=html&operate=jsapi_message";

                                    var typeLegendPattern = typeLabels[replacementsData.TYPECODE];

                                    replacementsData.TYPE_LEGEND = "";
                                    if ($.isArray(typeLegendPattern) && typeLegendPattern.length > 0)
                                    {
                                        replacementsData.TYPE_LEGEND = '<div class="m-13-dealers-type-legend">';
                                        for (var tlpi = 0; tlpi < typeLegendPattern.length; tlpi++)
                                        {
                                            var tlpLabel;
                                            try
                                            {
                                                tlpLabel = GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_TYPE_CODE_LEGEND[typeLegendPattern[tlpi]];
                                            } catch (ex)
                                            {
                                                tlpLabel = '';
                                            }
                                            if (typeof tlpLabel == 'string' && tlpLabel.length > 0)
                                            {
                                                replacementsData.TYPE_LEGEND += '<span class="';
                                                replacementsData.TYPE_LEGEND += typeLegendPattern[tlpi];
                                                if (tlpi + 1 == typeLegendPattern.length)
                                                {
                                                    replacementsData.TYPE_LEGEND += ' last';
                                                }
                                                replacementsData.TYPE_LEGEND += '">';

                                                replacementsData.TYPE_LEGEND += GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_TYPE_CODE_LEGEND[typeLegendPattern[tlpi]];
                                                replacementsData.TYPE_LEGEND += '</span>';

                                            }
                                        }
                                        replacementsData.TYPE_LEGEND += '</div>';
                                    }


                                    if (SHOWALL || i < 3)
                                    {
                                        dealerResultList.append(
                                            replacePlaceholder(replacementsData, singleDealerBoxTemplate)
                                        );
                                    }

                                    if (i == locationsArray.length - 1)
                                    {
                                        dealerArrayReady(locationsArray);
                                    }


                                }

                                var point = new BMap.Point(locationsArray[i].Coordinates.Lng, locationsArray[i].Coordinates.Lat);
                                addMarker(point, i, replacePlaceholder(replacementsData, infoboxHTML));
                            }
                        }
                    });
                } else
                {
                    for (var i = 0; i < locationsArray.length; i++)
                    {
                        iconPath = iconPathActive.unknown;

                        if (GLOBAL_DEALER_WS == "LOCAL")
                        {
                            replacementsData.NUMBER = i + 1;

                            if (GLOBAL_CONFIG.dealersearch.UI_SHOW_TYPE_CODES)
                            {
                                replacementsData.TYPECODE = locationsArray[i].TypeCode;
                                replacementsData.TYPECODE = (typeof replacementsData.TYPECODE == 'string' && replacementsData.TYPECODE != '' ? replacementsData.TYPECODE : 'unknown');
                                if (replacementsData.TYPECODE != 'unknown' && $.inArray(replacementsData.TYPECODE, dealerResultTypesList))
                                {
                                    dealerResultTypesList.push(replacementsData.TYPECODE);
                                }
                            } else
                            {
                                replacementsData.TYPECODE = 'unknown';
                            }

                            replacementsData.NAME = locationsArray[i].Name;
                            replacementsData.ADDRESS = (GLOBAL_CONFIG.pool == 'japan' && GLOBAL_CONFIG.language == 'jp') ? (((locationsArray[i].AddressData.PostCode != "" && locationsArray[i].AddressData.PostCode != undefined) ? (locationsArray[i].AddressData.PostCode + " ") : "") + br + ((locationsArray[i].StateName != "" && locationsArray[i].StateName != undefined) ? (locationsArray[i].StateName + " ") : "") + ((locationsArray[i].AddressData.City != "" && locationsArray[i].AddressData.City != undefined) ? (locationsArray[i].AddressData.City + " ") : "") + locationsArray[i].AddressData.Street) : (locationsArray[i].AddressData.Street + br + ((locationsArray[i].AddressData.PostCode != "" && locationsArray[i].AddressData.PostCode != undefined) ? (locationsArray[i].AddressData.PostCode + " ") : "") + ((locationsArray[i].AddressData.City != "" && locationsArray[i].AddressData.City != undefined) ? (locationsArray[i].AddressData.City + " ") : ""));
                            replacementsData.PHONE = (locationsArray[i].AddressData.Phone != "" && locationsArray[i].AddressData.Phone != undefined) ? locationsArray[i].AddressData.Phone : "-";
                            replacementsData.PHONEHREF = "tel:" + locationsArray[i].AddressData.Phone;
                            replacementsData.FAX = (locationsArray[i].AddressData.Fax != "" && locationsArray[i].AddressData.Fax != undefined) ? locationsArray[i].AddressData.Fax : "-";
                            replacementsData.EMAIL = (GLOBAL_CONFIG.pool == 'japan' && GLOBAL_CONFIG.language == 'jp') ? '' : ((locationsArray[i].Email1 != "" && locationsArray[i].Email1 != undefined) ? "<a class=\"gui-link\" href=\"mailto:" + locationsArray[i].Email1 + "\">" + locationsArray[i].Email1 + "</a>" : "-");
                            replacementsData.LINKHREF = locationsArray[i].Url1;
                            replacementsData.LINK = locationsArray[i].Url1;
                            replacementsData.IMAGEURL = dealerImageBaseURL + locationsArray[i].InfoWinThumbPath;
                            replacementsData.HASIMGCLASS = (locationsArray[i].InfoWinThumbPath == '') ? 'no-img' : '';
                        
							if(!!locationsArray[i].Mapslink) {
								replacementsData.ROUTE = locationsArray[i].Mapslink;
							} else {
								replacementsData.ROUTE = "https://map.baidu.com/?s=1&newmap=1&amp;ie=utf-8&amp;s=s%26wd%3D" + encodeURIComponent(locationsArray[i].Name);
							}
						
						}


                        var typeLegendPattern = typeLabels[replacementsData.TYPECODE];

                        replacementsData.TYPE_LEGEND = "";
                        if ($.isArray(typeLegendPattern) && typeLegendPattern.length > 0)
                        {
                            replacementsData.TYPE_LEGEND = '<div class="m-13-dealers-type-legend">';
                            for (var tlpi = 0; tlpi < typeLegendPattern.length; tlpi++)
                            {
                                var tlpLabel;
                                try
                                {
                                    tlpLabel = GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_TYPE_CODE_LEGEND[typeLegendPattern[tlpi]];
                                } catch (ex)
                                {
                                    tlpLabel = '';
                                }
                                if (typeof tlpLabel == 'string' && tlpLabel.length > 0)
                                {
                                    replacementsData.TYPE_LEGEND += '<span class="';
                                    replacementsData.TYPE_LEGEND += typeLegendPattern[tlpi];
                                    if (tlpi + 1 == typeLegendPattern.length)
                                    {
                                        replacementsData.TYPE_LEGEND += ' last';
                                    }
                                    replacementsData.TYPE_LEGEND += '">';

                                    replacementsData.TYPE_LEGEND += GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_TYPE_CODE_LEGEND[typeLegendPattern[tlpi]];
                                    replacementsData.TYPE_LEGEND += '</span>';

                                }
                            }
                            replacementsData.TYPE_LEGEND += '</div>';
                        }


                        if (SHOWALL || i < 3)
                        {
                            dealerResultList.append(
                                replacePlaceholder(replacementsData, singleDealerBoxTemplate)
                            );
                        }

                        if (i == locationsArray.length - 1)
                        {
                            dealerArrayReady(locationsArray);
                        }

                        var point = new BMap.Point(locationsArray[i].Coordinates.Lng, locationsArray[i].Coordinates.Lat);
                        addMarker(point, i, replacePlaceholder(replacementsData, infoboxHTML));
                    }
                }
            }

            function resultFromTheSearch(lang)
            {
                var _URL = "https://api.map.baidu.com/geocoder/v2/?s=1&ak=B74b66c16dece8bc726d25dcf77b6399&output=json&address=" + encodeURIComponent(searchValue) + "&city=" + encodeURIComponent(searchValue);
                $.ajax({
                    dataType: 'jsonp',
                    contentType: "application/json;charset=utf-8",
                    type: 'GET',
                    url: _URL,
                    success: function (data)
                    {

                        if (!!data.msg)
                        {
                            show_error(GLOBAL_CONFIG.dealersearch.UI_STRINGCONST_SEARCHFAIL);
                            return false;
                        }

                        homePos = {
                            coords: {
                                latitude: data.result.location.lat,
                                longitude: data.result.location.lng
                            }
                        }

                        var tmpDataurl = dataurl['proximity'].replace(/\[\[###POSITION###\]\]/g, homePos.coords.latitude + '%7C' + homePos.coords.longitude);
                        tmpDataurl = tmpDataurl.replace(/\[\[###ADDRESS###\]\]/g, encodeURIComponent(dataAddress));
                        tmpDataurl = tmpDataurl.replace(/\[\[###STATE###\]\]/g, encodeURIComponent(GLOBAL_CONFIG.dealersearch.UI_GHS_SEARCH_IN_STATE));

                        if (dataServiceProxy != "")
                        {
                            $.ajax({
                                url: dataServiceProxy,
                                type: 'POST',
                                data: {
                                    address: tmpDataurl
                                },
                                success: processResult,
                                complete: function ()
                                {
                                    baiduTemplate(locationsArray)
                                }
                            });
                        } else
                        {
                            $.ajax({
                                url: tmpDataurl,
                                type: 'GET',
                                success: processResult,
                                complete: function ()
                                {
                                    baiduTemplate(locationsArray, tmpDataurl)
                                }
                            });
                        }
                        if (searchValue != '')
                        {
                            baiduMap.centerAndZoom(new BMap.Point(data.result.location.lng, data.result.location.lat), 11);
                        }
                    }
                });
            };
            function dealerArrayReady(locationsArray)
            {
                if (GLOBAL_DEALER_WS == "LOCAL")
                {
                }

                /*
                 * Legend Processing
                 */
                // Cleanup
                if (GLOBAL_CONFIG.dealersearch.UI_SHOW_TYPE_CODES)
                {
                    if (dealerTypeLegend.hasClass(dealerTypeLegendHasTypesClassName))
                    {
                        dealerTypeLegend.removeClass(dealerTypeLegendHasTypesClassName);
                        dealerTypeLegend.removeClass(function (i, c)
                        {
                            return (c.match(new RegExp("\\b" + dealerTypeLegendAddTypePrefixClassName + "\\S+", "g")) || []).join(' ');
                        });
                    }
                    // Display
                    if (dealerResultTypesList.length >= minDealerResultTypesToDisplayLegend)
                    {
                        var dealerResultTypeListClassNames = [];
                        for (var i = 0; i < dealerResultTypesList.length; i++)
                        {
                            dealerResultTypeListClassNames.push(dealerTypeLegendAddTypePrefixClassName + dealerResultTypesList[i]);
                        }
                        if (dealerResultTypeListClassNames.length > 0)
                        {
                            dealerResultTypeListClassNames.push(dealerTypeLegendHasTypesClassName);
                            dealerTypeLegend.addClass(dealerResultTypeListClassNames.join(' '));
                        }
                    }
                }
                accordionInit();

                dealerWrapper.show();

                if (GLOBAL_DEALER_WS == "LOCAL")
                {
                    toggleLoader();
                    uniformDealerBoxes();

                    $('.m-13-dealer-marker-number, .m-13-dealer-name').click(function ()
                    {
                        $('#m-13-dealer-map-canvas .BMap_Marker.BMap_noprint').eq($(this).attr("data-number") - 1).click();
                    });
                }

                if (!SHOWALL && locationsArray.length > 3) $('.m-13-show-all-dealers').show();
            }

            $('.m-13-dealer-search-form').submit(function (event)
            {

                //TRACKING && TRACKING.page(ga_data[0].page[0].pool+"/"+ga_data[0].page[0].area+"/"+ga_data[0].page[0].name+"dealersearch/?searchkey="+$('.m-13-dealer-search-input').val()+"&searchcat=portal dealer search");
                if (getURLParameter('searchValue') != "null" || (getURLParameter('m-01-dealer-search-field') != '' && getURLParameter('m-01-dealer-search-field') != "null"))
                {
                    // Searchtracking nur auslösen wenn die Suchanfrage nicht über URL-Parameter getriggert ist.
                } else
                {
//            TRACKING && TRACKING.page("dealersearch/?searchkey=" + $('.m-13-dealer-search-input').val() + "&searchcat=portal dealer search");
                }

                $('.m-13-dealer-search-input').focus().blur();

                hide_error();
                toggleLoader();
                event.preventDefault;

                state = undefined;
                searchValue = $('.m-13-dealer-search-input').val();
                dataAddress = searchValue;

                if (CURRENTLANGUAGE == 'en' || (CURRENTLANGUAGE == 'zh' && /([a-zA-Z])\w+/.test(searchValue)))
                {
                    var chinacitylist = function (data)
                    {
                        if (data.geonames.length != 0)
                        {
                            var cityListLength = data.geonames[0].alternateNames.length;
                            for (var i = 0; i < cityListLength; i++)
                            {
                                if (data.geonames[0].alternateNames[i].lang == 'zh')
                                {
                                    searchValue = data.geonames[0].alternateNames[i].name;
                                }
                            }
                        }
                        else
                        {
                            searchValue = '';
                        }
                        resultFromTheSearch(CURRENTLANGUAGE);
                    };

                    window.chinacitylist = chinacitylist

                    var suwd_search_url = "http://ba-ws.geonames.net/searchJSON?callback=chinacitylist&userName=udg2015&lang=en&featureClass=P&style=full&name_startsWith=" + encodeURIComponent(dataAddress);
                    $.get(document.location.protocol + '//' + document.location.host + "/all/dealer2/" + "GetLocationsWebService.asmx/GetChinaCity?&siteId=" + CURRENTPOOL + "&city=" + searchValue, function (result)
                    {
                        if ($(result)[0].documentElement.textContent == "")
                        {
                            $.ajax({
                                dataType: 'jsonp',
                                contentType: "application/json;charset=utf-8",
                                type: 'GET',
                                url: suwd_search_url
                            });
                        }
                        else
                        {
                            searchValue = $(result)[0].documentElement.textContent;
                            resultFromTheSearch(CURRENTLANGUAGE);
                        }
                    });
                }
                else
                {
                    resultFromTheSearch(CURRENTLANGUAGE);
                }
                return false;
            });
        });
    }
    return {
        initGoogle: googleMap,
        initBaidu: baiduMap
    }
}


// --------------------------------------------------------------------------------
// Main JS
//
// Funktionen, die auf jeder Seite geladen werden müssen.
//
// Dementsprechend MUSS dieses Javascript auch auf jeder Seite eingebunden werden!
// --------------------------------------------------------------------------------


///////////////////////////////////////////////////
// STV:
//  >> PS5 related variables
//  >> die Globals werden vom CMS automatisch befüllt
//////
var GLOBAL_CONFIG = GLOBAL_CONFIG || {};
GLOBAL_CONFIG.currentMainNavigationArea = GLOBAL_CONFIG.currentMainNavigationArea || '';
GLOBAL_CONFIG.pool = GLOBAL_CONFIG.pool || 'germany'; //'germany';
GLOBAL_CONFIG.language = GLOBAL_CONFIG.language ||'none';
GLOBAL_CONFIG.region = GLOBAL_CONFIG.region || '';
GLOBAL_CONFIG.loadPsyma = GLOBAL_CONFIG.loadPsyma || '';
GLOBAL_CONFIG.home = GLOBAL_CONFIG.home || false;
GLOBAL_CONFIG.isLocal = GLOBAL_CONFIG.isLocal || false;
//GLOBAL_CONFIG.currentpool = GLOBAL_CONFIG.pool || 'germany';

// DealerSearch
GLOBAL_CONFIG.dealersearch = GLOBAL_CONFIG.dealersearch || {};
GLOBAL_CONFIG.dealersearch.porschedealerLocatorURL = GLOBAL_CONFIG.dealersearch.porschedealerLocatorURL || 'http://porschedealer.com/dealer/usLocator/?zip=[[###ZIP###]]&page=search';

// popup window size config
GLOBAL_CONFIG.popup = GLOBAL_CONFIG.popup || {};
GLOBAL_CONFIG.popup.CC = GLOBAL_CONFIG.popup.CC || { 'height': 680, 'width': 980, "targetWindow": "ccmodelstart" };
GLOBAL_CONFIG.popup.MC = GLOBAL_CONFIG.popup.MC || { 'height': 680, 'width': 980, "targetWindow": "modelcompare" };

// BPGs
GLOBAL_CONFIG.bpgImage = GLOBAL_CONFIG.bpgImage || { workerUrl: '/redesign-scripts/vendor/bpgdecoder.min2.js' };

GLOBAL_CONFIG.debugLogging = true;

GLOBAL_CONFIG.vieport = parseInt($('html').css('content').replace(/["']/g, ""));

var GLOBAL_HELPER = GLOBAL_HELPER || {

        "scrollTo": function(elementID, offset) {
            $('body, html').stop().animate({scrollTop:$(elementID).offset().top - offset}, 500, 'swing');
        }

    };


//////////////////////////////////////////
//
// exclude all of the followiung images from autoamtic scaling:
// * images in legacy modules
// * images that need delayed loading (e.g. royal slider)
// * iamges of all new modules that trigger image scaling manually
//   via the new ScaleHandler() class
var imageExcludes = ".m-01-model-figure > img "
                  + ", .zoomImage img "
                  + ", .ce-media-wrapper img "
                  + ", .m-04-intro-section-home-slider img "
                  + ", .m-08-features-slider img"
                  + ", .m-09-techspecs-compare img"
                  + ", .m-09-techspecs-details img"
                  + ", .m-63-slider-wrapper img"
                  + ", .m-36-image-reel img.image-intro"
                  + ", .m-36-image-reel img.image-loop"
                  + ", .m-36-image-reel .m-36__poster img"
                  + ", .m-39-gallery img "
                  + ", .m-73-model-teaser img "
                  + ", .m-64-model-selection img "
                  + ", .m-71-extended-teaser img "
                  + ", .m-102-slider img "
                  + ", .m-107-tile img "
                  + ", .m-128-shopping-tools__tile img "
                  + ", .m-128-shopping-tools__tile--nogutter img "
                  + ", .m-66-tile img "
                  + ", .m-66-tile2 img "
                  + ", .m-66-tile3 img "
                  + ", .m-66-tile4 img "
                  + ", .m-105-tile__image "
                  + ", .m-101__menuitem--image img "
                  + ", .main-teaser__slider .main-teaser__background-image "
                  + ", .m-74-model-image "
                  + ", .m-080__modelseries-intro img "
                  + ", .m-082__embedded-form img "
                  + ", .m-108 img "
                  + ", .m-109 img "
                  + ", .m-131 img "
                  + ", .story-telling img"
                  + ", .m-164-model-selector img "
                  + ", .m-052 img"
                  + ", .m-053__images img "
                  + ", .m-056 img"
                  + ", .m-058 img"
                  + ", .m-14-image-wrapper img "
                  + ", .m-082__form-background-imag"
;
//
//////////////////////////////////////////

///////////////////////////////////////////////////
/// 
/// POPUP: Objekt zum öffnen von neuen Fenstern
///
/// >> nur folgende Funktion sollte verwendet verwenden:
/// 
///    POPUO.OPEN - Zum Öffnen einer URL in einem neuen Fenster.
///                 Spezielle Settings für Fenstergröße und Fenstereigenschaften sind im Zuge der Verwendung 
///                 von Mobil-Geräten nicht mehr zeitgemäß und sollten vermieden werden.
///
///                 Es ist daher Absicht, dass hier nur die URL übergeben werden kann.
///                 
///
///  >> folgende Funktionen sind für von der Website automatisch generierte Aufrufe 
///  
///    CC_Overview - CC Modellübersichtsseite
///    
///    CC          - CC Modell Deeplink
///
/// >> alle weiteren Funktionen sind  nur zur internen Verwendung gedacht
/// 
///
var POPUP = POPUP || {

  // popup function: generic function to open a new window
  "OPEN": this.OPEN || function (urlTarget) {
    var popupParams = this.windowParams();

    if (urlTarget.indexOf('+') > -1) {
      urlTarget = urlTarget.replace(/\+/g, '%2B');
    }

    // SV: add htmlDecode
    popupParams.urlTarget = this.htmlDecode(urlTarget);

    this.openPopup(popupParams);
  },

  // popup function: CC model overview page
  "CC_Overview": this.CC_Overview || function (urlTarget) {
    if (urlTarget.indexOf('http://') === 0) {
      this.CC(urlTarget);
      return;
    }
    var popupParams = this.windowParams();

    popupParams.urlTarget = urlTarget;
    popupParams.targetWindow = GLOBAL_CONFIG.popup.CC.targetWindow;
    //popupParams.height = GLOBAL_CONFIG.popup.CC.height;
    //popupParams.width = GLOBAL_CONFIG.popup.CC.width;
    //popupParams.replace = true;
    popupParams.toolbar = 0;
    popupParams.menubar = 0;

    this.openPopup(popupParams);
  },

  // popup function: CC model deeplink
  "CC": this.CC || function (urlTarget) {
    var popupParams = this.windowParams();

    popupParams.urlTarget = this.addCCParams(urlTarget);
    popupParams.targetWindow = GLOBAL_CONFIG.popup.CC.targetWindow;
    //popupParams.height = GLOBAL_CONFIG.popup.CC.height;
    //popupParams.width = GLOBAL_CONFIG.popup.CC.width;
    //popupParams.replace = true;
    popupParams.toolbar = 0;
    popupParams.menubar = 0;

    this.openPopup(popupParams);
  },

  // popup function: CC model deeplink
  "MC": this.MC || function (urlTarget) {
    var popupParams = this.windowParams();

    popupParams.urlTarget = this.addCCParams(urlTarget);
    popupParams.targetWindow = GLOBAL_CONFIG.popup.MC.targetWindow;
    popupParams.height = GLOBAL_CONFIG.popup.MC.height;
    popupParams.width = GLOBAL_CONFIG.popup.MC.width;
    popupParams.replace = true;

    this.openPopup(popupParams);
  },

  // internal: open a new window
  "openPopup": this.openPopup || function (popupParams) {
    if (typeof (popupParams) === undefined) {
      return false;
    }

    if (typeof (popupParams.urlTarget) === undefined) {
      return false;
    }

    if ((popupParams.urlTarget.indexOf('http') !== 0) && (popupParams.urlTarget.indexOf('/') !== 0)) {
      return false;
    }

    // open in current window

    var targetWindow = popupParams.targetWindow;

    if (typeof (window.name) !== undefined) {
      if (window.name === targetWindow) {
        targetWindow = "_self";
      }
    }

    var newWin = window.open(popupParams.urlTarget,
        targetWindow,
        this.buildFeaturelist(popupParams),
        popupParams.replace);
    try {
      newWin.name = popupParams.targetWindow;
    }
    catch (ex) {

    }
    //console.log(newWin.name);

    return (newWin);
  },

  // internal: json object for setting window parameters
  "windowParams": function () {
    return {
      // target
      "urlTarget": "",
      "targetWindow": "_blank",

      // size
      "height": 0,
      "width": 0,

      // replace history
      "replace": false,

      // window properties
      "location": "1",
      "menubar": "1",
      "resizable": "1",
      "scrollbars": "1",
      "status": "1",
      "titlebar": "1",
      "toolbar": "1"
    };
  },

  // internal: utility function to build the feature list for window.oppen()
  "buildFeaturelist": function (popupParams) {
    return "location=" + popupParams.location
        + ",menubar=" + popupParams.menubar
        + ",resizable=" + popupParams.resizable
        + ",scrollbars=" + popupParams.scrollbars
        + ",status=" + popupParams.status
        + ",titlebar=" + popupParams.titlebar
        + ",toolbar=" + popupParams.toolbar
        + ((popupParams.height < 100) ? "" : ",height=" + popupParams.height)
        + ((popupParams.width < 100) ? "" : ",width=" + popupParams.width);
  },

  // internal: append random parameter (used for CC)
  "buildRandomParam": function () {
    return "rt=" + (Math.round(new Date().getTime() / 1000));
  },

  // internal: append screen resolution parameter (used for CC)
  "addCCParams": this.addCCParams || function (urlTarget) {
    urlTarget = this.appendParam(urlTarget, "screen=" + screen.width + "x" + screen.height);
    urlTarget = this.appendParam(urlTarget, this.buildRandomParam());
    return urlTarget;
  },

  // internal: append parameter to popup URL
  "appendParam": function (url, p) {
    return url.split('?')[0] + '?' + p + '&' + url.split('?')[1];
  },

  //internal: decode HTML entities in URL (e.g. &amp;)
  "htmlDecode": function (value) {
    var $elem = $('<textarea></textarea>');
    $elem.html(value);
    return $elem.text();
  }
};
///////////////////////////////////////////////////

var LANDINGPAGE = LANDINGPAGE || {};

/*-------------------------------------- */
/* Namespace generator*/
/*-------------------------------------- */
LANDINGPAGE.namespace = function (ns_string) {
  var parts = ns_string.split('.'),
      parent = LANDINGPAGE,
      i;

  if (parts[0] === "LANDINGPAGE") {
    parts = parts.slice(1);
  }

  for (i = 0; i < parts.length; i += 1) {
    if (typeof parent[parts[i]] === "undefined") {
      parent[parts[i]] = {};
    }
    parent = parent[parts[i]];
  }

  return parent;
};

var LOG_DEBUG = false;
var Logger = {
  error: function (msg) {
    if (typeof (console) !== 'undefined') {
      console.log("ERROR " + msg);
    }
  },
  debug: function (msg) {
    if (typeof (console) !== 'undefined') {
      console.log("DEBUG " + msg);
    }
  }
};

///////////////////////////////////////////////////
/// 
/// SHARING: Objekt zum teilen von von Inhalten
///
/// >> internal config properties:
///    Diese werden von der Website im <head> definiert.
///    
///  >> SHARE - Funktion zum Teilen von Inhalten auf Social Media Platformen
///  
/// 
var SHARING = SHARING || {};
jQuery.extend(true, SHARING, {
  // internal config properties with empty default values
  //"enabled": this.enabled || false,
  "sharingHost": this.sharingHost || "http://www.porsche.com",
  "images": [],
  "tracking": {},
  "services": {},

  // funktion zum Teilen der Inhalte
  "SHARE": function (serviceID, URL, title, text, mediaRef) {
    var encode = true; //this.settings.urlEncode;

    if (this.services[serviceID] === undefined) {
      return serviceID + ' is missing.';
    }

    var shareURL = this.services[serviceID].shareurl;

    var shareData_json = this.getShareData(serviceID, URL, title, text, mediaRef);

    shareURL = shareURL.replace(/#TITLE#/g, (encode) ? encodeURIComponent(shareData_json.shareTitle) : shareData_json.shareTitle);
    shareURL = shareURL.replace(/#TEXT#/g, (encode) ? encodeURIComponent(shareData_json.shareText) : shareData_json.shareText);
    shareURL = shareURL.replace(/#MEDIA#/g, (encode) ? encodeURIComponent(shareData_json.mediaRef) : shareData_json.mediaRef);
    shareURL = shareURL.replace(/#URL#/g, (encode) ? encodeURIComponent(shareData_json.composedShareURL) : shareData_json.composedShareURL);

    if (serviceID === 'facebook') {
      shareURL = shareURL.replace(/&#91;/mg, "[");
      shareURL = shareURL.replace(/&#93;/mg, "]");
    }

    TRACKING && TRACKING.social(serviceID, 'share', shareURL);

    shareURL = shareURL.replace('%3Fpc', '&amp;pc');

    // sharing for whatsapp --> needs href
    if (this.enabled && serviceID === 'whatsapp') {
      window.location.href = shareURL;
    }
    else if (this.enabled) {
      return POPUP.OPEN(shareURL);
    }
    else {
      return shareURL;
    }
  },

  // internal: collect page data and build share URL
  "getShareData": function (serviceID, URL, title, text, mediaRef) {
    // URL
    if (URL === undefined) {
      URL = this.sharingHost + document.location.pathname;
    }

    URL += (URL.indexOf('?') >= 0 ? '&' : '?') + 'pc=' + this.tracking.ga.replace(/#TRACKID#/g, this.services[serviceID].trackid);

    // Title
    if (title === undefined) {
      title = $('meta[property="og:title"]').attr('content');
    }

    // Description
    if (text === undefined) {
      text = $('meta[property="og:description"]').attr('content');
      //shareExtendedText = $('meta[name="description"]').attr('content');
    }

    // MediaRef
    if (mediaRef === undefined) {
      mediaRef = $('meta[property="og:image"]').attr('content');
    }

    return { "shareTitle": title || "", "shareText": text || "", "mediaRef": mediaRef || "", "composedShareURL": URL };
  }
});

///////////////////////////////////////////////////
/// 
/// BROWSER: Hilfsobjekt für die Browserdetection über modernizr
///
/// >> internal config properties:
///    Diese werden von der Website im <head> definiert.
///    
///  
///  
/// 
var BROWSER = BROWSER || {};
jQuery.extend(true, BROWSER, {

  detect: function () {
    this.browser = this.searchString(this.dataBrowser) || "Other";
    this.version = this.searchVersion(navigator.userAgent) || this.searchVersion(navigator.appVersion) || "Unknown";
    this.os = this.searchString(this.dataOs) || "Other";
  },
  searchString: function (data) {
    for (var i = 0; i < data.length; i++) {
      var dataString = data[i].string;
      this.versionSearchString = data[i].subString;

      if (dataString.indexOf(data[i].subString) !== -1) {
        return data[i].identity;
      }
    }
  },
  searchVersion: function (dataString) {
    var index = dataString.indexOf(this.versionSearchString);
    if (index === -1) {
      return;
    }

    var rv = dataString.indexOf("rv:");
    if (this.versionSearchString === "Trident" && rv !== -1) {
      return parseFloat(dataString.substring(rv + 3));
    } else {
      return parseFloat(dataString.substring(index + this.versionSearchString.length + 1));
    }
  },

  dataOs: [
      { string: navigator.userAgent, subString: "iPad", identity: "iOS" },
      { string: navigator.userAgent, subString: "iPhone", identity: "iOS" },
      { string: navigator.userAgent, subString: "Android", identity: "Android" }
  ],
  dataBrowser: [
      { string: navigator.userAgent, subString: "Edge", identity: "MS Edge" },
      { string: navigator.userAgent, subString: "Chrome", identity: "Chrome" },
      { string: navigator.userAgent, subString: "MSIE", identity: "Explorer" },
      { string: navigator.userAgent, subString: "Trident", identity: "Explorer" },
      { string: navigator.userAgent, subString: "Firefox", identity: "Firefox" },
      { string: navigator.userAgent, subString: "Safari", identity: "Safari" },
      { string: navigator.userAgent, subString: "Opera", identity: "Opera" }
  ]

});

BROWSER.detect();


/**
 * Es wird nur im Falle von GLOBAL_CONFIG.debugLogging = true geloggt
 * >> IE 10: Exception dass originalConsole nicht verwendet werden kann
 var console = (function (originalConsole) {
    return {
        log: function(logValue){
            if (GLOBAL_CONFIG.debugLogging) {
                originalConsole.log(logValue);
            }
        }
    };
}(window.console));
 * */


//////////$(window).load(function () {
//////////    if (typeof loadTagManagement == 'function') {
//////////        loadTagManagement();
//////////    }
//////////});


; (function ($, window, document, undefined) {

  'use strict';


  // --- INITIALISIERUNG ------------------------------------------------------------------------

  // Initialisierung, die ausgeführt wird, wenn der DOM komplett geladen ist.
  // Erstmal auskommentiert, da bisher keine notwendigkeit besteht, hier eine Initialisierung
  // durchzuführen. Aber schon mal vorgesehen, falls in Zukunft diese Notwendigkeit besteht.

  //
  $(document).ready(function () {

        // notice layer
        showNotice();

    GLOBAL_CONFIG.page = $('body').data('pageid');


    // user login state
    //logonstate = isLoggedIn();


    // image scaling
    image_scale(imageExcludes);
    image_swap(imageExcludes);

    if (typeof (ScaleHandler) !== 'function') {
      $(document).on("royalSliderHandler-ReadyEvent", scaleSliderImages);
    }
    else {
      ; // NOP
    }


    // sharing
    initSharepanel();


    // notice layer
    showNotice();


    //////////// m-14 Spa live stream (fliegt mit Le Mans wieder raus)
    //////////if (GLOBAL_CONFIG.stream !== undefined) {
    //////////  setStream();
    //////////}


    // 2014-07-01 [SK] - Flashcheck (leider nicht durch modernizr abgedeckt)
    if (typeof (swfobject) !== 'undefined') {
      if (swfobject.hasFlashPlayerVersion("1")) {
        $('html').addClass('hasflash');
      }
      else {
        $('html').addClass('no-flash');
      }
    }

    if (typeof (GLOBAL_CONFIG.GRID) !== 'undefined') {
      if ((GLOBAL_CONFIG.GRID === true) && (getURLParameter('grid') !== 'null')) {
        $('.m-00-header').on('click', function () {
          addGrid();
          if ($('.b-form-wrapper .group').length > 0) {
            addGridForms();
          }
        });
      }
    }

    // individual page tracking
    TRACKING.init();


    // BPG Images
    initBPGs();

  });


  //////////// Initialisierungen, die ausgeführt werden müssen, wenn die komplette Seite (inklusive Frames,
  //////////// Objekten, Bildern, ...) geladen ist
  //////////$(window).load(function () {

  //////////  // Verstecken der Browserleiste
  //////////  hideURLBar();
  //////////});



  // --- FUNKTIONEN -----------------------------------------------------------------------------

    // share panel
    function initSharepanel() {
        $('.touch .b-sharepanel').bind('click', function (evt) {
            evt.stopPropagation();
            if ($(this).hasClass('isActive')) {
                $(this).removeClass('isActive');
                $('body').off('click.sharepanel');
            }
            else {
                $(this).addClass('isActive');
                $('body').on('click.sharepanel', function ()
                {
                    $('.b-sharepanel').click();
                });
            }
        });
        $('.b-sharing').on('click', function () {

      var serviceID = $(this).data('service');

      if (typeof (console) !== 'undefined') {
        console.log(SHARING.SHARE(serviceID));
      }
    });
  }

  // notice layer
  function showNotice() {
    if ($('.b-linkblock-notice').length > 0) {
      $('.b-linkblock-notice').each(function () {
        var ID = $(this).attr('id');
        var closed = $.cookie(ID + '_' + GLOBAL_CONFIG.pool + '_closed');
        if (closed === 'true') {
          return;
        }
                else {
                  if (ID === 'cookie-notice') {
                    // positioning cookie disclaimer 
                    if ($('.b-page-wrapper.cookiedisclaimer').length != 0) {
                      $('.b-page-wrapper.cookiedisclaimer').css("height", $('#cookie-notice').height());
                      //$('.b-page-wrapper.cookiedisclaimer #cookie-notice').css("top", -1 * $('#cookie-notice').height());
                      $(window).resize(function () {
                        $('.b-page-wrapper.cookiedisclaimer').css("height", $('#cookie-notice').height());
                        //$('.b-page-wrapper.cookiedisclaimer #cookie-notice').css("top", -1 * $('#cookie-notice').height());
                      });
                    }
                    // positioning cookie disclaimer 
                  }
                }

        $('body').addClass('b-shownotice');

        $(this).find('.gui-btn-close').click(function () {
          var $elm = $(this).parent().parent();
          var ID = $elm.attr('id');
          $.cookie(ID + '_' + GLOBAL_CONFIG.pool + '_closed', 'true', {
            'expires': 3,
            'secure': (document.location.protocol === 'https' ? true : false),
            'path' : '/' + document.location.pathname.split('/')[1]
          });
          $('body').removeClass('b-shownotice');
                    if (ID === 'cookie-notice') {
                      $('.b-page-wrapper.cookiedisclaimer').remove();
                    }
        });

      });
    }
  }

  // BPG Images
  function initBPGs() {
    if ($('.bpg-picture-box').length > 0) {
      $('.bpg-picture-box').bpgImage();
    }
  }


  ///////////**
  ////////// * Versteckt die Browserleiste (URL-Bar, usw).
  ////////// * Sollte nur innerhalb eines Window-Load Events aufgerufen werden.
  ////////// *
  ////////// * Betrifft hauptsächlich das iPhone.
  ////////// */
  //////////function hideURLBar() {

  //////////  // Hat der Benutzer die Seite bereits gescrollt oder einen Anchor innerhalb einer Seite
  //////////  // aufgerufen, darf die Browserlseite nicht verstectk werden. Die Überprüfung ist
  //////////  // notwendig, da das Verstecken der Browserleiste durch ein Seitenscrolling realisiert ist.
  //////////  if (!location.hash && !window.pageYOffset) {

  //////////    window.setTimeout(function () {
  //////////      window.scrollTo(0, 1);
  //////////    }, 0);
  //////////  }

  //////////}

  //////////// Spa Streaming
  //////////function setStream() {
  //////////  var sWidth = $(window).width();
  //////////  var sHeight = $(window).height();
  //////////  var videoWidth = Math.floor(sWidth * (12 / 14) / 16) * 16;
  //////////  videoWidth = videoWidth > 640 ? 640 : videoWidth;
  //////////  var videoHeight = videoWidth / 16 * 9;

  //////////  //console.log(document.location.protocol + '//' + GLOBAL_CONFIG.stream.url + '?width=' + videoWidth + '&height=' + videoHeight);

  //////////  $('#streaming').attr('src', document.location.protocol + '//' + GLOBAL_CONFIG.stream.url + '?width=' + videoWidth + '&height=' + videoHeight);
  //////////}

})(jQuery, this, this.document);

function scaleSliderImages() {

  //console.log('scaleSliderImages');

  $('.m-04-intro-section-home-slider img[data-image-src], .m-08-features-slider img[data-image-src]').each(function () {
    var $imgP = $(this);
    //console.log($imgP.attr('data-image-src'));

    $imgP.attr('data-size', '');
    image_scaleOne($imgP);
    image_swapOne($imgP);
  });

}

function image_swap(excludeSelector) {
  try {
    excludeSelector = (excludeSelector === undefined) ? '' : excludeSelector;

    $('img[data-image-src]').not(excludeSelector).each(function () {
      var $img = $(this);
      image_swapOne($img);
    });
  }
  catch (e) {
  }
}

function image_swapOne($imgP, jdpFlag) {
  try {
    if (typeof ($imgP) === 'undefined') {
      return;
    }
    var $img = $imgP;
    var s = $img.attr('data-size');
    var currentSrc = $img.attr('src');
    var dataSrc = $img.attr('data-image-src');

    /*exclude infocard images from this mecanism*/
    if (dataSrc.indexOf("infocard") > -1) {
      currentSrc = dataSrc;
      s = '';
    }

    /*exclude m-29-feature-item-image from this mecanism*/
    if ($img.parent().parent().attr('class') == "m-29-feature-item-image") {
      currentSrc = dataSrc;
      s = '';
    }

    if (s !== '') {
      var arrImagePath = dataSrc.split('/');
      var imageIDWithParams = arrImagePath[arrImagePath.length - 2].split(';');

      if (imageIDWithParams.length === 1) {
        // id without params
        imageIDWithParams[0] += ';' + s;
        arrImagePath[arrImagePath.length - 2] = imageIDWithParams.join(';');
        dataSrc = arrImagePath.join('/');
      }
      else if (imageIDWithParams.length === 2) {
        // id with size
        imageIDWithParams[1] = s;
        arrImagePath[arrImagePath.length - 2] = imageIDWithParams.join(';');
        dataSrc = arrImagePath.join('/');
      }
      else if (imageIDWithParams.length === 3) {
        // with wallpaper w/h
          ; // nop
      }
    }

    if (currentSrc !== dataSrc) {
      $img.attr('src', dataSrc);
    }

  } catch (e) {

  }
}

function image_scale(excludeSelector) {
    try {
        excludeSelector = (excludeSelector === undefined) ? '' : excludeSelector;

        $('img[data-image-src]').not(excludeSelector).each(function () {
            var $img = $(this);

            image_scaleOne($img);

        });
    }
    catch (e) {

    }
}

function image_scaleOne($imgP) {
  //try {
  if (typeof ($imgP) === 'undefined') {
    return;
  }
  var $img = $imgP;
  var s = '';
  var iW = $img.width();
  var iSourceW = $img.attr('data-width');
  var maxWidth = $('html').hasClass('lt-ie9') ? 1450 : 1600;
  var screenWidth = (window.screen.width > maxWidth) ? maxWidth : window.screen.width;
  var windowWidth = ($(window).width() > maxWidth) ? maxWidth : $(window).width();
  var screenRatio = screenWidth / windowWidth;

  var iWmod = parseInt((iW * screenRatio).toString(), 0) + 1; // aufrunden
  var ratio = Math.round((iWmod / iSourceW) * 100, 0);
  var sizeTmp = 1;

  if (iSourceW > iWmod) {
    if (ratio <= 100 && ratio > 80) {
      ratio = 100;
      sizeTmp = 1;
    } else if (ratio <= 90 && ratio > 80) {
      ratio = 90;
      sizeTmp = 2;
    } else if (ratio <= 80 && ratio > 75) {
      ratio = 80;
      sizeTmp = 3;
    } else if (ratio <= 75 && ratio > 64) {
      ratio = 75;
      sizeTmp = 4;
    } else if (ratio <= 64 && ratio > 40) {
      ratio = 64;
      sizeTmp = 5;
    } else if (ratio <= 40 && ratio > 35) {
      ratio = 40;
      sizeTmp = 6;
    } else if (ratio <= 35 && ratio > 30) {
      ratio = 35;
      sizeTmp = 7;
    } else if (ratio <= 30 && ratio > 25) {
      ratio = 30;
      sizeTmp = 8;
    } else if (ratio <= 25 && ratio > 20) {
      ratio = 30;
      sizeTmp = 9;
    } else if (ratio <= 20) {
      ratio = 20;
      sizeTmp = 10;
    }

    // bilder dürfen nicht hochskaliert werden:
    //   >> wenn neue Bildgröße < als containergröße des bildes (dann würde das bild hochskaliert und somit unscharf werden):
    //       -> skalierungs parameter um eine größe verringern (= kleinere skalierung des originals)
    if (((ratio / 100) * iSourceW) <= iWmod) {
      sizeTmp -= 1;
    }

    switch (sizeTmp) {
      case 1:
        s = '';
        break;
      case 2:
        s = '15';
        break;
      case 3:
        s = '2';
        break;
      case 4:
        s = '25';
        break;
      case 5:
        s = '3';
        break;
      case 6:
        s = '4';
        break;
      case 7:
        s = '45';
        break;
      case 8:
        s = '5';
        break;
      case 9:
        s = '55';
        break;
      case 10:
        s = '6';
        break;
      default:
        s = '';
        break;
    }

    if (sizeTmp <= 1) {
      s = '';
    }
    else {
      s = 's' + s; //sizeTmp.toString();
    }


  } else {
    s = '';
  }

  //if ($img.attr('data-image-src').indexOf('rd2013-981-bo-modelimage-sideshot') > 0) {
  //    //console.log(iSourceW + ' / ' + iW + ' / ' + screenRatio + ' / ' + iWmod + ' / ' + Math.round((iWmod / iSourceW) * 100, 0) + ' / ' + sizeTmp);
  //}

  $img.attr('data-size', s);
  //}
  //catch (e) {

  //}
}
var parseQueryString = function () {
  var str = window.location.search;
  var objURL = {};

  str.replace(
      new RegExp("([^?=&]+)(=([^&]*))?", "g"),
      function ($0, $1, $2, $3) {
        objURL[$1] = $3;
      }
  );
  return objURL;
};

/**
 * Extrahiert den Wert eines einzelnen Parameters aus der URL
 * */
function getURLParameter(name) {
  return decodeURI(
      (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search) || [, null])[1]
  );
}

function addGrid(newBP) {
  if ($('.b-grid-overlay').length === 0) {
    $('.b-page-wrapper').append('<div class="b-grid-overlay ' + (newBP !== 1 ? '' : ' b-grid-overlay--new ' ) + ' module-container"><div class="module-grid"><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div></div></div>');
    $('.b-page-wrapper').addClass('show-grid');
    $('.b-grid-overlay').on('click', function () {
      $('.b-page-wrapper').removeClass('show-grid');
      $('.b-grid-overlay').remove();
    });
  }
}

function addGridForms() {
  if ($('.b-grid-overlay-zforms').length === 0) {
    $('.b-form-wrapper .group').append('<div class="b-grid-overlay-zforms module-container"><div class="module-grid"><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div><div class="b-column"></div></div></div>');
    $('.b-page-wrapper').addClass('show-grid-zforms');
    $('.b-grid-overlay-zforms').on('click', function () {
      $('.b-page-wrapper').removeClass('show-grid-zforms');
      $('.b-grid-overlay-zforms').remove();
    });
  }
}

;
(function ($, window, document, undefined) {
  'use strict';

  var moduleClass = 'm-900__fuel-economy',
      ModuleView,
      moduleInstances = [];

  $(document).on('fuel-economy.update', function (e, data) {
      _getTaggingData(e, data);
  });

  function _getTaggingData(e, data) {
    // console.log(data);

    var pageTags = $('.m-900__fuel-economy').attr('data-tagginglist');

    var DATA_URL = document.location.protocol + '//'
      + document.location.host
      + '/json/tagging'
      + '/' + GLOBAL_CONFIG.pool
      + (GLOBAL_CONFIG.language != 'none' ? '/' + GLOBAL_CONFIG.language : '')
      + (GLOBAL_CONFIG.region != '' ? '/_' + GLOBAL_CONFIG.region + '_' : '')
      + '/c.long'
      + '?tags=' + pageTags
      + '&moduletags=' + data.moduleData;

      $.ajax({
        url: DATA_URL,
        type: 'GET',
        dataType: 'html',
        complete: _taggingDataComplete
      });
  }

  function _taggingDataComplete(data, status) {
    if (status !== 'success') {
      return;
    }

    var $ecoContainerResponse = $(data.responseText);
    // $ecoContainerResponse.css({ 'background-color': 'lime' }); // debug

    var $ecoContainer = $('.m-900__fuel-economy');

    $ecoContainerResponse.insertAfter($ecoContainer);
    $ecoContainer.remove();

    $(document).trigger('fuel-economy.reinit');
  }

})(jQuery, this, this.document);/**
 * Representing the internal tracking interface.
 *
 * @author Johannes Weil <johannes.weil@udg.de>
 * @version 1.0.0
 *
 * @namespace TRACKING
 */
var TRACKING = {

        // GLOBALS
        /**
         * Prevent the external analytics extension tracking (only log)
         *
         * @inner
         */
        PREVENT: false,


        // region OPTIONS
        // -----------------------------------------------------------------------------------------------------------------
        /**
         * Options
         *
         * @inner
         */
        options: {
            queue: {
                // How often should the queue try to run after GA onLoad?
                maxTries: 10,
                // How long should the queue wait to try to run again?
                tryAgainWait: 500
            }
        },
        // -----------------------------------------------------------------------------------------------------------------
        // endregion


        // region INIT
        // -----------------------------------------------------------------------------------------------------------------
        /**
         * Initialize the interface when page is ready.
         *
         * @function TRACKING.init
         */
        init: function () {
            this.PIXEL.init();
            this.FACEBOOK.conversion();
        },

        /**
         * Special logger for TRACKING class
         *
         * @param {string} msg - The log message
         *
         * @function TRACKING.log
         */
        log: function (msg) {
            if (typeof (console) !== 'undefined')
            {
                console.log("PAG_TRACKER || " + (msg || ''));
            }
        },
        // -----------------------------------------------------------------------------------------------------------------
        // endregion


        // region ANALYTICS INTERFACE FUNCTIONS
        // -----------------------------------------------------------------------------------------------------------------
        /**
         * Store some things while processing analytics tracking
         *
         * @private
         * @inner
         */
        _analyticsStore: {

            lastPage: undefined, // store to be able to prevent double page tracking
            allEvents: [], // collect to be able to prevent double event tracking

            // collect already when external tracker is not available
            queue: {
                data: [], // All the pages/event/social calls that could not be triggered are stored for later use
                started: false, // Was the queue already processed
                timer: false, // Tried to process "try again" timer
                timerCount: 0 // Tried to process "try again" count
            }

        },
        /**
         * When the external analytics extension has loaded it triggers this function that will process the queue of
         * already triggered page/event/social tracks. So no Track will be lost.
         *
         * @returns {boolean} - Was the queue already processed
         *
         * @function TRACKING.onLoad
         */
        onLoad: function () {

            var _self = this,
                data,
                i,
                j;

            if (typeof window['pag_tracker'] === 'undefined')
            {
                this._analyticsStore.queue.timerCount++;
                if (this._analyticsStore.queue.timerCount < TRACKING.options.queue.maxTries)
                {
                    this._analyticsStore.queue.timer = window.setTimeout(function () {
                        _self.onLoad.call(_self);
                    }, TRACKING.options.queue.tryAgainWait);
                }

                return false;
            }

            if (!this._analyticsStore.queue.started && this._analyticsStore.queue.data.length > 0)
            {

                this._analyticsStore.queue.started = true;
                if (this._analyticsStore.queue.timer !== false)
                {
                    window.clearTimeout(this._analyticsStore.queue.timer);
                }

                for (i = 0; i < this._analyticsStore.queue.data.length; i++)
                {
                    data = this._analyticsStore.queue.data[i];
                    for (j = data.params.length; j < 4; j++)
                    {
                        data.params.push('');
                    }
                    this[data.type].call(this, data.params[0], data.params[1], data.params[2], data.params[3]);
                }

                this._analyticsStore.queue.data = [];

                return true;
            }

            return false;

        },

        /**
         * Track a new page name to the external analytics extension.
         *
         * @param {string} name - The page name to track.
         * @param {boolean} [preventDouble=false] - Prevent a page track if the last page had the same name.
         *
         * @returns {boolean} - Was the track registered (external analytics extension or queue)?
         *
         * @function TRACKING.page
         */
        page: function (name, preventDouble) {

            if (preventDouble === true && this._analyticsStore.lastPage === name)
            {
                return false;
            }
            this._analyticsStore.lastPage = name;

            if (!TRACKING.PREVENT)
            {
                if (typeof window['pag_tracker'] === 'undefined')
                {
                    this._analyticsStore.queue.data.push({type: 'page', params: [name]});
                    return true;
                }


                pag_tracker.page(name);
            }

            TRACKING.log('page: ' + name);

            return true;

        },

        /**
         * Track an event to the external analytics extension with category, action and label.
         *
         * @param {string} category - The category of the event (see Tracking Guide).
         * @param {string} action - The action of the event (see Tracking Guide).
         * @param {string} label - The label of the event (see Tracking Guide).
         * @param {boolean} [once=false] - If the event only should tracked once set this to true.
         *
         * @returns {boolean} - Was the track registered (external analytics extension or queue)?
         *
         * @function TRACKING.event
         */
        event: function (category, action, label, once) {

            if (!once || !this._eventAlreadyTriggered(category, action, label))
            {
                if (!TRACKING.PREVENT)
                {

                    if (typeof window['pag_tracker'] === 'undefined')
                    {
                        this._analyticsStore.queue.data.push({type: 'event', params: [category, action, label, once]});
                        return true;
                    }

                    pag_tracker.event(category, action, label);
                }

                TRACKING.log('event: \'' + category + '\',\'' + action + '\',\'' + label + '\', once:' + once + '');

                return true;
            }

            return false;

        },

        /**
         * Check if an event was already tracked. Is analyzed by using a hash from category, action and label.
         *
         * @param {string} category - The category of the event (see Tracking Guide).
         * @param {string} action - The action of the event (see Tracking Guide).
         * @param {string} label - The label of the event (see Tracking Guide).
         *
         * @returns {boolean} - Was this event already tracked?
         *
         * @private
         *
         * @inner
         */
        _eventAlreadyTriggered: function (category, action, label) {

            var eventName,
                already,
                i;

            eventName = category + "-" + action + "-" + label;
            already = false;

            for (i = 0; i < this._analyticsStore.allEvents.length; i++)
            {
                if (this._analyticsStore.allEvents[i] === eventName)
                {
                    already = true;
                    break;
                }
            }

            if (!already)
            {
                this._analyticsStore.allEvents.push(eventName);
            }

            return already;

        },

        /**
         * Track a social event to the external analytics extension with network, socialAction, target and pagePath.
         *
         * @param network - The network of the social event (see Tracking Guide).
         * @param socialAction - The socialAction of the social event (see Tracking Guide).
         * @param target - The target of the social event (see Tracking Guide).
         * @param pagePath - The pagePath of the social event (see Tracking Guide).
         *
         * @returns {boolean} - Was the track registered (external analytics extension or queue)?
         *
         * @function TRACKING.social
         */
        social: function (network, socialAction, target, pagePath) {

            if (!TRACKING.PREVENT)
            {
                if (typeof window['pag_tracker'] === 'undefined')
                {
                    this._analyticsStore.queue.data.push({
                        type: 'social',
                        params: [network, socialAction, target, pagePath]
                    });
                    return true;
                }

                pag_tracker.social(network, socialAction, target, pagePath);

            }

            TRACKING.log('social: \'' + network + '\',\'' + socialAction + '\',\'' + target + '\',\'' + pagePath + '\'');

            return true;
        },
        // -----------------------------------------------------------------------------------------------------------------
        // endregion


        // region PIXEL TRACKING
        // Doubleclick, ...
        // -----------------------------------------------------------------------------------------------------------------
        /**
         * Pixel Tracking
         * @namespace TRACKING.PIXEL
         */
        PIXEL: {

            /**
             * Process the pixel tracking. this function tries to get some data and tracks it via an iFrame.
             *
             * @function TRACKING.PIXEL.init
             */
            init: function () {

                var trackingParams,
                    trackingURL;

                // check tracking
                trackingParams = this._getTrackingParams();
                if (trackingParams !== false)
                {
                    // append tracking script
                    trackingURL = this._getTrackingURL(trackingParams);
                    $('body').append('<iframe src="' + trackingURL + '" width="1" height="1" frameborder="0" style="display:none !important;"/>');
                }

            },

            /**
             * Tries to get some tracking data by checking the environment of the page.
             *
             * @returns {Object|boolean} - The parameters as an object or false.
             *
             * @private
             * @inner
             */
            _getTrackingParams: function () {

                var active = false,
                    // default tracking parameters
                    trackingParams = {
                        "activityID": "",
                        "categoryID": "",
                        "type": "",
                        "rnd": parseInt(Math.random() * 10000000000000, 0),
                    },
                    // Pool and Page
                    pool,
                    page;

                pool = GLOBAL_CONFIG['pool'] || 'NOT AVAILABLE';
                page = GLOBAL_CONFIG['page'] || 'NOT AVAILABLE';

                switch (pool)
                {
                    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
                    case 'specials':
                        switch (page)
                        {
                            case "germany_faszination-porsche":
                                trackingParams.service = "doubleclick";
                                trackingParams.activityID = "4349699";
                                trackingParams.categoryID = "de_200";
                                trackingParams.type = "fa";
                                active = true;
                                break;

                            default:
                                break;
                        }
                        break;
                    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
                    case 'usa':
                        switch (page)
                        {
                            case "rd-2014-motorsport-raceseries-fiawec":
                                trackingParams.service = "doubleclick";
                                trackingParams.activityID = "4450347";
                                trackingParams.categoryID = "9U22ez1T";
                                trackingParams.type = "invmedia";
                                active = true;
                                break;

                            case "rd-2014-motorsport-raceseries-fiawec-livestreaming":
                                trackingParams.service = "doubleclick";
                                trackingParams.activityID = "4450347";
                                trackingParams.categoryID = "0n0QE27B";
                                trackingParams.type = "invmedia";
                                active = true;
                                break;

                            default:
                                break;
                        }
                        break;
                    // - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
                }

                if (active === true)
                {
                    return trackingParams;
                }
                else
                {
                    return false
                }
            },

            /**
             * Generates the pixel url by service and data
             *
             * @param {Object} trackingParams - The data generated by TRACKING.PIXEL._getTrackingParams function.
             * @param {string} trackingParams.service - The service name of the pixel.
             *
             * @returns {string} - The final pixel url to load via iFrame
             *
             * @see {@linkcode TRACKING.PIXEL~_getTrackingParams} for further information of the trackingParams.
             *
             * @private
             * @inner
             */
            _getTrackingURL: function (trackingParams) {

                var url = '';

                switch (trackingParams.service)
                {

                    case "doubleclick":
                        url = "https://#ACTIVITY#.fls.doubleclick.net/activityi;src=#ACTIVITY#;type=#TYPE#;cat=#CATEGORY#;dc_lat=;dc_rdid=;tag_for_child_directed_treatment=;ord=#RND#?";
                        url = url.replace(/#ACTIVITY#/g, trackingParams.activityID);
                        url = url.replace(/#CATEGORY#/g, trackingParams.categoryID);
                        url = url.replace(/#RND#/g, trackingParams.rnd);
                        url = url.replace(/#TYPE#/g, trackingParams.type);
                        break;

                    default:
                        break;

                }

                TRACKING.log("PIXEL._getTrackingURL : " + url);

                return url;

            }
        },
        // -----------------------------------------------------------------------------------------------------------------
        // endregion


        // region FACEBOOK TRACKING
        // -----------------------------------------------------------------------------------------------------------------
        /**
         * Facebook Conversion Tracking
         * @namespace TRACKING.FACEBOOK
         */
        FACEBOOK: {

            /**
             * Options
             * @inner
             */
            options: {
                // Enable Facebook conversion tracking
                enabled: false
            },

            /**
             * Try to load Facebook conversion tracking
             *
             * @function TRACKING.FACEBOOK.conversion
             */
            conversion: function () {

                var _fbq,
                    fbds,
                    s;

                _fbq = window['_fbq'] || false;

                if (this.options.enabled === true && _fbq !== false && !_fbq.loaded)
                {
                    fbds = document.createElement('script');

                    fbds.async = true;
                    fbds.src = '//connect.facebook.net/en_US/fbds.js';

                    s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(fbds, s);
                    _fbq.loaded = true;
                }
            }

        }
        // -----------------------------------------------------------------------------------------------------------------
        // endregion
    },

    // process queue like the microsite way
    tracker = {
        /**
         * This function is calld by the external analytics extension when the extension is ready.
         */
        onload: function () {
            TRACKING.onLoad.call(TRACKING);
        }
    };
;(function( $,  window, document, undefined) {
    'use strict';
    $(document).ready(function(){

        var $window = $(window)
          , breakpointState = -1
          , columnsSelector = '.m-03-related-links .m-03-column'
          , eventNamespace = '.m-03-footer'
          , isIE8          = !!($('html.ie8').length);


        // Akkordeon Initialisierung der footer Links
        $('#m-03-related-links-content').accordion({
              'accordionLinkSelector': '.m-03-related-links-acc-link'
            , 'accordionContent'     : '.m-03-related-links-acc-link-content'
            , 'closeOpenAccordions'  : true
            , 'breakpoint'           : 568
            , 'scrollDuration'       : 500
            , 'alwaysToggleActiveState': true
            , 'ignoreBreakpoints'    : false
            , 'scrollToContent'      : false
            , 'scrollToHeadline'     : true
            , 'checkEventClass'      : false
            , 'contentSuffix'        : '-content'
        });

        // Liefert den aktuellen Breakpoint
        function getCurrentBreakpoint() {

            // Prüfen ob die link Elemente display block haben => kleinste Ansicht
            // Spezieller Check auf responsive styles. Falls sich die Styles ändern hier
            // auch anpassen
            var breakpoint = -1;

            if ($('.m-03-related-links-acc-link').css('border-bottom-width') == '1px') {
                breakpoint = 0;
            } else {
                breakpoint = 1;
            }

            return breakpoint;
        }


        // Skaliert die Columns mit ihren Inhalten.
        // Hier wird der aktuell höchste Container ermittelt.
        // Alle Container werden entsprechend auf die gleich Höhe gesetzt
        function resizeColumns() {

            var maxHeightRow1 = 0
              , maxHeightRow2 = 0;

            // Get the max height
            $(columnsSelector).each(function(index, element) {
                var $actElement = $(element);
                $actElement.css({height: 'auto'});
                // First Row
                if (index < 2) {
                    maxHeightRow1 = Math.max(maxHeightRow1, $actElement.outerHeight());
                } else {
                    // Second row
                    maxHeightRow2 = Math.max(maxHeightRow2, $actElement.outerHeight());
                }
            });

            // Set the max height
            $(columnsSelector).each(function(index, element) {
                var $actElement = $(element);
                // First Row
                if (index < 2) {
                    $actElement.css({height: maxHeightRow1});
                } else {
                    // Second row
                    $actElement.css({height: maxHeightRow2});
                }

            });
        }

        // Entfernt die Styles der Footer Columns in der kleinste und größten Ansicht
        // Skaliert die Columns in der mittleren Ansicht
        function resizeFooterColumns() {
            breakpointState = getCurrentBreakpoint();

            if (breakpointState == 1) {
                resizeColumns();
            } else  {
                $(columnsSelector).removeAttr('style');
            }
        }


        // Timeout um die Footer Spalten zu skalieren.
        var timeOut = null;

        if (!isIE8) {
            $window.on('resize' + eventNamespace, function() {
                window.clearTimeout(timeOut);

                timeOut = window.setTimeout(function() {
                    resizeFooterColumns();
                }, 100);
            });
            resizeFooterColumns();
        }


    });

})(jQuery, this, this.document);
